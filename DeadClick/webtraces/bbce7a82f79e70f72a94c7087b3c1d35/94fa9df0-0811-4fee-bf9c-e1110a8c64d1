"use strict";function bubbleControl(a){function b(){var a=document.getElementById("_chatBubble"),b=document.getElementById("chatWindow"),d=document.getElementById("liveChatDialogContainer");a.style.display="none",sock_(function(){if(document.getElementById("_liveChatDialog")){var a=document.getElementById("_liveChatDialog");a=a.contentWindow}else{var b=document.createElement("iframe");b.setAttribute("id","_liveChatDialog"),b.setAttribute("src","javascript:false;"),b.setAttribute("scrolling","no"),b.setAttribute("frameborder","0"),b.style.width="100%",b.style.height="350px",b.style.padding="0",b.style.overflow="hidden",b.style.border="none",b.style.zIndex="9999999",b.innerHTML=p,d.appendChild(b),b._hostURL=host,a=b.contentWindow||b,a.accountId=accountId,window.chatFrameWindow=a,a.document.open(),a.document.write(p),a.document.close()}a._BotegoLiveChat&&introduce.bindData.bubble.count>0&&a._BotegoLiveChat.emitVisitorUnseen()}),c(),h(!0),cookies.createCookie("opended",!0,1),b.style.display="block",introduce.bindData.bubble.status="hide"}function c(){var a=document.getElementsByTagName("body")[0];switch(!window.textColor||document.querySelectorAll(".text-black").length||document.querySelectorAll(".text-white").length||(a.className=a.className+" text-"+window.textColor),_WidgetSettings.widget_theme){case"classic":disIframe.style.width="340px",disIframe.style.height="388px";break;case"minimal":disIframe.style.width="258px",disIframe.style.height="385px";break;case"new":disIframe.style.width="380px";var b="100%";disIframe.style.height=b,"left"===_WidgetSettings.widget_position?disIframe.style.left="0":disIframe.style.right="0";break;case"mobile":disIframe.style.width="100%",disIframe.style.height="100%",disIframe.style.right="0",disIframe.style.left="0",disIframe.style.top="0";break;default:disIframe.style.width="340px",disIframe.style.height="388px"}}function d(){var a,c,d="7px",e="7px",f="",g="0px",h="classic",i="/dashboard/widget/assets/widgets/badges/",j=document.getElementsByClassName("_bubble-label")[0],k=document.querySelectorAll("#_chatBubble .new-bubble")[0],l=document.querySelectorAll("#_chatBubble .widget-badge")[0],m=document.getElementsByClassName("badge-content")[0],n=document.getElementsByTagName("body")[0],o=(disIframe.style,function(a){return'<table><tr class="badge-style">'+a+"</tr></table>"});if(!window.textColor||document.querySelectorAll(".text-black").length||document.querySelectorAll(".text-white").length||(n.className=n.className+" text-"+window.textColor),"theme1"===_WidgetSettings.widget_badge_theme||"theme5"===_WidgetSettings.widget_badge_theme||"mobile"===_WidgetSettings.widget_theme||cookies.readCookie("opended")){if(document.querySelectorAll("body.widget-badge").length){"theme1"===_WidgetSettings.widget_badge_theme&&(n.className=n.className.replace(/\bwidget\-badge\b/,""),j.style.display="block",l.style.display="none");var p=document.getElementById("_chatBubble");p.onclick=function(){b()}}"theme5"===_WidgetSettings.widget_badge_theme&&(k.style.display="block",j.style.display="none",n.classList.contains("newBubble")||(n.className=n.className+" newBubble"),document.getElementsByClassName("last-message--body")[0].textContent=_WidgetSettings.widget_prechat_message),h=_WidgetSettings.widget_theme}else{var q;h="badge",document.querySelectorAll("body.widget-badge").length||(n.className=n.className+" widget-badge");var r=host+i+_WidgetSettings.widget_badge_image;switch(j.style.display="none",l.style.display="block",_WidgetSettings.widget_badge_theme){case"theme2":q='<td class="col badge-img"><div class="badge-icon"><img src="'+r+'"/></div></td><td class="col"><div class="badge-text">'+_WidgetSettings.widget_badge_title+"</div></td>";break;case"theme3":q='<td class="col"><div class="badge-text">'+_WidgetSettings.widget_badge_title+'</div></td><td class="col badge-img"><div class="badge-icon"><img src="'+r+'"/></div></td>';break;case"theme4":default:q='<td class="center">'+_WidgetSettings.widget_badge_title+"</td>"}m.innerHTML=o(q)}switch(h){case"classic":case"minimal":a="321px",c="54px";break;case"new":a="63px",c="62px",d="0px",e="0px";break;case"badge":a="250px",c="200px";break;case"mobile":a="200px",c="90px",d="12px",e="12px",f="",g="12px";break;default:a="321px",c="54px"}disIframe.style.width=a,disIframe.style.height=c,disIframe.style.top=f,disIframe.style.bottom=g,"left"===_WidgetSettings.widget_position?(disIframe.style.left=e,disIframe.style.right=""):(disIframe.style.left="",disIframe.style.right=d)}function e(a){var b;return b=function(a){return a=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),a&&4===a.length?("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2):""},parseInt(b(a),16)>8388607.5?"black":"white"}function f(){var a=document.getElementById("_chatBubble"),b=document.getElementById("chatWindow");a.style.display="block",b.style.display="none",d(),h(!1)}function g(a,b){var c=document.getElementsByTagName("body")[0],e=document.createElement("div");e.setAttribute("id","_liveChatContainer");var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.href=url+"/widget/css/chatStyle.css?1603102329",e.innerHTML=a,c.appendChild(f),c.appendChild(e),f.onload=f.onreadystatechange=function(a,c){if(c||!f.readyState||/loaded|complete/.test(f.readyState)){f.onload=f.onreadystatechange=null,f=void 0,document.getElementById("chatWindow-title").textContent=_WidgetSettings.widget_title,document.getElementById("bubble-title").textContent=_WidgetSettings.widget_bubbleTitle;var e;e="left"===_WidgetSettings.widget_position?"left":"right",document.getElementsByTagName("body")[0].className=_WidgetSettings.widget_theme+" color-"+_WidgetSettings.widget_color+" widget-"+e,d(),c||b&&b()}}}function h(a){var b="chatWindowStatus";cookies.createCookie(b,a,1)}function i(){return cookies.readCookie("chatWindowStatus")}function j(a){var c=document.querySelectorAll(".badge-form-input input")[0],d=document.querySelectorAll(".badge-form-send")[0],e=function(){c.value&&(window._lcFirstQuestion=c.value,b(),c.value="")};c.onkeypress=function(a){13===a.keyCode&&e()},d.onclick=function(){e()}}function k(){var a;a="theme1"===_WidgetSettings.widget_badge_theme||"theme5"===_WidgetSettings.widget_badge_theme||"mobile"===_WidgetSettings.widget_theme||cookies.readCookie("opended")?document.getElementById("_chatBubble"):document.getElementsByClassName("badge-content")[0],a.onclick=function(){b()};var c=document.getElementById("chatWindow-header");c.onclick=function(){f()},j(),document.onkeyup=function(a){var b=a.which?a.which:window.event.keyCode;27==b&&f()},"true"===i()?b():f()}function l(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return e[1]}return!1}function m(){var a=document.querySelectorAll(".new-bubble")[0];a.onmouseleave=function(){"show"===introduce.bindData.bubble.status&&(introduce.bindData.bubble.status="hideMessage")}}var n='<div id="_chatBubble" style="display:none;" class="animated slideInUp"> <div class="_bubble-label"> <div id="input-bubble"><div class="chat-icon"><span class="icon-bubble">&#xe601;</span></div><h4 id="bubble-title">Chat with us!</h4></div> </div> <div class="new-bubble" style="display:none;"><div class="new-bubble--bubble"></div><div class="new-bubble--last-message"><div class="last-message--body"></div><div class="last-message--caret"></div></div><div class="new-bubble--message-count"></div></div><div class="widget-badge" style="display:none;"><div class="badge-content"></div><div class="badge-form"><table><tr><td class="badge-form-input"><input placeholder="type here.." type="text"/></td><td class="badge-form-send"><div class="send">&#xe600;</td></tr></table></div></div></div> <div id="chatWindow" style="display:none;" class="_disable"> <div id="loading" class="loader" style=""><div class="sk-spinner splash sk-spinner-wave"><div class="sk-rect1"></div><div class="sk-rect2"></div><div class="sk-rect3"></div><div class="sk-rect4"></div><div class="sk-rect5"></div></div><div class="loading-text sk-spinner splash ">Loading</div></div><div id="chatWindow-header"> <h1 class="bot-title" id="chatWindow-title">Live support</h1> <span class="chatWindow-close caret"></span> </div> <div id="liveChatDialogContainer"></div></div>',o=function(){return _WidgetSettings.widget_premium?"":'<div class="powered">powered by <a href="'+host+'" target="_blank"><strong>livechat 24-7</strong></div></a>'},p='<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="'+url+'/widget/css/bootstrap/bootstrap.widget.css?1603081502"><link rel="stylesheet" href="'+url+'/widget/css/material/css/material-design-iconic-font.min.css"><link rel="stylesheet" href="'+url+'/widget/css/chatWidget.css?1603102329"></head><body><div class="agents-list"><div class="loader" style=""><div class="sk-spinner splash sk-spinner-wave"><div class="sk-rect1"></div><div class="sk-rect2"></div><div class="sk-rect3"></div><div class="sk-rect4"></div><div class="sk-rect5"></div></div></div></div><div id="message-row"><ul class="message-list list-unstyled" id="dialog"><li data-message-id="none" class="hidden agent message-log message message-list--welcome" data-author-hidden="false"><div class="message-container"><div class="message-container--avatar"><img src=""></div><div class="message-container--body"><div class="body-text"><p></p></div><div class="message-container--caret"></div></div></div></li></ul></div><form id="live-chat-form" class="" role="form" command="message"><div class="div-input-box"><div class="statusMessage"></div><textarea id="textarea-in" class="form-control" placeholder="type here.."></textarea></div></form><div class="footer"><div class="typing" id="quest-status"></div>'+o()+'</div><script src="'+url+'/widget/js/vendor/jquery/jquery.js?1603081502"></script><script src="'+url+'/widget/js/vendor/underscore/underscore-min.js?1603081502"></script><script src="'+url+'/widget/js/vendor/autosize/jquery.autosize.min.js?1603081502"></script><script src="'+url+'/livechat.js?1702172310"></script><script>$(function(){var _LiveChatAccountId = window.accountId || parent.parent._liveChat.profile.accountId;if(!parent._WidgetSettings.widget_requires_login){_BotegoLiveChat.start(_LiveChatAccountId, false);}else{_BotegoLiveChat.start(_LiveChatAccountId, false);}$("textarea").autosize();window.parent.parent._livechatInnerReady = true;if(parent._WidgetSettings.widget_theme != "classic"){$("body").addClass(parent._WidgetSettings.widget_theme);}});</script></body></html>';introduce._openChatWindow=b,introduce._closeChatWindow=f;var q=l("popupOpen");q===!0&&b(),g(n,function(){var b=document.getElementById("_chatBubble"),c=document.getElementsByTagName("body")[0];window.textColor=e(window._WidgetSettings.widget_color),c.className=c.className+" text-"+window.textColor,b.style.display="block",k(),m(),"function"==typeof a&&a(),"true"!==i()&&createWidgetPing(!1)})}function createWidgetPing(a){if(parent.window.location.origin+parent.window.location.pathname!=host+"/dashboard/simulate.html"){var b,c=parent.window.location.origin;a=a||!1;var d,e,f;b=function(){var a=new Date,b=a.getTime();return b};var g=cookies.readCookie("ping",!0)||{};if(a&&!g.opens)d="/api/widgets/opens",g.opens=!0;else if(a||g.visits)var h=!0;else d="/api/widgets/visits",g.visits=!0;h||(cookies.createCookie("ping",g,1),e=host+d+"?accountId="+accountId+"&host="+c+"&_="+b(),f=document.createElement("script"),f.src=e,document.getElementsByTagName("head")[0].appendChild(f))}}function getUrlParam(){var a={};parent.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d});return a}function sock_(a){if("undefined"!=typeof window.lcSocket)return void("function"==typeof a&&a());var b={reconnection:!0,reconnectionDelay:3e3,reconnectionDelayMax:3e3,reconnectionAttempts:5};if("1"===getUrlParam()._lc247preview){var c={subscribers:{},on:function(a,b){this.subscribers[a]=b},trigger:function(a){var b=null;arguments[1]&&(b=arguments[1]),this.subscribers[a]&&this.subscribers[a](b)},emit:function(){var a=["updateVisitorInfo","typingStatus","updateVisitorUnseen","newMessage","onAgentAvailability","getAgentsList","updateVisitorUnseen","ping"];if(-1===a.indexOf(arguments[0])){if("introduceVisitor"===arguments[0])return void setTimeout(function(){lcSocket.trigger("introduceCompleted",'{"status":{"message":"Success.","code":20},"data":{"chat":{"visitor":{"lastSeen":"2015-12-30T17:35:46.095257+00:00","displayName":"","id":"56841570102ee809a6e5cfd0","availability":"online","email":""},"typingStatus":{},"messages":[{"ah":{"displayName":"visitor-5cfd0","type":"visitor","id":"56841570102ee809a6e5cfd0"},"m":"Hi.","cat":"2015-12-30T17:34:18.049000+00:00"},{"ah":{"displayName":"Test Agent","type":"agent","id":"56840e1c102ee80e0c4958fd"},"m":"Hi, how can I help you?","cat":"2015-12-30T17:34:29.037000+00:00"},{"ah":{"displayName":"visitor-5cfd0","type":"visitor","id":"56841570102ee809a6e5cfd0"},"m":"What\'s your refund policy?","cat":"2015-12-30T17:34:40.348000+00:00"},{"ah":{"displayName":"Test Agent","type":"agent","id":"56840e1c102ee80e0c4958fd"},"m":"You can return the item with original packaging, in 30 days.","cat":"2015-12-30T17:34:47.872000+00:00"}],"secretKey":"7a28fa6e72c1bbc712afb84684f326dc","agents":[{"status":"joined","displayName":"Test Agent","id":"56840e1c102ee80e0c4958fd","photoFilename":"agent-default.png","availability":"online"}],"unpercivedCount":0,"updatedAt":"2015-12-30T17:34:47.872000+00:00","agentUnseen":{"count":0,"message":"What\'s your refund policy?","since":"2015-12-30T17:34:43.151000+00:00"},"accountId":"'+accountId+'","id":"56841570102ee809a6e5cfd0","createdAt":"2015-12-30T17:33:36.237000+00:00","visitorUnseen":{"count":0,"message":"You can return the item with original packaging, in 30 days.","since":"2015-12-30T17:34:49.689000+00:00"}}}}')},1e3);if("getSettings"===arguments[0])return void setTimeout(function(){lcSocket.trigger("settingsGenerated",'{"status": {"message": "Success.", "code": 20}, "data": {"settings": {"widget_color": "#0073AB", "timezone": "+0000", "widget_title": "Live support", "widget_bubble_title": "Chat with us!", "widget_bubble_image": "badge-default.png"}}}'),setManuelSettings({widget_color:"#0073AB",widget_title:"Live support",widget_bubble_title:"Chat with us!",widget_bubble_image:"badge-default.png",widget_open:!1})},1e3);if("connect"===arguments[0])return}}};window._lc247preview=!0,window.lcSocket=c,setTimeout(function(){lcSocket.trigger("connect")},1e3)}else{window.lcSocket=io.connect(_socket_host,b);var d=lcSocket.on;lcSocket.on=function(){var a=["connect","error","reconnect_failed","disconnect","messageReceived","agentJoined"];if(void 0===lcSocket._callbacks||"undefined"==typeof lcSocket._callbacks[arguments[0]]||-1!==a.indexOf(arguments[0]))return d.apply(this,arguments)}}lcSocket.on("connect",function(b){Reconnected||(introduce.connectionCount+=1),Logger.i("Visitor connected on "+_socket_host),introduce.introduceVisitor(function(){"function"==typeof a&&a()}),introduce.messageReceived(),introduce.agentJoined(),introduce.isWindowOpen(function(){document.getElementById("_liveChatDialog").contentWindow._BotegoLiveChat.connectionStatus(!0)})}),lcSocket.on("disconnect",function(a){Reconnected=!1,Timer=setTimeout(function(){Logger.e("disconnect",a),introduce.isWindowOpen(function(){document.getElementById("_liveChatDialog").contentWindow._BotegoLiveChat.connectionStatus(!1,"trying to reconnect to the server.")})},1e4)}),lcSocket.on("reconnect_failed",function(a){Logger.e("reconnect_failed",a,!0),introduce.isWindowOpen(function(){document.getElementById("_liveChatDialog").contentWindow._BotegoLiveChat.connectionStatus(!1,"reconnecting to the server failed. this issue is automatically reported.")})}),lcSocket.on("reconnect_attempt",function(a){Logger.e("reconnect_attempt",a),introduce.isWindowOpen(function(){})}),lcSocket.on("reconnect",function(a){Reconnected=!0,clearTimeout(Timer),Logger.e("reconnected",a)}),lcSocket.on("error",function(a){Logger.e("socket de bir sorun olustu",a,!0),introduce.isWindowOpen(function(){document.getElementById("_liveChatDialog").contentWindow._BotegoLiveChat.connectionStatus(!1,"reconnecting to the server failed. this issue is automatically reported.")})})}function showMessageClass(a){disIframe.style.width="321px",disIframe.style.height="90px",parent.lc247_isMobile&&(disIframe.style.width="59px");var b=document.querySelectorAll(".new-bubble")[0];a?b.classList.contains("showCount")||b.classList.add("showCount"):b.classList.contains("showCount")&&b.classList.remove("showCount"),b.classList.contains("showMessage")||b.classList.add("showMessage")}function hideMessageClass(a,b){var a=a||!1,b=b||!1,c=document.querySelectorAll(".new-bubble")[0];"allowResize"!==b&&(disIframe.style.width="63px",disIframe.style.height="62px"),c.classList.contains("showMessage")&&c.classList.remove("showMessage"),!a&&c.classList.contains("showCount")&&c.classList.remove("showCount")}var host=parent._hostURL,url=host+"/dashboard",accountId=parent._liveChat.profile.accountId,_socket_host=host+":5000/livechat?accountId="+accountId,disIframe=parent.document.getElementById("_liveChatFrame"),prefix="lc247_",Timer,Reconnected=!1;parent.window.location.origin||(parent.window.location.origin=parent.window.location.protocol+"//"+parent.window.location.hostname),parent.window.location.origin+parent.window.location.pathname===host+"/dashboard/simulate.html"&&(prefix="lc247_SM_");var cookies={isSafari:/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),isIE:!!document.documentMode,isEdge:!this.isIE&&!!window.StyleMedia,cookieFix:function(){return this.isSafari||this.isIE||this.isEdge},prefix:prefix,createCookie:function(a,b,c,d){var a=this.prefix+a,e="";if(c=c||1,"object"==typeof b&&(b=JSON.stringify(b)),b=encodeURIComponent(b),c){var f=new Date;f.setTime(f.getTime()+24*c*60*60*1e3),e="; expires="+f.toGMTString()}document.cookie=a+"="+b+e+"; path=/"},readCookie:function(a,b){for(var c,a=this.prefix+a,d=a+"=",e=document.cookie.split(";"),f=0;f<e.length;f++){for(var g=e[f];" "==g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(d))return c=decodeURIComponent(g.substring(d.length,g.length)),b?JSON.parse(c):c}return null},eraseCookie:function(a){this.createCookie(a,"",-1)}};if(getUrlParam()._lc247){var urlChatUserData=window.atob(getUrlParam()._lc247);if(urlChatUserData=urlChatUserData.split("|"),urlChatUserData.length<=3){var chatId=urlChatUserData[0],secretKey=urlChatUserData[1];self.setChatWindowStatus(!0),cookies.createCookie("SK",secretKey,120),cookies.createCookie("chatId",chatId,120),cookies.createCookie("visitorId",chatId,120)}}window.hideLoading=function(){Logger.i("hideLoading done"),document.getElementById("loading").className+=" hidden",createWidgetPing(!0)};var Logger=new function(){return{mute:!0,listeners:[],start:function(){this.mute=!1},stop:function(){this.mute=!0},i:function(a,b){this.write("Info",a,b)},e:function(a,b,c){var c=c||!1;c?this.write("Error_Capture",a,b):this.write("Error",a,b)},write:function(a,b,c,d){c=c||"","Error_Capture"==a&&Raven&&(c?Raven.captureMessage(b,{extra:c}):Raven.captureMessage(b)),this.mute||(c&&(b+=" ∫ raw: "),console?"Error"==a||"Error_Capture"==a?console.warn(a+": "+b,c," ∫ caller: ",d):console.log(a+": "+b,c):alert("Logger says: "+a+": "+b))}}};"1"!==getUrlParam().debug&&"*"!==localStorage.lc_debug&&"*"!==sessionStorage.lc_debug||Logger.start(),window._WidgetSettings=parent._WidgetSettings;var introduce={bindData:{bubble:{status:"show",message:"",count:0,img:{type:"default",src:""}}},bind:function(){var a,b=this;a={"bubble.status":function(a){var c=b.bindData.bubble,d=!0;switch(a){case"show":0===c.count&&(d=!1),null!==c.message&&"undefined"!==c.message&&0!==c.message.length&&showMessageClass(d);break;case"hide":hideMessageClass(!1,"allowResize"),window.unSeenCount=b.bindData.bubble.count,b.bindData.bubble.count=0,b.bindData.bubble.message="";break;case"hideMessage":hideMessageClass(!0)}},"bubble.message":{dom:".last-message--body",transform:function(a){return a.length>53&&(a=a.slice(0,53)+"..."),a}},"bubble.count":".new-bubble--message-count","bubble.img":function(a){var b=document.querySelector(".new-bubble--bubble"),c=host+"/dashboard/assets/widgets/badges/",d=new Date,e=d.getUTCMonth().toString()+d.getUTCDate().toString()+d.getUTCHours().toString();"agent"===a.type&&(c=host+"/dashboard/assets/agents/photos/"),"default"!==a.type||a.src||(a.src="badge-default.png"),a.src||(c=host+"/dashboard/assets/agents/photos/",a.src="agent-default.png"),-1!==a.src.search("http")&&(c=""),b.style.backgroundImage="url("+c+a.src+"?"+e+")"}},this.bindData=Bind(this.bindData,a),setInterval(function(){disIframe.style.display="block",disIframe.style.visibility="visible"},400)},introduceCompletedData:{},isSettingsSet:!1,Cookies:cookies,connectionCount:0,introduceVisitor:function(a){var b,c=this.getSecretKeyCookie(),d=this.getChatCookie();b={chat:{accountId:accountId,id:d,secretKey:c}},Logger.i("introduceVisitor: Visitor ID:  "+b.chat.id+" secretKey: "+b.chat.secretKey+" account ID: "+b.chat.accountId,b),lcSocket.emit("introduceVisitor",b),this.introduceCompleted(a)},introduceCompleted:function(a){var b=this;lcSocket.on("introduceCompleted",function(c){if(c=JSON.parse(c),74===c.status.code||c.data.chat.accountId!==accountId)return Logger.e("introduceCompleted failed",c),b.Cookies.eraseCookie("chatId"),b.Cookies.eraseCookie("visitorId"),b.Cookies.eraseCookie("SK"),b.Cookies.eraseCookie("style"),b.introduceVisitor(),!1;if(20!==c.status.code)return Logger.e("introduceCompleted failed",c,!0),b.visitorIntroduced=!1,!1;var d=c.data.chat;"undefined"==typeof parent.lc247Settings||c.data.chat.visitor.email||lcSocket.emit("updateVisitorInfo",{chat:{id:b.getChatCookie(),visitor:{displayName:parent.lc247Settings.displayName,email:parent.lc247Settings.email}}}),b.introduceCompletedData=c,b.setSecretKeyCookie(d.secretKey),b.setChatCookie(d.visitor.id),Logger.i("introduceCompleted: Visitor id "+d.visitor.id,c),"function"==typeof a&&a(),"1"!==getUrlParam()._lc247preview&&(b.getChatWindowStatus()&&(b.bindData.bubble.message=d.visitorUnseen.message,b.bindData.bubble.count=d.visitorUnseen.count,b.bindData.bubble.status="show"),b.setAgentPhoto(d.agents)),introduce.connectionCount>=2&&document.getElementById("_liveChatDialog").contentWindow._BotegoLiveChat.parentVisitorIntroduce()})},emitSettings:function(){lcSocket.emit("getSettings",{}),Logger.i("getSettings emited")},getSettings:function(a){function b(b){b.widget_theme="new",b.widget_badge_theme="theme5",c.setWidgetColor(b.widget_color),parent.lc247_isMobile&&(b.widget_theme="mobile"),"agent"!=c.bindData.bubble.img.type&&(c.bindData.bubble.img.src=b.widget_bubble_image),0===c.bindData.bubble.count&&(c.bindData.bubble.message=b.widget_bubble_title),window._WidgetSettings=b,c.isSettingsSet=!0,"function"==typeof a&&a()}var c=this;null===this.getChatCookie()||window.lcSocket||sock_();var d=this.Cookies.readCookie("settings",1)||!1;window._WidgetSettings?d&&"preview"===accountId?(Logger.i("settingsGenerated(source cookie): ",d),b(d)):(Logger.i("settingsGenerated(source api): ",window._WidgetSettings),c.Cookies.createCookie("settings",window._WidgetSettings,.007),b(window._WidgetSettings)):isSettingsSet?"function"==typeof a&&a():lcSocket.on("settingsGenerated",function(a){if(a=JSON.parse(a),20!==a.status.code)return Logger.e("settingsGenerated failed",a,!0),c.visitorIntroduced=!1,!1;var d=a.data.settings;Logger.i("settingsGenerated: ",a),c.Cookies.createCookie("settings",d,.007),b(d)})},setWidgetColor:function(a){var b,c="#chatWindow-header,#loading,.new-bubble--bubble,.new-bubble{background-color: "+a+";}#chatWindow{border-color: "+a+";}";b=document.getElementById("colorStyle"),b?b.innerHTML=c:(b=document.createElement("style"),b.setAttribute("id","colorStyle"),b.innerHTML=c,document.body.appendChild(b))},visitorUnseenUpdated:function(){var a=this;lcSocket.on("visitorUnseenUpdated",function(b){if(b=JSON.parse(b),20!==b.status.code)return Logger.e("visitorUnseenUpdated failed",b),a.visitorIntroduced=!1,!1;var c=b.data.chat.visitorUnseen;Logger.i("visitorUnseenUpdated: ",b),a.getChatWindowStatus()&&(a.bindData.bubble.message=c.message,a.bindData.bubble.count=c.count,a.bindData.bubble.status="show")})},messageReceived:function(){var a=this;window.isBubbleMessageReceived||(window.isBubbleMessageReceived=!0,lcSocket.on("messageReceived",function(b){if(b=JSON.parse(b),20!==b.status.code)return Logger.e("messageReceived failed[Bubble]: ",b),!1;b=b.data,a.introduceCompletedData.data.chat.messages.push(b);var c=b.m.answer?b.m.answer:b.m,d=b.m.question?b.m.question:"",e=""===d?c:'<div class="bot-soru">'+d+'</div><div class="bot-cevap">'+c+"</div>";Logger.i("messageReceived[Bubble]: "+e,b),b.id&&"visitor"!==b.ah.type&&"agent"==b.ah.type&&(a.getChatWindowStatus()&&(a.bindData.bubble.message=b.m,a.bindData.bubble.count+=1,a.bindData.bubble.status="show"),a.setAgentPhoto(!1,b.ah.id))}))},agentJoined:function(){var a=this;lcSocket.on("agentJoined",function(b){return b=JSON.parse(b),20!==b.status.code?(Logger.e("agentJoined failed[Bubble]: ",b),!1):(b=b.data,Logger.i("agentJoined[Bubble]: "+b.agent.displayName,b),a.introduceCompletedData.data.chat.agents.push(b.agent),void a.setAgentPhoto(!1,b.agent.id))})},setChatCookie:function(a){this.Cookies.createCookie("chatId",a,120),this.Cookies.createCookie("visitorId",a,120),Logger.i("setting chat Cookie: "+a)},getChatCookie:function(){var a=this.Cookies.readCookie("chatId")||this.Cookies.readCookie("visitorId");return a},setSecretKeyCookie:function(a){this.Cookies.createCookie("SK",a,120),Logger.i("setSecretKeyCookie: "+a)},getSecretKeyCookie:function(){var a=this.Cookies.readCookie("SK");return a},setUnseenMessages:function(a,b){var c=this,b=this.toUnixTime(b)||this.now(),d={},e=!1,f=0;a.forEach(function(a){var g=c.toUnixTime(a.cat);d[g]=a,g>b&&"agent"===a.ah.type&&(f+=1,e=a.m)}),e&&f&&(this.bindData.bubble.message=e,this.bindData.bubble.count+=f,this.bindData.bubble.status="show"),Logger.i("setUnseenMessages result: count:"+f+" lastMessage:"+e)},setAgentPhoto:function(a,b){var b=b||!1,c=null;a||(a=this.introduceCompletedData.data.chat.agents),a.forEach(function(a){if(b)b===a.id&&(c=a.photoFilename);else{if("online"===a.availability)return void(c=a.photoFilename);c=a.photoFilename}}),c&&(this.bindData.bubble.img.type="agent",this.bindData.bubble.img.src=c),Logger.i("findAgent photo bubble'a eklendi: "+c)},getChatWindowStatus:function(){return!("true"===this.Cookies.readCookie("chatWindowStatus"))},toUnixTime:function(a){return new Date(a).getTime()},now:function(){return(new Date).getTime()},isWindowOpen:function(a){introduce.getChatWindowStatus()||"undefined"==typeof introduce.introduceCompletedData.status||a()}};introduce.getSettings(function(){bubbleControl(function(){setTimeout(function(){introduce.bind()},2e3)})}),window.setManuelSettings=function(a,b){var c=disIframe.contentDocument.getElementsByTagName("body")[0];if(window._WidgetSettings.widget_position=a.widget_position,c.setAttribute("data-position",a.widget_position),c.classList.remove("widget-left"),c.classList.remove("widget-right"),c.classList.add("widget-"+a.widget_position),introduce.setWidgetColor(a.widget_color),introduce.bindData.bubble.img.src=a.widget_bubble_image,introduce.bindData.bubble.img.type="default",introduce.bindData.bubble.message=a.widget_bubble_title,0===a.widget_bubble_title.length&&(introduce.bindData.bubble.status="hideMessage"),document.getElementById("chatWindow-title").textContent=a.widget_title,document.getElementById("_liveChatDialog")){var d=document.getElementById("_liveChatDialog").contentDocument.getElementsByTagName("body")[0],e=d.querySelectorAll(".visitor-info-form .firstMessage")[0],f=d.querySelectorAll(".visitor-info-form .info-form")[0],g=d.querySelectorAll(".visitor-info-form .final")[0];"widget_message_before_requesting_email"===b?(e.style.display="block",f.style.display="block",g.style.display="none"):"widget_message_after_email_received"===b?(e.style.display="none",f.style.display="none",g.style.display="block"):(e.style.display="block",f.style.display="block",g.style.display="none"),e.textContent=a.widget_message_before_requesting_email,g.textContent=a.widget_message_after_email_received}a.widget_open?introduce._openChatWindow():(introduce.getChatWindowStatus()||introduce._closeChatWindow(),introduce._closeChatWindow(),a.widget_bubble_title.length>0&&(introduce.bindData.bubble.status="show"),introduce.bindData.bubble.message=a.widget_bubble_title)};