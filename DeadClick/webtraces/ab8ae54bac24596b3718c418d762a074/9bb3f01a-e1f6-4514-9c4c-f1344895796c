/*
 Copyright (c) 2006-2018 Outdooractive GmbH & Co. KG. All rights reserved.

 Find out more at http://corp.outdooractive.com/ and http://www.outdooractive.com/
 am_bounds  && */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(k,h,g){k!=Array.prototype&&k!=Object.prototype&&(k[h]=g.value)};$jscomp.getGlobal=function(k){return"undefined"!=typeof window&&window===k?k:"undefined"!=typeof global&&null!=global?global:k};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var k=0;return function(h){return $jscomp.SYMBOL_PREFIX+(h||"")+k++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.iterator;k||(k=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[k]&&$jscomp.defineProperty(Array.prototype,k,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(k){var h=0;return $jscomp.iteratorPrototype(function(){return h<k.length?{done:!1,value:k[h++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(k){$jscomp.initSymbolIterator();k={next:k};k[$jscomp.global.Symbol.iterator]=function(){return this};return k};$jscomp.iteratorFromArray=function(k,h){$jscomp.initSymbolIterator();k instanceof String&&(k+="");var g=0,f={next:function(){if(g<k.length){var e=g++;return{value:h(e,k[e]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill=function(k,h,g,f){if(h){g=$jscomp.global;k=k.split(".");for(f=0;f<k.length-1;f++){var e=k[f];e in g||(g[e]={});g=g[e]}k=k[k.length-1];f=g[k];h=h(f);h!=f&&null!=h&&$jscomp.defineProperty(g,k,{configurable:!0,writable:!0,value:h})}};$jscomp.polyfill("Array.prototype.keys",function(k){return k?k:function(){return $jscomp.iteratorFromArray(this,function(h){return h})}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(k){return k?k:function(){return $jscomp.iteratorFromArray(this,function(h,g){return g})}},"es8","es3");$jscomp.polyfill("Array.prototype.fill",function(k){return k?k:function(h,g,f){var e=this.length||0;0>g&&(g=Math.max(0,e+g));if(null==f||f>e)f=e;f=Number(f);0>f&&(f=Math.max(0,e+f));for(g=Number(g||0);g<f;g++)this[g]=h;return this}},"es6","es3");
$jscomp.makeIterator=function(k){$jscomp.initSymbolIterator();var h=k[Symbol.iterator];return h?h.call(k):$jscomp.arrayIterator(k)};$jscomp.owns=function(k,h){return Object.prototype.hasOwnProperty.call(k,h)};
$jscomp.polyfill("WeakMap",function(k){function h(b){$jscomp.owns(b,f)||$jscomp.defineProperty(b,f,{value:{}})}function g(b){var c=Object[b];c&&(Object[b]=function(a){h(a);return c(a)})}if(function(){if(!k||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),a=new k([[b,2],[c,3]]);if(2!=a.get(b)||3!=a.get(c))return!1;a.delete(b);a.set(c,4);return!a.has(b)&&4==a.get(c)}catch(m){return!1}}())return k;var f="$jscomp_hidden_"+Math.random().toString().substring(2);g("freeze");g("preventExtensions");
g("seal");var e=0,d=function(b){this.id_=(e+=Math.random()+1).toString();if(b){$jscomp.initSymbol();$jscomp.initSymbolIterator();b=$jscomp.makeIterator(b);for(var c;!(c=b.next()).done;)c=c.value,this.set(c[0],c[1])}};d.prototype.set=function(b,c){h(b);if(!$jscomp.owns(b,f))throw Error("WeakMap key fail: "+b);b[f][this.id_]=c;return this};d.prototype.get=function(b){return $jscomp.owns(b,f)?b[f][this.id_]:void 0};d.prototype.has=function(b){return $jscomp.owns(b,f)&&$jscomp.owns(b[f],this.id_)};d.prototype.delete=
function(b){return $jscomp.owns(b,f)&&$jscomp.owns(b[f],this.id_)?delete b[f][this.id_]:!1};return d},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(k){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!k||!k.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),a=new k($jscomp.makeIterator([[c,"s"]]));if("s"!=a.get(c)||1!=a.size||a.get({x:4})||a.set({x:4},"t")!=a||2!=a.size)return!1;var b=a.entries(),d=b.next();if(d.done||d.value[0]!=c||"s"!=d.value[1])return!1;d=b.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!b.next().done?!1:!0}catch(r){return!1}}())return k;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var h=new WeakMap,g=function(c){this.data_={};this.head_=d();this.size=0;if(c){c=$jscomp.makeIterator(c);for(var a;!(a=c.next()).done;)a=a.value,this.set(a[0],a[1])}};g.prototype.set=function(c,a){var b=f(this,c);b.list||(b.list=this.data_[b.id]=[]);b.entry?b.entry.value=a:(b.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:c,value:a},b.list.push(b.entry),this.head_.previous.next=b.entry,this.head_.previous=b.entry,this.size++);return this};g.prototype.delete=
function(c){c=f(this,c);return c.entry&&c.list?(c.list.splice(c.index,1),c.list.length||delete this.data_[c.id],c.entry.previous.next=c.entry.next,c.entry.next.previous=c.entry.previous,c.entry.head=null,this.size--,!0):!1};g.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=d();this.size=0};g.prototype.has=function(c){return!!f(this,c).entry};g.prototype.get=function(c){return(c=f(this,c).entry)&&c.value};g.prototype.entries=function(){return e(this,function(c){return[c.key,
c.value]})};g.prototype.keys=function(){return e(this,function(c){return c.key})};g.prototype.values=function(){return e(this,function(c){return c.value})};g.prototype.forEach=function(c,a){for(var b=this.entries(),d;!(d=b.next()).done;)d=d.value,c.call(a,d[1],d[0],this)};g.prototype[Symbol.iterator]=g.prototype.entries;var f=function(c,a){var d=a&&typeof a;"object"==d||"function"==d?h.has(a)?d=h.get(a):(d=""+ ++b,h.set(a,d)):d="p_"+a;var e=c.data_[d];if(e&&$jscomp.owns(c.data_,d))for(c=0;c<e.length;c++){var f=
e[c];if(a!==a&&f.key!==f.key||a===f.key)return{id:d,list:e,index:c,entry:f}}return{id:d,list:e,index:-1,entry:void 0}},e=function(c,a){var b=c.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=c.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:a(b)};b=null}return{done:!0,value:void 0}})},d=function(){var b={};return b.previous=b.next=b.head=b},b=0;return g},"es6","es3");
$jscomp.polyfill("Array.prototype.entries",function(k){return k?k:function(){return $jscomp.iteratorFromArray(this,function(h,g){return[h,g]})}},"es6","es3");"undefined"===typeof dojo||dojo.provide("oax.api");"undefined"!==typeof dojo&&dojo.provide("alp.lang");var alp;"undefined"===typeof alp&&Object.defineProperty(this,"alp",{value:{},writable:!1});alp||(alp=this.alp);
"undefined"===typeof console&&(console={},__console=[],console.log=function(){__console.push(["[LOG] "+Array.prototype.join.call(arguments," "),this,arguments])},console.error=function(){__console.push(["[ERROR] "+Array.prototype.join.call(arguments," "),this,arguments])});var oaConfig,alpConfig;
(function(k){function h(){}function g(b,c,d){var e=b&&b.length;if(!e)return!0;var l=c?"(v=arr[i]),(v="+("string"===typeof c?a(c,"v","i"):"v=transform.call(this,v,i)")+")":"v=arr[i]";return v(0,e,"if("+l+")ret=v;else return false;",{ivar:"i",retInit:"true, arr = that.arr, transform = that.transform, v",that:{arr:b,transform:c},thisObj:d})}function f(a,b){function c(){return a.apply(b||this,d.concat(aa.call(arguments)))}if("string"===typeof a)a=b[a];else if(2>arguments.length)return a;if("function"!==
typeof a)throw Error("alp.bindF(): expects a function!");var d=aa.call(arguments,2);c._bindArgs=arguments;return c}function e(a,b,c,d){function e(){l&&a.apply(this,arguments);b&&b.apply(this,arguments)}var l="function"===typeof a;var m=a?E(l?a.prototype:a):{};for(var f=arguments.length,p=2;p<f;p++){var g=arguments[p],n=g instanceof Array?fa:ca,r;for(r in g)r in n&&!g.hasOwnProperty(r)||(m[r]=g[r])}e.prototype=m;e.parent=a;e.Ctor_impl=b;return e}function d(b,c,e){if("string"===typeof c){if(c in d)var l=
d[c];else l=new Function("arr","var ret=[]; for(var n=arr.length,i=0,v;i<n;i++){if(i in arr && (v=arr[i],"+a(c,"v","i")+"))ret.push(v);}return ret;"),d[c]=l;return l.call(e,b)}if("function"===typeof b.filter)return b.filter(c,e);e=e||k;for(var m=[],f=b.length,p=0;p<f;p++)p in b&&c.call(e,l=b[p],p,b)&&m.push(l);return m}function b(a){return a.replace(da,ba)}function c(b,d,e){if("string"===typeof d){if(d in c)var l=c[d];else l=new Function("arr","for(var n=arr.length,i=0,v;i<n;i++)if(i in arr){v=arr[i],"+
a(d,"v","i")+";}"),c[d]=l;return l.call(e,b)}if("function"===typeof b.forEach)b.forEach(d,e);else{e=e||k;l=b.length;for(var m=0;m<l;m++)m in b&&d.call(e,b[m],m,b)}}function a(a,b,c){null==a&&(a="");b||(b="v");c||(c="w");var d=a+"\n'\n\"\n/\n*/\n#\n"+b+"\n'\n\"\n/\n*/\n#\n"+c;if(d in ha)return ha[d];var e=/^\s*(?:[+*\/%&|\^\.=<>\?]|!=|-=|$)/.test(a),l=/[+\-*\/%&|\^\.=<>!]\s*$/.test(a)&&!/(\+\+|\-\-)$/.test(a);e&&(a=b+a);l&&(a+=e?c:b);return ha[d]=a}function m(b,c,d){return b in ja?ja[b]:ja[b]=new Function(c||
"v",d||"w","return "+a(b)+";")}function l(a,b,c){return"function"===typeof a?a:m(a,b,c)}function r(a,b,c){"string"===typeof b&&(b=m(b));var d=a instanceof Function?h:a instanceof Array?fa:ca,e;for(e in a)e in d||b.call(c,a[e],e,a)}function n(a,b,c){if("number"===typeof a)return(1-c)*a+c*b;var d=a&&b;if(!d)return d;d=a instanceof Array?Array(a.length):{};var e=1-c,l;for(l in a)if(!(l in d)){var m=a[l],f=b[l];d[l]="number"===typeof m?e*m+c*f:n(m,f,c)}return d}function q(a){return"number"===typeof a&&
!isNaN(a)&&isFinite(a)}function p(a,b){if("function"===typeof a.lastIndexOf)return a.lastIndexOf(b);for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function v(b,c,d,e){e=I({retInit:"",step:"++",that:null,ivar:"v",thisObj:null},e);var l="number"===typeof b,m="number"===typeof c,f=l?"init":b,p=m?"<test":c;l=[l,f,m,p,d,e.retInit,e.step,e.ivar].join("\n'\n\"\n/\n*/\n#\n");l in na?d=na[l]:(d=(e.retInit?"var ret="+e.retInit+";":"")+"for (var "+e.ivar+"="+a(f)+";"+a(p,e.ivar)+";"+(null==e.step?"":
a(e.step,e.ivar))+"){"+a(d)+"}"+(e.retInit?"return ret;":""),na[l]=d=new Function("init","test","that",d));return d.call(e.thisObj||this,b,c,e.that)}function u(b,c,d){var e=I({retInit:"",that:null,kvar:"k",thisObj:null},d),l=b instanceof Array,m=[l,c,e.retInit,e.step,e.ivar].join("\n'\n\"\n/\n*/\n#\n");m in la?m=la[m]:(c=(e.retInit?"var ret="+e.retInit+";":"")+"var empty="+(l?"[]":"{}")+";for (var "+e.kvar+" in o) { if (!("+e.kvar+" in empty)) {"+a(c,"v",e.kvar)+"}}"+(e.retInit?"return ret;":""),
la[m]=m=new Function("o","that",c));return m.call(d.thisObj||this,b,e.that)}function t(a,b){"string"===typeof a&&(a=K(a));var c=aa.call(arguments,2);if(a)if("string"===typeof b)var d=b&&a[b];else for(var e=b.length,l=0;!d&&l<e;d=a[b[l]],l++);if("function"===typeof d)return d.apply(a,c)}function w(b,c,d){if("string"===typeof c){if(c in w)var e=w[c];else e=new Function("arr","var n=arr.length,ret=new Array(n); for(var i=0,v;i<n;i++){if(i in arr)ret[i]=(v=arr[i],"+a(c,"v","i")+");};return ret;"),w[c]=
e;return e.call(d,b)}if("function"===typeof b.map)return b.map(c,d);e=b.length;var l=Array(e);d=d||k;for(var m=0;m<e;m++)m in b&&(l[m]=c.call(d,b[m],m,b));return l}function x(b,c,d,e){if("string"===typeof c&&"string"===typeof d){var m="["+c+"]_#,#_["+d+"]";m in x?c=x[m]:(c=new Function("arr","var n=arr.length,ret=[]; for(var i=0,v;i<n;i++){if(i in arr){v=arr[i];v="+a(c,"v","i")+";if("+a(d,"v","i")+") ret.push(v);}};return ret;"),x[m]=c);return c.call(e,b)}c=l(c,"v","i");d=l(d,"v","i");m=b.length;
var f=[];e=e||k;for(var p=0,g;p<m;p++)p in b&&(g=b[p],g=c.call(e,g,p),d.call(e,g,p)&&f.push(g));return f}function y(a,b){function c(a){if(1>arguments.length){if(b)throw Error("alp.memF(): a mandatory key `"+b+"` must be provided.");return"val"in c?c.val:c.val=d.call(this)}var l="string"===typeof a?a:S(a);return e.hasOwnProperty(l)?e[l]:e[l]=d.call(this,a)}var d="function"===typeof a?a:new Function(b||"key","return "+a+";"),e={};c.__memF_src=a;return c}function z(a,b){for(var c=arguments.length,d=
1;d<c;d++)if(b=arguments[d]){var e=b instanceof Array?fa:ca,l;for(l in b)l in e||(a[l]=b[l])}return a}function A(a,b){var c="string"===typeof b?[b]:b;b=c.join("\n'\n\"\n/\n*/\n#\n");b in A||(c=w(c,function(a){return"var success = false; try { success = !!("+a+'); } catch (e) { success = e; }\nif (true !== success) throw new Error("Object does not fulfill scheme part: '+a.replace(/"/g,'\\"')+'");'}).join("\n"),A[b]=new Function("v",c));(0,A[b])(a)}function C(a,b,c){if("object"!==typeof a||null==a)return a;
var d=a instanceof Array?Array(a.length):{};if(b)for(var e in a){if(a.hasOwnProperty(e)){var l=a[e];d[e]=l&&"object"===typeof l?C(l,b,c):c?c(l,e,a):l}}else for(e in a)e in d||(l=a[e],d[e]=l&&"object"===typeof l?C(l,b,c):c?c(l,e,a):l);return d}function E(a){function b(){}a instanceof Array&&console.error("alp.oCreate: `oProto` instanceof Array. On some platforms/environments the result will be unreliable (e.g. iPad as of 2013-07-04). Implementation note: we do *not* use `Object.create( <array> )` because (1) it may have issues in IE8- and (2) some of our clients use old Mootools, which messes around with `Object.create`. See also Trac ticket #9655");
return b.prototype=a,new b}function G(a,b,c){function d(a,b,e){if(null==e[b])e[b]=C(a,!1,c);else if("object"!==typeof a||a instanceof Array)c&&(e[b]=c(a,b,e));else{var l=e[b];r(a,function(a,b){d(a,b,l)})}}r(b,function(b,c){d(b,c,a)});return a}function B(a,b,c,d){c||(c=this);d||(d=[]);var e=a instanceof Array?fa:ca,l;for(l in a)if(!(l in e)){var m=a[l],f=d.concat([l]);m&&"object"===typeof m?B(m,b,c,f):b.call(c,a[l],l,a,f)}return a}function I(a,b,c){a=E(a);if(b)for(var d in b)if(!(d in ka)){if(c&&!(d in
a)){var e='alp.oCreateMix: unknown key "'+d+'".';if(1<c)throw Error(e);console.error(e)}a[d]=b[d]}return a}function L(a){if(a)for(var b in a)if(!(b in ca)){var c=a[b];"number"===typeof c&&isNaN(c)?delete a[b]:c&&"object"===typeof c&&L(c)}return a}function J(a,b){if(a===b)return!0;var c=typeof a;if(c!==typeof b)return!1;if("object"===c){if(null==a^null==b)return!1;for(var d in a)if(!(d in ca||d in b))return!1;for(var e in b)if(!(e in ca||e in a))return!1;for(var l in a)if(!(l in ca)){c=a[l];d=b[l];
e=typeof c;var m=typeof d;if("object"===e&&"object"===m?!J(c,d):e!==m||!(c===d||"number"==e&&isNaN(c)&&isNaN(d)))return!1}return!0}return a===b||"number"===c&&isNaN(a)&&isNaN(b)}function P(a,b,c){return H(a,c)(b)}function H(a,b){function c(a){return function(b){return(g?l():l)[a(b)]}}function d(a){b.case_insensitive&&(a=a.toLowerCase());var c=N,d=Infinity,m=null,f=b.excluded,n=g?l():l;if(f&&("string"===typeof f&&a.toLowerCase()===f.toLowerCase()||"object"===typeof f&&-1<p(f,a.toLowerCase())||"function"===
typeof f&&f(a.toLowerCase())))return m;if(!b.transform){f=[a];b.case_insensitive&&f.push(f,a.toLowerCase(),a.toUpperCase(),a.charAt(0).toUpperCase()+a.substring(1));for(var r=0,q=f.length;r<q;r++){var v=f[r];if(v in n&&!(v in ca))return v}}for(var h in n)if(!(h in ca)&&(f=b.transform?b.transform(h,n):h,f!==b.excluded)){b.case_insensitive&&(f=f.toLowerCase());f=c(f,a,e);if(0===f)return h;f<d&&(m=h,d=f)}return m}b=I({case_insensitive:!0,excluded:"_find",transform:null,modified:!0,returnValue:!1},b);
var e=D(b,["modified"]);"string"===typeof b.transform&&(b.transform=m(b.transform));if(a instanceof Array){var l={};for(var f=a.length;f--;)l[a[f]]=1}else l=a;var g="function"===typeof l;return b.returnValue?c(d):d}function F(a){var b=[],c=a instanceof Array?fa:ca,d;for(d in a)d in c||b.push(d);return b}function D(a,b,c){"string"===typeof a&&(a=K(a));if(a){b instanceof RegExp&&(b=[b]);if(a&&("number"===typeof b||"string"===typeof b))return a[b];for(var d={},e,l=0,m=b.length;l<m;l++)if(e=b[l],e instanceof
RegExp)for(var f in a)f in d||!e.test(f)||(d[f]=a[f]);else if(!c||e in a)d[e]=a[e];return d}}function M(a,b,c){if(!(a&&a instanceof Object))throw Error("alp.oSet(): you must give a non-empty object `o`");var d=typeof b,e=2<arguments.length;d="object"===d?b:"string"===d?b.split("."):[b];var l=d.length;if("number"!==typeof l)throw Error("alp.oGet()/alp.oSet(): could not resolve the number of properties");if(!(0<l))throw Error("alp.oGet()/alp.oSet(): you gave an empty propname:",b);var m=a;--l;for(var f=
0;f<l;f++){var p=d[f];m=m[p]||e&&(m[p]={})}return 3>arguments.length?m[d[l]]:m[d[l]]=c}function R(a){a=Math.abs(a);var b=f.apply(alp,aa.call(arguments,1)),c,d,e;return function(){function l(){e=null;c=Date.now?Date.now():+new Date;b.apply(m,d)}var m=this;d=arguments;if(null==e){var f=Date.now?Date.now():+new Date,p=a-(f-c);0<p?(d=arguments,e=setTimeout(l,p)):(c=f,b.apply(m,arguments))}}}function S(a){if(null===a)return"null";if(void 0===a)return"undefined";if("string"===typeof a)return['"',a.replace(/"/g,
'\\"'),'"'].join("");if("object"!==typeof a)return a;if(a instanceof Array){var b=a.length;var c=Array(b);for(var d=0;d<b;d++)c[d]=S(a[d]);return"["+c.join(",")+"]"}c=[];for(b in a)b in ca||c.push(['"',b,'":',S(a[b])].join(""));return"{"+c.join(",")+"}"}function T(a){if(a)for(var b in a)if(!(b in ca)){var c=a[b];null==c&&null!==c?a[b]=null:c&&"object"===typeof c&&T(c)}return a}function Q(b,c,d){var e=2<arguments.length;if("string"===typeof c){if(c in Q)var l=Q[c];else l=new Function("arr,v,i","var n=arr.length;for(var w;i<n;i++){v=(w=arr[i],"+
a(c)+");}return v;"),Q[c]=l;return l(b,e?d:b[0],e?0:1)}if("function"===typeof b.reduce)return e?b.reduce(c,d):b.reduce(c);l=b.length;if(!l&&!e)throw new TypeError("reduce of empty array with no initial value");var m=e?d:b[0];for(e=e?1:0;e<l;e++)m=c(m,b[e],e,b);return m}function O(a){return/^\w+:\/\//.test(a)?a:/^\/\//.test(a)?location.protocol+a:/^\//.test(a)?location.protocol+"//"+location.host+a:(document.baseURI||location.href).split("#")[0].replace(/\/[^\/]*$/,"/")+a}function N(a,b,c){a=a.split("");
b=b.split("");var d=a.length,e=b.length,l=[],m,f;l.push([]);for(m=0;m<=e;m++)l[0].push(m);for(m=1;m<=d;m++)l.push([m]);for(m=0;m<d;m++)for(f=0;f<e;f++)l[m+1].push(Math.min(l[m][f+1]+1,l[m+1][f]+1,l[m][f]+(a[m]===b[f]?0:1)));d=l[d][e];a=a.join("");b=b.join("");c&&c.modified&&a&&b&&(-1<b.lastIndexOf(a)||-1<a.lastIndexOf(b))&&(d/=2);return d}function X(a,b,c,d){c||(c="0");a+="";b=V(c,Math.ceil((b-a.length)/c.length));return d?a+b:b+a}function V(a,b){if(0>=b||!a)return"";for(var c=[];;){b&1&&c.push(a);
if(!(b>>=1))break;a+=a}return c.join("")}function K(a,b,c){b||(b=k);var d=typeof a;if("number"===d)return b[d];if("string"===d){a=a.split(".");if(!b)throw Error("alp.sub(): at least the global context should be known!");var e=a.length;for(d=0;d<e;d++){var l=a[d];if(b&&l in b&&void 0!==b[l])b=b[l];else if(c)b=b[l]=c===Array||c instanceof Array?[]:{};else return}return b}if(a instanceof RegExp){c={};for(e in b)e in c||a.test(e)&&(c[e]=b[e]);return c}if("object"===d){c=a instanceof Array?[]:{};for(e in a)e in
c||(c[e]=K(a[e],b));return c}return a.call(b,b)}function U(a,b,c,d){var e=3<arguments.length;"string"===typeof c&&(c=m(c));return a.replace(/\$\{([^\}]+)\}/g,function(a,l){a=l.split(".");for(var m=b,f=!0,p;a.length;){if(!((p=a.shift())in m)){f=!1;break}m=m[p]}if(!f)if(e)m=d;else throw Error('alp.tmpl(): could not find key "'+l+'" in `data`!');return c?c(m,l,b):m})}function W(a,b,c,d,e,l){l||(l={});for(var m=0;2>m;m++)if(d^m)for(var f in a)f in ca||!a[f]||c(f,a,e);else for(f in a)f in ca||!a[f]||(l.before&&
l.before(f,a),W(a[f][b],b,c,d,f,l),l.after&&l.after(f,a))}if(!alp.and){var Y=alp.Ap=Array.prototype;alp.Apc=Y.concat;alp.Apj=Y.join;var aa=alp.Aps=Y.slice,Z=alp.MAX_N_ARGS=3E4;Y=k.location&&location.protocol;var ba=(/^https?:$/.test(Y)?Y:"http:")+"//",da=/^(\w+:)?\/\//,ca={},fa=[],ka=Object.prototype,ha={},ja={},na={},la={};oaConfig&&z(alpConfig||(alpConfig={}),oaConfig);alp.CODEKILL="\n'\n\"\n/\n*/\n#\n";alp.and=g;alp.andIn=function(b,c,d){var e=typeof c,l="function"===e;e=c?"(v=o[k]),(v=("+("string"===
e?a(c,"v","k"):"v=transform.call(this,v,k)")+"))":"v=o[k]";return u(b,"if("+e+")ret=v;else return false;",{retInit:"true"+(l?", transform = that.transform":"")+", v",that:{transform:l&&c},thisObj:d})};alp.arrChain=function(a){for(var b=[],c=a.length,d=0;d<c;d++){var e=a[d];e.length<Z?b.push.apply(b,e):b=b.concat(e)}return b};alp.arrCumSum=function(a,b){return v(0,"<n","acc=ret[v]=acc+"+(b?"(that[v]"+b+")":"that[v]"),{retInit:"new Array(that.length),n=that.length,acc=0",that:a})};alp.arrEqual=function(a,
b,c){if(!(a&&b&&a.length===b.length&&q(a.length)))return!1;if(c)for(var d=a.length;d--;){if(!c(a[d],b[d]))return!1}else for(d=a.length;d--;)if(a[d]!==b[d])return!1;return!0};alp.arrMinIndex=function(b,c){if(!b||!b.length)return-1;if(c&&"string"===typeof c)return v(b.length,"i--","var v = that[i]; v="+a(c,"v","i")+"; if (v < min_arr_v) ret = i, min_arr_v = v;",{retInit:"-1, min_arr_v = +Infinity",that:b,step:null,ivar:"i"});var d=0;if(c)for(var e=b.length;--e;)c(b[e],e)<c(b[d],d)&&(d=e);else for(e=
b.length;--e;)b[e]<b[d]&&(d=e);return d};alp.arrPermute=function(a,b){var c=a.length;if(c!==b.length)throw Error("alp.arrPermute(): `arr` and `order` must have the same length!");for(var d=Array(c);c--;)d[c]=a[b[c]];return d};alp.arrPushBig=function(a,b){var c=b.length;if(c<Z)a.push.apply(a,b);else for(var d=0,e=Z;d<c;d=e,e+=Z)a.push.apply(a,b.slice(d,e));return a};alp.arrRep=function(a,b){if(!(0<a.length&&0<b))return[];a=[].concat(a);for(var c=[];0<b;){var d=a.length<Z;b&1&&(d?c.push.apply(c,a):
c=c.concat(a));b>>=1;0<b&&(d?a.push.apply(a,a):a=a.concat(a))}return c};alp.arrSorted=function(a,b){b="string"===typeof b?m(b):b;a=[].concat(a);b?a.sort(b):a.sort();return a};alp.arrSortOrder=function(a,b){for(var c=a.length,d=Array(c),e=c;e--;)d[e]=[a[e],e];d.sort(b?function(a,c){return b(a[0],c[0])}:function(a,b){a=a[0];b=b[0];return a<b?-1:a>b?1:0});a=Array(c);var l=Array(c),m={arr:a,order:l};for(e=c;e--;)c=d[e],a[e]=c[0],l[e]=c[1];return m};alp.arrUnpermute=function(a,b){var c=a.length;if(c!==
b.length)throw Error("alp.arrUnpermute(): `arr` and `order` must have the same length!");for(var d=Array(c);c--;)d[b[c]]=a[c];return d};alp.arr2o=function(a,b,c,d){null!=b||(b="id");var e=typeof c,l=/^(string|number)$/.test(typeof b);e=/^(string|number)$/.test(e);for(var m=null!=c,f={},p=a.length,g=0;g<p;g++){var n=a[g];f[l?n[b]:b.call(d,n,g)]=m?e?n[c]:c.call(d,n,g):n}return f};alp.arr2oSimple=function(b,c,d){var e={};if(c)if("function"===typeof c)for(m=b.length;m--;){var l=b[m];e[l]=c.call(d,l,m)}else e=
v("that.length,v","i--","(v=that[i]),(ret[v]=("+a(c,"v","i")+"))",{retInit:"{}",that:b,step:"0",ivar:"i",thisObj:d});else for(var m=b.length;m--;)e[b[m]]=!0;return e};alp.asyncF=function(a,b,c){var d=aa.call(arguments,3),e="string"===typeof b;return function(){var l=d.concat(aa.call(arguments)),m=c||this,f=e?m[b]:b;if(!f)throw Error("alp.asyncF could not determine the final function.");return setTimeout(function(){f.apply(m,l)},a)}};alp.asyncSeq=function(a){function b(){function a(){l||(l=!0,d.shift(),
d.length&&b())}var c=d[0],e=c[1],l;(0,c[0])(a);l||null==e||setTimeout(a,e)}a=I(ia,a,1);var c=D(a,"defaultMaxdelayMs"),d=[];return{next:function(a,e){var l=typeof a;if("string"===l)throw Error("alp.asyncSeq().next(): ever thought of using `nextBind` ?");if("function"!==l)throw Error("alp.asyncSeq().next(): `action` must be a function. You gave a "+l);d.push([a,2>arguments.length?c:e]);1==d.length&&b();return this},nextOptional:function(a,b){return a?this.next(a,b):this},nextBind:function(){return this.next(f.apply(null,
arguments),c)}}};alp.bindF=f;alp.chainF=function(b){function c(a){for(var b=aa.call(arguments,1),c=0;c<e;c++)a=r[c].apply(this,[a].concat(b));return a}var d="object"===typeof b?b:arguments,e=d.length;if(g(d,'typeof v === "string"  ||  v.hasOwnProperty("'+ma+'")')){if(2>e)return l(d[0]);var m=w(d,'"string"===typeof v ? v : v["'+qa+'"]').join("\n'\n\"\n/\n*/\n#\n");if(!ea.hasOwnProperty(m)){for(var f=[],p=0;p<e;p++){var n=d[p];"string"===typeof n?f.push("v="+a(n)+";"):f.push.apply(f,n[pa])}p=ea[m]=
new Function("v","w",f.join("\n")+"return v;\n");p[qa]=m;p[pa]=f;p[ma]=d}d=ea[m]}else{var r=w(d,function(a){return l(a)});e=r.length;d=2>e?r[0]:c}return d};alp.cssBase=y(function(){return b(K("alpConfig.cssBase")||alp.jsBase())});alp.declare=function(a,b,c){var d=a.replace(/\.[^\.]+$/,"");d&&K(d,null,!0);d=e.apply(null,[b,c].concat(aa.call(arguments,3)).concat({declaredClass:a}));d.prototype._alpParentProto=K("parent.prototype",d);return(new Function("ctorF","return "+a+"=ctorF;"))(d)};alp.derive=
e;alp.dflt=m("v!=null ? v : w");alp.e=a;alp.f=m;alp.g=l;alp.filter=d;alp.filterIn=function(a,b,c){"string"===typeof b&&(b=m(b));var d=a instanceof Array?fa:ca,e={},l;for(l in a)if(!(l in d)){var f=a[l];b.call(c,f,l,a)&&(e[l]=f)}return e};alp.fixUrlProtocol=b;alp.forEach=c;alp.forIn=r;alp.fVal=function(a){return a&&a.apply&&"function"===typeof a.apply?a.apply(this,aa.call(arguments,1)):a};alp.hOP=function(a,b){return a.hasOwnProperty(b)};alp.indexOf=function(a,b){if("function"===typeof a.indexOf)return a.indexOf(b);
for(var c=a.length,d=0;d<c;d++)if(a[d]===b)return d;return-1};alp.interpolate=n;alp.isFiniteNumber=q;alp.isInteger=function(a){return a===(a|0)};alp.isJsXd=y(function(){var a=D(alp.jsBase().match(/\/\/([^\/]+)\//),1);return!(!a||!(a!==k.location&&k.location.host||/api.outdooractive.com$/.test(a)))});alp.isNaN=function(a){return"number"===typeof a&&isNaN(a)};alp.jsBase=y(function(){return b(K("alpConfig.jsBase")||"//"+(alp.dev()?alp.dev.isApproval()?"approval":"testing":"www")+".outdooractive.com/")});
alp.jsonpBase=y(function(){var a=K("alpConfig.jsonpBase");a||(a=K("oax.SERVER")||K("oam.SERVER")||(/\.outdooractive\.com/.test(alp.cssBase())?alp.cssBase():alp.jsBase()).replace(/^((?:[^\/]*?:)?\/\/[^\/]*)(?:\/.*)?$/,"$1/"),a=a.replace(/(\/alpportal\/).*?$/,"$1"),/alpportal\/$/.test(a)||(a+="alpportal/"));return b(a)});alp.lastIndexOf=p;alp.loop=v;alp.loopIn=u;alp.loop2arr=function(b,c,d){d=d&&("string"===typeof d?{step:d}:d)||{};var e=(d.prepare?d.prepare+";":"")+"ret.push("+a(d.create)+");",l={retInit:"[]",
that:d.that};"step"in d&&(l.step=d.step);return v(b,c,e,l)};alp.m=t;alp.map=w;alp.mapfilter=x;alp.mapIn=function(a,b,c){"string"===typeof b&&(b=m(b));var d=a instanceof Array?fa:ca,e={},l;for(l in a)l in d||(e[l]=b.call(c,a[l],l,a));return e};alp.mapFlexF=function(a,b,c){var d=new Function("elt_or_arr","var elt = elt_or_arr;\nif ("+a+") return "+b+";\nvar n = elt_or_arr.length\n, ret = new Array(n)\n;\nwhile (n--) {\n    elt    = elt_or_arr[n];\n    ret[n] = "+b+";\n}\nreturn ret;");return function(){return d.apply(c||
this,arguments)}};alp.mapFVal=function(a){for(var b=aa.call(arguments,1),c=a.length,d=Array(c),e=0;e<c;e++){var l=a[e];d[e]="function"===typeof l?l.apply(null,b):l}return d};alp.memF=y;alp.memM=function(a,b,c){return"string"===typeof b?new Function("var ret = "+b+";\n"+(c?"ret"+c+";\n":"")+'return (this["'+a+'"] = function () { return ret; })();'):function(){var c=b.apply(this);return(this[a]=function(){return c})()}};alp.mix=z;alp.mixCheck=function(a,b){for(var c in b)c in a||console.error('alp:mixCheck: You might have misspelled the key "'+
c+'" in the <'+(a.declaredClass||"").replace(/[^\.]*\./g,"")+"> object: ",b,' --- Did you mean "'+P(a,c)+'" instead?');return z(a,b)};alp.o2arr=function(b,c,d){c||(c="[k,o[k]]");var e=[];if("function"===typeof c)for(var l in b)l in ca||e.push(c.call(d,l,b[l]));else u(b,"ret.push("+a(c,"k","v")+");",{retInit:"that",that:e,thisObj:d});return e};alp.oCheckScheme=A;alp.oCopy=C;alp.oCreate=E;alp.oCreateDeepFill=function(a,b){var c=F(b);c=D(a,c,!0);c=C(c);b=G(c,b);return I(a,b)};alp.oCreateMix=I;alp.oDeepFill=
G;alp.oDeepMix=function(a,b){function c(b,c,d,e){b&&"object"===typeof b||(c=e.slice(0,-1),d instanceof Array&&!M(a,c)&&M(a,c,[]),M(a,e,b))}for(var d=arguments.length,e=1;e<d;e++)(b=arguments[e])&&B(b,c);return a};alp.oDeepWalk=B;alp.oDelta=function(a,b,c){var d=[],e=[],l={add:d,del:e};if(c){for(var m in a)m in b&&c(b[m],a[m])||d.push(m);for(m in b)m in a&&c(b[m],a[m])||e.push(m)}else{for(m in a)m in b||d.push(m);for(m in b)m in a||e.push(m)}return l};alp.oDropNaN=L;alp.oDuck=function(a,b){for(var c=
{},d=b.length;d--;){var e=b[d];c[e]=f(e,a)}return c};alp.oEqual=J;alp.oGet=M;alp.oGetDef=function(a,b,c){return M(a,b)||M(a,b,c)};alp.oIsEmpty=function(a,b){if(b)for(var c in a){if(a.hasOwnProperty(c))return!1}else for(c in a)if(!(c in ca))return!1;return!0};alp.oKeyFind=P;alp.oKeyFindGen=H;alp.oKeys=F;alp.opt=D;alp.or=function(b,c,d){var e=b&&b.length;if(!e)return!1;var l=typeof c,m="function"===l;l=c?"(v=arr[i]),(v="+("string"===l?a(c,"v","i"):"v=transform.call(this,v,i)")+")":"v=arr[i]";return v(0,
e,"if("+l+")return v;",{ivar:"i",retInit:"false, arr = that.arr"+(m?", transform = that.transform":"")+", v",that:{arr:b,transform:m&&c},thisObj:d})};alp.orIn=function(b,c,d){var e=typeof c,l="function"===e;e=c?"(v=o[k]),(v=("+("string"===e?a(c,"v","k"):"v=transform.call(this,v,k)")+"))":"v=o[k]";return u(b,"if("+e+")return v;",{retInit:"false"+(l?", transform = that.transform":"")+", v",that:{transform:l&&c},thisObj:d})};alp.oSet=M;alp.oFrom=function(a){if(a)return"object"===typeof a?a:(new Function("return ("+
a+");"))()};alp.oToString=S;alp.oUndefToNull=T;alp.oValues=function(a){var b=[],c=a instanceof Array?fa:ca,d;for(d in a)d in c||b.push(a[d]);return b};alp.ratelimitF=R;alp.ratelimitM=function(a,b,c){c[b]=R(a,b,c)};alp.reduce=Q;alp.sAbsoluteURL=O;alp.sCamel=function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()};alp.sCapitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};alp.sEndsWith=function(a,b){return a.slice(-b.length)===b};alp.sFromCharCode=function(a){for(var b=a.length,
c=[],d=0;d<b;d+=2048)c.push(String.fromCharCode.apply(String,a.slice(d,d+2048)));return c.join("")};alp.simplifyGeom=function(a,b,c){function d(a,b){var c=e(a),d=e(b);c===d&&(c=a,d=b);return-(c-d)}function e(b){if(1>b||b===a.length-1)return Infinity;var c=a[b-1],d=a[b];b=a[b+1];c=[d[0]-c[0],d[1]-c[1]];d=[b[0]-d[0],b[1]-d[1]];return Math.abs(c[0]*d[1]-c[1]*d[0])}try{if(a.length<=b)return a;null==c&&(c=t(alp,"likeIE")?0:.5);var l,m=[];for(l=0;l<a.length;l++)m.push(l);var f=[];0<c&&(m.sort(d),f=m.splice(0,
b*c),m.sort(function(a,b){return a-b}));var p=1*(m.length-1)/(b-f.length);for(l=0;f.length<b&&l<m.length;l+=p)f.push(m[Math.max(0,Math.min(m.length-1,Math.round(l)))]);f.sort(function(a,b){return a-b});f[0]=0;f[f.length-1]=a.length-1;var g=f.length,n=Array(g);for(b=g;b--;)n[b]=a[f[b]];return n}catch(ta){return console.error("alp.simplifyGeom() is returning the *unmodified* geometry because it caught an exception:",ta),a}};alp.sCommonStartLength=function(a,b){for(var c=Math.min(a.length,b.length),
d=0;d<c&&a.charAt(d)===b.charAt(d);d++);return d};alp.sEditDistanceLevenshtein=N;alp.sHash=function(a){for(var b=5381,c=a.length,d=0;d<c;d++){var e=a.charCodeAt(d);b=(b<<5)+b+(e>>2)+((e&3)<<6)}return b};alp.sIsExternalURL=function(a){if(/^#/.test(a))return!1;a=O(a).split("#")[0];var b=location.href.split("#")[0];return a!==b};alp.sPad=X;alp.sRepli=V;alp.sStartsWith=function(a,b){return a.substring(0,b.length)===b};alp.sTime=function(a,b){var c={H:b/60|0,M:b%60|0};return a.replace(/([%$])(\1|(\d+)?([a-zA-Z]))/g,
function(a,b,d,e,l){if(d==b)return d;e||(e=2);return X(c[l],e)})};alp.sTrim=function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")};alp.sub=K;alp.supportsWorker=alp.memF('"undefined"!==typeof Worker&&"undefined"!==typeof Worker.prototype.addEventListener&&"undefined"!==typeof Worker.prototype.postMessage');alp.tmpl=U;alp.tmplJs=function(a,b,c){var d,e=typeof a;if("function"===e)return a(b);"string"===e?d=a:"object"===e?d=a.innerHTML:console.error("alp.tmplJs(): invalid typeof template: "+e);
c||(c=/__(.*?)__/g);return d.replace(c,function(a,c){if(!c)return a;var d=new Function("data",decodeURIComponent("return "+c+";"));try{return d(b)}catch(sa){return console.error('alp.tmplJs() caught e when replacing "'+a+'" with "'+c+'" - IF THIS HAPPENS TOO OFTEN, IT MAY WELL LEAD YOUR BROWSER TO SUCK A LOT OF MEMORY.'),console.error("alp.tmplJs() exception e:",sa),""}}).replace(ua,va).replace(wa,xa)};alp.tmplMatch=function(a,b){a.substring.call.a;b.substring.call.a;var c=0,d={};a="^"+a.replace(/\?|[\(\)]|\$\$|\{\{|\$?(\{(\w+)\})|\}\}/g,
function(a,b,e){if(/^\?|[\(\)]|\$\$|\{\{|\}\}$/.test(a))return"\\"+a.charAt(0);d[e]=""+ ++c;return"(.*?)"})+"$";if(b=b.match(new RegExp(a)))return alp.sub(d,b)};alp.tmplWithoutDollar=function(a,b,c,d){a=a.replace(/\{\{|\{/g,function(a){return"{"===a?"${":a});return U(a,b,c,d)};alp.treeForEach=W;alp.urlCachebust=function(a,b){if(/^[^#]+\?(|[^#]*&)cachebust=[^&]+/i.test(a))return a;b=null!=b?b:K("alpConfig.cachebust")||ra||(ra=(Date.now?Date.now():+new Date)+"."+Math.random());var c=a.indexOf("?"),
d=a.indexOf("#");b="cachebust="+b;return-1<c&&(0>d||c<d)?a.substring(0,c+1)+b+"&"+a.substring(c+1):-1<d?a.substring(0,d)+"?"+b+a.substring(d):a+"?"+b};alp.zip=function(){for(var a=arguments[0].length,b=arguments.length,c=1,d=Array(a),e,l;c<b;a=Math.min(a,arguments[c++].length));for(c=0;c<a;++c){l=Array(b);for(e=0;e<b;l[e]=arguments[e][c],++e);d[c]=l}return d};var ia={defaultMaxdelayMs:null},ea={},ma="_alp_chainF_codestring_src_arr",pa="_alp_chainF_fastcode_arr",qa="_alp_chainF_key",ua=/\x3c!--tmpljs\b([\s\S]*?)--\x3e/g,
va="$1",wa=/\x3c!--(\w+[\s\S]*?)--\x3e/g,xa="<$1>",ra}})("undefined"!==typeof dojo&&dojo&&"global"in dojo&&dojo.global?dojo.global:this);"undefined"!==typeof dojo&&dojo.provide("alp.datetime");
(function(){function k(b){return 0===b%4&&0!==b%100||0===b%400}function h(b,a){a||(a=alp.getDayDate(new Date));return new Date(864E5*b+ +a)}if(!alp.date2str){var g={YYYY:"date.getFullYear()",MM:'alp.sPad( 1+date.getMonth(),2,"0" )',DD:'alp.sPad( date.getDate(),2,"0" )',hh:'alp.sPad( date.getHours(),2,"0" )',mm:'alp.sPad( date.getMinutes(),2,"0")',ss:'alp.sPad( date.getSeconds(),2,"0")',Y:"date.getFullYear()",M:"1+date.getMonth()",D:"date.getDate()",h:"date.getHours()",m:"date.getMinutes()",s:"date.getSeconds()"},
f={YYYY:"date.setFullYear(~~one)",MM:"date.setMonth(-1+~~one)",DD:"date.setDate(~~one)",hh:"date.setHours(~~one)",mm:"date.setMinutes(~~one)",ss:"date.setSeconds(~~one)"},e={};alp.DAY_MILLISECONDS=alp.memF(864E5);alp.date2str=function(b,a,d){b||(b=new Date);null!=a||(a="{YYYY}-{MM}-{DD}T{hh}:{mm}:{ss}");if(d=alp.oCreateMix({relativeDays:null},d).relativeDays){var c=alp.getRelativeDay(b);if(d=d["relativeDay"+c])return d}!1===a&&(a="{date.toDateString()}");return a.replace(/\{[^\}]+\}/g,function(a){a=
a.slice(1,-1);return(new Function("date","return "+(g[a]||a)+";"))(b)})};alp.getDayDate=function(b){b=b?new Date(b):new Date;b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0);return b};alp.getDaysInMonth=function(b,a){return[31,k(b)?29:28,31,30,31,30,31,31,30,31,30,31][a]};alp.getRelativeDay=function(b,a){a||(a=new Date);return Math.round((alp.getDayDate(b)-alp.getDayDate(a))/864E5)};alp.getWeekend=function(b,a){b||(b=new Date);a||(a=0);a=6-b.getDay()+7*a;var c=1+a,d=h(a,b);b=h(c,
b);return{saturdayDate:d,sundayDate:b,saturdayRelDay:a,sundayRelDay:c}};alp.isLeapYear=k;alp.relativeDay2date=h;alp.str2date=function(b,a,d){if(!b)return new Date(NaN);null!=a||(a="{YYYY}-{MM}-{DD}T{hh}:{mm}:{ss}");if(d=alp.oCreateMix({relativeDays:null},d).relativeDays){var c=b.toLowerCase(),m=Infinity,g;for(g in d)if(!(g in e)){var q=alp.sEditDistanceLevenshtein(c,d[g].toLowerCase());if(q<m){m=q;var p=~~g.replace(/^relativeDay/i,"")}}if(null!=p&&3>m)return h(p)}var v=[];a=a.replace(/([\.\(\)])/g,
"\\$1").replace(/\{[^\}]+\}/g,function(a){a=a.slice(1,-1);v.push(new Function("date","one",f[a]||a));return"(\\d+)"});b=(new RegExp(a,"g")).exec(b);var k=new Date(1970,0,1,0,0,0,0);b.splice.a;alp.forEach(b.slice(1),function(a,b){v[b](k,a)});return k};alp.sec2str=function(c){var a=[];a.push(Math.floor(c/d)||null);c%=d;a.push(Math.floor(c/b));c%=b;a.push(Math.floor(c));return alp.map(alp.filter(a,"v !== null"),'alp.sPad(v, 2, "0")').join(":")};alp.isoDuration2seconds=function(b){b=b.match(/^P([0-9]+Y)?([0-9]+M)?([0-9]+D)?T?([0-9]+H)?([0-9]+M)?([0-9]+S)?$/);
var a=0;b[0]&&(a=alp.reduce(alp.map(alp.zip([0,94608E4,2592E3,86400,3600,60,1],alp.map(b,"parseInt(v) || 0")),'alp.reduce( v, "*" )'),"+"));return a};var d=3600,b=60}})();"undefined"!==typeof dojo&&dojo.provide("alp.dev");
(function(){alp.dev&&alp.dev.isApproval||(alp.dev=alp.memF("alp.dev.isApproval()||alp.dev.isTesting()||alp.dev.isLocalhost()||alp.dev.isProto()"),alp.dev.fromAlpConfig=alp.memF('!!alp.sub("alpConfig.dev")'),alp.dev.fromUrlSearch=alp.memF("/[\\?&]dev=\\w+/.test(location.search)"),alp.dev.isApproval=alp.memF('/[\\?&]dev=\\w+/.test(location.search)?/[\\?&]dev=approval\\b/i.test(location.search):/^approval$/i.test(alp.sub("alpConfig.dev"))'),alp.dev.isLocalhost=alp.memF('/[\\?&]dev=\\w+/.test(location.search)?/[\\?&]dev=localhost\\b/i.test(location.search):/^localhost$/i.test(alp.sub("alpConfig.dev"))'),
alp.dev.isProto=alp.memF("/[\\?&]dev=proto\\b/i.test(location.search)"),alp.dev.isTesting=alp.memF('/[\\?&]dev=\\w+/.test(location.search)?/[\\?&]dev=testing\\b/i.test(location.search):/^testing$/i.test(alp.sub("alpConfig.dev"))'))})();"undefined"!==typeof dojo?dojo.provide("alp.event"):"undefined"===typeof alp&&Object.defineProperty(window,"alp",{value:{},writable:!1});
(function(){function k(a,b){a=h(a+" #"+n++,alp.oCreateMix(b||{},{remember:1,oneTimeOnly:1}));a.done=a.triggerSoon;a.isDfrd=!0;return a}function h(a,b){if(!a||"string"!==typeof a)throw Error("alp.event(): missing name string!");b=alp.mixCheck({remember:0,oneTimeOnly:0,then:0},b||{});return new g(a,b)}function g(a,b){Object.freeze&&Object.freeze(b);this.name=a;this.cfg=b;this._q=[];this._once=!1;b.then||(this.then=this.drop=null)}function f(a,b){return function(c){function d(){e.dropSoon(c)}var e=this;
c.call.a;a&&a.call(e,c);return{_alpRemover:b?alp.nowF(d):d}}}function e(a){a instanceof g&&(a=alp.bindF("triggerSoon",a));if("function"!==typeof a)throw Error("alp.event().thenSoon: `callback` must be a callback function or another Event instance!");var c=this._q;c.push(a);this.cfg.remember&&this._last&&(a=c.length,b.call(this,this._last.args,c,a-1,a))}function d(a){for(var b=this._q,c=b.length;c--;)b[c]===a&&b.splice(c,1)}function b(a,c,d,e){for(c=[].concat(c);d<e;){var l=!1;try{alp.nowF(c[d]).apply(this,
a),l=!0}finally{d++,l||b.call(this,a,c,d,e)}}}function c(b,c){return a(b,c).apply(null,r.call(arguments,2))}function a(a,b){if(2>arguments.length&&a.isNow)return a;q=!0;return m(a,b)}function m(a,b){function c(){var c=b||this;c={fun:f?c[a]:a,thisObj:c,args:arguments,todo:[],thisObjName:c&&c.name,todo_i:"not started yet",isNow:e};var m=l.length;c.fun.call.a;if(!m&&!e)throw Error("alp.soonF(): The top-level call must be an `alp.now()` or `alp.nowF()`.");if(e)return d(c);l[m-1].todo.push(c)}function d(a){l.push(a);
a.success=void 0;var b=!1;try{a.todo_i="not yet: still within `fun`";var c=a.fun.apply(a.thisObj,a.args);b=!0;return c}finally{b||(console.error('-- _soon_do: noticed an Error flying by. Consider setting your browser to "Pause on all exceptions".  alp._soon_stack:',l),console.error("-- _soon_do: one.fun:"),console.error(("-- "+a.fun).substring(0,100)+"..."));try{var e=a.todo,m=e.length;for(b=0;b<m;b++)a.todo_i=b,d(e[b]);a.success=!0}finally{a.todo_i="done",a.success=!!a.success,l.pop()}}}var e=q;
e&&(q=!1);if(!a)throw Error("alp.soonF():  invalid fun_or_str!");if(!e&&2>arguments.length&&a.isSoon)return a;var m=typeof a,f="string"===m;if(!f&&"function"!==m)throw Error("alp.soonF():  invalid fun_or_str! Must be a string or a function. "+a);c.isNow=e;c.isSoon=!e;return c}if(!alp.dfrd){alp.dfrd=k;alp.eventCB=function(a,b){return function(){var c="object"===typeof a?a:alp.bindF(a,this)(),d=alp.bindF.apply(alp,arguments);b&&b.then?c.then(d):c.thenSoon(d);d._alpRemover=alp.bindF("dropSoon",c,d);
return d}};alp.eventDropCB=function(a){return function(b){("object"===typeof a?a:alp.bindF(a,this)()).dropSoon(b)}};alp.event=h;alp.gatherDfrd=a(function(a,b){function c(a,b){function c(){l[b]=arguments;m++;m==d&&e.triggerSoon(l)}var f=a&&a instanceof g&&a.isDfrd&&a;f?f.thenSoon(c):c(a)}var d=a.length,e=alp.dfrd("gatherDfrd:"+d,b),l=Array(d),m=0;d?alp.forEach(a,c):e.triggerSoon.call(e,l);return e});alp.now=c;alp.nowF=a;alp.soon=function(a,b){return m(a,b).apply(null,r.call(arguments,2))};alp.soonF=
m;alp.subDfrd=function(a,b,d){function e(){var d=alp.sub(a,b);(p?p(d):d)||null!=f&&(Date.now?Date.now():+new Date)-m>f?c("triggerSoon",l,d):setTimeout(e,100)}var l=k("alp.subDfrd: spec: "+("string"===typeof a?a:a.name?a.name:(""+a).substring(0,100)),{then:1}),m=Date.now?Date.now():+new Date,f=d&&d.maxdelay_ms,p=d&&d.test_fun;"string"===typeof p&&(p=alp.f(p));e();l.thenLater=function(){var a=arguments;alp.now(function(){l.thenSoon.apply(l,a)})};return l};alp.declare("alp.Eh",null,null,{push:function(a){var b=
a&&a._alpRemover?a._alpRemover:a&&a.alp_aEL?alp.rEL:arguments[1]===clearInterval?function(a){clearInterval(a)}:1<arguments.length?alp.bindF.apply(alp,r.call(arguments,1)):dojo.hitch(dojo,"disconnect");this._eh_get().push(alp.bindF(b,null,a));return this},clear:alp.nowF(function(){for(var a=this._eh_get();0<a.length;)a.pop()();return this}),count:function(){return this._eh_get().length},_eh_get:function(){return this._eh=this._eh||[]}});if(alp._soon_stack)throw Error("Please include `alp` code only ONE time in your web page. For example, include the oax API only one time. Not more.");
var l=alp._soon_stack=[],r=alp.Aps,n=0;g.prototype={drop:alp.nowF(d),dropSoon:alp.soonF(d),thenSoon:f(alp.soonF(e)),then:f(alp.nowF(e),!0),triggerSoon:alp.soonF(function(){this.cfg.oneTimeOnly&&this._once||(this.cfg.remember&&(this._last={args:arguments}),this._once=!0,b.call(this,arguments,this._q,0,this._q.length))}),triggered:function(){return this._once},hasListeners:function(){return 0<this._q.length},bindEvent:function(a){return this.thenSoon(alp.bindF("triggerSoon",a))}};var q=!1}})();
"undefined"!==typeof dojo&&dojo.provide("alp.mapany");
(function(){function k(){this.length=0}function h(e,d){var b=this.indexOf(e);if(-1<b){if(this.eq?this.eq(this[b][1],d):this[b][1]===d)return d;this.splice(b,1)}this.push([e,d]);this.change.triggerSoon?this.change.triggerSoon(e):alp.now.trigger(this.change,e);return d}function g(e){var d=this.indexOf(e);if(!(0>d))return d=this.splice(d,1)[0],this.change.triggerSoon?this.change.triggerSoon(e):alp.now.trigger(this.change,e),d[1]}if(!alp.mapany||!alp.mapany.get){alp.sub("alp",null,!0).mapany=function(e,
d){var b=[],c;for(c in f)f.hasOwnProperty(c)&&(b[c]=f[c]);b.change=alp.event("alp.mapany() change",alp.Later&&{passValue:!0});alp.eventCB&&(b.change_cb=alp.eventCB(b.change));if(c=e&&e.length)for(var a=0;a<c;a++){var m=e[a];m&&b.set(m[0],m[1])}d&&(b.eq=d);return b};var f={eq:null,clear:k,clearNow:alp.nowF(k),filter:function(){for(var e=arguments.length&&alp.bindF.apply(alp,arguments),d=[],b=this.length,c=0;c<b;c++){var a=this[c],m=a[1];a=a[0];(e?e(m,a,c):m)&&d.push(a)}return d},forEach:function(){for(var e=
alp.bindF.apply(alp,arguments),d=this.length,b=0;b<d;b++){var c=this[b];e(c[1],c[0],b)}},has:function(e){return-1<this.indexOf(e)},indexOf:function(e){if(this.eq)for(var d=this.length;d--;){var b=this[d];if(this.eq(b[0],e))return d}else for(d=this.length;d--;)if(b=this[d],b[0]===e)return d;return-1},get:function(e){e=this.indexOf(e);return 0>e?null:this[e][1]},keys:function(){for(var e=this.length,d=Array(e);e--;)d[e]=this[e][0];return d},values:function(){for(var e=this.length,d=Array(e);e--;)d[e]=
this[e][1];return d},map:function(){var e=alp.bindF.apply(alp,arguments),d=[];this.forEach(function(b,c,a){d.push(e(b,c,a))});return d},set:h,setNow:alp.Later?h:alp.nowF(h),del:g,delNow:alp.Later?g:alp.nowF(g),change:null,change_cb:null}}})();"undefined"!==typeof dojo?dojo.provide("alp.browser_desperate"):("undefined"===typeof alp&&(alp={}),"undefined"===typeof alp.browser_desperate&&(alp.browser_desperate={}));
(function(k){if(!alp.likeIE){var h=k.navigator?navigator.userAgent:"",g=h.toLowerCase();alp.getAndroidVersion=alp.memF(function(){return parseFloat((h.match(/[\s;]Android\s([\d\.]+)[\s;]/i)||[])[1])||!1});alp.getOsxVersion=alp.memF(function(){return alp.likeOSX()&&parseFloat((h.match(/\sVersion\/([\d\.]+)\s/i)||[])[1])});alp.likeFF=alp.memF(function(){if("function"!==typeof function(){}.toSource)return!1;var f=!alp.likeIE()&&(new Function("if (false) try {}catch(e){function f() {} }; return 'undefined' === typeof f;"))();
!f&&k.document&&(f=document.createElement("div"),f=!("onactivate"in f||"onfocus"in f));return f});alp.likeIE=alp.memF(function(){return alp.likeIE8minus_backslash_v()||alp.likeIE_onactivate()});alp.likeIE_onactivate=alp.memF(function(){return k.document&&"onactivate"in document.createElement("div")});alp.likeIE8minus_backslash_v=alp.memF(function(){return!+"\v1"});alp.likeIE9plus=alp.memF(function(){return alp.likeIE_onactivate()&&!alp.likeIE8minus_backslash_v()});alp.likeMSEdge=alp.memF(function(){return/edge/.test(g)});
alp.likeMobile=alp.memF(function(){return/\b(iPhone|iPad|Android|mobile)\b/i.test(h)});alp.likeMobileOSX=alp.memF(alp.f("alp.likeMobile() && alp.likeOSX()"));alp.likeNativeAndroid=alp.memF(function(){return-1<g.indexOf("mozilla/5.0")&&-1<g.indexOf("android ")&&-1<g.indexOf("applewebkit")&&!(-1<g.indexOf("chrome"))});alp.likeOSX=alp.memF(function(){return/\bMac OS X\b/i.test(h)});alp.likeIE()&&(console.warn||(console.warn=function(){console.log("[WARNING] "+Array.prototype.join.call(arguments," "))}))}})(this);
"undefined"!==typeof dojo&&dojo.provide("alp.xhr");
(function(){function k(e,d,b){(e||null).substring.call.a;(d||null).substring.call.a;b&&b.hasOwnProperty.call.a;var c=alp.opt(b,"sendData"),a=c instanceof String,m=c instanceof Object,l=alp.oCreateMix({async:!0,sendData:null,sendJson:null!==c&&!a,receiveJson:!a,throwError:!0,header:null},b),f=alp.dfrd("alp.xhr (async:"+l.async+")",{then:1}),g=new XMLHttpRequest;b=l.header||{};a={};!l.sendJson||alp.xhr.H_CT in b||(b[alp.xhr.H_CT()]=alp.xhr.H_CT_JSON());!l.receiveJson||alp.xhr.H_ACC in b||(b[alp.xhr.H_ACC()]=
alp.xhr.H_ACC_JSON());g.onreadystatechange=alp.nowF(function(){if(4<=g.readyState){var a=alp.opt(g,"status statusText response responseType responseText responseXML".split(" "));a.getResponseHeader=alp.bindF(g.getResponseHeader,g);a.getAllResponseHeaders=alp.bindF(g.getAllResponseHeaders,g);if(200!==g.status&&0!==g.status){console.error(g.responseText);var b="alp.xhr got error status "+g.status+" when "+e+"ing url "+d;console.error(b);if(l.onerror)l.onerror(g,e,d);if(l.throwError)throw Error(b);}else l.receiveJson&&
(a.responseJson=alp.oFrom(a.responseText));alp.m(f,["done","triggerSoon"],a)}});g.open(e,d,l.async);for(var q in b)q in a||g.setRequestHeader(q,b[q]);c=m?alp.oToString(c):c||null;/^get$/i.test(e)?g.send():g.send(c);return f}alp.xhr=k;alp.xhrCorsGetJson=function(e,d){var b=d&&d.onload,c=d&&d.onerror,a=d&&d.cache;if(a){if(b||c)throw Error("xhrCorsGetJson: with `cache`, please do NOT use `onload` or `onerror`. Prefer the `.then()` syntax.");if(d=f[e])return d}d=alp.dfrd("alp_xhr_cors_get_json",{then:1});
a&&(f[e]=d);a=new XMLHttpRequest;var m=alp.bindF("done",d);m=alp.Later?m:alp.nowF(m);a[h]("load",alp.chainF("{ok:v}",m));a[h]("error",alp.chainF("{error:v}",m));if(b)a[h]("load",b);if(c)a[h]("error",c);a.open("GET",e,!0);a[g]("Accept","application/json");a.send();return d};alp.xhrDelete=alp.bindF(k,null,"DELETE");alp.xhrGet=alp.bindF(k,null,"GET");alp.xhrPut=alp.bindF(k,null,"PUT");alp.xhrPost=alp.bindF(k,null,"POST");alp.xhr.H_CT=alp.memF('"Content-Type"');alp.xhr.H_CT_JSON=alp.memF('"application/json"');
alp.xhr.H_ACC=alp.memF('"Accept"');alp.xhr.H_ACC_JSON=alp.memF('"application/json"');var h="addEventListener",g="setRequestHeader",f={}})();"undefined"!==typeof dojo&&dojo.provide("alp.dom");"undefined"===typeof alp&&(alp={});"undefined"===typeof alp.dom&&(alp.dom={});var oa_jsonp_preload,localStorage,sessionStorage;
(function(k){function h(){D=!0;J();c(R)}function g(a,b){for(var c=arguments.length,d=1;d<c;d++)a.appendChild(arguments[d]);return a}function f(a,b,d,e){function l(){alp.forEach(g,"v._alpRemover( v )")}function m(a,b){return function(c){alp.or(a,function(a){return t(c.target||c.srcElement,a)})&&(c.wheelDelta=40*-c.detail,c.axis===c.VERTICAL_AXIS?c.wheelDeltaY=c.wheelDelta:c.wheelDeltaX=c.wheelDelta,b(c))}}var p=alp.filter(b.split(/\s+/),"");if(1<p.length){var g=alp.map(p,function(b){return f(a,b,d,
e)});p=l}else{b=p[0];p=a instanceof Array?a:"length"in a&&"item"in a&&"number"===typeof a.length&&a.item&&a.item.call&&window!==a&&document!==a&&!(S in a)?a:[a];"mousewheel"!==b||"on"+b in document||(d=m(p,d),p=[document],b="DOMMouseScroll");for(var n=p.length;n--;){var r=p[n];r.addEventListener?r.addEventListener(b,d,e):r.attachEvent?("DOMContentLoaded"===b?window:r).attachEvent(F[b]||"on"+b,d):console.error("alp_aEL failed.",n,arguments)}p=[p,b,d,e]}p.alp_aEL=!0;p._alpRemover=c;return p}function e(){if(O)return O;
var a=document.getElementsByTagName("body");return O=a&&a[0]||document.body||m(document.documentElement||document,function(a){return"body"===a.tagName},!0)}function d(a,b,c,d){if(c&&alp.likeIE8minus_backslash_v())if(/^[^<>]+$/.test(a)){a="<"+a;for(var e in c)e in H||(a+=" "+e+'="'+(c[e]+"").replace(/"/g,'\\"')+'"');c=null;a+=">"}else console.error("alp.cE(): the IE8- workaround needs a simple tag name. Workaround skipped.");a=document.createElement(a);c&&G(a,c);d&&B(a,d);b&&g(b,a);return a}function b(a,
b,c){var d=document;if(null==b)return(d.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"))||[])[1];c||(c={});d=c.expires;if("number"===typeof d){var e=new Date;e.setTime(e.getTime()+864E5*d);d=c.expires=e}d&&d.toUTCString&&(c.expires=d.toUTCString());b=encodeURIComponent(b);a=a+"="+b;var l;b={};for(l in c)l in b||(a+="; "+l,d=c[l],!0!==d&&(a+="="+d));document.cookie=a}function c(a){if(1<arguments.length)var b=arguments;else{if("function"===typeof a){a();
return}b=a}var c=b[0];c=c instanceof Array||isFinite(c.length)&&(0===c.length||c[0].childNodes)?c:[c];var d=b[1],e=b[2];b=b[3];for(var l=c.length;l--;){var m=c[l];m.removeEventListener?m.removeEventListener(d,e,b):m.detachEvent?("DOMContentLoaded"===d?window:m).detachEvent(F[d]||"on"+d,e):console.error("alp_rEL failed.",l,arguments)}}function a(){function b(a){if(c.activeElement===e()){var b=(a=a||d.event)&&(a.target||a.srcElement),m;if(m=b&&!l.test(b.tagName)){a:{m=b;for(var f=/iframe/i;m;){if(f.test(m.tagName)){m=
!0;break a}m=m.parentNode}m=!1}m=!m}m&&alp.redrawIE9(b);return a}}if(alp.likeIE9plus()&&!a.isActive){a.isActive=!0;var c=document,d=window,l=/(html|body|select|option|input|textarea|canvas|svg)/i;f(c,"activate",b);f(c,"deactivate",b);f(c,"click",b);f(c,"mouseover",b);f(c,"mouseout",b);f(c,"mousemove",b);f(c,"mouseenter",b);f(c,"mouseleave",b)}}function m(a,b,c){a=[a];for(var d=[];a.length;){var e=a.pop();if(b(e)){if(c)return e;d.push(e)}for(var l=(e=e.childNodes)&&e.length||0;l--;)a.push(e[l])}if(!c)return d}
function l(a){var b=S in a?[a]:a,c=b.length;for(;c--;)for(var d=b[c];d.lastChild;)d.removeChild(d.lastChild);return a}function r(a){a=a.getBoundingClientRect();"width"in a&&"height"in a||(a=alp.oCreateMix({width:a.right-a.left,height:a.bottom-a.top},a));return a}function n(a,b){b||(b=document);return b[X]?b[X](a):m(b,function(b){return b&&b.id===a},!0)}function q(a,b){b||(b=document);if("string"===typeof a){if(!T&&b.getElementsByClassName)return P.call(b.getElementsByClassName(a));var c=new RegExp("(^|\\s)"+
a+"($|\\s)");return m(b,function(a){return a!==b&&a.className&&c.test(a.className)})}for(var d=[],e=a.length,l=0;l<e;l++){var f=a[l];if(!T&&b.getElementsByClassName)if(f=b.getElementsByClassName(f),null==V)try{d.push.apply(d,f),V=!0}catch(ra){V=!1,d.push.apply(d,alp.Aps.call(f))}else V?d.push.apply(d,f):d.push.apply(d,alp.Aps.call(f));else c=new RegExp("\\b"+f+"\\b"),d.push.apply(d,m(b,function(a){return a!==b&&a.className&&c.test(a.className)}))}return d}function p(a,b){return(b||document).getElementsByTagName(a)}
function v(){return K||(K=document.head||p("head")[0]||m(document,function(a){return a!==document&&/head/i.test(a.tagName)},!0))}function u(a,b,c,e){if(0<e)A(alp.asyncF(e,u,null,a,b,c));else{b||(b="js-delayed");b="string"===typeof b?q(b,c):b;c=b.length;for(e=0;e<c;e++){var l=b[e],m=l.value,f=a?a:/\bjs-delayed-([^j\b\s][^\b\s]*)\b/.exec(l.className)[1];if(m){var p=alp.oFrom(m);"attrMap"in p||"propMap"in p?(m=p.attrMap,p=p.propMap):m=p;l.parentNode.insertBefore(d(f,null,m,p),l);l.parentNode.removeChild(l)}}return b}}
function t(a,b,c){if(!a||!b)throw Error("alp.isDescendant(node, ancestor): Both `node` and `ancestor` must be provided!");if(!("parentNode"in b)){for(var d=b.length,e=0;e<d;e++)if(t(a,b[e],c))return!0;return!1}return a===b?!c:b.contains(a)}function w(){return"rtl"===alp.gA(document.documentElement,"dir")}function x(a,b){function c(a){g.done(a)}function e(){var a=r[f];a&&"object"===typeof a?g.done(a):setTimeout(e,100)}function l(){n=d("script",v(),{type:"text/javascript",src:p,async:"async"})}a=alp.fixUrlProtocol(a);
var m=a.split("?");a=m[0];m=m.slice(1).join("?").split("&").sort().join("&");var f=a+(m?"?"+m:"");if((b=b&&b.cache)&&f in Y)return Y[f];for(a=alp.sHash(f);a in x;)a++;f.replace(/\/jsonp([\/?])/,"$1");var p=f+(/\?/.test(f)?"&":"?")+"callback=alp.jsonp["+a+"]",g=alp.dfrd("jsonp["+a+']:url:"'+f+'"',{then:1}),n;b&&(Y[f]=g);m=alp.Later?c:alp.nowF(c);x[a]=m;a=!1;if(b){var r=oa_jsonp_preload;r&&r[f]&&(e(),a=!0)}a||(alp.likeIE8minus_backslash_v()?A(l):l(),alp.m(g,["then","to"],function(){n&&C(n)}));g.to&&
(g.to=alp.asyncF(0,g.to,g));return g}function y(){if(null==Z){Z=!1;try{var a=localStorage;ba in a&&delete a[ba];ba in a||(a[ba]="123456","123456"===a[ba]&&(delete a[ba],Z=!(ba in a)))}catch(pa){console.warn("---------- alp.localStorage: DOM storage not supported, not activated, or read-only (e.g. Safari in private mode), see #10572. ----------")}}return!0===Z&&(a=(new Function("try { return localStorage; } catch (e) { console.error( 'WTF alp.localStorage()? ' + e ); }"))())?a:null}function z(a,b){a.childNodes.a;
null==b||b.childNodes.a;if(b)return b=(a=z(a))&&z(b),a&&b&&{offsetLeft:a.offsetLeft-b.offsetLeft,offsetTop:a.offsetTop-b.offsetTop};if(a.offsetParent){var c=b=0;do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{offsetLeft:b,offsetTop:c}}}function A(a){M.push(a);J();return{_alpRemover:function(){for(var b=M.length;b--;)a===M[b]&&M.splice(b,1)}}}function C(a){var b=S in a?[a]:a,c=b.length;for(;c--;){var d=b[c],e=d.parentNode;e&&e.removeChild(d)}return a}function E(a,b,c){c||(c="first");
var d="string"===typeof c,e=S in a?[a]:a,l=d&&ha[c.toLowerCase()],m=e.length,f=0;for(;f<m;f++){var p=e[f];if(d)if(l===ca||l===da&&!b.firstChild)b.appendChild(p);else if(l===da)b.insertBefore(p,b.firstChild);else if(l===fa)b.parentNode.insertBefore(p,b);else if(l===ka)b.nextSibling?b.parentNode.insertBefore(p,b.nextSibling):b.parentNode.appendChild(p);else throw Error('alp.place(): unknown position string "'+c+'". Please use "first", "last", "before" or "after".');else(p=b.childNodes[c])?b.insertBefore(a,
p):b.appendChild(a)}return a}function G(a,b,c){var d=S in a?[a]:a;if(2<arguments.length)for(var e=d.length;e--;)d[e].setAttribute(b,""+c);else for(e=d.length;e--;){var l=d[e],m;for(m in b)m in H||l.setAttribute(m,""+b[m])}return a}function B(a,b,c){var d=S in a?[a]:a;if(2<arguments.length)for(var e=d.length;e--;)d[e][b]=c;else for(e=d.length;e--;){var l=d[e],m;for(m in b)m in H||(l[m]=b[m])}return a}function I(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;if(a.preventDefault)a.preventDefault();
else{a.bubbledKeyCode=a.keyCode;if(a.ctrlKey)try{a.keyCode=0}catch(pa){}a.returnValue=!1}}function L(a){return/^#text$/i.test(a.nodeName)?a.data:null!=a.textContent?a.textContent:a.innerText}function J(a){if(!a){if(ea)return;ea=!0}if(D)for(;M.length;){a=!1;try{M.shift()(),a=!0}finally{a||J(!0)}}ea=!1}if(!alp.onDCL){var P=alp.Aps,H={},F={DOMContentLoaded:"onload"};k=document.readyState;var D=document.body&&("interactive"===k||"complete"===k),M=[],R=!D&&f(document,"DOMContentLoaded",alp.Later?h:alp.nowF(h)),
S="childNodes",T=!0;try{var Q=document.createElement("div");Q.innerHTML="<svg></svg>";Q.getElementsByClassName("xyz");T=!1}catch(ma){}alp.aC=g;alp.aEL=f;alp.aELdblrightclick=function(a,b,c,d){var e=d&&d.delay_ms||500,l=d&&d.do_not_stop_event,m,p=Infinity;return f(a,"contextmenu",function(a){a||(a=window.event);if(2===a.button){l||I(a);var c=Date.now?Date.now():+new Date,d=c-m;c-m<e&&!(3*d>p)?(b(a),m=null):m=c;p=d}},c)};alp.autoRedrawIE9plus=a;alp.body=e;alp.cE=d;alp.children=function(a){return a.children||
alp.filter(a.childNodes,".tagName")};alp.cookie=b;alp.cookie.isSupported=function(){"cookieEnabled"in navigator||(this("__alpCookieTest__","CookiesAllowed"),navigator.cookieEnabled="CookiesAllowed"==this("__alpCookieTest__"),navigator.cookieEnabled&&this("__alpCookieTest__","",{expires:-1}));return navigator.cookieEnabled};alp.cTxN=function(a,b){a=document.createTextNode(""+a);b&&g(b,a);return a};alp.dataset=function(a){return a.dataset||a._alpDataset||(a._alpDataset={})};alp.domWalkSelect=m;alp.empty=
l;alp.ensureCss=function(a,b,c){function e(){E(l,v(),"first")}a=alp.urlCachebust("string"===typeof a?a:a.call(b));c||(c=a);w()&&(a=a.replace(".css",".rtl.css"));var l=N[c]||(N[c]=d("link",null,{rel:"stylesheet",type:"text/css",href:a}));l.getAttribute("href")!==a&&G(l,"href",a);if(!l.parentNode)alp.onDCL(e);return l};alp.gA=function(a,b){return a.getAttribute(b)};alp.gBCR=r;alp.gEBI=n;alp.gEBCN=q;alp.gEBTN=p;alp.gViewportSize=function(){return{width:Math.max(document.documentElement.clientWidth,window.innerWidth||
0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}};alp.gWindowScroll=function(){var a=window;if("number"===typeof a.pageXOffset&&"number"===typeof a.pageYOffset)return{left:a.pageXOffset,top:a.pageYOffset};var b=document.documentElement||e().parentNode;return b&&(b={left:"number"===typeof b.scrollLeft?b.scrollLeft:e().scrollLeft,top:"number"===typeof b.scrollTop?b.scrollTop:e().scrollTop},"number"===typeof b.left&&"number"===typeof b.top)?b:{left:a.scrollX,top:a.scrollY}};
alp.hA=function(a,b){return a.hasAttribute?a.hasAttribute(b):null!=a.getAttribute(b)};alp.hasClass=function(a,b){return a.classList?a.classList.contains(b):(new RegExp("\\b"+b+"\\b")).test(a.className)};alp.hasEmptyBCR=function(a){a=r(a);return 0===a.width&&0===a.height};alp.head=v;alp.htmlCut=function(a,b,c){if(!a)return"";c=alp.oCreateMix({return_domnode:!1,html_cut:"...",collapse_spaces:!0},c);a="string"===typeof a?d("span",0,0,{innerHTML:a}):a;var e=c.collapse_spaces?L(a).replace(W," "):L(a);
if(e.length<b)return c.return_domnode?a:a.innerHTML;b-=c.html_cut.length;e=a.innerHTML;for(var l=e.match(U),m=e.split(U),f="",p=0,g=m.length,n=0;n<g&&p<b;n++){0<n&&(f+=l[n-1]);var r=f.length;e=m[n];f=c.collapse_spaces?f.slice(0,-1)+(f.slice(-1)+e).replace(W," "):f+e;p+=f.length-r}e=b-p;0>e&&(f=f.slice(0,e));f=d("div",0,0,{innerHTML:f}).innerHTML;f+=c.html_cut;return c.return_domnode?d(a.tagName,0,0,{innerHTML:f}):f};alp.html2text=function(a){return L("string"!==typeof a?a:d("div",null,null,{innerHTML:a})).replace(/\s+/g,
" ")};alp.imgPreload=alp.memF("alp.cE('img',alp.imgPreload.container(),{src:img_url})","img_url");alp.imgPreload.container=alp.memF("alp.cE('div',alp.body(),{style:'display:none', 'class':'img-preload-container'})");alp.installNode=u;alp.isDCL=function(){return!!D};alp.isDescendant=t;alp.isRTL=w;alp.jsonp=x;alp.localStorage=y;alp.locStoCookie=function(a,c){var d=null==c,e=y(),l=b.isSupported();return d?e?e[a]:l?b(a):null:e?(e[a]=c,!0):l?(b(a,c,{path:"/",expires:99999}),!0):!1};alp.newId=function(a,
b){a||(a="alp");for(var c=null;;){var d=a+(null==c?"":c);if(!n(d,b))return d;null==c?c=0:c++}};alp.nodify=function(a,b){function c(a){return(a=a.className)&&d.test(a)}b||(b=document);if("string"!==typeof a)b=a;else{if(aa in b&&"function"===typeof b[aa])b=b[aa]("."+a);else if(!T&&"getElementsByClassName"in b&&"function"===typeof b.getElementsByClassName)b=b.getElementsByClassName(a)[0];else{var d=new RegExp("(?:^|\\s)"+a+"(?:\\s|$)");b=m(b,c,!0)}b||(b=n(a))}b&&b.childNodes.length;return b};alp.nodelist=
function(a,b){if(!a)return[];if("string"!==typeof a)return S in a?[a]:a;var c=a.charAt(0),d="#"===c;c="."===c;a=a.substring(d||c?1:0);var e=[];c||(c=n(a))&&e.push(c);d||e.push.apply(e,q(a,b));return e};alp.notIframe=alp.memF("window.parent===window");alp.offset=z;alp.onDCL=A;alp.orphan=C;alp.outerHTML=function(a){return"outerHTML"in a?a.outerHTML:g(d("div"),a.cloneNode(!0)).innerHTML};alp.place=E;alp.qS=function(a,b){return(b||document).querySelector(a)};alp.qSA=function(a,b){return(b||document).querySelectorAll(a)};
alp.rEL=c;alp.redrawIE9=function(a){function b(){var b=a.style.visibility;a.style.visibility="hidden";a.offsetWidth;a.offsetHeight;a.style.visibility=b;a.offsetWidth;a.offsetHeight}if(alp.likeIE9plus()&&a&&a!==window&&"tagName"in a&&"style"in a)return alp.util&&alp.util.asyncHitch?alp.util.asyncHitch(b,null,37)():setTimeout(b,37),a};alp.rA=function(a,b){var c=S in a?[a]:a,d=c.length,e=0;for(;e<d;e++)c[e].removeAttribute(b);return a};alp.rC=function(a,b){a.removeChild(b);return a};alp.resetFormPart=
function(a){var b="parentNode"in a?[a]:a,c=b.length,e=0;for(;e<c;e++){var l=b[e],m=l.parentNode,f=l.nextSibling;g(d("form"),l).reset();m.insertBefore(l,f)}return a};alp.sA=G;alp.setProp=B;alp.setClass=function(a,b,c){var d=S in a?[a]:a,e=3>arguments.length?"object"===typeof b?b:null.objectExpected:b instanceof Array?alp.map(b,"[v,"+c+"]"):[[b,c]],l=e instanceof Array,m=l?alp.map(e,"v[0]"):alp.oKeys(e),f=1===m.length&&d.length&&d[0].classList,p=f&&m[0],g=f&&(l?e[0][1]:e[p]),n=d.length,r=0;for(;r<n;r++){var q=
d[r];if(f)if(g)q.classList.contains(p)||q.classList.add(p);else for(;q.classList.contains(p);)q.classList.remove(p);else{for(var v=q.className,h=v,k=m.length,w=0;w<k;w++){var x=m[w],t=l?e[w][1]:e[x],u;if("string"!==typeof x)var y=u=x;else x in ja?(y=ja[x],u=na[x]):(u="(^|\\s)"+x.replace(/\*/g,"[\\S]*")+"(?=$|\\s)",y=ja[x]=new RegExp(u),u=na[x]=new RegExp(u,"g"));t?y.test(h)||(h+=" "+x):h=h.replace(u,"")}h=h.replace(/(^\s+|\s+$)/g,"").replace(/\s+/g," ");h!=v&&(q.className=h)}}return a};alp.setOpacity=
function(a,b){var c=S in a?[a]:a;if(alp.supportsStyleOpacity())for(var d=c.length;d--;)c[d].style.opacity=b;else if(alp.supportsStyleFilter()&&alp.supportsStyleZoom())for(b="alpha(opacity="+~~(100*b)+") ",d=c.length;d--;){var e=c[d].style;e.filter=b+e.filter.replace(/\balpha\s*\(\s*opacity\s*=\s*[^)]*\)/gi,"");e.zoom=1}return a};alp.setText=function(a,b,c){b=""+b;var d=S in a?[a]:a,e=d.length;for(;e--;){var m=d[e];if(c||L(m)!==b)l(m),"textContent"in m?m.textContent=b:m.innerText=b}return a};alp.show=
function(a){var b=S in a?[a]:a,c=b.length,d=0;for(;d<c;d++){var e=b[d],l=e.style,m="none"===l.display,f="hidden"===l.visibility;if(!m||!f)if(e=window.getComputedStyle?window.getComputedStyle(e,""):e.currentStyle)m=m||"none"===e.display,f=f||"hidden"===e.visibility;m&&(l.display="");f&&(l.visibility="visible")}return a};alp.stopEvent=I;alp.style=function(a,b){if(2<arguments.length){var c=b,d=arguments[2];b={};b[c]=d}var e=S in a?[a]:a,l=e.length,m=0;for(;m<l;m++){var f=e[m].style;for(c in b)c in H||
(d=b[c],f[c]!==d&&(f[c]=d))}return a};alp.sessionStorage=alp.memF(function(){if(null==la){la=!1;try{var a=sessionStorage;ia in a&&delete a[ia];ia in a||(a[ia]="123456","123456"===a[ia]&&(delete a[ia],la=!(ia in a)))}catch(pa){console.warn("---------- alp.sessionStorage: DOM storage not supported, not activated, or read-only (e.g. Safari in private mode), see #10572. ----------")}}return!0===la&&(a=(new Function("try { return sessionStorage; } catch (e) { console.error( 'WTF alp.sessionStorage()? ' + e ); }"))())?
a:null});alp.supportsCORS=alp.memF(function(){var a=location.search.match(/[\?&]cors=(0|1)/);if(a)return"1"===a[1];a=!1;try{var b=new XMLHttpRequest;b.addEventListener&&b.setRequestHeader&&(b.open("GET","//___"+location.hostname.replace(/\./g,"")+"someotherdomain___.com/xyz",!0),b.setRequestHeader("Accept","application/json"),a=!0)}catch(qa){}return a});alp.supportsInputNumber=alp.memF(function(){try{var a=d("input",null,{type:"number",min:0,max:10,step:1,value:5});if(!/^number$/i.test(a.type))return!1;
a.stepUp&&a.stepUp();return"6"===a.value&&6===a.valueAsNumber}catch(pa){}return!1});alp.supportsStyleFilter=alp.memF('"filter"  in alp.cE("div").style');alp.supportsStyleOpacity=alp.memF('"opacity" in alp.cE("div").style');alp.supportsStyleZoom=alp.memF('"zoom"    in alp.cE("div").style');alp.textContent=L;var O,N={},X="getElementById",V,K,U=/<[^<>]+>/g,W=/[\s\r\n]+/g,Y={},aa="querySelector",Z,ba="_alp_loSto_write_test",da=0,ca=1,fa=2,ka=3,ha={first:da,last:ca,before:fa,after:ka},ja={},na={},la,ia=
"_alp_seSto_write_test",ea}})(this);"undefined"!==typeof dojo&&dojo.provide("alp.i18n");
(function(){function k(a){if("alp.all"===a)return h(a);var b=a.split(/\.(?=[^\.]*$)/),c=alp.dfrd("alp.i18n.fetch: dojo inform",{then:1});dojo.requireLocalization(b[0],b[1]);alp.installLocalization(b[0],b[1]);dojo.i18n.whenLocalization(b[0],b[1]).then(function(){alp.now("triggerSoon",c,alp.sub(a+".i18n"))});return c}function h(b){var c="alp.all"===b?a:null;c||(r[b]=1);g(c);return p(b)}function g(a){null==q&&(q=setTimeout(function(){q=null;e(a)},100))}function f(){return v||(v=(alp.sub("alpConfig.language")||
alp.sub("dojo.locale")||alp.sub("djConfig.locale")||alp.sub("navigator.language")||"de").replace(/^(.+)-(.+)$/,"$1"))}function e(b){var c=alp.i18n.language().split("-")[0].toLowerCase(),d=(/redbullxalps\.com$/.test(location.hostname)?"//rb3.oastatic.com/":alp.jsonpBase())+"i18n.jsonp",l=n["alp.all"];if(b===a)l||(b=alp.newId("alp-i18n-jsonp-alp-all-"),n["alp.all"]=b,alp.cE("script",alp.head(),{type:"text/javascript",src:alp.urlCachebust(d+"?lang="+c+"&callback=alp.i18n.__storeAll",+new Date/18E5|0),
id:b,onerror:"alp.i18n.__storeAll({ status: 'error' , msg : 'Cannot load ressources!' , code : '404' })"})),e();else{"alp.all"in r&&!l&&e(a);l=[];b=alp.newId("alp-i18n-jsonp-");for(var m in r)m in n||(l.push(m),n[m]=b);l.sort();if(m=l.join(","))"en"!=c&&(c="en,"+c),alp.cE("script",alp.head(),{type:"text/javascript",src:alp.urlCachebust(d+"?lang="+c+"&q="+m,+new Date/18E5|0),id:b})}}function d(a){function c(){var b=alp.gEBI(n[a]);b&&alp.orphan(b)}var d=(alp.sub("alpConfig.i18n")||{})[a]||{},e=alp.Aps.call(arguments,
1);if(alp.and(e,".ok")){if(!alp.and(e,'.name==="'+a+'"'))throw Error("alp.i18n: the backend must be buggy!");for(var l,m=e.length,f=0;f<m;f++){var g=e[f];l=l?alp.oCreateMix(l,g.data):g.data}l=alp.oCreateMix(l,d,1);b(p(a),l,alp.oCreateMix(g,{data:l}));setTimeout(c)}else console.error("alp.i18n._store('"+a+"', answer): received an error: ",e[0],e),b(p(a),null,g)}function b(a){var b=alp.Aps.call(arguments,1);alp.Later?a.done.apply(a,b):alp.now.apply(alp,["triggerSoon",a].concat(b))}function c(a,b){b=
alp.filter(alp.map(b,function(b){var c=b[0];/^\d+$/.test(c)&&(c+="===");c=alp.g(c);c="function"===typeof c?c:alp.f("false");return c(a)?b:null}),"!== null");return b[0]&&b[0][1]?alp.tmpl(b[0][1],{n:b[0][2]||a}):""}var a={"alp.all":1};"undefined"===typeof alp&&Object.defineProperty(window,"alp",{value:{},writable:!1});if(!alp.i18n||!alp.i18n.fetch){var m=alp.i18n||(alp.i18n={});m.useComma=alp.memF("!/^(en|zh|cn)/i.test( alp.i18n.language() )");m.dotComma=function(a){null==l&&(l=m.useComma());a=""+
a;return l?a.replace(".",","):a};m.thousandSep=function(a){null==l&&(l=m.useComma());return(""+a).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+(l?".":","))};var l;"undefined"!==typeof dojo&&dojo.i18n&&dojo.i18n.whenLocalization&&!alp.isJsXd()&&(m.fetch=k,m.language=alp.memF("dojo.locale"));m.fetch||(m.fetch=h,m.language=f,m.n2str=c);var r={},n={},q,p=alp.memF('alp.dfrd("alp.i18n reception", { then: 1 })',"dotted_name"),v;m.__store=d;m.__storeAll=function(a){a&&/^ok$/i.test(a.status)?d("alp.all",{ok:1,name:"alp.all",
lang:a.lang,data:a.data}):(console.error("alp.i18n.__storeAll received an error with status '"+(a&&a.status+"', o:",a.msg||a)),b(p("alp.all"),null,a))}}})();"undefined"!==typeof dojo&&dojo.provide("alp.browser_vendor");
(function(){function k(b,c,a){b=b.style;if(c in b)return c;for(var d=c.charAt(0).toUpperCase()+c.slice(1),e=h.length;e--;){var f=h[e],g=f+d;if(g in b)return a?"-"+f+"-"+c:g}}if(!alp.vStyle){alp.supportsCSSGradient=function(){if(null==e){var b=("background-image:-webkit-gradient(linear,left top,right bottom,from(#9f9),to(white));background-image:"+" -webkit- -moz- -o- -ms- ".split(" ").join("linear-gradient(left top,#9f9, white);background-image:")).slice(0,-17),c=document.createElement("div");c.style.cssText=
b;e=!!~(""+c.style.backgroundImage).indexOf("gradient")}return e};alp.supportsCSSTransition=function(){return null!=d?d:d=k(alp.cE("div"),"transition")||!1};alp.supportsHistory=alp.memF(function(){return"undefined"!==typeof history&&"number"===typeof history.length&&"function"===typeof history.pushState&&"function"===typeof history.back&&"function"===typeof history.replaceState});alp.supportsSVGInline=alp.memF(function(){var b=alp.cE("div",0,0,{innerHTML:"<svg/>"});return f===(b.firstChild&&b.firstChild.namespaceURI)});
alp.transitionEndName=alp.memF(function(){return{webkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[alp.supportsCSSTransition()]});alp.vendor=k;alp.vStyle=function(b,c){"object"===typeof c||null.wrong_type;var a=b.style,d;for(d in c)d in g||(a[k(b,d)||d]=c[d]);return b};var h=["Khtml","O","ms","Moz","webkit"],g={},f="http://www.w3.org/2000/svg",e,d}})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.textnode");
"undefined"===typeof alp&&Object.defineProperty(window,"alp",{value:{},writable:!1});alp.dom||(alp.dom={});
(function(){function k(e,d){var b=1+e.value.match(f).length;e.scrollTop=Math.round((1+d)/b*(e.scrollHeight-e.offsetHeight));return e}function h(e,d,b){b=null==b?d:Math.min(b,e.value.length);if(e.setSelectionRange)e.setSelectionRange(d,b);else if(e.createTextRange){var c=e.createTextRange();c.moveStart("character",d);c.moveEnd("character",b);c.select()}else"undefined"!==typeof console&&console.error&&console.error("DOM_setSelectionRange() could not find DOM support for node:",e);return e}if(!alp.dom.scrollToLine){var g=
alp.dom;g.scrollToLine=k;g.selectAndScroll=function(e,d,b){null==b&&(b=d);h(e,d,b);(d=e.value.substring(0,d).match(f))&&k(e,d.length)};g.setSelectionRange=h;var f=/(\r\n|\n\r|\n|\r)/g}})();"undefined"!==typeof dojo&&dojo.provide("alp.humane._core");
(function(){function k(g){g=alp.cssBase()+"alp/humane/themes/"+(g||"oa-neutral")+".css";alp.ensureCss(g,null,"alp.humane: css node")}"undefined"===typeof alp&&Object.defineProperty(window,"alp",{value:{},writable:!1});if(!alp.humane||!alp.humane.theme){(function(){function g(){if(!g.done){n=alp.cE("div",null,{id:"humane","class":"humane"});if(!alp.supportsCSSTransition()||alp.likeNativeAndroid())b=a,alp.setOpacity(n,0);g.done=!0;e();alp.asyncF(250,"place",alp)(n,alp.body())}}function f(){alp.rEL(m.body,
"mousemove",f);alp.rEL(m.body,"click",f);alp.rEL(m.body,"keypress",f);alp.rEL(m.body,"touchstart",f);l=!1;r&&b(0)}function e(){function a(){l||(alp.aEL(m.body,"mousemove",f),alp.aEL(m.body,"click",f),alp.aEL(m.body,"keypress",f),alp.aEL(m.body,"touchstart",f),l=!0,h.waitForMove||f())}if(!r||h.forceNew)if(v.length){r=!0;null!=p&&(clearTimeout(p),p=null);p=Infinity!==h.timeout&&setTimeout(a,h.timeout);var c=v.shift();q=c.cfg.target||n;q=d(q);q.innerHTML=c.html;if(c.cfg.target){var e={humane:!0};c.cfg.extraClass&&
alp.forEach(c.cfg.extraClass.split(" "),"this[v] = true",e);e["humane-inplace"]=!0;e.oax_no_display=!1;alp.setClass(q,e)}else q.className="humane "+c.cfg.extraClass;setTimeout(alp.bindF(b,null,1),100)}else f()}function d(a){alp.hasClass(a,"humane")||(a=alp.hasClass(a.nextSibling,"humane")?a.nextSibling:alp.place(alp.cE("p",null,{"class":"humane"}),a,"AFTER"));return a}function b(a){1===a?(alp.setClass(q,{humane:1,"humane-show":1}),alp.setClass(alp.body(),"humane-show-body",!0)):(alp.setClass(q,{humane:1,
"humane-show":0}),c())}function c(){r=!1;setTimeout(e,500);alp.setClass(alp.body(),"humane-show-body",!1)}function a(a){function b(){1>e?(e+=.1,1<e&&(e=1),alp.setOpacity(q,u=e)):(clearInterval(t),alp.setClass(q,"humane-show",!0))}function d(){0<e?(e-=.1,0>e&&(e=0),alp.setOpacity(q,u=e)):(clearInterval(t),q.style.visibility="hidden",alp.setClass(q,"humane-show",!1),c())}clearInterval(t);if(1===a){var e=0;h.forceNew&&(e=u||e);q.style.visibility="visible";q.style.transform="none";t=setInterval(b,25);
alp.setClass(alp.body(),"humane-show-body",!0)}else e=1,t=setInterval(d,25)}h=alp.humane=function(a,b){var c={extraClass:"",target:null};b&&alp.mixCheck(c,b);g();v.push({html:a,cfg:c});g.done&&e()};h.remove=f;h.theme=k;h.timeout=4E3;h.waitForMove=!0;h.forceNew=!0;var m=document,l=!1,r=!1,n,q,p,v=[];alp.onDCL(g);var u,t})();k();var h}})();"undefined"!==typeof dojo&&dojo.provide("alp.view.tooltip");"undefined"===typeof alp&&(alp={});"undefined"===typeof alp.view&&(alp.view={});
(function(){function k(a){a||(a=window.event);(a=a.target||a.srcElement)&&alp.hasClass(a,"alp-view-tooltip-close")&&c()}function h(a){for(var b in r)if(!(b in l)){var c=r[b];if(c){alp.rEL(c.node,c.dom_event_open,c.listener_f,!1);try{delete c.node[q]}catch(z){c.node[q]=null}!a&&c.extracted_a_string&&c.unextract_f(c.node,c.extracted)}delete r[b]}}function g(a){a.isOpenState.get()?v!==a.tooltip_dom_node&&(c(),e(a)):v===a.tooltip_dom_node&&c(a)}function f(a){a||(a=window.event);for(var b=a.target||a.srcElement,
d=b[q];null==d&&(b=b.parentNode);)d=b[q];b=r[d];if(!b)console.error("alp.view.tooltip: onopen failed to fetch cache information for event:",a);else if(!b.only_when_f||b.only_when_f(b.node))if(b.open_toggle&&v&&v===b.tooltip_dom_node)c(b);else{if(b.preventDefault)if(p in a&&"function"===typeof a[p])a[p]();else a.returnValue=!1;b.extracted_a_string&&!b.html&&(b.extracted_a_string?(a=b.extracted,a=(d=b.transform_f)?d(a):a):a=void 0,b.html=a);e(b)}}function e(b){function e(){v&&v===b.tooltip_dom_node&&
b.place_f(t,v,b.min_width,b.x_prop)}c(b);a(u);u=b;if(b.extracted_a_string){if(b.html){v=document.createElement("div");v.className=b.className;v.innerHTML=b.html;var l=!0}}else b.extracted&&(v=b.extracted,l=!0);b.tooltip_dom_node=v;l&&(t=b.node,e(),setTimeout(e,178),d(b))}function d(a){var c=document.documentElement||alp.body();a.dom_event_close&&alp.aEL(c,a.dom_event_close,b,!1);alp.setClass(t,a.openClassName,!0);a.show_f(v);a.isOpenState&&a.isOpenState.setNow(!0)}function b(a){a||(a=window.event);
var b=alp.isDescendant(a.target||a.srcElement,v),d=u;if(!b){b=v.getBoundingClientRect();var e=t.getBoundingClientRect(),l=a.clientX;a=a.clientY;var m=d.tolerance_x,f=d.tolerance_y;e=e.left-m<=l&&l<=e.right+m&&e.top-f<=a&&a<=e.bottom+f;b=b.left-m<=l&&l<=b.right+m&&b.top-f<=a&&a<=b.bottom+f||e}(!b||d.only_when_f&&!d.only_when_f(d.node))&&c(d)}function c(c){c||(c=u);if(v){var d=c;d.hide_f(v);alp.setClass(t,d.openClassName,!1);var e=document.documentElement||alp.body();d.dom_event_close&&alp.rEL(e,d.dom_event_close,
b,!1);a(d)}v=null;a(c)}function a(a){a&&a.isOpenState&&a.isOpenState.setNow(!1)}if(!alp.view.tooltip||!alp.view.tooltip.clear_all){alp.autoRedrawIE9plus();var m=alp.nowF(function(b){b=1===arguments.length?arguments[0]:arguments[1];var c=alp.oCreateMix(m.default_cfg,b),d=c.select&&("function"===typeof c.select?c.select():c.select instanceof Array?c.select:[c.select]);if(d)for(var e=d.length,l=0;l<e;l++){var p=d[l],v=c;if(q in p){var h=p[q],k=null!=h&&h in r&&r[h];k&&(alp.rEL(p,k.dom_event_open,k.listener_f,
!1),a(k))}null==h&&(h=n++);k=r[h]=alp.oCreateMix(v,{node:p,listener_f:f});k.extracted="function"===typeof k.extract?k.extract(k.node):k.extract;k.extracted_a_string="string"===typeof k.extracted;k.extracted_a_string||(v=k.extracted,k.extracted=alp.cE("div",null,{"class":k.className}),alp.aC(k.extracted,v),"none"===v.style.display&&(v.style.display=""));p[q]=h;alp.aEL(p,k.dom_event_open,k.listener_f,!1);k.isOpenState&&k.isOpenState.change_cb(g,null,k)}alp.ensureCss(c.css_url,c);return d});alp.view.tooltip=
m;m.clear_all=h;m.close=c;m.default_cfg={select:function(){var a=alp.body();var b=a.querySelectorAll?a.querySelectorAll("[title]"):alp.domWalkSelect(a,function(a){return!!(a&&a.getAttribute&&a.getAttribute("title"))});a=alp.gEBCN("alp-view-tooltip-ref");for(var c=b.length,d=a.length,e=Array(c+d),l=c;l--;)e[l]=b[l];for(b=d;b--;)e[c+b]=a[b];return e},extract:function(a){if(alp.hA(a,"title")){var b=""+a.getAttribute("title");a.removeAttribute("title")}else if(b=alp.gEBCN("hidden-alp-view-tooltip-src",
a)[0],!b)throw Error("alp.view.tooltip: extract_f(): missing .hidden-alp-view-tooltip-src");return b},unextract_f:function(a,b){a.setAttribute("title",b)},transform_f:function(a){return a.replace(/(\r\n|\n\r|\r|\n)/g,"<br>$1")},place_f:function(a,b,c,d){var e=a.getBoundingClientRect();a=alp.gWindowScroll();d=Math.round(a.left+e.left+(d||0)*(e.right-e.left));e=Math.round(a.top+e.bottom);var l=b.getBoundingClientRect();0!=c&&l&&null!=l.right&&null!=l.left&&(c=Math.max(c||0,l.right-l.left));var m;null!=
c&&0!=c&&(m=document.documentElement.getBoundingClientRect())&&null!=m.right&&(c=Math.max(0,Math.min(d,a.left+m.right-c)),c<d&&(d=c));c={position:alp.hasClass(alp.body(),"oax_modal_fixed_mobile")?"fixed":"absolute",left:d+"px",top:e+"px"};if((l=b.getBoundingClientRect())&&null!=l.top&&null!=l.bottom)var f=30;var p;null!=f&&null!=(p=a.top+document.documentElement.clientHeight)&&p-f<e&&(delete c.top,c.bottom="-"+a.top+"px",c.marginBottom=Math.max(f,p-e)+"px");for(var g in c)c.hasOwnProperty(g)&&(f=
c[g],b.style[g]!==f&&(b.style[g]=f))},top_wrap:null,show_f:function(a){var b=alp.body();alp.isDescendant(a,b)||alp.aC(b,this.top_wrap?(this.top_wrap.substring.call.a,alp.aC(alp.cE("div",null,{"class":this.top_wrap}),a)):a);a.style.display="block"},hide_f:function(a){var b=this.top_wrap?a.parentNode:a,c=b&&b.parentNode;c&&c.removeChild&&c.removeChild(b);a.style.display="none"},isOpenState:null,only_when_f:null,className:"alp-view-tooltip",tolerance_x:16,tolerance_y:16,min_width:300,x_prop:.5,openClassName:"has-alp-view-tooltip",
preventDefault:!1,css_base:alp.cssBase(),css_url:function(){return this.css_base+"alp/view/tooltip.css"},dom_event_open:alp.likeMobile()?"click":"mouseover",dom_event_close:alp.likeMobile()?"touchstart":"mousemove",open_toggle:!1};alp.onDCL(function(){alp.aEL(alp.body(),"click",k)});var l={},r={},n=0,q="_alp_view_tooltip_cache_id",p="preventDefault",v;alp.aEL(window,"unload",function(){h(!0)},!1);var u,t}})();"undefined"!==typeof dojo&&dojo.provide("alp.view.recommendation");
"undefined"===typeof alp&&Object.defineProperty(window,"alp",{value:{},writable:!1});alp.view||(alp.view={});alp.i18n.fetch("alp.all");
(function(){function k(b,c){var l=alp.domWalkSelect(c,function(a){return/form/i.test(a.tagName)&&"rec-form"===alp.gA(a,"name")},!0);l=l?alp.gA(l,"name"):alp.newId("rec-form");l={cfg:b,pref_form_name:l,f_cb_name:"rec-cb-"+b.f_class,f_cb_id:alp.newId("rec-cb-"+b.f_class),t_cb_name:"rec-cb-"+b.t_class,t_cb_id:alp.newId("rec-cb-"+b.t_class),g_cb_name:"rec-cb-"+b.g_class,g_cb_id:alp.newId("rec-cb-"+b.g_class),swi:{}};l.pref=h(c,"pref",l);l.info=h(c,"info",l);l.swi.f=h(c,"f",l);l.swi.t=h(c,"t",l);l.swi.g=
h(c,"g",l);g(l);f(l);d("f",l);d("t",l);d("g",l);alp.sA(l.info.node,"onclick",'javascript:window.open("'+l.cfg.info_url+'");');e(l.pref,l);b=alp.cookie(b.cookie_name)||"";for(var m in l.swi)m in a||(c=-1<b.lastIndexOf(m),l.swi[m].setPerm(c),l.swi[m].setSwitch(c))}function h(a,c,d){var e=d.cfg[c+"_class"],l=alp.gEBCN(e,a)[0];l||(l=alp.cE("div",a,{"class":e}));b(l,c,d);return{node:l}}function g(b){function c(a,b,c){a.title||(a.title=e);alp.view.tooltip({select:a,only_when_f:function(){return!alp.hasClass(b.node,
d.switch_on_class)}})}var d=b.cfg,e='<div class="'+d.tooltip_container_class+'">'+d.text.two_clicks+"</div>";b=b.swi;for(var m in b)if(!(m in a))for(var f=alp.gEBCN(d.switch_class,b[m].node).concat(alp.gEBCN(d.dummy_class,b[m].node)),g=f.length;g--;)c(f[g],b[m],m)}function f(a){var b=a.cfg;a=a.info.node;a.title||(a.title='<div class="'+b.tooltip_container_class+'">'+b.text.info_title+"</div>");alp.view.tooltip({select:a})}function e(b,c){function d(a,b){a.cb_perm=c.pref_form.elements[c[b+"_cb_name"]];
a.setPerm=function(d){(a.cb_perm.checked=d)&&a.setSwitch(d);var e=alp.cookie(c.cfg.cookie_name)||"";d^-1<e.lastIndexOf(b)&&(e=d?e+b:e.replace(new RegExp(b,"g"),""),d={expires:c.cfg.cookie_days},null!=c.cfg.cookie_path&&(d.path=c.cfg.cookie_path),alp.cookie(c.cfg.cookie_name,e,d))};alp.aEL(a.cb_perm,"click",function(){a.setPerm(a.cb_perm.checked)})}alp.view.tooltip({select:alp.gEBCN(c.cfg.pref_button_class,c.pref.node),extract:c.pref_form});for(var e in c.swi)e in a||d(c.swi[e],e)}function d(a,c){var d=
c.swi[a],e=d.node;d.setSwitch=function(d){alp.setClass(e,c.cfg.switch_on_class,d);d&&(d=alp.gEBCN(c.cfg.real_class,e)[0],b(d,a+"_real",c))};d.toggleSwitch=function(){d.setSwitch(!alp.hasClass(e,c.cfg.switch_on_class))};alp.aEL(alp.gEBCN([c.cfg.switch_class,c.cfg.dummy_class],e),"click",function(){d.toggleSwitch()})}function b(b,c,d){switch(c){case "pref":alp.gEBCN(d.cfg.pref_button_class,b)[0]||alp.cE("div",b,{"class":d.cfg.pref_button_class});c=document.forms[d.pref_form_name];c||(c=alp.cE("form",
b,{style:"display: none;","class":d.cfg.pref_form_class+" "+d.cfg.tooltip_container_class,name:d.pref_form_name}),b=alp.cE("legend",c),alp.cTxN(d.cfg.text.long_term_activ,b),alp.cE("input",c,{type:"checkbox",name:d.f_cb_name,id:d.f_cb_id}),b=alp.cE("label",c,{"for":d.f_cb_id}),alp.cTxN(d.cfg.text.cb_facebook,b),alp.cE("input",c,{type:"checkbox",name:d.t_cb_name,id:d.t_cb_id}),b=alp.cE("label",c,{"for":d.t_cb_id}),alp.cTxN(d.cfg.text.cb_twitter,b),alp.cE("input",c,{type:"checkbox",name:d.g_cb_name,
id:d.g_cb_id}),b=alp.cE("label",c,{"for":d.g_cb_id}),alp.cTxN(d.cfg.text.cb_googleplus,b));d.pref_form=c;"none"==d.pref_form.style.display&&(d.pref_form.style.display="");break;case "f":case "t":case "g":alp.gEBCN(d.cfg.switch_class,b)[0]||alp.cE("div",b,{"class":d.cfg.switch_class});alp.gEBCN(d.cfg.dummy_class,b)[0]||alp.cE("div",b,{"class":d.cfg.dummy_class});alp.gEBCN(d.cfg.real_class,b)[0]||alp.cE("div",b,{"class":d.cfg.real_class});break;case "f_real":if(!b.firstChild){c=d.cfg.f;d=["href="+encodeURIComponent(d.cfg.url)];
for(var e in c)e in a||d.push(e+"="+c[e]);d={src:"http://www.facebook.com/plugins/like.php?"+d.join("&"),scrolling:"no",frameborder:"0",style:"border:none; overflow:hidden; width:"+c.width+"px; height:"+c.height+"px;",allowTransparency:"true"};alp.cE("iframe",b,d)}break;case "t_real":if(!b.firstChild){c=d.cfg.t;d={href:"http://twitter.com/share","class":"twitter-share-button","data-url":d.cfg.url};for(e in c)e in a||(d["data-"+e]=c[e]);d=alp.cE("a",b,d);alp.cTxN("Tweet",d);alp.cE("script",b,{type:"text/javascript",
src:"http://platform.twitter.com/widgets.js"})}break;case "g_real":if(!b.firstChild){c=d.cfg.g;d={"class":"g-plusone","data-href":d.cfg.url};for(e in c)e in a||(d["data-"+e]=c[e]);d=alp.cE("div",b,d,{innerHTML:"&nbsp;"});window.___gcfg={lang:c.lang};"undefined"!==typeof gapi&&gapi.plusone&&gapi.plusone.go?gapi.plusone.go(d):alp.cE("script",alp.head(),{type:"text/javascript",src:"https://apis.google.com/js/plusone.js"})}}}if("function"!==typeof alp.view.recommendation){alp.view.recommendation=alp.nowF(function(a){alp.i18n.fetch("alp.all").thenSoon(function(b){c.text=
b;b={};for(var d in c)d in b||(b[d]=a&&d in a?a[d]:c[d]);for(d in c.text)d in b.text||(b.text[d]=a&&a.text&&d in a.text?a.text[d]:c.text[d]);"function"===typeof b.sprite_img_url&&(b.sprite_img_url=b.sprite_img_url());alp.ensureCss(b.css_url,b);d=alp.gEBCN(b.container_class);for(var e=d.length,l=0;l<e;l++)k(b,d[l]);return{cfg:b,cont_arr:d}})});var c={url:document.location.href,container_class:"recommendation",tooltip_container_class:"alp-view-recommendation-tooltip",switch_class:"rec-switch",dummy_class:"rec-dummy",
real_class:"rec-real",css_base:alp.cssBase(),sprite_img_url:function(){return this.css_base+"alp/images/recommendation_sprite.png"},css_url:function(){return this.css_base+"alp/view/recommendation.css"},cookie_name:"alp_view_recommendation",cookie_days:365,cookie_path:"/",f_class:"facebook",f:{width:150,height:21,send:!1,layout:"button_count",show_faces:!1,action:"like",colorscheme:"light",font:"arial"},t_class:"tweet",t:{count:"horizontal",lang:"de"},g_class:"googlePlusOne",g:{size:"medium",lang:"de"},
switch_on_class:"on",info_class:"rec-information",info_url:"http://www.heise.de/ct/artikel/2-Klicks-fuer-mehr-Datenschutz-1333879.html",pref_button_class:"rec-pref-button",pref_class:"rec-preferences",pref_form_class:"rec-pref-form"},a={}}})();"undefined"!==typeof dojo&&dojo.provide("alp.tool");"undefined"===typeof alp&&Object.defineProperty(window,"alp",{value:{},writable:!1});alp.tool||(alp.tool={});
(function(){for(var k=[[alp.dom,null],[alp.humane,"humane"],[alp.view.tooltip,"tooltip"],[alp.view.recommendation,"recommendation"]],h=alp.tool,g=k.length;g--;){var f=k[g],e=f[0];f=f[1];if("object"===typeof e){f=f?h[f]||(h[f]={}):h;for(var d in e)d in f||(f[d]=e[d])}else"function"===typeof e&&(h[f]=e)}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3._core");alp._gmap2_3||(alp._gmap2_3={});
(function(){var k=alp._gmap2_3;k.V2=function(h){return k.v(h)==k.V2};k.V2.valueOf=function(){return 2};k.V2.toString=null;k.V3=function(h){return k.v(h)==k.V3};k.V3.valueOf=function(){return 3};k.V3.toString=null;k.v=function(h){h||(h=alp.sub("google.maps"));if(h&&/^3\./.test(h.version)&&h.Map||(!h||!h.Map2)&&alp.sub("alp.maps.leaflet_gshim"))return(k.v=function(){return k.V3})();if(h&&h.Map2&&"function"===typeof GMap2)return(k.v=function(){return k.V2})()}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3");
alp.ensureCss(alp.cssBase()+"alp/x.css");"undefined"!==typeof dojo&&dojo.provide("alp.gload_gmap");
(function(){function k(){function a(){"mini"!==alp.sub("oax.API_CFG.build")&&alp.cE("script",alp.head(),{src:" //www.google.com/jsapi"})}h()||d||(d=!0,alp.onDCL(a));return b||(b=alp.subDfrd(h))}function h(){return alp.sub("google.load")}function g(){function b(){"mini"!==alp.sub("oax.API_CFG.build")&&google.load("maps","3",{callback:alp.f(),other_params:e});setTimeout(function(){alp.fVal(alp.sub("oax._js_tracking"),"gm",["fvp="+(alp.sub("oa._fvp")?1:0)])},5E3)}if(!f())if(!h())alp.m(k(),["to","then"],
g);else if(!c){c=!0;var d=alp.filterIn(alp.mix({sensor:!1,libraries:"places,panoramio,weather",language:alp.i18n.language(),key:null},alp.sub("alpConfig.gmap")),"!=null"),e=alp.map(alp.oKeys(d),'v+"="+this[v]',d).join("&");alp.onDCL(b)}return a||(a=alp.subDfrd(f))}function f(){return alp.sub("google.maps.Map")&&alp.sub("google.maps.event.addDomListener")&&google.maps}"undefined"===typeof alp&&Object.defineProperty(window,"alp",{value:{},writable:!1});var e=alp.gload_gmap||(alp.gload_gmap={});if(!e.gmapDfrd){e.gloadDfrd=
k;e.gloadReady=h;e.gmapDfrd=g;e.gmapReady=f;var d,b,c,a}})();"undefined"!==typeof dojo&&dojo.provide("alp.gmap3._core");
(function(){function k(){if(!f){var e=!!alp.sub("alp.maps.leaflet_gshim.getDfrd");f=(e=alp.sub("alpConfig.leaflet_gshim")?e:!alp.sub("google.maps.Map")&&e)?alp.maps.leaflet_gshim.getDfrd():alp.subDfrd(h.gmapReady);e||h.gmapReady()||h.gmapDfrd()}return f}var h=alp.gload_gmap;alp.gmap3=function(){var e=arguments;(g||(g=alp.nowF(alp.eventCB(k()))))(alp.nowF.apply(alp,e));return alp.gmap3};alp.gmap3.gload=h.gloadDfrd;var g,f})();"undefined"!==typeof dojo&&dojo.provide("alp.util.str_scramble");
(function(){function k(){if(!g){for(var f=[46].concat(alp.loop2arr(97,123)).concat(alp.loop2arr(65,91)),e=f.length,d=e;d--;){var b=((e^d)+e*d)%e,c=(d+1)*b%e,a=f[b];f[b]=f[c];f[c]=a}g=String.fromCharCode.apply(String,f)}return g}var h=alp.sub("alp.util",null,!0);h.str_scramble=function(f,e){e||(e=g||k());var d=e.length;return alp.map(f.split("").reverse(),function(b,c){var a=e.indexOf(b);return 0>a?b:e[(a+c)%d]}).join("")};h.str_unscramble=function(f,e){e||(e=g||k());var d=e.length;return alp.map(f.split(""),
function(b,c){var a=e.indexOf(b);return 0>a?b:e[(a+100*d-c)%d]}).reverse().join("")};var g})();"undefined"!==typeof dojo&&dojo.provide("alp.cfg.url");
(function(){function k(a){k.str||(alp.dev.isApproval()?k.str=b+"//resapproval.oastatic.com/":alp.dev.isTesting()?k.str=b+"//restesting.oastatic.com/":k.str=b+"//res.oastatic.com/");return k.str+(a||"").replace(/^\//,"")}function h(){return(alp.sub("oa._CRR_SERVER")||"").replace(/\/$/,"")}var g=alp.dev,f=alp.util,e=(+(Date.now?Date.now():+new Date)).toString(36)+Math.random().toString(36),d=location.protocol,b=/^http/.test(d)?d:"http:",c=(location.search.match(/[\?&]oaserver=([^&]+)/)||[])[1],a=c&&
b+"//"+c.replace(/^[^\/]*\/\//,""),m=alp.cfg||(alp.cfg={}),l=+new Date/36E5|0;c=/[\?&]dev3d=1(?:$|&)/.test(location.search);var r=/[\?&]devgeonames=1(?:$|&)/.test(location.search),n=/[\?&]devsat=1(?:$|&)/.test(location.search),q=m.host={flight3d_elevation:alp.f(c?'"kuiper.alpserver.de"':'"d0.oastatic.com"'),geonames:alp.f(r?'"kuiper.alpserver.de:8085"':'"g0.oastatic.com"'),winter_satellite_host_tmpl:alp.f(n?'"kuiper.alpserver.de:8083"':'"c{s}.oastatic.com"')},p=m.url={abstract_marker_layer_config:function(){return g()?
g.isTesting()?b+"//testing.outdooractive.com/alpportal/${locale}/clusterConfig.json?proj=${proj}&type=${type}&v2=${v2}":g.isApproval()?b+"//approval.outdooractive.com/alpportal/${locale}/clusterConfig.json?proj=${proj}&type=${type}&v2=${v2}":g.isProto()?b+"//127.0.0.1:8080/cgi-bin/clusterConfig.json?proj=${proj}&type=${type}":(alp.jsonpBase()||b+"//localhost/")+"alpportal/${locale}/clusterConfig.json?proj=${proj}&type=${type}&v2=${v2}":p.api_autodomain("/alpportal/${locale}/clusterConfig.json?proj=${proj}&type=${type}&v2=${v2}")},
api_autodomain:function(c){/^\/\//.test(c)?c=b+c:/^https?:\/\//.test(c)||("/"!==c.charAt(0)&&(c="/"+c),c=c.replace(/(\?|$)/,function(a){return"?jsapi=1"+(a[0]?"&":"")}),c=g()&&(g.fromUrlSearch()||g.fromAlpConfig())?g.isApproval()?b+"//approval.outdooractive.com"+c:g.isTesting()?b+"//testing.outdooractive.com"+c:g.isLocalhost()?b+"//"+location.host+c:"alp.cfg.url:not:implemented:yet"+c:g()&&-1<alp.cssBase().indexOf(location.hostname)?"//"+location.host+c:p.api_auto_live_proto_host()+c);a&&(c=a+c.replace(/^[^\/]*\/\/[^\/]+/,
""));return c},api_auto_live_proto_host:function(){var a=location,c=a.hostname;/\b(www\.adac-skiguide\.de|(www|testing|approval)\.outdooractive\.com)\b/.test(a.host)||c&&-1<alp.cssBase().indexOf(c)?(c=b,a=a.host):(c="",a=alp.opt((alp.jsonpBase()||"").match(/^[^\/]*\/\/([^\/]+)/),1)||"www.outdooractive.com");return c+"//"+a},api_autocomplete_outdooractive_xd:function(){return p.api_autodomain("/api/v2/project/${proj}/suggest?type=${subset}&query=${q}&lat=${lat}&lon=${lng}&lang="+alp.i18n.language())},
api_autocomplete_xd:function(){return p.api_autodomain("/alpportal/autosuggest?subset=${subset}&q=${q}&proj=${proj}&lang="+alp.i18n.language())},api_autocomplete_photon:function(){return"https://geoc.oastatic.com/api?q=${q}&lang=${lang}&lat=${lat}&lon=${lng}"},api_translate_google:function(){return"https://www.googleapis.com/language/translate/v2?key=${apikey}&q=${text}&source=${fromLang}&target=${toLang}"},api_avalanche_all_regions:function(){return p.api_autodomain("/api/project/${project}/avalanche/regions/jsonp")},
api_avalanche_all_regions_xd:function(){return p.api_avalanche_all_regions()},api_avalanche_detail:function(){return p.api_autodomain("/alpportal/"+alp.i18n.language()+"/avalanche.json?request=detail&regions=${region_idlist}")},api_avalanche_detail_xd:function(){return p.api_avalanche_detail()},api_avalanche_history:function(){return p.api_autodomain("/alpportal/"+alp.i18n.language()+"/avalanche.json?request=history&regions=${region_idlist}&day=${day}")},api_avalanche_history_xd:function(){return p.api_avalanche_history()},
api_avalanche_short:function(){return p.api_autodomain("/alpportal/"+alp.i18n.language()+"/avalanche.json?request=short&regions=${region_idlist}")},api_avalanche_short_xd:function(){return p.api_avalanche_short()},api_bodypart:function(){return p.api_autodomain((alp.sub("oa.MARKUP_SERVER")||"/alpportal/")+"bodyPartJsonp?cachebust=${cachebust}&page=${path}&proj=${project}&key=${key}&_quantityMap=${_quantityMap}&lang=${locale}")},api_bodypart_xd:function(){return p.api_bodypart()},api_cat:function(){return p.api_autodomain("/api/project/${project}/category/tree?defaultCategory=true")},
api_cat_xd:function(){return p.api_cat().replace("tree?","tree/jsonp?")},api_cat_mcp:function(){return p.api_autodomain("/api/project/${project}/category/tree${extra}?lang="+alp.i18n.language())},api_cat_mcp_xd:function(){return p.api_cat_mcp().replace("?","/jsonp?")},api_catdiff:function(){return p.api_autodomain("/api/platform/data/activityDifficulties?category=${catid}&lang="+alp.i18n.language())},api_catdiff_xd:function(){return p.api_autodomain("/api/platform/data/jsonp/activityDifficulties?category=${catid}&lang="+
alp.i18n.language())},api_elevation:function(){return b+"//elevation.outdooractive.com/routingengine/elevation?locations=${locations}&format=sjs"},api_evaluateUser:function(){return p.api_autodomain("/api/community/evaluateUser")},api_check_email:function(a){return p.api_autodomain("/api/community/check?email="+a)},api_event_datelist:function(){return p.api_autodomain("/api/event/dates/${eventidlist}?dateFrom=${datefrom}&dateTo=${dateto}")},api_event_datelist_xd:function(){return p.api_event_datelist().replace("?",
"/jsonp?")},api_filter:function(){return p.api_autodomain("/alpportal/filter_cluster.json?action=list&allids=true&proj=${proj}&request=${request}&splithtml=false${rest}")},api_filter_xd:function(){return p.api_filter()},api_geocode:function(){return p.api_autodomain("/api/geocode/${type}?q=${q}&project=${project}&limit=${limit}")},api_geocode_xd:function(){return p.api_geocode().replace("/geocode/${type}?","/geocode/${type}/jsonp?")},api_image_variations_xd:function(){return p.api_autodomain("/api/platform/data/jsonp/imageVariations")},
api_image_meta:function(){return p.api_autodomain("/api/image/${id}")},api_image_meta_xd:function(){return p.api_autodomain("/api/image/${id}/jsonp")},api_ip_location:function(){return p.api_autodomain("/alpportal/ipLocation")},api_ip_location_xd:function(){return p.api_ip_location()},api_mentz_departure:function(){return p.api_autodomain("/api/proxy/mentz/departure/${id}?cachebust=${cachebust}")},api_mentz_departure_xd:function(){return p.api_autodomain("/api/proxy/mentz/departure/jsonp/${id}?cachebust=${cachebust}")},
api_nextbike_info:function(){return p.api_autodomain("/api/proxy/nextbike/info/${id}?cachebust=${cachebust}")},api_nextbike_info_xd:function(){return p.api_autodomain("/api/proxy/nextbike/info/jsonp/${id}?cachebust=${cachebust}")},api_callabike_info:function(){return p.api_autodomain("/api/proxy/callabike/info/${id}?cachebust=${cachebust}")},api_callabike_info_xd:function(){return p.api_autodomain("/api/proxy/callabike/info/jsonp/${id}?cachebust=${cachebust}")},api_mapconfig:function(){return p.api_autodomain("/alpportal/mapConfig.json?token=${token}&proj=${proj}&lang="+
alp.i18n.language())},api_more_snippets:function(a,b,c,d,l){return this.get_context()+"/ajaxPaging.json?first="+d+"&last="+l+"&proj="+c+"&"+a+"="+b+"&cachebust="+e+"&lang="+alp.i18n.language()},api_search_more_snippets:function(a,b,c,d,l,m,f){return this.get_context()+"/search.json?first="+d+"&last="+l+"&proj="+b+"&cat="+a+"&q="+encodeURIComponent(c)+"&cachebust="+e+"&lang="+alp.i18n.language()+"&nohtml="+!!m+"&listCats="+!!f},api_nearby:function(){return p.api_autodomain("/api/project/${proj}/nearby/${type}?location=${location}&radius=${radius}&sortby=${sortby}")},
api_nearby_xd:function(){return p.api_nearby().replace("?","/jsonp?")},api_platform_info:function(){var a=location.hostname;return"https://"+("cms"+(/approval/.test(a)?"approval":/testing/.test(a)?"testing":"")+".outdooractive.com")+"/platformInfo?i=${id}"},api_platform_info_xd:function(){return p.api_platform_info()},api_oois:function(){return p.api_autodomain("/api/oois/${idlist}?project=${proj}&display=external&lang=${locale}&cachebust=${cacheBust}&edit=${edit}&token=${token}&categoryHandling=fallback")},
api_oois_xd:function(){return p.api_oois().replace("/oois/","/oois/jsonp/")},api_oois_flexview:function(){return p.api_autodomain("/api/flexview/${flexview}/${idlist}?project=${proj}&display=external&lang=${locale}&cachebust=${cacheBust}&edit=${edit}&categoryHandling=default")},api_oois_flexview_xd:function(){return p.api_oois_flexview().replace("?","/jsonp?")},api_oois_minimal:function(){return p.api_autodomain("/api/oois/${idlist}?project=${proj}&display=minimal&lang=${locale}&cachebust=${cacheBust}")},
api_oois_minimal_xd:function(){return p.api_oois_minimal().replace("/oois/","/oois/jsonp/")},api_oois_geometry:function(){return p.api_autodomain("/api/oois/${idlist}?project=${proj}&display=geometry&lang=${locale}&cachebust=${cacheBust}&token=${token}")},api_oois_geometry_xd:function(){return p.api_oois_geometry().replace("/oois/","/oois/jsonp/")},api_oois_lightweightApp:function(){return p.api_autodomain("/api/flexview/${lightweightApp}/${idlist}?project=${proj}&display=external&lang=${locale}&categoryHandling=default&cachebust=${cacheBust}")},
api_oois_lightweightApp_xd:function(){return p.api_oois_lightweightApp().replace("/${idlist}","/${idlist}/jsonp")},api_region_geometry:function(){return p.api_autodomain("/alpportal/region_geometry.json?i=${areaid}")},api_region_geometry_xd:function(){return p.api_region_geometry()},api_write_region_fav_unfav:function(a){var b=a.do_fav,c=a.proj,d=a.token,e=a.userid;a=a.contentid;"boolean"===typeof b||null.bug;alp.forEach([c,d,e,a],"(v||null).substring.call.a");return"/api/user/"+e+"/favouredRegions/"+
(b?"add":"remove")+"/"+a+"?token="+d+"&proj="+c},api_show_geometry:function(){return p.api_autodomain("/alpportal/show_geometry.json?catid=${catid}&idlist=${idlist}&proj=${project}")},api_show_geometry_xd:function(){return p.api_show_geometry()},api_search:function(){return p.api_autodomain("/api/search?q=${q}&project=${proj}")},api_search_xd:function(){return p.api_search().replace("?","/jsonp?")},api_search_type:function(){return p.api_autodomain("/api/search/${type}s?q=${q}&project=${proj}")},
api_search_type_xd:function(){return p.api_search_type().replace("?","/jsonp?")},api_search_user:function(a){return p.api_autodomain("/api/community/user/suggest?q="+a.q+"&project="+a.proj+"&token="+a.token)},api_snippet_list_init:function(a){(a.type||null).substring.call.a;(a.id||"").substring.call.a;(a.sortBy||"").substring.call.a;a.nObject.toPrecision.call.a;return this.get_context()+"/snippetList.json?type="+a.type+(a.id?"&id="+a.id:"")+(a.sortBy?"&sortBy="+a.sortBy:"")+(a.proj?"&proj="+a.proj:
"")+"&nObject="+a.nObject+"&lang="+alp.i18n.language()},api_snippet_list_fetch:function(a){(a.type||null).substring.call.a;a.id&&a.id.substring.call.a;a.snippetIds.slice.call.a;a.snippetIds[0].substring.call.a;return this.get_context()+"/snippetList.json?type="+a.type+(a.id?"&id="+a.id:"")+(a.proj?"&proj="+a.proj:"")+"&snippetIds="+a.snippetIds+"&lang="+alp.i18n.language()},get_context:function(){var a=alp.sub("alpConfig.context");return a?"/"===a[0]?a:"/"+a:""},api_token:function(){var a=alp.sub("oa.API_HOST");
a=a?a+this.get_context().substring(1):this.get_context();return p.api_autodomain(a+"/community.token.ctrl")},api_tour_summit:function(a){(a.proj||null).substring.call.a;(a.key||null).substring.call.a;a.xy_arr&&a.xy_arr.splice.call.a;(a.radius||null).toPrecision.call.a;a.highest_radius&&a.highest_radius.toPrecision.call.a;var b=a.opt_alt_referrer;b&&b.substring.call.a;return d+"//"+q.geonames()+"/geonames"+(b?"/$/"+f.str_scramble(b):"")+"/"+a.proj+"/"+a.key+"/geom_buffer?type=T_MT,T_PK&field=geonameid,name,latitude,longitude,elevation&radius="+
a.radius+(0<a.highest_radius?"&highest_radius="+a.highest_radius:"")+(a.xy_arr?"&xy_arr="+JSON.stringify(a.xy_arr):"")},api_weather_xd:function(a){a.proj.substring.a;a.ooiid.substring.a;return p.api_autodomain("/api/project/"+a.proj+"/weather/"+a.ooiid+"/jsonp?lang="+(alp.opt(a,"language")||alp.i18n.language()))},api_write_comment_create:function(a){a.proj.substring.a;a.token.substring.a;return"/api/user/"+a.userid+"/community/"+a.ooiid+"/comment?lang="+(alp.opt(a,"language")||alp.i18n.language())+
"&proj="+a.proj+"&token="+a.token},api_write_condition_create:function(a){a.proj.substring.a;a.token.substring.a;return"/api/condition/?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_condition_delete:function(a){return this.api_write_condition_update(a)},api_write_condition_update:function(a){a.proj.substring.a;a.token.substring.a;a.id.substring.a;return"/api/condition/"+a.id+"/?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+
"&token="+a.token},api_read_basket_get:function(a){a.proj.substring.a;a.token.substring.a;return"/api/user/"+a.userid+"/basket/"+a.basketid+"?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_basket_create:function(a){a.proj.substring.a;a.token.substring.a;return"/api/user/"+a.userid+"/basket?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_basket_deleteUpdate:function(a){a.proj.substring.a;a.token.substring.a;
a.basketid.substring.a;return"/api/user/"+a.userid+"/basket/"+a.basketid+"?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_basket_clean:function(a){a.proj.substring.a;a.token.substring.a;a.basketid.substring.a;return"/api/user/"+a.userid+"/basket/"+a.basketid+"/clean?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_basket_add:function(a){a.proj.substring.a;a.token.substring.a;a.ooiid.substring.a;
a.basketid.substring.a;return"/api/user/"+a.userid+"/basket/"+a.basketid+"/add/"+a.ooiid+"?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_basket_fav_unfav:function(a){var b=a.do_fav,c=a.proj,d=a.token,e=a.userid;a=a.basketid;"boolean"===typeof b||null.bug;alp.forEach([c,d,e,a],"(v||null).substring.call.a");return"/api/user/"+e+"/basket/starred/"+(b?"add":"remove")+"/"+a+"?token="+d},api_write_basket_remove:function(a){a.proj.substring.a;a.token.substring.a;
a.ooiid.substring.a;a.basketid.substring.a;return"/api/user/"+a.userid+"/basket/"+a.basketid+"/remove/"+a.ooiid+"?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_basket_image_primary:function(a){(a.token||null).substring.a;return"/api/user/"+a.userid+"/basket/"+a.primaryid+"/primaryimage?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_invite_user:function(a){return p.api_autodomain(alp.tmpl("api/community/user/invite?token=${token}&emails=${emails}",
a))},api_teamactivity_participate:function(a){alp.forEach(["ooiid","action","token","proj"],"this[v].substring.call.a",a);return p.api_autodomain("api/teamactivity/"+a.ooiid+"/participate?token="+a.token+"&action="+a.action+"&project="+a.proj+(a.participant?"&participant="+a.participant:"")+(a.remark?"&remark="+a.remark:""))},api_teamactivity_watch:function(a){alp.forEach(["ooiid","token","proj"],"this[v].substring.call.a",a);return p.api_autodomain("api/teamactivity/"+a.ooiid+"/watched/add?token="+
a.token+"&project="+a.proj)},api_teamactivity_unwatch:function(a){alp.forEach(["ooiid","token","proj"],"this[v].substring.call.a",a);return p.api_autodomain("api/teamactivity/"+a.ooiid+"/watched/remove?token="+a.token+"&project="+a.proj)},api_write_community_image_background:function(a){(a.token||null).substring.a;return"/api/user/"+a.userid+"/backgroundimage?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_community_image_photo:function(a){(a.token||
null).substring.a;return"/api/user/"+a.userid+"/profileimage?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_user_data_full:function(a){(a.token||null).substring.a;return"/api/user/"+a.userid+"?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_image_meta:function(a){(a.token||null).substring.a;return"/api/image/"+a.id+"?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+
a.token},api_write_tour_create:function(a){(a.token||null).substring.a;return"/api/tour/?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_tour_delete:function(a){(a.token||null).substring.a;(a.tourid||null).substring.a;return"/api/tour/"+a.tourid+"?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},api_write_tour_update:function(a){(a.token||null).substring.a;(a.tourid||null).substring.a;return"/api/tour/"+a.tourid+
"/tourplanner?lang="+(alp.opt(a,"language")||alp.i18n.language())+"&project="+a.proj+"&token="+a.token},cluster_layer_base:function(){return g()?g.isTesting()?b+"//testing.outdooractive.com/alpportal/${locale}/":g.isApproval()?b+"//approval.outdooractive.com/alpportal/${locale}/":g.isProto()?b+"//127.0.0.1:8080/cgi-bin/":(alp.jsonpBase()||b+"//localhost/")+"alpportal/${locale}/":p.api_autodomain("/alpportal/${locale}/").split("?")[0]},cluster_layer_cl:function(){return"cl.json?proj=${proj}&lev=${lev}&z=${z}&x=${x}&y=${y}"},
content_track_api:function(){var a=h();return a?a+"/tracing?aspect=${aspect}&proj=${proj}":""},content_track_one:function(){var a=h();return a?a+"/tracing?aspectx=${aspect}&proj=${proj}&i=${id}":""},content_track_many:function(){var a=h();return a?a+"/tracing?aspectx=${aspect}&proj=${proj}&ids=${id}":""},gpx_download:alp.f('"/download.tour.gpx?i=${tourid}"'),img2_fit_rx:/\/\d+x\d+[a-z]\//,img2_id_extract_rx_str:"/\\/img2\\/(\\d+)\\/[^\\/]+?\\//",img2max_id_and_rest_rx:/\/(?:img2|imgmax)\/(\d+)\/.*$/,
img2max_id_extract_rx:/\/(?:img2|imgmax)\/(\d+)\/[^\/]+?\//,img2max_rx:/\/(?:img2|imgmax)\//,img_default_domain:function(){return b+(g()?g.isApproval()?"//approval.outdooractive.com":"//testing.outdooractive.com":"//www.outdooractive.com")},img_from_id:function(a,c){var d=location.host,e=/approval/.test(d);d=/testing/.test(d);e=g.isLocalhost()?"":b+"//img"+(e?"approval":d?"testing":"")+".oastatic.com";return alp.urlCachebust(e+"/img2/"+a+(c?"/"+c:"")+"/t.jpg")},imgsrc_from_id:function(a){return this.img_from_id(a,
"source")},imgthumb_from_id:function(a,b,c){return this.img_from_id(a,(b||98)+"x"+(c||48)+"r")},metgis_meta:function(){return"http://tiles.metgis.com/meta/0.6/meta.json"},res_host:k,satellite_winter_allgaeu_tmpl:function(a){a=a&&a.opt_alt_referrer_scrambled;return"//"+m.host.winter_satellite_host_tmpl()+"/imagetile"+(a?"/$/"+a:"")+"/api-dev-oa/yourtest-outdoora-ctiveapi/winter_allgaeu/"},satellite_winter_allgaeu_meta_json:function(a){return this.satellite_winter_allgaeu_tmpl(a).replace("{s}","0")+
"meta.json?cbst="+l},satellite_winter_allgaeu_tile_tmpl:function(a){var b=a.cbst;(b||null).substring.call.a;return this.satellite_winter_allgaeu_tmpl(a)+"{z}/{x}/{y}.jpg?cbst="+b},satellite_winter_vorarlberg_tmpl:function(a){a=a&&a.opt_alt_referrer_scrambled;return"//"+m.host.winter_satellite_host_tmpl()+"/imagetile"+(a?"/$/"+a:"")+"/api-dev-oa/yourtest-outdoora-ctiveapi/winter_vorarlberg/"},satellite_winter_vorarlberg_meta_json:function(a){return this.satellite_winter_vorarlberg_tmpl(a).replace("{s}",
"0")+"meta.json?cbst="+l},satellite_winter_vorarlberg_tile_tmpl:function(a){var b=a.cbst;(b||null).substring.call.a;return this.satellite_winter_vorarlberg_tmpl(a)+"{z}/{x}/{y}.jpg?cbst="+b}}})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.touch");"undefined"===typeof alp&&(alp={});
(function(){function k(g,f,e,d,b){var c="number"===typeof g,a=c?g:g[0],m=c?g:g[1];"touchend"===e&&(a--,m--);return alp.aEL(f,e,function(b){b||(b=window.event);var c=b.touches.length;a<=c&&c<=m&&d(b)},b)}if(!alp.aELtouch){var h=["touchstart","touchmove","touchend","touchcancel","touchleave"];alp.aELtouch=k;alp.aELtouchup=function(g,f,e,d){function b(){for(var b=a.length;b--;)alp.rEL(a[b])}function c(a,b){b||(b=window.event);var c=Date.now?Date.now():+new Date,d=c-l;if("touchstart"===a)a=b.touches[0],
n={touches:[{clientX:a.clientX,clientY:a.clientY}]},q=c;else if("touchend"===a){if(!(b.touches&&null!==b.touches.length&&0<b.touches.length||n&&333<c-q)){if(n){d=n.touches[0];var e=b.changedTouches[0];if(d&&e&&16<Math.max(Math.abs(d.clientX-e.clientX),Math.abs(d.clientY-e.clientY)))return}m||alp.stopEvent(b);f(b);l=c;r=a}}else if("mousedown"===a)p={x:b.clientX,y:b.clientY},h=c;else if(!(p&&333<c-h)){if(p&&(e=p,16<Math.max(Math.abs(b.clientX-e.x),Math.abs(b.clientY-e.y))))return;null!=l&&666>d&&r!==
a?m||alp.stopEvent(b):(m||alp.stopEvent(b),f(b),l=c,r=a)}}var a=[alp.aEL(g,"touchstart",alp.bindF(c,null,"touchstart"),e),alp.aEL(g,"touchend",alp.bindF(c,null,"touchend"),e),alp.aEL(g,"mousedown",alp.bindF(c,null,"mousedown"),e),alp.aEL(g,"mouseup",alp.bindF(c,null,"mouseup"),e)],m=d&&d.doNotStop;return b._alpRemover=b;var l,r,n,q,p,h};alp.supportsTouch=alp.memF('"ontouchstart" in alp.cE("div")');alp.touchFollow=function(g,f,e,d,b){function c(){for(var a=m.length;a--;)alp.rEL(m[a])}var a="object"===
typeof e?e:alp.arr2o(h,alp.f(),function(){return e}),m=alp.map(h,function(b){return k(g,f,b,function(c){"touchstart"!==b&&l||(l={},r={},n={});c||(c=window.event);q||alp.stopEvent(c);var d=alp.Aps.call(c.touches);"touchend"===b&&(d=d.concat(alp.map(alp.Aps.call(c.changedTouches||[]),"alp.mix({},v,{touchend:true})")));d.sort(function(a,b){return a.identifier-b.identifier});var e=alp.arr2o(d,"identifier",alp.f("{ x : v.pageX, y : v.pageY, pageX : v.pageX, pageY : v.pageY, clientX : v.clientX, clientY : v.clientY, identifier : v.identifier }")),
m=alp.arrSorted(alp.map(d,".identifier"));d=alp.map(m,"this[v]",e);var f=m.join(",");m=f in l?l[f]:l[f]=e;var p=f in r?r[f]:r[f]=d,g=Date.now?Date.now():+new Date;f=f in n?n[f]:n[f]=g;a[b]({eventname:b,durationMs:g-f,isStart:"touchstart"===b,isEnd:"touchend"===b,tObj:e,tObj_start:m,tArr:d,tArr_start:p,target:c.target||window.target},c)},d)}),l,r,n,q=b&&b.doNotStop;return c._alpRemover=c}}})();"undefined"!==typeof dojo&&dojo.provide("alp.content.track");
(function(){function k(b){var c=b.proj,a=b.aspect,m=!!b.api,l=!m&&b.id,g=!m&&l instanceof Array,n=!!b.nocache;if("api-xalps-red-bull"!==c){alp.forEach([c,a,m?" ":g?l[0]:l],"(v||null).substring.call.a");c=n?{}:alp.sub(c+"##"+a,d,!0);if(l)if(g){l=alp.filter(l,"!(v in this)",c);if(!l.length)return;alp.forEach(l,"this[v]=1",c);b=alp.oCreateMix(b,{id:l})}else{if(l in c)return;c[l]=1}e||(e=alp.cE("div",alp.body(),{style:"display:none"}));b=alp.tmpl(f["content_track_"+(m?"api":g?"many":"one")](),b);b=alp.cE("img",
e,{src:b,style:"width: 1px; height: 1px;",width:"1",height:"1"});alp.asyncF(3E4,"orphan",alp)(b)}}function h(b,c,a){a=a&&(a.eh||a.hg);var d=this.cont,e={proj:this.proj,id:this.id,many:this.many};d.childNodes.a;b="string"===typeof b?alp.gEBCN(b,d):alp.fVal(b,d);alp.m(a,"push",alp.aELtouchup(b,function(){g.track(alp.oCreateMix(e,{aspect:c}))},!0,{doNotStop:!0}))}var g=alp.sub("alp.content",null,!0),f=alp.cfg.url;g.track=k;g.trackApi=function(b){(b.aspect||null).substring.call.a;k(alp.oCreateMix(b,{api:!0}))};
g.trackDetail=function(b){k(alp.oCreateMix(b,{aspect:"detail"}))};g.trackDetailTab=function(b){k(alp.oCreateMix(b,{aspect:"clickTab"}))};g.trackGPX=function(b){k(alp.oCreateMix(b,{aspect:"gpx"}))};g.trackKML=function(b){k(alp.oCreateMix(b,{aspect:"kml"}))};g.trackTeaser=function(b){k(alp.oCreateMix(b,{aspect:"teaser"}))};g.installTrackClick=h;g.installTrackClickMany=function(b,c,a){alp.forIn(c,function(b,c){alp.now(h,this,c,b,a)},b)};var e,d={}})();"undefined"!==typeof dojo&&dojo.provide("alp.gmap3");
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.latlngbounds");alp.gmap3(function(k){k=k.LatLngBounds.prototype;var h="union";k[h]||(k[h]=function(g){this.extend(g.getSouthWest());this.extend(g.getNorthEast())});h="contains";k[h]=k[h]||k.containsLatLng;h="containsBounds";k[h]||(k[h]=function(g){return this.contains(g.getSouthWest())&&this.contains(g.getNorthEast())&&this.contains(g.getCenter())})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.mercatorprojection_gen");
(function(){alp.sub("alp._gmap2_3",null,!0).MercatorProjectionGen=function(k){function h(a){}var g=Math,f=g.PI,e=g.log,d=g.sin,b=g.atan,c=g.exp,a=128/f;g=h.prototype;g.fromLatLngToPoint=function(b,c){c=c||new k.Point(0,0);var l=b.lat();b=b.lng();c.x=128+a*b*f/180;b=128-a*e((1+d(l*f/180))/(1-d(l*f/180)))/2;c.y=b;return c};g.fromPointToLatLng=function(d,e){var l=d.x;d=180*(f/2-2*b(c((d.y-128)/a)))/f;return new k.LatLng(d,(l-128)/a*180/f,e)};return h}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.mercatorprojection");
alp.gmap3(function(k){var h=alp._gmap2_3;h.earth_radius=function(){return 6378137};k.MercatorProjection||(k.MercatorProjection=h.MercatorProjectionGen(k))});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.latlngzd");
alp.gmap3(function(k){function h(b,c,d,e,h){f.apply(this,arguments);e.toPrecision.call.a;null==h||h.toPrecision.call.a;l||g(this);this[a]=e;this[m]=h}function g(f){if(!l){for(f||(f=new e.LatLngZD(0,0,!1,0));(a=b+d)in f||(m=c+d)in f;)d++;l=!0}}(new k.LatLng(0,0)).lat.call.a;var f=k.LatLng,e=alp.sub("alp._gmap2_3",null,!0);e.LatLngZD=h;alp.mix(h.prototype=new f(0,0),{z:function(){return this[a]},d:function(){return this[m]},setD:function(a){a.toPrecision.call.a;this[m]=a}});alp.mix(h,{getALPZ:function(){l||
g();return a}});var d="",b="__alpZ__",c="__alpD__",a,m,l});"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.geodesic");
(function(){function k(b,a,e){var c=d*(a[0]-b[0]);b=d*b[1];var f=d*a[1];a=g.cos(c)*g.cos(f)-g.cos(b);c=g.sin(c)*g.cos(f);b=g.sin(f)-g.sin(b);c=g.sqrt(a*a+c*c+b*b);return 2*g.asin(c/2)*(e||6378137)}var h=alp.sub("alp.maps.geodesic",null,!0),g=Math,f=g.PI,e=2*f,d=f/180,b=180/f;h.EARTH_RADIUS=6378137;h.distance_xy=k;h.distance_xyz_approx=function(b,a,d){3<=b.length||(b=[b.x,b.y,b.z]);3<=a.length||(a=[a.x,a.y,a.z]);d=k(b,a,d);b=a[2]-b[2];return Math.sqrt(d*d+b*b)};h.getNewRangeTiltForDZ=function(c,a){var e=
c.rangeMeters,l=d*(90-c.tilt_degrees);c=e*g.sin(l);e*=g.cos(l);a=c+a;a=g.sqrt(e*e+a*a);e=b*g.asin(e/a);alp.isFiniteNumber(a+e)||null.bug;return{rangeMeters:a,tilt_degrees:e}};h.getNorthHeadingXYXY=function(c,a,e,l){a*=d;l*=d;c=d*e-d*c;e=g.cos(l);for(a=b*g.atan2(g.sin(c)*e,g.cos(a)*g.sin(l)-g.sin(a)*e*g.cos(c));360<a;)a-=360;for(;0>a;)a+=360;return a};h.getObserverXYZ=function(c,a){var m=a&&a.range_factor;alp.isFiniteNumber(m)||(m=1);a=d*(c.heading_degrees+180);var l=d*(90-c.tilt_degrees),r=m*c.rangeMeters;
m=r*g.sin(l);r*=g.cos(l);l=m+g.sqrt(r*r+40680631590769)-6378137;var n=g.atan2(r,6378137);r=c.x*d;var q=c.y*d;m=g.asin(g.sin(q)*g.cos(n)+g.cos(q)*g.sin(n)*g.cos(a));a=g.atan2(g.sin(a)*g.sin(n)*g.cos(q),g.cos(n)-g.sin(q)*g.sin(m));a=((r+a+f)%e-f)*b;m*=b;c=c.z+l;l=[a,m,c];"number"===typeof a&&!isNaN(a)&&isFinite(a)&&"number"===typeof m&&!isNaN(m)&&isFinite(m)&&"number"===typeof c&&!isNaN(c)&&isFinite(c)||null.bug_or_wrong_data;return l}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.util");
alp.gmap3(function(k){var h=alp._gmap2_3,g=alp.maps.geodesic;h.bbox2bounds=function(f){return new k.LatLngBounds(new k.LatLng(f[1],f[0],!0),new k.LatLng(f[3],f[2],!0))};h.bounds2bbox=function(f){var e=f.getSouthWest();f=f.getNorthEast();return h.latlng2xy(e).concat(h.latlng2xy(f))};h.getNorthHeading=function(f,e){2!==f.length&&"lat"in f&&"lng"in f&&(f=[f.lng(),f.lat()]);2!==e.length&&"lat"in e&&"lng"in e&&(e=[e.lng(),e.lat()]);return g.getNorthHeadingXYXY(f[0],f[1],e[0],e[1])};h.getNorthHeadingXYXY=
g.getNorthHeadingXYXY;h.getViewportLocationFromString=function(f){f=alp.map((""+f).split(","),'alp.map( v.split(" "), parseFloat )');f=h.xy2latlng(f);if(2>f.length)return{location:f[0]};f=new k.LatLngBounds(f[0],f[1]);var e=f.getCenter();return{viewport:f,location:e}};h.xyBbox=function(f){var e=[Infinity,Infinity,-Infinity,-Infinity];alp.forEach(f,"this[0] = Math.min( this[0], v[0]);this[1] = Math.min( this[1], v[1]);this[2] = Math.max( this[2], v[0]);this[3] = Math.max( this[3], v[1]);",e);e.xmin=
e[0];e.ymin=e[1];e.xmax=e[2];e.ymax=e[3];return e};h.xyD2=function(f,e){var d=f.x-e.x;f=f.y-e.y;return d*d+f*f};h.latlng2xy=alp.mapFlexF("elt instanceof this","[ elt.lng(), elt.lat() ]",k.LatLng);h.xy2latlng=alp.mapFlexF("typeof elt[0] === 'number'","new this( elt[1], elt[0] )",k.LatLng);h.xyzd2latlngzd=alp.mapFlexF("typeof elt[0] === 'number'","new alp._gmap2_3.LatLngZD( elt[1], elt[0], false, elt[2], elt[3] )")});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.projection");
alp.gmap3(function(k){var h=alp._gmap2_3,g=function(){var f=new k.LatLng(0,0);return(g=function(){return f})()};h.equalProjection=function(f,e){if(!f||!e)return!1;if(f===e)return!0;var d=g();if(f.fromLatLngToPoint&&e.fromLatLngToPoint)return alp.m(f.fromLatLngToPoint(d),"equals",e.fromLatLngToPoint(d));if(f.fromLatLngToPixel&&e.fromLatLngToPixel)return alp.m(f.fromLatLngToPixel(d,0),"equals",e.fromLatLngToPixel(d,0))};h.isProjection=function(f){var e=alp.sub("GProjection");return f&&e&&f instanceof
e?!0:f&&"function"===typeof f.fromLatLngToPoint&&"function"===typeof f.fromPointToLatLng};h.fromContainerPixelToLatLng=function(f,e){if(f.fromContainerPixelToLatLng)return f.fromContainerPixelToLatLng(e);var d=f.getDiv(),b=f.getProjection(),c=f.getZoom();f=f.getBounds();if(d&&b&&null!=c&&f)return d=f.getNorthEast(),f=f.getSouthWest(),d=h.fromLatLngToPixel(b,new k.LatLng(d.lat(),f.lng()),c),h.fromPixelToLatLng(b,new k.Point(d.x+e.x,d.y+e.y),c)};h.fromLatLngToContainerPixel=function(f,e){if(f.fromLatLngToContainerPixel)return f.fromLatLngToContainerPixel(e);
var d=f.getDiv(),b=f.getProjection(),c=f.getZoom();f=f.getBounds();if(d&&b&&null!=c&&f)return d=f.getNorthEast(),f=f.getSouthWest(),d=h.fromLatLngToPixel(b,new k.LatLng(d.lat(),f.lng()),c),e=h.fromLatLngToPixel(b,e,c),new k.Point(e.x-d.x,e.y-d.y)};h.fromLatLngToDivPixel=function(f,e){if(f.fromLatLngToDivPixel)return f.fromLatLngToDivPixel(e);throw Error("alp._gmap2_3.fromLatLngToDivPixel() not implemented yet for V3! For OverlayView, consider using MapCanvasProjection's fromLatLngToDivPixel");};h.fromLatLngToPixel=
function(f,e,d){var b=f.fromLatLngToPixel&&f.fromLatLngToPixel(e,d);if(b)return b;if(e=f.fromLatLngToPoint&&f.fromLatLngToPoint(e)){var c=f._alp_p00||(f._alp_p00=f.fromLatLngToPoint(g()));b=c&&c.x<<1;c=c&&c.y<<1;f=h.getWrapWidth(f,d);if(e&&b&&c&&f)return new k.Point(Math.round(e.x/b*f),Math.round(e.y/c*f))}};h.fromLatLngToPoint=function(f,e){if(f.fromLatLngToPoint)return f.fromLatLngToPoint(e);if(f.fromLatLngToPixel){var d=f.fromLatLngToPixel(g(),0),b=f.fromLatLngToPixel(g(),30);f=f.fromLatLngToPixel(e,
30);return new k.Point(f.x/b.x*d.x,f.y/b.y*d.y)}};h.fromLatLngToUnitPoint=function(f,e){var d=h.fromLatLngToPoint(f,g());f=h.fromLatLngToPoint(f,e);return new k.Point(f.x/d.x/2,f.y/d.y/2)};h.fromPixelToLatLng=function(f,e,d){if("fromPixelToLatLng"in f)return f.fromPixelToLatLng(e,d);if("fromPointToLatLng"in f){d=h.getWrapWidth(f,d);var b=alp.m(f,"fromLatLngToPoint",g())||new k.Point(128,128);return f.fromPointToLatLng(new k.Point(e.x/d*2*b.x,e.y/d*2*b.y))}};h.getProjection=function(f){return alp.m(f,
"getProjection")||alp.m(alp.m(f,"getCurrentMapType"),"getProjection")};h.getProjectionDfrd=function(f){return alp.subDfrd(function(){return h.getProjection(f)})};h.getWrapWidth=function(f,e){var d=f._alpWW||(f._alpWW={});return d[e]||(d[e]=f.getWrapWidth&&f.getWrapWidth(e)||1<<e+8)}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.zoomcenter");
alp.gmap3(function(k){function h(d,b,c){function a(a){a=a.match(/^([\-\+\d]+)px$/i);return(a&&a[1])|0}var e=0,l=0,f=0,g=0;if("number"===typeof c)e=l=d*c,f=g=b*c;else if("string"===typeof c)e=l=f=g=a(c);else if("object"===typeof c){var q=c.left,p=typeof q;"number"===p?e=d*q:"string"===p&&(e=a(q));q=c.right;p=typeof q;"number"===p?l=d*q:"string"===p&&(l=a(q));q=c.top;p=typeof q;"number"===p?f=b*q:"string"===p&&(f=a(q));q=c.bottom;p=typeof q;"number"===p?g=b*q:"string"===p&&(g=a(q))}return{left:e,right:l,
top:f,bottom:g}}function g(d){if("string"===typeof d){var b=alp.gEBI(d)||alp.gEBCN(d)[0]||alp.f(d)();var c=alp.gBCR(b)}else"parentNode"in d&&(d=alp.gBCR(d));b=(c||d).width;d=(c||d).height;0<b&&0<d||(console.error("alp._gmap2_3.bounds2zoom() requires mapWidth > 0 && mapHeight > 0  (given values: mapWidth: "+b+", mapHeight: "+d+")"),d=b=600,console.error("alp._gmap2_3.bounds2zoom(): falling back on mapWidth:"+b+", mapHeight:"+d));return{width:b,height:d}}var f=alp.sub("alp._gmap2_3",null,!0),e=new k.MercatorProjection(31);
f.getPadding=h;f.getWidthHeight=g;f.zoomcenter=function(d){var b=d.center,c=d.zoom,a=d.wh,m=alp.fVal(d.padding),l=d.proj||e;b.lat.call.a;b.lng.call.a;c.toPrecision.call.a;if(!m)return alp.opt(d,["zoom","center"]);var r=g(a);a=r.width;r=r.height;var n=h(a,r,m),q=n.left,p=n.right;m=n.top;n=n.bottom;if(q===p&&m===n)return alp.opt(d,["zoom","center"]);d=(q+a-p)/2-a/2;a=(m+r-n)/2-r/2;b=f.fromLatLngToPixel(l,b,c);b=new k.Point(b.x-d,b.y-a);return{center:f.fromPixelToLatLng(l,b,c),zoom:c}}});
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.bounds2zoomcenter");
alp.gmap3(function(k){var h=alp._gmap2_3,g=new k.MercatorProjection(31),f=alp.f("!=null");h.bounds2zoomcenter=function(e,d,b){if(e instanceof k.LatLngBounds){var c=e.getSouthWest();var a=e.getNorthEast();var m=e.getCenter();var l=c.lat();var r=c.lng();e=a.lat();var n=a.lng()}else r=e[0],l=e[1],n=e[2],e=e[3],c=new k.LatLng(l,r,!0),a=new k.LatLng(e,n,!0),m=new k.LatLng((l+e)/2,(r+n)/2,!0);for(;n<r;)n+=360;var q=(n+r)/2;b=alp.mix({proj:g,maxZoom:15,minZoom:0,padding:.1},alp.filterIn(b,f));"function"===
typeof b.padding&&(b.padding=b.padding());m={zoom:b.minZoom+b.maxZoom>>1,center:m};r=h.getWidthHeight(d);var p=r.width,v=r.height;d=b.proj;r=alp.fVal(b.padding);r=h.getPadding(p,v,r);var u=r.left,t=r.right,w=r.top,x=r.bottom;r=p-u-t;var y=v-w-x;if(1>r)return console.error("alp._gmap2_3.bounds2zoomcenter: left padding + right padding >= mapWidth!",u,t,p),m;if(1>y)return console.error("alp._gmap2_3.bounds2zoomcenter: top padding + bottom padding >= mapHeight!",w,x,v),m;p=b.minZoom;v=r>>1;y>>=1;for(b=
b.maxZoom;b>=p;b--){var z=h.fromLatLngToPixel(d,c,b);var A=h.fromLatLngToPixel(d,a,b);var C=new k.Point((z.x+A.x)/2,(z.y+A.y)/2);var E=new k.Point(C.x-v-u-2,C.y+y+x+2);var G=new k.Point(C.x+v+t+2,C.y-y-w-2);A=h.fromPixelToLatLng(d,E,b);z=h.fromPixelToLatLng(d,G,b);new k.Point((E.x+G.x)/2,(E.y+G.y)/2);E=new k.Point(C.x-v-2,C.y+y+2);G=new k.Point(C.x+v+2,C.y-y-2);C=h.fromPixelToLatLng(d,E,b);G=h.fromPixelToLatLng(d,G,b);E=C;var B=G;C=E.lat();E=E.lng();G=B.lat();for(B=B.lng();B<E;)B+=360;var I=360*Math.round(((E+
B)/2-q)/360);I&&(E-=I,B-=I);if(E<r+1E-9&&n<B+1E-9&&C<l+1E-9&&e+1E-9<G){c=A.lat();a=A.lng();l=z.lat();for(n=z.lng();n<a;)n+=360;return{zoom:b,center:new k.LatLng((c+l)/2,(a+n)/2)}}}return m}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.event");
alp.gmap3(function(k){function h(a,b){return function(c,d,m){"removeListener"===b&&(d||(d=c._wrappedeventname));if("singleclick"===d||"singlerightclick"===d){if("addListener"===b)return c=("singleclick"===d?g:f)(c,m),c._wrappedeventname=d,c;if("removeListener"===b)c();else{if("trigger"===b)return e.event("trigger")(c,d,m);null.unsupported}}else return a(c,d,m)}}function g(a,b){var d=e.event("addListener")(a,"click",function(a){var d=m=Date.now?Date.now():+new Date;g=setTimeout(function(){d===m&&b(a)},
c)}),f=e.event("addListener")(a,"dblclick",function(a){null!=g&&(clearTimeout(g),g=null)});return function(){e.event("removeListener")(d);e.event("removeListener")(f)};var m,g}function f(a,b){var d=alp.m(a,"getDiv");if(d){var f=e.event("addListener")(a,"rightclick",function(a){var d=g=Date.now?Date.now():+new Date;p=setTimeout(function(){d===g&&b(a)},c)}),m=alp.aELdblrightclick(d,function(a){null!=p&&(clearTimeout(p),p=null)},!0,{do_not_stop_event:!0});return function(){e.event("removeListener")(f);
alp.rEL(m)};var g,p}else console.error("AG.event: singlerightclick requires DOM access through `source.getDiv()` (e.g. `gm.Map` instance).")}var e=alp._gmap2_3||(alp._gmap2_3={}),d={},b={bounds_changed:"moveend",maptypeid_changed:"maptypechanged",rightclick:"rightclick",zoom_changed:"zoomend"};e.event=function(a){if(!d[a]){var c=k.Event;(c=k.event||c)&&c[a]&&(d[a]=h(alp.bindF(a,c),a));e.V2()&&d[a]&&"addListener"===a&&function(){var c=d[a];d[a]=function(a,d,l){d in b&&(d=b[d]);return c(a,d,function(b,
c,f){var m=k.LatLng,g={},p=a instanceof k.Map;if("singlerightclick"!==d||!p||!f)if(b instanceof m?g.latLng=b:c instanceof m?g.latLng=c:a.getPosition&&(g.latLng=a.getPosition()),"click"!==d||!p||!b&&g.latLng)"singlerightclick"===d&&p&&!g.latLng&&(g.latLng=e.fromContainerPixelToLatLng(a,b)),l(g)})}}()}var l=a.replace("Once","");d[a]||"addListenerOnce"!==a&&"addDomListenerOnce"!==a||!c||!c[l]||(d[a]=function(a,b,c){var d=e.event(l)(a,b,function(){e.event("removeListener")(d);c.apply(a,arguments)});return d});
return d[a]};var c=500});"undefined"!==typeof dojo&&dojo.provide("alp.gmap3._ggf");
alp.gmap3(function(k){alp.gmap3._ggf=function(h){var g={releaseTile:1},f="getTile";return function(e,d,b){if(!(f in h)){var c=h.getTileUrl(e,d),a=alp.oGet(h,"tileSize.width")||256,m=alp.oGet(h,"tileSize.height")||256;return alp.cE("img",null,{src:c,style:"position: absolute; top: 0; left: 0; width: "+a+"px; height: "+m+"px;"})}if((c=h[f].apply(h,arguments))&&"parentNode"in c)return c;g[f]=1;a={};for(m in h)if(!(m in a||m in g)){if("function"===typeof h[m]){try{c=h[m].apply(h,arguments)}catch(l){c=
null}if(c&&"parentNode"in c)return f=m,c}g[m]=1}return null}}});"undefined"!==typeof dojo&&dojo.provide("alp.cfg.copyright");
(function(){function k(){return/^de$/i.test(alp.i18n.language())?"//www.outdooractive.com/mobile/de/karteninformationen.html":"//www.outdooractive.com/mobile/en/map-information.html"}function h(){alp.gViewportSize();return[{copy_id:"digitalglobe",attrMap:{"class":"osmGCopyright",href:"//www.digitalglobe.com/",target:"_blank",title:"\u00a9 DigitalGloba",rel:"nofollow"},propMap:{innerHTML:"&copy DigitalGlobe"}}]}function g(){alp.gViewportSize();return[{copy_id:"mapbox",attrMap:{"class":"osmGCopyright",
href:"//www.mapbox.com/about/maps/",target:"_blank",title:"\u00a9 Mapbox",rel:"nofollow"},propMap:{innerHTML:"&copy Mapbox"}}]}function f(){var d=alp.gViewportSize();return[{copy_id:"osm",attrMap:{"class":"osmGCopyright",href:"//www.openstreetmap.org/copyright",target:"_blank",title:"\u00a9 OpenStreetMap",rel:"nofollow"},propMap:{innerHTML:"&copy "+(460<Math.min(d.width,d.height)?"OpenStreetMap contributors":"OSM contributors")+", CC-BY-SA"}}]}var e=alp.sub("alp.cfg.copyright",null,!0);e.cesium_credit_bing_maps=
function(){var d=alp.cfg.button().bing_maps_small_white_pad3;return{text:"\u00a9 Bing Maps",img:alp.fixUrlProtocol(d.url),link:alp.fixUrlProtocol(d.href)}};e.cesium_credit_oa=function(){return{text:"\u00a9 outdooractive.com",img:alp.fixUrlProtocol(alp.cfg.button().powered_by_oa.url),link:alp.fixUrlProtocol(k())}};e.link_oa=k;e.map_alpstein=function(){return[{copy_id:"alpstein",attrMap:{"class":"alpGCopyright",href:k(),target:"_blank",title:"\u00a9 outdooractive.com"},propMap:{innerHTML:"&copy outdooractive.com"}}]};
e.map_digitalglobe=h;e.map_mapbox=g;e.map_oa_mb_satellite_streets=function(){return g().concat(h()).concat(f())};e.map_oa_mb_satellite=function(){return g().concat(h())};e.map_osm=f;e.map_metgis=function(){return[{copy_id:"metgis",attrMap:{"class":"alpGCopyright",href:"//metgis.com",target:"_blank",title:"\u00a9 MetGIS Professional Weather Service"},propMap:{innerHTML:"&copy MetGIS Professional Weather Service"}}]}})();"undefined"!==typeof dojo&&dojo.provide("alp.cfg.image");
alp.sub("alp.cfg",null,!0).image=function(){return{is_panorama:function(k){var h=k.isPanoramaImage;return null!=h?h:k.width>=2.5*k.height},is_video:alp.f(".isVideo"),loadbar:{url:alp.urlCachebust(alp.cssBase()+"alp/images/loadbar.gif"),width:128,height:15},transp_1x1:{url:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",width:1,height:1},grid256_16_16_black:{width:256,height:256,url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMAUExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALMw9IgAAAEAdFJOU////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wBT9wclAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGHRFWHRTb2Z0d2FyZQBwYWludC5uZXQgNC4wLjlsM35OAAAEPElEQVR4Xu2QIY5FURSDZv+bfmNAfF9Bci6mwSD69/h+OefzICt5nwdZyfs8yEre50FW8j4PspL3eZCVvM+DrOR9HmQl7/MgK3mfB1nJ+zzISt7nQVbyPg+ykvd5kJW8P3hCzvk8yEre50FW8j4PspL3eZCVvM+DrOR9HmQl7/MgK3mfB1nJ+zzISt7nQVbyPg+ykvd5kJW8z4Os5H0eZCXvD56Qcz4PspL3eZCVvM+DrOR9HmQl7/MgK3mfB1nJ+zzISt7nQVbyPg+ykvd5kJW8z4Os5H0eZCXv8yAreZ8HWcn7gyfknM+DrOR9HmQl7/MgK3mfB1nJ+zzISt7nQVbyPg+ykvd5kJW8z4Os5H0eZCXv8yAreZ8HWcn7PMhK3udBVvL+4Ak55/MgK3mfB1nJ+zzISt7nQVbyPg+ykvd5kJW8z4Os5H0eZCXv8yAreZ8HWcn7PMhK3udBVvI+D7KS93mQlbw/eELO+TzISt7nQVbyPg+ykvd5kJW8z4Os5H0eZCXv8yAreZ8HWcn7PMhK3udBVvI+D7KS93mQlbzPg6zkfR5kJe8PnpBzPg+ykvd5kJW8z4Os5H0eZCXv8yAreZ8HWcn7PMhK3udBVvI+D7KS93mQlbzPg6zkfR5kJe/zICt5nwdZyfuDJ+Scz4Os5H0eZCXv8yAreZ8HWcn7PMhK3udBVvI+D7KS93mQlbzPg6zkfR5kJe/zICt5nwdZyfs8yEre50FW8v7gCTnn8yAreZ8HWcn7PMhK3udBVvI+D7KS93mQlbzPg6zkfR5kJe/zICt5nwdZyfs8yEre50FW8j4PspL3eZCVvD94Qs75PMhK3udBVvI+D7KS93mQlbzPg6zkfR5kJe/zICt5nwdZyfs8yEre50FW8j4PspL3eZCVvM+DrOR9HmQl7w+ekHM+D7KS93mQlbzPg6zkfR5kJe/zICt5nwdZyfs8yEre50FW8j4PspL3eZCVvM+DrOR9HmQl7/MgK3mfB1nJ+4Mn5JzPg6zkfR5kJe/zICt5nwdZyfs8yEre50FW8j4PspL3eZCVvM+DrOR9HmQl7/MgK3mfB1nJ+zzISt7nQVby/uAJOefzICt5nwdZyfs8yEre50FW8j4PspL3eZCVvM+DrOR9HmQl7/MgK3mfB1nJ+zzISt7nQVbyPg+ykvd5kJW8P3hCzvk8yEre50FW8j4PspL3eZCVvM+DrOR9HmQl7/MgK3mfB1nJ+zzISt7nQVbyPg+ykvd5kJW8z4Os5H0eZCXvD56Qcz4PspL3eZCVvM+DrOR9HmQl7/MgK3mfB1nJ+zzISt7nQVbyPg+ykvd5kJW8z4Os5H0eZCXv8yAreZ8HWcn7gyfknM+DrOR9HmQl7/MgK3mfB1nJ+zzISt7nQVbyPg+ykvd5kJW8z4Os5H0eZCXv8yAreZ8HWcn7PMhK3udBVtr+ff8f7iwhyrD7CQAAAABJRU5ErkJggg=="},
grid256_16_16_green:{width:256,height:256,url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAB3RJTUUH4QEXDiMDzFwvwAAAAtlJREFUeNrt3LENgDAAA8HA/jvDEDRGf9e7fSmRkus85zlA1NcA2Nvb/3Z/KyB0CQAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgD8xOU/ACjzntrePrt3BAB3AIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAMA6/wFAmvfU9vbZvSMAuAMABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEA1vkPANK8p7a3z+4dAcAdACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIALDOfwCQ5j21vX127wgA7gAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQACAdf4DgDTvqe3ts3tHAHAHAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAKzzHwCkeU9tb5/dOwKAOwBAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABgnf8AIM17anv77N4RANwBAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAOv8BwBp3lPb22f3jgDgDgAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABABY5z8ASPOe2t4+u3cEAHcAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAwDr/AUCa99T29tm9IwC4AwAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQDW+Q8A0ryntrfP7h0BwB0AIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAsM5/AJDmPbW9fXbvCADuAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAIB1/gOANO+p7e2ze0cAcAcACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIArPMfAKR5T21vn907AoA7AEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAGCd/wAgzXtqe/vs3hEA3AEAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAA617Dix/P/N672QAAAABJRU5ErkJggg=="},
grid256_16_16_white:{width:256,height:256,url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAB3RJTUUH4QEXDi0w7Q9jWAAAAtlJREFUeNrt3LENgDAAA0Fg/53DEDRGf9e7fSmRkvuccy6g6WsA7O3t/7t/JBC6BAAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQB+4vYfAIR5T21v3907AoA7AEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAGCd/wCgzHtqe/vu3hEA3AEAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAA6/wHAGXeU9vbd/eOAOAOABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEAFjnPwAo857a3r67dwQAdwCAAAACAAgAIACAAAACAAgAIACAAAACAAgAIADAOv8BQJn31Pb23b0jALgDAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABANb5DwDKvKe2t+/uHQHAHQAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACACwzn8AUOY9tb19d+8IAO4AAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAgHX+A4Ay76nt7bt7RwBwBwAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgCs8x8AlHlPbW/f3TsCgDsAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAYJ3/AKDMe2p7++7eEQDcAQACAAgAIACAAAACAAgAIACAAAACAAgAIACAAADr/AcAZd5T29t3944A4A4AEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAWOc/ACjzntrevrt3BAB3AIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAMA6/wFAmffU9vbdvSMAuAMABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEA1vkPAMq8p7a37+4dAcAdACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIALDOfwBQ5j21vX137wgA7gAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQACAdS8F9j3NjBdepAAAAABJRU5ErkJggg=="}}};
"undefined"!==typeof dojo&&dojo.provide("alp.cfg.maptileproject");(function(){var k=alp.sub("alp.cfg",null,!0);k.maptileproject=function(){return h||(h=alp.sub("oa.API_CFG.proj")||"alpregio.Facade"===alp.sub("instance.declaredClass")&&alp.sub("instance._config.proj")||"object"===typeof alp.sub("alpcms.pages")&&"alpcms"||null)};k.maptileurlend=function(){if(!g){var f=k.maptileproject();g=f?"?project="+f:""}return g};var h,g})();"undefined"!==typeof dojo&&dojo.provide("alp.cfg.mapbox");
(function(){alp.cfg.mapbox={access_token:function(){return alp.sub("alpConfig.mapbox.access_token")||"pk.eyJ1Ijoib3V0ZG9vcmFjdGl2ZSIsImEiOiJjaXVxdmJkaGgwMDBnMm9wZm83cnAzbWxjIn0.MNrnQfnXgOx7W8V5nFaO6w"}}})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.leaflet.vector_layer_const");(function(){var k=alp.sub("alp.maps.leaflet",null,!0),h=/[\?&]proto=(?:[^&]+,)?vector(?:,|&|$)/.test(location.search);k.is_vector_active=alp.f(h)})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.utfgrid");
(function(){function k(g,f){g=g.charCodeAt(f);93<=g&&g--;35<=g&&g--;return g-32}var h=alp.sub("alp.maps.utfgrid",0,1);h.decode=k;h.getProp=function(g,f,e){var d=g.keys,b=g.grid;g=g.data;var c=b.length,a=c-1,m=Math.max(0,Math.min(a,Math.round(f*c)));c=Math.max(0,Math.min(a,Math.round(e*c)));b=k(b[c],m);d=d[b];return{x_prop:f,y_prop:e,row:c,col:m,key:d||null,data:d&&g&&g[d]||null}};h.getSome=function(g,f){var e=g.keys,d=g.grid;g=g.data;for(var b=d.length,c=[],a=0;a<b;a++)for(var m=d[a],l=a/b,r=0;r<
b;r++){var n=r/b,q=k(m,r);q=e[q];c.push({x_prop:n,y_prop:l,row:a,col:r,key:q||null,data:q&&g&&g[q]||null})}return f?f(c):c}})();"undefined"!==typeof dojo&&dojo.provide("alp.util.search");
(function(){function k(b,c,a,d,l){if("string"===typeof d)d=alp.f(d);else var m=d instanceof Array;c=[f.min(c,a),f.max(c,a)];a=l&&l.that;l=alp.oCreateMix(e,l);var g=l.precision;if(m?d[Math.round(c[0])]>d[Math.round(c[1])]:d.call(a,c[0])>d.call(a,c[1]))throw Error("alp.util.dichotomy(): get_value_increasing must return increasing values!");var q=m?d[Math.round(c[1])]:d.call(a,c[1]),p=m?d[Math.round(c[0])]:d.call(a,c[0]);if(b>g+q)throw Error("alp.util.dichotomy(): maximum too low!");if(b+g<p)throw Error("alp.util.dichotomy(): minimum too high!");
b=Math.max(p,Math.min(q,b));var h=l.niter_max;for(p=0;f.abs(c[1]-c[0])>g&&p<h;p++)l=(c[0]+c[1])/2,q=m?d[Math.round(l)]:d.call(a,l),c[q<b?0:1]=l;return(c[0]+c[1])/2}function h(b,c){c=c?alp.oCreateMix(d,c):d;return{length:function(){return b.length},compare_fun:function(a,d){return c.data_compare_fun(b[a],d)},equals_fun:c.data_equals_fun&&function(a,d){return c.data_equals_fun(b[a],d)},other_opts:{read_only_optim:c.read_only_optim,data_compare_fun:c.data_compare_fun}}}var g=alp.util||(alp.util={}),
f=Math,e={niter_max:100,precision:0};g.arrSoftIndex=function(b,c,a){var d=b.length-1;if(1>d)return{ind:0,ind0:0,ind1:0,v0:b[0],v1:b[0],prop:0};for(var e=Math.round(k(c,0,d,b));e<d&&c>b[e+1];)e++;for(;e&&c<b[e];)e--;d=e;var f=e+1,g=b[d];b=b[f];c=g<b?(c-g)/(b-g):0;a||(a={});a.ind0=d;a.ind1=f;a.v0=g;a.v1=b;a.prop=c;a.soft_ind=e+c;return a};g.funSoftIndex=function(b,c,a){var d=a.first||0;a=a.last;d.toPrecision.call.a;a.toPrecision.call.a;if(1>a-d)return{ind:d,v0:b(d),v1:b(d),prop:0};for(var e=Math.round(k(c,
d,a,b));e<a&&c>b(e+1);)e++;for(;e>d&&c<b(e);)e--;d=e;e+=1;var f=b(d);b=e<=a?b(e):NaN;c=f<b?(c-f)/(b-f):0;return{ind0:d,ind1:e,v0:f,v1:b,prop:c,ind_prop:d+c}};g.dichotomy=k;g.add_sortedsearch=function(b,c){b.sortedsearch&&console.error("alp.util.add_sortedsearch: array already has `sortedsearch` method... Overwriting it. array:",b);var a=h(b,c),d=new g.SortedDataSearcher(a.length,a.compare_fun,a.equals_fun,a.other_opts);b[c&&c.methodname||"sortedsearch"]=function(){return d.search.apply(d,arguments)};
return b};g.sortedsearch=function(b,c,a){c=h(c,a);return(new g.SortedDataSearcher(c.length,c.compare_fun,c.equals_fun,c.other_opts)).search(b,a&&a.first,a&&a.last)};var d={data_compare_fun:function(b,c){return b==c?0:b<c?-1:b>c?1:0},data_equals_fun:null};alp.declare("alp.util.SortedDataSearcher",null,function(b,c,a,d){var e=this;e.length=b;e.compare_fun=c;e.equals_fun=a||function(a,b){return 0===e.compare_fun(a,b)};e.read_only_optim_fun=alp.opt(d,"read_only_optim")&&alp.opt(d,"data_compare_fun")},
{_length:function(){return"function"===typeof this.length?this.length():this.length},search:function(b,c,a,d){if(this.read_only_optim_fun){d=d||null==c&&null==a;var e=this._prev_result;if(e&&(null==c||null==a)){var m=this.read_only_optim_fun(b,e.data);null==a&&0>m&&(a=e.first-1);null==c&&0<m&&(c=e.last+1)}}null==c&&(c=0);null==a&&(a=this._length()-1);if(!(a<c)){if(void 0===b)return{first:c,last:a};if(!(0<this.compare_fun(c,b)||0>this.compare_fun(a,b))){e=-1<a&&this.equals_fun(c,b);m=-1<a&&this.equals_fun(a,
b);var g=a-c,q=a-c,p,h;if(e&&!m){var k=a-c;if(0<k&&0<this.compare_fun(c+1,b))return{first:c,last:c};if(1<k&&0<this.compare_fun(c+2,b))return{first:c,last:c+1};if(2<k&&0<this.compare_fun(c+3,b))return{first:c,last:c+2}}else if(!e&&m){k=a-c;if(0<k&&0>this.compare_fun(a-1,b))return{first:a,last:a};if(1<k&&0>this.compare_fun(a-2,b))return{first:a-1,last:a};if(2<k&&0>this.compare_fun(a-3,b))return{first:a-2,last:a}}for(;!(a<=c||e&&m||t);){var t=a-c;e||(p=f.max(1,f.min(g,t)>>1));m||(h=f.max(1,f.min(q,t)>>
1));t=g===p&&q===h;g=p;q=h;if(!e){k=f.max(c+1,f.min(a,c+g));var w=this.compare_fun(k,b);var x=0===w;if(0>w||k===c+1)c=k,e=x,t=!1}!m&&(k=f.min(a-1,f.max(c,a-q)),w=this.compare_fun(k,b),x=0===w,0<w||k===a-1)&&(a=k,m=x,t=!1)}if(!(a<c)&&e&&m)return d&&(this._prev_result={data:b,first:c,last:a}),{first:c,last:a}}}}})})();"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.cfg");
(function(){var k=alp.maps,h=k.utfgrid,g=alp.util.arrSoftIndex,f=alp.cfg,e=f.mapbox,d=alp.cfg.copyright,b=k.leaflet.is_vector_active();alp.i18n.fetch("alp.all");alp.gmap3(function(c){function a(a){a=Math.max(1,1+Math.min(a.timeStepNumber,(w-new Date(a.forecastIssued))/(a.timeStep*("h"===a.timeStepUnit?36E5:null.unsupported))));(a||null).toPrecision.call.a;return a}function m(a,b,c){var d=Math.min(y,a.length),e=c&&c.transform;return function(c,l){if(e){var f=e(c,l);"zoom"in f&&(l=f.zoom);"tile"in f&&
(c=f.tile)}l|=0;f=c.x;c=c.y;var m=1<<l,g=this.minZoom,p=this.maxZoom;if(null!=g&&l<(g|0)||null!=p&&l>(p|0))return"";0>f?f=f%m+m:f>=m&&(f%=m);if(0>c||c>=m)return"";l=[a[(f+c)%d||0],l,f,c+b].join("/");/\?/.test(l)||(l+=alp.cfg.maptileurlend());return l}}function l(b,d){(d||null).substring.call.a;return{getTileUrl:alp.f('"'+alp.cfg.image().transp_1x1.url+'"'),tileSize:new c.Size(256,256),isPng:!0,minZoom:0,maxZoom:17,name:function(){return q&&q["metgis_"+d]||"metgis_"+d+" (i18n missing)"},opacity:.5,
_lfgm_customTile:{loadTileData:function(c,e){var l=alp.dfrd("mgcs:"+d+":loadTileData",{then:1});x().then(function(c){var e=c.responseJson;c=e.timeStepNumber;e=a(e);c=alp.gmap3.cfg.getTileUrl["metgis_"+d](b,Math.max(1,Math.min(c,Math.round(e))));l.done(c)});return l},receiveTileData:function(a,b,c,d){alp.aC(alp.empty(b),alp.cE("img",null,{src:d(c,c.z),style:"position: absolute; top: 0; left: 0"}))}}}}var r=location.protocol.replace(/^file:$/i,"http:")||"http:",n=[0,1,2,3],q={},p=[-108.00917744636536,
38.99295499697165,-105.97666382789612,40.016851361487134],k=[18.41858,58.61692,36.33179,70.98119],u=alp.sub("alpConfig.tileServerDomain")||"w*.outdooractive.com",t=alp.sub("alpConfig.metgisKey")||"ra3ZKwzHgyyuFMfi2C1O2dnXDGgI6qrWQ3IfSb5Fp6PsjLOWN",w=new Date,x=alp.memF(function(){return alp.xhrGet(f.url.metgis_meta(),{sendJson:!1,receiveJson:!0})});alp.i18n.fetch("alp.all").then(function(a){q=a});alp.gmap3.cfg={bbox:{USGSTopo:function(){return p.slice()},fi_topo:function(){return k.slice()}},button_to_3d:function(){return{div:alp.cE("img",
null,{alt:"3D Karte",src:alp.cssBase()+"alp/gmap3/images/3d_map_button.png"})}},default_metgis_key:function(){return t},domains:function(){return n},getTileUrl:{AlpsteinCHESummer:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/AlpsteinCHESummer").replace("*",a)}),".png")},AlpsteinCHEWinter:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/AlpsteinCHEWinter").replace("*",a)}),".png")},AlpsteinSummer:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/AlpsteinSummer").replace("*",
a)}),".png")},AlpsteinWinter:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/AlpsteinWinter").replace("*",a)}),".png")},at:function(){return m(alp.map(n,function(a){return r+("//"+u+"/austria/map").replace("*",a)}),".png")},at_topo:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/AUTTopo").replace("*",a)}),".png")},avalanche_transp:function(){return this.slope()},slope:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/xGradient").replace("*",a)}),".png")},
ch:function(){return m(alp.map(n,function(a){return r+("//"+u+"/ch/map").replace("*",a)}),".png")},ch_topo:function(){return m(alp.map(n,function(a){return r+("//"+u+"/ch/topo").replace("*",a)}),".png")},cycling:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/xRad").replace("*",a)}),".png")},cz:function(){return m(alp.map(n,function(a){return r+("//"+u+"/cz/map").replace("*",a)}),".png")},de:function(){return m(alp.map(n,function(a){return r+("//"+u+"/portal/map").replace("*",a)}),
".png")},de_topo:function(){return m(alp.map(n,function(a){return r+("//"+u+"/portal/topo").replace("*",a)}),".png")},es:function(){return m(alp.map(n,function(a){return r+("//"+u+"/es/map").replace("*",a)}),".png")},fi_topo:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/v1/raster/topo_mml").replace("*",a)}),"/t.png")},hiking:function(){return b?m(alp.map(n,function(a){return r+("//"+u+"/map/jpg/osm_routes").replace("*",a)}),"/t.png",{transform:function(a,b){return{zoom:b-1}}}):
m(alp.map(n,function(a){return r+("//"+u+"/map/xWandern3").replace("*",a)}),".png")},horseback:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/xReiten").replace("*",a)}),".png")},hybrid_transp:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/AlpsteinHybrid").replace("*",a)}),".png")},it:function(){return m(alp.map(n,function(a){return r+("//"+u+"/it/map").replace("*",a)}),".png")},longDistanceCycling:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/xRadFern").replace("*",
a)}),".png")},longDistanceHiking:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/xWandernFern").replace("*",a)}),".png")},mountainbiking:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/xMTB").replace("*",a)}),".png")},nate:function(){return m(alp.map(n,function(a){return r+("//"+u+"/nate/map").replace("*",a)}),".png")},metgis_cloudiness:function(a,b){a=a&&a.metgis_key||t;(a||null).substring.call.a;return m(alp.map([1,2,3],function(a){return r+"//t"+a+".metgis.com/tilestache/tcdcprs_"+
b}),".png?key="+a)},metgis_precipitation:function(a){a=a&&a.metgis_key||t;(a||null).substring.call.a;return m(alp.map([1,2,3],function(a){return r+"//t"+a+".metgis.com/tilestache/hr_p_1"}),".png?key="+a)},metgis_temperature:function(a){a=a&&a.metgis_key||t;(a||null).substring.call.a;return m(alp.map([1,2,3],function(a){return r+"//t"+a+".metgis.com/tilestache/tmp2m_1"}),".png?key="+a)},metgis_temperature_point_demo:function(a){(a&&a.metgis_key||t||null).substring.call.a;return m(alp.map([1,2,3],function(a){return r+
"//tiles.metgis.com/tiles-demo/tiles.py/tmp2m_1_point"}),".png?key=c018fe1b9668e3757b8ec0ef12")},metgis_temperature_utfgrid:function(a,b){a=a&&a.metgis_key||t;(a||null).substring.call.a;(b||null).toPrecision.call.a;return m(alp.map([1,2,3],function(a){return r+"//t"+a+".metgis.com/tilestache/tmp2m_"+b+"_grid"}),".json?key="+a)},mb_satellite:function(){return function(a,b){return"//api.mapbox.com/v4/mapbox.satellite/"+b+"/"+a.x+"/"+a.y+".png?access_token="+e.access_token()}},mb_satellite_streets:function(){return function(a,
b){return"//api.mapbox.com/v4/mapbox.streets-satellite/"+b+"/"+a.x+"/"+a.y+".png?access_token="+e.access_token()}},osm:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/OSMSummer").replace("*",a)}),".png")},osm_winter:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/OSMWinter").replace("*",a)}),".png")},por:function(){return m(alp.map(n,function(a){return r+("//"+u+"/por/map").replace("*",a)}),".png")},skiresort_transp:function(){return this.skiresort()},skiresort:function(){return m(alp.map(n,
function(a){return r+("//"+u+"/map/xPiste").replace("*",a)}),".png")},transalpMountainbiking:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/xMTBTransalp").replace("*",a)}),".png")},USGSTopo:function(){return m(alp.map(n,function(a){return r+("//"+u+"/map/USGSTopo").replace("*",a)}),".png")},winter:function(){return m(alp.map(n,function(a){return r+("//"+u+"/portal/winter").replace("*",a)}),".png")}},ImageMapTypeOptions:{AlpsteinCHESummer:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.AlpsteinCHESummer(),
tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:17,name:"CHESummer"}},AlpsteinCHEWinter:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.AlpsteinCHEWinter(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:17,name:"CHEWinter"}},AlpsteinSummer:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.AlpsteinSummer(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:17,name:"Summer"}},AlpsteinWinter:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.AlpsteinWinter(),tileSize:new c.Size(256,
256),isPng:!0,minZoom:10,maxZoom:17,name:"Winter"}},at:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.at(),tileSize:new c.Size(256,256),isPng:!0,minZoom:9,maxZoom:17,name:"Austria"}},at_topo:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.at_topo(),tileSize:new c.Size(256,256),isPng:!0,minZoom:13,maxZoom:17,name:"Austria"}},avalanche_transp:function(){return this.slope()},slope:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.slope(),tileSize:new c.Size(256,256),isPng:!0,minZoom:11,
maxZoom:17,name:function(){return q&&q.maplayer_slope||"slope (i18n missing)"}}},ch:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.ch(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:16,name:"Switzerland"}},ch_topo:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.ch_topo(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:16,name:"Switzerland Topokarte"}},cycling:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.cycling(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,
maxZoom:17,name:function(){return q&&q.cycling||"cycling (i18n missing)"},opacity:.7}},cz:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.cz(),tileSize:new c.Size(256,256),isPng:!0,minZoom:13,maxZoom:17,name:"Czech Republic"}},de:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.de(),tileSize:new c.Size(256,256),isPng:!0,minZoom:8,maxZoom:17,name:"Germany"}},de_topo:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.de_topo(),tileSize:new c.Size(256,256),isPng:!0,minZoom:14,maxZoom:17,
name:"Germany"}},es:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.es(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:17,name:"Spain"}},fi_topo:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.fi_topo(),tileSize:new c.Size(256,256),isPng:!0,minZoom:9,maxZoom:17,name:"Finland"}},hiking:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.hiking(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:17,name:function(){return q&&q.hiking||"hiking (i18n missing)"},opacity:.7}},
horseback:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.horseback(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:17,name:function(){return q&&q.horseback||"horseback (i18n missing)"},opacity:.7}},it:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.it(),tileSize:new c.Size(256,256),isPng:!0,minZoom:9,maxZoom:17,name:"Italy (Sudtirol)"}},longDistanceCycling:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.longDistanceCycling(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,
maxZoom:17,name:function(){return q&&q.longDistanceCycling||"longDistanceCycling (i18n missing)"},opacity:.7}},longDistanceHiking:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.longDistanceHiking(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:17,name:function(){return q&&q.longDistanceHiking||"longDistanceHiking (i18n missing)"},opacity:.7}},hybrid_transp:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.hybrid_transp(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:17,
name:"Hybrid (transparent)"}},metgis_cloudiness:function(a){return l(a,"cloudiness")},metgis_precipitation:function(a){return l(a,"precipitation")},metgis_temperature:function(a){return l(a,"temperature")},metgis_temperature_numbers:function(b){var d,e,l;var f={};var m=[["#35000f",40],["#4c0016",38],["#7f0000",36],["#800026",34],["#b30000",32],["#bd0026",30],["#d7301f",28],["#ef6548",26],["#fc8d59",24],["#fdbb84",22],["#fd8d3c",20],["#feb24c",18],["#fed976",16],["#ffeda0",14],["#ffffcc",12],["#f7fcb9",
10],["#d9f0a3",8],["#addd8e",6],["#78c679",4],["#41ab5d",2],["#238443",0],["#9ecae1",-2],["#6baed6",-4],["#4292c6",-6],["#2171b5",-8],["#08519c",-10],["#06407c",-12],["#544082",-14],["#6a51a3",-16],["#807dba",-18],["#9e9ac8",-20],["#bcbddc",-22],["#dadaeb",-24],["#efedf5",-26],["#bdbdbd",-28],["#969696",-30],["#737373",-9E9]].reverse().map(function(a){return["rgba("+alp.map(a[0].substring(1).match(/../g),"parseInt( v, 16 )").concat(.9).join(",")+")"].concat(a.slice(1))});var p=alp.map(m,"v[0]");var n=
alp.map(m,"v[1]");return{getTileUrl:alp.f('"'+alp.cfg.image().transp_1x1.url+'"'),tileSize:new c.Size(256,256),isPng:!0,minZoom:0,maxZoom:17,name:function(){return q&&q.metgis_temperature||"metgis_temperature (i18n missing)"},opacity:1,_lfgm_customTile:{loadTileData:function(c,f){var m=alp.dfrd("mgtn:loadTileData",{then:1});x().then(function(c){var g=c.responseJson;c=g.timeStepNumber;g=a(g);d=g|0;e=g-d;l=d<c&&0<e?d+1:null;c=alp.gmap3.cfg.getTileUrl.metgis_temperature_utfgrid(b,d);g=null!=l&&alp.gmap3.cfg.getTileUrl.metgis_temperature_utfgrid(b,
l);alp.gatherDfrd([alp.jsonp(c(f,f.z))].concat(g?[alp.jsonp(g(f,f.z))]:[])).thenSoon(function(a){m.triggerSoon(alp.map(a,"v[0]"))})});return m},receiveTileData:function(a,b,c,d){a=alp.map(c.x%2?[[.13,.25],[.87,.25],[.5,.75]]:[[.13,.75],[.87,.75],[.5,.25]],function(a){var b=alp.map(d,function(b){return h.getProp(b,a[0],a[1])});return 2>b.length?b[0]:alp.oCreateMix(b[0],{data:b[0].data&&b[1].data&&alp.oCreateMix(b[0].data,{value:Math.round(alp.interpolate(b[0].data.value,b[1].data.value,e))})})});alp.orphan(alp.gEBCN("oa-metgis-tile-number",
b));alp.style(b,{position:"relative"});alp.forEach(a,function(a){var c=a.data,d=c&&c.value,e=null!=d&&isFinite(d);if(c=e?d+" \u00b0C":c&&c.label||""){var l=Math.round(256*a.x_prop);a=Math.round(256*a.y_prop);var m="red";e&&(d=g(n,d,f).ind0,(d=p[d])&&(m=d));alp.aC(alp.cE("div",b,{"class":"oa-metgis-tile-number",style:"position: absolute; left: "+l+"px; top: "+a+"px;"}),alp.cE("span",null,{style:"margin-left: -50%; margin-top: -50%; background-color: "+m+"; padding: 11px 0px; border-radius: 50%; height: 44px; width: 44px; position: absolute; border: 1px solid transparent; box-sizing: border-box; font-size: 14px; font-weight: 800;  text-align: center; box-shadow: 0px 0px 5px 0px rgba(63, 63, 63, 0.5);"},
{innerHTML:c.replace(" ","&nbsp;")}))}})}}}},metgis_temperature_point_demo:function(a){return{getTileUrl:alp.gmap3.cfg.getTileUrl.metgis_temperature_point_demo(a),tileSize:new c.Size(256,256),isPng:!0,minZoom:0,maxZoom:17,name:function(){return q&&q.metgis||"metgis (i18n missing)"},opacity:.66}},mountainbiking:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.mountainbiking(),tileSize:new c.Size(256,256),isPng:!0,minZoom:0,maxZoom:17,name:function(){return q&&q.mountainbiking||"mountainbiking (i18n missing)"},
opacity:.7}},nate:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.nate(),tileSize:new c.Size(256,256),isPng:!0,minZoom:0,maxZoom:6,name:"Natural Earth"}},mb_satellite_streets:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.mb_satellite_streets(),tileSize:new c.Size(256,256),isPng:!0,minZoom:0,maxZoom:19,name:"Mapbox Satellite+Streets"}},mb_satellite:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.mb_satellite(),tileSize:new c.Size(256,256),isPng:!0,minZoom:0,maxZoom:19,name:"Mapbox Satellite"}},
osm:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.osm(),tileSize:new c.Size(256,256),isPng:!0,minZoom:0,maxZoom:17,name:"OpenStreetMap"}},osm_winter:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.osm_winter(),tileSize:new c.Size(256,256),isPng:!0,minZoom:0,maxZoom:17,name:"OpenStreetMap Winter"}},por:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.por(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:17,name:"Portugal"}},skiresort_transp:function(){return this.skiresort()},
skiresort:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.skiresort(),tileSize:new c.Size(256,256),isPng:!0,minZoom:11,maxZoom:17,name:function(){return q&&q.maplayer_skiresort||"skiresort (i18n missing)"}}},transalpMountainbiking:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.transalpMountainbiking(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:17,name:function(){return q&&q.transalpMountainbiking||"transalpMountainbiking (i18n missing)"},opacity:.7}},USGSTopo:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.USGSTopo(),
tileSize:new c.Size(256,256),isPng:!0,minZoom:11,maxZoom:17,name:"USGS Topo"}},winter:function(){return{getTileUrl:alp.gmap3.cfg.getTileUrl.winter(),tileSize:new c.Size(256,256),isPng:!0,minZoom:10,maxZoom:17,name:"Winter"}}},tilelist:{AlpsteinCHESummer:function(){return"AlpsteinCHESummer"},AlpsteinCHEWinter:function(){return"AlpsteinCHEWinter"},AlpsteinSummer:function(){return"AlpsteinSummer"},AlpsteinWinter:function(){return"AlpsteinWinter"},at:function(){return"austria"},at_topo:function(){return"at_topo_tilelist"},
ch:function(){return"ch"},ch_topo:function(){return"ch_topo"},cz:function(){return"cz"},de:function(){return"tilelist"},de_topo:function(){return"de_topo"},es:function(){return"es"},fi_topo:function(){return"fi_topo_tilelist"},hybrid_transp:function(){return alp.gmap3.cfg.tilelist.de()},it:function(){return"it"},por:function(){return"por"},winter:function(){return"winter"}},tilelist_opts:function(){for(var a={layermask_fineformat:"json",tilelist_url_base:(alp.sub("oa.API_SAMEHOST")?"":location.protocol+
"//www.outdooractive.com")+"/alpportal/tilelist/"},b=arguments.length,c=0;c<b;c++){var d=arguments[c];d&&alp.mix(a,d)}/^(json|jsonp)$/.test(a.layermask_fineformat)?a.layermask_format=a.layermask_fineformat:a.layermask_format="binary";a.ext||(a.ext=a.layermask_fineformat);return a}};(function(){var a=d.map_alpstein(),b=d.map_metgis(),e=d.map_osm(),l=d.map_oa_mb_satellite_streets(),f=d.map_oa_mb_satellite(),m=[{copy_id:"usgs",attrMap:{"class":"usgsGCopyright",href:r+"//www.usgs.org",target:"_blank",
title:"\u00a9 U.S. Geological Survey"},propMap:{innerHTML:"&copy U.S.G.S."}}],g=function(a,b){return"number"===typeof a?a:b},n=alp.gmap3.cfg.copyright=function(){function a(a,c,d){for(var e={},l=0;l<f;l++){var m=b[l],g=m.id;g&&e[g]||!m.apply(this,arguments)||!g||(e[g]=!0,a.appendChild(document.createTextNode(", ")))}}for(var b=[],c=0,d=arguments.length;c<d;c++){var e=arguments[c];if("string"!==typeof e){var l=e[1];e=e[0]}e&&n[e]&&b.push(n[e](l))}var f=b.length;c=alp.arrChain(alp.map(b,".arr_def"));
a.arr_def=alp.filter(c,"(w=v.copy_id),(!w || (w in this ? false : (this[w] = true) ))",{});return a};n.standard_gengen=function(a,b,d){function e(a){function b(a,b,d){if(f.intersects(b)&&c<=d&&d<=e){for(b=l.length;b--;)d=l[b],alp.cE("a",a,d.attrMap,d.propMap),b&&alp.cTxN(", ",a);return!0}}a=a||alp.gmap3.cfg.ImageMapTypeOptions.de();var c=g(a&&a.minZoom,-Infinity),e=g(a&&a.maxZoom,Infinity);b.id=d&&d.toLowerCase();b.arr_def=l;return b}var l="attrMap"in b||"propMap"in b?[b]:b,f=new c.LatLngBounds(new c.LatLng(a[1],
a[0]),new c.LatLng(a[3],a[2]));e.bbox=a;return e};n.Alpstein=n.AlpsteinSummer=n.AlpsteinWinter=n.standard_gengen([-179,-85,179,85],a,"alpstein");n.at=n.standard_gengen([9.530833,46.3725,17.160556,49.020556],a,"alpstein");n.at_bev=n.standard_gengen(n.at.bbox,a,"alpstein");n.at_topo=n.standard_gengen([9.530833,46.3725,17.160556,49.020556],a,"alpstein");n.ch=n.AlpsteinCHESummer=n.AlpsteinCHEWinter=n.standard_gengen([5.543975830078125,45.578483912834606,10.880584716796875,47.99359789867388],a,"alpstein");
n.ch_topo=n.standard_gengen([5.543975830078125,45.578483912834606,10.880584716796875,47.99359789867388],a,"alpstein");n.cz=n.standard_gengen([13.095788955688477,49.09511494936478,13.358087539672852,49.21154186738314],a,"alpstein");n.de=n.standard_gengen([5.625,47.04018214480665,15.46875,55.77657301866769],a,"alpstein");n.de_topo=n.standard_gengen([5.625,47.04018214480665,15.46875,55.77657301866769],a,"alpstein");n.de_bkg=n.standard_gengen(n.de.bbox,a,"alpstein");n.es=n.standard_gengen([2.08740234375,
38.786204457258656,3.558197021484375,40.18411931650585],a,"alpstein");n.es_igne=n.standard_gengen(n.es.bbox,a,"alpstein");n.fi_topo=n.standard_gengen([18.41858,58.61692,36.33179,70.98119],a,"alpstein");n.it=n.standard_gengen([10.37684,46.22127,12.47528,47.08867],a,"alpstein");n.metgis_cloudiness=n.standard_gengen([43,5,50,18],b,"metgis");n.metgis_temperature=n.standard_gengen([43,5,50,18],b,"metgis");n.metgis_precipitation=n.standard_gengen([43,5,50,18],b,"metgis");n.nate=n.standard_gengen([-179,
-85,179,85],a,"alpstein");n.mb_satellite_streets=n.standard_gengen([-179,-85,179,85],l,"mb_satellite_streets");n.mb_satellite=n.standard_gengen([-179,-85,179,85],f,"mb_satellite");n.hybrid_transp=n.standard_gengen([-179,-85,179,85],a,"alpstein");n.osm=n.standard_gengen([-179,-85,179,85],e,"osm");n.osm_winter=n.standard_gengen([-179,-85,179,85],e,"osm");n.por=n.standard_gengen([-17.395477294921875,32.54044604524303,-16.519317626953125,33.16629497884489],a,"alpstein");n.USGSTopo=n.standard_gengen(p,
m,"usgs")})();var y=n.length})})();"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.maptype_modifier");
alp.gmap3(function(k){alp.gmap3.maptype_modifier=function(h){var g=h||[];return g.length?function(f,e){var d=e;alp.forEach(g,function(b,c){if(!b.baseMapType)console.error("alp.gmap3.maptype_modifier: `modifyBaseMapType["+c+"].baseMapType` (string) must be provided.");else if(b.baseMapType===f)if(b=b.replaceWith)if(b.mapType&&b.zoomRange){c={maptype:b.mapType,minZoom:b.zoomRange[0],maxZoom:b.zoomRange[1]};b=[c];var a=null!=d.minZoom?d.minZoom:0,m=null!=d.maxZoom?d.maxZoom:Infinity;c.minZoom>a&&b.push({maptype:d,
minZoom:a,maxZoom:Math.min(c.minZoom-1,m)});alp.isFiniteNumber(c.maxZoom)&&c.maxZoom<m&&b.push({maptype:e,minZoom:Math.max(c.maxZoom+1,a),maxZoom:m});var l={};alp.forEach(["alt","name","projection","radius","tileSize"],function(a){a in d&&(l[a]=d[a])});l.minZoom=Math.min(c.minZoom,a);l.maxZoom=alp.isFiniteNumber(m)?Math.max(c.maxZoom,m):c.maxZoom;d=new alp.gmap3.MixMapType(b,l)}else console.error("alp.gmap3.maptype_modifier: `modifyBaseMapType["+c+"].replaceWith.mapType` and `modifyBaseMapType["+
c+"].replaceWith.zoomRange` must be provided.");else console.error("alp.gmap3.maptype_modifier: Currently, only `modifyBaseMapType["+c+"].replaceWith` is permitted.")});return d}:function(f,e){return e}}});"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.copyright_merge");
alp.gmap3(function(k){alp.gmap3.copyright_merge=function(h,g,f){var e={};alp.forEach(h,function(d,b){var c=d._alp_google_mapTypeId;if(c)e.mapTypeId=e.mapTypeId||{id:c,minZoom:g[b],maxZoom:f[b]};else if(d=d._alp_copyright_spec)e.mapTypeId=e.mapTypeId||d.mapTypeId,e.before=(e.before||[]).concat(d.before||[]),e.after=(e.after||[]).concat(d.after||[])});e.before&&e.before.length||delete e.before;e.after&&e.after.length||delete e.after;return e}});
"undefined"!==typeof dojo&&(dojo.provide("alp.gmap3.layermask"),dojo.require("alp._gmap2_3.mercatorprojection"),dojo.require("alp._gmap2_3.projection"));
alp.gmap3(function(k){function h(b,c,d){function e(){alp.now("triggerSoon",p.init_dfrd(),!0)}function l(a){var b=a&&a.ok;b?m(alp.oFrom(b.target.response)):console.error("_AG3_layermask_receive_json_cors_error for url: ",n,", wrap: ",a)}function m(a){p._maskData=new alp.gmap3._JsonMergeLayerData(a);e()}var p=this;this._const_or_url=b;this._strict=(this._opts=d||{},this._opts.strict);d=this._tilebound_arr=this._opts&&this._opts.tilebound_arr;null==b&&(b=a);if("number"===typeof b||null==b)return this._const=
b,this.at=d?g:function(){return b},this.init_dfrd().triggerSoon(!0),this;if("bbox"===c){if(!(4===b.length&&alp.and(b,"alp.isFiniteNumber(v)")&&b[0]<b[2]&&b[1]<b[3]))throw Error("_LayerMask: badly specified bbox!");this._bbox=b;this.at=f;this.init_dfrd().triggerSoon(!0);return this}var n=alp.fixUrlProtocol(b);n&&n.substring.call.a;if(d=alp.sub("alpConfig.cachebust")){var q=n.split("?");q.push("cachebust="+d);n=q[0]+"?"+q.slice(1).join("&")}if("binary"==c)dojox.io.binary.xhrGet({url:n,load:function(a,
b){p._maskData=new alp.gmap3._BinaryMergeLayerData(a)},handle:e});else if("json"==c)alp.xhrCorsGetJson(n,{cache:!0}).then(l);else if("jsonp"==c)alp.jsonp(n).then(m);else throw Error("Unsupported mask format: "+c);}function g(a,d,e){var l=this._tilebound_arr;if(!l)return c;for(var f=l.length;f--;){var m=l[f];if(m&&(m=m&&m.tilebbox_of_z[e])&&m.xmin<=a&&a<=m.xmax&&m.ymin<=d&&d<=m.ymax)return this._const||c}return b}function f(d,f,m){var g=l in this?this[l]:this[l]={};if(!(m in g)){var p=g[m]={};r||(r=
new k.MercatorProjection(31));var n=this._bbox,q=new k.LatLng(n[1],n[0]);n=new k.LatLng(n[3],n[2]);q=e.fromLatLngToPixel(r,q,m);n=e.fromLatLngToPixel(r,n,m);p.xmin=q.x>>8;p.xmax=n.x>>8;p.ymin=n.y>>8;p.ymax=q.y>>8}p=g[m];m=p.xmin;g=p.ymin;q=p.xmax;p=p.ymax;return d<m||d>q||f<g||f>p?b:d===m||d===q||f===g||f===p?c:a}var e=alp._gmap2_3,d={};alp.gmap3.layermask=function(a,b,c){var e=[a,b,c&&JSON.stringify(c)].join();return d[e]||(d[e]=new h(a,b,c))};var b=alp.gmap3.layermask.NONE=0,c=alp.gmap3.layermask.TRANSPARENT=
1,a=alp.gmap3.layermask.OPAQUE=2,m=0;h.prototype.is_initialized=function(){return this._maskData&&this.init_dfrd().triggered()};h.prototype.init_dfrd=function(){return this._init_dfrd||(this._init_dfrd=alp.dfrd("layermask #"+m++))};h.prototype.at=function(d,e,l){return this._tilebound_arr&&!g.apply(this,arguments)?b:this._maskData?this._maskData.contains(d,e,l)?!this._strict&&this._maskData.contains(d,e,l,!0)?c:a:b:c};alp.declare("alp.gmap3._AbstractMergeLayerData",null,null,{contains:function(a,
b,c,d){throw Error(this.declaredClass+".contains() not implemented (abstract class).");},_dilerocontains_dxy:[[-2,-2],[2,2],[-2,2],[2,-2],[-2,-1],[2,1],[-2,1],[2,-1],[-1,-2],[1,2],[-1,2],[1,-2],[-2,0],[2,0],[0,-2],[0,2],[-1,-1],[1,1],[-1,1],[1,-1],[-1,0],[1,0],[0,-1],[0,1],[0,0]],_dilerocontains:function(a,b,c,d,e){var l;for(l=0;l<this._dilerocontains_dxy.length;l++){var f=this._dilerocontains_dxy[l];if(this.contains(a+f[0],b+f[1],c,d)===e)return e}return!e},dilatedcontains:function(a,b,c,d){return this._dilerocontains(a,
b,c,d,!0)},erodedcontains:function(a,b,c,d){return this._dilerocontains(a,b,c,d,!1)}});alp.declare("alp.gmap3._JsonMergeLayerData",alp.gmap3._AbstractMergeLayerData,function(a){this._data=alp.mix({transp:{}},a)},{contains:function(a,b,c,d){if(!1===d)return this.contains(a,b,c)&&!this.contains(a,b,c,!0);if(void 0===d)var e=this._data.all;!0===d&&(e=this._data.transp);if(c in e){if("number"===typeof e[c]&&(d=Math.pow(2,e[c]-c),a=Math.floor(a*d),b=Math.floor(b*d),c=e[c]),b in e[c])for(b=e[c][b],c=b.length,
e=0;e<c;e++)if(d=b[e],d[0]<=a&&a<=d[1])return!0}else if(!0===d)return this.contains(a,b,c)&&!this.erodedcontains(a,b,c);return!1}});alp.declare("alp.gmap3._BinaryMergeLayerData",alp.gmap3._AbstractMergeLayerData,function(a){this._data=a;var b="";for(a=0;a<this._data.length;a++){var c=this._data.getByte(a);if(10===c){var d=a+1;break}b+=String.fromCharCode(c)}if(void 0===d)throw Error("Could not find the end of the header.");var e=eval("("+b+")");this._nbits=e.nbits;this._nx=[];this._xmin=[];this._ymin=
[];this._xmax=[];this._ymax=[];this._firstbyte=[];this._extra_z={};for(a=0;a<e.domain.length;a++)c=e.domain[a][0],"number"===typeof e.domain[a][1]?this._extra_z[c]=e.domain[a][1]:(b=e.domain[a][1],this._xmin[c]=b[0],this._ymin[c]=b[1],this._xmax[c]=b[2],this._ymax[c]=b[3],this._nx[c]=b[2]-b[0]+1,this._firstbyte[c]=d,d+=e.domain[a][3]);if(d!==this._data.length)throw Error("Inconsistent binData.length  ("+this._data.length+") and nbytes ("+d+") !");},{_bit:function(a,b,c,d){b=2*((b-this._ymin[c])*this._nx[c]+
(a-this._xmin[c]))+(d?1:0);a=Math.floor(b/this._nbits);b=this._nbits-1-b%this._nbits;return 0!==(this._data.getByte(this._firstbyte[c]+a)&1<<b)},contains:function(a,b,c,d){if(!1===d)return this.contains(a,b,c)&&!this.contains(a,b,c,!0);if(c in this._extra_z){var e=Math.pow(2,this._extra_z[c]-c);a=Math.floor(a*e);b=Math.floor(b*e);c=this._extra_z[c]}return!this._nx[c]||a<this._xmin[c]||a>this._xmax[c]||b<this._ymin[c]||b>this._ymax[c]?!1:void 0===d?this._bit(a,b,c,!1):this._bit(a,b,c,!1)&&d!==this._bit(a,
b,c,!0)}});var l="_bbox_cache",r});"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.mixmaptype");
alp.gmap3(function(k){function h(c,a,d,l){return alp.arrChain(alp.map(c,function(c,f){function m(a){function c(c,d){var l=c.x,f=c.y,m=d;return m<n||m>r||e===g.at(l,f,m)||alp.or(h,function(a,c){return k[c]<=m&&m<=x[c]&&b===a.at(l,f,m)})?"":a.getTileUrl.apply(a,arguments)}return a.getTileUrl?alp.oCreateMix(a,{getTileUrl:c}):a}c=c._alp_imtcfg_arr||[];var g=a[f],n=d[f],r=l[f];f+=1;var h=a.slice(f),k=d.slice(f),x=l.slice(f);return g&&g.at?alp.map(c,m):c}))}var g;(function(){var b=alp.cE("span",alp.body(),
{style:"position: fixed; top: 0px; left: 0px; color: transparent; background-color: transparent; opacity: 0; -webkit-transition: opacity 200ms ease-out; transition: opacity 200ms ease-out;"},{innerHTML:"&nbsp;"});alp.onDCL(function(){b.style.opacity=1})})();alp.gmap3.MixMapType=alp.nowF(function(c,a){c=alp.filter(c,function(a,b){if(a&&a.maptype)return!0;console.error("alp.gmap3.MixMapType: check_maptype: #"+b+" not a valid map type")});a=alp.oCreateMix({border_heuristic:!0},a);var f=c.length,l=alp.map(c,
alp.f(".maptype")),r=alp.map(l,alp.gmap3._ggf),n=alp.map(l,function(a,b){return Math.max(a.minZoom||0,c[b].minZoom||0)}),q=alp.map(l,function(a,b){a=Math.min(a.maxZoom||Infinity,c[b].maxZoom||Infinity);return alp.isFiniteNumber(a)?a:null}),p=alp.map(c,function(a){return a.layermask||alp.gmap3.layermask(alp.gmap3.layermask.OPAQUE)}),v=!1;alp.gatherDfrd(alp.map(p,alp.f(".init_dfrd()"))).thenSoon(function(a){v=alp.and(a,"v[0]")});this._alp_copyright_spec=alp.gmap3.copyright_merge(l,n,q);this.minZoom=
alp.isFiniteNumber(a&&a.minZoom)?a.minZoom:Math.min.apply(Math,n);this.maxZoom=alp.isFiniteNumber(a&&a.maxZoom)?a.maxZoom:Math.max.apply(Math,q);for(var u=l[0].tileSize,t=l.length;t--;)if(!l[t].tileSize.equals(u))throw Error("alp.gmap3.MixMapType: all maptypes must have the same tile size!");this.tileSize=u;this.name=a&&a.name||alp.map(l,function(a,b){return b+"-"+(a.name||"<maptype>")}).join("_");this.getTile=function(a,c,l){var m=l.createElement("DIV");var p=a.x;var h=1<<c;0>p&&(p=p%h+h);p%=h;a=
a.y;h=[];for(var t=[],y=0;y<f;y++)if(!(n[y]>c||q[y]<c))switch(w[y](p,a,c)){case e:continue;case d:t.push(y);continue;case b:t=[],h=[y]}if(x&&v&&h.length&&1<t.length){y=!0;var z=-1;a:for(;2>z;z++){var A=-1;b:for(;2>A;A++)if(z||A){for(var P=p+z,H=a+A,F=0,D=t.length;D--;){var M=w[t[D]](P,H,c);if(M===b)continue b;M===d&&F++}if(2>F){y=!1;break a}}}y&&(h=[])}h=h.concat(t);alp.sA(m,"style","width: "+u.width+"px; height: "+u.height+"px;");t=0;for(y=h.length;t<y;t++)A=h[t],(z=r[A](new k.Point(p,a),c,l))?(A=
this._alp_imtcfg_arr[A].opacity,isFinite(A)||(A=1),P=z.style,P.position="absolute",P.left="0px",P.top="0px",alp.supportsStyleOpacity()?P.opacity=""+A:(P.filter="alpha( opacity="+Math.round(100*A)+")",P.zoom="1"),m.appendChild(z)):g||(console.error("alp.gmap3.MixMapType: did not obtain a tile node from layer #"+h[t]+" (a:"+t+"). Mentionning this issue once only. See also Alpstein#7901"),g=!0);return m};this.releaseTile=function(a){alp.forEach(alp.gEBTN("img",a),'v.setAttribute("src","");v.src="";if (v.parentNode) alp.empty(alp.orphan(v.parentNode));alp.orphan(v);');
alp.orphan(alp.empty(a))};this._alp_imtcfg_arr=h(l,p,n,q);var w=alp.map(p,function(a){return alp.bindF("at",a)}),x=a&&a.border_heuristic});var f=alp.gmap3.layermask,e=f.NONE,d=f.TRANSPARENT,b=f.OPAQUE});"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.maptype");alp.i18n.fetch("alp.all");
alp.gmap3(function(k){function h(a,b){return function(c){function d(b){b._alp_imtcfg_arr=[e];if(a in t.cfg.copyright){var c=t.cfg.copyright[a]();b._alp_copyright_spec={mapTypeId:"alpstein_"+x,before:c};e.copy_arr_def=c.arr_def}return b}b&&console.error('"'+b.old_id+'" is deprecated. Please use "'+b.new_id+'" instead.');var e=t.cfg.ImageMapTypeOptions[a](c);if("function"!==typeof e.name){var l=d(new k.ImageMapType(e));c=alp.dfrd("imtgen:direct");c.done(l);l.mt_dfrd=c;return l}c=alp.subDfrd(function(){if(e.name())return e.name=
e.name(),d(new k.ImageMapType(e))});l=alp.bindF("thenSoon",c);l.mt_dfrd=c;return l}}function g(a,b){p[a]=function(){return alp.bindF("thenSoon",n(a,void 0))}}function f(a,b){var c=b.old_id,d=b.new_id;(c&&d||null).substring.call.a;return function(b){console.error('"'+c+'" is deprecated. Please use "'+d+'" instead.');return a.apply(null,arguments)}}function e(a){return l(a)}function d(a){return l(a,!0)}function b(a){return r(a)}function c(){var a={getTileUrl:function(a,b){return"http://mt3.google.com/mapstt?zoom="+
b+"&x="+a.x+"&y="+a.y+"&client=google"},tileSize:new k.Size(256,256),isPng:!0,maxZoom:17,name:"Traffic"};return(p.alpstein_traffic=function(){return new k.ImageMapType(a)})()}function a(a){function b(b){b=new t.MixMapType(alp.filter([b&&{maptype:b,layermask:t.layermask(t.layermask.OPAQUE)},{maptype:p.oa_hybrid_transp(),layermask:t.layermask(t.layermask.TRANSPARENT)}],""),{name:"G plus A",minZoom:10,maxZoom:17});b=new t.MixMapType([{maptype:p.oa_osm(),layermask:t.layermask(t.layermask.OPAQUE)},{maptype:b,
layermask:t.layermask(t.layermask.OPAQUE)}],{name:a.name,minZoom:0,maxZoom:17});b._alp_copyright_spec={mapTypeId:k.MapTypeId&&k.MapTypeId.HYBRID,before:t.cfg.copyright.de(t.cfg.ImageMapTypeOptions.hybrid_transp())};c.triggerSoon(b)}var c=alp.dfrd("AG3 alpstein_hybrid"),d=alp.bindF("thenSoon",c);alp.i18n.fetch("alp.all").thenSoon(function(c){a=t.cfg.tilelist_opts({name:q(c,"hybrid")||"Hybrid (i18n missing)"},a);n(k.MapTypeId&&k.MapTypeId.SATELLITE,a&&a.map).thenSoon(b)});return d}function m(a){function b(){var a=
[["metgis_precipitation",t.cfg.ImageMapTypeOptions.metgis_precipitation(e)],["metgis_cloudiness",t.cfg.ImageMapTypeOptions.metgis_cloudiness(e)],["metgis_temperature_numbers",t.cfg.ImageMapTypeOptions.metgis_temperature_numbers(e)]];return alp.filter(a,"")}var c=alp.dfrd("AG3 _oa_metgis_weather2"),d=alp.bindF("thenSoon",c),e=alp.opt(a,["metgis_key"]);alp.i18n.fetch("alp.all").thenSoon(function(a){alp.gatherDfrd(alp.map([p.oa_metgis_cloudiness(e),p.oa_metgis_precipitation(e),p.oa_metgis_temperature_numbers(e)],
".mt_dfrd")).thenSoon(function(d){d=alp.map(d,"{ maptype : v[0], layermask: this.layermask( this.layermask.TRANSPARENT ) }",t);d=new t.MixMapType(d,{name:q(a,"metgis_weather2")||"oa_metgis_weather2 (i18n missing)",minZoom:0,maxZoom:17});d._alp_copyright_spec={mapTypeId:null,before:t.cfg.copyright.apply(null,b())};c.triggerSoon(d)})});return d}function l(a,b){function c(){var a=[["de",t.cfg.ImageMapTypeOptions.de()],["cz",t.cfg.ImageMapTypeOptions.cz()],["it",t.cfg.ImageMapTypeOptions.it()],["de_bkg",
t.cfg.ImageMapTypeOptions.de()],["at",t.cfg.ImageMapTypeOptions.at()],["at_bev",t.cfg.ImageMapTypeOptions.at()],["es",t.cfg.ImageMapTypeOptions.es()],["es_igne",t.cfg.ImageMapTypeOptions.es()],["nate",t.cfg.ImageMapTypeOptions.nate()],["por",t.cfg.ImageMapTypeOptions.por()],!b&&["osm",t.cfg.ImageMapTypeOptions.osm()],b&&["osm",t.cfg.ImageMapTypeOptions.osm_winter()],b&&["winter",t.cfg.ImageMapTypeOptions.winter()]];return alp.filter(a,"")}var d=alp.dfrd("AG3 _oa_map"),e=alp.bindF("thenSoon",d);alp.i18n.fetch("alp.all").thenSoon(function(e){a=
t.cfg.tilelist_opts({name:b?q(e,"map_winter")||"Winter (i18n missing)":q(e,"map")||"Karte (i18n missing)"},a);e=t.MixMapType;var l=[!b&&{maptype:p.oa_osm()},!b&&{maptype:p.oa_AlpsteinSummer(),layermask:t.layermask(a.tilelist_url_base+t.cfg.tilelist.AlpsteinSummer()+"."+a.ext,a.layermask_format)},b&&{maptype:p.oa_osm_winter()},b&&{maptype:p.oa_AlpsteinWinter(),layermask:t.layermask(a.tilelist_url_base+t.cfg.tilelist.AlpsteinWinter()+"."+a.ext,a.layermask_format)}];l=alp.filter(l,"");e=new e(l,{border_heuristic:!0,
name:a.name,minZoom:0,maxZoom:17});e._alp_copyright_spec={mapTypeId:null,before:t.cfg.copyright.apply(null,c())};d.triggerSoon(e)});return e}function r(a){function b(b){var e=t.MixMapType;b=[{maptype:b},{maptype:p.oa_de_topo(),layermask:t.layermask(a.tilelist_url_base+t.cfg.tilelist.de_topo()+"."+a.ext,a.layermask_format)},{maptype:p.oa_at_topo(),layermask:t.layermask(a.tilelist_url_base+t.cfg.tilelist.at_topo()+"."+a.ext,a.layermask_format)},{maptype:p.oa_fi_topo(),layermask:t.layermask(t.cfg.bbox.fi_topo(),
"bbox")},{maptype:p.oa_USGSTopo(),layermask:t.layermask(t.cfg.bbox.USGSTopo(),"bbox")}];b=alp.filter(b,"");e=new e(b,{border_heuristic:!0,name:a.name,minZoom:0,maxZoom:17});e._alp_copyright_spec={mapTypeId:null,before:t.cfg.copyright.apply(null,c())};d.triggerSoon(e)}function c(){var a=[["de_topo",t.cfg.ImageMapTypeOptions.de_topo()],["USGSTopo",t.cfg.ImageMapTypeOptions.USGSTopo()]];return alp.filter(a,"")}var d=alp.dfrd("AG3 _oa_topo"),e=alp.bindF("thenSoon",d);alp.i18n.fetch("alp.all").thenSoon(function(c){a=
t.cfg.tilelist_opts({name:q(c,"topo")||"Topokarte (i18n missing)"},a);p.oa_map(a)(b)});return e}function n(a,b){return a?alp.subDfrd(function(){var b=alp.sub("google.maps");!A&&b&&!A&&b&&b.LatLng&&b.Map&&(C=alp.oValues(k.MapTypeId),A=new b.Map(document.createElement("div"),{center:new b.LatLng(48,10.5),zoom:9,mapTypeId:C[0],mapTypeControlOptions:{mapTypeIds:C}}));if(b=(b=A)&&b.mapTypes.get(a))return b._alp_google_mapTypeId=a,b},null):(b=alp.dfrd("empty/inexistent maptype",{then:1}),b.done(),b)}function q(a,
b){return a&&(a["mlp_mt_alpstein_"+b]||a["mlp_mt_oa_"+b]||null)}var p={},v={},u={},t=alp.gmap3,w;for(w in k.MapTypeId)w in v||(u[k.MapTypeId[w]]=1);t.maptype=alp.nowF(function(a,b){function c(){var a=alp.bindF.apply(alp,arguments);alp.now("thenSoon",d,a)}var d=alp.dfrd("AG3 maptype"),e=p[a],l=alp.chainF(t.maptype_modifier(b&&b.modifyBaseMapType),function(b){b._oa_mtid=a;return b});if((b=e&&e(b))&&"function"===typeof b)b(alp.nowF(function(b){d.triggerSoon(a,l(a,b))}));else if(b&&"object"===typeof b)d.triggerSoon(a,
l(a,b));else if(!(a in u))return console.error('alp.gmap3.maptype(): unknown maptype id "'+a+'", available ids: '+alp.oKeys(p).sort()),!1;return c.then=c});t.maptype.getIds=function(){return alp.oKeys(p)};for(var x in t.cfg.ImageMapTypeOptions)if(!(x in v)){var y="alpstein_"+x,z="oa_"+x;p[z]=h(x);p[y]=h(x,{old_id:y,new_id:z})}for(w in k.MapTypeId)w in v||g(k.MapTypeId[w],w);p.alpstein_coordinate=function(){function a(){}a.prototype.tileSize=new k.Size(256,256);a.prototype.maxZoom=19;a.prototype.getTile=
function(a,b,c){b=c.createElement("DIV");b.innerHTML=a;b.style.width=this.tileSize.width+"px";b.style.height=this.tileSize.height+"px";b.style.fontSize="10";b.style.borderStyle="solid";b.style.borderWidth="1px";b.style.borderColor="#AAAAAA";return b};a.prototype.name="Tile #s";a.prototype.alt="Tile Coordinate Map Type";return(p.alpstein_coordinate=function(){return new a})()};p.oa_hybrid=a;p.alpstein_hybrid=f(a,{old_id:"alpstein_hybrid",new_id:"oa_hybrid"});p.oa_map=e;p.alpstein_map=f(e,{old_id:"alpstein_map",
new_id:"oa_map"});p.oa_map_winter=d;p.alpstein_map_winter=f(d,{old_id:"alpstein_map_winter",new_id:"oa_map_winter"});p.oa_mb_hybrid=function(a){var b=alp.dfrd("oa_mb_hybrid");a=alp.bindF("thenSoon",b);alp.i18n.fetch("alp.all").thenSoon(function(a){a=new t.MixMapType([{maptype:p.oa_mb_satellite(),layermask:t.layermask(t.layermask.OPAQUE)},{maptype:p.oa_hybrid_transp(),layermask:t.layermask(t.layermask.TRANSPARENT)}],{name:"M plus A",minZoom:10,maxZoom:17});a._alp_copyright_spec={mapTypeId:"oa_hybrid",
before:t.cfg.copyright.de(t.cfg.ImageMapTypeOptions.hybrid_transp())};b.triggerSoon(a)});return a};p.oa_topo=b;p.alpstein_topo=f(b,{old_id:"alpstein_topo",new_id:"oa_topo"});p.oa_traffic=c;p.alpstein_traffic=f(c,{old_id:"alpstein_traffic",new_id:"oa_traffic"});p.oa_metgis_weather=m;p.oa_metgis_weather2=m;var A,C});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.overlay_map_type");
(function(){function k(f,e,d){if(e instanceof Array)for(var b=e.length,c=0;c<b;c++)k(f,e[c],d);else h(f,e).then(function(a,b){a.substring.call.a;b||null.bug;a=f.overlayMapTypes;var c=alp.lastIndexOf(a.getArray(),b);d?0>c&&a.push(b):-1<c&&a.removeAt(c)})}function h(f,e){function d(a,d){c.done(b,a.tilelayer(b))}if("string"!==typeof e)return e;var b=e;f=g.get(f)||g.setNow(f,{});var c=f[b];c||((e=alp.sub("oa.api.maps"))?(c=alp.dfrd("_AG_OVMT_getOvmtDfrd_oa_api_maps:"+b,{then:1}),e(d)):c=alp.gmap3.maptype(b),
f[b]=c);return c}alp.sub("alp._gmap2_3",0,1).setOvmtLater=k;var g=alp.mapany()})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.bbox_cfg");alp.sub("alp._gmap2_3",null,!0).BBOX_DEFAULT_CFG=alp.memF("{maxZoom:15, pan:false}");"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.set_bbox");
alp.gmap3(function(k){function h(d,b,c,a){var e=a&&a.pan;"string"===typeof b&&(b=alp.map(b.split(","),parseFloat));if(b instanceof k.LatLngBounds){var l=b.getSouthWest(),f=b.getNorthEast();b=[l.lng(),l.lat(),f.lng(),f.lat()]}if(3===b.length){var n={zoom:b[2]>>0};l=new k.LatLng(parseFloat(b[1]),parseFloat(b[0]));c&&console.error("alp._gmap2_3.set_bbox() ignores `padding` because bbox = [ x, y, z ].")}else n=g.bbox_2_bounds_zc(d,b,c,a),l=n.center;f=n&&n.zoom;n=n&&n.bounds;alp.isFiniteNumber(a.maxZoom)&&
(f=Math.min(f,a.maxZoom));if(l&&alp.isInteger(f))e?(d.panTo(l),d.setZoom(f)):(d.setCenter(l,f),d.__alp_lf__||d.setZoom(f));else if(n&&d.fitBounds)d.fitBounds(n);else if(l)d[e?"panTo":"setCenter"](l);else console.error("alp._gmap2_3.set_bbox() failed on args:",arguments)}var g=alp._gmap2_3,f=g.BBOX_DEFAULT_CFG(),e=alp.mapany();g.set_bbox=alp.nowF(function(d,b,c,a){function m(e){h(d,b,c,a);e()}a=alp.oCreateMix(f,a);var l=e.get(d)||e.set(d,alp.asyncSeq());d.isLoaded()||a&&a.now?l.next(m):l.next(function(a){d.whenLoaded(m,
null,a)})})});"undefined"!==typeof dojo&&dojo.provide("alp.db");
(function(){function k(g,f){if(g){if(2>arguments.length){for(var e=alp.sub(g,this._data),d;e instanceof alp.db.Redirect&&e!==d;)d=e,e=alp.sub(e.to_key,this._data);return e}d=g.split(".");e=d.pop();d=d.length?alp.sub(d.join("."),this._data,!0):this._data;void 0===f?delete d[e]:d[e]!==f&&(d[e]=f,this._changed(g,f instanceof h?k.call(this,g):f))}else console.error("alp.DB.access() requires a non-empty name string!")}function h(g){this.to_key=g}alp.db||(alp.db={});alp.db.common=alp.memF("new alp.DB()");
alp.declare("alp.DB",null,function(){this._data={}},{erase:function(g){k.call(this,g,void 0)},getset:function(g,f){if(2>arguments.length)return alp.oCopy(k.apply(this,arguments));k.apply(this,arguments)},_getset_unsafe:k,has:function(g){return null!=k.call(this,g)},waitfor:function(g){function f(a){a===g&&e.has(g)&&(b.dropSoon(c),alp.now("triggerSoon",d,e.getset(g)))}var e=this,d=alp.dfrd('alp.DB reception: "'+g+'"'),b=e.changeEvt(),c=b.thenSoon(f);f(g);return d},changeEvt:alp.memM("changeEvt",'alp.event("alp.DB changeEvt")'),
changed:alp.nowF(function(g,f){this.changeEvt().triggerSoon(g,f)}),_changed:alp.asyncF(0,"changed")});alp.db.Redirect=h})();"undefined"!==typeof dojo&&dojo.provide("alp.data.ooi");
(function(){function k(a,b){b||(b=alp.db.common());return(a=b.getset(a+r))&&m(a)}function h(a){if("string"===typeof a)return a;var b=a&&a.externalSystem,c=a&&a.externalId;return a&&b&&c?"external:"+b+":"+c:a&&a.id?a.id:"CustomOOIID#"+p++ +"_"+ +new Date}function g(a){return a&&v.test(a)}function f(a){return a&&u.test(a)}function e(a){return a&&v.test(a)&&a.match(v)[1]}function d(a){return a&&v.test(a)&&a.match(v)[2]}function b(a,b){if(f(a))return a;b=k(a,b);return alp.sub("data.id",b)||a}function c(a,
b){if(a){if("string"===typeof a)return c(a.split(/\s+/),b);var d=b&&b.latlngObj;if(a instanceof Array)return alp.map(a,d?'(w=v.split(",")),{lat:parseFloat(w[1]),lng:parseFloat(w[0])}':'(w=v.split(",")),(w=[parseFloat(w[0]),parseFloat(w[1]),w[2]!=null&&parseFloat(w[2])]),(w.lat=w.y=w[1]),(w.lng=w.x=w[0]),(w.z=w[2]),w');if(a.geometry)return c(a.geometry,b);if(a.data)return c(a.data,b);if(a.geoJson)return c(a.geoJson,b);if("object"===typeof a&&/^LineString$/i.test(a.type))return d?a=alp.map(a.coordinates,
"{lat:v[1],lng:v[0]}"):(a=a.coordinates.slice(),alp.forEach(a,"v.lng=v.x=v[0], v.lat=v.y=v[1], v.z=v[2]")),a;console.error("alp.data.line_geometry: failed to find geometry in `o`",a)}}function a(b,c){var d=c&&c.latlngObj;if(b){var e=null!=b.z?b.z:null!=b.altitude?b.altitude:null!=b.alt?b.alt:null;if(null!=b.x&&null!=b.y){var l=[b.x,b.y];null!=e&&l.push(e)}else if(null!=b.lat&&null!=b.lng)l=[b.lng,b.lat],null!=e&&l.push(e);else if(b.point)l=b.point.slice();else if(b.geometry)b=b.geometry,c&&c.polyline?
(b=alp.map(b.split(" "),function(a){a=a.split(",");var b=[parseFloat(a[0]),parseFloat(a[1])];null!=a[2]&&b.push(parseFloat(a[2]));return b}),l=b[0].slice(),c&&c.polyline&&1<b.length&&(l.polyline=b)):"object"===typeof b?/^LineString$/i.test(b.type)?l=b.coordinates[0]:null.xxx_not_supported_yet:(l=b.match(/^\s*\S+(\s|$)/)[0].split(","),l[0]=parseFloat(l[0]),l[1]=parseFloat(l[1]),c=null!=l[2]?l[2]:e,null!=c&&(l[2]=parseFloat(c)));else{if(b.data)return a(b.data,c);if(b.coordinates)return a(b.coordinates,
c);2===b.length||3===b.length?l=b.slice():b.startingPoint&&(l=[b.startingPoint.lon,b.startingPoint.lat],null!=b.startingPoint.z&&l.push(b.startingPoint.z))}if(l){if(d)return d={lat:l[1],lng:l[0]},c=null!=l[2]?l[2]:e,null!=c&&(d.alt=c),d;l.x=l.lng=l[0];l.y=l.lat=l[1];null!=l[2]&&(l.z=l.alt=l[2]);return l}}}function m(a,b){if("object"===typeof a)for(var c in a)if(!(c in q)){var d=a[c];if(d&&d.length&&d[0].id&&(!b||d[0].id===b||g(b)||d[0].requestedId===b))return{maintype:c,data:d[0]}}console.error('alp.data.single_ooi could not find id "'+
b+'" in data: ',a)}var l=alp.data||(alp.data={}),r=l._ooi_db_suffix=".api";l.ooi_db_prefix=function(a){return"api.proj:"+((a||"")+"").replace(/\./g,"_")};l.ooi_db_prefix.toString=l.ooi_db_prefix.toValue=l.ooi_db_prefix;l.ooi_db_key=function(a,b,c,d,e){return[l.ooi_db_prefix(c?b+"#"+c:b),"minimal:"+!!d+"."+a,"edit:"+!!e].join("#")};l.is_ooi_db_key=function(a){return n.test(a)};l.parse_ooi_db_key=function(a){a=n.exec(a);return{proj:a[1],id:a[2]}};var n=/^api\.proj:([^\.]*)\.([^\.]+)$/;l.allMaintype=
function(a,c,d){function e(a,b){b=a&&alp.oGet(a,"meta.externalSystem.name");var c=a&&alp.oGet(a,"meta.externalId.id");b&&c&&(this["external:"+b+":"+c]=a);(b=a&&a.requestedId)&&(this[b]=a)}d||(d=alp.db.common());d&&c&&(c=alp.map(c,function(a){return b(a,d)}));var l=[],f;for(f in a)if(!(f in q))for(var m=a[f]||[],g=m.length,p=0;p<g;p++)l.push(alp.oCreateMix({frontendtype:f},m[p]));c&&(a=alp.arr2o(l),alp.forIn(l,e,a),a={ret_id2o:a,found:{}},l=alp.map(c,"v=this.ret_id2o[v] || null, (v && (this.found[v.id] = 1)), v",
a).concat(alp.filter(l,"!(v.id in this)",a.found)));return l};l.createCustomOOI=function(a,b){b||(b={});var c=alp.opt(b,"db")||alp.db.common();b=alp.opt(b,"proj");var d={id:1,externalSystem:1,externalId:1};b||console.error('createCustomOOI: it is strongly advised to pass a project parameter, e.g.  createCustomOOI( obj, { proj: "ar-blah" } )');for(var e in d)if(d.hasOwnProperty(e)&&null!=a[e])throw Error('alp.data.createCustomOOI(): field "'+e+'" is forbidden.');e=h();d={};a.id=e;d[a.maintype||"ooi"]=
[a];c.getset(l.ooi_db_key(e,b),d);c.getset(e+r,d);return e};l.external_info=function(a,b,c){b||(b=alp.db.common());"string"!==typeof a||g(a)||(a=(a=k(f,b))&&a.data);if("string"===typeof a){var l=e(a);var f=d(a)}else if(a){if("requestedId"in a&&g(a.requestedId))return a.requestedId;l=alp.sub("meta.externalSystem.name",a);f=alp.sub("meta.externalId.id",a)}if(l&&f)return c?"external:"+l+":"+f:{externalSystem:l,externalId:f}};l.get_ooi=k;l.line_geometry=c;l.ooi_category_id=alp.bindF("sub",alp,"category.id");
l.ooi_geometry=a;l.ooiid=h;l.ooiid.alpsteinize=b;l.ooiid.external_id=d;l.ooiid.external_system=e;l.ooiid.is_alpstein=f;l.ooiid.is_external=g;l.ooiid.same_object=function(a,c,d){return null==a||null===c?!1:b(a)===b(c)};l.single_ooi=m;var q={},p=0,v=/^external:(.+):(.+)$/,u=/^[+-]?\d+$/})();"undefined"!==typeof dojo&&dojo.provide("alp.cfg.datatype");alp.i18n.fetch("alp.all");
(function(){alp.sub("alp.cfg",null,!0).datatype=function(){var g=function(){return{_default:"hikingTourTrail",_keys:function(){return alp.filter(alp.oKeys(this),function(b){return!/^_/.test(b)})},alpineClimbing:{iconUrl:"//www.outdooractive.com/res/small/alpineClimbing.png",id:"45678",default_network:"hiking",speed_kmh:{min:.1,max:3.9},travelMode:"WALKING"},alpineTour:{iconUrl:"//www.outdooractive.com/res/small/alpineTour.png",id:"12510",default_network:"hiking",speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"},
canyoning:{iconUrl:"//www.outdooractive.com/res/small/canyoning.png",id:"12280",default_network:"hiking",speed_kmh:{min:2,max:4},travelMode:"WALKING"},carriageRideTour:{iconUrl:"//www.outdooractive.com/res/small/carriageRideTour.png",id:"12370",default_network:"hiking",speed_kmh:{min:3,max:9},travelMode:"DRIVING"},cityTrail:{iconUrl:"//www.outdooractive.com/res/small/cityTrail.png",id:"12220",default_network:"hiking",speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"},cycling:{iconUrl:"http://res.oastatic.com/icons/alpstein/cycling/crimson/cycling.standard.png",
id:"12030",default_network:"cycling",speed_kmh:{min:5,max:25},travelMode:"BICYCLING"},hikingTourTrail:{iconUrl:"http://res.oastatic.com/icons/alpstein/hikingTourTrail/green_chili/hikingTourTrail.standard.png",id:"12000",default_network:"hiking",speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"},horsebackRidingTour:{iconUrl:"//www.outdooractive.com/res/small/horsebackRidingTour.png",id:"12360",default_network:"horseback",speed_kmh:{min:3,max:7},travelMode:"WALKING"},iceClimbing:{iconUrl:"//www.outdooractive.com/res/small/iceClimbing.png",
id:"23456",default_network:"hiking",speed_kmh:{min:.1,max:3.9},travelMode:"WALKING"},iceTour:{iconUrl:"//www.outdooractive.com/res/small/iceTour.png",id:"34567",default_network:"hiking",speed_kmh:{min:.1,max:3.9},travelMode:"WALKING"},inlineSkating:{iconUrl:"//www.outdooractive.com/res/small/inlineSkating.png",id:"12080",default_network:"hiking",speed_kmh:{min:5,max:15},travelMode:"WALKING"},kayak:{iconUrl:"//www.outdooractive.com/res/small/kayak.png",id:"12290",default_network:"hiking",speed_kmh:{min:4,
max:10},travelMode:"WALKING"},longDistanceCyclingTrack:{iconUrl:"http://res.oastatic.com/icons/alpstein/longDistanceCyclingTrack/maroon/longDistanceCyclingTrack.standard.png",id:"13550",default_network:"longDistanceCycling",speed_kmh:{min:5,max:25},travelMode:"BICYCLING"},longDistanceHikingTrail:{iconUrl:"http://res.oastatic.com/icons/alpstein/longDistanceHikingTrail/olive/longDistanceHikingTrail.standard.png",id:"12400",default_network:"longDistanceHiking",speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"},
motorbike:{iconUrl:"//www.outdooractive.com/res/small/motorbike.png",id:"5230",default_network:"hiking",speed_kmh:{min:3,max:60},travelMode:"WALKING"},mountainbiking:{iconUrl:"//www.outdooractive.com/res/small/mountainbiking.png",id:"12060",default_network:"mountainbiking",speed_kmh:{min:6,max:18},travelMode:"WALKING"},mountaineering:{iconUrl:"//www.outdooractive.com/res/small/mountaineering.png",id:"12050",default_network:"hiking",speed_kmh:{min:2,max:5},travelMode:"WALKING"},nordicwalkingTrail:{iconUrl:"//www.outdooractive.com/res/small/nordicwalkingTrail.png",
id:"13000",default_network:"hiking",speed_kmh:{min:3,max:7},travelMode:"WALKING"},offroad:{iconUrl:"//www.outdooractive.com/res/small/offroad.png",id:"5231",default_network:"hiking",speed_kmh:{min:3,max:60},travelMode:"WALKING"},pilgrimTrack:{iconUrl:"//www.outdooractive.com/res/small/pilgrimTrack.png",id:"12410",default_network:"hiking",speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"},racingBike:{iconUrl:"//www.outdooractive.com/res/small/racingBike.png",id:"12070",default_network:"cycling",speed_kmh:{min:10,
max:30},travelMode:"BICYCLING"},running:{iconUrl:"//www.outdooractive.com/res/small/running.png",id:"12150",default_network:"hiking",speed_kmh:{min:4,max:10},travelMode:"WALKING"},skiFreeride:{iconUrl:"//www.outdooractive.com/res/small/skiFreeride.png",id:"12040",default_network:"hiking",speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"},skijoering:{iconUrl:"//www.outdooractive.com/res/small/skijoering.png",id:"12390",default_network:"hiking",speed_kmh:{min:3,max:7},travelMode:"WALKING"},skitour:{iconUrl:"//www.outdooractive.com/res/small/skitour.png",
id:"12010",default_network:"hiking",speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"},skitrailCrosscountry:{iconUrl:"//www.outdooractive.com/res/small/skitrailCrosscountry.png",id:"5610",default_network:"hiking",speed_kmh:{min:3,max:7},travelMode:"WALKING"},skiTransit:{iconUrl:"//www.outdooractive.com/res/small/skiTransit.png",id:"12345",default_network:"hiking",speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"},sledging:{iconUrl:"//www.outdooractive.com/res/small/sledging.png",id:"12090",default_network:"hiking",
speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"},sleigh:{iconUrl:"//www.outdooractive.com/res/icons/alpstein/sleigh/maroon/sleigh.standard.png",id:"5083",default_network:"hiking",speed_kmh:{min:2,max:10},travelMode:"WALKING"},snowshoehiking:{iconUrl:"//www.outdooractive.com/res/small/snowshoehiking.png",id:"12100",default_network:"hiking",speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"},speedHikingTour:{iconUrl:"http://res.oastatic.com/icons/alpstein/hikingTourTrail/green_chili/speedHikingTour.standard.png",
id:"12666",default_network:"hiking",speed_kmh:{min:3.4,max:7.2},travelMode:"WALKING"},themeTrail:{iconUrl:"//www.outdooractive.com/res/small/themeTrail.png",id:"12200",default_network:"hiking",speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"},trailRunning:{iconUrl:"//www.outdooractive.com/res/small/trailRunning.png",id:"12320",default_network:"hiking",speed_kmh:{min:4,max:10},travelMode:"WALKING"},transalpMountainbiking:{iconUrl:"http://res.oastatic.com/icons/alpstein/transalpMountainbiking/maroon/transalpMountainbiking.standard.png",
id:"12020",default_network:"transalpMountainbiking",speed_kmh:{min:7,max:15},travelMode:"WALKING"},viaferrata:{iconUrl:"//www.outdooractive.com/res/small/viaferrata.png",id:"12120",default_network:"hiking",speed_kmh:{min:1,max:5},travelMode:"WALKING"},waterHiking:{iconUrl:"//www.outdooractive.com/res/small/waterHiking.png",id:"12300",default_network:"hiking",speed_kmh:{min:4,max:10},travelMode:"WALKING"},winterHiking:{iconUrl:"//www.outdooractive.com/res/small/winterHiking.png",id:"12130",default_network:"hiking",
speed_kmh:{min:2.2,max:6.2},travelMode:"WALKING"}}}(),f=alp.sub("alpConfig.datatype");alp.forIn(g,function(b,a){/^_/.test(a)||(b.name=a,b.title=function(){return k["datatype_"+a]})});if(!(g._default in g))for(var e in g)if(!(e in h||/^_/.test(e))){g._default=e;break}var d=document.location.protocol+"//",b=g[g._default];b.speed_kmh.a;alp.forIn(f||{},function(c,a){"string"===typeof c?g[a]=c:"object"===typeof c?(c=g[a]=alp.oCreateMix(g[a]||b,c),"iconUrl"in c&&!/^\w+:\/\//.test(c.iconUrl)&&(c.iconUrl=
d+c.iconUrl),g[c.id]=c):console.error("alp.cfg.datatype(): invalid typeof v "+typeof c+" for key "+a)});return g};var k={};alp.m(alp.i18n.fetch("alp.all"),["to","then"],function(g){k=g});var h={}})();"undefined"!==typeof dojo&&dojo.provide("alp.util.url_hash");
(function(){function k(e){return alp.map((""+e).split(","),encodeURIComponent).join(",")}function h(e){try{return decodeURIComponent(e)}catch(d){return e}}var g=alp.sub("alp.util.url_hash",null,!0),f={};g.decodeURIComponent=h;g.encodeURIComponentExceptComma=k;g.o2s=function(e,d){d=d&&d.prefix||"#";var b=[],c;for(c in e)c in f||b.push(k(c)+"="+k(e[c].replace(/&/g,"%amp;")));return d+b.join("&")};g.s2o=function(e,d){d=d&&d.prefix||"#";null==e&&(e="#"===d?location.hash:"?"===d?location.search:e);e=e.substring(d.length).split("&");
d={};for(var b=e.length,c=0;c<b;c++){var a=e[c].split("="),f=a[0];a=a.slice(1).join("=");f&&a&&(a=h(a),a=a.replace(/%amp;/g,"&"),d[decodeURIComponent(f)]=a)}return d};g.sorted=function(e){var d=e.charAt(0);d="#"===d||"?"===d?1:0;return e.substring(0,d)+e.substring(d).split("&").sort().join("&")}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api");
(function(){function k(a,c){function d(d,e){function l(b,c){var d=b&&(b.status||alp.oGet(b,"answer.status"));/^(failed|error)$/i.test(d)&&console.error('alp.data.api: Received status "'+d+'", response:',b,", ioArgs:",c);f[alp.Later?"done":"triggerSoon"](a.postProcess?a.postProcess(b):b)}d=alp.oCreateMix("function"===typeof a.cfg_default?a.cfg_default():a.cfg_default,alp.oCreateMix({locale:alp.i18n.language()},d));var f=alp.dfrd("alp.data.api reception",{then:1});d=alp.tmpl(alp.fVal(a.url_xd),d,c&&
c.noUrlEncoding?"":'alp.util.url_hash.encodeURIComponentExceptComma(v||"")',"");e=!e&&b[d]||(b[d]=alp.jsonp(d,{cache:!e}));e.to?e.to(l):e.then(l);return f}a=alp.oCreateMix(f,a);if(!a.url_xd)throw Error("alp.data.api_gen(): you must give at least `meta.url_xd`.");d._alp_meta=a;return d}function h(b){var e=b&&b.outdooractive||!/[\?&]where_oa=0(?:$|&)/.test(location.search),f,m={};return function(b){function l(a){var b=alp.arrSorted(alp.oKeys(a));return alp.map(b,'v+":"+this[v]',a).join(",")}function g(a){function c(c){var d=
l(alp.oCreateMix(b,{q:this(c)}));if(!(d in m)){var e=alp.dfrd("api:autocomplete:fillCache",{then:1}),f=alp.Later?"done":"triggerSoon";(m[d]=e)[f](alp.oCreateMix(a,{items:[c]}))}}alp.forEach(a.items,c,alp.f(".title"));alp.forEach(a.items,c,d)}f||(f=e?c:a);b=alp.mix({},b,{q:(b.q||"").toLowerCase()});var n=l(b),q=m[n];q||(q=m[n]=f(b),q[alp.Later?"to":"thenSoon"](g));return q}}var g=alp.data||(alp.data={}),f={cfg_default:{},url_xd:null},e=alp.cfg.datatype();g.api_gen=k;g.api_autocomplete=h();g.api_autocomplete_outdooractive=
h({outdooractive:!0});var d=alp.f('(v.title || "") + (v.categoryTitle ? " (" + v.categoryTitle + ")" : "")');g.api_autocomplete.TITLE_PLUS_CAT=d;g.api_avalanche_all_regions=k({cfg_default:function(){return{project:alp.sub("oa.API_CFG.proj")||"",key:alp.sub("oa.API_CFG.key")||"",cachebust:alp.sub("oa.API_CACHEBUST")||+new Date}},url_xd:alp.cfg.url.api_avalanche_all_regions_xd});g.api_avalanche_detail=k({cfg_default:{region_idlist:""},url_xd:alp.cfg.url.api_avalanche_detail_xd()});g.api_avalanche_history=
k({cfg_default:{region_idlist:"",day:""},url_xd:alp.cfg.url.api_avalanche_history_xd()});g.api_avalanche_short=k({cfg_default:{region_idlist:""},url_xd:alp.cfg.url.api_avalanche_short_xd()});g.api_bodypart=k({cfg_default:function(){return{path:"",project:alp.sub("oa.API_CFG.proj")||"",key:alp.sub("oa.API_CFG.key")||"",_quantityMap:"",cachebust:alp.sub("oa.API_CACHEBUST")||+new Date}},url_xd:alp.cfg.url.api_bodypart_xd});g.api_bodypart.PATH_AVALANCHE_SVG_ONE="/plugin/desktop/inc/avalanche.triangle.svg.inc";
g.api_bodypart.PATH_AVALANCHE_SVG_TWO="/plugin/desktop/inc/avalanche.triangle.svg.inc";g.api_cat=k({cfg_default:{project:"default",type:""},url_xd:alp.cfg.url.api_cat_xd()});g.api_cat_mcp=k({cfg_default:{project:"default",extra:""},url_xd:alp.cfg.url.api_cat_mcp_xd()},{noUrlEncoding:!0});g.api_catdiff=k({cfg_default:{catid:""},url_xd:alp.cfg.url.api_catdiff_xd()});g.api_event_datelist=k({cfg_default:{eventidlist:"",datefrom:"",dateto:""},url_xd:alp.cfg.url.api_event_datelist_xd()});g.api_filter=k({cfg_default:{proj:"",
request:"",rest:""},url_xd:alp.cfg.url.api_filter_xd()},{noUrlEncoding:!0});g.api_geocode=k({cfg_default:{project:"",limit:10,q:"",type:"poi"},url_xd:alp.cfg.url.api_geocode_xd()});g.api_image_meta=k({cfg_default:{id:""},url_xd:alp.cfg.url.api_image_meta_xd});g.api_ip_location=k({cfg_default:{},url_xd:alp.cfg.url.api_ip_location_xd()});g.api_mentz_departure=k({cfg_default:function(){return{id:"",cachebust:(Date.now?Date.now():+new Date)/6E4|0}},url_xd:alp.cfg.url.api_mentz_departure_xd()});g.api_nextbike_info=
k({cfg_default:function(){return{id:"",cachebust:(Date.now?Date.now():+new Date)/6E4|0}},url_xd:alp.cfg.url.api_nextbike_info_xd()});g.api_callabike_info=k({cfg_default:function(){return{id:"",cachebust:(Date.now?Date.now():+new Date)/6E4|0}},url_xd:alp.cfg.url.api_callabike_info_xd()});g.api_nearby=k({cfg_default:{project:"",type:"tour",location:"",radius:"",sortby:""},url_xd:alp.cfg.url.api_nearby_xd()});g.api_platform_info=k({cfg_default:{project:"",id:""},url_xd:alp.cfg.url.api_platform_info()});
g.api_region_geometry=k({cfg_default:{areaid:""},url_xd:alp.cfg.url.api_region_geometry_xd()});g.api_show_geometry=k({cfg_default:{idlist:"",catid:"",project:""},url_xd:alp.cfg.url.api_show_geometry_xd()});g.api_search=k({cfg_default:{project:"",q:""},url_xd:alp.cfg.url.api_search_xd()});g.api_search_type=k({cfg_default:{project:"",q:"",type:""},url_xd:alp.cfg.url.api_search_type_xd()});g.api_oois=k({cfg_default:{project:"",idlist:"",locale:"",cacheBust:"",edit:""},url_xd:alp.cfg.url.api_oois_xd()});
g.api_oois_flexview=k({cfg_default:{project:"",flexview:"",idlist:"",locale:"",cacheBust:"",edit:""},url_xd:alp.cfg.url.api_oois_flexview_xd()});g.api_oois_minimal=k({cfg_default:{project:"",idlist:"",locale:"",cacheBust:""},url_xd:alp.cfg.url.api_oois_minimal_xd()});g.api_oois_geometry=k({cfg_default:{project:"",idlist:"",locale:"",cacheBust:""},url_xd:alp.cfg.url.api_oois_geometry_xd(),postProcess:function(a){function b(a){a=alp.map(a.split(" "),'(v=v.split(",")), v.length < 3  ?  [+v[0],+v[1]]  :  [+v[0],+v[1],+v[2]]');
var b=a.length-1;return alp.loop(0,b,"ret[v]=[that[v],that[v+1]]",{that:a,retInit:"new Array("+b+")"})}var c=a.tour;return c&&c.length?alp.oCreateMix(a,{tour:alp.map(c,function(a){return a.geoJson?a:alp.oCreateMix(a,{geoJson:alp.oToString({type:"MULTILINESTRING",coordinates:b(a.geometry),datatype_name:alp.oGet(a,"category.datatype_name")||e._default})})})}):a}});g.api_oois_lightweightApp=k({cfg_default:{project:"",idlist:"",locale:"",lightweightApp:"",cacheBust:""},url_xd:alp.cfg.url.api_oois_lightweightApp_xd()});
var b={},c=k({cfg_default:function(){return{proj:alp.sub("oa.API_CFG.proj")||"",subset:"poi,hut,lodging,skiresort,region,location",q:""}},url_xd:alp.cfg.url.api_autocomplete_outdooractive_xd(),postProcess:function(a){function b(a){return{id:a.id,category:null,categoryTitle:a.subtitle,title:a.title,isRegion:"region"===a.type,type:a.type,geometry:a.bbox?a.bbox[0][0]+" "+a.bbox[0][1]+","+a.bbox[1][0]+" "+a.bbox[1][1]:a.point[0]+" "+a.point[1],point:a.bbox?a.point[0]+" "+a.point[1]:null}}var c=a&&alp.oGet(a,
"header.status");/^ok$/i.test(c)||(console.error("alp.data.api.outdooractive: got unexpected status "+c,a),null.invalid);return{items:a.answer.contents?alp.map(a.answer.contents,b):[]}}}),a=k({cfg_default:function(){return{proj:alp.sub("oa.API_CFG.proj")||"",subset:"poi,region",q:""}},url_xd:alp.cfg.url.api_autocomplete_xd()})})();"undefined"!==typeof dojo&&dojo.provide("alp.data._oois_api_call");
(function(){function k(a){return a.minimal?75*Math.max(1,1+l%4):(alp.likeIE8minus_backslash_v(),100)}function h(a,d,e){function l(){n[a]=null;r(a)}(a||0).substring.call.a;e.length.toPrecision.call.a;e.length&&(e[0]||0).substring.call.a;a in b||(b[a]=d);d=c[a]||(c[a]=[]);d.push.apply(d,e);null==n[a]&&(n[a]=setTimeout(l,33))}function g(d){if(d){(d||0).substring.call.a;for(var e=b[d],g=c[d],n=alp.fVal(m,e);g.length&&l<n;){l++;var q=g.splice(0,alp.fVal(k,e)),h=alp.oCreateMix(b[d],{idlist:q.join(",")});
h=alp.data[e.minimal?"api_oois_minimal":e.lightweightApp?"api_oois_lightweightApp":e.flexview?"api_oois_flexview":"api_oois"](h);q=alp.bindF(f,null,d,q);alp.Later?h.to(q):h.thenSoon(q)}g.length&&alp.asyncF(250,r)(d)}else for(d in c)d in a||r(d)}function f(b,c,f){l--;var m=alp.arr2oSimple(c);c=d[b];for(var g in f)if(!(g in a))for(var p=f[g],n=p.length;n--;){var q=p[n],h=q.id,k=e.external_info(q,null,!0),v=q.requestedId,E=e.ooiid.is_alpstein(v)?v:h;q.id!==E&&(q.id=E,q.mainId=h);q.frontendtype||(q.frontendtype=
g);h={};h[g]=[q];E&&E in m&&(q=c[E],alp.Later?q.done(h):q.triggerSoon(h),delete m[E]);k&&k in m&&(q=c[k],alp.Later?q.done(h):q.triggerSoon(h),delete m[k]);v&&v in m&&(q=c[v],!E||E in c||(c[E]=q),alp.Later?q.done(h):q.triggerSoon(h),delete m[v])}f=alp.oKeys(m);f.length&&(console.error("alp.data._oois_api_call:receive_one_piece: Ignoring missing ids "+alp.oToString(f)),alp.forEach(f,alp.Later?"this[v].done()":"this[v].triggerSoon()",c));r(b)}var e=alp.sub("alp.data",null,!0);e._oois_api_call=function(b){var c=
b.idlist;c.splice.call.a;c=[].concat(c);c.sort();var e=alp.dfrd("oois_api_call:ret",{then:1}),l=alp.filter(alp.oKeys(b),'!="idlist"');l.sort();l=alp.map(l,'v+":"+alp.oToString(this[v])',b).join(",");var f=d[l]||(d[l]={}),m=alp.filter(c,"!(v in this)",f);alp.forEach(m,'this[v]=alp.dfrd("_oois_api_call:"+v)',f);h(l,b,m);alp.m(alp.gatherDfrd(alp.map(c,"this[v]",f)),["to","thenSoon"],function(b){for(var c={},d=b.length;d--;){var l=b[d][0];if(l)for(var f in l){if(!(f in a)){var m=l[f];if(m&&m.length){var g=
c[f]||(c[f]=[]);g.push.apply(g,m)}}}else console.error("alp.data._oois_api_call:merge_all_results: maybe a backend failure, or none of the ids were found for a piece.")}alp.Later?e.done(c):e.triggerSoon(c)});return e};var d={},b={},c={},a={},m=alp.likeIE8minus_backslash_v()?4:12,l=0,r=alp.Later?g:alp.nowF(g),n={}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.token");
(function(){var k=alp.sub("alp.data.api",null,!0);k.token=function(){function g(f){var e=alp.oFrom(f&&f.responseText||""),d=e&&e.status;/^ok$/i.test(d)?(e.token.substring.call.a,e.token?f=e.token:(console.error("alp.data.token: Received an empty token! Answer:",e),f="invalid_token")):(console.error("alp.data.token: Could not retrieve token! Received status "+d+", answer: ",f),f="invalid_token");alp.m(h,["done","triggerSoon"],f)}h||(h=alp.dfrd("ADA:token",{then:1}),alp.m(alp.xhrGet(alp.cfg.url.api_token()),
["to","then"],g));return h};k.INVALID_TOKEN="invalid_token";var h})();"undefined"!==typeof dojo?dojo.provide("alp.data.oois"):alp.data||(alp.data={});
(function(){function k(b){function c(b){function c(b){if("error"===alp.opt(b,"status"))console.error("alp.data.OOIs:oois_receiver: backend failure. response:",b);else{a.token||a.acceptUnpublished||(b=alp.mapIn(b,h));var c=g.allMaintype(b,e);d(b,c)}}alp.Later||(d=alp.nowF(d));b&&!a.token&&(a.token=b);if(b=a.idlist){var e="string"===typeof b?b.split(","):b;b=g._oois_api_call({proj:a.proj||"",idlist:e,locale:a.language||alp.i18n.language(),minimal:a.minimal,lightweightApp:a.lightweightApp,flexview:a.flexview,
edit:a.edit,token:a.token,acceptUnpublished:a.acceptUnpublished,cacheBust:a.cacheBust});alp.m(b,["to","thenSoon"],c)}}var a=this,d=alp.bindF.apply(alp,arguments),e=alp.nodify("oax-fetch-token");e&&"true"===e.value&&!a.token?alp.m(f.token(),["to","thenSoon"],c):c()}function h(b){var c=[];b=alp.filter(b,'"published" === alp.oGet(v, "meta.workflow.state" )  ||  (this.push(v.id),false)',c);0<c.length&&!d&&(d=!0,console.error("oa: unpublished object(s) rejected - this might lead to GUI trouble. Please remove the id(s) or make sure they are published in CMS: ",
c.join(",")));return b}var g=alp.data,f=g.api;alp.declare("alp.data.SingleOOI",null,function(b,c){(b||0).substring.call.a;this.id=b;this.cfg=alp.oCreateMix({proj:"",cacheBust:alp.sub("alpConfig.cachebust")||"",language:alp.i18n.language()},c||{})},{load:function(b){var c=this,a=alp.bindF.apply(alp,arguments);(new g.OOIs(alp.oCreateMix(c.cfg,{idlist:[c.id]}))).load(function(b){(b=alp.data.single_ooi(b,c.id))?a(b,alp.data.ooi_geometry(b.data)):a(null)})}});var e={};alp.declare("alp.data.OOIs",null,
function(b){if("object"!==typeof b)throw Error("alp.data.OOIs.constructor() needs a `cfg` object!");for(var c in b)c in e||(this[c]=b[c]);this.proj||(this.proj=alp.sub("oa.API_CFG.proj")||"");this.proj||console.warn("Trying to access ALPstein API without a `proj` value. Results not guaranteed -- It is safer to specify a `proj` value.")},{proj:null,idlist:null,language:alp.i18n.language(),minimal:!1,lightweightApp:null,edit:null,token:null,acceptUnpublished:!1,flexview:null,cacheBust:"",load_dfrd:function(){this._load_dfrd||
(this._load_dfrd=alp.dfrd("alp.data.OOIs loaded"),this.load(alp.Later?"done":"triggerSoon",this._load_dfrd));return this._load_dfrd},load:alp.Later?k:alp.nowF(k)});var d;alp.declare("alp.data.GeometryOOIs",null,function(b,c){b.length.a;this.idlist=b;this.cfg=alp.oCreateMix({proj:"",cacheBust:alp.sub("alpConfig.cachebust")||"",language:alp.i18n.language()},c||{})},{load:function(b){function c(b){b&&!a.token&&(a.token=b);b=g.api_oois_geometry(alp.oCreateMix(a.cfg,{idlist:a.idlist,token:a.token}));alp.m(b,
["to","thenSoon"],d)}var a=this,d=alp.bindF.apply(alp,arguments),e=alp.nodify("oax-fetch-token");e&&"true"===e.value&&!a.token?alp.m(f.token(),["to","thenSoon"],c):c()}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.map_extend");
alp.gmap3(function(k){function h(){function b(){c._alp_last_size=null}var c=this,a;if(c.hasOwnProperty("_alp_last_size")){if(a=c._alp_last_size)return a}else b(),g.event("addListener")(c,"resize",b);if(a=alp.m(c,"getDiv")){var d=alp.gBCR(a);d=c._alp_last_size=new k.Size(d.width,d.height)}d||console.error("alp._gmap_2_3: getSize() failed on map:",c);return d}var g=alp._gmap2_3,f=k.Map.prototype,e={};f.getDiv||(f.getDiv=f.getContainer);f.fitBounds||(f.fitBounds=function(b){if("getBoundsZoomLevel"in
f){var c=f.getBoundsZoomLevel.call(this,b);this.setCenter(b.getCenter(),c);this.setZoom(c)}});f.centerOOI=function(b,c){this.fitOOI(b,alp.oCreateMix({zoom:null},alp.oCreateMix(c||{},{noFit:!0})))};var d={padding:.05,iw:!1,noFit:!1};f.fitOOI=function(b,c){function a(a,d){a=alp.data.ooi_geometry(a.data||d,{polyline:!0});var e=new k.LatLngBounds;if("x"in a&&"y"in a){var f=new k.LatLng(a.y,a.x);e.extend(f);c.iw&&(d=g.getProjection(l))&&(f=g.fromLatLngToPixel(d,f,14),f=new k.Point(f.x+150,f.y-300),d=g.fromPixelToLatLng(d,
f,14),e.extend(d));"polyline"in a&&alp.forEach(g.xy2latlng(a.polyline),function(a){e.extend(a)});l.whenLoaded(function(){c.noFit?l.setCenter(e.getCenter()):g.set_bbox(l,e,c.padding,alp.opt(c,["maxZoom"]));r.triggerSoon()})}else console.error("alp._gmap2_3.fitOOI could not determine the geometry of ooi with id:"+b)}function f(a){var b=new k.LatLngBounds,d;for(d in a)d in e||alp.forEach(a[d],function(a){a=alp.data.ooi_geometry(a);b.extend(new k.LatLng(a.y,a.x))});l.whenLoaded(function(){c&&c.noFit?
l.setCenter(b.getCenter()):g.set_bbox(l,b,c.padding,alp.opt(c,["maxZoom"]));r.triggerSoon()})}var l=this,r=alp.dfrd("map_extend:fitOOI",{then:!0});c=alp.oCreateMix(d,c);var n=c.proj;null==n&&(n=alp.sub("oa.API_CFG.proj"));n||(n="");n||console.warn('---------- Alpstein Warning! You have called fitOOI() without a project variable, consider using fitOOI( <id>, { proj : "<project_id>" } ).');"string"===typeof b?(new alp.data.SingleOOI(b,{proj:n})).load(a):(new alp.data.OOIs({idlist:b,proj:n})).load(f);
return r};f.getSize||(f.getSize=h);f.getWorldBounds=function(){var b=this.getBounds(),c=b&&alp.opt(this.getSize(),"width");if(!(0<c))return b;var a=this.getZoom();return 255<=Math.round(c/Math.pow(2,a))?new k.LatLngBounds(new k.LatLng(b.getSouthWest().lat(),-180+1E-10),new k.LatLng(b.getNorthEast().lat(),180-1E-10)):b};f.isLoaded||(f.isLoaded=function(){if("getBounds"in this)return this.getBounds()});f.setOptions||(f.setOptions=function(b){"disableDoubleClickZoom"in b&&this.disableDoubleClickZoom&&
this.enableDoubleClickZoom&&(b.disableDoubleClickZoom?this.disableDoubleClickZoom():this.enableDoubleClickZoom())});f.whenLoaded=alp.nowF(function(b,c){function a(){d()}var d=alp.bindF.apply(alp,arguments);this._alp&&this._alp.init_cb?this._alp.init_cb(a):alp.subDfrd(alp.bindF("isLoaded",this)).thenSoon(a)})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.view.abstract_map_control");
alp.gmap3(function(k){function h(e,d,b,c,a){e.next(function(e){for(var l=b.controls[c],f=l.getLength();f--;)l.getAt(f)===a&&l.removeAt(f);d();e()})}function g(e,d,b,c,a){e.next(function(e){d(b,a,function(){b.controls[c].push(a);e()})})}var f=alp._gmap2_3;alp.declare("alp._gmap2_3.view.AbstractMapControl",null,function(){if(f.V2()&&k.Control){var e=new GControl(this.printable(),this.selectable()),d;for(d in e)d in this||(this[d]=e[d])}},{whenLoc:null,getDiv:function(){throw Error("alp._gmap2_3.view.AbstractMapControl.getDiv() must be implemented!");
},getPositionV3:function(){return k.ControlPosition.RIGHT_BOTTOM},getPositionV2:function(){return new k.ControlPosition(k.ANCHOR_BOTTOM_RIGHT,new k.Size(2,16))},alp_create:function(e){},alp_destroy:function(e){},printable:function(){return!1},selectable:function(){return!1},getMap:function(){return this._alpMap},setMap:function(e){function d(){var c=b.getMap();f.V2()?(alp.m(c,"removeControl",b),(b._alpMap=e)&&e.addControl(b)):(c&&c.controls&&h(b._v3_map_seq(),alp.bindF("clear",b),c,b.getPositionV3(),
b.getDiv()),e&&e.controls&&g(b._v3_map_seq(),alp.bindF("initialize",b),e,b.getPositionV3(),b.getDiv()))}var b=this;b.whenLoc?b.whenLoc.then(d):d()},initialize:function(e,d,b){function c(){a.alp_create(a.getMap());f.V2()&&e.getDiv().appendChild(d);b&&b()}var a=this;d||(d=a.getDiv());a._alpMap=e;a.whenLoc?a.whenLoc.then(c):c();return d},clear:function(){function e(){"function"===typeof GControl&&(GControl.prototype.clear.apply(d,arguments),alp.orphan(d.getDiv()));d.alp_destroy(d.getMap());d._alpMap=
null}var d=this;d.whenLoc?d.whenLoc.then(e):e()},getDefaultPosition:function(){return this.getPositionV2()},_v3_map_seq:alp.memM("_v3_map_seq","alp.asyncSeq()")})});"undefined"!==typeof dojo&&dojo.provide("alp.cfg.button");alp.i18n.fetch("alp.all");
(function(){var k={};alp.m(alp.i18n.fetch("alp.all"),["to","then"],function(h){k=h});(alp.cfg||(alp.cfg={})).button=function(){return{bing_maps_medium_white:{url:alp.urlCachebust(alp.cssBase()+"alp/images/bing_maps_medium_white.png"),width:125,height:27,style:"border: none 0px transparent",alt:"Bing Maps",title:"Bing Maps",href:"//www.bing.com/maps",target:"_blank"},bing_maps_small_white:{url:alp.urlCachebust(alp.cssBase()+"alp/images/bing_maps_small_white.png"),width:88,height:19,style:"border: none 0px transparent",
alt:"Bing Maps",title:"Bing Maps",href:"//www.bing.com/maps",target:"_blank"},bing_maps_small_white_pad3:{url:alp.urlCachebust(alp.cssBase()+"alp/images/bing_maps_small_white_pad3.png"),width:94,height:25,style:"border: none 0px transparent",alt:"Bing Maps",title:"Bing Maps",href:"//www.bing.com/maps",target:"_blank"},manual_off:{url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/manual_off_42.png"),width:42,height:42},manual_on:{url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/manual_on_42.png"),
width:42,height:42},powered_by_oa:{url:alp.urlCachebust(alp.cssBase()+"alp/images/powered_by_oa.png"),width:114,height:21,style:"border: none 0px transparent",alt:"Powered by outdooractive.com",title:"Powered by outdooractive.com",href:"//www.outdooractive.com",target:"_blank"},routed_off:{url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/routed_auto_off_42.png"),width:42,height:42},routed_on:{url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/routed_auto_on_42.png"),
width:42,height:42},segment_network_off:{url:alp.urlCachebust(alp.cssBase()+"alp/images/mg_segment_property_215px_off.png"),width:215,height:27,text:null},segment_network_on:{url:alp.urlCachebust(alp.cssBase()+"alp/images/mg_segment_property_215px_on.png"),width:215,height:27,text:null},segment_fast_off:{url:alp.urlCachebust(alp.cssBase()+"alp/images/mg_segment_property_off.png"),width:65,height:27,text:function(){return k.segmentPropertyFast}},segment_fast_on:{url:alp.urlCachebust(alp.cssBase()+
"alp/images/mg_segment_property_on.png"),width:65,height:27,text:function(){return k.segmentPropertyFast}},segment_flat_off:{url:alp.urlCachebust(alp.cssBase()+"alp/images/mg_segment_property_off.png"),width:65,height:27,text:function(){return k.segmentPropertyFlat}},segment_flat_on:{url:alp.urlCachebust(alp.cssBase()+"alp/images/mg_segment_property_on.png"),width:65,height:27,text:function(){return k.segmentPropertyFlat}},segment_short_off:{url:alp.urlCachebust(alp.cssBase()+"alp/images/mg_segment_property_off.png"),
width:65,height:27,text:function(){return k.segmentPropertyShort}},segment_short_on:{url:alp.urlCachebust(alp.cssBase()+"alp/images/mg_segment_property_on.png"),width:65,height:27,text:function(){return k.segmentPropertyShort}},show_region_on_google_maps:{style:"opacity: 0; width: 62px; height: 19px;"}}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.view.powered_by_oa");
alp.gmap3(function(k){function h(f){setTimeout(function(){f.getDiv().style.zIndex=99999999},567)}var g=alp._gmap2_3||(alp._gmap2_3={});alp.declare("alp._gmap2_3.view.PoweredByOA",g.view.AbstractMapControl,function(){this._cfg=alp.cfg.button().powered_by_oa;this._div=alp.cE("div",null,{style:"display: inline-block; clear: none;","class":"oax-powered"});alp.cE("img",alp.cE("a",this._div,alp.opt(this._cfg,["href","target"])),alp.oCreateMix(alp.opt(this._cfg,["alt","title","width","url","style"]),{src:this._cfg.url}))},
{getDiv:function(){h(this);return this._div},getPositionV3:function(){h(this);return k.ControlPosition.BOTTOM_LEFT},getPositionV2:function(){return new k.ControlPosition(k.ANCHOR_BOTTOM_LEFT,new k.Size(65,0))}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.view.show_region_on_google_maps");
alp.gmap3(function(k){function h(f){setTimeout(function(){f.getDiv().style.zIndex=99999999},567)}var g=alp._gmap2_3||(alp._gmap2_3={});alp.declare("alp._gmap2_3.view.ShowRegionOnGoogleMaps",g.view.AbstractMapControl,function(){if(!k.isLeafletGshim)throw Error("show_region_on_google_maps_ctor: only for leaflet_gshim");this._cfg=alp.cfg.button().show_region_on_google_maps;this._div=alp.aC(alp.cE("div",null,k.isLeafletGshim&&{style:this._cfg.style}),this._a=alp.cE("a",null,k.isLeafletGshim&&{style:this._cfg.style},
{innerHTML:"&nbsp;"}))},{getDiv:function(){h(this);return this._div},getPositionV3:function(){h(this);return k.ControlPosition.BOTTOM_LEFT},alp_create:function(f){function e(){var c=f.getCenter(),a=f.getZoom();c&&null!=a&&alp.sA(b._a,{title:"Klicken, um diese Region in Google Maps anzuzeigen",href:"http://maps.google.com/maps?ll="+c.lat()+","+c.lng()+"&z="+a+"&t=m&hl=de&gl=US&mapclient=apiv3",target:"_blank",style:"display: block;"})}function d(){var c=f.getMapTypeId(),a=alp.or(alp.oValues(k.MapTypeId),
'==="'+c+'"');c=/^oa_hybrid$/.test(c);alp.style(b._div,{display:a||c?"inline-block":"none",clear:"none","margin-top":"10px","margin-bottom":"0px"})}var b=this;b._eh().clear().push(g.event("addListener")(f,"bounds_changed",alp.ratelimitF(357,e)),g.event("removeListener")).push(g.event("addListener")(f,"maptypeid_changed",alp.ratelimitF(357,d)),g.event("removeListener"));f.whenLoaded(function(){e();d()})},alp_remove:function(f){this._eh().clear()},_eh:alp.memM("_eh","new alp.Eh")})});
"undefined"!==typeof dojo&&dojo.provide("alp.cfg.maptypeid");
(function(){function k(d){return alp.sub("alpregio")?d:"string"!==typeof d?alp.map(d,k):f[d]||d}function h(d){e||(e={},alp.forIn(f,"this[v]=w",e),console.log("xxx _______ mtid  _OLD_MTID_OF_NEW",e));return alp.sub("alpregio")?d:"string"!==typeof d?alp.map(d,h):e[d]||d}var g=alp.sub("alp.cfg.maptypeid",null,!0);g.get_new_mtid=k;g.get_old_mtid=h;var f={oa_hybrid:"oac:hybrid",oa_map:"oac:summer",oa_map_winter:"oac:winter",oa_mb_satellite_streets:"osm:hybrid",oa_osm:"osm:summer",oa_osm_winter:"osm:winter",
oa_topo:"topo:topo",satellite:"osm:hybrid",oa_hiking:"oac:hiking",oa_longDistanceHiking:"oac:hiking",oa_cycling:"oac:cycling",oa_longDistanceCycling:"oac:cycling",oa_mountainbiking:"oac:mtb",oa_horseback:"oac:horse"},e})();"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.x.copyright");
alp.gmap3(function(k){var h={},g=alp.arr2oSimple(alp.oValues(k.MapTypeId));alp.declare("alp.gmap3.x.Copyright",null,function(f,e){var d=this,b;for(b in e)b in h||(d[b]=e[b]);d.map=f;k===alp.sub("google.maps")&&(alp.forEach(["bounds_changed","drag","idle","maptypeid_changed","zoom_changed"],function(b){k.event.addListener(f,b,function(){alp.asyncF(0,"_update_once_in_a_while",d)(b)})}),this._update_once_in_a_while(),alp.asyncF(1E3,"_update_once_in_a_while",this)())},{map:null,delay_ms:500,_update_once_in_a_while:function(f){this._update_event_name=
f;f=Date.now?Date.now():+new Date;null==this._last_update_date?this._update():f<this._next_update_date||(this._next_update_date=+this._last_update_date+1E3,alp.asyncF(this._next_update_date-f,"_update",this)())},_update:function(){this._last_update_date=Date.now?Date.now():+new Date;this.map.whenLoaded("_update_impl",this,this._update_event_name)},_get_hdiv:function(){if(!this._hdiv){var f=alp.body();this._hcont=alp.cE("div");this._hdiv=alp.cE("div",this._hcont);this._hcont.style.width="100px";this._hcont.style.height=
"100px";this._hcont.style.overflow="hidden";this._hcont.style.position="absolute";this._hcont.style.left="-99999px";this._hcont.style.top="-99999px";this._hcont.style.visibility="hidden";alp.aC(f,this._hcont)}return this._hdiv},_get_hmap:function(){return this._hmap||(this._hmap=new k.Map(this._get_hdiv(),{center:new k.LatLng(48,10.5),zoom:9,mapTypeId:k.MapTypeId.ROADMAP}))},_update_impl:function(f){function e(d){if(d){var l=typeof d;"function"===l?d(b,c,a):"string"===l?alp.cTxN(d,b):"parentNode"in
d?alp.aC(b,d):"object"===l&&null!=d.length?alp.forEach(d,e):console.error("alp.gmap3.x.Copyright (copyright text update) unrecognized:",d)}}var d=this.map,b=this._copyright(d.getDiv(),!0);if(b&&(f=d.getMapTypeId(),!(f in g))){f=(f=d.mapTypes.get(f))&&f._alp_copyright_spec;var c=d.getBounds(),a=d.getZoom();d=f&&f.mapTypeId;var m="",l=0,r=Infinity;d&&"object"===typeof d&&(d=d.id,l=d.minZoom,r=d.maxZoom);var n;if(d&&(n=this._get_hmap())&&n.mapTypes.get(d)&&!(a<l||a>r)){if(!this._ensure_same_size())return;
n.getMapTypeId()!==d&&n.setMapTypeId(d);m=(n=this._copyright(this._hdiv))&&alp.textContent(n)}n=[f&&f.before,m,f&&f.after];alp.empty(b);f=n.length;for(d=0;d<f;d++)e(n[d]),d===f-1&&e(alp.cTxN(" - "));b.style.marginLeft="-"+(b.clientWidth||alp.gBCR(b).width)+"px"}},_ensure_same_size:function(){var f=this.map,e=f.getDiv(),d=alp.gBCR(e);if(e=this._hmap){var b=this._hdiv;if(b){var c=alp.gBCR(b),a=!0,m=Math.round(d.width);d=Math.round(d.height);var l=Math.round(c.height);m!==Math.round(c.width)&&(b.style.width=
m+"px",a=!1);d!==l&&(b.style.height=d+"px",a=!1);a||k.event.trigger(e,"resize");b=f.getZoom();e.setCenter(f.getCenter(),b);e.setZoom(b);return a}}},_copyright:function(f,e){function d(b,a){return b===a?!1:"none"===b.style.display||"hidden"===b.style.visibility?!0:d(b.parentNode,a)}if(f=this._copyright_container(f)){for(var b=f.firstChild;b&&(!/^(span)$/i.test(b.tagName)||d(b,f));b=b.nextSibling);!b&&e&&(b=alp.cE("span",null,{"class":"alp-g-copyright-cont"}),alp.place(b,f,"first"));return b}},_copyright_container:alp.nowF(function(f){function e(a){var b=
a&&a.childNodes;if(b&&b.length)return alp.or(b,"v  &&  v.tagName  &&  /^(a|span)$/i.test(v.tagName)/")?a:alp.or(b,e)}this._copyright_container_map=this._copyright_container_map||new alp.mapany;var d=this._copyright_container_map.get(f);if(d)return d;var b=alp.gBCR(f);if(0<b.width&&0<b.height){var c=f.firstChild;if(c){for(d=[];c&&1===c.children.length;)c=c.children[0];c=c.childNodes;for(var a=c.length;a--;)d.push(c[a]);if(!(2>d.length)){d=alp.map(d,e);c=d.length&&alp.map(d,function(a){if(!a)return Infinity;
alp.gBCR(a);return-(b.left+b.width)-(b.top+b.height)});a=-1;for(var m=Infinity,l=c.length;l--;){var g=c[l];g<m&&(a=l,m=g)}(d=0<a&&d[a])&&this._copyright_container_map.set(f,d);return d}}}})})});"undefined"!==typeof dojo&&dojo.provide("alp.maps.mapconfig.const");
(function(){var k=alp.sub("alp.maps.mapconfig",null,!0);k.MAYBE_VECTOR_MAPTYPEID_JOIN=function(h,g){var f="string"===typeof h,e=f?h:h[0];h=f?g:h[1];(e||null).substring.call.a;(h||null).substring.call.a;return e+":"+h};k.MAYBE_VECTOR_MAPTYPEID_SPLIT=function(h){h=h.split(":");if(2===h.length){var g=h[0],f=h[1];if(g&&f)return h.basename=g,h.style=f,h}};k.SEP=alp.f('":"');k.ENABLE_VECTOR=alp.f('"enableVector"');k.MAPBOX_ACCESS_TOKEN=alp.f('"mapboxAccessToken"');k.STYLE_FILE=alp.f('"styleFile"');k._ENABLE_VECTOR=
alp.f('"_enableVector"');k._IS_OVERLAY=alp.f('"_isOverlay"');k._MAPBOX_ACCESS_TOKEN=alp.f('"_mapboxAccessToken"');k._STYLE_FILE=alp.f('"_styleFile"');k._OA_MAPTYPEID=alp.f('"_oa_maptypeid"');k._OA_UNIQUE_OV_ID=alp.f('"_oa_unique_ov_id"');k.VECTOR=alp.f('"vector"')})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.has_gmap");(function(){alp.sub("alp.maps",null,!0).has_gmap=function(){var k=alp.sub("oa.API_CFG");return k&&(k.gmapkey||k.gmapclientid)||"function"===typeof alp.sub("google.maps.Map")}})();
"undefined"!==typeof dojo?dojo.provide("alp.util.withinit"):alp.util||(alp.util={});alp.util.InterfaceWithInit={init_dfrd:alp.memM("init_dfrd",'alp.dfrd("withinit")'),mark_init_done:function(k){this.init_dfrd().done(k||this)},init:alp.nowF("initImpl"),init_cb:function(k,h){var g=alp.Aps.call(arguments);if("object"==typeof g[0]){var f=g[0];g[0]=g[1];g[1]=f}this.init_dfrd().thenSoon(alp.bindF.apply(alp,g))},whenLoaded:alp.nowF(function(k){this.init_cb.apply(this,arguments);return this}),is_initialized:function(){return this.init_dfrd().triggered()}};
alp.declare("alp.util.AbstractWithInit",null,null,alp.util.InterfaceWithInit);alp.mix(alp.util.AbstractWithInit,alp.util.InterfaceWithInit);"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.map");
alp.gmap3(function(k){function h(a,b){function c(){var c=a.getMapTypeId();alp.forEach(d,function(d){g.setOvmtLater(a,b[d],c===d)})}g.setOvmtLater(a,b["*"]||[],!0);var d=alp.filter(alp.oKeys(b),'!="*"');d.length&&(c(),g.event("addListener")(a,"maptypeid_changed",c))}var g=alp._gmap2_3,f=alp.maps,e=f.mapconfig;e.SEP();var d=e.MAYBE_VECTOR_MAPTYPEID_SPLIT,b=e.MAYBE_VECTOR_MAPTYPEID_JOIN,c=alp.cfg.maptypeid.get_new_mtid,a=k.Map.prototype.setOptions;alp.declare("alp.gmap3.Map",k.Map,alp.nowF(function(a,
e){function l(){var a=y.getBounds(),b=alp.m(a,"toSpan");return b&&isFinite(b.lat())&&isFinite(b.lng())&&a}function m(){return 0<a.clientWidth&&0<a.clientHeight}function q(){k.event.trigger(y,"resize")}function p(a,b,c){if(!c&&I)alp.onDCL(alp.asyncF(1E3,alp.bindF(p,null,a,b,!0)));else y.mapTypes.set(a,b)}function v(){alp.onDCL(function(){alp.asyncF(3E3,function(){y._alp.x_copyright=new alp.gmap3.x.Copyright(y)})()})}function u(){y.setMapTypeId(H)}function t(){alp.onDCL(w)}function w(){var b=a.clientWidth,
c=a.clientHeight,d=Date.now?Date.now():+new Date;b&&c&&(null==F||b===F&&c===D||(M=d),F=b,D=c);setTimeout(w,254);M&&341<d-M&&(M=null,g.event("trigger")(y,"resize"))}e||(e={});if(e.bounds){e=alp.oCreateMix(e,g.bounds2zoomcenter(e.bounds,{width:a.clientWidth,height:a.clientHeight}));var x=e.zoom;this.setCenter(e.center,x);this.setZoom(x)}void 0===e.mapTypeControl?e.mapTypeControl=!0:null===e.mapTypeControl&&(e.mapTypeControl=!1);alp.oGet(e,"mapTypeControlOptions.mapTypeIds")||alp.oSet(e,"mapTypeControlOptions.mapTypeIds",
alp.filter(["oa_map","oa_hybrid","oa_osm",alp.oGet(k,"MapTypeId.ROADMAP"),alp.oGet(k,"MapTypeId.SATELLITE"),alp.oGet(k,"MapTypeId.TERRAIN"),"oa_map_winter","oa_topo"],""));e.mapTypeId||(e.mapTypeId=alp.oGet(e,"mapTypeControlOptions.mapTypeIds")[0]);e.mapTypeId&&/^alpstein_/i.test(e.mapTypeid)&&(e.mapTypeId=e.mapTypeId.replace(/^alpstein_/i,"oa_"),this.setMapTypeId(e.mapTypeId));var y=this;y._alp||(y._alp=new alp.util.AbstractWithInit);y._alp.scrollwheel=!1!==e.scrollwheel;var z,A,C=alp.body(),E=document.documentElement;
alp.m(a,"addEventListener","DOMMouseScroll",function(a){y._alp.scrollwheel&&a.axis===a.VERTICAL_AXIS&&(z=C.scrollTop,A=E.scrollTop,setTimeout(function(){C.scrollTop=z;E.scrollTop=A}))},!0);g.event("addListenerOnce")(this,"tilesloaded",function(){l()&&alp.now("mark_init_done",y._alp)});setTimeout(function(){alp.subDfrd(l).then(alp.asyncF(1732,alp.nowF("mark_init_done",y._alp)))},0);m()||alp.subDfrd(m).then(q);x=e&&e.oa;var G=e&&e.alp;G&&console.error("The `cfg.alp` configuration is deprecated. Please rename it to `cfg.oa`.");
var B=alp.oCreateMix({layermask_fineformat:"jsonp",tilelist_url_base:alp.jsonpBase()+"tilelist/",mapButton3d:!0,overlayMapTypeIds:null,kmlurl3d:null,autoResize:!1},alp.oDeepMix({},G,x)),I=B.loadTilesLater;G=alp.opt(e,"mapTypeControlOptions");x=alp.opt(G,"mapTypeIds");I&&(this._oa_basemapLoadedDfrd=alp.subDfrd(alp.f('alp.m(alp.opt(this,"mapTypes"),"get",alp.m(this,"getMapTypeId"))'),this));x&&(x=G.mapTypeIds=alp.map(G.mapTypeIds,function(a){return a.replace(/^alpstein_/,"oa_")}));null==B.mapButton2d&&
(B.mapButton2d=B.mapButton3d);B.ext||(B.ext="jsonp");if(x){var L=[],J=alp.arr2oSimple(alp.oValues(k.MapTypeId)),P=alp.sub("oax.API_CFG");alp.forEach(x,function(a,l){function m(b){p(a,b)}if(P&&"mini"!==P.build&&P.leaflet_gshim&&a in J&&!f.has_gmap())L.push(l);else{if(!k.isLeafletGshim){if(J[a])return;var g=k.MapTypeId.HYBRID;if(g&&g!==a&&/hybrid/.test(a)){alp.subDfrd(function(){return alp.m(y.mapTypes,"get",g)}).thenSoon(m);return}}var n=d(a)||d(c(a));n?(l=b(n),(l=alp.sub("oax.x.tilelayer")&&oax.x.tilelayer(l))?
p(a,l):console.error("gmap3.Map: could not create v_mt for "+a)):(n=alp.gmap3.maptype(a,B))?n.then(function(b,c){p(a,c);y.setOptions(e)}):L.push(l)}});for(;L.length;)x.splice(L.pop(),1)}(function(){var a=y.fitBounds;a&&(y.fitBounds=alp.nowF(function(){var b=arguments,c=function(){a.apply(y,b)};y.isLoaded()?c():y._alp.init_cb(function(){setTimeout(c,500)})}))})();alp.asyncF(0,function(a){(new g.view.PoweredByOA).setMap(a);k.isLeafletGshim&&(new g.view.ShowRegionOnGoogleMaps).setMap(a)})(y);G=B.overlayMapTypeIds||
B.overlayMapTypes;G instanceof Array&&(G={"*":G});G&&alp.asyncF(0,h)(this,G);G=alp.opt(e,"mapTypeId");if(x){var H=G?alp.oKeyFind(x,G):x[0];H!==G&&(console.error('alp.gmap3.Map: could not find mapTypeId "'+G+'" in the list '+x+" --\x3e falling back on "+H),u(),y.whenLoaded?y.whenLoaded(u):alp.asyncF(250,u))}y.whenLoaded?y.whenLoaded(v):v();B.autoResize&&(y.whenLoaded?y.whenLoaded(t):t());y._alp.gm=k;var F,D,M}),{isLoaded:function(){return this._alp.is_initialized()},setOptions:function(b){b&&"scrollwheel"in
b&&(this._alp.scrollwheel=!!b.scrollwheel);return a.apply(this,arguments)}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.api_list");(function(){alp.sub("alp._gmap2_3",null,!0).api_source_names=function(){return"ClusterLayer FilterClusterLayer OOIs OOILayer ClusterLayer TourPoiLayer TourEditLayer openInfoWindow setMapType SingleOOI ooi_a_1_icon allMaintype createCustomOOI openInfoWindow iwCloseAll iwOpen iwOpenOOI fromLatLngToPixel fromLatLngToPoint fromPixelToLatLng getProjection getProjectionDfrd getWrapWidth EarthFlight DataPoint polylineGen setOvmtLater SlideShow Lightbox CirclePixel trackDetail trackTeaser".split(" ")}})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.circle_pixel");
alp.gmap3(function(k){function h(e,d){var b=e.getMap();b!==e._alpMap&&e._alpMap&&(f.event("removeListener")(e._alpMapEh),e._alpMap=e._alpMapEh=null);b&&(e._alpMap=b,e._alpMapEh=f.event("addListener")(b,"zoom_changed",alp.bindF(d,null,e,d)),f.getProjectionDfrd(b).then(function(c){var a=b.getZoom(),d=e.getCenter(),l=f.fromLatLngToPixel(c,d,a);l=new k.Point(l.x+e.get("radiuspixel"),l.y);c=f.fromPixelToLatLng(c,l,a).distanceFrom(d);c!==e.getRadius()&&e.setRadius(c)}))}var g=k&&k.Circle,f=alp._gmap2_3;
g&&alp.declare("alp._gmap2_3.CirclePixel",g,function(e){e=e.radiuspixel;e.toPrecision.call.a;var d=this;d.set("radiuspixel",e);var b=alp.ratelimitF(130,function(){h(d,b)});b();alp.forEach(["map_changed","center_changed","radiuspixel_changed"],function(c){f.event("addListener")(d,c,b)})})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.bounds");
alp.gmap3(function(k){var h=alp.sub("alp._gmap2_3",null,!0);h.bounds_fromPath=function(g,f){if(g.getPaths){var e=g.getPaths().getArray(),d=Infinity,b=-Infinity,c=Infinity,a=-Infinity;for(f=e.length;f--;)for(var m=e[f],l=m.length;l--;){var r=m[l];g=r.lat();r=r.lng();d=Math.min(d,r);b=Math.max(b,r);c=Math.min(c,g);a=Math.max(a,g)}return new k.LatLngBounds(new k.LatLng(c,d,!0),new k.LatLng(a,b,!0))}e=g instanceof Array?g:g.getArray?g.getArray():g.getPath().getArray();a=e.length;g=alp.mix({first:0,last:a-
1},f);f=g.first;d=g.last;if(!(a&&f<=d))return new k.LatLngBounds;g=e[f];a=b=g.lat();c=m=g.lng();for(f=1+f;f<=d;f++)r=e[f],g=r.lat(),r=r.lng(),a=Math.min(a,g),c=Math.min(c,r),b=Math.max(b,g),m=Math.max(m,r);return new k.LatLngBounds(new k.LatLng(a,c),new k.LatLng(b,m))};h.bounds_isPoint=function(g){return(g=alp.m(g,"toSpan"))&&1E-10>Math.max(Math.abs(g.lng()),Math.abs(g.lat()))}});"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.project");
(function(){var k=alp.sub("alp.maps",0,1),h=Math.PI,g=h/180,f=180/h,e=g/2,d=2*f,b=h/4;k.DEG_2_RAD=g;k.RAD_2_DEG=f;k.project_SM=function(c){return{x:c.lng*g,y:Math.log(Math.tan(b+Math.min(85.0511287798,Math.max(-85.0511287798,c.lat))*e))}};k.unproject_SM=function(c){return{lng:c.x*f,lat:d*(Math.atan(Math.exp(c.y))-b)}}})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.bounds2zoomcenter");
(function(){var k=alp.sub("alp.maps",0,1);k.bounds2zoomcenter=function(h,g,f){h&&g||null.mandatory;if(h instanceof Array&&4===h.length&&"number"===typeof h[0]){var e=h[0];var d=h[1];var b=h[2];var c=h[3]}else if(h.getWest)e=h.getWest(),d=h.getSouth(),b=h.getEast(),c=h.getNorth();else if(h.getSouthWest){var a=h.getSouthWest();h=h.getNorthEast();e=a.lng();d=a.lat();b=h.lng();c=h.lat()}else e=h.west,d=h.south,b=h.east,c=h.north;for(alp.and([e,d,b,c],alp.isFiniteNumber)||null.invalid;b<e;)b+=360;for(;180<
e;)e-=360,b-=360;for(;-180>e;)e+=360,b+=360;f=alp.mix({maxZoom:15,minZoom:0,padding:.1},alp.filterIn(f,"!=null"));h={zoom:f.minZoom+f.maxZoom>>1,center:{lat:(c+d)/2,lng:(e+b)/2}};g=k.getWidthHeight(g);var m=g.width,l=g.height;g=alp.fVal(f.padding);var r=k.getPadding(m,l,g);a=r.left;var n=r.right;g=r.top;r=r.bottom;var q=m-a-n,p=l-g-r;if(1>q)return console.error("alp.maps.bounds2zoomcenter: left padding + right padding >= mapWidth!",a,n,m),h;if(1>p)return console.error("alp.maps.bounds2zoomcenter: top padding + bottom padding >= mapHeight!",
g,r,l),h;d=k.project_SM({lat:d,lng:e});c=k.project_SM({lat:c,lng:b});e=d.y;d=d.x;b=c.y;c=c.x;m=c-d;l=b-e;var v=l/m>p/q;q=Math.log(((v?p:q)+2)/((v?l:m)/Math.PI*128))/Math.log(2);alp.isFiniteNumber(f.maxZoom)&&(q=Math.min(f.maxZoom,q));alp.isFiniteNumber(f.minZoom)&&(q=Math.max(f.minZoom,q));if(!alp.isFiniteNumber(q))return h;q=Math.floor(q);f=1<<q+8;a=(d+c)/2-(a-n)/f*Math.PI;f=(b+e)/2-(r-g)/f*Math.PI;return alp.isFiniteNumber(q)&&alp.isFiniteNumber(a)&&alp.isFiniteNumber(f)?{zoom:q,center:k.unproject_SM({x:a,
y:f})}:h};k.getPadding=function(h,g,f){function e(a){a=a.match(/^([\-\+\d]+)px$/i);return(a&&a[1])|0}var d=0,b=0,c=0,a=0;if("number"===typeof f)d=b=h*f,c=a=g*f;else if("string"===typeof f)d=b=c=a=e(f);else if("object"===typeof f){var m=f.left,l=typeof m;"number"===l?d=h*m:"string"===l&&(d=e(m));m=f.right;l=typeof m;"number"===l?b=h*m:"string"===l&&(b=e(m));m=f.top;l=typeof m;"number"===l?c=g*m:"string"===l&&(c=e(m));m=f.bottom;l=typeof m;"number"===l?a=g*m:"string"===l&&(a=e(m))}return{left:d,right:b,
top:c,bottom:a}};k.getWidthHeight=function(h){if("string"===typeof h){var g=alp.gEBI(h)||alp.gEBCN(h)[0]||alp.f(h)();var f=alp.gBCR(g)}else"parentNode"in h&&(h=alp.gBCR(h));g=(f||h).width;h=(f||h).height;0<g&&0<h||(console.error("AM.getWidthHeight() requires mapWidth > 0 && mapHeight > 0  (given values: mapWidth: "+g+", mapHeight: "+h+")"),h=g=600,console.error("AM.getWidthHeight(): falling back on mapWidth:"+g+", mapHeight:"+h));return{width:g,height:h}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.bbox");
alp.gmap3(function(k){function h(d){return function(b,c,a,m){m=alp.oCreateMix(e,m);var l=new d.LatLng(parseFloat(c[1]),parseFloat(c[0]));c=new d.LatLng(parseFloat(c[3]),parseFloat(c[2]));l=new d.LatLngBounds(l,c);c=g.bounds_isPoint(l);var r=alp.m(b,"getDiv")||alp.m(b,"getContainer");r=f.bounds2zoomcenter(l,r,{maxZoom:m.maxZoom,padding:a});a=r.center;r=r.zoom;var n=alp.m(b,"getCurrentMapType");var q=alp.m(n,"getMinimumResolution");n=alp.m(n,"getMaximumResolution");var p=b.mapTypes;if(b=(b=alp.m(b,
"getMapTypeId"))&&alp.m(p,"get",b))q=b&&b.minZoom,n=b&&b.maxZoom;"number"===typeof q&&(r=Math.max(r,q));"number"===typeof n&&(r=Math.min(r,n));alp.isFiniteNumber(m.maxZoom)&&(r=Math.min(r,m.maxZoom));return{zoom:r,center:a,bounds:l,bounds_isPoint:c}}}var g=alp._gmap2_3,f=alp.maps,e=g.BBOX_DEFAULT_CFG();alp.gmap3(function(d){g.bbox_2_bounds_zc=h(d)});g.bbox_from_XY_coord=function(d){var b=Infinity,c=Infinity,a=-Infinity,e=-Infinity,l=d.length;if(l)for(d="number"===typeof d[0][0]?[d]:d;l--;)for(var f=
d[l],g=f.length;g--;){var q=f[g],p=q[0];q=q[1];b=Math.min(b,p);c=Math.min(c,q);a=Math.max(a,p);e=Math.max(e,q)}return[b,c,a,e]}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.marker_image");
alp.gmap3(function(k){function h(d,b,c,a,e){this.url=d;this.size=b;this.origin=c;this.anchor=a;this.scaledSize=e;c&&console.error("alp._gmap2_3._MarkerImage2(): `origin` is not supported in V2, and will thus be ignored.",c,d);e&&console.error("alp._gmap2_3._MarkerImage2(): `scaledSize` is not supported in V2, and will thus be ignored.",e,d)}function g(d){var b=d.coords,c=d.type;if("poly"===c)return b;if("rect"===c)return alp.map(e,function(a){return b[a]});if("circle"===c){d=b[0];c=b[1];for(var a=
b[2],f=Math.PI,l=[],g,n=17;n--;)g=-2*f*n/16,l.push(d+a*Math.cos(g)),l.push(c+a*Math.sin(g));return l}console.error("alp._gmap2_3._core._imageMap2_gen did not recognize shape:",d)}var f=alp.sub("alp._gmap2_3",null,!0);f.markerImage_gen=function(d,b,c,a,e){e||(e=b);e=f.V2(k)?null:e;!b||b instanceof k.Size||(b=new k.Size(b.width,b.height));!c||c instanceof k.Point?c||(c=new k.Point(0,0)):c=new k.Point(c.x,c.y);!a||a instanceof k.Point||(a=new k.Point(a.x,a.y));!e||e instanceof k.Size||(e=new k.Size(e.width,
e.height));if(f.V3(k)){var l={url:d,size:b,origin:c,anchor:a,scaledSize:e};d={url:d,size:b,origin:c,anchor:a,scaledSize:e};for(var m in d)d.hasOwnProperty(m)&&(b=d[m],!b||m in l||(l[m]=b))}else f.V2(k)&&(l=new h(d,b,c,a,e));l._alpMarkerImage_gen=1;return l};f.markerImage_gen_change=function(d,b){d._alpMarkerImage_gen||console.error("`alp._gmap2_3.markerImage_gen_change` assumes that you used `alp._gmap2_3.markerImage_gen`to create the `original` MarkerImage instance.");return f.markerImage_gen(b.url||
d.url,b.size||d.size,b.origin||d.origin,b.anchor||d.anchor,b.scaledSize||d.scaledSize)};f._GIcon2_gen=function(d){if(f.V2(k)){var b=d.icon,c=d.shadow,a=d.shape,e=new k.Icon(k.DEFAULT_ICON);if(b instanceof k.Icon)return console.error("alp._gmap2_3._core._GIcon2_gen(): you should not be using V2 GIcons anymore!",d,b),b;if("string"===typeof b)e.image=b,b=alp.cfg.marker.caticon(),e.iconSize=new k.Size(b.width,b.height);else if(b instanceof h){e.image=b.url;if(d=b.size)e.iconSize=new k.Size(d.width,d.height);
if(d=b.anchor)e.iconAnchor=new k.Point(d.x,d.y);a&&(e.imageMap=g(a))}if("string"===typeof c)e.shadow=c;else if(c instanceof h){if(e.shadow=c.url,d=c.size)e.shadowSize=new k.Size(d.width,d.height)}else e.shadow="";d=e.iconSize;e.iconAnchor||(e.iconAnchor=new k.Point(d.width>>2,d.height));e.anchor=e.iconAnchor;return e}console.error("alp._gmap2_3._GIcon2_gen() failed. Maybe wrong Google Maps version.")};var e=[2,3,2,1,0,1,0,3,2,3]});"undefined"!==typeof dojo&&dojo.provide("alp.cfg.marker");
(function(){alp.mix(alp.cfg||(alp.cfg={}),{cluster_markers:function(){function k(b){return alp.cssBase()+"alp/images/img_cluster_0"+(b+1)}var h;var g=[[33,33],[38,38],[51,42],[62,42],[77,42]];var f=g.length;for(h=Array(f);f--;){var e=g[f];var d=alp.map(e,">>1");h[f]=alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(k(f)+".png"),xy:e,anchor_xy:d,shape:{type:"rect",coords:[0,0,e[0]-1,e[1]-1]}});h[f].label_offset_y=0}return h},marker:{arrow:function(k,h){if("object"===typeof k){var g=k[0];k=k[1];return alp.cfg.marker.arrow(Math.atan2(k.lat()-
g.lat(),k.lng()-g.lng()),h)}for(k=5*Math.round((360+180/Math.PI*(Math.PI/2-k))/5)%360;0>k;)k+=360;for(;360<=k;)k-=360;for(g=Math.round(k)+"";3>g.length;)g="0"+g;return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/arrows/"+(h?h+"/":"")+g+".png"),xy:[24,24],anchor_xy:[12,12]})},caticon:function(){return alp.cfg._ooi_normalize_xy({xy:[24,32],anchor_xy:[12,32]})},caticon_shadow:function(){return{url:alp.cfg.url.res_host("/icons/gshadow.png"),width:31,
height:24,anchor_x:6,anchor_y:23}},cluster_3balls:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/images/cluster_3balls.png"),xy:[30,30],anchor_xy:[15,13]})},condition:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/images/condition.png"),xy:[45,52],anchor_xy:[17,52]})},digitize_ghost:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/ghost-node.png"),xy:[23,
23],anchor_xy:[11,11],shape:{type:"rect",coords:[0,0,23,23]}})},digitize_node:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/node.png"),xy:[23,23],anchor_xy:[11,11],shape:{type:"circle",coords:[11,11,11]}})},digitize_node_highlight:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/node-highlight.png"),xy:[23,23],anchor_xy:[11,11],shape:{type:"circle",coords:[11,
11,11]}})},digitize_node_sel:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/node-sel.png"),xy:[23,23],anchor_xy:[11,11],shape:{type:"rect",coords:[0,0,22,22]}})},digitize_node_start:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/node-start.png"),xy:[23,23],anchor_xy:[11,11],shape:{type:"rect",coords:[0,0,22,22]}})},digitize_node_start_flag:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+
"alp/_gmap2_3/digitize/resources/images/node-start-flag-25.png"),xy:[25,25],anchor_xy:[13,23],shape:{type:"rect",coords:[0,0,24,24]}})},digitize_node_transparent:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/node-transparent.png"),xy:[9,9],anchor_xy:[5,5],shape:{type:"rect",coords:[0,0,8,8]}})},digitize_node_waypoint:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/node-waypoint.png"),
xy:[21,21],anchor_xy:[10,10],shape:{type:"rect",coords:[0,0,20,20]}})},digitize_node_waypoint_sel:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/node-waypoint-sel.png"),xy:[21,21],anchor_xy:[10,10],shape:{type:"rect",coords:[0,0,20,20]}})},digitize_start:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/node-start.png"),xy:[15,15],anchor_xy:[7,7],shape:{type:"poly",
coords:[2,2,12,2,12,12,2,12,2,2]}})},extra_flexview:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/images/empty.mapscreen.png"),xy:[Math.round(20),Math.round(23.5)],anchor_xy:[Math.round(6.5),Math.round(23.5)]})},other_condition:function(){return alp.cfg._ooi_normalize_xy({url:alp.urlCachebust(alp.cssBase()+"alp/images/other_condition.png"),xy:[45,52],anchor_xy:[17,52]})},poi2tour_cat:function(){return alp.cfg._ooi_normalize_xy({xy:[24,32],anchor_xy:[12,32]})}},
marker_image:{geocode_location:function(){var k=[alp.cssBase()+"alp/gmap/resources/images/geocode_location.png",{width:19,height:32}];k.url=k[0];k.size=k[1];return k},geocode_location_shadow:function(){var k=[alp.cssBase()+"alp/gmap/resources/images/geocode_location.shadow.png",{width:37,height:34}];k.url=k[0];k.size=k[1];return k}},_ooi_normalize_xy:function(k){k.size&&(k.xy=k.xy||k.size);k.anchor&&(k.anchor_xy=k.anchor_xy||k.anchor);"xy"in k&&"anchor_xy"in k&&!("anchor_fraction"in k)&&(k.anchor_fraction=
[k.anchor_xy[0]/k.xy[0],k.anchor_xy[1]/k.xy[1]]);alp.forEach("xy anchor_xy anchor_fraction shadow_xy size anchor scaledSize".split(" "),function(h){h in k&&(h=k[h],h.x=h.width=h[0],h.y=h.height=h[1])});k.im&&!k.shape&&(k.shape={coords:k.im,type:"poly"});k.xy&&(k.x=k.width=k.xy[0],k.y=k.height=k.xy[1]);k.anchor_xy&&(k.anchor_x=k.anchor_xy[0],k.anchor_y=k.anchor_xy[1]);return k},ooi_a_1_icon:function(k,h,g,f){g=(g||"green_chili").toLowerCase();f=(f||"big").toLowerCase();k%=h?99:26;var e="big"===f,d=
"round"===f;k=h?(9>k?"0":"")+(k+1):String.fromCharCode(k+97);g={color:g,is_big:e,size:"round"===f?f:"map_"+f,text:k};g.xy=e?[50,76]:d?[22,22]:[34,52];g.anchor_xy=[g.xy[0]>>1,d?g.xy[1]>>1:g.xy[1]-1];g.shadow_xy=e?[84,76]:[58,52];d&&(g.shape={type:"circle",coords:g.anchor_xy.concat(3+g.anchor_xy[0])});alp.cfg._ooi_normalize_xy(g);g.url=alp.urlCachebust([alp.cssBase(),"alp/gmap/resources/images/ooi_a_1_marker/",g.color,"/img_",g.size,"_",g.text,".png"].join(""));d||(g.shadow_url=alp.urlCachebust([alp.cssBase(),
"alp/gmap/resources/images/ooi_a_1_marker.shadow.",g.size,".png"].join("")));g.transp_url=alp.urlCachebust([alp.cssBase(),"alp/gmap/resources/images/ooi_a_1_marker.transp.",g.size,".png"].join(""));if(!d){e=[g.anchor_xy[0]-4,g.anchor_xy[1]+4,g.anchor_xy[0]+4,g.anchor_xy[1]+4];d=-.5*Math.PI+.3217505543966422;f=1.5*Math.PI-.3217505543966422;for(k=0;11>k;k++)h=d+(f-d)*k/10,e.push(Math.round(25+24*Math.cos(h))),e.push(Math.round(25-24*Math.sin(h)));g.im=e}return g},ooi_single_default:function(){var k=
{url:alp.urlCachebust(alp.cssBase()+"alp/gmap/resources/images/ooi_default.png"),xy:[24,32],anchor_xy:[12,32]};alp.cfg._ooi_normalize_xy(k);return k}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.marker_opts");
(function(){var k=alp._gmap2_3,h=k.marker_opts||(k.marker_opts={});h.markerCfg_2_markerOptions=function(f){f=alp.oCreate(f);f.anchor_xy||(f.anchor_xy=[f.xy[0]>>1,f.xy[1]>>1]);f=alp.cfg._ooi_normalize_xy(f);return{icon:k.markerImage_gen(f.url,f.xy,null,f.anchor_xy),shadow:f.shadow_url&&k.markerImage_gen(f.shadow_url,f.shadow_xy,null,f.anchor_xy),shape:f.shape}};h.ooi_single_default=function(){var f=alp.cfg.ooi_single_default();return{icon:k.markerImage_gen(f.url,f.xy,null,f.anchor_xy),shadow:f.shadow_url&&
k.markerImage_gen(f.shadow_url,f.shadow_xy,null,f.anchor_xy),shape:f.shape}};h.ooi_a_1_gen=function(f,e,d,b){return alp.oCreate(g([f,e,d,b]))};var g=alp.memF(function(f){f=alp.cfg.ooi_a_1_icon.apply(alp.cfg,f);return{icon:k.markerImage_gen(f.url,f.xy,null,f.anchor_xy),shadow:f.shadow_url&&k.markerImage_gen(f.shadow_url,f.shadow_xy,null,f.anchor_xy),shape:f.im&&{coords:f.im,type:"poly"}}},"arr")})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.marker_svg");
alp.gmap3(function(k){function h(f){var e={clickable:!0,cursor:"pointer",draggable:!1,icon:{anchor:new k.Point(0,0),size:new k.Size(30,30),url:"",text:{content:"",font:"Helvetica, sans-serif",color:"#000",size:"10px",weight:"400",position:[0,0]},html:""},map:"",opacity:1,position:"",title:"",visible:!0,zIndex:""},d;for(d in f)if(!(d in g))if("object"===typeof e[d])for(var b in f[d])f[d].hasOwnProperty(b)&&(e[d][b]=f[d][b]);else f.hasOwnProperty(d)&&(e[d]=f[d]);this.setValues(e);"map"in f&&this.setMap(f.map)}
alp._gmap2_3.SVGMarker=h;var g={};h.prototype=new k.OverlayView;h.prototype.onAdd=function(){var f=this,e=document.createElement("div");e.style.border="none";e.style.borderWidth="0px";e.style.position="absolute";""!==this.get("zIndex")&&(e.style.zIndex=this.get("zIndex"));!1===this.get("visible")&&(e.style.visibility="hidden");0<=this.get("opacity")&&1>=this.get("opacity")&&(e.style.opacity=this.get("opacity"));!0===this.get("clickable")&&k.event.addDomListener(e,"click",function(b){k.event.trigger(f,
"click",b)});!0===this.get("draggable")&&(k.event.addDomListener(e,"drag",function(b){k.event.trigger(f,"drag",b)}),k.event.addDomListener(e,"mousedown",function(b){k.event.trigger(f,"dragstart",b);this.style.cursor="move";f.get("map").set("draggable",!1);var c=b;f.moveHandler=k.event.addDomListener(f.get("map").getDiv(),"mousemove",function(a){k.event.trigger(f,"drag",a);var b=c.clientX-a.clientX,d=c.clientY-a.clientY,e=f.getProjection().fromLatLngToDivPixel(f.get("position"));b=f.getProjection().fromDivPixelToLatLng(new k.Point(e.x-
b,e.y-d));c=a;f.set("position",b);f.draw()})}),k.event.addDomListener(e,"mouseup",function(b){k.event.trigger(f,"dragend",b);f.get("map").set("draggable",!0);this.style.cursor="default";k.event.removeListener(f.moveHandler)}),k.event.addDomListener(this.get("map").getDiv(),"mouseleave",function(b){k.event.trigger(e,"mouseup",b)}));k.event.addDomListener(e,"mouseover",function(b){k.event.trigger(f,"mouseover",b)});k.event.addDomListener(e,"mouseout",function(b){k.event.trigger(f,"mouseout",b)});var d=
document.createElement("img");d.src=this.get("icon").url;d.classList.add("SVGMarker");d.style.width=this.get("icon").size.width+"px";d.style.height=this.get("icon").size.height+"px";d.style.display="block";d.setAttribute("alt",this.get("title"));e.appendChild(d);""!==this.get("icon").text.content&&(d=document.createElement("span"),d.textContent=this.get("icon").text.content,d.style.fontFamily=this.get("icon").text.font,d.style.fontSize=this.get("icon").text.size,d.style.fontWeight=this.get("icon").text.weight,
d.style.color=this.get("icon").text.color,d.style.position="absolute",d.style.top=this.get("icon").text.position[0]+"px",d.style.left=this.get("icon").text.position[1]+"px",d.style.transform="translate(-50%, -50%)",this.get("container").appendChild(d));""!==this.get("icon").html&&e.appendChild(this.get("icon").html);this.set("container",e);this.getPanes().overlayImage.appendChild(e)};h.prototype.draw=function(){var f=this.getProjection(),e=this.get("container");if(!f||!e)return alp.asyncF(37,"draw",
this)();f=f.fromLatLngToDivPixel(this.get("position"));e.style.left=f.x-this.get("icon").anchor.x+"px";e.style.top=f.y-this.get("icon").anchor.y+"px";e.style.cursor=this.get("cursor")};h.prototype.onRemove=function(){this.get("container").parentNode.removeChild(this.get("container"));this.set("container",null)};h.prototype.getPosition=function(){return this.get("position")};h.prototype.setZIndex=function(f){this.get("container")&&(this.get("container").style.zIndex=f)};h.prototype.setPosition=function(f){this.set("position",
f);this.draw()};h.prototype.setOpacity=function(f){this.get("container")&&(this.get("container").style.opacity=f)};h.prototype.setIcon=function(f){var e=this.get("icon");if(e){for(var d in f)if(!(d in g))if("object"===typeof e[d])for(var b in f[d])f[d].hasOwnProperty(b)&&(e[d][b]=f[d][b]);else f.hasOwnProperty(d)&&(e[d]=f[d]);this.set("icon",e);f=this.get("container").querySelector("img.SVGMarker");f.src=e.url;f.style.width=e.size.width+"px";f.style.height=e.size.height+"px";f=this.getProjection().fromLatLngToDivPixel(this.get("position"));
this.get("container").style.left=f.x-e.anchor.x+"px";this.get("container").style.top=f.y-e.anchor.y+"px"}else this.set("icon",f)};h.prototype.hide=function(){this.get("container")&&(this.get("container").style.visibility="hidden")};h.prototype.show=function(){this.get("container")&&(this.get("container").style.visibility="visible")};h.prototype.toggle=function(){this.get("container")&&("hidden"===this.get("container").style.visibility?this.show():this.hide())};h.prototype.getPosition=function(){return this.get("position")};
h.prototype.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(this.get("map"))}});"undefined"!==typeof dojo&&dojo.provide("alp.state");
(function(){function k(a,b,c){var d=alp.f(b.there),e=alp.f(b.back);b=c&&c.eh;var l=new (alp.sub(a.declaredClass))({init_value:d(a.get())});c=a.change_cb(function(){var b=a.get(),c=d(b);if(!a.is_same(b,e(c)))throw Error("back( there( ... )) must be idempotent! Else we would risk an infinite loop. Crashing now.");l.set(c)});var f=a.change_cb(function(){var b=l.get(),c=e(b);if(!l.is_same(b,d(c)))throw Error("there( back( ... )) must be idempotent! Else we would risk an infinite loop. Crashing now.");
a.set(c)});b&&b.push(c).push(f);return l}function h(a){this.change().dropSoon(a)}function g(){return this.set(!this.get())}function f(a){return this.set((this.get()||[]).concat(a))}function e(a){for(var b=[].concat(this.get()||[]),c=!1,d=b.length;d--;)if(b[d]===a){b.splice(d,1);c=!0;break}c&&this.set(b);return c}function d(a){for(var b=this._get_no_clone()||{},c,d=a.length;d--;){var e=a[d];e in b||((c||(c=alp.mix({},b)))[e]=1)}c&&this.set(c)}function b(a){for(var b=this._get_no_clone()||{},c,d=a.length;d--;){var e=
a[d];e in b&&delete (c||(c=alp.mix({},b)))[e]}c&&this.set(c)}function c(a,b){for(var c={},d,e=a.length;e--;)c[a[e]]=1;b&&(d=alp.oDelta(c,this._get_no_clone()||{}));this.set(c);return d}function a(){this.step.toPrecision.call.a;this.setNow(this.get()-this.step)}function m(){this.step.toPrecision.call.a;this.setNow(this.get()+this.step)}var l=alp.Aps,r=alp.f(),n={};alp.andState=function(a,b){var c=alp.opt(b,"filter")||alp.f(),d=alp.f(".get()"),e=new alp.BoolState({constrain_all:function(){return c(alp.and(a,
d))}}),l=new alp.Eh;alp.forEach(a,function(a){l.push(a.change_cb("unset",e))});e.set();e.disconnect=function(){l.clear()};return e};alp.notState=function(a,b){a instanceof alp.BoolState||null.unsupported;return k(a,{there:"!",back:"!"},b)};alp.oneWayCopyState=function(a,b){var c=new (alp.sub(a.declaredClass));a.bind_to(c,{transform:b});return c};alp.orState=function(a,b){var c=alp.opt(b,"filter")||alp.f(),d=alp.f(".get()"),e=new alp.BoolState({constrain_all:function(){return c(alp.or(a,d))}}),l=new alp.Eh;
alp.forEach(a,function(a){l.push(a.change_cb("unset",e))});e.set();e.disconnect=function(){l.clear()};return e};alp.partState=alp.nowF(function(a,b,c){var d=c&&c.eh,e=new (c&&c.ctor||alp.State)({init_value:alp.oGet(a.get()||{},b)});c=a.change_cb(function(){e.set(alp.oGet(a.get()||{},b))});var l=e.change_cb(function(){var c=a.get()||{};alp.oSet(c,b,e.get());a.set(c)});d&&d.push(c).push(l);return e});alp.twoWayTransformState=k;alp.declare("alp.State",null,function(a){alp.mixCheck(this,a);this.constrain_all&&
(this.constrain_def=this.constrain_undef=this.constrain_all);this.setNow(this.init_value,!0)},{is_same:alp.f("==="),init_value:null,constrain_all:null,constrain_def:r,constrain_undef:r,_current:null,bind_to:function(a,b){function c(){var b=d.get();a.set(f?f(b):b)}var d=this,e=b&&b.do_not_copy,l=b&&b.loose,f=(b=b&&b.transform)&&("string"===typeof b?alp.f(b):b);e||c();if(!(l||a instanceof alp.State))throw Error("alp.State.bind_to(): incompatibility!");d.change().thenSoon(c);c._alpRemover=alp.bindF(h,
this);return c},unbind:h,constrain:function(){this.set(this.get())},is:function(a){return this.is_same(this._current,a)},change:alp.memM("change",'alp.event("alp.state change")'),change_cb:alp.eventCB("change"),drop_cb:alp.eventDropCB("change"),change_cb_init:function(){var a=alp.bindF.apply(alp,arguments);a(this.get());return this.change_cb(a)},change_v_cb:function(a){var b=this,c=alp.bindF.apply(alp,l.call(arguments,1));return b.change_cb(function(d){b.is_same(a,d)&&c()})},get:function(){return this._current},
getPrevious:function(){return this._previous},isSet:function(){return null!=this._current},unset:function(){return this.set()},set:function(a,b){a=this[null==a?"constrain_undef":"constrain_def"](a,this._current);if(this.is_same(a,this._current))return!1;var c=this._previous=this._current;this._current=a;b||this.change().triggerSoon(a,c);return!0},setNow:alp.nowF("set")});alp.declare("alp.BoolState",alp.State,null,{constrain_undef:alp.f("!!"),constrain_def:alp.f("!!"),init_value:!1,toggle:g,toggleNow:alp.nowF(g)});
alp.declare("alp.DateState",alp.State,null,{is_same:function(a,b){return+a===+b}});alp.declare("alp.NumberState",alp.State,null,{constrain_undef:function(a){return 0},constrain_def:function(a){return"number"===typeof a?a:this.constrain_undef(a)}});alp.declare("alp.StringState",alp.State,null,{constrain_undef:function(a){return""},constrain_def:function(a){return""+a}});alp.declare("alp.SortedArrayState",alp.State,null,{is_same:alp.arrEqual,add:f,addNow:alp.nowF(f),del:e,delNow:alp.nowF(e)});var q=
alp.declare("alp.ObjectState",alp.State,null,{do_not_clone:!1,is_same:function(a,b){return alp.oEqual(a,b)},get:function(){var a=this._get_no_clone();return this.do_not_clone?a:alp.oCopy(a)},mixin:function(a){var b=this._get_no_clone(),c=a instanceof Array||b instanceof Array,d=b||(c?[]:{});if(a){var e=d!==b;for(var l in a)l in n||(b=a[l],l in d&&d[l]===b||(e||(d=alp.mix(c?[]:{},d),e=!0),d[l]=b))}e&&this.set(d);return e},set_flex:function(a,b){return"object"===typeof a?this.mixin(a):this.set_property(a,
b)},set_flex_now:alp.nowF("set_flex"),has_value:function(a,b){a=this.get_property(a);return b?b(a):!!a},get_property:function(a,b){a=alp.oGet(this._get_no_clone()||{},a);return b||this.do_not_clone?a:alp.oCopy(a)},set_property:function(a,b){var c=this._get_no_clone();return c&&this.is_same(b,alp.oGet(c,a))?!1:(c=c?alp.oCopy(c):{},alp.oSet(c,a,b),this.set(c),!0)},keep_only:function(a,b){var c=this.get_property(a);c&&this.set_property(a,alp.opt(c,b))},toString:function(){return alp.oToString(this._get_no_clone())},
_get_no_clone:function(){return q.parent.prototype.get.apply(this)}});alp.declare("alp.PrimitiveSetState",alp.ObjectState,null,{addArray:d,addArrayNow:alp.nowF(d),delArray:b,delArrayNow:alp.nowF(b),getArray:function(){var a=[],b=this._get_no_clone()||{},c;for(c in b)c in n||a.push(c);return a},setArray:c,setArrayNow:alp.nowF(c)});alp.declare("alp.SetState",alp.ObjectState,null,{init_value:[],ordered:!1,is_same_element:function(a,b){return a===b},is_same:function(a,b){function c(a,b){return alp.and(a,
function(a){return alp.or(b,function(b){return d.is_same_element(a,b)})})}var d=this;return a&&b?d.ordered?alp.arrEqual(a,b,alp.bindF("is_same_element",d)):c(a,b)&&c(b,a):!1},constrain_all:function(a,b){a||(a=b||[]);var c=this;for(b=a.length;b--;){var d=a[b];alp.or(a.slice(0,b),function(a){return c.is_same_element(d,a)})&&a.splice(b,1)}return a},clear:function(){return this.set([])},add:function(a){return this.merge([a])},remove:function(a){return this.subtract([a])},has_element:function(a){var b=
this;return alp.or(b.get(),function(c){return b.is_same_element(c,a)})},merge:function(a){return this.set(this.get().concat(a))},subtract:function(a){var b=this;return b.set(alp.filter(b.get(),function(c){return!alp.or(a,function(a){return b.is_same_element(c,a)})}))},size:function(){return this.get().length}});r=function(a,b){alp.isFiniteNumber(a)||-Infinity===a||Infinity===a||(a=b||0);b=this.step;null!=b&&(a=this.min+b*Math.round((a-this.min)/b),b=Math.pow(10,3-Math.ceil(Math.log(b)/Math.log(10))),
a=Math.round(a*b)/b);return Math.max(this.min,Math.min(this.max,a))};alp.declare("alp.MinMaxState",alp.State,null,{constrain_def:r,constrain_undef:r,min:-Infinity,max:Infinity,step:null,setMin:function(a){this.min=a;this.constrain()},setMax:function(a){this.max=a;this.constrain()},setToMin:function(){this.set(this.min)},setToMax:function(){this.set(this.max)},getProp:function(){var a=(this.get()-this.min)/(this.max-this.min);return alp.isFiniteNumber(a)?a:.5},isMin:function(){return this.is(this.min)},
isMax:function(){return this.is(this.max)},setPropNow:function(a){return this.setProp(a,!0)},setProp:function(a,b){a=Math.max(0,Math.min(1,a));if(0===a)return this.set(this.min);if(1===a)return this.set(this.max);if(this.min===this.max)return this.set(this.min);a=this.min+a*(this.max-this.min);return this[b?"setNow":"set"](alp.isFiniteNumber(a)?a:0)},stepDown:a,stepDownNow:alp.nowF(a),stepUp:m,stepUpNow:alp.nowF(m)});alp.MinMaxState.constrain_min_max_impl=r;alp.modeStateFromArr=function(a,b){return new alp.ModeState(alp.oCreateMix({modeSet:alp.arr2o(a,
alp.f(),alp.f("1"))},b))};alp.declare("alp.ModeState",alp.State,null,{modeSet:null,fallback:alp.f(""),constrain_all:function(a,b){if(a){if(a in this.modeSet)return a;if(b in this.modeSet)return b}return this.fallback?alp.fVal(this.fallback,b):null}});alp.declare("alp.PoliteSetState",alp.SetState,null,{do_not_clone:!0,any_st:alp.memM("any_st","new alp.BoolState()"),at_least_st:null,at_least_value:!0,constrain_all:alp.nowF(function(a,b){function c(b){b.get()&&alp.forEach(a,function(a){a.set(b===a)})}
function d(){var a=alp.or(e.get()||[],alp.f(".get()"));e.any_st().set(a)}b=b||[];var e=this;a=alp.filter(a,function(a){return a instanceof alp.BoolState?!0:(console.error("alp.State.constrail_all(): ignoring non-alp.BoolState instance:",a),!1)});e._bs2eh||(e._bs2eh=alp.mapany());alp.forEach(b,function(b){(-1<alp.indexOf(a,b)?e._bs2eh.get(b):e._bs2eh.del(b)).clear()});alp.forEach(a,function(a){0>alp.indexOf(b,a)&&c(a)});d();alp.forEach(a,function(a){(-1<alp.indexOf(b,a)?e._bs2eh.get(a):e._bs2eh.set(a,
new alp.Eh)).push(a.change_cb(function(){c(a);d()}))});e.at_least_st&&null==e._at_least_h&&(e._at_least_h=e.any_st().change_v_cb(!1,function(){e.at_least_st.set(!0)}));return a})})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.overlay");
alp.gmap3(function(k){var h=k.Overlay&&k.Overlay.prototype,g;alp.sub("alp._gmap2_3.overlay",null,!0)._install=function(){f||(f=!0,!h||h.setMap||h.getMap||(g="setMap",h[g]=alp.nowF(function(e){this.alpMapSt_().set(e)}),g="getMap",h[g]=function(){return this.alpMapSt_().get()},h.alpMapSt_=alp.nowF(function(){function e(a,b){b&&(b.removeOverlay(d),c&&GEvent.removeListener(c),c=null);a&&(a.addOverlay(d),c=GEvent.addListener(a,"singlerightclick",function(a,b,c){c===d&&GEvent.trigger(d,"singlerightclick",
a,b,c)}))}var d=this,b=new alp.State,c;d.alpMapSt_=function(){return b};d instanceof k.Polyline&&(e=alp.ratelimitF(397,e));b.change_cb(e);return d.alpMapSt_()}),alp.forIn(alp.filterIn(k,alp.f(" && v.prototype instanceof GOverlay")),function(e,d){var b=e.prototype;(function(){var c=b.initialize;c&&(b.initialize=alp.nowF(function(a){this.alpMapSt_().set(a,!0);return c.apply(this,arguments)}))})();(function(){var c=b.remove;c&&(b.remove=alp.nowF(function(){this.alpMapSt_().set(null,!0);return c.apply(this,
arguments)}))})()})))};var f});"undefined"!==typeof dojo&&dojo.provide("alp.util.math.ixy");
(function(){function k(d,b){if(null==b){var c=d[0];b=d[1]}else c=d;(c>f||b>f)&&(void 0).overflow;(0>c||0>b)&&(void 0).must_be_unsigned;c|=0;b|=0;return(((b&32768)>>15)+((c&32768)>>14)+((b&65536)>>14)+((c&65536)>>13)+((b&131072)>>13)+((c&131072)>>12)+((b&262144)>>12)+((c&262144)>>11)+((b&524288)>>11)+((c&524288)>>10)+((b&1048576)>>10)+((c&1048576)>>9)+((b&2097152)>>9)+((c&2097152)>>8)+((b&4194304)>>8)+((c&4194304)>>7)+((b&8388608)>>7)+((c&8388608)>>6)+((b&16777216)>>6)+((c&16777216)>>5)+((b&33554432)>>
5)+((c&33554432)>>4))*e+((b&1)+((c&1)<<1)+((b&2)<<1)+((c&2)<<2)+((b&4)<<2)+((c&4)<<3)+((b&8)<<3)+((c&8)<<4)+((b&16)<<4)+((c&16)<<5)+((b&32)<<5)+((c&32)<<6)+((b&64)<<6)+((c&64)<<7)+((b&128)<<7)+((c&128)<<8)+((b&256)<<8)+((c&256)<<9)+((b&512)<<9)+((c&512)<<10)+((b&1024)<<10)+((c&1024)<<11)+((b&2048)<<11)+((c&2048)<<12)+((b&4096)<<12)+((c&4096)<<13)+((b&8192)<<13)+((c&8192)<<14)+((b&16384)<<14)+((c&16384)<<15))}var h=alp.sub("alp.util.math.ixy",0,1),g=alp.util;h.MAX=alp.f(67108863);h.bbox=function(d,
b){return[d.ix,d.iy,b.ix,b.iy]};h.fetch_bbox=function(d,b,c){function a(a){return d[Math.round(a)][0]}function e(a){return b[Math.round(a)][1]}c[2]>c[0]-1E-10&&c[3]>c[1]-1E-10||(void 0).invalid_bbox;var l=Math.max(d[0][0],k(c[0],c[1])),f=Math.max(b[0][1],k(c[1],c[0])),n=Math.min(d[d.length-1][0],k(c[2],c[3])),q=Math.min(b[b.length-1][1],k(c[3],c[2]));l=g.funSoftIndex(a,l,{last:d.length-1});n=g.funSoftIndex(a,n,{last:d.length-1});l=l.ind0;n=Math.ceil(n.ind_prop);f=g.funSoftIndex(e,f,{last:b.length-
1});q=g.funSoftIndex(e,q,{last:b.length-1});q=alp.arr2o(b.slice(f.ind0,Math.ceil(q.ind_prop)+1),0,0);f=[];var p=c[0],h=c[1],u=c[2];for(c=c[3];l<=n;l++){var t=d[l];if(t[0]in q){var w=t[2],x=t[3];w<p||x<h||w>u||x>c||f.push(t)}}return f};h.interleave=k;var f=67108863,e=1073741824})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.ixy_degrees");
(function(){function k(a,b){a%=360;-180>a?a+=360:180<a&&(a-=360);b%=180;-90>b?b+=180:90<b&&(b-=180);var c=Math.max(0,Math.min(l,Math.round((180+a)*r))),d=Math.max(0,Math.min(l,Math.round((90+b)*n))),e=m(c,d),f=m(d,c);return{ixy:e,iyx:f,ix:c,iy:d,x:a,y:b}}function h(a,c){"number"===typeof a?a/=b:(c=c.z,c.toPrecision.call.a,a=a.pixel/(1<<c)*q);return a}var g=alp.sub("alp.maps",null,!0),f=alp.util.math.ixy,e=g.project_SM,d=g.unproject_SM,b=g.geodesic.EARTH_RADIUS,c=f.bbox,a=f.fetch_bbox,m=f.interleave;
g.ixy_26bits=k;g.ixy_degrees=function(a,b){if("number"===typeof b)var c=a;else"lng"in a?(c=(b="function"===typeof a.lng)?a.lng():a.lng,b=b?a.lat():a.lat):(c=a[0],b=a[1],null==c&&(c=a.x,b=a.y));return k(c,b)};g.ixy_fetch_shape=function(b,f,m){for(var g=m.shape.toLowerCase(),n=m.coords,p,q,r,v,u=n[0],E=n[1];180<u;)u-=360;for(;-180>u;)u+=360;if("circle"===g||"ellipse"===g){var G=e({lat:E,lng:u}),B;if("circle"===g)var I=B=h(n[2],m);else I=h(n[2],m),B=h(n[3],m);u=d({x:G.x-I,y:G.y-B});r=d({x:G.x+I,y:G.y+
B});p=r.lat;q=u.lng;r=r.lng;v=u.lat}else"rect"===g?(r=n[2],n=n[3],p=Math.max(E,n),q=Math.min(u,r),r=Math.max(u,r),v=Math.min(E,n)):(void 0).unknown_shape;p=c(k(q,v),k(r,p));b=a(b,f,p);if("rect"===g)return b;g=[];I=I*I+1E-10;B=B*B+1E-10;f=b.length;for(p=0;p<f;p++)q=b[p],u=e({lat:-90+180*q[3]/l,lng:-180+360*q[2]/l}),r=u.x-G.x,u=u.y-G.y,1>r*r/I+u*u/B&&g.push(q);return g};var l=f.MAX(),r=l/360,n=l/180;k(0,85.05112877980659);k(0,-85.05112877980659);var q=Math.PI/128})();"undefined"!==typeof dojo&&dojo.provide("alp.util.sortedinsert");
alp||(alp={});alp.util||(alp.util={});alp.util.add_sortedinsert=function(k,h){var g=new alp.util.SortedInserter(k,h);k.sortedinsert=function(f){return g.insert(f)};k.sortedinsert_ind=function(f){return g.insert_ind(f)};return k};alp.util.sortedinsert=function(k,h,g){(new alp.util.SortedInserter(h,g)).insert(k)};
(function(){alp.declare("alp.util.SortedInserter",null,function(k,h){this.arr=k||[];h&&alp.mixCheck(this,h)},{compare_fun:null,insert:function(k){var h=this.insert_ind(k);this.arr.splice(h,0,k);return h},insert_ind:function(k){var h=this.arr,g=0,f=h.length;if(!(0<f))return 0;if(this.compare_fun){var e=this.compare_fun;if(0>e(k,h[0]))return 0;if(0<e(k,h[f-1]))return f;for(;d!==(d=f-g);)b=f+g>>1,c=h[b],0>e(k,c)?f=Math.max(g,b):g=Math.min(f,b)}else{if(k<h[0])return 0;if(k>h[f-1])return f;for(var d,b,
c;d!==(d=f-g);)b=f+g>>1,c=h[b],k<c?f=Math.max(g,b):g=Math.min(f,b)}return f}})})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.ixy_id_store");
(function(){function k(a){var c=a.coords;(a.shape||0).substring.call.a;c.splice.call.a;return alp.map(b(this.ixy_id_sorted_arr,this.iyx_id_sorted_arr,a),"this[ v[4] ].data",this.id_2_info)}function h(a){var c=a.coords;(a.shape||0).substring.call.a;c.splice.call.a;return alp.map(b(this.ixy_id_sorted_arr,this.iyx_id_sorted_arr,a),"v[4]")}function g(a,b,c,e){a.toPrecision.call.a;b.toPrecision.call.a;(c.substring||c.toPrecision).call.a;a=d(a,b);var l=this.id_2_info;b=this.ixy_id_sorted_arr;var f=this.iyx_id_sorted_arr;
if(c in l){e=l[c];l=e.ixy;var m=e.iyx;if(l!==a.ixy){l=b.sortedsearch([l,c]);m=f.sortedsearch([m,c]);var g=1+m.last-m.first;1===1+l.last-l.first&&1===g||(void 0).bug;b.splice(l.first,1);f.splice(m.first,1);m=[a.ixy,a.iyx,a.ix,a.iy,c];alp.and(m,".toPrecision.call.a");b.sortedinsert(m);f.sortedinsert(m);e.ixy=a.ixy;e.iyx=a.iyx}}else e=alp.mix({data:e,id:c},a),m=[a.ixy,a.iyx,a.ix,a.iy,c],alp.and(m,".toPrecision.call.a"),l[c]=e,b.sortedinsert(m),f.sortedinsert(m)}var f=alp.sub("alp.maps",null,!0),e=alp.util,
d=f.ixy_26bits,b=f.ixy_fetch_shape;f.ixy_id_create_store=function(){var b=e.add_sortedsearch(e.add_sortedinsert([],c),a),d=e.add_sortedsearch(e.add_sortedinsert([],m),l);return{ixy_id_sorted_arr:b,iyx_id_sorted_arr:d,id_2_info:{},fetch:k,fetch_id_arr:h,set:g}};var c={compare_fun:function(a,b){var c=a[0],d=b[0];return c<d?-1:c>d?1:a[4]-b[4]}},a={data_compare_fun:function(a,b){var c=a[0],d=b[0];return c<d?-1:c>d?1:a[4]-b[1]},data_equals_fun:function(a,b){return a[0]===b[0]&&a[4]===b[1]}},m={compare_fun:function(a,
b){var c=a[1],d=b[1];return c<d?-1:c>d?1:a[4]-b[4]}},l={data_compare_fun:function(a,b){var c=a[1],d=b[0];return c<d?-1:c>d?1:a[4]-b[1]},data_equals_fun:function(a,b){return a[1]===b[0]&&a[4]===b[1]}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.marker");
alp.gmap3(function(k){function h(b){if(!("_alp_marker_id"in b)){b._alp_marker_id=a++;var c=alp.bindF(f,null,b);b.positionSt?b.positionSt().change_cb_init(c):(c(),e.event("addListener")(b,"position_changed",c))}}function g(a,b,c){function d(b,c){var d="set"+c.slice(3);a["_alp_tmp_"+c]=a[c];a[c]=function(){d in n||null.bug;return n[d]}}function e(b,c){a[c]=function(a){c in n||null.bug;n[c]=a}}(b||null).substring.call.a;(c||null).hasOwnProperty.call.a;if(!(b in r)){var f=alp.filterIn(a,"w.match( /^get\\w+$/ )"),
m=alp.filterIn(a,"w.match( /^set\\w+$/ )");f=alp.filterIn(f,'"set"+w.slice(3) in this',m);m=alp.filterIn(m,'"get"+w.slice(3) in this',f);r[b]={pget:f,pset:m,pgetset:alp.oCreateMix(f,m)};alp.forIn(f,d);alp.forIn(m,e)}var g=r[b],n=l[b]||(l[b]=alp.arr2o(alp.oKeys(g.pset),alp.f(),function(b){return g.pget["get"+b.slice(3)].call(a)}));alp.forIn(c,function(b,c){var d=g.pset;d[c]&&d[c].call(a,b)});alp.m(a._alpLabel,"update_map")}function f(a){var b=a._alp_marker_id,c=a.getPosition(),d=c&&c.lat?c.lat():-90;
c=c&&c.lng?c.lng():180;m.set(c,d,b,a)}var e=alp._gmap2_3,d=alp.maps,b={},c=location.protocol;e.overlay._install();e.MARKER_ID=alp.f('"_alp_marker_id"');e.marker_gen=function(a,b){if(b){var d=alp.cfg.marker,l=[].slice.call(arguments,2);d=d[b].apply(d,l);a=alp.mix(e.marker_opts.markerCfg_2_markerOptions(d),a)}if(e.V3()){var f=a&&a.icon;if(f&&!/^file:$/i.test(c))if("string"===typeof f)var m=a.icon=f.replace(/^https?:\/\//i,"//");else"string"===typeof f.url&&(m=f.url=f.url.replace(/^https?:\/\//i,"//"));
f=/\.svg$/i.test(m)&&!k.__alp_lf__&&alp.sub("google.maps")?new e.SVGMarker(a):new k.Marker(a)}else null.unsupported;f&&h(f);return f};e.marker_fetch=function(a){return m.fetch(a)};e.marker_register=h;e.marker_tmp_set=function(a){for(var c in a)if(!(c in b)){var d=m.id_2_info[c];if(d=d&&d.data){var e=a[c];if(e)g(d,c,alp.filterIn(e,"w.match(/^set\\w+$/)"));else{e=c;(e||null).substring.call.a;var f=r[e];f&&(delete r[e],alp.mix(d,f.pgetset),alp.forIn(f.pget,'delete this["_alp_tmp_" + w]',d));if(f=l[e])delete l[e],
alp.forIn(f,"alp.m(this,w,v)",d);alp.m(d._alpLabel,"update_map")}}else console.error("AG.marker_tmp_set_options could not find marker id "+c)}};var a=0,m=d.ixy_id_create_store(),l={},r={}});"undefined"!==typeof dojo&&dojo.provide("alp.cfg.ooi");
(function(){alp.mix(alp.cfg||(alp.cfg={}),{ooi:function(){var k={altmax:{from:'alp.gEBCN("altitude_max-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="altitude_max-value"\')))',what:"node.value"},altmin:{from:'alp.gEBCN("altitude_min-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="altitude_min-value"\')))',what:"node.value"},ascent:{from:'alp.gEBCN("logicalAscent-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="logicalAscent-value"\')))',what:"node.value"},condition:{from:'alp.gEBCN("condition-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="condition-value"\')))',
what:"node.value"},datatypeid:{from:'alp.gEBCN("datatypeid-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="datatypeid-value"\')))',what:"node.value"},datatypename:{from:'alp.gEBCN("datatypename-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="datatypename-value"\')))',what:"node.value"},datatypetitle:{from:'alp.gEBCN("datatypetitle-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="datatypetitle-value"\')))',what:"node.value"},descent:{from:'alp.gEBCN("logicalDescent-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="logicalDescent-value"\')))',
what:"node.value"},difficulty:{from:'alp.gEBCN("abstractDifficulty-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="abstractDifficulty-value"\')))',what:"node.value"},duration:{from:'alp.gEBCN("minTime-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="minTime-value"\')))',what:"node.value"},experience:{from:'alp.gEBCN("qualityOfExperience-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="qualityOfExperience-value"\')))',what:"node.value"},externalId:{from:'alp.gEBCN("externalId-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="externalId-value"\')))',
what:"node.value"},externalSystem:{from:'alp.gEBCN("externalSystem-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="externalSystem-value"\')))',what:"node.value"},geojson:{from:'alp.gEBCN("geojson-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="geojson-value"\')))',what:"node.value"},geometry:{from:'alp.gEBCN("geometry-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="geometry-value"\')))',what:"node.value"},geometry_simplified:{from:'alp.gEBCN("geometry-simplified-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="geometry-simplified-value"\')))',
what:"node.value"},id:{from:'alp.gEBCN("id-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="id-value"\')))',what:"node.value"},landscape:{from:'alp.gEBCN("landscape-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="landscape-value"\')))',what:"node.value"},length_km:{from:'alp.gEBCN("tourLength-km-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="tourLength-km-value"\')))',what:"node.value"},length_m:{from:'alp.gEBCN("tourLength-m-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="tourLength-m-value"\')))',
what:"node.value"},maintype:{from:'alp.gEBCN("maintype-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="maintype-value"\')))',what:"node.value"},morelink:{from:'alp.gEBTN("a",alp.gEBCN("morelink-value")[0])',what:'alp.gA(node, "href")'},technique:{from:'alp.gEBCN("technique-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="technique-value"\')))',what:"node.value"},title:{from:'alp.gEBCN("title-value",node).concat(alp.domWalkSelect(node,alp.f(\'.name=="title-value"\')))',what:"node.value"}},
h;for(h in k)if(k.hasOwnProperty(h)){var g=k[h];g.from=new Function("node","return ("+g.from+");");g.what=new Function("node","return ("+g.what+");")}return k}})})();"undefined"!==typeof dojo&&dojo.provide("alp.iw");
(function(){alp.iw||(alp.iw={});alp.iw.ensure_css=function(){alp.ensureCss(alp.cssBase()+"alp/x.css")};alp.iw.htmlDfrd=function(k,h){(k||0).substring.call.a;(h||0).substring.call.a;var g=alp.dfrd("alp.iw.htmlDfrd",{then:1});k=alp.jsBase()+alp.i18n.language()+"/info.iw.ooi.jsp?i="+h+"&proj="+k;alp.m(alp.jsonp(k),["then","to"],function(f){g.done('<div class="oax"><div class="js-cv-iw alp-x-clickable">'+f+"</div></div>")});return g}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.iw");
alp.gmap3(function(k){var h=alp._gmap2_3,g=alp.cfg.ooi(),f={};h.iw2_alpha_url=alp.f('alp.cssBase() + "alp/gmap/resources/images/iw2_0_85.png"');h.iwCloseAll=function(a){a.closeInfoWindow?a.closeInfoWindow():alp.m(k.InfoWindow,"closeAll",a)};h.iwDivPreventMapInteraction=function(a){function b(a){a.cancelBubble=!0;alp.m(a,"stopPropagation")}var c=k.event;c.addDomListener(a,"mousedown",b);c.addDomListener(a,"click",b);c.addDomListener(a,"dblclick",b);c.addDomListener(a,"contextmenu",b)};h.iw_domnode_geomconnect=
function(a,b,c,d){var e=alp.db.common(),l=alp.fVal(alp.opt(d,"id")),m=alp.opt(d,"mouseover_without_geom");"string"===typeof a&&(a=alp.cE("div",null,null,{innerHTML:a}));var r=alp.Aps.call(alp.gEBCN(["quicktourdesc-clusteriw",h.IW_CLASS()],a));l&&r.unshift(a);r=alp.filter(r,function(a){return!alp.or(r,function(b){return alp.isDescendant(a,b,1)})});alp.forEach(r,function(d){try{var n,p,q,r,h;alp.forEach(g.id.from(d),function(a){l||(l=g.id.what(a))});l&&!/^[\-\+\d]{2,}$/.test(l)&&(console.error("alp._gmap2_3.iw_domnode_geomconnect(): invalid id:",
l),l=null);alp.forEach(g.externalSystem.from(d),function(a){n||(n=g.externalSystem.what(a))});alp.forEach(g.externalId.from(d),function(a){p||(p=g.externalId.what(a))});n&&p&&(q="null"===n||"null"===p?{}:{externalSystem:n,externalId:p});if(l){(r=e.getset(l+".maintype"))||alp.forEach(g.maintype.from(d),function(a){r||(r=g.maintype.what(a))&&e.getset(l+".maintype",r)});if("tour"===r){var k=f[l];k||((h=e.getset(l+".geometry"))||alp.forEach(g.geometry.from(d),function(a){h||(h=g.geometry.what(a))&&e.getset(l+
".geometry",h)}),k=h&&alp.oFrom(h))}1>alp.gEBCN("js-no-tablink",d.parentNode||a).length&&b&&alp.aEL(d,"click",alp.bindF(b,null,l,!0,q),!1);if(k||m)k&&(f[l]=k),c&&alp.aEL(d,"mouseover",alp.bindF(c,null,l,!0,q),!1)}}catch(C){console.error("alp._gmap2_3.iw_domnode_geomconnect() caught an error while parsing the IW snippet",C,d)}});return a};h.iwOpen=alp.nowF(function(a,b,c,d){function l(){return alp.isDescendant(x,a.getDiv())}function f(){return!l()}alp.opt(d,"iwMulti");var m=alp.opt(d,"iwOpenCallback"),
g=alp.opt(d,"iwClickCallback"),r=alp.opt(d,"iwCloseCallback");null==m||m.call.a;null==g||g.call.a;null==r||r.call.a;if(a){var t=a.getCenter(),w=a.getZoom();d&&d.iwMulti||(e=null,h.iwCloseAll(a));var x=c;"string"===typeof x&&(x=alp.cE("div",null,null,{innerHTML:x}));g&&alp.aEL(x,"click",alp.nowF(g));c=!1;a.openInfoWindowHtml&&(a.openInfoWindowHtml(b,x,d),c=!0);if(k.InfoWindow){var y=alp.cE("div");alp.aC(y,x);var z=e=new k.InfoWindow({content:y,position:b});z.open(a);var A=z.getContent;z.getContent=
function(){var a=A.apply(this,arguments);return a===y?x:a};c=!0}h.iwOpen._lastNode=x;h.iwOpen._lastLatLng=b;c&&d&&d.opacity&&h.iw_get_parentnode(x).then(function(a){alp.setOpacity(a,d.opacity)});m&&alp.subDfrd(l).then(function(){m({iw:z,node:x})});r&&alp.subDfrd(l).then(function(){var b=!1;h.event("addListenerOnce")(a,"zoom_changed",function(){w!==a.getZoom()&&(b=!0)});h.event("addListenerOnce")(a,"drag",function(){t&&!t.equals(a.getCenter())&&(b=!0)});alp.subDfrd(f).then(function(){r({origZoom:w,
origCenter:t,mapMoved:b,last_iw:e,iw:z})})});return z}});h.iwOpen.isLastVisible=alp.f("this._lastNode  &&  alp.isDescendant( this._lastNode, alp.body() )");h.iwOpen.lastLatLng=alp.f("this._lastLatLng");h.iwOpenOOI=alp.nowF(function(a,b,c){function d(){var d=new alp.data.SingleOOI(b,{proj:e,language:l}),m=alp.iw.htmlDfrd(e,b);d.load(function(d,l){alp.m(m,["then","to"],function(d){var m=c.position||new k.LatLng(l.y,l.x),g=f&&("string"===typeof f?f:f.join(" "));d=alp.cE("div",null,null,{innerHTML:d,
"class":g||""});alp.installNode(".js-template-img",d);alp.iw.ensure_css();c&&c.onClick&&alp.aEL(d,"click",c.onClick);h.iwOpen(a,m,d,c);c&&c.fit&&a.fitOOI(b,{iw:!0,proj:e})})})}var e=c&&c.proj,l=c&&c.language||alp.i18n.language(),f=c&&c.iwClass;if(c&&c.show){var m=new h.TourPoiLayer(b,alp.oCreateMix({fitTourBounds:!1,proj:e},c&&c.tourPoiLayerOpts));m.setMap(a);m.whenLoaded(d);return m}d()});h.IW_CLASS=alp.f('"js-cv-iw"');h.IW_PARENTCLASS=alp.f('"gmnoprint"');h.iw_get_parentnode=function(a){var b=h.IW_PARENTCLASS();
var c=new alp.dfrd("AG.iw_get_parentnode");if(!b)return c;var d=function(){var c=a.parentNode;if(c){for(;!alp.hasClass(c,b);)if(c=c.parentNode,!c)return;for(;alp.hasClass(c.parentNode,b);)if(c=c.parentNode,!c)return;return c}};var e=0;var f=alp.asyncF(0,alp.nowF(function(){var a=d();a?c.triggerSoon(a):1E3<e||(e++,f())}));f();c.then=alp.nowF("thenSoon",c);return c};var e,d=alp.sub("InfoWindow.prototype",k);if(d){var b=alp.mapany();alp.forEach(["open","close"],function(a){if(d[a]){var b=d[a];d[a]=function(a){c(this,
a);return b.apply(this,arguments)}}});k.InfoWindow.closeAll=function(a){a=a?[a]:b.keys();alp.forEach(a,function(a){(a=b.get(a))&&alp.forEach(a,function(a){a.close()})})};var c=function(a,c){var d=a._alpMap;if(d&&(d=b.get(d))){var e=alp.lastIndexOf(d,a);-1<e&&d.splice(e,1)}c&&(d=b.get(c)||b.setNow(c,[]),e=alp.lastIndexOf(d,a),0>e&&d.push(a));a._alpMap=c}}});"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.cluster_config_custom");
(function(){alp.sub("alp.maps",null,!0).clusterConfig_customize_single_markers=function(k,h){var g=k&&k.url,f=alp.filterIn(alp.opt(k,["size","anchor","scaledSize"]),alp.f());if(g){var e="string"===typeof g;k="object"===typeof g;if(alp.or([e,k,"function"===typeof g])){if(k){var d=g;g=function(b,a){return d[a]}}var b=[];alp.treeForEach(h.cat,"children",function(c,a,d){d=a.url;if(e)d&&(a.url=g+"/"+d.substring(1+d.lastIndexOf("/")));else if(d=g(a[c],c)||b[b.length-1])"string"===typeof d&&(a[c].img=d),
alp.mix(a[c],f)},!1,null,{before:function(c,a){b.push(g(a[c],c)||b[b.length-1])},after:function(c,a){b.pop()}})}else console.error("AM.clusterConfig_customize_single_markers(): `mapIcon` must be either a string, an object or a function!")}}})();"undefined"!==typeof dojo&&dojo.provide("alp.util.public_eh");
(function(){var k={};alp.util||(alp.util={});alp.declare("alp.util.PublicEh",null,function(){this._alpEvt||(this._alpEvt={});this._alpEvtEh=new alp.Eh;this.dropAll();this.addEvent("addListener");this.addEvent("dropListener")},{eventHasListeners:function(h){return this._alpEvt[h].hasListeners()},listen:alp.nowF(function(h,g){var f=this._alpEvt;if(!f[h])throw Error('alp.util.PublicEh.listen(): did not find event "'+h+'". Available events: '+this.getEvents());var e=alp.Aps.call(arguments,1),d=typeof e[0];
1<e.length&&"string"!==d&&"function"!==d&&(e=[e[1],e[0]].concat(e.slice(2)));e=alp.bindF.apply(alp,e);f=f[h];f.thenSoon(e);this._alpEvtEh.push(e,alp.bindF("dropSoon",f,e));(d=this._alpEvtName2St[h])&&d.set(!0);this.triggerEvent.apply(this,["addListener"].concat([].slice.call(arguments)));return{arg:arguments,eventName:h,e:f,cb:e,_alpRemover:alp.bindF("drop",this)}}),drop:function(h){if(h.eventName){alp.now("dropSoon",h.e,h.cb);var g=this._alpEvtName2St[h.eventName];g&&g.setNow(this.eventHasListeners(h.eventName));
this.triggerEvent.apply(this,["dropListener"].concat([].slice.call(arguments)))}else console.error("alp.util.PublicEh.drop(h): could not determine `eventName` for handler `h`:",h)},dropAll:function(){this._alpEvtEh.clear();var h=this._alpEvtName2St||(this._alpEvtName2St={}),g;for(g in h)g in k||h[g].set(!1)},addEvent:function(h){this._alpEvt[h]=alp.event(h);var g=this["on"+h.charAt(0).toUpperCase()+h.substring(1)];"function"===typeof g&&this.listen(h,g)},getEvents:function(){return alp.oKeys(this._alpEvt)},
hasEvent:function(h){return!!this._alpEvt[h]},triggerEvent:alp.nowF(function(h){console.log(this.declaredClass+".triggerEvent",h,[].slice.call(arguments,1));var g=this._alpEvt[h];g.triggerSoon.apply(g,alp.Aps.call(arguments,1))}),stEventHasListeners:function(h){var g=this._alpEvtName2St;return g[h]||(g[h]=new alp.BoolState({init_value:this.eventHasListeners(h)}))}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.layer.abstract_marker_layer");
(function(){var k=alp.maps;alp.declare("alp._gmap2_3.AbstractMarkerLayer",alp.util.PublicEh,alp.nowF(function(h){var g=this;alp.mixCheck(g,h);if("string"!==typeof g.proj)throw Error("alp._gmap2_3.AbstractMarkerLayer(): requires at least `cfg.proj`.");h=new alp.State({init_value:null});var f=new alp.State({init_value:null});g._alp=alp.mix(g._alp||{},{mapSt:h,clusterConfigSt:f});h.change_cb(function(e){if(e){if(g.eagerLoad)g.onAdd(e);e.whenLoaded("onAdd",g)}else g.onRemove()});g.addEvent("markerClick");
g.addEvent("markerDragend");g.addEvent("markerMouseover");g.addEvent("markerMouseout");g.addEvent("visibleIdsChange");g.addEvent("allIdsChange");g.eagerLoad?g._load_config():alp.asyncF(0,"_load_config",g)()}),{config_url:null,config_url_default:alp.cfg.url.abstract_marker_layer_config(),type:"",v2:!0,mapSt:null,mapIcon:null,locale:alp.i18n.language(),eagerLoad:!0,onMarkerClick:null,onMarkerDragend:null,onMarkerMouseover:null,onMarkerMouseout:null,onVisibleIdsChange:null,onAllIdsChange:null,getCatTree:function(){var h=
this._alp.clusterConfigSt.get();return h&&h.cat},getMap:function(){return this._alp.mapSt.get()},setMap:function(h){var g=this._alp.mapSt.get();h&&g&&h!==g&&this._alp.mapSt.setNow(null);this._alp.mapSt.setNow(h)},getProjection:function(){var h=this._alp.mapSt.get();return h&&h.getProjection&&h.getProjection()},getPanes:function(){},draw:function(){},onAdd:function(){},onRemove:function(){},_load_config:function(){var h=this,g=alp.tmpl(h.config_url||h.config_url_default,h);alp.jsonp(g).then(function(f,
e){(e=h.mapIcon)&&k.clusterConfig_customize_single_markers(e,f);h._alp.clusterConfigSt.set(f);(f=h.getCatTree())&&0<alp.oKeys(f).length||console.warn('alp._gmap2_3.AbstractMarkerLayer: Empty category tree! You might want to check your `proj` value ("'+h.proj+'"), make sure in ALPcms that the ALPregio project exists, and that it has a non-empty category tree.')})}})})();"undefined"!==typeof dojo&&dojo.provide("alp.lang.deprecate");
(function(){alp.sub("alp.lang",null,!0).deprecate=function(k,h,g,f){if(!h||!g||h===g)throw Error("What?");null!=k[h]&&(console.error('"'+h+'" is deprecated. Please use "'+g+'" instead.'),h=k[h],f=f?alp.f(f)(h):h,k[g]=f);return k}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.layer.abstract_iwmarker_layer");
(function(){var k=alp.lang;alp.iw.ensure_css();alp.declare("alp._gmap2_3.AbstractIWMarkerLayer",alp._gmap2_3.AbstractMarkerLayer,function(){k.deprecate(this,"noAlpIW","defaultIW","!");this.noAlpIW=!this.defaultIW;this.addEvent("iwSelect");this.addEvent("iwMouseover");this.customIW&&(this.noAlpIW=!0,this.customIW.loadingHTML=this.customIW.loadingHTML||"Laden...",this._install_customIW())},{defaultIW:!0,noAlpIW:null,customIW:null,onIwSelect:null,onIwMouseover:null,iwClass:null,_install_customIW:function(){var h=
this;h.listen("markerClick",function(g){alp._gmap2_3.iwOpen(g.map,g.latlng,h.customIW.loadingHTML);g.load(function(f){f=alp.data.allMaintype(f);f=h.customIW.render(f);alp._gmap2_3.iwOpen(g.map,g.latlng,f)})})}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.layer.ooi_layer");
alp.gmap3(function(k){function h(f,e){var d=f.getPosition(),b=f._alpIndex;this.map=f._alpGmap;this.latlng=new k.LatLng(d.lat(),d.lng());this.index=b;this.id=f._alpId;alp.mix(this,alp.data.external_info(f._alpData));this.load=function(b){var a=b;1<arguments.length&&(a=alp.Aps.call(arguments),"object"===typeof a[0]&&(a=[a[1],a[0]].concat(a.slice(2))),a=alp.bindF.apply(alp,a));(new alp.data.OOIs({proj:e.proj,idlist:[f._alpId],xdomain:null})).load(a)}}var g=alp._gmap2_3;alp.declare("alp._gmap2_3.OOILayer",
g.AbstractIWMarkerLayer,alp.nowF(function(f){var e=this;e.update_view=alp.ratelimitF(Math.abs(e.view_update_interval_ms),"update_view",e);e._alp.mapSt.change_cb("update_view",e);e.addEvent("idlistChanged");e.idlistSt=new alp.ObjectState({init_value:[],constrain_all:function(d,b){d||(d=b);for(b=d.length;b--;){var c=alp.oToString(d[b]);alp.or(d.slice(0,b),function(a){return alp.oToString(a)===c})&&d.splice(b,1)}return d}});e.idlistSt.change_cb(function(){e.triggerEvent("idlistChanged");e.update_view(!0);
e.eventHasListeners("allIdsChange")&&e.triggerEvent("allIdsChange",e.idlistSt.get())});e.highlightIdSt=new alp.ObjectState({init_value:null});e.highlightIdSt.change_cb("update_view_not_extent",e);e.symbolSt=new alp.State({init_value:e.symbol||"A",constrain_all:function(d,b){d=d&&(d+"").toUpperCase();return"A"!==d&&"1"!==d?b:d}});e.symbolSt.change_cb("update_view_not_extent",e);e.sizeSt=new alp.State({init_value:e.size});e.sizeSt.change_cb("update_view_not_extent",e);e.colorSt=new alp.State({init_value:e.color});
e.colorSt.change_cb("update_view_not_extent",e);e.highlightcolorSt=new alp.State({init_value:e.highlightcolor});e.highlightcolorSt.change_cb("update_view_not_extent",e);e._alp.visibleIdlistSt=new alp.SortedArrayState({init_value:[]});e._alp.visibleIdlistSt.change_cb("triggerEvent",e,"visibleIdsChange");e._alp.updateVisibleIdlist_st=e.stEventHasListeners("visibleIdsChange");e._alp.updateVisibleIdlist_st.change_cb_init("_register_update_visibleIdlistSt",e);e._alp.mapSt.change_cb_init("_register_update_visibleIdlistSt",
e);e._update_visibleIdlistSt=alp.ratelimitF(500,"_update_visibleIdlistSt",e);e._markers=[];e.update_view(!0)}),{proj:null,size:"big",color:"green_chili",highlightcolor:"coral",autoExtent:!0,autoExtentPadding:.1,view_update_interval_ms:178,ooi_a_1_gen:g.marker_opts.ooi_a_1_gen,noMouseover:!1,onIdlistChanged:null,idlistSt:null,highlightIdSt:null,symbolSt:null,sizeSt:null,colorSt:null,highlightcolorSt:null,addOOI:function(f){"string"===typeof f&&(f=[f]);this.idlistSt.setNow((this.idlistSt.get()||[]).concat(f));
return this},removeOOI:function(f){"string"===typeof f&&(f=[f]);this.idlistSt.setNow(alp.filter(this.idlistSt.get(),function(e){return 0>alp.lastIndexOf(f,e)}));return this},setOOI:function(f){"string"===typeof f&&(f=[f]);this.idlistSt.setNow(f);return this},clear:function(){this.idlistSt.setNow([]);return this},getIdlist:function(){return this.idlistSt.get()},highlightOOI:function(f){this.highlightIdSt.setNow(f)},setSymbol:function(f){this.symbolSt.setNow(f)},getSymbol:function(){return this.symbolSt.get()},
setSymbolLetter:function(){this.setSymbol("A")},setSymbolNumber:function(){this.setSymbol("1")},isSymbolLetter:function(){return"A"===this.getSymbol()},isSymbolNumber:function(){return"1"===this.getSymbol()},setColor:function(f){this.colorSt.setNow(f)},getColor:function(){return this.colorSt.get()},setSize:function(f){this.sizeSt.setNow(f)},getSize:function(){return this.sizeSt.get()},update_view_not_extent:function(){this.update_view(!1)},update_view:function(f){function e(a){a._alpEh=new alp.Eh;
a._alpEh.push(g.event("addListener")(a,"click",function(){d.triggerEvent("markerClick",new h(a,d))}),g.event("removeListener"));d.noMouseover||(a._alpEh.push(g.event("addListener")(a,"mouseover",function(){d.triggerEvent("markerMouseover",new h(a,d))}),g.event("removeListener")),a._alpEh.push(g.event("addListener")(a,"mouseout",function(){d.triggerEvent("markerMouseout",new h(a,d))}),g.event("removeListener")))}var d=this;d._need_to_update_extent=d._need_to_update_extent||f;var b=d._alp.mapSt.get(),
c=d.highlightIdSt.get(),a=b&&d.idlistSt.get()||[];f=new alp.data.OOIs({proj:d.proj,idlist:a,xdomain:null});var m=d.sizeSt.get(),l=d.colorSt.get(),r=d.highlightcolorSt.get(),n=d._cb=function(f){if(d._cb===n){d._cb=null;for(var p=alp.data.allMaintype(f,a);d._markers.length>p.length;)d._pool_put(d._markers.pop());if(b&&f&&p&&p.length){f=alp.map(p,function(a){a=alp.data.ooi_geometry(a);return new k.LatLng(a.lat,a.lng)});if(d._need_to_update_extent&&d.autoExtent){var q=new k.LatLngBounds;alp.forEach(f,
function(a){q.extend(a)});d._set_bbox(b,q,d.autoExtentPadding);d._need_to_update_extent=!1}var h="setTitle"in k.Marker.prototype,t="setOptions"in k.Marker.prototype;alp.forEach(f,function(a,f){var n=p[f],q=d.isSymbolNumber(),k=n.id,v=alp.data.ooiid.same_object(k,c),w=v?r:l,x=n.title,u=[f,q,w,m,!h&&x].join("##");w=d.ooi_a_1_gen(f,q,w,m);v||d._preload_marker_image({n:f,is_number:q,color:r,size:m});q=d._markers[f];if(q)if(q._alpIconparam===u)q._alpGmap!==b&&(q.setMap(b),q._alpGmap=b),q.setPosition(a),
h&&q.setTitle(x);else if(t&&q._alpOptions.icon.size.equals(w.icon.size))q.setOptions(w),q._alpIconparam=u;else{var y=q;q=d._markers[f]=null}q||((q=d._pool_get(u))?(q.setPosition(a),alp.m(q,"setTitle",x)):(q=g.marker_gen(alp.oCreateMix(w,{position:a,title:x})),e(q)),q.setMap(b),q._alpGmap=b,q._alpIconparam=u);q._alpOptions=w;q._alpData=n;q._alpId=k;q._alpIndex=f;d._markers[f]=q;y&&d._pool_put(y)});f=f.length;var w=d.isSymbolNumber();d._preload_marker_image({n:f,is_number:w,color:l,size:m});d._preload_marker_image({n:f,
is_number:w,color:r,size:m});d._cb=null}}};f.load(n);d._update_visibleIdlistSt()},_preload_marker_image:alp.memF(function(f){f=this.ooi_a_1_gen(f.n,f.is_number,f.color,f.size).icon;alp.imgPreload(f.url)}),_pool:{},_pool_put:function(f){this._pool[f._alpIconparam]=f;f.setMap(null)},_pool_get:function(f){var e=this._pool[f];e&&delete this._pool[f];return e},_set_bbox:g.set_bbox&&alp.ratelimitF(125,"set_bbox",g),_register_update_visibleIdlistSt:function(){var f=this._alp.h_up_vilst,e=this.getMap();null!=
f&&(g.event("removeListener")(f),this._alp.h_up_vilst=null);e&&(this._alp.h_up_vilst=g.event("addListener")(e,"bounds_changed",alp.bindF("_update_visibleIdlistSt",this)))},_update_visibleIdlistSt:function(){if(this._alp.updateVisibleIdlist_st.get()){var f=alp.m(this.getMap(),"getBounds");if(!1!==alp.m(f,"isEmpty"))this._alp.visibleIdlistSt.setNow([]);else{for(var e=this._markers,d=[],b=e.length;b--;){var c=e[b];f.contains(c.getPosition())&&d.push(c._alpId)}d.sort();this._alp.visibleIdlistSt.setNow(d)}}}})});
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.abstract_earth_flyable");alp.declare("alp._gmap2_3.AbstractEarthFlyable",alp.util.PublicEh,function(){this.addEvent("flightDataChange")},{flight3d:!0,autostartFlight3d:!1,rangeMeters:null,wait_after_first_sec:null,onFlightDataChange:null,getFlightData:null,isFlightActive:function(){return this.flight3d},isFlightAutoStart:function(){return this.autostartFlight3d}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.const");
(function(){var k=alp.sub("alp._gmap2_3",null,!0);k.OPTIM_LATLNG_DISTANCEFROM_OTHER_INPUT="_alp_distanceFrom_other_input";k.OPTIM_LATLNG_DISTANCEFROM_OTHER_OUTPUT="_alp_distanceFrom_other_output";k.REGION_TYPE_CIRCLE="circle";k.REGION_TYPE_RECT="rect";k.REGION_TYPE_ELLIPSE="ellipse";k.VISIBLE_CHANGED="visible_changed";k._ALP_MARKER_ID="_alp_marker_id";k._ALP_MARKER_XY="_alp_marker_xy";k._ALP_MARKER_MAP="_alp_marker_map";k._ALP_MARKER_USER_VIS="_alp_marker_user_vis";k._ALP_REMOVED_EMPTY_REGION_ON_ZOOM=
"_alp_removed_empty_region_on_zoom";k._ALP_MARKER_OLD_SET_VISIBLE="_alp_marker_old_set_visible";k._ALP_MARKER_OLD_GET_VISIBLE="_alp_marker_old_get_visible";k._ALP_MARKER_VIS_EVENT_QUEUE="_alp_marker_vis_event_queue"})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.polyline_decode");
(function(){alp.sub("alp.maps",null,!0).polylineDecode=function(k){var h=!1;alp.forEach(["points"],function(a){null==k[a]&&(console.error('alp.maps.util.polylineDecode( encPolyline ): missing field "'+a+'" for encPolyline: ',k),h=!0)});if(h)return[];k.levels||(k=alp.oCreateMix(k,{levels:alp.sRepli(String.fromCharCode(63),k.points.length)}));var g=function(a){return a?a.length:0},f=g(k.levels),e=Array(f),d=Array(f),b={xy:e,levels:d,zoomFactor:k.zoomFactor,numLevels:k.numLevels};if(!(0<f))return b;
var c=k.points;g=g(c);for(var a=0,m=0,l=0,r=0;a<g;++r){var n=1,q=0;do{var p=c.charCodeAt(a++)-63-1;n+=p<<q;q+=5}while(31<=p);m+=n&1?~(n>>1):n>>1;n=1;q=0;do p=c.charCodeAt(a++)-63-1,n+=p<<q,q+=5;while(31<=p);l+=n&1?~(n>>1):n>>1;e[r]=[1E-5*l,1E-5*m]}if(!e[e.length-1]){for(;!e[e.length-1];)e.length--;d.length=f=e.length}c=k.levels;for(a=0;a<f;++a)d[a]=c.charCodeAt(a)-63;return b}})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.coord");
(function(){function k(f,e){var d=f&&f.encPolyline;f=f&&f.coordinates||d&&g.polylineDecode(d).xy;return e&&f.length&&f[0]&&"number"!==typeof f[0][0]?alp.arrChain(f):f}var h=alp.sub("alp.maps.coord",null,!0),g=alp.maps;h.tour=k;h.ensure_enough_nodes=function(f,e){var d=k(f);if(2>d.length)throw Error("Insufficient geometry, need at least 2 nodes. id: "+f.id+", type: "+f.type);if(d.length>=e)return f;d=[].concat(d);for(var b=0,c;(c=d.length)<e;){b=1<b?b-1:c-1;c=d[b-1];var a=d[b];d.splice(b,0,[(c[0]+
a[0])/2,(c[1]+a[1])/2])}return alp.oCreateMix(f,{encPolyline:null,coordinates:d})};h.middleNodeXYi=function(f){!f.getArray||f instanceof Array||(f=f.getArray());var e=f.length>>1;f=f[e];return["lat"in f&&"lng"in f?[alp.fVal.call(f,f.lng),alp.fVal.call(f,f.lat)]:f,e]}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.util.coord");(function(){var k=alp.sub("alp._gmap2_3.util.coord",null,!0),h=alp.maps.coord;k.tour=h.tour;k.ensure_enough_nodes=h.ensure_enough_nodes;k.middleNodeXYi=h.middleNodeXYi})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.label");
alp.gmap3(function(k){function h(a){a=this._alp_cfg=v(a);this.setValues(a);g(this,a);this.div_.style.cssText="position: absolute; display: none";this.eh_=new alp.Eh}function g(a,b){var c="";b.label_style&&(c=u(b.label_style));var d=a.div_=alp.cE("div",null,b.label_class&&{"class":b.label_class});a.textdiv_=alp.cE("div",d,{style:c,"class":b.label_class&&b.label_class.replace(/\b(\S+)\b/g,function(a,b,c){return a+"-label"})})}function f(a){this.set("position",a)}function e(){return this.get("position")}
function d(a){this.set("label_text",a)}function b(){var a=this.get("label_text");return a&&a.toString()}function c(a){this.set("label_icon",a)}function a(){var a=this.get("label_icon");return a&&a.toString()}function m(){return this.div_}function l(){return this.textdiv_}function r(){var a=this,b=a.getPanes().floatShadow;alp.likeIE8minus_backslash_v()&&(a.div_.style.display="");a.div_.parentNode!==b&&b.appendChild(a.div_);alp.forEach(["position_changed","text_changed"],function(b){a.eh_.push(x.event("addListener")(a,
b,function(){a.draw("text_changed"===b)}),x.event("removeListener"))})}function n(){alp.likeIE8minus_backslash_v()?this.div_.style.display="none":this.div_.parentNode.removeChild(this.div_);this.eh_.clear()}function q(a){var b=this.getMap(),c=this.getProjection(),d=this.get("position"),e=!1;if(b&&d){b=c&&c.fromLatLngToDivPixel&&c.fromLatLngToDivPixel(d)||x.fromLatLngToDivPixel(b,d);d=this.div_;c=this.getText();var l=this.getIcon();c=(l?'<img src="'+l+'">':"")+c;d&&b&&(d=d.style,l=Math.round(b.x)+
"px",b=Math.round(b.y)+"px",d.left!==l&&(d.left=l,e=!0),d.top!==b&&(d.top=b,e=!0),"block"!==d.display&&(d.display="block",e=!0));if(!this._drew_once||a)this.textdiv_.innerHTML=c,e=!0;this._drew_once=!0;e&&this.drawEvt().triggerSoon(this.textdiv_)}}function p(){function a(a){a=this._alp_cfg=v(a);this.L=k.__alp_lf__;this._map=new alp.State;this._position=new alp.State;this._textS=new alp.StringState({init_value:a.label_text});this._iconS=new alp.StringState({init_value:a.label_icon});g(this,a);this._textS.change_cb(t,
null,this);this._iconS.change_cb(t,null,this);t(this);this._map.change_cb(w,null,this);this._position.change_cb(w,null,this);w(this)}var b=a.prototype;b.setMap=function(a){this._map.setNow(a)};b.getMap=function(){return this._map.get()};b.setPosition=function(a){this._position.setNow(a)};b.getPosition=function(){return this._position.get()};b.setText=function(a){this._textS.setNow(a)};b.getText=function(){return this._textS.get()};b.setIcon=function(a){this._iconS.setNow(a)};b.getIcon=function(){return this._iconS.get()};
b.getContDiv=function(){return this.div_};b.getTextDiv=function(){return this.textdiv_};b.set=function(a,b){if(a in void 0&&!(a in C))this["set"+alp.sCamel(a)](b)};b.setValues=function(a){if(a)for(var b in void 0)if(!(b in C)&&b in a)this["set"+alp.sCamel(b)](a[b])};b.getValues=function(){var a={},b;for(b in void 0)b in C||(a[b]=this["get"+alp.sCamel(b)]());return a};return a}function v(a){return a=alp.oCreateMix({label_text:"",label_icon:"",label_class:"alp._gmap2_3.Label",label_anchor:null,label_style:null,
capture_clicks:!0},a)}function u(a){if("string"===typeof a)return a;var b=[],c;for(c in a)c in C||b.push(c+": "+a[c]);return b.join("; ")}function t(a){var b=a._textS.get(),c=a._iconS.get();a.textdiv_.innerHTML=(c?'<img src="'+c+'">':"")+b}function w(a){var b=a._map.getPrevious(),c=a._map.get(),d=a._position.getPrevious(),e=a._position.get(),l=e&&e.__alp_lf__,f=a._lf_marker;b&&b!==c&&f&&b.__alp_lf__.removeLayer(f);b=a.L;var m=a.icon_=b.divIcon({className:a.div_.className,html:a.div_.innerHTML}),g=
m.createIcon;m.createIcon=function(){return alp.aC(alp.empty(g.apply(this,arguments)),a.div_)};f?f.setIcon(m):l&&(f=a._lf_marker=b.marker(l,{icon:m}));f&&(c&&f.addTo(c.__alp_lf__),!l||d&&e.equals(d)||f.setLatLng(l))}var x=alp._gmap2_3,y=x.util.coord,z=x.V2()&&k.Overlay,A=x.V3()&&k.OverlayView,C={};x.bind_label_to_marker=function(a,b){function c(){var c=("_alp_tmp_getMap"in b?b._alp_tmp_getMap():b.getMap())||null;c!==a.getMap()&&a.setMap(c)}function d(c){f.push(alp.aEL(a.getTextDiv(),c,function(d){alp.stopEvent(d||
window.event);d={latLng:a.getPosition(),stop:alp.f()};try{x.event("trigger")(b,c,d)}catch(R){}}))}function e(){setTimeout(c,150)}function l(){var c=alp.m(b,"getPath");c&&c.getLength()&&a.setPosition(x.xy2latlng(y.middleNodeXYi(c)[0]))}if(b){if(b._alpLabel===a){a._alpPositionBound||(alp.m(a,"bindTo","position",b,"position"),a._alpPositionBound=!0);return}b._alpLabel=a}var f=a._alpMarkerEh||(a._alpMarkerEh=new alp.Eh);f.clear();alp.m(a,"unbind","position");a._alpPositionBound=!1;if(b){a.update_map=
c;c();var m=alp.m(b,"alpMapSt_");m&&f.push(alp.now("change_cb",m,c),alp.nowF("dropSoon",m));alp.forEach(["setMap"],function(a){if(b[a]){var d=b[a];f.push(b[a]=function(){var a=d.apply(b,arguments);c();return a},function(){b[a]=d})}});m=x.event("removeListener");x.V3()&&(f.push(x.event("addListener")(b,"map_changed",e),m),k.isLeafletGshim||(f.push(x.event("addListener")(b,"visible_changed",e),m),f.push(x.event("addListener")(b,"true_visible_changed",e),m)),b.getPosition?alp.m(a,"bindTo","position",
b,"position"):b.getPath&&(f.push(x.event("addListener")(b,"path_changed",l),m),l()),(a.get?a.get("capture_clicks"):a._alp_cfg.capture_clicks)&&alp.forEach(["mouseover","mouseout","click"],d));if(x.V2()){f.push(x.event("addListener")(b,"visibilitychanged",c),m);alp.m(b,"draggable")&&(f.push(x.event("addListener")(b,"drag",function(b){a.setPosition(b.latLng)}),m),f.push(x.event("addListener")(b,"dragend",function(b){a.setPosition(b.latLng)}),m));var g=function(){a.setPosition(b.getPosition())};f.push(x.event("addListener")(b,
"position_changed",g),m);f.push(x.event("addListener")(b,"path_changed",g),m);g()}}};x.unbind_label_from_marker=function(a){(a=a._alpLabel)&&x.bind_label_to_marker(a);return a};k.isLeafletGshim?x.Label=p():A&&(x.Label=h,x.Label.prototype=new A,x.Label.prototype.setPosition=f,x.Label.prototype.getPosition=e,x.Label.prototype.setText=d,x.Label.prototype.getText=b,x.Label.prototype.setIcon=c,x.Label.prototype.getIcon=a,x.Label.prototype.getContDiv=m,x.Label.prototype.getTextDiv=l,x.Label.prototype.onAdd=
r,x.Label.prototype.onRemove=n,x.Label.prototype.draw=alp.nowF(q),x.Label.prototype.drawEvt=alp.memM("drawEvt",'alp.event("AG.label:drawEvt",{then:1})'));z&&(x.Label=alp.nowF(function(a){this.opts_=v(a);this.mapSt_=new alp.State;this.positionSt_=new alp.State;this.textSt_=new alp.State({init_value:a&&a.label_text||""});this.mapSt_.change_cb("alp_update_",this);this.positionSt_.change_cb("redraw",this);this.textSt_.change_cb("redraw",this)}),z=x.Label.prototype=new z,z.initialize=function(a){this.mapSt_.setNow(a)},
z.remove=function(){this.mapSt_.setNow(null)},z.copy=function(){return new x.Label(this.opts_)},z.redraw=function(a){var b=this.mapSt_.get(),c=this.positionSt_.get();a=this.div_();b?(this.textdiv_().innerHTML=this.textSt_.get()||"",b&&c&&(b=x.fromLatLngToDivPixel(b,c),a.style.left=Math.round(b.x)+"px",a.style.top=Math.round(b.y)+"px")):this.alp_update_()},z.setMap=function(a){this.mapSt_.setNow(a)},z.getMap=function(){return this.mapSt_.get()},z.setPosition=function(a){this.positionSt_.setNow(a)},
z.getPosition=function(){return this.positionSt_.get()},z.setText=function(a){this.textSt_.setNow(a)},z.getText=function(){return this.textSt_.get()},z.alp_update_=function(a,b){var c=this.div_(),d=c.parentNode,e=a&&a.getPane(k.MAP_MARKER_PANE);d&&d.removeChild(c);alp.m(b,"removeOverlay",this);a&&e&&(alp.m(a,"addOverlay",this),this.redraw(),e.appendChild(c))},z.div_=function(){var a=alp.cE("div",null,this.opts_.label_class&&{"class":this.opts_.label_class});a.style.position="absolute";a.style.zIndex=
160490817;return(this.div_=function(){return a})()},z.textdiv_=function(){var a=alp.cE("div",this.div_(),{style:this.opts_.label_style&&u(this.opts_.label_style),"class":this.opts_.label_class&&this.opts_.label_class+"-text"});return(this.textdiv_=function(){return a})()})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.latlng");
alp.gmap3(function(k){function h(b,c){var a=c?e+"_"+c:e,m=c?d+"_"+c:d;if(m in this&&b===this[a])c=this[m];else if(m in b&&this===b[a])c=b[m];else{var l=f*(b.lng()-this.lng()),g=f*this.lat(),n=f*b.lat(),q=Math,p=q.cos(l)*q.cos(n)-q.cos(g);l=q.sin(l)*q.cos(n);g=q.sin(n)-q.sin(g);p=q.sqrt(p*p+l*l+g*g);c=2*q.asin(p/2)*(c||6378137);this[a]=b;this[m]=c}return c}var g=alp._gmap2_3||(alp._gmap2_3={});k=k.LatLng&&k.LatLng.prototype;var f=Math.PI/180;k.distanceFrom||(k.distanceFrom=h);var e=g.OPTIM_LATLNG_DISTANCEFROM_OTHER_INPUT,
d=g.OPTIM_LATLNG_DISTANCEFROM_OTHER_OUTPUT});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.polyline_tool");
alp.gmap3(function(k){var h=alp.sub("alp._gmap2_3",null,!0);h.decodePolyline=alp.maps.polylineDecode;h.encodePolyline=function(g){var f=g.xy,e=g.levels;g=alp.opt(g,["zoomFactor","numLevels"]);for(var d=[0,0],b=f.length,c=Array(12*b),a=0,m=0;a<b;a++){var l=f[a];l=[l[0]-d[0],l[1]-d[1]];for(var r=2;r--;){var n=Math.round(1E5*l[r]);d[r]+=n/1E5;for(n=0>n?~(n<<1):n<<1;32<=n;)c[m++]=63+(32|n&31),n>>=5;c[m++]=63+(n&31)}}c.length=m;g.points=alp.sFromCharCode(c);if(e){f=Array(b);for(a=b;a--;)f[a]=63+e[a];g.levels=
alp.sFromCharCode(f)}else g.levels=alp.sRepli("B",b);e="zoomFactor";null==g[e]&&(g[e]=4);e="numLevels";null==g[e]&&(g[e]=9);return g};h.simplify_path=function(g,f,e){g instanceof k.Polyline&&(g=g.getPath());return h.xy2latlng(alp.simplifyGeom(h.latlng2xy(g),f,e))}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.polyline");
alp.gmap3(function(k){function h(){return d.bounds_fromPath(this.getPath())}function g(){return this.getPath().getLength()}function f(a){alp.mix(alp.sub("_alp.opt",this,!0),alp.opt(a,["strokeColor","strokeOpacity","strokeWeight"],!0));return m.apply(this,arguments)}function e(a){function b(){delete a[l]}var c=a.setAt&&a.removeAt&&a.insertAt;if(c&&l in a)return a[l];!c||r in a||(d.event("addListener")(a,"insert_at",b),d.event("addListener")(a,"remove_at",b),d.event("addListener")(a,"set_at",b),a[r]=
1);for(var e=0,f=a.getAt,m,g=a.length;g--;){var n=f?a.getAt(g):a[g];if(m){var q=p,h=v;if(h in n&&m===n[q])var k=n[h];else if(h in m&&n===m[q])k=m[h];else{var t=u*(m.lng()-n.lng()),J=u*n.lat(),P=u*m.lat();k=Math;var H=k.cos(t)*k.cos(P)-k.cos(J);t=k.sin(t)*k.cos(P);J=k.sin(P)-k.sin(J);H=k.sqrt(H*H+t*t+J*J);k=12756274*k.asin(H/2);n[q]=m;n[h]=k}e+=k}m=n}c&&(a[l]=e);return e}var d=alp._gmap2_3||(alp._gmap2_3={}),b=k.Polyline.prototype;d.overlay._install();var c="fromEncoded";k.Polyline[c]||(k.Polyline[c]=
function(a){a=d.decodePolyline(a);return d.polylineGen({path:alp._gmap2_3.xy2latlng(a.xy)})});c="getLength";b[c]||(b[c]=function(){return e(this.getPath())});d.pathCumLength=function(a){function b(){delete a[n]}var c=a.setAt&&a.removeAt&&a.insertAt;if(c&&n in a)return a[n];!c||q in a||(d.event("addListener")(a,"insert_at",b),d.event("addListener")(a,"remove_at",b),d.event("addListener")(a,"set_at",b),a[q]=1);for(var e=a.length,l=Array(e),f=l[0]=0,m=a.getAt,g,r=0;r<e;r++){var h=m?a.getAt(r):a[r];if(g){var k=
p,t=v;if(t in h&&g===h[k])var J=h[t];else if(t in g&&h===g[k])J=g[t];else{var P=u*(g.lng()-h.lng()),H=u*h.lat(),F=u*g.lat();J=Math;var D=J.cos(P)*J.cos(F)-J.cos(H);P=J.sin(P)*J.cos(F);H=J.sin(F)-J.sin(H);D=J.sqrt(D*D+P*P+H*H);J=12756274*J.asin(D/2);h[k]=g;h[t]=J}l[r]=f+=J}g=h}l.total=l[l.length-1];c&&(a[n]=l);return l};d.pathLength=e;c="getBounds";b[c]||(b[c]=h);c="getVertexCount";b[c]||(b[c]=g);d.polylineGen=function(a){var b=alp.oCreateMix(a,alp.sub("alp",a));a=new k.Polyline(a);alp.sub("_alp",
a,!0).opt=b;var c=alp.sub("placemark.name",b),e=alp.sub("placemark.icon",b);c&&(b=new d.Label({label_text:c,label_class:"alp-polyline-label "+(b.placemark["class"]||""),label_icon:e}),d.bind_label_to_marker(b,a));return a};c="setPath";var a=b[c];b[c]=function(b){a.apply(this,arguments);d.event("trigger")(this,"path_changed")};c="setOptions";var m=b[c];m&&(b[c]=f);var l="_alp_path_cached_length",r="_alp_path_change_connected",n="_alp_cumPath_cached_length",q="_alp_cumPath_change_connected",p=d.OPTIM_LATLNG_DISTANCEFROM_OTHER_INPUT,
v=d.OPTIM_LATLNG_DISTANCEFROM_OTHER_OUTPUT,u=Math.PI/180});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.data.tour_poi_model");
alp.gmap3(function(k){var h=alp._gmap2_3;alp.declare("alp._gmap2_3.data.TourPoiModel",alp.ObjectState,null,{constrain_all:function(g,f){var e=(g=alp.mix({},f,g))&&(g.tours||g.tour&&[g.tour]);this.tour_data_st().set(e);f=!(g.tour&&g.tour.isStagesTour)&&g&&g.pois;this.poi_data_st().set(f);if(e&&f){alp.reduce(e,"alp.mix(v,w.poiObj || {})",{});e=alp.reduce(e,"v.concat(w && w.poiArr || [])",[]);f=alp.arr2o(f);f=alp.map(e,"alp.mix(alp.oCreateMix(this[v.id],v), {geometryObj:this[v.id] && alp.data.ooi_geometry(this[v.id])})",
f);e=alp.arr2o(f);var d={};alp.forEach(f,"this[ v.category.id ] = 1 + (this[ v.category.id ]  ||  0);",d);var b=alp.oKeys(d).length;alp.forEach(f,"v.tourPoiRank = ((v.isRecommendationPoi ? 1 : 0) + 1 / ("+b+" * this[ v.category.id ])) / 2;",d);f={poiArr:f,poiObj:e}}else f=void 0;this.tour_poi_data_st().set(f);return g},setPoiArray:function(g){this.set_property("pois",alp.filter(g,""))},getTourData:function(){return alp.filter([].concat(this.tour_data_st().get()),alp.f())},tour_data_st:alp.memM("tour_data_st",
"new alp.ObjectState({ do_not_clone : true })",'.change_cb( "unset", this._tour_bounds_cache_st() )'),getPoiData:function(){return alp.filter([].concat(this.poi_data_st().get()),alp.f())},poi_data_st:alp.memM("poi_data_st","new alp.ObjectState({ do_not_clone : true })",'.change_cb( "unset", this._poi_bounds_cache_st() )'),getTourPoiData:function(){var g=this.tour_poi_data_st().get()||{},f=g.poiObj;g=g.poiArr;return f&&g?{poiObj:alp.oCreate(f),poiArr:[].concat(g)}:null},tour_poi_data_st:alp.memM("tour_poi_data_st",
"new alp.ObjectState({ do_not_clone : true })"),getTourBounds:function(){var g=this._tour_bounds_cache_st(),f=g.get();if(f)return f;var e=this.tour_data_st().get();e&&alp.forEach(e,function(d){var b=d&&d.encPolyline;(d=d&&(d&&d.coordinates||b&&h.decodePolyline(b).xy))&&d.length&&(f=f||new k.LatLngBounds,alp.forEach(h.xy2latlng(d),function(b){f.extend(b)}))});g.set(f,!0);return f},getPoiBounds:function(){var g=this._poi_bounds_cache_st(),f=g.get();if(f)return f;var e=this.poi_data_st().get();e&&alp.forEach(e,
function(d){(d=alp.data.ooi_geometry(d))&&null!=d.x&&null!=d.y&&(f||(f=new k.LatLngBounds),f.extend(new k.LatLng(d.y,d.x)))});g.set(f,!0);return f},_tour_bounds_cache_st:alp.memM("_tour_bounds_cache_st","new alp.State()"),_poi_bounds_cache_st:alp.memM("_poi_bounds_cache_st","new alp.State()")})});"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.cheap");
(function(){function k(b,a,d,e){d*=b[0]-a[0];b=(b[1]-a[1])*e;return d*d+b*b}function h(b,a,d,e){return Math.sqrt(k(b,a,d,e))}function g(b){return d.distance_xy(b,[b[0]+.01,b[1]])/.01}function f(b){return d.distance_xy(b,[b[0],b[1]+.01])/.01}var e=alp.sub("alp.maps.cheap",null,!0),d=alp.maps.geodesic,b=alp.util;e.square_distance=k;e.distance=h;e.lng2m_at=g;e.lat2m_at=f;e.polyline_length=function(b,a,d,e){var c=e&&e.cumul;if(!(b&&0<b.length))return c?null:0;e=b[0];null==a&&(a=g(e));null==d&&(d=f(e));
e=0;b="string"===typeof b[0][0]?alp.map(b,"alp.map(v, parseFloat)"):b;var l=b.length;if(c){c=Array(l);c[0]=0;for(var m=1,p=b[0];m<l;++m){var k=b[m];c[m]=e+=h(p,k,a,d);p=k}return{length_meter:e,cumul:c}}m=1;for(p=b[0];m<l;++m)k=b[m],e+=h(p,k,a,d),p=k;return e};e.polyline_length_gravitycenter=function(b,a,d,e){if(!(b&&0<b.length))return{length:0};var c=b[0];null==a&&(a=g(c));null==d&&(d=f(c));var l=c=0,m=0;b=e?alp.map(b,"alp.map(v, parseFloat)"):b;for(e=b.length-1;e--;){var p=b[e],h=b[e+1],k=p[0];p=
p[1];var t=h[0];h=h[1];var w=(t-k)*a,x=(h-p)*d;w=Math.sqrt(w*w+x*x);c+=w;l+=w*(k+t);m+=w*(p+h)}return{length:c,polygrav_x:l/(2*c),polygrav_y:m/(2*c)}};e.dlatlngmax=function(c,a){var e={},l=c[0],f=c[1],g=[0,f];e.dlat_max=e.dy_max=-f+b.dichotomy(a,f,90,function(a){return d.distance_xy(c,[l,a])});e.dlng_max=e.dx_max=-l+b.dichotomy(a,0,180,function(a){return d.distance_xy(g,[a,f])});return e}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cheap");
(function(){var k=alp.sub("alp._gmap2_3",null,!0),h=alp.maps.cheap;k.cheap_square_distance=h.square_distance;k.cheap_distance=h.distance;k.cheap_lng2m_at=h.lng2m_at;k.cheap_lat2m_at=h.lat2m_at;k.cheap_polyline_length=h.polyline_length;k.cheap_polyline_length_gravitycenter=h.polyline_length_gravitycenter;k.dlatlngmax=h.dlatlngmax})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.view.overlays");
alp.gmap3(function(k){var h={};alp.declare("alp._gmap2_3.view.Overlays",null,function(g){function f(d){alp.m(d,["change_cb","changed_cb"],function(){e.update()})}var e=this;alp.mix(e,g);alp.forEach(["map","data","ovgen"],function(d){if(!e[d])throw Error('alp._gmap2_3.view.Overlays.constructor(): missing mandatory field "'+d+'"');});e.visibleDataSt=new alp.ObjectState({do_not_clone:!0});e.hideSt=new alp.ObjectState({do_not_clone:!0});e._viewObj={};f(e.map);f(e.data);e.hideSt.change_cb("update",e,{mapOnly:!0});
e.update()},{map:null,data:null,ovgen:null,delay_ms_max:250,setVisible:alp.nowF(function(g,f,e){g.substring.call.a;f.substring.call.a;this.hideSt.set_property([g,f],!e)}),fetchOvFromId:function(g){var f=this._viewObj,e;for(e in f)if(!(e in h)){var d=f[e].ov;if(d&&"_alpid"in d&&d._alpid==g)return d}return!1},ovForEach:function(g){alp.forIn(this._viewObj,function(f){g(f.ov,f.ovdata.id)})},viewChangeEvt:alp.memM("viewChangeEvt",'alp.event("AGV:overlays:viewChangeEvt",{then:1})'),_getMap:function(){return this._get(this.map)},
_getData:function(){return this._get(this.data)},_get:function(g){return"function"===typeof g?g():g.get()},update:alp.nowF(function(g){function f(){var b=d.hideSt.get(),c;for(c in n)if(!(c in h)){var e=n[c],l=e.ovdata;e=e.ov;var f=!0;if(b)for(var m in b)if(!(b in h)){var g=b[m],r=l[m];r in g&&(f=f&&!g[r])}l=f&&a||null;e.getMap()!==l&&e.setMap(l)}}var e=g&&g.mapOnly,d=this,b=(Date.now?Date.now():+new Date)+d.delay_ms_max,c=alp.asyncF(d.delay_ms_max,"update",d),a=d._getMap(),m=d._getData(),l=d.visibleDataSt,
r,n=d._viewObj;(function(){a&&(r=!l.is(m));if(!e&&a&&r){var g={};m&&alp.forEach(m,function(a){g[d._hashKey(a)]=a});for(var p in n)if(!(p in g)){var h=n[p].ov;h.setMap(null);delete n[p];if((Date.now?Date.now():+new Date)>b){c();return}}var k=!0;for(p in g)if(!(p in n)){var t=g[p];h=d.ovgen(t);if(!h){k=!1;return}h._alpid=t.id;n[p]={ov:h,ovdata:t};if((Date.now?Date.now():+new Date)>b){c();return}}f();k&&l.setNow(m)}else f()})();this.viewChangeEvt().triggerSoon()}),_hashKey:function(g){if(!("id"in g&&
g.id)){var f=g.coordinates;if(f&&400<f.length&&1<f[0].length){var e=alp.oKeys(g);e.push(f.length);e=e.concat(alp.oToString(f.slice(0,200).concat(f.slice(f.length-200,f.length))));e.push(f[f.length>>1]);return e.join("#")}return alp.oToString(g)}e=[g.id];e=e.concat(alp.oKeys(g));f=alp.oGet(g,"encPolyline.points");e.push(f&&f.length);f=alp.oGet(g,"coordinates");e.push(f&&f.length);f&&(e=e.concat(f.slice(0,10)));f&&10<f.length&&(e.push(f[f.length>>1]),e=e.concat(f.slice(f.length-10,f.length)));return e.join("#")}})});
"undefined"!==typeof dojo&&dojo.provide("alp.util.bits");
(function(){function k(d){var b=[],c=d.length,a=c%3;c-=a;for(var e=0;e<c;){var l=d[e++]<<16|d[e++]<<8|d[e++];b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>18&63));b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>12&63));b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>6&63));b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l&63))}switch(a){case 2:l=d[e++]<<
16|d[e++]<<8;b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>18&63));b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>12&63));b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>6&63));b.push("=");break;case 1:l=d[e++]<<16,b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>18&63)),b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>
12&63)),b.push("="),b.push("=")}return b.join("")}function h(d){d=d.split("");for(var b=[],c=d.length;"="==d[--c];);for(var a=0;a<c;){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[a++])<<18;a<=c&&(e|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[a++])<<12);a<=c&&(e|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[a++])<<6);a<=c&&(e|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[a++]));
b.push(e>>>16&255);b.push(e>>>8&255);b.push(e&255)}for(;0==b[b.length-1];)b.pop();return b}function g(d,b,c){if(!c){if(0<alp.filter(d,function(a){return"number"!==typeof a&&Math.round(a)===a}).length)return console.error("alp.util.bitsPack: all must be integers"),0;var a=Math.pow(2,b)-1;if(0<alp.filter(d,function(b){return 0>b||b>a}).length)return console.error("alp.util.bitsPack: all integers must lie between 0 and (2^width)-1"),0}var f=new e.BOutputStream;alp.forEach(d,function(a){f.putBits(a,b)});
d=f.getWidth();return{buffer:f.getBuffer(),width:d}}function f(d,b){var c=[];for(d=new e.BInputStream(d.buffer,d.width);d.getWidth()>=b;)c.push(d.getBits(b));return c}var e=alp.sub("alp.util",null,!0);e.b64Encode=k;e.b64Decode=h;e.b64mEncode=function(d){return k(d).replace(/\+/g,"~").replace(/\//g,"-").replace(/=/g,"_")};e.b64mDecode=function(d){return h(d.replace(/_/g,"=").replace(/\-/g,"/").replace(/~/g,"+")+"=")};alp.declare("alp.util.BOutputStream",null,function(){this.reset()},{reset:function(){this.buffer=
[];this.accumulator=0;this.available=8},putBits:function(d,b){for(;b;){var c=Math.min(b,this.available);this.accumulator|=(c<=b?d>>>b-c:d)<<this.available-c&255>>>8-this.available;this.available-=c;this.available||(this.buffer.push(this.accumulator),this.accumulator=0,this.available=8);b-=c}},getWidth:function(){return 8*this.buffer.length+(8-this.available)},getBuffer:function(){var d=this.buffer;8>this.available&&d.push(this.accumulator&255<<this.available);this.reset();return d}});alp.declare("alp.util.BInputStream",
null,function(d,b){this.buffer=d;this.width=b;this.bbyte=this.bit=0},{getBits:function(d){for(var b=0;d;){var c=Math.min(d,8-this.bit),a=this.buffer[this.bbyte]>>>8-this.bit-c;b<<=c;b|=a&~(-1<<c);this.bit+=c;8==this.bit&&(++this.bbyte,this.bit=0);d-=c}return b},getWidth:function(){return this.width-8*this.bbyte-this.bit}});e.IAWSEPARATOR=".";e.iawEncode=function(d,b,c,a){b||(b=e.b64mEncode);null==c&&(c=0,alp.forEach(d,function(a){c=Math.max(c,1+Math.floor(Math.log(Math.max(1,a))/Math.log(2)))}));
if(c>>16)return console.error("alp.util.iawEncode: I cannot deal with i_width > 65535 !!! i_width:",c),"";d=g(d,c,a);return d.width>>16?(console.error("alp.util.iawEncode: I cannot deal with bw.width > 65535 !!! bw.width:",d.width),""):b([d.width>>8&255,d.width&255])+e.IAWSEPARATOR+b([c>>8&255,c&255])+e.IAWSEPARATOR+b(d.buffer)};e.iawDecode=function(d,b){b||(b=e.b64mDecode);var c=d.split(e.IAWSEPARATOR);if(3!==c.length)return console.error("alp.util.iawDecode(): wrong format for this string:",d),
[];var a=b(c[0]);d=(a[0]<<8)+a[1];a=b(c[1]);a=(a[0]<<8)+a[1];b=b(c[2]);return f({buffer:b,width:d},a)};e.iaPack=g;e.iaUnpack=f;e.nbit=function(d){if("number"!==typeof d)console.error("alp.util.nbit() expects a number for n, you gave me:",d);else return 1+Math.floor(Math.log(Math.max(1,d))/Math.log(2))};e.reverse_bit=function(d,b){if("number"!==typeof d)console.error("alp.util.reverse_bit() expects a number for x, you gave me:",d);else if("number"!==typeof b)console.error("alp.util.reverse_bit() expects a number for nbit, you gave me:",
b);else{for(var c=d&~((1<<b)-1),a=0;a<b;a++)d&1<<b-1-a&&(c|=1<<a);return c}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.view.directionarrow");
alp.gmap3(function(k){var h=alp._gmap2_3,g=alp.util;alp.declare("alp._gmap2_3.view.DirectionArrow",null,function(f){var e=this;alp.mix(e,f);e.is_visible_st||(e.is_visible_st=new alp.BoolState({init_value:!0}));alp.forEach(["map_st","tour_data_st"],function(d){if(!e[d])throw Error('alp._gmap2_3.view.DirectionArrow.constructor(): missing mandatory field "'+d+'"');});e._={z_st:new alp.State,spot_all_st:new alp.ObjectState,spot_extent_st:new alp.ObjectState,visible_st:new alp.ObjectState};e._.markerView=
new h.view.Overlays({map:e.map_st,data:e._.spot_extent_st,ovgen:alp.bindF("_ovgen",e)});e.map_st.change_cb("_on_map_change",e);e.is_visible_st.change_cb("_on_map_change",e);e.tour_data_st.change_cb(function(){e._update_spot_all()});e._.z_st.change_cb(function(){e._update_spot_all(!0)});e._.spot_all_st.change_cb("_update_spot_extent",e);e._update_spot_all=alp.ratelimitF(Math.abs(e.delay_ms_max),"_update_spot_all",e);e._update_spot_extent=alp.ratelimitF(Math.abs(e.delay_ms_max),"_update_spot_extent",
e)},{map_st:null,tour_data_st:null,is_visible_st:null,delay_ms_max:137,arrow:alp.cfg.marker.arrow,arrowType:null,getMap:function(){return this.map_st.get()},setMap:function(f){this.map_st.set(f)},isVisible:function(){return this.is_visible_st.get()},setVisible:function(f){this.is_visible_st.setNow(f)},_on_map_change:function(){var f=this,e=f.is_visible_st.get()&&f.map_st.get(),d=f._ehmap();d.clear();e&&(d.push(h.event("addListener")(e,"bounds_changed",function(){f._.z_st.setNow(e.getZoom());f._update_spot_extent()}),
h.event("removeListener")),d.push(h.event("addListener")(e,"projection_changed",function(){f._update_spot_all()}),h.event("removeListener")),f._update_spot_all())},_ehmap:alp.memM("_ehmap","new alp.Eh()"),_update_spot_all:alp.nowF(function(f){var e=this.map_st.get(),d=h.getProjection(e);e=alp.m(e,"getZoom");var b=!(d&&"number"===typeof e),c=this._.spot_all_st;if(!f||b)this._.tour_coord=null,c.unset();if(!b){f=100*(2*h.earth_radius()*Math.PI/h.getWrapWidth(d,e));var a=this.tour_data_st.get();c=c.get()||
{};b=c[e];if(a&&!b){b=[];if(!this._.tour_coord){var m=a.length;for(this._.tour_coord=Array(m);m--;){var l=a[m];this._.tour_coord[m]=l.isStagesTour?alp.arrChain(alp.map(l.stageTours,"this( alp.oFrom( v.geoJson ) )",function(a){return h.util.coord.tour(a,!0)})):h.util.coord.tour(l,!0)}}l=(Date.now?Date.now():+new Date)+this.delay_ms_max;var r=this.delay_ms_max/2;for(m=a.length;m--;){a=this._.tour_coord[m];var n=Math.max(1,Math.round(Math.min(a.length/1E3))),q=null,p=Math.max,k=h.xy2latlng,u=h.fromLatLngToPixel,
t=0,w=g.reverse_bit(e,5)/32,x=w*f,y=w*f;w=1-.8;for(var z=null,A=null,C=0,E=a.length;C<E;C+=n){var G=a[C];if(!(B&&I&&t++%100)){var B=h.cheap_lng2m_at(G);var I=h.cheap_lat2m_at(G)}if(q){var L=(G[0]-q[0])*B;q=(G[1]-q[1])*I;null==z||null==A?(z=L,A=q):(z=.8*z+w*L,A=.8*A+w*q);x+=L;y+=q;p(x,y)>f&&(x=u(d,k(G),e),b.push({xy:G,pix:{x:x.x,y:x.y},angle:Math.atan2(A,z)}),x=y=0);q=G;!(C%100)&&l-(Date.now?Date.now():+new Date)<r&&(n<<=2,r>>=1)}else q=G}}c[e]=b;this._.spot_all_st.set(c)}}}),_update_spot_extent:alp.nowF(function(){var f=
[],e=this._.spot_all_st.get()||[],d=this.map_st.get(),b=alp.m(d,"getZoom"),c=alp.m(d,"getBounds");d=alp.m(d,"getProjection");if(c&&d&&"number"===typeof b){e=e[b]||[];var a=h.fromLatLngToPixel(d,c.getSouthWest(),b);d=h.fromLatLngToPixel(d,c.getNorthEast(),b);b=a.x;c=d.x;d=d.y;a=a.y;for(var m=e.length;m--;){var l=e[m],g=l.pix,n=g.x;g=g.y;b<=n&&n<=c&&d<=g&&g<=a&&f.push(l)}}this._.spot_extent_st.set(f)}),_ovgen:function(f){var e=this.arrow(f.angle,this.arrowType),d=e.url,b=new k.Size(e.xy[0],e.xy[1]),
c=e.anchor_xy[0],a=e.anchor_xy[1];f=h.xy2latlng(f.xy);null==c&&(c=e.xy[0]>>1);null==a&&(a=e.xy[1]>>1);e=new k.Point(c,a);d=h.marker_gen({clickable:!1,icon:h.markerImage_gen(d,b,null,e),position:f});d._alp_no3d=!0;return d}})});"undefined"!==typeof dojo&&dojo.provide("alp.util.proto");
(function(){alp.sub("alp.util.proto",null,!0).call_method_top_down=function(k,h,g,f){f||(f=Object.getPrototypeOf);g="function"!==typeof g?g:g.call(k,k);for(var e=[],d,b,c=k;c;c=f(c))(b=c[h])&&b!==d&&e.push(d=b);if(!e.length)throw Error('Method "'+h+'" not found');for(;b=e.pop();)b.apply(k,g)}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.abstract_controller");
(function(){function k(a){a instanceof m&&a.eh.clear()}function h(a){a instanceof m&&f(a.m,"setUpdateActive","alp.x.AbstractController:_deactivateModels",!1)}function g(a){a instanceof m&&(f(a.m,"setSilent",!1),f(a.m,"setUpdateActive","alp.x.AbstractController:_activateModels",!0,!0))}function f(b,c){var d=alp.Aps.call(arguments,2),e;for(e in b)e in a||alp.m.apply(alp,[b[e],c].concat(d))}function e(b,c){for(var d in b.kx)if(!(d in a)){var l=b.kx[d];if(l){var f=c,g=void 0;l instanceof m&&(g||(g=[l,
l.eh,l.m,l.kx]),"string"===typeof f?l.callSuperThenMe(f,g):f.apply(l,g));l.kx&&e(l,c)}}}function d(a,d,e){e||(e=[a,a.eh,a.m,a.kx]);c.call_method_top_down(a,d,e,b)}function b(a){return a._alpParentProto||a.superclass}var c=alp.util.proto,a={},m=alp.declare("alp.x.AbstractController",null,function(a,b){a&&(b&&b.noCheck?alp.mix(this,a):alp.mixCheck(this,a));this.Clazz=alp.sub(this.declaredClass);this.superclass=this.Clazz.superclass;this.eh=new alp.Eh;this.m={};this.kx={};d(this,"augmentModel",[this.m]);
d(this,"augmentKids",[this.kx]);this.initNow&&this.init()},{initNow:!1,augmentModel:function(a){},augmentKids:function(a){},disconnect:function(){k(this);l(this,k)},init:function(){this.disconnect();l(this,h);h(this);alp.now(function(){l(this,"setInitVal");d(this,"setInitVal")},this);l(this,"connectModel2Model");d(this,"connectModel2Model");l(this,"connectModel2View");d(this,"connectModel2View");l(this,"connectView2Model");d(this,"connectView2Model");l(this,"connectPureView");d(this,"connectPureView");
l(this,g);g(this)},setInitVal:function(a,b,c,d){},connectModel2Model:function(a,b,c,d){},connectModel2View:function(a,b,c,d){},connectView2Model:function(a,b,c,d){},connectPureView:function(a,b,c,d){},callSuperThenMe:function(a,d){c.call_method_top_down(this,a,d,b)}}),l=alp.nowF(e);d=alp.nowF(d)})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.view.multiline");
(function(){function k(e,d){return h.marker_gen({position:e.poly.getPath().getAt(0)},this.stage_start_icon_standard_name)}var h=alp._gmap2_3;alp.declare("alp._gmap2_3.view.Multiline",alp.x.AbstractController,null,{arr:null,map:null,highlight:!0,style_normal:{strokeWeight:5},style_highlight:{strokeWeight:10},stage_start_icon:!0,stage_start_icon_standard_name:"digitize_node_start",augmentModel:function(e){var d=this;d._id2info=alp.arr2o(alp.map(d.arr,function(b,c){return alp.oCreateMix(b,{index:c})}));
e.map=new alp.State({init_value:d.map||null});e.mouseover=new alp.State({constrain_all:function(b){if(!b)return null;"string"===typeof b&&(b={id:b});null==b.index&&(b={id:b.id,index:d._id2info[b.id].index});return b}});d._name2evt=alp.mapIn({click:d.clickEvt(),mouseover:d.mouseoverEvt(),mouseout:d.mouseoutEvt()},function(b,c){return{trigger:alp.nowF(function(a){b.triggerSoon(a)}),addListener:alp.nowF(function(a){b.thenSoon(a)}),removeListener:alp.nowF(function(a){b.dropSoon(a)})}})},setInitVal:function(e,
d,b,c){e.highlight&&alp.forEach(e.arr,".poly.setOptions(this)",e.style_normal);e.stage_start_icon&&(e[g]=alp.map(e.arr,k,e),e[f]=alp.arr2o(e[g],alp.f("w"),alp.f()))},connectModel2View:function(e,d,b,c){function a(){var a=b.mouseover.get();if(f){if(a&&f.id===a.id)return;f.poly.setOptions(e.style_normal);f=null}if(a){var c=e._id2info[a.id].poly;c.setOptions(e.style_highlight);f={poly:c,id:a.id}}}d.push(b.map.change_cb_init(function(){for(var a=b.map.get()||null,c=e.arr,d=e[g],f=c.length,m=0;m<f;m++)c[m].poly.setMap(a);
if(d)for(f=d.length,m=0;m<f;m++)alp.m(d[m],"setMap",a)}));e.highlight&&d.push(b.mouseover.change_cb_init(a));var f},connectView2Model:function(e,d,b,c){alp.forEach(e.arr,function(a,c){function l(){e.clickEvt().triggerSoon(q)}function m(d){b.mouseover.set();e.mouseoutEvt().triggerSoon(q);h.event("trigger")(e,"mouseout",alp.oCreateMix(d,{alpStageIndex:c,alpId:a.id}))}function g(d){b.mouseover.set(a);e.mouseoverEvt().triggerSoon(q);h.event("trigger")(e,"mouseover",alp.oCreateMix(d,{alpStageIndex:c,alpId:a.id}))}
var q={id:a.id,index:c},p=alp.oGet(e,[f,c]);p=alp.filter([a.poly,p],"");for(var k=p.length;k--;){var u=p[k];d.push(h.event("addListener")(u,"click",alp.nowF(l)),h.event("removeListener"));d.push(h.event("addListener")(u,"mouseout",alp.nowF(m)),h.event("removeListener"));d.push(h.event("addListener")(u,"mouseover",alp.nowF(g)),h.event("removeListener"))}})},setMap:function(e){this.m.map.setNow(e)},getMap:function(){return this.m.map.get()},clickEvt:alp.memM("clickEvt",'alp.event("AGV:Multiline:clickEvt",{then:1})'),
mouseoutEvt:alp.memM("mouseoutEvt",'alp.event("AGV:Multiline:mouseoutEvt",{then:1})'),mouseoverEvt:alp.memM("mouseoverEvt",'alp.event("AGV:Multiline:mouseoverEvt",{then:1})')});var g="_stage_start_icon_arr",f="_stage_start_icon_obj"})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.remove_padding_from_bounds");
alp.gmap3(function(k){function h(f,e){return f?"number"===typeof f?f/(1+f)*e:f.match(/^([\+\-]?\d+)px$/)[1]|0:0}var g=alp.sub("alp._gmap2_3",null,!0);g.padding2pix=h;g.removePaddingFromBounds=function(f,e,d,b,c){b=alp.fVal(b);if(!f||null==e||!b)return d;c&&c.pixelOnly&&(b=alp.filterIn(b,"v  &&  v.match  &&  v.match(/px$/)"));c=d.getSouthWest();d=d.getNorthEast();var a=g.fromLatLngToPixel(f,c,e),m=g.fromLatLngToPixel(f,d,e);c=a.x;d=m.x;m=m.y;a=a.y;var l=d-c,r=a-m,n=h(b.left,l);l=h(b.right,l);var q=
h(b.top,r);b=h(b.bottom,r);b=g.fromPixelToLatLng(f,new k.Point(c+n,a-b),e);f=g.fromPixelToLatLng(f,new k.Point(d-l,m+q),e);return new k.LatLngBounds(b,f)}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.controllers.link_map_bounds_and_elpro_bounds");
alp.gmap3(function(k){var h=alp.sub("alp._gmap2_3.digitize.controllers",null,!0),g=alp._gmap2_3;h.link_map_bounds_and_elpro_bounds=function(f,e,d,b){if(e&&d){var c=alp.ratelimitF(777,function(){var a=e.getBounds();a&&(a=g.removePaddingFromBounds(g.getProjection(e),e.getZoom(),a,b&&b.mapPadding,{pixelOnly:!0}),d.fitBounds(a))});f.push(g.event("addDomListener")(e,"mouseup",c),g.event("removeListener"));f.push(alp.aEL(e.getDiv(),"mousewheel",alp.asyncF(189,c),!0));var a=alp.ratelimitF(777,function(){var a=
d.getBounds(k);a&&g.set_bbox(e,a,alp.fVal(b&&b.mapPadding))});f.push(d.mouseZoomEvt().thenSoon(a));f.push(d.mouseDragEvt().thenSoon(a));f.push(d.mouseDropEvt().thenSoon(a));f.push(d.touchPinchEvt().thenSoon(a));return{update_elpro_bounds_from_map_bounds:c,update_map_bounds_from_elpro_bounds:a}}}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.abstractpolylinemodel");
alp.gmap3(function(k){function h(d,b){d.triggerSoon.apply(d,b)}var g=alp._gmap2_3,f=alp.util,e={};alp.declare("alp._gmap2_3.digitize.AbstractPolylineModel",null,alp.nowF(function(){if("alp._gmap2_3.digitize.AbstractPolylineModel"===this.declaredClass)throw Error("You can only instantiate classes that derive from alp._gmap2_3.digitize.AbstractPolylineModel");this.geomChangeEvt().then(alp.bindF("_clear_piecesCache",this));this.zChangeEvt&&this.zChangeEvt().then(alp.bindF("_clear_piecesCache",this));
this.node_to_highlight_st=new alp.State;this.node2_to_highlight_st=new alp.State;this.no_ghost_latlng_st=new alp.State;this.default_is_manual_st=new alp.BoolState;this.nextleg_to_highlight_st=new alp.State}),{PIECE_MAX_LENGTH:100,HASH_PIECE_REDUCED_LENGTH:10,node_to_highlight_st:null,node2_to_highlight_st:null,nextleg_to_highlight_st:null,no_ghost_latlng_st:null,default_is_manual_st:null,getLength:function(){if(null==this._length)try{for(var d=this.getPieces(),b=0,c=d.length;c--;){var a=d[c];b+="length_meters"in
a?a.length_meters:a.length_meters=g.pathLength(a.gll_arr)}this._length=b}catch(m){this._length=0}return this._length},has_hash:function(d){return d&&!!this.hash2piece(d)},hash2piece:function(d){if(d){if(this._hash2pieceCache)return this._hash2pieceCache[d];for(var b=this.getPieces(),c=b.length;c--;){var a=b[c];if(a&&a.hash===d)return a}}},_clear_piecesCache:function(){if(this._piecesCache){var d,b;for(d=this._piecesCache.length;d--;){var c=this._piecesCache[d];for(b in c)c.hasOwnProperty(b)&&(c[b]=
null)}}this._hash2pieceCache=this._piecesCache=null},getPieceInfoArrForSegment:function(d){for(var b=this.getPieces(),c=[],a=b.length,e=0;e<a;e++){var l=b[e],g=l.seg_ind,n=g.length-1;if(!(d>g[n])){if(d<g[0])break;g=f.sortedsearch(d,g);g.piece=l;g.first===g.last&&g.last<n&&g.last++;c.push(g)}}return c},getPieces:function(){function d(c,d,l,f){if(c&&1<c.length){var m=g.latlng2xy(c);var n=0;var p=c.length;if(l)for(var q=Math.log(1/70300),h=p;h--;){var r=c[h];n||(n=1+h/p);n*=Math.log(Math.abs((95+r.lat())*
(185+r.lng())*(1+(r.z&&r.z()||0))))+q;h%10||(r=Math.abs(n),1E-10>r?n*=1E10:1E10<r&&(n*=1E-10))}else{q=Math.min(p,b.HASH_PIECE_REDUCED_LENGTH);n=Array(q);h=q;for(--q;h--;)r=c[(p-1)*h/q>>0],n[h]=r+"z:"+(r.z?r.z():"");n=n.join(",")}p=c.length;p="n:"+p+".."+n+".."+alp.map([c[0],c[p>>1],c[p-1]],'v + "z:" + (v.z ? v.z() : "")').join(".");m={gll_arr:c,xy_arr:m,hash:p};m.seg_ind="number"===typeof d?alp.arrRep([d],m.gll_arr.length):d;m.gll_arr.length!==m.seg_ind.length&&console.error(b.declaredClass+".getPieces(): _append(): o.gll_arr.length and o.seg_ind.length must match!");
m.is_manual=l;d=this._hash2boundsCache||(this._hash2boundsCache={});m.bounds=m.hash in d?d[m.hash]:d[m.hash]=g.bounds_fromPath(c);d=m.bounds.getCenter();c=d.lat();d=d.lng();h=m.bounds.toSpan();p=h.lat()/2*1.25;h=h.lng()/2*1.25;m.bounds_buffer=new k.LatLngBounds(new k.LatLng(c-p,d-h),new k.LatLng(c+p,d+h));c=m.hash in e?e[m.hash]:e[m.hash]=g.pathCumLength(m.gll_arr);d=c.total;d.toPrecision.call.a;m.dArr=c;m.d=d;m.piece_ind=a.length;l||(m.routed_seg_info=f);a.push(m)}}var b=this,c=b.PIECE_MAX_LENGTH;
if(!b._piecesCache){var a=[];var f={nodes:[],seg_indices:[]};for(var l=0,h=b._segments||b.getSegments(),n=h.length;l<n;l++){var q=h[l],p=!q,v=b._nodes[l];null==f.is_manual&&(f.is_manual=p);f.is_manual===p&&f.nodes.length<c?p?(f.nodes.push(v),f.seg_indices.push(l)):(p=f.nodes.length,f.nodes=f.nodes.concat(q.vertices),f.seg_indices.push.apply(f.seg_indices,alp.arrRep([l],q.vertices.length)),q=f.nodes.length,(f.routed_seg_info||(f.routed_seg_info={}))[l]={i_start:p,i_end:q,n:q-p}):(f.nodes.length&&(f.nodes.push(v),
f.seg_indices.push(l),d(f.nodes,f.seg_indices,f.is_manual,f.routed_seg_info)),p||(f={},f[l]={i_start:0,i_end:q.vertices.length,n:q.vertices.length},d(q.vertices,l,p,f)),f={nodes:q?[]:[v],seg_indices:q?[]:[l],is_manual:p})}!h[l]&&b._nodes[l]&&(f.nodes.push(b._nodes[l]),f.seg_indices.push(l));d(f.nodes,f.seg_indices,f.is_manual,f.routed_seg_info);b._piecesCache=a;b._hash2pieceCache={};for(l=a.length;l--;)h=a[l],b._hash2pieceCache[h.hash]=h}c=Array(b._piecesCache.length);for(l=c.length;l--;)h=b._piecesCache[l],
c[l]={gll_arr:h.gll_arr,xy_arr:h.xy_arr,seg_ind:h.seg_ind,dArr:h.dArr,d:h.d,hash:h.hash,is_manual:h.is_manual,bounds:h.bounds,bounds_buffer:h.bounds_buffer,piece_ind:h.piece_ind,routed_seg_info:!h.is_manual&&h.routed_seg_info};h=c.length;n=0;f=Array(h);for(l=0;l<h;l++)f[l]=n,n+=c[l].d;c.d=n;c.cum_d=f;return c},findNodesForBounds:function(d){for(var b=this.getNodes(),c=b.length,a={nodes:[],indexes:[]},e=0;e<c;e++)d.contains(b[e])&&(a.indexes.push(e),a.nodes.push(b[e]));return a},getHeightForD:function(d){var b=
this.getPieces();if(!(0<=d&&d<=b.d))return null;b=this.getWhereD(d);var c=b.piece,a=b.where.ind0,e=b.where.ind1,l=b.d_start;b=c.dArr[a];var f=c.dArr[e];e=c.gll_arr[e];c=alp.m(c.gll_arr[a],"z");a=alp.m(e,"z");d-=l;if(alp.and([d,b,f,c,a],"!=null")&&b<f&&b-1E-5<d&&d<f+1E-5)return alp.interpolate(c,a,(d-b)/(f-b))},getIndexForD:function(d){var b=this.getPieces();if(!(0<=d&&d<=b.d))return null;var c=this.getWhereD(d),a=c.piece;b=a.seg_ind[c.where.ind0];var e=f.sortedsearch(b,a.seg_ind),l=c.d_start+a.dArr[e.first];
c=c.d_start+a.dArr[e.last];return b+Math.max(0,Math.min(1,l<c?(d-l)/(c-l):0))},getWhereD:function(d){var b=this.getPieces();d=f.arrSoftIndex(b.cum_d.concat(b.d+1E-7),d);var c=d.v0,a=b[d.ind0],e=f.arrSoftIndex(a.dArr,d.prop*a.d);return{pieces:b,topwhere:d,d_start:c,piece:a,where:e}},getXYZD:function(d){var b=this.getPieces();if(b.length){d=Math.max(0,Math.min(b.d,d));var c=this.getWhereD(d);d=c.d_start;b=c.piece;c=c.where;var a=b.dArr,e=c.ind0,l=c.ind1,f=b.gll_arr[e];b=b.gll_arr[l];if(!b)return[f.lng(),
f.lat(),alp.m(f,"z"),d+a[e]];d=alp.interpolate([f.lng(),f.lat(),alp.m(f,"z"),d+a[e]],[b.lng(),b.lat(),alp.m(b,"z"),d+a[l]],c.prop);d.x=d[0];d.y=d[1];d.z=d[2];d.d=d[3];return d}},onGeomChange:alp.nowF(function(d,b){h(this.geomChangeEvt(),arguments)}),geomChangeEvt:alp.memM("geomChangeEvt",'alp.event("APM:geomChangeEvt",{then:1})'),onGeomClear:alp.nowF(function(d){h(this.geomClearEvt(),arguments)}),geomClearEvt:alp.memM("geomClearEvt",'alp.event("APM:geomClearEvt",{then:1})'),onUpdateNode:alp.nowF(function(d,
b,c,a){h(this.updateNodeEvt(),arguments)}),updateNodeEvt:alp.memM("updateNodeEvt",'alp.event("APM:updateNodeEvt",{then:1})'),onUpdateNodeArray:alp.nowF(function(d,b,c,a){h(this.updateNodeArrayEvt(),arguments)}),updateNodeArrayEvt:alp.memM("updateNodeArrayEvt",'alp.event("APM:updateNodeArrayEvt",{then:1})'),onDeleteNodes:alp.nowF(function(d,b,c,a){h(this.deleteNodesEvt(),arguments)}),deleteNodesEvt:alp.memM("deleteNodesEvt",'alp.event("APM:deleteNodesEvt",{then:1})'),onInsertNodes:alp.nowF(function(d,
b,c){h(this.insertNodesEvt(),arguments)}),insertNodesEvt:alp.memM("insertNodesEvt",'alp.event("APM:insertNodesEvt",{then:1})'),onReverse:alp.nowF(function(d){h(this.reverseEvt(),arguments)}),reverseEvt:alp.memM("reverseEvt",'alp.event("APM:reverseEvt",{then:1})')})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.abstract_nearest_finder");
alp.declare("alp._gmap2_3.digitize.AbstractNearestFinder",null,function(k){if("alp._gmap2_3.digitize.AbstractNearestFinder"===this.declaredClass)throw Error("You must write your own class, which inherits from alp._gmap2_3.digitize.AbstractNearestFinder");k.getPieces.call.a},{update:function(){throw Error("You must implement: alp._gmap2_3.digitize.AbstractNearestFinder.update()");},queryNearestPoint:function(k,h){throw Error("You must implement: alp._gmap2_3.digitize.AbstractNearestFinder.queryNearestPoint()");
}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.xy_nearest_finder");
alp.gmap3(function(k){alp.declare("alp._gmap2_3.digitize.XYNearestFinder",alp._gmap2_3.digitize.AbstractNearestFinder,function(h){this._model=h;this.update()},{update:function(){},queryNearestPointAll:function(h,g,f){var e=this,d=null,b=Infinity;f=f&&f.mouseover;g||(g=e._model.getPieces());f&&(f=alp.filter(g,".bounds.contains(this)",h),f.length||(f=alp.filter(g,".bounds_buffer.contains(this)",h)),f.length&&(g=f));alp.forEach(g,function(c){c=e.queryNearestPoint(h,c);var a=alp.opt(c,1);a=alp.m(a,"distanceFrom",
h);null!=a&&a<b&&(d=c,b=a)});return d},queryNearestPoint:function(h,g){g=alp.mix({},g);g=this._model.hash2piece(g.hash);if(g&&g.gll_arr&&0<g.gll_arr.length){var f=g.gll_arr;if(2>f.length)var e=f[0];else{h=[h.lng(),h.lat()];f=g.xy_arr;for(var d=f.length-1;d--;){var b=f[d],c=f[d+1];c=[c[0]-b[0],c[1]-b[1]];var a=[h[0]-b[0],h[1]-b[1]];a=Math.max(0,Math.min(1,(c[0]*a[0]+c[1]*a[1])/(c[0]*c[0]+c[1]*c[1])));b={k:d,t:a,xy:[b[0]+a*c[0],b[1]+a*c[1]]};c=h[0]-b.xy[0];a=h[1]-b.xy[1];b.d2=c*c+a*a;alp.isFiniteNumber(b.d2)&&
(!e||b.d2<e.d2)&&(e=b)}if(h=e&&[Math.min(g.seg_ind[e.k],g.seg_ind[e.k+1]),new k.LatLng(e.xy[1],e.xy[0]),e.k,e.t,g])h.seg_ind=h[0],h.latlng=h[1],h.ind=e.k,h.prop=e.t,h.piece=g;e=h}}else e=void 0;return e}})});"undefined"!==typeof dojo&&dojo.provide("alp.cfg.css");(function(){alp.sub("alp.cfg",null,1).css={cssClickable:"alp-x-clickable",cssHover:"alp-x-hover",cssHoverable:"alp-x-hoverable",cssStageLabel:"alp-tpl-stage-line-label",cssStageStart:"alp-gr-elpro-stage-start"}})();
"undefined"!==typeof dojo&&dojo.provide("alp.cfg.color");(function(){alp.sub("alp.cfg",null,!0).color={hover:alp.memF('{ radiuspixel  : 32,fillColor     : "rgb(173, 216, 230)", fillOpacity   : 0.5, strokeColor   : "rgb(173, 216, 230)", strokeOpacity : 0.8 }'),highlight:alp.memF('{ radiuspixel  : 32,fillColor: "#ffffff", fillOpacity: 0 /*right now not used*/, strokeColor: "#dc2017", strokeOpacity: 0.85, strokeWeight: 5 }')}})();"undefined"!==typeof dojo&&dojo.provide("alp.util.math.center_zoom");
(function(){function k(g,f,e,d){return e===d?g:g+(-.5+f)*(Math.pow(2,-e)-Math.pow(2,-d))}var h=alp.sub("alp.util.math",null,!0);h.center_after_zoom=k;h.center_after_zoom_no_overflow=function(g,f,e,d){g=k(g,f,e,d);d=Math.pow(2,-1-d);return Math.max(d,Math.min(1-d,g))};h.left_right_center_zoom=function(g,f,e,d,b){alp.and([g,f,e,d],".toPrecision.call.a");if(g>f)throw Error("alp.util.math.left_right_center_zoom: left must be <= right");if(0>e||1<e)throw Error("alp.util.math.left_right_center_zoom: center must be within 0.0 ... 1.0");
if(0>d)throw Error("alp.util.math.left_right_center_zoom: zoom must be >= 0");var c=f-g,a=g+e*c,m=c*Math.pow(2,-d),l=m/2;d=a-l;c=a+l;e=d;var h=c;b&&b.clamp&&(e=Math.max(g,Math.min(f,d)),h=Math.max(g,Math.min(f,c)),a=(e+h)/2,m=h-e,l=m/2);return{left:e,right:h,center:a,span:m,halfspan:l}}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.elpro_model");
(function(){function k(a){var b=a.polyModel.getPieces();b=b&&alp.map(b,g).join("###");a.m.elproHash.set(b)}function h(a){a.m.attrSorted.set(alp.arrSorted(a.polyModel.attributes.get("waytype"),"v.from < w.from ? -1 : v.from > w.from ? +1 : v.to < w.to ? -1 : +1"))}function g(a){return a.hash+"###seg_ind"+a.seg_ind[0]+"_"+a.seg_ind.slice(-1)[0]}function f(a){var b=a.polyModel.getPieces(),c=[];if(b)for(var d=[],e=b.length,l=0;l<e;l++){var f=b[l],m=g(f);if(m in q)c.push(f=q[m]);else{for(var n=[].concat(f.gll_arr),
p=[].concat(f.seg_ind),h=n.length,r=[].concat(f.dArr),k=Array(h),v=!0,J=[],P=0;P<h;P++){var H=n[P];H=H&&H.z&&H.z.call&&H.z();"number"===typeof H&&!isNaN(H)&&isFinite(H)?k[P]=H:(k[P]=null,v=!1,J.push(P))}n=alp.arr2oSimple(J);f.d.toPrecision.call.a;f={piece:f,n:h,seg_ind:p,is_manual:f.is_manual,first_seg_ind:p[0],last_seg_ind:p[p.length-1],routed_seg_info:f.routed_seg_info,dArr:r,zArr:k,all_z:v,missing_z_ind_set:n,d:f.d,hvArr:alp.filter(alp.zip(r,k),"!(i in this)",n)};c.push(f);v&&(q[m]=f)}f=f.piece;
m=f.stageIndex;null!=m&&((v=d[d.length-1])&&v.stageIndex===m?(v.piece_index.push(l),v.d+=f.d):d.push({piece_index:[l],d:f.d,stageIndex:m}))}if(e=b&&b.cum_d)c.cum_d=[].concat(e);e&&d.length&&(c.stageInfoArr=alp.map(d,"alp.mix(v,{start : this[ v.piece_index[ 0 ] ]})",e));c.d=b.d;c.all_z=alp.and(c,".all_z");a.m.dzInfoArr.set(c)}function e(a){a=a.m;var b=a.restrictedHV.get(),c=a.center.get(),d=a.zoom.get(),e=b&&null!=c&&null!=d;a.visible.set(e?n.left_right_center_zoom(b.left_meters,b.right_meters,c,d,
{clamp:!0}):null);a.hasData.set(e)}function d(a){function b(a,b,c){a=a.start;var d=alp.oGet(c,[b-1,"start"]);b=alp.oGet(c,[b+1,"start"]);return p<=a&&a<=q||p<=d&&d<=q||p<=b&&b<=q}function c(a,b){var c=h+(1>b?0:f[b-1]),d=a.hvArr,e=d.length;b=Array(e);for(var l=e;l--;){var m=d[l];b[l]=[m[0]+c,m[1]]}if(!a.is_manual){l=a.routed_seg_info;c=[];for(d=a.first_seg_ind;d<=a.last_seg_ind;d++)(e=l[d])&&1<e.n&&c.push(b.slice(e.i_start,e.i_end));return c}a=e-1;c=[];if(0<a)for(c=Array(a),l=0;l<a;l++)c[l]=[b[l],
b[l+1]];return c}a=a.m;var d=a.dzInfoArr.get()||[],e=d.length,l=e-1,f=alp.map(d,"this.cum_d += v.d",{cum_d:0}),m=a.restrictionLeft.get(),g=a.restrictionRight.get(),n=f.slice(-1)[0],p=Math.max(0,Math.min(n,m)),q=Math.max(0,Math.min(n,g));g=[0].concat(f);for(m=Math.min(l,r.arrSoftIndex(g,p).ind0);0<m&&d[m-1].seg_ind.slice(-1)[0]===d[m].seg_ind[0];)m--;g=Math.min(l,r.arrSoftIndex(g,q).ind0);l=null;if(-1<m&&-1<g&&m<=g&&g<e&&d[m].hvArr.length&&d[g].hvArr.length){var h=(d[m-1]||{d:0}).d-p;l=alp.arrChain(alp.map(d.slice(m,
g+1),c));l.delta_seg_ind=d[m].seg_ind[0];l.left_meters=0;l.right_meters=q-p}d=d.stageInfoArr;l&&d&&(l.stageInfoArr=alp.filter(d,b));a.restrictedHV.set(l)}function b(a){a=a.m;var b=a.restrictedHV.get(),c=a.visible.get();a.isDraggable.set(b&&c&&b.left_meters+1E-7<c.left&&c.left<c.right&&c.right+1E-7<b.right_meters)}function c(a){alp.m(a[p],"disconnect");a[p]=alp.orState(a.m.canvasFriends.get());a[p].bind_to(a.m.mouseWithinCanvasFriends)}function a(a){function b(a){var b=Math.floor(a);a-=b;if(!(b in
m&&b in g)){var l;if(b in m)var f=m[b];else{for(;(l=d[M])&&l.last_seg_ind<b;)M++;if(l){var n=M in e?e[M]:e[M]=c(l.seg_ind);n=n.search(b);f=m[b]=d.cum_d[M]+l.dArr[n.first];f.toPrecision.call.a}else f=m[b]=d.d}var p=b+1,q=M;if(p in m)l=m[p];else{for(;(l=d[q])&&l.last_seg_ind<p;)q++;l?(n=q in e?e[q]:e[q]=c(l.seg_ind),n=n.search(p),l=m[p]=d.cum_d[q]+l.dArr[n.first],l.toPrecision.call.a):l=m[p]=d.d}g[b]=l-f}return m[b]+a*g[b]}function c(a){return new r.SortedDataSearcher(a.length,function(b,c){b=a[b];
return b<c?-1:b>c?1:0},function(b,c){return a[b]===c})}a=a.m;var d=alp.m(a.dzInfoArr,["_get_no_clone","get"]);if(d&&d.length){var e={},l=d[0].first_seg_ind,f=1+d.slice(-1)[0].last_seg_ind,m="seg_ind_2_start_cum_d"in d?d.seg_ind_2_start_cum_d:d.seg_ind_2_start_cum_d={},g="seg_ind_2_d"in d?d.seg_ind_2_d:d.seg_ind_2_d={},n=a.attrSorted.get(),p={},q=f-1E-10,h=n.length,k=0,v=0;for(;k<h;k++){var P=n[k],H=P.from,F=P.to,D=P.key;P=P.value;if(!D||!P)console.error("alp.x.elpro_model: WTF - bad data"),setTimeout(function(){throw Error("alp.x.elpro_model: WTF - bad data");
});else if(!(F<l)){if(H>=f)break;H=Math.max(l,Math.min(q,H));F=Math.max(l,Math.min(q,F));if(!(H>F-1E-10)){D=D in p?p[D]:p[D]={};D=P in D?D[P]:D[P]={total_distance_m:0,n_segments:0};var M=v;P=b(F);M=v;v=b(H);D.total_distance_m+=P-v;D.n_segments++;v=M}}}a.attrSummary.set(p)}else a.attrSummary.set()}function m(a){function b(a){var b=f&&alp.oGet(f,[a,"d"]);if(null!=b&&m>Math.abs(c-b))return a}a=a.m;var c=a.highlightD.get(),d=a.elproWidthPixel.get(),e=a.visible.get(),l=e&&e.left;e=e&&e.right;if(alp.and([c,
d,l,e],"!=null")){var f=a.elevationSummary.get(),m=16/d*(e-l);a.hoverPointMode.set(alp.or(["highest","lowest"],b)||"generic")}else a.mouseWithinCanvasFriends.get()||a.hoverPointMode.set("none")}function l(a){a=a.m;var b=a.highlightD.get(),c=a.mouseWithinCanvas.get(),d=a.elproInfo.get(),e=(d=d&&d.tpoi)&&d.mindisth,l=!1;!a.hoverPointMode.is("none")&&c&&null!=b&&d&&null!=e&&(b=alp.map(d,"Math.abs(v.b.h - "+b+")"),c=alp.arrMinIndex(b),b[c]<e/2&&(l=d[c].a.id,(l||0).substring.call.a));a.tpoiHighlightIdManual.set(l)}
var r=alp.util,n=r.math;alp.mix(alp.x,{ELPRO_NONE:"none",ELPRO_GENERIC:"generic",ELPRO_HIGHEST:"highest",ELPRO_LOWEST:"lowest",ELPRO_MODE_ARR:["none","highest","lowest","generic"]});alp.declare("alp.x.ElproModel",alp.x.AbstractController,null,{getStageStartIcon:function(){return this.m.stageStartIcon.get()},setStageStartIcon:function(a){this.m.stageStartIcon.setNow(a)},augmentModel:function(a){a.elproHash=new alp.StringState;a.dzInfoArr=new alp.State;a.stageInfoArr=alp.partState(a.dzInfoArr,"stageInfoArr");
a.restrictedHV=new alp.State;a.attrSorted=new alp.ObjectState;var b=a.attrSorted._get_no_clone;a.attrSorted.get=function(){return alp.arrSorted(b.apply(this,arguments),"v.from < w.from ? -1 : v.from > w.from ? +1 : v.to < w.to ? -1 : +1")};a.restrictionLeft=new alp.NumberState({init_value:-Infinity});a.restrictionRight=new alp.NumberState({init_value:Infinity});a.center=new alp.MinMaxState({init_value:.5,min:0,max:1});a.zoom=new alp.MinMaxState({init_value:0,min:0,max:30});a.visible=new alp.ObjectState;
a.hasData=new alp.BoolState;a.isDraggable=new alp.BoolState;a.attrSummary=new alp.ObjectState;a.elevationSummary=this.polyModel.elevationSummary;a.mouseWithinCanvas=new alp.BoolState;a.canvasFriends=new alp.SortedArrayState({init_value:[a.mouseWithinCanvas]});a.mouseWithinCanvasFriends=new alp.BoolState;a.highlightD=new alp.State;a.elproWidthPixel=new alp.NumberState;a.elproHeightPixel=new alp.NumberState;a.hoverPointMode=alp.modeStateFromArr(alp.x.ELPRO_MODE_ARR);a.attrHash=new alp.NumberState({init_value:0});
a.stageStartIcon=new alp.State;a.i18n_stage=new alp.StringState;a.elproViewOpt=new alp.State;a.elproViewHash=new alp.StringState;a.elproInfo=new alp.State;a.tpoiHighlightIdManual=new alp.State;a.tpoiHighlightId=new alp.State},setInitVal:function(g,n,p,q){k(g);h(g);f(g);e(g);d(g);e(g);b(g);a(g);m(g);c(g);l(g)},connectModel2Model:function(g,n,p,q){function r(){p.center.set(.5);p.zoom.set(1)}function w(){p.elproViewHash.set(["elproHash:"+p.elproHash.get(),"attrHash:"+p.attrHash.get(),"viewOpt:"+alp.oToString(p.elproViewOpt.get())].join("###"))}
n.push(g.polyModel.geomChangeEvt().thenSoon(alp.bindF(k,null,g)));n.push(g.polyModel.zChangeEvt().thenSoon(alp.bindF(k,null,g)));g.polyModel.attributes&&n.push(g.polyModel.attributes.attrChangeEvt().thenSoon(alp.bindF(h,null,g)));q=alp.ratelimitF(222,alp.nowF(f),null,g);n.push(p.elproHash.change_cb(q));n.push(g.polyModel.zChangeEvt().thenSoon(q));n.push(p.restrictionLeft.change_cb(r));n.push(p.restrictionRight.change_cb(r));q=alp.bindF(d,null,g);n.push(p.dzInfoArr.change_cb(q));n.push(p.restrictionLeft.change_cb(q));
n.push(p.restrictionRight.change_cb(q));q=alp.bindF(e,null,g);n.push(p.restrictedHV.change_cb(q));n.push(p.zoom.change_cb(q));n.push(p.center.change_cb(q));n.push(p.restrictedHV.change_cb(b,null,g));n.push(p.visible.change_cb(b,null,g));q=alp.ratelimitF(357,alp.nowF(a),null,g);n.push(p.dzInfoArr.change_cb(q));n.push(p.attrSorted.change_cb(q));n.push(p.attrSorted.change_cb(function(){p.attrHash.set(1+p.attrHash.get())}));n.push(p.elproHash.change_cb(w));n.push(p.attrHash.change_cb(w));n.push(p.elproViewOpt.change_cb(w));
q=alp.ratelimitF(27,alp.nowF(m),null,g);n.push(p.highlightD.change_cb(q));n.push(p.elproWidthPixel.change_cb(q));n.push(p.visible.change_cb(q));n.push(p.canvasFriends.change_cb(c,null,g));n.push(p.mouseWithinCanvasFriends.change_v_cb(!1,function(){p.highlightD.unset()}));alp.forEach(["mouseWithinCanvas","highlightD","hoverPointMode","elproInfo"],function(a){n.push(p[a].change_cb(l,null,g))});n.push(p.tpoiHighlightIdManual.bind_to(p.tpoiHighlightId))}});alp.x.ElproModel.GET_ATTR_SORT_COMPARE=function(){return"v.from < w.from ? -1 : v.from > w.from ? +1 : v.to < w.to ? -1 : +1"};
var q={},p="_listen_to_canvasFriends_orState"})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.interface_simple_hover_points");
alp.gmap3(function(k){function h(a,b,c){function d(a){if(a)return alp.hasClass(a,b)?a:d(a.parentNode)}return alp.setClass(a?alp.filter(alp.map(a,d),""):[],c,!0)}function g(a){var b=a.m.hoverPointMode.get(),c=a.m.hoverPoint,d;b===p||b===v?c.set(alp.f('v ? { where: v, mode : "'+b+'" } : null')(alp.m(a._elSum,"get_property",b))):b===u&&a.simple._x_elpro&&null!=(d=a.simple._x_elpro.m.highlightD.get())?(a=a.simple.model.getXYZD(d),c.set(a?{where:a,mode:b}:null)):c.set(null)}function f(a){var b=a.simple.model.node_to_highlight_st.get();
a.simple._x_elpro&&a.simple._x_elpro.m.highlightD.set(alp.isFiniteNumber(b)?a.simple.model.getCumLengthAtNode(b):null)}function e(a){var b=a.getHighest(),c=a._contli_highest,d=a.getLowest(),e=a._contli_lowest;c&&alp.setClass(c,a.cssHoverable,!!b);e&&alp.setClass(e,a.cssHoverable,!!d)}function d(a){var b=a.m.hoverPoint.get(),c=a.simple.map;if(b&&c&&a.simple._x_elpro&&a.simple._x_elpro.m.mouseWithinCanvasFriends.get()){var d=new k.LatLng(b.where.y,b.where.x);a._circlePixel||(a._circlePixel=new n.CirclePixel(alp.oCreateMix(alp.cfg.color.hover(),
{map:c,center:d})));a._circlePixel2||(a._circlePixel2=new n.CirclePixel(alp.oCreateMix(alp.cfg.color.hover(),{map:c,center:d,radiuspixel:10,strokeColor:"rgb(11, 106, 226)"})));a._circlePixel.setCenter(d);a._circlePixel2.setCenter(d);a._circlePixel.setMap(c);a._circlePixel2.setMap(c)}else alp.m(a._circlePixel,"setMap",null),alp.m(a._circlePixel2,"setMap",null);alp.setClass(a._contli_highest,a.cssHover,b&&b.mode===p);alp.setClass(a._contli_lowest,a.cssHover,b&&b.mode===v)}function b(a,b,c){alp.m(a.m["hoverDOM"+
b],"set",!0);a.setHoverPoint(b)}function c(a,c,d){alp.m(a.m["hoverDOM"+c],"set",!0);a.centerOnPoint(c);b(a,c,d)}function a(a,b,c){alp.m(a.m["hoverDOM"+b],"set",!0);c||(c=window.event);alp.stopEvent(c);!a.simple.map||b!==v&&b!==p||(a.simple._x_elpro&&alp.m(a.simple._x_elpro,"zoomDelta",0>c.wheelDelta?-1:1,!0),a.centerOnPoint(b))}function m(a,b,c){alp.m(a.m["hoverDOM"+b],"set",!1);a.setHoverPoint(q)}function l(a,b){a.m.hoverDOMhighest.unset();a.m.hoverDOMlowest.unset();if("x"in b&&b.x&&b.x.hash)var c=
b.x,d=(new r.XYNearestFinder(a.simple.model)).queryNearestPoint(b.over_latlng,c);else b&&b.piece?(d=b,c=b.piece):b&&b.latLng&&(c=a.simple.model.getPieces(),d=b.alpStageIndex,c&&c[0]&&alp.isFiniteNumber(d)&&"stageIndex"in c[0]&&(c=alp.filter(c,".stageIndex==="+d)),d=(new r.XYNearestFinder(a.simple.model)).queryNearestPointAll(b.latLng,c,{mouseover:!0}),c=d.piece);if(d){b=d.ind;d=d.prop;var e=c.dArr;c=a.simple.model.getPieces().cum_d[c.piece_ind]+(b<e.length-1?alp.interpolate(e[b],e[b+1],d):e[b]);a._highlightD&&
a._highlightD.set(c)}}alp.ensureCss(alp.cssBase()+"alp/x.css");var r=alp.sub("alp._gmap2_3.digitize",null,!0),n=alp._gmap2_3,q=alp.x.ELPRO_NONE,p=alp.x.ELPRO_HIGHEST,v=alp.x.ELPRO_LOWEST,u=alp.x.ELPRO_GENERIC,t=alp.x.ELPRO_MODE_ARR;r.InterfaceSimpleHoverPoints={_init_hover_points:function(){this._x_hover&&this._x_hover.disconnect();this._x_hover=new r.SimpleHoverPoints({simple:this,initNow:!0})}};alp.declare("alp._gmap2_3.digitize.SimpleHoverPoints",alp.x.AbstractController,null,alp.cfg.css,{simple:null,
highestContClass:"alp-tpwiz-fact-highest-cont",lowestContClass:"alp-tpwiz-fact-lowest-cont",centerOnPoint:alp.nowF(function(a){a=alp.m(this._elSum,"get_property",[a,"d"]);var b=this.simple._x_elpro;null!=a&&b&&b.centerOnD(a,!0)}),getHighest:function(){return alp.m(this._elSum,"get_property",p)},getLowest:function(){return alp.m(this._elSum,"get_property",v)},setHoverPoint:alp.nowF(function(a){this.m.hoverPointMode.set(a)}),setInitVal:function(a,b,c,d){a._elSum=a.simple.model.elevationSummary;a._highlightD=
a.simple._x_elpro&&a.simple._x_elpro.m.highlightD;a._contli_highest=h(a.simple._factHighest_noli,a.highestContClass,a.cssClickable);a._contli_lowest=h(a.simple._factLowest_noli,a.lowestContClass,a.cssClickable);g(a)},augmentModel:function(a){var b=this.simple._x_elpro;a.hoverPointMode=b?b.m.hoverPointMode:alp.modeStateFromArr(t);a.hoverPoint=new alp.ObjectState;a.hoverDOMhighest=new alp.BoolState;a.hoverDOMlowest=new alp.BoolState;b&&(b.m.canvasFriends.add(a.hoverDOMhighest),b.m.canvasFriends.add(a.hoverDOMlowest))},
connectModel2Model:function(a,b,c,d){b.push(c.hoverPointMode.change_cb(g,null,a));a._highlightD&&b.push(a._highlightD.change_cb(g,null,a));a._elSum&&b.push(a._elSum.change_cb(g,null,a));(c=a.simple.model.node_to_highlight_st)&&b.push(c.change_cb(f,null,a))},connectModel2View:function(a,b,c,l){a._elSum&&b.push(a._elSum.change_cb_init(e,null,a));e(a);b.push(c.hoverPoint.change_cb_init(d,null,a));a.simple._x_elpro&&b.push(a.simple._x_elpro.m.mouseWithinCanvasFriends.change_cb(d,null,a))},connectView2Model:function(d,
e,f,g){function n(a){function b(a){g=!0;l(d,a)}function c(a){g&&l(d,a)}function f(a){g=!1;alp.m(d._highlightD,"set",null);d.m.hoverPointMode.set(q)}if(a=alp.oGet(d.simple,a))a.polylineMouseoverEvt?(e.push(a.polylineMouseoverEvt().then(b)),e.push(a.polylineMouseoutEvt().then(f)),a.polylineMousemoveEvt&&e.push(a.polylineMousemoveEvt().then(c))):a.listen&&(e.push(a.listen("polylineMouseover",b)),e.push(a.listen("polylineMouseout",f)),e.push(a.listen("polylineMousemove",c)));var g}f=d._contli_highest;
g=d._contli_lowest;f&&(e.push(alp.aEL(f,"mouseover",alp.nowF(alp.bindF(b,null,d,p)))),e.push(alp.aEL(f,"click",alp.nowF(alp.bindF(c,null,d,p)))),e.push(alp.aEL(f,"mousewheel",alp.nowF(alp.bindF(a,null,d,p)))),e.push(alp.aEL(f,"dblclick",alp.nowF(alp.bindF(a,null,d,p,{wheelDelta:1})))),e.push(alp.aELdblrightclick(f,alp.nowF(alp.bindF(a,null,d,p,{wheelDelta:-1})))),e.push(alp.aEL(f,"mouseout",alp.nowF(alp.bindF(m,null,d,p)))));g&&(e.push(alp.aEL(g,"mouseover",alp.nowF(alp.bindF(b,null,d,v)))),e.push(alp.aEL(g,
"click",alp.nowF(alp.bindF(c,null,d,v)))),e.push(alp.aEL(g,"mousewheel",alp.nowF(alp.bindF(a,null,d,v)))),e.push(alp.aEL(g,"dblclick",alp.nowF(alp.bindF(a,null,d,v,{wheelDelta:1})))),e.push(alp.aELdblrightclick(g,alp.nowF(alp.bindF(a,null,d,v,{wheelDelta:-1})))),e.push(alp.aEL(g,"mouseout",alp.nowF(alp.bindF(m,null,d,v)))));alp.forEach(f.concat(g),'alp.sA( v, "onselectstart", "return false;" )');d.simple&&alp.forEach(["itemController._views.editGhostMarker","itemController._views.attributeLine","tourPoiLayer"],
n)}})});"undefined"!==typeof dojo&&dojo.provide("alp.i18n.unit");
(function(){function k(a,b,c){var e="string"===typeof b?alp.f(b):b;return function(b,m){var n=alp.oCreateMix(c||{},m),p=n.withLabel;m=n.nbsp;var q=n.round;n=n.value;h();l||(l=d(a,"conv"));f||(f=d(a,"func"));g||(g=d(a,"with-label"));if(0<q&&f){var r=1*alp.tmplJs(f,{x:12345}),k=1*alp.tmplJs(f,{x:67890});b=12345+55545*(q*Math.round((r+(k-r)*(b-12345)/55545)/q)-r)/(k-r)}b=(p=p?g:n?f:l)?alp.tmplJs(p,{x:b}):e(b);return m?(""+b).replace(/ /g,"&nbsp;"):(""+b).replace(/&nbsp;/g," ")};var l,f,g}function h(){g();
if(!m)alp.onDCL(f);h=alp.f()}function g(){var a=alp.nodify("oax-unit-cont");a&&(m=alp.cE("div",0,0,{innerHTML:a.innerHTML}))}function f(){g();m||alp.m(c(alp.filterIn({project:b.proj||"",key:b.key||"",path:"/plugin/common/inc/unitCont.jsp",_quantityMap:b._get__quantityMap(a)},"")),["to","then"],e)}function e(a){var b=a&&a.answer&&"ok"===a.answer.status&&a.answer.html;if(b){b=alp.cE("div",null,null,{innerHTML:b});var c=(b=alp.nodify("oax-unit-cont",b))&&b.innerHTML}c?m=alp.cE("div",0,0,{innerHTML:c}):
console.error("alp.i18n.unit.receive_unitCont failed. o:",a)}function d(a,b){return(a=m&&alp.nodify("oax-unit-"+a+"-"+b,m))&&a.innerHTML||null}var b=alp.sub("alp.i18n.unit",null,!0),c=alp.data.api_bodypart,a=/[\?&]unit_system=imperial(?:&|$)/i.test(location.search),m;b.getDfrd=alp.memF(function(){h();return alp.subDfrd(function(){return!!m})});b.isMetric=function(){return m?1E-10>Math.abs(1-b.meterValue(1)):null};b._get__quantityMap=function(a){null!=a||(a=!b.isMetric());return a?"defaultNonSI":"standard"};
b.celsiusString=k("celsius",".toFixed(0)");b.celsiusValue=k("celsius","",{value:1});b.celsiusWithLabel=k("celsius",'.toFixed(0)+"\u202f"+"\u00b0C"',{withLabel:1,nbsp:1});b.mmString=k("mm","(v * 1000).toFixed(0)");b.mmValue=k("mm","*1000",{value:1});b.mmWithLabel=k("mm",'(v * 1000).toFixed(0)+"\u202f"+"mm"',{withLabel:1,nbsp:1});b.cmString=k("cm","(v * 100).toFixed(0)");b.cmValue=k("cm","*100",{value:1});b.cmWithLabel=k("cm",'(v * 100).toFixed(0)+"\u202f"+"cm"',{withLabel:1,nbsp:1});b.kmString=k("km",
"(v * 0.001).toFixed(1)");b.kmValue=k("km","/1000",{value:1});b.kmWithLabel=k("km",'(v * 0.001).toFixed(1)+"\u202f"+"km"',{withLabel:1,nbsp:1});b.kmhString=k("kmh",".toFixed(1)");b.kmhValue=k("kmh","",{value:1});b.kmhWithLabel=k("kmh",'.toFixed(1)+"\u202f"+"kmh"',{withLabel:1,nbsp:1});b.meterString=k("meter",".toFixed(1)");b.meterValue=k("meter","",{value:1});b.meterWithLabel=k("meter",'.toFixed(1)+"\u202f"+"m"',{withLabel:1,nbsp:1})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.interface_simple_quick_facts");
(function(){var k=alp.sub("alp._gmap2_3.digitize",null,!0),h=alp.i18n.unit;k.InterfaceSimpleQuickFacts={_qf_update_duration_values:function(g){if(alp.isFiniteNumber(g)){g=g/6E4>>0;var f=g%60>>0;alp.setProp(this._factDurationH_noli,{innerHTML:(g/60>>0)+""});alp.setProp(this._factDurationM_noli,{innerHTML:alp.sPad(f+"",2,"0")});alp.style(this._factDuration_noli,{visibility:""})}else alp.style(this._factDuration_noli,{visibility:"hidden"})},_qf_update_elpro_summary_values:function(g){var f=alp.f('alp.isFiniteNumber( v )  ?  alp.i18n.unit.meterString( v )  :  "-"');
alp.setText(this._factAscent_noli||[],f(g&&g.ascent));alp.setText(this._factDescent_noli||[],f(g&&g.descent));alp.setText(this._factHighest_noli||[],f(g&&g.highest.z));alp.setText(this._factLowest_noli||[],f(g&&g.lowest.z))},_qf_update_tourLength_value:function(g){alp.setText(alp.arrChain([this._factLength_noli||[],this._tourLength_noli||[]]),0<g?h.kmString(g):"0")}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.const");
(function(){var k=alp.sub("alp._gmap2_3.digitize",null,!0);k.ADDRESS=function(){return"address"};k.ATTR_DEFAULT=function(f){return{key:"waytype",value:"0",nodeCount:f.getNodeCount()}};k.DATATYPE_CFG_ROUTING_ENTRIES=function(){return["default_network",k.ROUTING_ENGINE(),k.SPEED_KMH(),"travelMode",k.ROUTING_ENGINE()]};k.DATATYPE_NAME=function(){return"datatype_name"};k.DURATION_MS=function(){return"duration_ms"};k.DURATION_MS_VALUE=function(){return"value_ms"};k.DURATION_MS_FLATSPEEDKMH=function(){return"flat_speed_kmh"};
k.EXTENSION=function(){return"extension"};k.DEFAULTLEG=alp.f('"defaultleg"');k.GEO_XY=function(){return"geo_xy"};k.LINREF_EMPTY_PERMITTED_KEY_SET=alp.f("{ crossing : 1 }");k.LINREF_ORIGIN_DATETIME=alp.f('"origin_datetime"');k.LINREF_ORIGIN=alp.f('"origin"');k.LINREF_ORIGIN_HUMAN=alp.f('"human"');k.LINREF_ORIGIN_SERVER=alp.f('"server"');k.NEW_GEOCODER_NODE_TEMPLATE=alp.f('"js-tp-new-geocoder-node-template"');k.SEGMENT_ACTIVITY_SELECT=alp.f('"alp-tpwiz-activity"');k.NEXTLEG=function(){return"nextleg"};
k.NEXTLEG_ETC=function(){return[k.SPEED_KMH(),k.KSF(),k.PUBLIC_TRANSPORT(),k.PT_RAIL_ONLY(),k.ROUTING_ENGINE(),k.PT_WITH_BIKE()]};k.NEXTLEG_PROPAGATION_EXCLUDED=alp.f("{ poiId : 1 }");k.PT_RAIL_ONLY=function(){return"railonly"};k.PT_WITH_BIKE=function(){return"withbike"};k.PT_FROM_POINT=function(){return"from_point"};k.PT_TO_POINT=function(){return"to_point"};k.PT_FROM_PROP=function(){return"from_prop"};k.PT_TO_PROP=function(){return"to_prop"};k.PT_START_LOCATION=function(){return"start_location"};
k.PT_END_LOCATION=function(){return"end_location"};k.PT_TRAVEL_MODE=function(){return"travel_mode"};k.PUBLIC_TRANSPORT=function(){return"publictransport"};k.PUBLIC_TRANSPORT_STEP_ARR=function(){return"publictransport_steps"};k.REVERSE_FEATURE=function(){return"reverse_feature"};k.POIID=alp.f('"poiId"');k.ROUTING_ENGINE=function(){return"routingengine"};k.ROUTING_ENGINE_MANUAL=alp.f('"manual"');k.ROUTING_ENGINE_GPX_TRK=alp.f('"gpx_trk"');k.ROUTING_ENGINE_OUTDOORACTIVE=alp.f('"outdooractive"');k.ROUTING_ENGINE_OSRM=
alp.f('"osrm"');k.ROUTING_ENGINE_GOOGLE=alp.f('"google"');k.ROUTING_ENGINE_FINAL=alp.f('"routingengine_final"');k.TIME_END=function(){return"time_end"};k.TIME_F_PARAMS=alp.f('"timeFparams"');k.TIME_START=function(){return"time_start"};k.MANUAL=alp.f('"manual"');k.PACE=alp.f('"pace"');k.PACE_SLOW=alp.f('"slow"');k.PACE_MEDIUM=alp.f('"medium"');k.PACE_FAST=alp.f('"fast"');k.PACE_ARR=function(){return[k.PACE_SLOW(),k.PACE_MEDIUM(),k.PACE_FAST()]};k.PACE_DEFAULT=k.PACE_MEDIUM;var h;k.PACE_2_SPEEDPROP=
function(f){return(h||(h=alp.arr2o([[k.PACE_SLOW(),0],[k.PACE_MEDIUM(),.5],[k.PACE_FAST(),1]],0,1)))[f]};k.PUBLIC_TRANS_NONE=function(){return"none"};k.PUBLIC_TRANS_SHORT=function(){return"short"};k.PUBLIC_TRANS_FAST=function(){return"fast"};k.PUBLIC_TRANS_SIMPLE=function(){return"simple"};k.PUBLIC_TRANS=function(){return[k.PUBLIC_TRANS_NONE(),k.PUBLIC_TRANS_SHORT(),k.PUBLIC_TRANS_FAST(),k.PUBLIC_TRANS_SIMPLE()]};k.KSF=function(){return"routingstyle"};k.KSF_NETWORK=function(){return"network"};k.KSF_SHORT=
function(){return"short"};k.KSF_FAST=function(){return"fast"};k.KSF_FLAT=function(){return"flat"};k.KSF_ARR=function(){return[k.KSF_NETWORK(),k.KSF_SHORT(),k.KSF_FAST(),k.KSF_FLAT()]};k.KSF_DEFAULT=k.KSF_NETWORK;k.ROUTINGSTYLE=alp.f('"routingstyle"');k.ROUTINGSTYLE_DEFAULT=k.KSF_DEFAULT;k.SPEED_KMH=function(){return"speed_kmh"};k.EVENT_MAP_CLICK=function(){return"/alp/_gmap2_3/digitize/EditController/map/event/singleclick"};k.EVENT_MAP_CONTEXT_MENU=function(){return"/alp/_gmap2_3/digitize/EditController/event/mapContextMenu"};
k.NODE_INFO=alp.f('"node_info"');var g=["geo_xy","address","poiId"];k.ONE_NODE_INFO=function(){return[].concat(g)};k.ONE_NODE_INFO_NO_GEO_XY=function(){return alp.filter(g,'!=="geo_xy"')};k.SELECT_RMG_CHANGE_FOR_MODEL=function(f){f=alp.mix({},f);var e="nextleg"in f&&f.nextleg;e&&("time_start"in e&&delete e.time_start,"time_end"in e&&delete e.time_end);return f}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models._manual_pack_unpack");
(function(){var k=alp.sub("alp._gmap2_3.digitize.models._manual_pack_unpack",null,!0),h=alp._gmap2_3.digitize,g=alp.maps.geodesic,f=alp.util,e=h.DEFAULTLEG(),d=h.NODE_INFO(),b=h.NEXTLEG(),c=h.ROUTING_ENGINE(),a=h.ROUTING_ENGINE_MANUAL(),m=h.ROUTING_ENGINE_GPX_TRK(),l={};k.pack=function(f,g){function n(a){for(var b=0,c=r.length,d=0;d<c;d++){var e=r[d];if(a<=e.j)break;else b=e.shift_after}!isNaN(b)&&b.toPrecision.call.a;return a-b}function p(a){for(var b=0,c=!0,d=r.length,e=0;e<d;e++){var l=r[e];if(a<
l.i-1E-10){c=!0;break}else if(a<l.j+1-1E-10){b=l.shift_before;c=!1;break}else b=l.shift_after}!isNaN(b)&&b.toPrecision.call.a;if(c)return a-b;c=l.i;d=l.j;if(g){e=l.dArr;var f=l.cumdArr,m=l.d;if(!e){L||(L=[]);for(e=c;e<=d;e++)e in L||(L[e]=g[e].distanceFrom(g[e+1]));e=l.dArr=L.slice(c,d+1);f=l.cumdArr=alp.map(e,"(i ? v+ret[i-1] : v)");m=l.d=f[f.length-1]}a-=c;l=Math.min(d-c,a|0);b=c-b+Math.min(1,Math.max(0,((f[l-1]||0)+e[l]*(a-l))/m));!isNaN(b)&&b.toPrecision.call.a;return b}null.not_implemented_yet}
function h(){null!=k&&null!=G&&r.push({i:G,j:k});G=k=null}var r=[],k=null,w=f.coordinates||[];w.slice();var x=f[e]||{},y=f[d],z=w.length;a:for(;z--;){var A=w[z].length;if(2<A)h();else if(2===A){var C=y&&y[z];A=alp.oCreateMix(x,(C||{})[b]);A.time_start=null;A.time_end=null;if(C)for(var E in C)if(!(E in l)&&E!==b){if(null!=k&&alp.oEqual(A,B)){var G=z;h()}continue a}C=A[c];if(!C||C===a||C===m){if(null!=k)if(alp.oEqual(A,B)){G=z;continue a}else h();if(null==k){k=z;var B=A;G=null}}}else console.error("manual_pack_unpack WTF!!!"),
setTimeout(function(){throw Error("manual_pack_unpack WTF!!!");},0)}h();E=0;for(z=r.length;z--;)B=r[z],B.shift_before=E,B.shift_after=E+=B.j-B.i;!isNaN(E)&&E.toPrecision.call.a;r.reverse();if(r.length){x=f[d];B=f.attributes;for(E=r.length;E--;)y=r[E],z=y.i,y=y.j,w.splice(z,y-z+1,alp.map(w.slice(z,y+1),"v[0]").concat([w[y][1]]));f.coordinates=w;if(x){x=alp.oCopy(x);for(E=r.length;E--;)if(y=r[E],z=y.i,y=y.j,A=x[z],w=x[y],x=alp.filterIn(x,"(+w)<="+z+"||"+y+"<(+w)"),z=A&&A[b])if(delete z.time_end,w=w&&
w[b])z.time_end=w.time_end;z={};for(var I in x)I in l||(E=n(I),E in z&&null.bug,z[E]=x[I]);f.node_info=x=z}if(B){B=alp.oCopy(B);for(z=B.length;z--;)I=B[z],I.from=p(I.from),I.to=p(I.to);f.attributes=B}}return f;var L};k.pack_node_info=function(d,e){for(var l,f=e.length;f--;)if(!e[f]){var g=alp.oGet(d,[f,b]);if(!g||g[c]!==a&&g[c]!==m)l||(l=alp.oCopy(d)),alp.oSet(l,[f,b,c],a)}return l||d};k.unpack=function(h){function n(a){for(var b=a|0,c=0,d=!0,e=p.length,l=0;l<e;l++){var m=p[l];if(b<m.i){d=!0;break}else if(b===
m.i){c=m.shift_before;d=!1;break}else c=m.shift_after}!isNaN(c)&&c.toPrecision.call.a;if(d)return a+c;a-=b;d=m.dArr;e=m.cumdArr;l=m.d;if(!d){e=r[b];l=e.length;d=Array(l-1);for(var n=1;n<l;n++){var q=g.distance_xy(e[n-1],e[n]);!isNaN(q)&&q.toPrecision.call.a;d[n-1]=q}m.dArr=d;m.cumdArr=e=alp.map(d,"(i ? v+ret[i-1] : v)");m.d=l=e[e.length-1]}m=a*l;m=f.arrSoftIndex([0].concat(e),m);b=b+c+m.ind0+m.prop;!isNaN(b)&&b.toPrecision.call.a;return b}function q(a){a=+a;for(var b=0,c=p.length,d=0;d<c;d++){var e=
p[d],l=e.i;if(a<l)break;else{if(a===l)return{new_ind_beg:a+e.shift_before,new_ind_end:a+1+e.shift_after};b=e.shift_after}}a+=b;return{new_ind_beg:a,new_ind_end:a+1}}for(var p=[],r=h.coordinates||[],k=h.node_info||{},t=alp.oCopy(h[e]||{}),w=0,x=r.length,y=0;y<x;y++){var z=r[y].length;if(2<z){var A=alp.oCreateMix(t,(k[y]||{})[b]);if(A[c]===a||A[c]===m){var C=w;z=w+=z-2;p.push({i:y,nextleg:A,shift_before:C,shift_after:z})}}}if(p.length){k=h[d];if(x=h.attributes){x=alp.oCopy(x);for(y=x.length;y--;)A=
x[y],A.from=n(A.from),A.to=n(A.to);h.attributes=x}if(k){t={};for(var E in k)if(!(E in l)){w=k[E];y=q(E);var G=y.new_ind_beg;x=y.new_ind_end-G;G in t&&null.bug;if(1===x)w&&(t[G]=w);else if(w){C=(A=w[b])&&A.time_start;y=A&&A.time_end;y=(z=alp.isFiniteNumber(C)&&alp.isFiniteNumber(y))&&y-C;var B=z&&y/x;for(y=0;y<x;y++,G++){var I=null;if(1>y)I=z?alp.oCreateMix(w,{nextleg:alp.oCreateMix(A,{time_end:C+B})}):w;else{I=C+y*B;var L=I+B;I=A?{nextleg:z?alp.oCreateMix(A,{time_start:I,time_end:L}):A}:{}}t[G]=I}}}h.node_info=
k=t}for(k=p.length;k--;)y=p[k].i,E=alp.reduce(r[y],"(i<n-1 && v.push([w,arr[i+1]])), v",[]),r.splice.apply(r,[y,1].concat(E));h.coordinates=r}return h}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.commands");
(function(){function k(b,c,a){a&&"object"===typeof a[0]&&(a=alp.Aps.call(a),a.splice(0,2,a[1],a[0]));var d;a&&a.length&&(d=alp.bindF.apply(alp,a));this._asyncSeq.next(alp.nowF(b,this)).next(alp.nowF(c,this)).nextOptional(d&&function(a){alp.now(d);a()})}function h(b){this._wasExecuted=!0;this._wasReverted=!1;b&&b()}function g(b){this._wasReverted=!0;b&&b()}var f=alp._gmap2_3,e=f.digitize.ONE_NODE_INFO();alp.declare("alp._gmap2_3.digitize.commands.AbstractBaseCommandAsync",null,alp.nowF(function(b){this._asyncSeq=
d.get(b)||d.set(b,new alp.asyncSeq)}),{isReversible:!1,_wasExecuted:!1,_wasReverted:!1,execute:function(){if(this._wasExecuted&&!this._wasReverted)throw Error("Command was already executed.");k.call(this,"_execute",h,arguments)},revert:function(){if(!this.isReversible)throw Error("Command is not reversible.");if(!this._wasExecuted)throw Error("Command was not previously executed");k.call(this,"_revert",g,arguments)},_execute:function(b){throw Error("override!");},_revert:function(b){throw Error("override!");
}});alp.declare("alp._gmap2_3.digitize.InsertNodesCommand",f.digitize.commands.AbstractBaseCommandAsync,function(b,c,a,d,e){this._model=b;this._actualNodes=this._nodes=c;this._index=a;this._doRoute=d;this._wasRoute=b.supportsRouting&&b.isSegmentRouted(a-1);this._info_arr=e},{isReversible:!0,_execute:function(b){var c=this._wasExecuted&&this._wasReverted;this._insertedIndex=null==this._index?this._model.getNodeCount():this._index;var a=this._model.insertNodes(this._nodes,this._index,this._doRoute,
this._info_arr);a?a.then(alp.bindF(function(a){this._wasExecuted&&!this._wasReverted&&a&&a.length&&(this._actualNodes=a);c&&b()},this)):c&&b();c||b()},_revert:function(b){this._model.deleteNodes(this._insertedIndex,this._nodes.length,this._wasRoute)[1].then(b)}});alp.declare("alp._gmap2_3.digitize.DeleteNodesCommand",f.digitize.commands.AbstractBaseCommandAsync,function(b,c,a){this._model=b;this._index=c;this._howMany="undefined"==typeof a?1:a},{isReversible:!0,_execute:function(b){b.call.a;var c=
this._model.deleteNodes(this._index,this._howMany);this._deleted=c[0];this._wasRoutedArr=c[2];c[1].then(b)},_revert:function(b){b.call.a;this._deleted?this._model.insertNodes(this._deleted,this._index,this._wasRoutedArr).then(b):b()}});alp.declare("alp._gmap2_3.digitize.MoveNodeCommand",f.digitize.commands.AbstractBaseCommandAsync,function(b,c,a,d){this._model=b;this._to=c;this._from=a;this._doRoute=d},{isReversible:!0,_execute:function(b){function c(){a._model.insertNodes(a._deleted,l,a._doRoute,
a._selected_info_arr).then(b)}var a=this,d=a._from,l=a._to,f=a._model.node_info;f&&(a._selected_info_arr=[alp.opt(f.get_property(d),e)]);d=a._model.deleteNodes(a._from,1);if(d[0]instanceof Array){a._deleted=d[0];var g=d[1]}else a._deleted=d;g?g.then(c):c()},_revert:function(b){function c(){a._model.insertNodes(a._deleted,a._from,a._doRoute,a._selected_info_arr).then(b)}var a=this,d=a._model.deleteNodes(a._to,1);(d=d[0]instanceof Array&&d[1])?d.then(c):c()}});alp.declare("alp._gmap2_3.digitize.UpdateNodeCommand",
f.digitize.commands.AbstractBaseCommandAsync,function(b,c,a,d,e){this._model=b;this._index=c;this._newValue=a;this._info=d;this._opts=e},{isReversible:!0,_execute:function(b){var c=this._model.updateNode(this._index,this._newValue,this._info,this._opts);c instanceof Array?(this._oldValue=c[0],this._oldInfo=c[2],c[1].then(b)):(this._oldValue=c,b())},_revert:function(b){var c=this._model.updateNode(this._index,this._oldValue,this._oldInfo);c instanceof Array?c[1].then(b):b()}});alp.declare("alp._gmap2_3.digitize.UpdateNodeArrayCommand",
f.digitize.commands.AbstractBaseCommandAsync,function(b,c,a,d,e){this._model=b;this._index_arr=c;this._newValue_arr=a;this._info_arr=d;this._opts=e},{isReversible:!0,_execute:function(b){var c=this._model.updateNodeArray(this._index_arr,this._newValue_arr,this._info_arr,this._opts);c instanceof Array?(this._oldValue_arr=c[0],this._oldInfo_arr=c[2],c[1].then(b)):(this._oldValue_arr=c,b())},_revert:function(b){var c=this._model.updateNodeArray(this._index_arr,this._oldValue_arr,this._oldInfo_arr);c instanceof
Array?c[1].then(b):b()}});alp.declare("alp._gmap2_3.digitize.ReverseCommand",f.digitize.commands.AbstractBaseCommandAsync,function(b){this._model=b},{isReversible:!0,_execute:function(b){this._model.reverse();b()},_revert:function(b){this._model.reverse();b()}});alp.declare("alp._gmap2_3.digitize.setContiguousSegmentsManualCommand",f.digitize.commands.AbstractBaseCommandAsync,function(b,c,a){this._model=b;this._start=c;this._end=a},{isReversible:!0,_execute:function(b){var c=this._model.setContiguousSegmentsManual(this._start,
this._end);this._new_start_end=c[0];c[1].then(b)},_revert:function(b){var c=this._model;c.setContiguousSegmentsRouted.apply(c,this._new_start_end)[1].then(b)}});alp.declare("alp._gmap2_3.digitize.setContiguousSegmentsRoutedCommand",f.digitize.commands.AbstractBaseCommandAsync,function(b,c,a){this._model=b;this._start=c;this._end=a},{isReversible:!0,_execute:function(b){var c=this._model.setContiguousSegmentsRouted(this._start,this._end);this._new_start_end=c[0];this._deleted=c[2];c[1].then(b)},_revert:function(b){var c=
this,a=c._model;a.setContiguousSegmentsManual.apply(a,c._new_start_end)[1].then(function(){var d=c._deleted;d&&d.length?a.insertNodes(d,c._new_start_end[0]+1,!1).then(b):b()})}});alp.declare("alp._gmap2_3.digitize.SetSegmentManualCommand",f.digitize.commands.AbstractBaseCommandAsync,function(b,c){this._model=b;this._index=c},{isReversible:!0,_execute:function(b){this._obj=this._model.setSegmentManual(this._index);b()},_revert:function(b){this._model.setSegmentRouted(this._index,this._obj).then(b)}});
alp.declare("alp._gmap2_3.digitize.SetSegmentRoutedCommand",f.digitize.commands.AbstractBaseCommandAsync,function(b,c){this._model=b;this._index=c},{isReversible:!0,_execute:function(b){this._model.setSegmentRouted(this._index,this._obj).then(b)},_revert:function(b){this._obj=this._model.setSegmentManual(this._index);b()}});alp.declare("alp._gmap2_3.digitize.UpdatePointCommand",f.digitize.commands.AbstractBaseCommandAsync,function(b,c){this._model=b;this._newValue=c},{isReversible:!0,_execute:function(b){this._oldValue=
this._model.set(this._newValue);b()},_revert:function(b){this._model.set(this._oldValue);b()}});var d=alp.mapany()})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_append");(function(){var k=alp.sub("alp._gmap2_3.digitize.models",null,!0),h=alp._gmap2_3.digitize,g=h.ONE_NODE_INFO_NO_GEO_XY();k.InterfaceAppend={appendNode:function(f,e){e=e&&[alp.opt(e,g,!0)];f=new h.InsertNodesCommand(this,[f],null,!0,e);this.undoStack.add(f)}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_auto_insert");
(function(){var k=alp.sub("alp._gmap2_3.digitize.models",null,!0),h=alp._gmap2_3.digitize,g=h.ONE_NODE_INFO_NO_GEO_XY();k.InterfaceAutoInsert={autoInsertNode:function(f,e){var d=this._nodes.length,b;if(1<d){var c=alp.m(this,"queryNearestPointAll",f),a=alp.opt(c,1);a&&10>a.distanceFrom(this.getNode(0))?b=0:a&&10>a.distanceFrom(this.getNode(d-1))?b=d:a&&(b=c[0]+1)}"number"!==typeof b&&(b=d);console.log("xxx autoInsertNode opt",e);e=e&&[alp.opt(e,g,!0)];f=new h.InsertNodesCommand(this,[f],b,!0,e);this.undoStack.add(f);
return b}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_close_loop");(function(){var k=alp._gmap2_3.digitize;alp.sub("models",k,!0).InterfaceCloseLoop={closeLoop:function(){var h=this._nodes.length;if(2>h)return!1;var g=this._nodes[0],f=this._nodes[h-1];if(1E-4>Math.max(Math.abs(g.lat()-f.lat()),Math.abs(g.lng()-f.lng())))return null;h=new k.InsertNodesCommand(this,[g],h,!0);this.undoStack.add(h);return h}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_cmd_delete_node");
(function(){var k=alp._gmap2_3.digitize;alp.sub("models",k,!0).InterfaceCmdDeleteNode={cmdDeleteNode:function(h){return this.cmdDeleteNodes(h,1)},cmdDeleteNodes:function(h,g){if(this.undoStack){var f=this.getNodeCount();if(-1<h&&h<f&&(g=Math.min(f-h,g),0<g))return h=new k.DeleteNodesCommand(this,h,g),this.undoStack.add(h),h}}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_cmd_move_node");
(function(){var k=alp._gmap2_3.digitize;alp.sub("models",k,!0).InterfaceCmdMoveNode={cmdMoveNode:function(h,g,f){if(this.undoStack){var e=this.getNodeCount();if(-1<g&&g<e){if(-1<h&&h<e)return h=new k.MoveNodeCommand(this,h,g,f),this.undoStack.add(h),h;console.error("AGDM:cmdMoveNode: invalid `to` value "+h+" (node count: "+e+")")}else console.error("AGDM:cmdMoveNode: invalid `from` value "+g+" (node count: "+e+")")}}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_cmd_update_node");
(function(){var k=alp._gmap2_3.digitize;alp.sub("models",k,!0).InterfaceCmdUpdateNode={cmdUpdateNode:function(h,g,f,e){if(this.undoStack)return h=new k.UpdateNodeCommand(this,h,g,f,e),this.undoStack.add(h),h},cmdUpdateNodeArray:function(h,g,f,e){if(this.undoStack)return h=new k.UpdateNodeArrayCommand(this,h,g,f,e),this.undoStack.add(h),h}}})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.ascent_z");
(function(){function k(g,f){var e=f&&f.limit||30,d=f&&f.reverse,b=f&&null!=f.minz?f.minz:Math.min.apply(Math,g);f=f&&null!=f.maxz?f.maxz:Math.max.apply(Math,g);var c=g.length;if(2>c)return 0;var a=g[d?c-1:0],m=d?-1:1,l=d?-1:c,h=0,n=0;d=d?c-2:1;for(var q=c=0;d!==l;d+=m){var p=g[d];n=n+p-a;a=p;if(n>=c||p===f)h+=n,c=n=0,q=-e;else if(n<=q||p===b)n=0,c=e,q=0}return 0<n?h+n:h}var h=alp.sub("alp.maps",null,!0);h.ascentZ=k;h.descentZ=function(g,f){return k(g,alp.oCreateMix(f||{},{reverse:!0}))}})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_poly_derive_elevation_summary");
(function(){function k(a){var g=a.getPieces();if(g){c||(c=h.LatLngZD.getALPZ());for(var l=Date.now?Date.now():+new Date,r=g.length,n=!0,q=0;q<r;q++){var p=g[q],v=p.hash;if(!(v in e)){var u=p.gll_arr;if(121<(Date.now?Date.now():+new Date)-l){n=!1;break}for(var t=u.length,w=Array(t),x=Infinity,y=null,z=-Infinity,A=null;t--;){var C=u[t];C=w[t]=C.z&&(C[c]||C.z());if(null==C){n=!1;z=x=A=y=null;break}C<x&&(x=C,y=t);C>z&&(z=C,A=t)}if(n&&alp.and([z,x,A,y],"alp.isFiniteNumber(v)")){if(!alp.and([z,x,A,y],"alp.isFiniteNumber(v)"))throw Error("elevation summary: buggy implementation!");
e[v]={short_hash:d++,highest:z,highest_ind:A,highest_d_piece:p.dArr[A],highest_x:u[A].lng(),highest_y:u[A].lat(),lowest:x,lowest_ind:y,lowest_d_piece:p.dArr[y],lowest_x:u[y].lng(),lowest_y:u[y].lat()}}else n=!1}}x=!1;w=u=0;if(n){x=!0;z=[];y=[];for(q=0;q<r;q++)p=g[q],v=p.hash,v=e[v],t=p.gll_arr.length,v=v.short_hash,v.toPrecision.call.a,t.toPrecision.call.a,z.push(v),y.push(t);A=[];C=0;var E=[];z=r-1;for(q=0;q<r;q++)if(p=g[q],v=p.hash,v=e[v],t=!1,A.push(q),C+=y[q],E.push(v.short_hash),q===z||1E4<C+
y[q+1]){v=E.join("_#_");if(v in b)v=b[v],A=v.ascent,p=v.descent;else{E=A.length;var G=Array(E);p=Infinity;C=-Infinity;for(var B=0;B<E;B++){t=g[A[B]];var I=e[t.hash],L=t.gll_arr,J=L.length,P=Array(J);for(t=0;t<J;t++){var H=L[t];P[t]=H[c]||H.z()}G[B]=P;p=Math.min(p,I.lowest);C=Math.max(C,I.highest)}t=alp.arrChain(G);p={minz:p,maxz:C};A=f.ascentZ(t,p);p=f.descentZ(t,p);b[v]={ascent:A,descent:p};t=!0}A.toPrecision.call.a;p.toPrecision.call.a;u+=A;w+=p;A=[];C=0;E=[];if(t&&121<(Date.now?Date.now():+new Date)-
l){x=!1;break}}}q=(l=n&&x)&&alp.map(g,".hash");n=l&&a.elevationSummary.get_property("hash");if(!(q&&n&&alp.arrEqual(q,n))){n=-Infinity;y=x=null;z=Infinity;A=t=null;for(q=0;q<r;q++)if(v=g[q].hash,v=e[v])p=v.highest,C=v.lowest,p>n&&(n=p,x=g[q],y=v),C<z&&(z=C,t=g[q],A=v);alp.isFiniteNumber(u)&&alp.isFiniteNumber(w)&&(r=g[0],q=g[g.length-1],r&&q&&(r=r.gll_arr[0],q=g[g.length-1].gll_arr,q=q[q.length-1],v=alp.m(r,"z"),p=alp.m(q,"z"),r&&q&&.1>Math.abs(v-p)&&(w=u=(u+w)/2)));if(p=a._opts.preferManualElevationSummary&&
a._opts.elevation)r=p.maxAltitude,q=p.minAltitude,v=p.ascent,p=p.descent,alp.isFiniteNumber(v)&&(u=v),alp.isFiniteNumber(p)&&(w=p),alp.isFiniteNumber(r)&&(n=r),alp.isFiniteNumber(q)&&(z=q);r=x&&y?g.cum_d[x.piece_ind]+y.highest_d_piece:null;q=t&&A?g.cum_d[t.piece_ind]+A.lowest_d_piece:null;a.elevationSummary.setNow(alp.and([u,w,n,z,r,q],"alp.isFiniteNumber(v)")?{all:l,ascent:u,descent:w,highest:{z:n,d:r,x:y.highest_x,y:y.highest_y},lowest:{z:z,d:q,x:A.lowest_x,y:A.lowest_y},_highest_piece_hash:x.hash,
_highest_piece_v_ind:y.highest_ind,_lowest_piece_hash:t.hash,_lowest_piece_v_ind:A.lowest_ind,d:g.d}:null);l||alp.asyncF(206.91,k)(a)}}}var h=alp._gmap2_3,g=alp.sub("models",h.digitize,!0),f=alp.maps;g.InterfacePolyDeriveElevation={derive_elevation_summary_in_background:function(){function a(){b.elevationSummary.setNow();k(b)}var b=this;b.install_elevation_service_in_background();b.elevationSummary||(b.elevationSummary=new alp.ObjectState);var c=alp.ratelimitF(441,a);b.geomChangeEvt().thenSoon(c);
b.zChangeEvt().thenSoon(c);a()},elevationSummary:null};var e={},d=0,b={},c})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.elevation");
(function(){var k=alp.sub("alp.data.api",null,!0),h=alp.util.url_hash;k.elevation=function(g){for(var f=alp.dfrd("ADA_elevation",{then:1}),e=g.length,d=[],b=[],c=alp.cfg.url.api_elevation(),a=0;a<e;a+=240){var m=g.slice(a,a+240),l=h.encodeURIComponentExceptComma(alp.map(m,'v.lat  &&  v.lat.call  ?  v.lat().toFixed(10).replace(/0+$/,"")+","+v.lng().toFixed(10).replace(/0+$/,"")  :  v[1].toFixed(10).replace(/0+$/,"")+","+v[0].toFixed(10).replace(/0+$/,"")').join("|"));l=alp.tmpl(c,{locations:l});b.push(alp.jsonp(l,
{cache:!0}));d.push(m.length)}g=alp.gatherDfrd(b);g[g.to?"to":"thenSoon"](function(a){for(var b=a.length,c=[],e=0;e<b;e++){var l=d[e],g=a[e][0],m=g&&g.status;"OK"!==m?(console.error("alp.data.api.elevation: backend returned failure "+m,g),c.push(alp.arrRep([null],l))):(g.results.splice.call.a,c.push(g.results))}f.done(alp.arrChain(c))});return f}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_rpm_elevation_in_background");
(function(){function k(e,d,b){function c(){e.geomChangeEvt().triggerSoon();e.zChangeEvt().triggerSoon()}try{var a=d.node_ind_arr,g=d.segment_arr;if(d.node_arr)for(var l=e._nodes,r=a.length;r--;){var n=a[r],q=l[n],p=q&&q.lat(),k=q&&q.lng(),u=b[r];u&&q&&1>Math.max(Math.abs(p-u[1]),Math.abs(k-u[0]))&&l.splice(n,1,new h.LatLngZD(p,k,!1,u[2],null))}else if(g){var t=g.length;for(r=d=0;r<t;r++){var w=g[r],x=w.vert_ind_arr,y=e._segments[w.seg_ind],z=y&&y.vertices;if(z){a=0;for(var A=x.length;a<A;a++,d++){u=
b[d];var C=x[a],E=z[C];p=E&&E.lat();k=E&&E.lng();u&&E&&1E-5>Math.max(Math.abs(p-u[1]),Math.abs(k-u[0]))&&z.splice(C,1,new h.LatLngZD(p,k,!1,u[2],null))}}else d+=x.length}}}finally{e[f]=!1,alp.asyncF(123,alp.nowF(c))()}}var h=alp._gmap2_3;alp.sub("models",h.digitize,!0).InterfaceRPMElevationInBackground={install_elevation_service_in_background:alp.nowF(function(){if(!this[g]){this[g]=!0;var e=alp.ratelimitF(100,"_complete_elevation_if_needed",this);this.geomChangeEvt().thenSoon(e);this.zChangeEvt().thenSoon(e);
this._complete_elevation_if_needed()}}),zChangeEvt:alp.memM("zChangeEvt",'alp.event("APM:i_rpm_elev_bg",{then:1})'),_complete_elevation_if_needed:alp.nowF(function(e,d,b,c){if(!this[f]){this[f]=!0;c=this._nodes;var a=c.length;e=[];d=[];for(b=0;b<a&&1E3>e.length;b++){var g=c[b];!g||"z"in g&&"function"===typeof g.z&&alp.isFiniteNumber(g.z())||(e.push(g),d.push(b))}if(0===e.length){c=this._segments;a=c.length;var l=[];for(b=0;b<a;b++)if((g=(g=c[b])&&g.vertices)&&g.length){var h=g.length;if(0!==alp.filter([g[0],
g[1],g[h>>1],g[h-2],g[h-1]],"!(v  &&  v.z  &&  v.z.call  &&  null != v.z())")){for(var n=[],q=[],p=0;p<h;p++){var v=g[p],u;"z"in v&&"function"===typeof v.z&&(u=v.z(),(u||0===u)&&Infinity!==u&&-Infinity!==u)||(n.push(v),q.push(p))}n.length&&l.push({seg_ind:b,vert_arr:n,vert_ind_arr:q})}}}e.length?alp.data.api.elevation(e).thenSoon(alp.bindF(k,null,this,{node_arr:e,node_ind_arr:d})):l.length?alp.data.api.elevation(alp.arrChain(alp.map(l,".vert_arr"))).thenSoon(alp.bindF(k,null,this,{segment_arr:l})):
this[f]=!1}})};var g="_elevation_service_in_background_was_installed",f="_elevation_service_in_background_running"})();"undefined"!==typeof dojo&&dojo.provide("alp.cfg._app");alp.sub("alp.cfg",null,!0).app=function(){var k=alp.sub("alpregioConfig.proj"),h=(alp.sub("oa_v2")||alp.sub("oax")||alp.sub("oam"))&&"outdooractive",g=alp.sub("alpcms")&&"alpcms",f=alp.sub("alp.gmap.api")&&"alp.gmap.api",e=alp.sub("alp.gmap3.api")&&"alp.gmap3.api";return k&&"alpregio."+k||h||g||f||e||"other"};
"undefined"!==typeof dojo&&dojo.provide("alp.cfg.routing");alp.i18n.fetch("alp.all");
(function(){var k,h,g=alp.sub("alp.cfg",null,!0),f={};alp.i18n.fetch("alp.all").then(function(d){f=d});g.routing=function(){var d=function(){return f[this.name]},b=function(a){var b=f;a=this.name||a&&a.networkName;return b&&b["routing_start_"+a]||""},c=function(a){var b=alp.sub("alp.cfg.gtilelayeroverlay");a=this.name||a&&a.networkName;return b&&b[a]&&b[a]()},a=function(a){var b=a+"&itdDate=${localDateTime.fullYear}${localDateTime.month_1}${localDateTime.date}&itdTime=${localDateTime.hours}${localDateTime.minutes}";return function(a){return alp.tmpl(b,
a,function(a){return alp.sPad(a+"",2,"0")})+alp.tmpl("&bikeTakeAlong=${bikeTakeAlong}&includedMeans=${includedMeans}&inclMOT_0=${inclMOT_0}&inclMOT_1=${inclMOT_1}",a)}},e=function(a){var b="function"===typeof a;return function(){return(b?a.apply(null,arguments):a)+"&app="+alp.cfg.app()}},l=[{name:"hiking",title:d,url:e("//routing.outdooractive.com/routingengine/getroute?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20hikingTourTrail%29&format=js"),engineClass:"alp.routing.DirectionsService",
isDefault:!0,startMessage:b,tilelayeroverlay:c,publictransport:{url:e(a("//routing.outdooractive.com/routingengine/mixed?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20hikingTourTrail%29&format=js")),engineClass:"alp.routing.DirectionsService"}},{name:"signpostedHiking",title:d,url:e("//routing.outdooractive.com/routingengine/getroute?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20hikingTourTrail%29&format=js"),engineClass:"alp.routing.DirectionsService",
startMessage:b,tilelayeroverlay:c,publictransport:{url:e(a("//routing.outdooractive.com/routingengine/mixed?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20hikingTourTrail%29&format=js")),engineClass:"alp.routing.DirectionsService"}},{name:"longDistanceHiking",title:d,url:e("//routing.outdooractive.com/routingengine/getroute?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20longDistanceHikingTrail%29&format=js"),engineClass:"alp.routing.DirectionsService",
startMessage:b,tilelayeroverlay:c,publictransport:{url:e(a("//routing.outdooractive.com/routingengine/mixed?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20longDistanceHikingTrail%29&format=js")),engineClass:"alp.routing.DirectionsService"}},{name:"cycling",title:d,url:e("//routing.outdooractive.com/routingengine/getroute?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20cycling%29&format=js"),engineClass:"alp.routing.DirectionsService",startMessage:b,
tilelayeroverlay:c,publictransport:{url:e(a("//routing.outdooractive.com/routingengine/mixed?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20cycling%29&format=js")),engineClass:"alp.routing.DirectionsService"}},{name:"horseback",title:d,url:e("//routing.outdooractive.com/routingengine/getroute?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20horsebackRidingTour%29&format=js"),engineClass:"alp.routing.DirectionsService",startMessage:b,tilelayeroverlay:c,
publictransport:{url:e(a("//routing.outdooractive.com/routingengine/mixed?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20horsebackRidingTour%29&format=js")),engineClass:"alp.routing.DirectionsService"}},{name:"longDistanceCycling",title:d,url:e("//routing.outdooractive.com/routingengine/getroute?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20longDistanceCyclingTrack%29&format=js"),engineClass:"alp.routing.DirectionsService",startMessage:b,
tilelayeroverlay:c,publictransport:{url:e(a("//routing.outdooractive.com/routingengine/mixed?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20longDistanceCyclingTrack%29&format=js")),engineClass:"alp.routing.DirectionsService"}},{name:"mountainbiking",title:d,url:e("//routing.outdooractive.com/routingengine/getroute?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20mountainbiking%29&format=js"),engineClass:"alp.routing.DirectionsService",startMessage:b,
tilelayeroverlay:c,publictransport:{url:e(a("//routing.outdooractive.com/routingengine/mixed?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20mountainbiking%29&format=js")),engineClass:"alp.routing.DirectionsService"}},{name:"transalpMountainbiking",title:d,url:e("//routing.outdooractive.com/routingengine/getroute?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20transalpMountainbiking%29&format=js"),engineClass:"alp.routing.DirectionsService",
startMessage:b,tilelayeroverlay:c,publictransport:{url:e(a("//routing.outdooractive.com/routingengine/mixed?jsgeom=%28string%200%201%202%203%29&linref=(waytype)&costff=%28sport-preset%20transalpMountainbiking%29&format=js")),engineClass:"alp.routing.DirectionsService"}},{name:"google",title:d,engineClass:alp._gmap2_3.V3()?"google.maps.DirectionsService":"GDirections",startMessage:b,tilelayeroverlay:c}];l._defaultName=alp.filter(l,function(a){return a.isDefault})[0].name;l._find=function(a){for(var b=
l.length;b--;)if(l[b].name===a)return l[b];if(a!==l._defaultName)return l._find(l._defaultName)};(function(){var a={};alp.forEach(l,function(b){a[b.name]=b});l._find_approx=alp.oKeyFindGen(a)})();return l};g.routingengine=function(d){var b=(alp.opt(location.search.match(/[?&]proto=(.*?)(&|$)/),1)||"").split(","),c=-1<alp.indexOf(b,"unstable"),a=-1<alp.indexOf(b,"osrm"),g=-1<alp.indexOf(b,"roadbook")||d&&d.roadbookRouting,l=-1<alp.indexOf(b,"testing"),h=function(){return f["engine_"+this.name]},n=
function(a){return alp.opt(f,"routing_start_engine_"+(a||this.name))||"Routing..."},q=alp.cfg.datatype(),p=alp.opt(location.search.match(/[?&]rtgsrv=(.*?)(?:&|$)/),1)||"",k=alp.opt(location.search.match(/[?&]rtgurl=(.*?)(?:&|$)/),1)||"",u=function(a,b,c){c=c&&c.use_datatypename_as_routingnetwork?"datatype_name":"routing_network";p&&(a=a.replace(/\/\/[^\/]+\//,"//"+p+"/"));k&&(a=/^(?:https?:)?\/\//.test(k)?k:"//"+k);a=a+"?jsgeom=%28string%200%201%202%203%29&linref=(waytype"+(g?"%20street%20routes%20crossing":
"")+")&costff=%28sport-preset%20${"+c+"}%20${ksf_name}%20${speed_kmh}%29&format=js";a=a+("&fromsnap=%28preset%20${fromsnap_t}%20${fromsnap_"+c+"}%20${from_failure_t}%29")+("&tosnap=%28preset%20${tosnap_t}%20${tosnap_"+c+"}%20${to_failure_t}%29");c=b.has_public_transport?"&itdDate=${localDateTime.fullYear}${localDateTime.month_1}${localDateTime.date}&itdTime=${localDateTime.hours}${localDateTime.minutes}":"";var d=b.has_public_transport?"&bikeTakeAlong=${bikeTakeAlong}&includedMeans=${includedMeans}&inclMOT_0=${inclMOT_0}&inclMOT_1=${inclMOT_1}":
"",l=function(a){a=alp.oKeys(a);a.sort();return alp.filter(a,"").join(" ")}(alp.m(b.m_routing_source_set,"get")||{});l=l?"&source=("+l+")":"";var f=b.fromsnap_t,m=b.tosnap_t;b=alp.oCreateMix({from_failure_t:0<f?Math.max(e,2*f):"",to_failure_t:0<m?Math.max(e,2*m):""},b);return alp.tmpl(a,b)+alp.tmpl(c,b,function(a){return alp.sPad(a+"",2,"0")})+alp.tmpl(d,b)+l},t=function(){return[{name:"outdooractive",isDefault:!0,title:h,startMessage:n,routing_cfg:function(b){var d={},e=b.has_public_transport&&b.public_transport&&
b.public_transport!==alp._gmap2_3.digitize.PUBLIC_TRANS_NONE();d.url=u("//routing"+(c||l?"testing":"")+".outdooractive.com/"+(a||b.osrm?"r/osrm":"routingengine")+"/"+(e?"mixed":"getroute"),b)+"&app="+alp.cfg.app();d.engineClass="alp.routing.DirectionsService";return d},gtilelayeroverlay_name:function(a){return alp.opt(q[a.datatype_name],"default_network")}},{name:"osrm",isDefault:!0,title:h,startMessage:n,routing_cfg:function(a){var b={},d=a.has_public_transport&&a.public_transport&&a.public_transport!==
alp._gmap2_3.digitize.PUBLIC_TRANS_NONE();b.url=u("//routing"+(c||l?"testing":"")+".outdooractive.com/r/osrm/"+(d?"mixed":"getroute"),a)+"&app="+alp.cfg.app();b.engineClass="alp.routing.DirectionsService";return b},gtilelayeroverlay_name:function(a){return alp.opt(q[a.datatype_name],"default_network")}},{name:"google",title:h,startMessage:n,routing_cfg:{engineClass:alp._gmap2_3.V3()?"google.maps.DirectionsService":"GDirections",travelMode:function(a){return alp.opt(q[a.datatype_name],"travelMode")||
"WALKING"}}}]}();alp.cfg.routing();t._defaultName=alp.filter(t,function(a){return a.isDefault})[0].name;t._obj={};t._ind={};alp.forEach(t,function(a,b){t._obj[a.name]=a;t._ind[a.name]=b});t._mix=function(a,b){var c=a.split(",");b=b&&b.routingengine_name_modifier;var d=alp.filter(c,"!(v in this)",t._obj);if(d.length)throw Error("mix: Unknown routing engines: "+d.join(", "));return{name:a,re_name_arr:b?alp.bindF(b,null,c):c,title:h,startMessage:n,gtilelayeroverlay_name:alp.or(c,"this._obj[v].gtilelayeroverlay_name",
t),routing_cfg:function(a){return{engineClass:"alp.routing.MixedDirectionsService",re_name_2_routing_cfg:function(b){return alp.fVal(t._obj[b].routing_cfg,a)}}}}};return t};g.routingengine_status=function(){function d(){var b=alp.cfg.routing_frontend_status();b={ERROR:b.UNKNOWN_ERROR,ALPSTEIN_OUT_OF_NETWORK:b.OUT_OF_NETWORK,INVALID_REQUEST:b.INVALID_REQUEST,MAX_WAYPOINTS_EXCEEDED:b.MAX_WAYPOINTS_EXCEEDED,NOT_FOUND:b.NOT_FOUND,OK:b.OK,OVER_QUERY_LIMIT:b.OVER_QUERY_LIMIT,REQUEST_DENIED:b.REQUEST_DENIED,
UNKNOWN_ERROR:b.UNKNOWN_ERROR,ZERO_RESULTS:b.ZERO_RESULTS};alp.forIn(b,function(b,a){if(!b)throw Error('alp.cfg.routingengine_status(): found a configuration bug! Unknown `routing_frontend_status` constant for `routingengine_status` constant: "'+a+'"');});Object.freeze&&Object.freeze(b);return b}return h=h||d()};g.routing_frontend_status=function(){function d(){function b(a){return function(){return f["routing_frontend_status_"+a]}}for(var c={},a="INVALID_REQUEST MAX_WAYPOINTS_EXCEEDED NOT_FOUND OK OUT_OF_NETWORK OVER_QUERY_LIMIT REQUEST_DENIED UNKNOWN_ERROR ZERO_RESULTS".split(" "),
d=a.length;d--;){var e=a[d];c[e]=b(e);Object.freeze&&Object.freeze(c[e])}Object.freeze&&Object.freeze(c);return c}return k=k||d()};var e=g.ROUTING_FAILURE_MIN_DIST=1E3})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models._publictransport");
(function(){var k=alp.sub("alp._gmap2_3.digitize.models._publictransport",null,!0),h=alp._gmap2_3.digitize,g=h.PT_FROM_POINT(),f=h.PT_TO_POINT();h.PT_FROM_PROP();var e=h.PT_TO_PROP();h.PT_START_LOCATION();var d=h.PT_END_LOCATION(),b=h.PT_TRAVEL_MODE();k.simplify=function(c){c=c.slice();c.sort(function(a,b){return a.from_point-b.from_point});for(var a=c.length,m,l,h,n,q;a--;)m=a-1,-1<m&&(l=c[m])&&(h=c[a])&&(n=l[b])&&n===h[b]&&alp.isFiniteNumber(q=l[f])&&q===h[g]&&(c.splice(a,1),alp.mix(l,alp.opt(h,
[f,e,d])));return c}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.topic");(function(){function k(h){return k[h]||(k[h]=alp.mix(alp.event(h,{then:1}),{trigger:alp.nowF("triggerSoon")}))}alp.sub("alp._gmap2_3.digitize",null,!0).topic=k})();"undefined"!==typeof dojo&&dojo.provide("alp.humane");"undefined"!==typeof dojo&&dojo.provide("alp.cfg.linref");
(function(){alp.sub("alp.cfg",null,!0).linref=function(){return{attributes:{availableKeys:[{id:"waytype",values:[{id:"0",color:"#909090"},{id:"1",color:"#333333"},{id:"2",color:"#00ff00"},{id:"3",color:"#ff0000"},{id:"4",color:"#0000ff"},{id:"5",color:"#ff7f00"},{id:"6",color:"#ffec01"},{id:"7",color:"#000000"},{id:"8",color:"#555aff"},{id:"9",color:"#543299"},{id:"10",color:"#996732"},{id:"11",color:"#e6e6e6"},{id:"_default",color:"#9a9a9a"}]}],newAttributes:!1,newValues:!1},profileNode:"attributeProfile"}}})();
"undefined"!==typeof dojo&&dojo.provide("alp.cfg.publictransport");
(function(){var k=alp.sub("alp.cfg",null,!0);k.publictransport=function(){var h=function(){return{bus:{img:alp.urlCachebust(alp.cssBase()+"alp/images/public_transport_bus.png"),img_title:"Bus",img_width:20,img_height:20,strokeColor:"#8a1b64"},none:function(f){var e=(f=alp.cfg.datatype()[f])&&f.default_network;if(e=e&&e.toLowerCase()){if(-1<e.indexOf("hiking"))return{img:alp.urlCachebust(alp.cssBase()+"alp/images/public_transport_none_hiking.png"),img_title:f.title,img_width:22,img_height:22};if(-1<
e.indexOf("cycling"))return{img:alp.urlCachebust(alp.cssBase()+"alp/images/public_transport_none_cycling.png"),img_title:f.title,img_width:22,img_height:22}}},regionalbahn:{img:alp.urlCachebust(alp.cssBase()+"alp/images/public_transport_regionalbahn.png"),img_title:"Zug/Bahn",img_width:20,img_height:20,strokeColor:"#404040"},regionalbus:"bus","r-bahn":"regionalbahn","s-bahn":{img:alp.urlCachebust(alp.cssBase()+"alp/images/public_transport_s-bahn.png"),img_title:"S-Bahn",img_width:20,img_height:20,
strokeColor:"#5da82c"},schiff:{img:alp.urlCachebust(alp.cssBase()+"alp/images/public_transport_schiff.png"),img_title:"Schiff",img_width:20,img_height:20,strokeColor:"#00738b"},seilbahn:{img:alp.urlCachebust(alp.cssBase()+"alp/images/public_transport_seilbahn.png"),img_title:"Seilbahn",img_width:20,img_height:20,strokeColor:"#303030"},stadtbahn:"u-bahn",stadtbus:"bus",tram:{img:alp.urlCachebust(alp.cssBase()+"alp/images/public_transport_tram.png"),img_title:"Tram",img_width:20,img_height:20,strokeColor:"#c10000"},
"u-bahn":{img:alp.urlCachebust(alp.cssBase()+"alp/images/public_transport_u-bahn.png"),img_title:"U-Bahn",img_width:20,img_height:20,strokeColor:"#009de2"}}}(),g=alp.oKeyFindGen(h,{excluded:"_find"});h._find=function(f){for(var e=f;;){e=g(e);var d=h[e];if("string"!==typeof d)return e;if(!d||d==e)return console.error("alp.cfg.publictransport is buggy, name:",f,", key:",e,", x:",d),e;e=d}};return h};k.publictransport_travel_mode_2_alpstein=function(){var h=[{id:"none","default":!0,travel_mode:["","ALPSTEIN",
"ALPSTEIN_ROUTING","WALKING"]},{id:"mentz_pt_underground",iconid:"u-bahn",travel_mode:["MENTZ_PT_UNDERGROUND"]},{id:"mentz_pt_commutertrain",iconid:"s-bahn",travel_mode:["MENTZ_PT_COMMUTERTRAIN"]},{id:"mentz_pt_bus",iconid:"bus",travel_mode:["MENTZ_PT_BUS"]},{id:"mentz_pt_tram",iconid:"tram",travel_mode:["MENTZ_PT_TRAM"]},{id:"mentz_pt_lowplatformbus",iconid:"bus",travel_mode:["MENTZ_PT_LOWPLATFORMBUS"]},{id:"mentz_pt_train",iconid:"regionalbahn",travel_mode:["MENTZ_PT_TRAIN"]},{id:"mentz_pt_suspensionrailway",
iconid:"regionalbahn",travel_mode:["MENTZ_PT_SUSPENSIONRAILWAY"]},{id:"mentz_pt_line_demandbus",iconid:"bus",travel_mode:["MENTZ_PT_LINE_DEMANDBUS"]},{id:"mentz_pt_cablerailway",iconid:"seilbahn",travel_mode:["MENTZ_PT_CABLERAILWAY"]},{id:"mentz_pt_ship",iconid:"schiff",travel_mode:["MENTZ_PT_SHIP"]},{id:"mentz_pt_rackrailway",iconid:null,travel_mode:["MENTZ_PT_RACKRAILWAY"]},{id:"mentz_pt_haengeseilbahn",iconid:"seilbahn",travel_mode:["MENTZ_PT_HAENGESEILBAHN"]},{id:"mentz_pt_museumrailway",iconid:null,
travel_mode:["MENTZ_PT_MUSEUMRAILWAY"]},{id:"mentz_pt_plane",iconid:null,travel_mode:["MENTZ_PT_PLANE"]},{id:"mentz_pt_vienna_s_bahn",iconid:"s-bahn",travel_mode:["MENTZ_PT_VIENNA_S_BAHN"]},{id:"mentz_pt_area_demandbus",iconid:"bus",travel_mode:["MENTZ_PT_AREA_DEMANDBUS"]},{id:"mentz_pt_check_inout",iconid:null,travel_mode:["MENTZ_PT_CHECK_INOUT"]},{id:"mentz_pt_systemchange",iconid:null,travel_mode:["MENTZ_PT_SYSTEMCHANGE"]},{id:"mentz_pt_throughconnect",iconid:null,travel_mode:["MENTZ_PT_THROUGHCONNECT"]},
{id:"mentz_pt_assuredconnect",iconid:null,travel_mode:["MENTZ_PT_ASSUREDCONNECT"]},{id:"mentz_pt_footpath",iconid:null,travel_mode:["MENTZ_PT_FOOTPATH"]},{id:"mentz_it_walk",iconid:null,travel_mode:["MENTZ_IT_WALK"]},{id:"mentz_it_park_bike",iconid:null,travel_mode:["MENTZ_IT_PARK_BIKE"]},{id:"mentz_it_carry_bike",iconid:null,travel_mode:["MENTZ_IT_CARRY_BIKE"]},{id:"mentz_it_kiss_ride",iconid:null,travel_mode:["MENTZ_IT_KISS_RIDE"]},{id:"mentz_it_park_ride",iconid:null,travel_mode:["MENTZ_IT_PARK_RIDE"]},
{id:"mentz_it_taxi",iconid:null,travel_mode:["MENTZ_IT_TAXI"]},{id:"mentz_it_car",iconid:null,travel_mode:["MENTZ_IT_CAR"]},{id:"mentz_it_bike",iconid:null,travel_mode:["MENTZ_IT_BIKE"]}];(function(g){var f={};alp.forEach(g,function(e,d){f[e.id]=d});g._id_2_index=function(e){return f[e]}})(h);(function(g){g._id_2_obj=function(f){f=g._id_2_index(f);return g[f]}})(h);(function(g){var f={};alp.forEach(g,function(e){alp.forEach(e.travel_mode,function(d){f[d]=e.id})});g._travel_mode_2_travel_mode=alp.oKeyFindGen(f);
g._travel_mode_2_id=function(e){e=g._travel_mode_2_travel_mode(e);return f[e]}})(h);return h}})();"undefined"!==typeof dojo&&dojo.provide("alp.routing.extract");
alp.gmap3(function(k){function h(a,c){if(!a._ARE_stuff){var d=a.result,l=a.status,h=alp.opt(d,"ioArgs"),k=a._ARE_stuff={},r=alp.date2str();null==d.length&&d.routes&&(d=d.routes);k.status=l;if("OK"==l){k[v]=a.result[v];d=d[0];var w=d.legs[0];h=f(w,h&&h.url);l=w.steps;w=[];for(var x=0,t=l.length;x<t;x++)w=w.concat(g(l[x]));k.path=w;d=e(l).concat(d.Attributes||[]);d=b(d);k.attributes=d;k.duration_obj=h;alp.forEach(k.attributes,'v["'+n+'"]="'+p+'",v["'+q+'"]="'+r+'"')}}c&&c.polyline&&!a.polyline&&(k.polyline=
m.polylineGen({path:w}));return a._ARE_stuff}function g(a){if(a.path)return a.path;a.polyline?a=m.decodePolyline(a.polyline).xy:(a=alp.map(a.geom.split(" "),'.split(",")'),a=alp.map(a,a[0]&&a[0][2]&&a[0][3]?"[ parseFloat(v[0]), parseFloat(v[1]), parseFloat(v[2]), parseFloat(v[3]) ]":"[ parseFloat(v[0]), parseFloat(v[1]) ]"));return m[a[0]&&"number"===typeof a[0][2]&&"number"===typeof a[0][3]?"xyzd2latlngzd":"xy2latlng"](a)}function f(b,d){var e;d=r.s2o(alp.opt((d&&decodeURI(d)||"").match(/\?(.+?)(?:$|#)/),
1)||"");var l=alp.opt(d,"costff");l&&(l=/^\s*\(\s*(\S+\s+){3,3}([\d\.]+)\D+$/.exec(l))&&(e=parseFloat(l[2]));l=(l=alp.oGet(b,"duration.value"))?1E3*l:null;var f=b.steps;l=alp.isFiniteNumber(l)?l:null;if(null!=l&&f&&f[0]&&f[0].travel_start&&f[0].travel_end){var g=alp.opt(d,"itdDate");var m=alp.opt(d,"itdTime");g=g&&m?new Date(g.substring(0,4),g.substring(4,6)-1,g.substring(6,8),m.substring(0,2),m.substring(2,4),0):a(f[0].travel_start);g=c(f)-g}alp.isFiniteNumber(g)?1>Math.abs(g-l)||(console.error("alp.routing.extract.eg_2_duration(): inconsistent durations! Picking the conservative one.",
b,d),g=Math.max(g,l)):g=l;b={};alp.isFiniteNumber(g)&&(b.value_ms=g);alp.isFiniteNumber(e)&&(b.flat_speed_kmh=e);return b}function e(a,b){b||(b=u.DEFAULT_CFG());var c=[],e=alp.map(a,g),l=alp.map(e,m.pathLength),f=alp.reduce(l,"+"),n=alp.map(l,"/"+f),p=alp.reduce(e,"+w.length",0),q=0;alp.forEach(a,function(a,l){var f=d(a.travel_mode,b);c[l]={};var m=l?alp.oGet(c[l-1],"extra.to_prop"):0,h=Math.min(1,m+n[l]),r=Math.min(p-1,Math.max(0,q)),v=Math.min(p-1,Math.max(r,q+=e[l].length)),w=g(a);a=alp.mapIn(alp.filterIn(alp.opt(a,
"travel_mode travel_start travel_end travel_line mentz_info start_location end_location".split(" ")),alp.f()),function(a,b){"start_location"===b?a=w[0]:"end_location"===b&&(a=w[w.length-1]);return a instanceof k.LatLng?{x:a.lng(),y:a.lat()}:a});if(0<alp.oKeys(a).length){if(f=alp.opt(b._id_2_obj(f),"iconid"))a.publictransport_iconid=f;a.from_prop=m;a.to_prop=h;a.from_point=r;a.to_point=v;c[l].extra=a}});return c}function d(a,b){b||(b=u.DEFAULT_CFG());a=b._travel_mode_2_id(a);if(!a)throw Error("alp.cfg.linref()...publictransport is buggy!");
return a}function b(a){function b(a,b){return a.from-b.from}var c=alp.filter(a,'.key!=="routes"');a=alp.filter(a,'.key==="routes"').sort(b);var d=alp.reduce(a,"v[w.from]=1,v[w.to]=1,v",{}),e=alp.map(alp.oKeys(d),"parseFloat(v)").sort(function(a,b){return a-b});a=alp.reduce(a,function(a,b){var c=b.from,d=b.to,l=alp.filter(e,c+1E-5+"<v && v<"+(d-1E-5));l.push(d);d=l.length;for(var f=0;f<d;f++){var g=l[f];a.push(alp.mix({},b,{from:c,to:g}));c=g}return a},[]).sort(b);a=alp.reduce(a,function(a,b){var c=
a[a.length-1];c&&c.from===b.from&&c.to===b.to?("string"===typeof c.value&&(c=a[a.length-1]={key:c.key,from:c.from,to:c.to,value:[[c.rid,c.sport,c.value].join("^")]}),c.value.push([b.rid,b.sport,b.value].join("^"))):a.push(b);return a},[]);(function(a){for(var b=a.length;b--;){var c=a[b];"string"!==typeof c.value&&(c.value=c.value.sort().join("###"))}})(a);return a.concat(c).sort(b)}function c(b){for(var c=0,d=b.length;d--;){var e=b[d],l=e.travel_end;if(l)return a(l,c);e=alp.oGet(e,"duration.value");
if(null==e)break;c+=e}}function a(a,b){a=new Date(a.year,a.month-1,a.day,a.hour,a.minute,0);return null==b?a:new Date(a.valueOf()+1E3*b)}var m=alp._gmap2_3,l=m.digitize,r=alp.util.url_hash,n=l.LINREF_ORIGIN(),q=l.LINREF_ORIGIN_DATETIME(),p=l.LINREF_ORIGIN_SERVER(),v=l.ROUTING_ENGINE_FINAL(),u=alp.sub("alp.routing",null,!0).extract=function(a,b){return alp.oCreateMix(t,{result:a,status:b})},t={getAttributes:function(){return h(this).attributes},getPath:function(){return h(this).path},getPolyline:function(){return h(this,
{polyline:!0}).polyline},getStatus:function(){return h(this).status},getDurationMs:function(){return alp.opt(this.getDurationObj(),"value_ms")},getDurationObj:function(){return h(this).duration_obj},getRoutingEngineFinal:function(){return h(this)[v]}};u.DEFAULT_CFG=alp.memF("alp.cfg.publictransport_travel_mode_2_alpstein()");u.leg_2_duration=f;u.map_to_attributes=e;u.step2path=g;u.steps_2_date_end=c;u.travel_mode_2_value=d;u.t_2_date=a});
"undefined"!==typeof dojo&&(dojo.provide("alp.routing.DirectionsService"),dojo.provide("alp.routing.DirectionsService_fake_result"));
alp.gmap3(function(k){var h=alp.routing,g=alp.cfg.routingengine_status();alp.declare("alp.routing.DirectionsService",null,null,{humane:!0,setUrl:function(f){this.url=f},timeout_ms:null,route:function(f,e){function d(a){m.load(a,m)}var b=this;console.log("alp.routing.DirectionsService route()",f,!!e," url:",b.url);if(/[\?&]proto=[^&]*\bsimul\b/.test(location.search)||/[#&]proto=[^&]*\bsimul\b/.test(location.hash)){var c=h.DirectionsService_fake_result(f);setTimeout(function(){e(c,"OK")},1E3)}else{var a=
b.url.replace(/\?(locale|q)=[^&]*/g,"?").replace(/&(locale|q)=[^&]*/g,"");a+=(/\?/.test(a)?"&":"?")+"locale="+(b.locale||alp.i18n.language())+"&q=from:"+f.origin.lat()+","+f.origin.lng()+" to:"+f.destination.lat()+","+f.destination.lng();console.log("alp.routing.DirectionsServicexxx Requesting URL: ===========",a);var m={url:a,load:function(a,c){console.log("alp.routing.DirectionsService xxx Receiving route result",a,c);var d=alp.opt(a,"status");a=alp.mix([].concat(a&&a.routes||[]),{ioArgs:c});b.humane&&
d&&"OK"!==d&&b.humane&&((c=g[d])?alp.humane('<p class="error">'+c()+"</p>"):console.error("alp.routing.DirectionsService.onerror("+d+"): unknown routing engine status: "+d));e(a,d)},error:function(a,b){e(alp.oCreateMix(a,{ioArgs:b}),"ERROR")}};0<b.timeout_ms&&alp.util.isFiniteNumber(b.timeout_ms)&&(m.timeout=b.timeout_ms);alp.jsonp(m.url,{cache:!0}).then(d)}}})});"undefined"!==typeof dojo&&dojo.provide("alp.routing.mixed_directions_service");
(function(){var k=alp._gmap2_3.digitize.ROUTING_ENGINE_FINAL();alp.declare("alp.routing.MixedDirectionsService",null,null,{setUrl:alp.f(),alp_setRouteCfg:function(h){this.routeCfg=h},route:function(h,g){function f(){function c(b,c){/^ok$/i.test(c)||d?(b[k]=a,g(b,c)):d||f()}var a=b.shift(),d=1>b.length,l=e.routeCfg.re_name_2_routing_cfg(a),r=alp.sub(l.engineClass);r?(r=new r,r.humane=d,alp.m(r,"setUrl",l.url),r.route(h,c)):(console.error('mixed_routing_service could not find engine "'+l.engineClass),
c({},"ROUTING_ENGINE_NOT_AVAILABLE"))}var e=this,d=alp.fVal(e.routeCfg.re_info.re_name_arr),b=[].concat(d);f()}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_rpm_routing_engine");
alp.gmap3(function(k){function h(a,b,c,e,m,p,h){function r(a,b){O=alp.routing.extract(a,b);"OK"==b?T.triggered()||T.done(!0):v()}function v(){console.error("Got error from routing engine!",arguments," - status:",O.getStatus());if(!h){var b=a._segments[p];b&&(a._length=null,a._segmentLengths=null,b.vertices=[a._nodes[p],a._nodes[p+1]],a._resetVerticeCache(),a.attributes.clear(p,p+1),a.onChangeSegment(p),a.onGeomChange(a,p))}T.done(!1)}function x(a){a=alp.m(O,"getPath");b.done(a)}function y(d){-1<alp.lastIndexOf(a._segments,
c)||(T.done(!1),b.done(!1))}function z(){Q.clear();e=null}function G(a){f.topic("/alp/_gmap2_3/digitize/routing/end").trigger(R,a,O.getStatus())}function C(){O=null}function A(b){var f=O.getPath();if(f){var g=f.length;c.vertices=f;c.midPoint=null;b=alp.indexOf(a._segments,c);a.attributes.clear(b,b+1);var h=alp.m(O,"getAttributes");if(h){for(var k=0;k<h.length;k++){var r=h[k];null!=r.from&&null!=r.to&&null!=r.key&&null!=r.value&&a.attributes.set(b+r.from,b+r.to,r.key,r.value,r[w],alp.filterIn(r,"!(w in { key:1, value:1, from:1, to:1 })"))}h=
d.simplify(alp.map(alp.filter(h,".extra"),"alp.oCopy(v.extra)"));a.node_info.set_property([p,l,q],h)}h=alp.m(O,"getDurationObj");"object"===typeof h&&a.node_info.set_property([p,l,n],h);h=alp.m(O,"getRoutingEngineFinal");if(/mixed/i.test(a._opts.routingEngineClass)&&!h)throw Error("A mixed routing engine must provide a final routing engine value.");(k=e._alp_re_cfg.routingengine_name)&&a.node_info.set_property([p,l,u],k);(h=h||k)?a.node_info.set_property([p,l,t],h):console.error("i_rpm_routing_engine: could not determine `routingengine_final`.");
h=[];0<=b&&(f[g-1].equals(c.to)||((k=f[g-1],k.distanceFrom(c.to)<=m||a.ALWAYS_SNAP_ENDS&&b===a._segments.length-1)?(c.to=k,a._segments.length>b+1&&(g=a._segments[b+1])&&(g.from=k,g.vertices[0]=k),a._nodes[b+1]=k):(a._nodes.splice(b+1,0,k),a._segments.splice(b+1,0,null),c.to=k,h.unshift(k),a.onInsertNodes([k],b+1,[{nextleg:{}}]))),f[0].equals(c.from)||((0<b&&(g=a._segments[b-1])&&g.to&&(f[0]=g.to),f=f[0],f.distanceFrom(c.from)<=m||a.ALWAYS_SNAP_ENDS&&0===b)?(c.from=f,0<b&&(g=a._segments[b-1])&&(g.to=
f,g.vertices[g.vertices.length-1]=f),a._nodes[b]=f):(a._nodes.splice(b+1,0,f),a._segments.splice(b,0,null),c.from=f,h.unshift(f),a.onInsertNodes([f],b+1,[{nextleg:{}}]))));a._segmentFix(b);a._segmentFix(b+1);a._length=null;a._segmentLengths=null;a._resetVerticeCache();if(0<b)a.onChangeSegment(b-1);a.onChangeSegment(b);if(b+1<a._segments.length)a.onChangeSegment(b+1);a.onGeomChange(a,b)}else console.error("alp.digitize rom routing engine: empty geometry (most likely a failure). Skipping this resutl.")}
var E=e._alp_re_cfg,R={"class":e.declaredClass,url:e.SERVICE_URL&&e.SERVICE_URL(),t:Date.now?Date.now():+new Date,routingengine_cfg:E},S=a._opts.datatype_cfg;h||f.topic("/alp/_gmap2_3/digitize/routing/start").trigger(R);var T=alp.dfrd("RPM:CALL:RE",{then:1}),Q=new alp.Eh;g.V3()&&(S=E.travelMode||S[S._default].travelMode,S=alp.opt(k.TravelMode,S)||S,alp.m(e,"alp_setRouteCfg",E),e.route({origin:c.from,destination:c.to,travelMode:S},alp.nowF(r)));a._routeSequence().next(alp.bindF(function(a,c){h?a.then(x):
(a.then(y),a.then(A),a.then(z),a.then(G),a.then(C),a.then(function(){b.done(!0)}));a.then(c)},null,T),2E4);var O}var g=alp._gmap2_3,f=g.digitize,e=alp.sub("models",f,!0),d=e._publictransport,b=alp.cfg.ROUTING_FAILURE_MIN_DIST,c=g.digitize,a=c.ADDRESS(),m=c.POIID();c.GEO_XY();var l=c.NEXTLEG();c.TIME_START();c.TIME_END();var r=c.PUBLIC_TRANS_NONE(),n=c.DURATION_MS(),q=c.PUBLIC_TRANSPORT_STEP_ARR(),p=c.KSF_ARR(),v=c.KSF_DEFAULT(),u=c.ROUTING_ENGINE(),t=c.ROUTING_ENGINE_FINAL(),w=f.LINREF_ORIGIN();f.LINREF_ORIGIN_DATETIME();
(b||null).toPrecision.call.a;e.InterfaceRPMRoutingEngine={getRoutingEngineInfo:function(a){a=/,/.test(a)?this._opts.routing_engine._mix(a,alp.opt(this._opts,["routingengine_name_modifier"],!0)):this._opts.routing_engine._obj[a];var b=alp.opt(this._opts,["m_routing_source_set"],!0);if(!a){var c=this.default_routingengine_main.get();c?a=this.getRoutingEngineInfo(c):console.error("Houston! getRoutingEngineInfo is running out of options...")}return alp.oCreateMix(a,b)},getREDefaultName:function(){return this._opts.routing_engine._defaultName},
getRoutingCfgForNextLeg:function(a){if(alp.isFiniteNumber(a)){var b=this.node_info.getRoutingEngineForNextLeg(a)||this.default_routingengine_main.get(),c=-1<a?this.node_info.getDatatypeNameForNextLeg(a):alp.m(this.default_datatype_main,"get");a=(b=this.getRoutingEngineInfo(b))&&alp.fVal(b.routing_cfg,alp.mix({datatype_name:c||"",localDateTime:this.node_info.getLocalDateTimeForNextLeg(a)},this._opts,{public_transport:this._public_transport,has_public_transport:this._public_transport_has}));var d=this._opts.datatype_cfg;
a.routingengine_name=b.name;a.datatype_name=c||this.default_datatype_main.get();a.re_info=b;a.travelMode=alp.opt(d[a.datatype_name],"travelMode");return a}console.error("AGDM:IRPMRoutingEngine.getRoutingCfgForNextLeg(): node_index is not an integer: ",a)},_setRoutingEngineClass:function(a){var b="string"===typeof a?alp.sub(a):a;if(b)if("function"!==typeof b)console.error("alp._gmap2_3.digitize.RoutedPolylineModel.setRoutingEngineClass(",a,") not a function:",b);else return this._opts.routingEngineClass=
b;else console.error("alp._gmap2_3.digitize.RoutedPolylineModel.setRoutingEngineClass(",a,") could not determine the constructor, got:",b)},_setRoutingEngineUrl:function(a){this._opts.routingEngineUrl=a},_setRoutingEngineForNextLeg:function(a){this._setPublicTransportForNextLeg(a);this._setSnapForNextLeg(a);a=this.getRoutingCfgForNextLeg(a);this._setRoutingEngineUrl(a.url);this._setRoutingEngineClass(a.engineClass);this._routingengine_cfg=a},_setPublicTransportForNextLeg:function(a){var b=this._public_transport=
this.node_info.getPublicTransportForNextLeg(a),c=this._public_transport_has=b&&b!=r;b=c&&this.node_info.getPTRailOnlyForNextLeg(a);a=c&&this.node_info.getPTWithBikeForNextLeg(a);this._opts.bikeTakeAlong=a?1:0;this._opts.includedMeans=b?1:0;this._opts.inclMOT_0=b?1:0;this._opts.inclMOT_1=b?1:0},_setSnapForNextLeg:function(c){function d(a){return alp.oGet(q,[a,"default_network"])||alp.oGet(q,["_default","default_network"])||a}var e=-1<c&&this.node_info.getDatatypeNameForNextLeg(c)||alp.m(this.default_datatype_main,
"get"),l=-1<c&&this.node_info.getKSFForNextLeg(c)||alp.m(this.default_ksf_main,"get"),f=-1<c&&this._public_transport_has?this.node_info.getSpeedForNextLeg(c):null,g=this.backend_snap_t_st.get(),n=this.node_info.has_value([c,a])||this.node_info.has_value([c,m])?-1:g;c=this.node_info.has_value([c+1,a])||this.node_info.has_value([c+1,m])?-1:g;var h=Math.max(b,2*g);g=Math.max(b,2*g);var q=this._opts.datatype_cfg;e=e||q._default;f||(f=(q[e]||q[q._default]).speed_kmh,f=(f.min+f.max)/2);-1<alp.lastIndexOf(p,
l)||(l=alp.m(this.default_ksf_main,"get"));-1<alp.lastIndexOf(p,l)||(l=v);this._opts.fromsnap_t=n;this._opts.from_failure_t=h;this._opts.fromsnap_datatype_name=e;this._opts.fromsnap_routing_network=d(e);this._opts.tosnap_t=c;this._opts.to_failure_t=g;this._opts.tosnap_datatype_name=e;this._opts.tosnap_routing_network=d(e);this._opts.routing_network=d(e);this._opts.ksf_name={network:"network","short":"shortest",fast:"fastest",flat:"flat"}[l]||"";this._opts.speed_kmh=f},_segmentRoute:function(a,b,c,
d){alp.oGet(this,"_opts.extension.segment_network")&&this._setRoutingEngineForNextLeg(a);if(!this._opts.routingEngineClass)return console.warn("No routing engine for segment",b),null;null==c&&(c=this.getNetworkSnapTolerance(this.DEFAULT_SNAP_TOLERANCE));var e=this._opts.routingEngineClass,l=alp.fVal(this._opts.routingEngineUrl,alp.mix({localDateTime:this.node_info.getLocalDateTimeForNextLeg(a)},alp.opt(this._opts,"bikeTakeAlong includedMeans inclMOT_0 inclMOT_1 fromsnap_t fromsnap_datatype_name tosnap_t tosnap_datatype_name ksf_name speed_kmh".split(" "))));
e=new ("string"===typeof e?alp.sub(e):e)(null,this._opts.gdirections_panel,l);var f=alp.dfrd("RPM:SegRoute",{then:1});e._alp_re_cfg=this._routingengine_cfg;alp.m(e,"setUrl",l);this.getNode(a)&&b.from&&b.to?alp.asyncF(0,h)(this,f,b,e,c,a,d):f.done(!0);return f},_routeSequence:alp.memM("_routeSequence","alp.asyncSeq()")}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_routed_important_node");
(function(){alp.sub("models",alp._gmap2_3.digitize,!0).InterfaceRoutedImportantNode={getImportantNodesIndices:function(){var k=[],h=function(d){k[k.length-1]!==d&&k.push(d)},g=this._nodes.length;0<g&&h(0);for(var f=0,e=this._segments.length;f<e;f++)!this._segments[f]||3>this._segments[f].length||(h(f),h(f+1));1<g&&h(g-1);return k},getCurrentImportantNode:function(k){var h=this._nodes.length;if(1>h||k>h-1||0>k)return null;h=this._segments;for(var g=k;g;g--)if(h[g])return Math.min(k,g+1);return h[0]&&
k?1:0},getNextImportantNode:function(k){var h=this._nodes.length;if(1>h||k>h-2)return null;for(var g=this._segments,f=k,e=g.length;f<e;f++)if(g[f])return Math.max(f,k+1);return h-1}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_toggle_segment_routed");
(function(){var k=alp._gmap2_3.digitize,h=alp.sub("models",k,!0),g=k.DATATYPE_NAME(),f=k.KSF(),e=k.PT_RAIL_ONLY(),d=k.PT_WITH_BIKE(),b=k.PUBLIC_TRANSPORT(),c=k.NEXTLEG();h.InterfaceToggleSegmentRouted={areAllSegmentsManual:function(a,b){null==a&&(a=0);for(null==b&&(b=this.getNodeCount());a<b;a++)if(this.isSegmentRouted(a))return!1;return!0},areAllSegmentsRouted:function(a,b){null==a&&(a=0);for(null==b&&(b=this.getNodeCount());a<b;a++)if(!this.isSegmentRouted(a))return!1;return!0},setSegmentManual:function(a){if(!(-1<
a&&a<this._nodes.length-1))console.error("AGDM.InterfaceToggleSegmentRouted.setSegmentManual(): invalid index:",a," (this._nodes.length: ",this._nodes.length,")");else if(this.isSegmentRouted(a)){var m={segment:this._segments[a]};this._segments[a]=null;this.attributes.clear(a,a+1);var l=this._opts.extension,h=[];l&&l.segment_datatype&&h.push(g);l&&l.segment_datatype_property&&h.push(f);l&&l.public_transport&&h.push(b);l&&l.segment_pt_options&&(h.push(e),h.push(d));l=this.node_info.get_property(a)||
{};l[c]&&(l[c]=alp.opt(l[c],h,!0),this.node_info.set_property(a,l));this.onUpdateNode(a,this._nodes[a],this._nodes[a],l);this.onGeomChange(this,a);return m}},setSegmentRouted:function(a,b){if(!(-1<a&&a<this._nodes.length-1))console.error("AGDM.InterfaceToggleSegmentRouted.setSegmentRouted(): invalid index:",a," (this._nodes.length: ",this._nodes.length,")");else if(!this.isSegmentRouted(a)){if(b&&b.segment)this._segments[a]=b.segment;else{b=this._nodes[a];var c=this._nodes[a+1];this._segments[a]=
{from:b,to:c,vertices:[b,c]};c=this._segmentSetFrom(a,this._nodes[a],!0)}this.onUpdateNode(a,this._nodes[a],this._nodes[a],alp.m(this.node_info,"get_property",a));this.onGeomChange(this,a)}c||(c=alp.dfrd("setSegmentRouted",{then:1}),c.done());return c},cmdSetContiguousSegmentsManual:function(a,b){this.undoStack&&(this.areAllSegmentsManual(a,b)||this.undoStack.add(new alp._gmap2_3.digitize.setContiguousSegmentsManualCommand(this,a,b)))},cmdSetContiguousSegmentsRouted:function(a,b){this.undoStack&&
(this.areAllSegmentsRouted(a,b)||this.undoStack.add(new alp._gmap2_3.digitize.setContiguousSegmentsRoutedCommand(this,a,b)))},setContiguousSegmentsManual:function(a,b){if(a<b)for(var c=a;c<b;c++)this.setSegmentManual(c);return[[a,b],{then:function(a){a()}}]},setContiguousSegmentsRouted:function(a,b){function c(){d.setSegmentRouted(a).thenSoon(alp.bindF("done",e))}var d=this;if(a<b){var e=alp.dfrd("setContiguousSegmentsRouted",{then:1});d.areAllSegmentsManual(a,b)||console.warn("AGDM.InterfaceToggleSegmentRouted.setContiguousSegmentsRouted(",
a,",",b,"): warning, not all segments were manual. Some routed segments will probably be lost.");var f=[];if(a+1<b){b=d.deleteNodes(a+1,b-a-1,!0);var g=b[0];f.push(b[1])}alp.gatherDfrd(f).thenSoon(c);return[[a,a+1],e,g]}return[[a,b],{then:function(a){a()}}]}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_update_node_array");
alp.gmap3(function(k){var h=alp._gmap2_3.digitize,g=alp.sub("models",h,!0),f=h.ADDRESS();h.GEO_XY();var e=h.POIID(),d=h.NEXTLEG(),b=h.DATATYPE_NAME(),c=h.PUBLIC_TRANSPORT(),a=h.PUBLIC_TRANS_NONE(),m=h.ROUTING_ENGINE(),l=h.SPEED_KMH(),r=h.TIME_START(),n=h.TIME_END();g.InterfaceUpdateNodeArray={updateNodeArray:function(g,p,h,u){function q(a,b){a&&b&&(b.geo_xy=b.geo_xy||{x:a.lng(),y:a.lat()})}function v(a){var c=[d,b],e=E.default_datatype_main.get();e&&!alp.oGet(a,c)&&alp.oSet(a,c,e)}function x(a,b,
c){a&&b&&(c in b||null==a[c]?c in a||null==b[c]?"object"===typeof a[c]&&(a[c]=alp.mix({},b[c],a[c])):a[c]=b[c]:b[c]=a[c])}function y(){var b=alp.oGet(F,[d,c]);if(X||!U||b&&b!==a||null!=(K&&alp.oGet(K,[d,r]))||null!=(K&&alp.oGet(K,[d,n]))||null==alp.oGet(F,[d,r])&&null==alp.oGet(F,[d,n]))return!1;b=alp.mix({},F);delete b[d][r];delete b[d][n];var e=alp.mix({},K);e[d]={};return alp.oEqual(b,e)}function z(b,e){var l=b&&alp.oGet(b,[d,c]),f=!1;l&&l!==a||(f||(b=alp.oCopy(b),e=e&&alp.oCopy(e),f=!0),l=C(),
b[d]?alp.mix(b[d],l):b[d]=l,e&&(e[d]?alp.mix(e[d],l):e[d]=l));l=[d,m];var g=b&&alp.oGet(b,l),n=e&&alp.oGet(e,l);g&&n&&!/^google$/i.test(g)&&(-1<g.indexOf(n)||-1<n.indexOf(g))&&(f||(b=alp.oCopy(b),e=e&&alp.oCopy(e)),alp.oSet(e,l,g));return!alp.oEqual(b,e)}function A(b,d){if(!d)return!1;var e=b&&alp.oGet(b,c);e&&e!==a||(e=C(),b=alp.mix({},b,e),d=alp.mix({},d,e));return!alp.oEqual(b,d)}function C(){var a={};a[l]=a[r]=a[n]=null;return a}u=alp.oCreateMix({force_reroute:!1},u);var E=this,G=g.length,B=p&&
p.length,I=h&&h.length,L=alp.dfrd("updateNodeArray",{then:1}),J=E.getNodeCount();if(!(0<=G))throw Error("InterfaceUpdateNodeArray.updateNodeArray(): `index_arr` must be an array!");if(p&&G!==B)throw Error("InterfaceUpdateNodeArray.updateNodeArray(): `index_arr` and `newValue_arr` must have the same length (you gave: "+G+", "+B+")");if(h&&G!==I)throw Error("InterfaceUpdateNodeArray.updateNodeArray(): `index_arr` and `info_arr` must have the same length (you gave: "+G+", "+I+")");if(!(1>G)){var P=alp.map(g,
function(a){return E._nodes[a]});p=p||P;alp.forEach(p,function(a,b){a||(p[b]=P[b])});if(null==h){h=Array(G);var H=E.node_info.get()||{};for(B=0;B<G;B++)h[B]=H[g[B]]||{},h[B].geo_xy=null,h[B].address="",h[B].poiId=""}for(B=0;B<G;B++){var F=h[B];I=p[B];F.address||F.geo_xy||F.poiId||(F.geo_xy={x:I.lng(),y:I.lat()})}H=E.node_info.get()||{};var D=!1,M=!1;I=Array(G);var R=Array(G),S=Array(G),T=Array(G),Q=Array(G);for(B=0;B<G;B++){var O=P[B],N=p[B],X=!!O^!!N||O&&N&&O!==N&&!O.equals(N);F=h&&h[B];var V=g[B],
K=H[V];R[B]=K;F&&F.geo_xy&&q(O,K);F&&v(F);K&&v(K);x(F,K,f);x(F,K,d);x(F,K,e);var U=!alp.oEqual(F,K);O=U&&z(F,K);var W=K&&alp.oGet(K,d);N=F&&alp.oGet(F,d);N=A(N,W);I[B]=X;D=D||X;S[B]=U;T[B]=O;Q[B]=N;U&&(H[V]=F,M=!0);N&&E.attributes.clear(V,V+1);E._nodes[V]=p[B]}W=D||M;M&&E.node_info.set(H);E._length=null;E._segmentLengths=null;E._resetVerticeCache();H=[];if(u.force_reroute||D||M)for(--J,B=0;B<G;B++)if(V=g[B],N=p[B],X=I[B],U=S[B],O=T[B],N=Q[B],F=h[B],M=(D=(N=alp.opt(F,"geo_xy"))&&null!=N.x&&null!=N.y)&&
new k.LatLng(N.y,N.x),N=p[B],K=R[B],V<J||X){var Y;u.force_reroute||(Y=!alp.opt(K,"geo_xy")&&D&&N&&M&&N.equals(M)||y());!Y&&(O=u.force_reroute||O,X||O)&&(X&&0<V&&H.push(E._segmentSetTo(V-1,N)),H.push(E._segmentSetFrom(V,N,O)))}alp.gatherDfrd(alp.filter(H,function(a){return null!==a})).thenSoon(function(a){L.done(a)});E.onUpdateNodeArray(g,p,P,h);if(W)E.onGeomChange(E,g);return[P,L,R]}}}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_basemodel");
(function(){alp.sub("alp._gmap2_3.digitize.models",null,!0).InterfaceBaseModel={_nearestFinder:null,clear:function(){console.error("alp._gmap2_3.digitize.BaseModel.clear(): not implemented for this:",this)},updateNearestFinder:function(){var k=this._getNearestFinder();k&&k.update()},queryNearestPointAll:function(k,h){return alp.m(this._getNearestFinder(),"queryNearestPointAll",k,null,h)},queryNearestPoint:function(k,h){var g=this._getNearestFinder();return g&&g.queryNearestPoint(k,h)},_getNearestFinder:function(){if(!this._opts||
!this._opts.noNearestFinder)return this._nearestFinder=this._nearestFinder||new alp._gmap2_3.digitize.XYNearestFinder(this)},changeSegmentEvt:alp.memM("changeSegmentEvt",'alp.event("AGD:M:BM:changeSegmentEvt",{then:1})'),onChangeSegment:function(k){this.changeSegmentEvt().triggerSoon(k)}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize._i18n");
(function(){var k=alp.sub("alp._gmap2_3.digitize._i18n",null,!0),h=alp.i18n.fetch("alp.all");h.then(function(g){alp.mix(k,g)});k.ctn=function(g,f){var e="string"===typeof g,d=alp.cTxN(e?g:"",f);e||(g.i18n_dfrd||h).then(function(b){d["textContent"in d?"textContent":"data"]=b[g.i18n_key]});return d};k.dfrd=h;k.wait=function(g){var f=alp.dfrd("AGDI_wait:"+g,{then:1});h.then(function(e){f.triggerSoon(alp.oGet(e,g))});return f}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.utils");
alp.i18n.fetch("alp.all");
(function(){function k(b,c,a){null!=c||(c=Infinity);if(!a)return b=alp.reduce(b,"((v[ w.key ]  ||  (v[ w.key ] = [])).push( w )),v",{}),b=alp.mapIn(b,function(a){return k(a,c,!0)}),b=alp.arrChain(alp.oValues(b)),b.sort(h),b;b=[].concat(b);b.sort(function(a,b){return a.from-b.from});for(a=b.length-1;0<a;a--){var g=b[a],l=alp.mix({},g);e in g&&(l[e]=g[e]);f in g&&(l[f]=g[f]);b[a]=l;b[a].from=Math.max(b[a].from,b[a-1].to)}for(a=b.length-1;0<=a;a--)l=b[a],l.from=Math.max(0,Math.min(c,l.from)),l.to=Math.max(0,
Math.min(c,l.to)),1E-10>l.to-l.from&&!(l.key&&l.key in d)&&b.splice(a,1);return b}function h(b,c){return b.from-c.from}var g=alp._gmap2_3.digitize,f=g.LINREF_ORIGIN_DATETIME(),e=g.LINREF_ORIGIN(),d=g.LINREF_EMPTY_PERMITTED_KEY_SET();alp.declare("alp._gmap2_3.digitize.utils.eventHelper",null,function(){this._eh={};this._eh2=new alp.Eh},{_disconnect:function(b){if(b){var c=this._eh[b];if(c&&c.subscribe)for(;c.subscribe.length;)dojo.unsubscribe(c.subscribe.pop());if(c&&c.connect)for(;c.connect.length;)dojo.disconnect(c.connect.pop());
if(c&&c.google)for(;c.google.length;)alp._gmap2_3.event("removeListener")(c.google.pop());c&&c.alp_eh&&c.alp_eh.clear();delete this._eh[b]}else for(b in this._eh)this._eh.hasOwnProperty(b)&&this._disconnect(b)}});alp.declare("alp._gmap2_3.digitize.utils.undoStack",null,function(){this._commandHistory={undo:[],redo:[]};this.undoLength=new alp.MinMaxState({min:0,max:Infinity});this.redoLength=new alp.MinMaxState({min:0,max:Infinity})},{UNDO_SIZE:25,add:function(b){this._commandHistory.undo.length>=
this.UNDO_SIZE&&this._commandHistory.undo.splice(0,1);this._commandHistory.undo.push(b);this._commandHistory.redo=[];b.execute(this,"onAction",this,b);this._updateLengths()},clear:function(){this._commandHistory.undo=[];this._commandHistory.redo=[];this._updateLengths()},getState:function(){return[this._commandHistory.undo.length,this._commandHistory.redo.length]},undo:function(){var b=this._commandHistory.undo.pop();b&&(this._commandHistory.redo.push(b),b.revert(this,"onAction",this,b));this._updateLengths()},
redo:function(){var b=this._commandHistory.redo.pop();b&&(this._commandHistory.undo.push(b),b.execute(this,"onAction",this,b));this._updateLengths()},actionEvt:alp.memM("actionEvt",'alp.event("AGD:undoStack:actionEvt",{then:1})'),onAction:function(b,c){this.actionEvt().triggerSoon(b,c)},_updateLengths:function(){var b=this.getState();this.undoLength.set(b[0]);this.redoLength.set(b[1])}});alp._gmap2_3.digitize.createFakeMenuEvent=function(b,c){return{target:b,pageX:c.x,pageY:c.y,preventDefault:function(){},
stopPropagation:function(){}}};alp._gmap2_3.digitize.getClosestPointOnLines=function(b,c){var a,d=c.length;if(1<d){for(a=1;a<d;a++){if(c[a][0]!=c[a-1][0]){var e=(c[a][1]-c[a-1][1])/(c[a][0]-c[a-1][0]);e=Math.abs(e*b[0]+(c[a][1]-e*c[a][0])-b[1])/Math.sqrt(e*e+1)}else e=Math.abs(b[0]-c[a][0]);var f=Math.pow(c[a][1]-c[a-1][1],2)+Math.pow(c[a][0]-c[a-1][0],2),g=Math.pow(c[a][1]-b[1],2)+Math.pow(c[a][0]-b[0],2),h=Math.pow(c[a-1][1]-b[1],2)+Math.pow(c[a-1][0]-b[0],2),p=Math.pow(e,2);g-p+h-p>f&&(e=Math.sqrt(Math.min(g,
h)));if(null==t||t>e){var k=Math.sqrt(h-p)/Math.sqrt(f);var u=Math.sqrt(g-p)/Math.sqrt(f);var t=e;var w=a}}1<k&&(k=1);1<u&&(k=0,u=1);b=c[w-1][1]-c[w][1];a=c[w-1][0]-(c[w-1][0]-c[w][0])*k;e=c[w-1][1]-b*k}.5<u&&--w;return{x:a,y:e,i:w,fTo:k,fFrom:u}};alp._gmap2_3.digitize.attr_fill_default=function(b,c){if("waytype"!==c.key)throw Error('`attr_fill_default` only supports "waytype".');var a=alp.filter(b,'.key==="waytype"'),d=alp.filter(b,'.key!=="waytype"');a.sort(h);for(b=a.length-1;-1<=b;b--){var e=
-1<b?a[b]:{to:0};var f=b<a.length-1?a[b+1]:{from:c.nodeCount-1};1E-10<f.from-e.to&&a.splice(b+1,0,{from:e.to,to:f.from,key:c.key,value:c.value})}c=a.concat(d);c.sort(h);return c};alp._gmap2_3.digitize.attrConcat=function(b){for(var c=[],a=0,d=b.length,e=0;e<d;e++){var f=b[e],g=f.attributes.get();c.push.apply(c,1>e?g:alp.map(g,"alp.mix({},v,{from:v.from+this,to:v.to+this})",a));a+=f.segmentCount}return c};alp._gmap2_3.digitize.attr_copy_and_fix=k})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models._attributes");
(function(){var k=alp._gmap2_3.digitize,h=k.LINREF_ORIGIN(),g=k.LINREF_ORIGIN_DATETIME(),f=k.LINREF_EMPTY_PERMITTED_KEY_SET(),e={},d=alp.i18n.fetch("alp.all");d.then(function(b){e=b});alp.declare("alp._gmap2_3.digitize.models.Attributes",null,alp.nowF(function(b,c){this._notifyChangeLater=function(){this._fixing||this._notifyChangeLaterImpl()};this._notifyChangeLaterImpl=alp.ratelimitF(111,alp.asyncF(0,alp.nowF(function(){this.attrChangeEvt().triggerSoon()},this)));this._model=b;this.options=alp.oCreateMix(this._defaultOptions,
c||{});this._availableKeys=this.options.availableKeys||[];var a=this._availableKeyMap={};alp.forEach(this._availableKeys,function(b){a[b.id]={};alp.forEach(b.values,function(c){var d=alp.oCreate(c);if("string"===typeof c.color){var e=d.color={};e.toHex=e.toValue=e.toString=alp.f('"'+c.color+'"')}a[b.id][c.id]=d})});this._data=[];this._colorMap={};this._colorIndex={};a=this._model;a.insertNodesEvt&&a.insertNodesEvt().then(alp.bindF("onModelNodeInsert",this));a.deleteNodesEvt&&a.deleteNodesEvt().then(alp.bindF("onModelNodeDelete",
this))}),{BASE_COLOR:"#ff0000",_defaultOptions:{newAttributes:!0,newValues:!0},attrChangeEvt:alp.memF('alp.event("AGD:attrChangeEvt", {then:1})'),getLabelDfrd:function(){return d},getLabel:function(b,c){return e&&e[b+(c?"."+c:"")]||b+" (i18n missing)"},_splitAttribute:function(b,c,a){!(a<=b.from||c>=b.to)&&b.from<c&&a<b.to&&(a={from:a,to:b.to,key:b.key,value:b.value},h in b&&(a[h]=b[h]),this._data.push(a),b.to=c,this._notifyChangeLater())},onModelNodeInsert:function(b,c){var a=b.length,d=this,e=!1;
alp.forEach(d._data,function(b){b.from>=c&&(b.from+=a,e=!0);b.to>=c&&(b.to+=a,e=!0);d._splitAttribute(b,c-1,c+a)});e&&this._notifyChangeLater()},onModelNodeDelete:function(b,c,a,d){a=this._data;var e=Math.max(0,b-1);b=Math.max(0,b+c);--d;for(var f=e-1E-10,g=b-1E-10,m=b+1E-10,p=a.length;p--;)this._splitAttribute(a[p],e,b);for(p=a.length;p--;){var h=a[p],k=h.from,t=h.to,w=k,x=t;f<w&&w<m&&(w=b);f<x&&x<m&&(x=e);g<w&&(w-=c);g<x&&(x-=c);w=Math.max(0,Math.min(w,d));x=Math.max(0,Math.min(x,d));if(x<w+1E-10)a.splice(p,
1);else if(k!==w||t!==x)a[p]=h=alp.mix({},h,{from:w,to:x})}a.sort(function(a,b){return a.from-b.from});this._notifyChangeLater()},_getCovering:function(b){return alp.filter(this._data,function(c){return c.from<=b&&c.to>=b})},getKeys:function(b){var c=alp.map(this._availableKeys,function(a){return a.id});if(b){var a={};for(b=0;b<this._data.length;b++){var d=this._data[b];a[d.key]||(a[d.key]=!0)}c=alp.filter(c,function(b){return void 0!==a[b]})}return c},isEmpty:function(){return!this._data.length},
set:function(b,c,a,d,e,g){if(d&&!a)throw Error("alp._gmap2_3.digitize.models.Attribute.set(): key == null allowed only for value == null (clearing attributes).");b=Math.max(0,b);c=Math.max(b,c);if(!(1E-10>Math.abs(c-b))||a&&a in f){var l=alp.filter(this._data,function(d){return(!a||d.key===a)&&(d.from<=c&&d.from>=b||d.to>=b&&d.to<=c||d.to>=c&&d.from<=b)}),m=this._data;alp.forEach(l,function(a){if(a.from>=b&&a.to<=c)m.splice(alp.indexOf(m,a),1);else if(a.from>=b&&a.from<=c)a.value===d&&a[h]==e?(c=
a.to,m.splice(alp.indexOf(m,a),1)):a.from=c;else if(a.to>=b&&a.to<=c)a.value===d&&a[h]==e?(b=a.from,m.splice(alp.indexOf(m,a),1)):a.to=b;else{var l={from:c,to:a.to,key:a.key,value:a.value};h in a&&(l[h]=a[h]);m.push(l);a.to=b}});null!=d&&(l={from:b,to:c,key:a,value:d},null!=e&&(l[h]=e),g&&alp.mix(l,g),this._data.push(l));this._notifyChangeLater()}},clear:function(b,c,a){return this.set(b,c,a)},get:function(b,c){if(1>arguments.length)return[].concat(this._data);if(null!=c){var a=alp.filter(this._data,
'v.key === "'+b+'"  &&  v.from <= '+c+" && v.to >= "+c);return a.length?a[0]:null}return alp.filter(this._data,'v.key === "'+b+'"')},getValues:function(b,c){var a=[],d;for(d in this._availableKeyMap[b])this._availableKeyMap[b].hasOwnProperty(d)&&a.push(d);if(c){var e={};alp.forEach(this.get(b),function(a){e[a.value]=!0});a=alp.filter(a,function(a){return void 0!==e[a]})}return a},getColor:function(b,c){this._colorMap[b]||(this._colorMap[b]={},this._colorIndex[b]=0);if(void 0===this._colorMap[b][c])if(this._availableKeyMap[b]&&
this._availableKeyMap[b][c])this._colorMap[b][c]=this._availableKeyMap[b][c].color;else throw Error("no random color anymore");return this._colorMap[b][c]},reverse:function(){for(var b=this._model.getNodeCount()-1,c=0;c<this._data.length;c++){var a=this._data[c],d=a.to;a.to=b-a.from;a.from=b-d}this._fixing||this.attrChangeEvt().triggerSoon()},fromJSON:function(b){var c=this;if(b){this._data=[];var a=this._model.attr_dflt&&this._model.attr_dflt();a&&(b=alp._gmap2_3.digitize.attr_copy_and_fix(b,a&&
a.nodeCount),b=alp._gmap2_3.digitize.attr_fill_default(b,a));alp.forEach(b,function(a){var b=alp.filterIn(a,"!(w in { from:1, to:1, key:1, value:1 })");b[g]=a[g];c.set(a.from,a.to,a.key||"waytype",a.value,a[h],b)})}},toJSON:function(){return alp._gmap2_3.digitize.attr_copy_and_fix(this._data)},fix:function(){this._fixing=!0;this.fromJSON(this.toJSON());this._fixing=!1}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.i_withattrmodel");
(function(){alp.sub("alp._gmap2_3.digitize.models",null,!0).InterfaceWithAttrModel=alp.oCreateMix(alp._gmap2_3.digitize.models.InterfaceBaseModel,{attr_dflt:function(){return this._opts&&this._opts.attr_default&&this._opts.attr_default(this)}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.node_info_model");
(function(){function k(c){var l;c&&((l=a in c&&c[a])&&(null==l||l.substring.call.a),(l=r in c&&c[r])&&(null==l||l.substring.call.a),(l=q in c&&c[q])&&(null==l||l.toPrecision.call.a),(l=f in c&&c[f])&&(null==l||l.substring.call.a),(l=b in c&&c[b])&&(null==l||l.substring.call.a),(l=e in c&&c[e])&&(!0===l||!1===l||null.a),(l=d in c&&c[d])&&(!0===l||!1===l||null.a))}var h=alp._gmap2_3.digitize,g=h.NEXTLEG(),f=h.ROUTING_ENGINE(),e=h.PT_RAIL_ONLY(),d=h.PT_WITH_BIKE(),b=h.PUBLIC_TRANSPORT(),c=h.PUBLIC_TRANS_NONE(),
a=h.DATATYPE_NAME(),m=h.TIME_START(),l=h.TIME_END(),r=h.KSF(),n=h.KSF_DEFAULT(),q=h.SPEED_KMH(),p=h.GEO_XY(),v={};alp.declare("alp._gmap2_3.digitize.NodeInfoModel",alp.ObjectState,alp.nowF(function(a,b){if(!(b instanceof alp._gmap2_3.digitize.AbstractPolylineModel))throw Error("alp._gmap2_3.digitize.NodeInfoModel.constructor(): requires an alp._gmap2_3.digitize.AbstractPolylineModel instance.");this.model=b;a=this._get_no_clone();for(var c=b.getNodeCount();c--;){var d=b.getNode(c),e=d&&d.lng();d=
d&&d.lat();var l=a[c]||(a[c]={});null!=e&&null!=d?l[p]||(l[p]={x:e,y:d}):console.error("alp._gmap2_3.digitize.NodeInfoModel: ctor warning: model gave improper `x` and/or `y` value",e,d)}this.set(a,this.init_silent);this.model.geomClearEvt().then(alp.bindF("onGeomClear",this));this.model.updateNodeEvt().then(alp.bindF("onUpdateNode",this));this.model.updateNodeArrayEvt().then(alp.bindF("onUpdateNodeArray",this));this.model.deleteNodesEvt().then(alp.bindF("onDeleteNodes",this));this.model.reverseEvt().then(alp.bindF("onReverse",
this))}),{datatype_cfg:null,getTileLayerForNextLeg:function(a){if(alp.isFiniteNumber(a)){var b=null!=a&&this.getRoutingEngineForNextLeg(a)||this.model.default_routingengine_main.get()||this.model.getREDefaultName();a=null!=a&&this.getDatatypeNameForNextLeg(a)||this.model.default_datatype_main.get();b=this.model.getRoutingEngineInfo(b);var c=alp.opt(alp.m(this.model,"getDatatypeEntry",a),"mapOverlays");return"string"===typeof c?c:alp.m(b,"gtilelayeroverlay_name",{datatype_name:a})}console.error("alp._gmap2_3.digitize.NodeInfoModel.getTileLayerForNextLeg(): node_index is not an integer: ",
a)},getLocalDateTimeForNextLeg:function(a){if(alp.isFiniteNumber(a))return a=this.get_property([a,g,m])||0<a&&this.get_property([a-1,g,l]),this.model.time_constraint_st.localDateTime(a);console.error("alp._gmap2_3.digitize.NodeInfoModel.getLocalDateTimeForNextLeg(): node_index is not an integer: ",a)},getRoutingEngineForNextLeg:function(a){if(alp.isFiniteNumber(a))return this.get_property([a,g,f]);console.error("alp._gmap2_3.digitize.NodeInfoModel.getRoutingEngineForNextLeg(): node_index is not an integer: ",
a)},getPublicTransportForNextLeg:function(a){if(alp.isFiniteNumber(a))return this.get_property([a,g,b])||c;console.error("alp._gmap2_3.digitize.NodeInfoModel.getPublicTransportForNextLeg(): node_index is not an integer: ",a)},getPTRailOnlyForNextLeg:function(a){if(alp.isFiniteNumber(a))return this.get_property([a,g,e]);console.error("alp._gmap2_3.digitize.NodeInfoModel.getPTRailOnlyForNextLeg(): node_index is not an integer: ",a)},getPTWithBikeForNextLeg:function(a){if(alp.isFiniteNumber(a))return this.get_property([a,
g,d]);console.error("alp._gmap2_3.digitize.NodeInfoModel.getPTWithBikeForNextLeg(): node_index is not an integer: ",a)},getDatatypeNameForNextLeg:function(b){if(alp.isFiniteNumber(b))return this.get_property([b,g,a]);console.error("alp._gmap2_3.digitize.NodeInfoModel.getDatatypeNameForNextLeg(): node_index is not an integer: ",b)},getKSFForNextLeg:function(a){if(alp.isFiniteNumber(a))return this.get_property([a,g,r]);console.error("alp._gmap2_3.digitize.NodeInfoModel.getKSFForNextLeg(): node_index is not an integer: ",
a)},getSpeedForNextLeg:function(a){if(alp.isFiniteNumber(a))return this.get_property([a,g,q]);console.error("alp._gmap2_3.digitize.NodeInfoModel.getSpeedForNextLeg(): node_index is not an integer: ",a)},onGeomClear:function(a){a=this._get_no_clone();var b={};a&&a["default"]&&(b["default"]=a["default"]);this.set(b)},onUpdateNode:function(a,b,c,d){this.set_property(a,alp.mix({address:"",geo_xy:null,poiId:""},d))},onUpdateNodeArray:function(a,b,c,d){b=this._get_no_clone()||{};c=0;for(var e=a.length;c<
e;c++){var l=b[a[c]]=alp.mix({address:"",geo_xy:null,poiId:""},d&&d[c]);k(l&&l.nextleg)}this.set(b)},onDeleteNodes:function(a,b,c,d){a|=0;b|=0;c=this._get_no_clone()||{};d=alp.map(alp.oKeys(c),"|0");var e=a+b;d.length&&d[0].toPrecision.call.a;d.sort(function(a,b){return a>b?1:-1});for(var l=0,f=d.length;l<f;l++){var g=d[l];if("default"!==g&&!(g<a)){var m=c[g];delete c[g];g>=e&&(c[g-b]=m)}}this.set(c)},onInsertNodes:function(l,g,m){var p=(l&&l.length||0)>>0;if(!(1>p)){g|=0;var v=this._get_no_clone()||
{},w=alp.map(alp.oKeys(v),"|0"),t=g+p;w.length&&w[0].toPrecision.call.a;w.sort(function(a,b){return a>b?1:-1});for(var u=w.length;u--;){var E=w[u];if("default"!==E&&!(E<g)){var G=v[E];delete v[E];v[E+p]=G}}for(E=g;E<t;E++){u=E-g;p=l[u];v[E]=m&&m[u]||{};v[E].geo_xy=alp.mix(p&&{x:p.lng(),y:p.lat()},v[E].geo_xy);var B;0<E&&(B=v[E-1]&&v[E-1].nextleg);B=B||{};alp.oGet(this.model,"_opts.extension.public_transport")&&"string"!==typeof B.publictransport&&(B.publictransport=B.publictransport||this.model.default_public_transport_main.get()||
h.PUBLIC_TRANS_NONE());p=this.datatype_cfg;"string"!==typeof B[a]&&(B[a]=B[a]||alp.m(this.model.default_datatype_main,"get")||p._default);"string"!==typeof B[r]&&(B[r]=B[r]||alp.m(this.model.default_ksf_main,"get")||n);"number"!==typeof B[q]&&(u=B[a]||p._default,u=(p[u]||p[p._default])[q],p=u.min,u=p+(u.max-p)*alp.m(this.model.default_speedprop_main,"get"),B[q]=B[q]||u||5);p=f;B[p]&&"string"===typeof B[p]||(u=B[a],B[p]=(this.datatype_cfg[u]||this.datatype_cfg[this.datatype_cfg._default])[f]||"outdooractive,osrm,google");
p=b;B[p]||(B[p]=alp.m(this.model.default_public_transport_main,"get")||c);p=e;u=B[p];!0!==u&&!1!==u&&(B[p]=!1);p=d;u=B[p];!0!==u&&!1!==u&&(B[p]=!1);u=v[E].nextleg=alp.mix(B,v[E].nextleg);k(u)}this.set(v)}},onReverse:function(a){if(isFinite(a)){var b=this._get_no_clone()||{},c={};--a;for(var d in b)d in v||(isFinite(d)?c[a-d]=b[d]:c[d]=b[d]);this.set(c)}}});alp.sub("alp._gmap2_3.digitize.NodeInfoModel").DEFAULT="default"})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.PolylineModel");
alp.gmap3(function(k){var h=alp._gmap2_3;alp.declare("alp._gmap2_3.digitize.PolylineModel",h.digitize.AbstractPolylineModel,function(g,f){this._opts=g||{};this._nodes=f instanceof Array?[].concat(f):[];this.updateNearestFinder();this.attributes=new h.digitize.models.Attributes(this,this._opts.attributes)},h.digitize.models.InterfaceWithAttrModel,{clear:function(){this._nodes=[];this.onGeomChange(this)},getNode:function(g){0>g&&(g+=this._nodes.length);return this._nodes[g]},updateNode:function(g,f){var e=
this._nodes[g];this._nodes[g]=f;this._segmentLengths=this._length=null;this.onUpdateNode(g,f,e);this.onGeomChange(this);return e},getNodeIndex:function(g){return alp.indexOf(this._nodes,g)},getNodes:function(){return this._nodes.concat()},getVertices:function(){return this.getNodes()},getNodeCount:function(){return this._nodes.length},insertNodes:function(g,f){f="undefined"==typeof f?this._nodes.length:f;this._nodes.splice.apply(this._nodes,[f,0].concat(g));this._segmentLengths=this._length=null;
this.onInsertNodes(g,f);this.onGeomChange(this)},deleteNodes:function(g,f){f="undefined"==typeof f?1:f;var e=this._nodes.splice(g,f);this._segmentLengths=this._length=null;this.onDeleteNodes(g,f,e,this._nodes.length);this.onGeomChange(this);return e},reverse:function(){this._nodes.reverse();this.attributes.reverse();this._segmentLengths=null;this.onGeomChange(this)},toGeoJSON:function(){var g=alp.gmap.toGeoJSON("LINESTRING",this.getNodes());g&&!this.attributes.isEmpty()&&(g.attributes=this.attributes.toJSON());
return g},getSegmentMidPoint:function(g,f){var e=this.getNode(g),d=this.getNode(g+1);if(!e||!d)return null;"undefined"==typeof f&&(f=.5);g=e.lat()+(d.lat()-e.lat())*f;f=e.lng()+(d.lng()-e.lng())*f;return new k.LatLng(g,f)},getAttributeSegments:function(g){g=this.attributes.get(g);for(var f=Array(g.length),e,d=0;d<g.length;d++){var b=alp.oCreate(g[d]);b.vertices=[this.getSegmentMidPoint(Math.floor(b.from),b.from%1)];for(e=Math.ceil(b.from);e<b.to;e++)b.vertices.push(this._nodes[e]);e=b.to>=this._nodes.length-
1?this.getSegmentMidPoint(b.to-1,1):this.getSegmentMidPoint(Math.floor(b.to),b.to%1);b.vertices.push(e);f[d]=b}return f},getSegmentLengths:function(){if(!this._segmentLengths){for(var g=this._nodes.length,f=Array(g-1),e=0;e<g-1;e++)f[e]=this._nodes[e].distanceFrom(this._nodes[e+1]);this._segmentLengths=f}return this._segmentLengths},getSegmentParts:function(g,f){void 0===g&&(g=0);void 0===f&&(f=this._nodes.length-1);g=Math.max(0,Math.min(this._nodes.length-1,g));f=Math.max(0,Math.min(this._nodes.length-
1,f));for(var e=[];g<f;g++)e.push([[g,this.getNode(g),this.getNode(g+1)]]);return e},getSegments:function(){return Array(Math.max(0,this._nodes.length-1))},getIndexForPoint:function(g){var f=h.digitize.getClosestPointOnLines(g,this.getVertices());return{i:f.i+f.fFrom,p:g}}});h.digitize.PolylineModel.fromGeoJSON=function(g,f){var e=alp.gmap.fromGeoJSON(g,"LINESTRING");f=new h.digitize.PolylineModel(f,e);f.attributes.fromJSON(g.attributes);return f}});"undefined"!==typeof dojo&&dojo.provide("alp.util.datetime");
(function(){alp.sub("alp.util",null,!0);alp.util.datetime=function(h){var g={fullYear:h.getFullYear(),month:h.getMonth(),month_1:1+h.getMonth(),date:h.getDate(),day:h.getDay(),hours:h.getHours(),minutes:h.getMinutes(),seconds:h.getSeconds(),milliseconds:h.getMilliseconds()};h=alp.oKeys(g);alp.forEach(h,function(f){var e=alp.sPad(g[f],2,"0");g[f+"_pad2"]=e});return g};alp.util.day_ms=function(){return k};alp.util.next_day=function(h,g){if(null!=h&&!isNaN(h)&&null!=g)for(g%=7;h.getDay()!=g;)h=new Date(h.valueOf()+
k);return h};alp.util.same_day=function(h,g){if(!isNaN(h)&&!isNaN(g)&&h instanceof Date&&g instanceof Date)return alp.and(["getDate","getMonth","getYear"],function(f){return h[f]()==g[f]()})};var k=864E5})();"undefined"!==typeof dojo&&dojo.provide("alp.data.time_constraint_state");
(function(){var k=alp.declare("alp.data.TimeConstraintState",alp.ObjectState,null,{setDate:function(h){return this.set_property("t",h)},constrain_all:function(h){h instanceof Date&&(h={t:h});var g={};g.t=h&&"number"===typeof h.t?h.t:h&&h.t instanceof Date?h.t.valueOf():(new Date).valueOf();var f="timezoneOffset";h&&"number"===typeof h[f]?g[f]=h[f]:h&&h.t instanceof Date&&(g[f]=h.t.getTimezoneOffset());"number"!==typeof g[f]&&(g[f]=-60);f="type";g[f]=h&&h[f]===k.ARRIVAL?h[f]:k.DEPARTURE;return g},
localDateTime:function(h){"number"!==typeof h&&(h=this.get_property("t"));var g=this.get_property("timezoneOffset"),f=new Date(h);g=f.getTimezoneOffset()-g;0!==g&&(f=new Date(h+6E4*g));return alp.util.datetime(f)}});k.ARRIVAL="arrival";k.DEPARTURE="departure"})();"undefined"!==typeof dojo&&dojo.provide("alp.util.bg");
(function(){alp.sub("alp.util",null,!0);alp.declare("alp.util.Background",null,alp.nowF(function(k){var h=this;alp.mix(h,k);h.sleepy||(h.sleepy=new alp.BoolState);h.sleepy.change_v_cb(!0,function(){h.do_some()});h.waker_required&&setInterval(alp.nowF("waker",h),h.waker_interval_ms);h.waker()}),{pause_work_ratio:1,work_max_ms:alp.likeIE()?200:100,pause_min_ms:alp.likeIE()?100:10,pause_max_ms:500,waker_required:!0,waker_interval_ms:1E3,sleepy:null,do_some:alp.asyncF(0,function(){var k,h;if(!this.sleepy.get()){this._last_args=
k=(0<arguments.lenth?arguments:this._last_args)||[];var g=Date.now?Date.now():+new Date;var f=0<this._thrown&&this._last_pause_start_time&&Math.max(0,g-this._last_pause_start_time);0<this._thrown?this._thrown--:this._thrown=0;for(h=void 0;!(h>=this.work_max_ms);){var e=this.do_one_impl.apply(this,k);var d=Date.now?Date.now():+new Date;h=d-g;if(!e)break}this._last_pause_start_time=void 0;e&&1>this._thrown&&(this._last_pause_start_time=d,e=h*this.pause_work_ratio,f&&(e+=Math.max(e,f),e>>=1),d=Math.max(this.pause_min_ms,
Math.min(this.pause_max_ms,e)),alp.asyncF(d,"do_some",this).apply(null,k),this._thrown=1,alp.sub("djConfig.isDebug")&&console.log("alp.util.Background.do_some(): me._thrown:",this._thrown,"last_pause_duration:",f,", work_duration:",h,", desired_pause_duration:",e,", pause_duration:",d))}}),waker:function(){0<this._thrown||this.do_some()},do_one_impl:function(){throw Error("alp.util.Background.do_one_impl() not implemented yet. Please implement.");}})})();"undefined"!==typeof dojo&&dojo.provide("alp.util.bg_updater");
(function(){var k=function(){return alp.declare("alp.util.BackgroundUpdater",alp.util.Background,null,{pause_min_ms:100,waker_interval_ms:200,get_info:function(h){return this.elt2info().get(h)},set_info:function(h,g){this.elt2info().set(h,g);this.check_later(h)},updater:alp.memM("updater","{}"),check_later:function(h){this.to_check().set(h,!0)},clear:function(){this.elt2info().clear();this.to_check().clear()},has_todo:function(){return 0<this.elt2info().filter(function(h){return h&&h.todo}).length},
elt2info:alp.memM("elt2info","alp.mapany()"),to_check:alp.memM("to_check","alp.mapany()"),do_one_impl:alp.nowF(function(){var h=this.to_check().filter(),g=(h=h&&h.length&&h[0])&&this.elt2info().get(h),f=g&&g.type,e=this.updater();null!=h&&this.to_check().del(h);if(e[f]&&(f=e[f](h,g),f!==k.DID_NOTHING)){if(f===k.DID_SOME_BUT_UNFINISHED)this.to_check().set(h,!0);else if(f===k.FINISHED)g.todo=null;else throw Error("alp.util.BackgroundUpdater: unrecognized `result` value: "+f);return!0}this.to_check().set(h,
!0);return!1})})}();k.FINISHED=!0;k.DID_SOME_BUT_UNFINISHED="unfinished";k.DID_NOTHING=!1})();"undefined"!==typeof dojo&&dojo.provide("alp.util.math.interp_xy");
(function(){alp.sub("alp.util.math",null,!0).interp_xy_f=function(k){function h(a,b){b||(b=0);var c=[];"string"===typeof a?c.push(a):"string"===typeof a[0]?(c.push(a[0],"?"),c.push.apply(c,h(a[1],b)),c.push(":")):(c.push("("),c.push.apply(c,alp.arrChain(alp.map(a,function(a){return h(a,b+1)}))),c.push(")"));return alp.map(c,'" "+v')}function g(a){return a.toPrecision(13).replace(/0+$/,"")}function f(a,b){if(b<a+1)return[];if(b===a+1)return a=d[a],g(a.a)+"*x + "+g(a.b);if(b>a+1){var c=a+b>>1;return[["x<"+
g(e[c][0]),f(a,c)],f(c,b)]}null.bug}var e="string"===typeof k?(new Function("return "+k))():k;k=e.length;1>k&&null.empty_data;if(1===k)return alp.f(g(e[0][1]));e.sort(function(a,b){return a[0]-b[0]});var d=Array.apply(null,Array(k-1));alp.forEach(d,function(a,b){var c=e[b],l=e[b+1];a=c[0];c=c[1];var f=l[0];l=l[1];var g=f-a;d[b]={a:(l-c)/g,b:(f*c-a*l)/g}});var b=e[0],c=e[k-1],a=b[1],m=c[0];c=c[1];return new Function("x","return "+h([["x<"+g(b[0]),g(a)],["x<"+g(m),f(0,k-1)],g(c)]).join("\n").replace(/\s*\?\s*/g,
" ? ")+";")}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.routed_polyline_time_updater");
(function(){var k=alp.util.math;alp.declare("alp._gmap2_3.digitize.models.RoutedPolylineTimeUpdater",null,alp.nowF(function(f){function w(){var a=F._tc_st.get_property("type");F._is_departure_st.set(a!==alp.data.TimeConstraintState.ARRIVAL)}function t(){return F._is_departure_st.get()}function y(a){var b=T.get_info(R)||{};b=b&&b.todo;var c=t(),d=R.getNodeCount();a=c?Math.max(0,a-1):Math.min(a,d-2);null==b?z(a):z(c?Math.min(b.index,a):Math.max(b.index,a))}function z(a){null!=a&&(!R.getNode(a)||0<a&&
!R.getNode(a-1))||(Q=C(R.node_info._get_no_clone()),A(a))}function A(a){var c=t(),d=R.getNodeCount();if(!(2>d)){null==a&&(a=c?0:d-2);var l;c&&0<a&&(l=a-1);!c&&a<d-2&&(l=a+1);if(c=null!=l)c=[l,e,b],c="number"!==typeof(Q&&alp.oGet(Q,c));if(c)return A(l);T.set_info(R,{type:M,todo:{index:a,timestamp:O++}})}}function C(a){if(!a)return{};a=alp.mix({},a);for(var b in a)if(!(b in v)){var c=a[b];c&&e in c&&(c[e]=alp.mix({},c[e]))}return a}function E(){if(!Q)throw Error("alp._gmap2_3.digitize.models.RoutedPolylineTimeUpdater: _put_node_info(): found a bug! `_fetch_node_info()` should have been called before.");
R.node_info.set(C(Q));D()}function G(a,b){T.sleepy.set(!0);a.dfrd.thenSoon(function(){a.timestamp===b.timestamp&&(T.sleepy.set(!1),z(a.index),null!=N&&clearTimeout(N))});null!=N&&clearTimeout(N);N=setTimeout(function(){clearTimeout(N);T.sleepy.setNow(!1)},3E4)}function B(a){if(!R.isSegmentRouted(a)||!J(a)){var b=(a=(a=Q[a])&&a[e])&&a[q];alp.isFiniteNumber(b)||(a=S[a&&a[d]||S._default].speed_kmh,b=(a.min+a.max)/2);alp.isFiniteNumber(b)||(b=5);return b/3.6}return null}function I(a){return(a=(a=Q[a])&&
a[e])&&a[b]}function L(a,c){a=Q[a]||(Q[a]={});(a[e]||(a[e]={}))[b]=c}function J(b){return(b=(b=(b=Q[b])&&b[e])&&b[a])&&b!==m}function P(a){if(!R.isSegmentRouted(a))return H(a);var b=alp.oGet(Q,[a,e,l]);"number"===typeof b&&(b={value_ms:b});var c=b;b=alp.opt(c,r);if("number"!==typeof b)return H(a);if(J(a))return b;c=alp.opt(c,n);var d=3.6*B(a);return"number"!==typeof c||"number"!==typeof d?H(a)||b:b*c/d}function H(a){var b=R&&R.getSegmentLength&&R.getSegmentLength(a),c=R.getNode(a),l=R.getNode(a+1);
null==b&&(b=c.distanceFrom(l));var f=B(a),g=f||2;c=c.z&&c.z();l=l.z&&l.z();if(null!=c&&null!=l&&c!==l&&1E-10<b){var m=alp.oGet(F.model,"node_info.datatype_cfg");if((a=(a=alp.oGet(Q,[a,e,d]))&&m&&alp.oGet(m,[a,q,p]))&&a.length>("string"===typeof a?30:2))return g=alp.sub(u,F,!0),c=l-c,l=c/b,g=g[a]||(g[a]=k.interp_xy_f(a)),g=g(l)*(null!=f?3.6*f/g(0):1),Math.sqrt(c*c+b*b)/(1E3*g)*36E5;m=Math.max(.8,Math.min(2,g/(4.2/3.6)));f=Math.max(1.11,.8*g)/1.11;a=0;if(l>c){var n=l-c;a+=n/(350*m);b-=n/.25}l<c&&(c-=
l,a+=c/(450*f),b-=c/.25);0<b&&(a+=b/(3600*g));return 36E5*a}return 1E3*b/g}var F=this,D=alp.asyncF(0,alp.ratelimitF(237,alp.nowF(function(){var a=null,c=F._tc_st.get_property("t"),d=F.model.getNodeCount(),l=t();"number"===typeof c&&1<d&&(d=F.model.node_info.get_property([l?d-2:1,e,b]),"number"===typeof d&&d>c&&(a=d-c));"number"===typeof a?F.duration_ms_st.set(a):setTimeout(D,443)})));F.model=f;F.duration_ms_st=new alp.State;F._is_departure_st=new alp.BoolState;F._tc_st=f.time_constraint_st;F._tc_st.change_cb(w);
w();F._tc_st.change_cb(function(){z()});var M="poly";F._bgu=new alp.util.BackgroundUpdater({pause_min_ms:150,waker_interval_ms:160});F._bgu.updater()[M]=alp.bindF(function(a,d){d=(a=d&&d.todo)&&a.index;var l=F._is_departure_st.get(),f=R.getNodeCount(),m=f-1,n=R.time_constraint_st.get().t,p=g.DID_NOTHING;if(!(null!=d&&0<f))return g.FINISHED;for(var q=Date.now?Date.now():+new Date;l?d<m:0<=d;l?d++:d--)if(R.getNode(d)&&R.getNode(d+1)){if(!(d%10)&&50<(Date.now?Date.now():+new Date)-q){p&&(p=g.DID_SOME_BUT_UNFINISHED);
break}var k=d+(l?-1:1);k=0<=k&&k<m?I(k):n;var r=(r=(r=Q[d])&&r[e])&&r[c];var v=I(d),w=null!=B(d),t;if(t=w){t=k;var x=P(d);if("number"===typeof x)t+=x;else throw Error("alp._gmap2_3.digitize.models.RoutedPolylineTimeUpdater is buggy! _calc_t_end_later should probably be called instead!");}if(k!=r||w&&t!=v)if(p=g.FINISHED,w){x=k;var u=Q[d]||(Q[d]={});(u[e]||(u[e]={}))[c]=x;L(d,t)}else{l=k;f=a.timestamp;m=d;n=l;p=Q[m]||{};if(null==n)throw Error("alp._gmap2_3.digitize.models.RoutedPolylineTimeUpdater: _set_t_start_reroute() found a bug! t_start:"+
n);k=(q=p[e])&&q[c];k=null!=k&&n!==k;q||(q=p[e]={});q[c]=n;q[b]=h;E();m=R.updateNode(m,null,p,{force_reroute:k})[1];G({index:d,prev_t:l,timestamp:f,dfrd:m},a);return g.DID_SOME_BUT_UNFINISHED}w||k!==r||(t=r+P(d),v!==t&&L(d,t),p=g.FINISHED)}if(l&&d<f-2)return A(d+1),p;if(!l&&0<d)return A(d-1),p;E();return g.FINISHED});F._is_departure_st.change_cb(function(){var a=R.getNodeCount();t();1<a&&z()});F.model.geomClearEvt().then(function(a){T.clear()});F.model.changeSegmentEvt().then(function(a){y(a)});F.model.updateNodeEvt().then(y);
F.model.updateNodeArrayEvt().then(function(a){var b=T.get_info(R)||{};b=b&&b.todo;var c=t(),d=R.getNodeCount(),e=Math.min.apply(Math,a);a=Math.max.apply(Math,a);a=c?Math.max(0,e-1):Math.min(a,d-2);null==b?z(a):z(c?Math.min(b.index,a):Math.max(b.index,a))});F.model.deleteNodesEvt().then(function(a,b,c,d){y(a)});F.model.insertNodesEvt().then(function(a,b){var c=t();y(b+(c?0:a.length-1))});F.model.reverseEvt().then(function(a){z()});var R=F.model,S=R._opts.datatype_cfg,T=F._bgu;T.elt2info().change_cb(D);
F.model.node_info.change_cb(D);D();z();var Q;R.node_info.change_cb(function(){R.node_info.is(Q)||z()});var O=0,N}),{duration_ms_st:null});var h="unknown",g=alp.util.BackgroundUpdater,f=alp._gmap2_3.digitize,e=f.NEXTLEG(),d=f.DATATYPE_NAME(),b=f.TIME_END(),c=f.TIME_START(),a=f.PUBLIC_TRANSPORT(),m=f.PUBLIC_TRANS_NONE(),l=f.DURATION_MS(),r=f.DURATION_MS_VALUE(),n=f.DURATION_MS_FLATSPEEDKMH(),q=f.SPEED_KMH(),p=f.TIME_F_PARAMS(),v={},u="_tfp_cache"})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.geojson");
(function(){function k(a){if(!a)return a;var b=a.geoJson;if(b)return alp.oCreateMix(a,{geoJson:k(b)});if(b=a){var c=(a="string"===typeof b)?alp.oFrom(b):b,d=m.DATATYPE_NAME(),e=m.DEFAULTLEG(),l=m.NODE_INFO();if(!c[d]&&(e=alp.oGet(c,[e,d])||alp.oGet(c,[l,0,d])))return b={},b[d]=e,b=alp.oCreateMix(c,b),a?alp.oToString(b):b}return b}function h(a,b){if(!b)return null;var c=this.GEOMETRY_TYPE_MAP[a.toUpperCase()];switch(c){case "Point":case "LineString":case "Polygon":a=f(c,b);break;case "MultiPoint":case "MultiLineString":case "MultiPolygon":var d=
b.length;a=Array(d);for(var e=c.slice(5),l=0;l<d;l++)a[l]=f(e,b[l]);break;case "GeometryCollection":case "Feature":case "FeatureCollection":throw"alp.gmap.toGeoJSON: No support for "+a;default:throw"alp.gmap.toGeoJSON: Unknown Geometry type: "+a;}return{type:c,coordinates:a}}function g(a,b){a.crs&&console.warn("alp.gmap.fromGeoJSON: No support for Coordinate Reference Systems except EPSG:4326. Ignoring CRS...");var c=a.coordinates,d=(b||a.type).toUpperCase();switch(d){case "POINT":case "LINESTRING":case "POLYGON":return e(d,
c);case "MULTIPOINT":case "MULTILINESTRING":case "MULTIPOLYGON":a=c.length;b=Array(a);d=d.slice(5);for(var l=0;l<a;l++)b[l]=e(d,c[l]);return b;case "GEOMETRYCOLLECTION":case "FEATURE":case "FEATURECOLLECTION":throw"alp.gmap.fromGeoJSON: No support for "+d;default:throw"alp.gmap.fromGeoJSON: Unknown Geometry type: "+d;}}function f(a,b){if(!b)return null;switch(a){case "Point":return[b.lng(),b.lat()];case "LineString":case "Polygon":if(b instanceof Array){var c=b;var d=c.length}else{d=b.getVertexCount();
c=Array(d);for(var e=0;e<d;e++)c[e]=b.getVertex(e)}b=Array(d);for(e=0;e<d;e++){var l=c[e];if(!l)return;b[e]=l.z&&l.z.call?[l.lng(),l.lat(),l.z()]:[l.lng(),l.lat()]}return"Polygon"==a?[b]:b;default:throw"alp.gmap.toGeoJSON: Unknown simple geometry type: "+a;}}function e(a,c){switch(a.toUpperCase()){case "POINT":return d(c);case "POLYGON":return 1<c.length&&console.warn("alp.gmap.fromGeoJSON: No support for Polygon interior rings. geotype:",a,", coords:",c),b(c[0]);case "LINESTRING":return b(c);default:throw"alp.gmap.fromGeoJSON: Unknown simple geometry type: "+
a;}}function d(b){return null==b[2]?new r.LatLng(b[1],b[0]):new a.LatLngZD(b[1],b[0],!1,b[2])}function b(a){for(var b=a.length,c=Array(b),e=0;e<b;e++)c[e]=d(a[e]);return c}var c=alp.sub("alp._gmap2_3.geojson",null,!0),a=alp._gmap2_3,m=a.digitize;c.GEOMETRY_TYPES_SIMPLE=["Point","LineString","Polygon"];c.GEOMETRY_TYPE_MAP_SIMPLE={};alp.forEach(c.GEOMETRY_TYPES_SIMPLE,function(a){c.GEOMETRY_TYPE_MAP_SIMPLE[a.toUpperCase()]=a});var l=["MultiPoint","MultiLineString","MultiPolygon"];c.GEOMETRY_TYPES=c.GEOMETRY_TYPES_SIMPLE.concat(l);
c.GEOMETRY_TYPE_MAP=alp.oCreate(c.GEOMETRY_TYPE_MAP_SIMPLE);alp.forEach(l,function(a){c.GEOMETRY_TYPE_MAP[a.toUpperCase()]=a});c.fix_datatype_name=k;var r;alp.gmap3(function(a){r=a;c.toGeoJSON=h;c.fromGeoJSON=g})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.RoutedPolylineModel");
alp.gmap3(function(k){function h(a,b){var c={},d={},e;for(e in a)if(!(e in J)){var l=a[e],f=l&&l.nextleg;if(f)for(var g in f)if(!(g in J||g in I)){var m=f[g];if("object"!==typeof m)if(l=c[g]||(c[g]={}),l[m]=1+(l[m]||0),l=d,l[m]){if(l[m]!==m)throw Error("RPM:toGeoJSON:bug v2v: multiple values");}else l[m]=m}}var h=alp.mapIn(c,function(a){var b=0,c;for(c in a)if(!(c in J)){var e=a[c];e.toPrecision.call.a;if(e>b){var l=c;b=e}}b.toPrecision.call.a;b||(void 0).bug;l in d||(void 0).bug;return d[l]});c=
{};for(e in a)if(!(e in J)){f=(l=a[e])&&l.nextleg;var n=c[e]||(c[e]={});if(f)for(g in f)g in J||(m=f[g],m!==h[g]&&((n.nextleg||(n.nextleg={}))[g]=m));l.address&&(n.address=l.address);l.geo_xy&&(f=b&&b[e],null==f||1E-9<Math.max(Math.abs(l.geo_xy.x-f.lng()),Math.abs(l.geo_xy.y-f.lat())))&&(n.geo_xy=l.geo_xy);l.poiId&&(n.poiId=l.poiId)}a=alp.oCopy(h);E in a&&(a.routingstyle=a.ksf,delete a.ksf);a={defaultleg:a,node_info:c};for(e in c)!(e in J)&&(l=c[e],g=(b=l.nextleg)&&b[p])&&(1===g.length&&(l=g[0],1E-10>
Math.abs(0-l[v])&&1E-10>Math.abs(1-l[u])&&("ALPSTEIN_ROUTING"===l[x]?g.splice(0,1):(delete l[t],delete l[w]))),g.length||delete b[p]);return a}var g=alp._gmap2_3,f=alp.util,e=g.digitize,d=e.models,b=d._manual_pack_unpack,c=e.ADDRESS(),a=alp.cfg.datatype(),m=e.GEO_XY(),l=e.POIID(),r=e.NEXTLEG();e.TIME_START();e.TIME_END();var n=e.PUBLIC_TRANS_NONE();e.DURATION_MS();var q=e.PUBLIC_TRANSPORT(),p=e.PUBLIC_TRANSPORT_STEP_ARR();e.PT_FROM_POINT();e.PT_TO_POINT();var v=e.PT_FROM_PROP(),u=e.PT_TO_PROP(),t=
e.PT_START_LOCATION(),w=e.PT_END_LOCATION(),x=e.PT_TRAVEL_MODE(),y=e.KSF_ARR(),z=e.KSF_DEFAULT(),A=e.DATATYPE_NAME(),C=e.ROUTING_ENGINE(),E=e.KSF(),G=e.PT_RAIL_ONLY(),B=e.PT_WITH_BIKE(),I={time_start:1,time_end:1,routingengine_final:1},L=e.NEXTLEG_PROPAGATION_EXCLUDED(),J={};alp.declare("alp._gmap2_3.digitize.RoutedPolylineModel",e.AbstractPolylineModel,alp.nowF(function(b,c,l,f){var g=this;g._opts=alp.oCreateMix({gdirections_panel:document.createElement("div"),gdirections_options:{getPolyline:!0,
travelMode:alp.oGet(k,"TravelMode.WALKING")},robust:!0,datatype_cfg:a,routingengine_name_modifier:null},b);g._opts.extension=g._opts.extension||{};g._nodes=null==c?[]:[].concat(c);g._segments=null==l?[]:[].concat(l);g.node_info=new e.NodeInfoModel({init_value:f,datatype_cfg:g._opts.datatype_cfg},g);g.time_constraint_st=new alp.data.TimeConstraintState;g.backend_snap_t_st=new alp.NumberState;g._resetVerticeCache();if(!g.validate())throw Error("Invalid model - check console for details.");g.time_updater=
new d.RoutedPolylineTimeUpdater(g);g.duration_ms_st=g.time_updater.duration_ms_st;g.updateNearestFinder();g.attributes=new d.Attributes(g,g._opts.attributes);g.current_tilelayer_main=new alp.State;g.default_datatype_main=new alp.State;g.default_ksf_main=alp.modeStateFromArr(y,{init_value:z});g.default_speedprop_main=new alp.MinMaxState({min:0,max:1,init_value:.5});alp.oGet(g,"_opts.extension.segment_network")&&(g.aggressive_network_highlight_st=new alp.BoolState({init_value:!0}),alp.ratelimitM(-187,
"_update_aggressive_highlight",g),g.node_info.change_cb("_update_aggressive_highlight",g),g.nextleg_to_highlight_st.change_cb("_update_aggressive_highlight",g),g.aggressive_network_highlight_st.change_cb("_update_aggressive_highlight",g),g.default_datatype_main.change_cb("_update_aggressive_highlight",g));b=g.node_info.get();var m=e.NodeInfoModel.DEFAULT;g.default_routingengine_main=new alp.State({init_value:g._opts.routing_engine_init||b&&alp.oGet([m,"routingengine","main"])||g.getREDefaultName(),
constrain_all:function(a,b){return a||g.getREDefaultName()}});g.default_routingengine_main.change_cb(function(a){g.node_info.set_property([m,"routingengine","main"],a||"")});g.node_info.change_cb(function(a){(a=a&&alp.oGet(a,[m,"routingengine","main"]))&&g.default_routingengine_main.set(a)});g.current_routingengine_main=new alp.State({init_value:e.ROUTING_ENGINE_OUTDOORACTIVE(),constrain_all:function(a){return a||g.getREDefaultName()}});g.default_routingengine_main.bind_to(g.current_routingengine_main,
{loose:!0});g.current_routingengine_main.change_cb("_update_aggressive_highlight",g);g.default_public_transport_main=new alp.State({init_value:n});g.next_segment_is_routed_st=new alp.BoolState({init_value:!0});g.install_elevation_service_in_background();g.derive_elevation_summary_in_background()}),d.InterfaceWithAttrModel,d.InterfaceAppend,d.InterfaceAutoInsert,d.InterfaceCloseLoop,d.InterfaceCmdDeleteNode,d.InterfaceCmdMoveNode,d.InterfaceCmdUpdateNode,d.InterfaceRPMRoutingEngine,d.InterfaceRoutedImportantNode,
d.InterfaceToggleSegmentRouted,d.InterfaceUpdateNodeArray,d.InterfaceRPMElevationInBackground,d.InterfacePolyDeriveElevation,{getDatatypeEntry:function(a){return alp.m(this._opts,"getDatatypeEntry",a)},supportsRouting:!0,DEFAULT_SNAP_TOLERANCE:Infinity,REDUCED_SNAP_TOLERANCE:0,ALWAYS_SNAP_ENDS:!0,_nodes:null,_segments:null,time_constraint_st:null,backend_snap_t_st:null,_resetVerticeCache:function(a){this._verticeCache=null;a||(this._piecesCache=null)},clear:function(){this._length=0;this._nodes=[];
this._segments=[];this.attributes=new d.Attributes(this,this._opts.attributes);this._resetVerticeCache();alp.m(this.undoStack,"clear");this.onGeomClear(this);this.onGeomChange(this)},validate:function(){var a=this._nodes.length,b=this._segments.length;if((0!==a||0!==b)&&a!==b+1)return console.error("Nodes/Segments length mismatch: nSeg=",b,"nNode=",a),!1;a=!1;for(var c=0;c<b;c++){var d=this._segments[c];if(d){if(!d.vertices[0].equals(this._nodes[c])){console.error("Segment",c,": start-vertex != node",
c);console.error("s.vertices[0]:");console.error(d.vertices[0]);console.error("this._nodes[i]");console.error(this._nodes[c]);if(!this._opts.robust)return!1;d.vertices[0]=this._nodes[c];console.error("-> fixed (see #5651).");a=!0}if(!d.vertices[d.vertices.length-1].equals(this._nodes[c+1])){console.error("Segment",c,": end-vertex != node",c+1);if(!this._opts.robust)return!1;d.vertices[d.vertices.length-1]=this._nodes[c+1];console.error("-> fixed (see #5651).");a=!0}}}a&&alp.asyncF(0,"onGeomChange",
this)(this);return!0},getNode:function(a){0>a&&(a+=this._nodes.length);return this._nodes[a]},updateNode:function(a,b,c,d){a=this.updateNodeArray([a],b&&[b],c&&[c],d);return[a[0][0],a[1],a[2][0]]},getNodeIndex:function(a){return alp.indexOf(this._nodes,a)},getNodes:function(){return this._nodes.concat()},getVertices:function(){if(!this._verticeCache){for(var a=[],b=this._nodes.length,c=0;c<b;c++){a.push(this._nodes[c]);var d=this._segments[c];d&&a.push.apply(a,d.vertices.slice(1,-1))}this._verticeCache=
a}return this._verticeCache},getVertexCount:function(){return this.getVertices().length},getNodeCount:function(){return this._nodes.length},getSegmentCount:function(a){return a?alp.filter(this._segments,Boolean).length:this._segments.length},_createEmptyArray:function(a){return alp.map(Array(a),function(a){return null})},insertNodes:function(a,b,c,d){var e=alp.dfrd("RPM:insertNodes",{then:1}),l="object"===typeof c;if(1===a.length&&null==b)for(var f=a[0],g=l?c[0]:c,m=0,h=this._nodes.length-1;m<h;m++){var p=
g&&0<m&&!this._segments[m-1],n=g&&m<h&&!this._segments[m];if(!this._nodes[m]){var q;p&&(q=this._nodes[m-1])&&(this._segments[m-1]={from:q,to:f,vertices:[q,f]});n&&(q=this._nodes[m+1])&&(this._segments[m]={from:f,to:q,vertices:[f,q]});this.updateNodeArray([m],a,d,{force_reroute:!0});return}}f=Math.min(this._nodes.length,null==b?this._nodes.length:b);g=[].concat(a);if(0===this._nodes.length&&1===alp.filter(a,"").length)for(m=0,h=a.length;m<h;m++)if(p=a[m],n=d&&d[m],p){this._nodes[m]=p;a=this._insertNode_nodeInfo(p,
m,n);this.onInsertNodes([this._nodes[m]],m,a);g=g.slice(m+1);l&&(c=c.slice(m+1));d=alp.m(d,"slice",m+1);f+=m;break}m=!!this._segments[f-1];p=this._segments.length;n=this._nodes.length;h=a=null;null==c?(a=m,h=!!(0===b?this._segments[0]:b===n?this._segments[p-1]:m)):!0===c?h=a=!0:(a=!1,h=m);if(l&&g.length+1!==c.length)throw Error("alp._gmap2_3.digitize.RoutedPolylineModel.insertNodes: if `doRoute` is an array, then its length must be == 1 + nodes_iter.length");p=[];for(m=n=g.length-1;0<=m;m--){var k=
q=null;l&&(q=c[m],k=c[m+1]);null==q&&(q=a&&0<m||h&&0===m);null==k&&(k=a&&m<n||h&&m===n);p.push(this._insertNode(g[m],f,q,k,d&&d[m]))}this._segmentLengths=this._length=null;this._resetVerticeCache();this.onGeomChange(this,b);alp.gatherDfrd(p).thenSoon(function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c][0],l=d.length>>1;l=d.slice(0,10).concat(d.slice(l,1+l)).concat(d.slice(-10));l.length&&alp.forEach(l,"v.lat.call.a  &&  v.lng.call.a");b=b.concat(d)}e.done(b)});return e},_insertNode_nodeInfo:function(a,
b,d){var e=d;if(!e){var f=b?b-1:b,g=this.node_info.get_property(f);g&&f!==b&&alp.filterIn(g,"!(w in this)",L)}e||(e={});d||(e[c]="",e[m]={x:a.lng(),y:a.lat()},e[l]="");this.node_info.onInsertNodes([a],b,[e]);return e},_insertNode:function(a,b,c,d,e){e=this._insertNode_nodeInfo(a,b,e);var l=this.getNetworkSnapTolerance(c&&d?this.DEFAULT_SNAP_TOLERANCE:this.REDUCED_SNAP_TOLERANCE),f=[],g=null,m=null;b<this._nodes.length&&(d?(m=this.createSegment(b,a,this._nodes[b],l),g=m[0],f.push(m[1])):g=null,this._segments.splice(b,
0,g));0<b&&(c?(m=this.createSegment(b-1,this._nodes[b-1],a,l),g=m[0],f.push(m[1])):g=null,this._segments.splice(b-1,1,g));if(0>=b||!c)c=alp.dfrd("RPM:_insertNode:notrouted",{then:1}),c.done([null,[a]]),f.push(c);this._nodes.splice(b,0,a);this.onInsertNodes([a],b,[e]);var h=alp.dfrd("RPM:_insertNode",{then:1});f=alp.filter(f,"");f.length?alp.gatherDfrd(f).thenSoon(function(a){for(var b=[],c=a.length-1;0<=c;c--){var d=a[c][0];if(!0!==d&&!1!==d){d=d[1];var e=d.length>>1;e=d.slice(0,10).concat(d.slice(e,
1+e)).concat(d.slice(-10));e.length&&alp.forEach(e,"v.lat.call.a  &&  v.lng.call.a");b=b.concat(d)}}h.done(b)}):h.done([a]);return h},deleteNodes:function(a,b,c){b=Math.min(this._nodes.length-a,null==b?1:b);var d=this._nodes.splice(a,b),e=alp.dfrd("RPM:deleteNodes",{then:1}),l=b+1,f=Array(l);if(!(0<b))return console.log("alp._gmap2_3.digitize.RoutedPolylineModel.deleteNodes(): nothing to do for nNodes:",b),e.done(),[null,e];for(;l--;)f[l]=this.isSegmentRouted(a-1+l);this._resetVerticeCache(!0);l=
a-1;var g=this._segments[l],m=this._segments[l+b],h=this._nodes[l],p=this._nodes[l+1];h=g&&g.from||(m||c)&&h;c=m&&m.to||(g||c)&&p;h&&c?(c=this.createSegment(l,h,c),this._segments.splice(l,b+1,c[0]),c[1].thenSoon(alp.bindF("done",e))):(1>a?this._segments.splice(a,b):this._segments.splice(a-1,b),e.done());this.onDeleteNodes(a,b,d,this._nodes.length);this._segmentLengths=this._length=null;this.onGeomChange(this,a);return[d,e,f]},reverse:function(a){this._nodes.reverse();this._segments.reverse();a=this._segments.length;
for(var b=0;b<a;b++){var c=this._segments[b];c&&this._segmentReverse(c)}this.attributes.reverse();this._segmentLengths=null;this._resetVerticeCache();this.onReverse(this._nodes.length);this.onGeomChange(this)},toGeoJSON:function(){for(var a=this._segments.length,c=[],d=0;d<a;d++)this._segments[d]?c.push(this._segments[d].vertices):c.push([this._nodes[d],this._nodes[d+1]]);(a=g.geojson.toGeoJSON("MULTILINESTRING",c))&&!this.attributes.isEmpty()&&(a.attributes=this.attributes.toJSON());c=b.pack_node_info(this.node_info.get(),
this._segments);a&&c&&(c=h(c,this._nodes),a.defaultleg=c.defaultleg,a.node_info=c.node_info);a.time_constraint=this.time_constraint_st.get();return b.pack(a,this._nodes)},getSegmentModel:function(a){return this._segments[a]},createSegment:function(a,b,c,d){b={from:b,to:c,midPoint:null,vertices:[b,c]};a=this._segmentRoute(a,b,d);return[b,a]},isSegmentRouted:function(a){var b=this._segments.length;return 0>a||a>b?null:a===b?alp.m(this.next_segment_is_routed_st,"get"):!!this._segments[a]},getNetworkSnapTolerance:function(){console.error("getNetworkSnapTolerance should be overridden by controller!")},
_segmentFix:function(a){var b=this._nodes[a],c=this._segments[a-1],d=this._segments[a],e=c&&!c.to.equals(b),l=d&&!d.from.equals(b);e?d?(this._nodes[a]=b=c.to,d.from.equals(b)||(d.from=b,d.vertices.unshift(b))):(c.to=b,c.vertices.push(b)):l&&!c?this._nodes[a]=d.from:l&&c&&(d.from=c.to,d.vertices.unshift(c.to));c&&(c.midPoints=void 0);d&&(d.midPoints=void 0)},_segmentReverse:function(a){var b=a.to;a.to=a.from;a.from=b;a.vertices.reverse();a.midPoints=void 0},_segmentSetTo:function(a,b,c){return this._segmentSet(a,
"to",b,c)},_segmentSetFrom:function(a,b,c){return this._segmentSet(a,"from",b,c)},_segmentSet:function(a,b,c,d){if(0>a)throw Error("RPM:_segmentSet: index must be non-negative!");var e=this,l=alp.dfrd("RPM:_segmentSet",{then:1});setTimeout(alp.nowF(function(){var f=e._segments[a];!f||!d&&f[b].equals(c)?l.done():(f[b]=c,e._segmentRoute(a,f).thenSoon(function(a){l.done(a);return a}))}));return l},_segmentCalculateMidPoints:function(a){a.length=g.pathLength(a.vertices);var b=0;a.midPoints=[];for(var c=
0,d=a.vertices.length,e=a.vertices[0],l=1;l<d;l++){var f=a.vertices[l];c+=f.distanceFrom(e);e=c/a.length;Math.floor(10*e)>=b&&(a.midPoints.push([e,l]),b++);e=f}},_segmentCalculateMidPoint:function(a,b){a.midPoints||this._segmentCalculateMidPoints(a);"undefined"==typeof b&&(b=.5);var c=a.midPoints,d;for(d=0;d<c.length&&!(c[d][0]>b);d++);d--;var e=0<=d?c[d]:[0,0];d=d<c.length-1?c[d+1]:[1,a.vertices.length-1];b=(b-e[0])/(d[0]-e[0]);b*=g.pathLength(a.vertices.slice(e[1],d[1]+1));c=0;var l=d[1],f=a.vertices[e[1]];
for(d=e[1]+1;d<=l;d++){e=a.vertices[d];var m=e.distanceFrom(f);if(c+m>b)return this._calculateMidPoint(f,e,(b-c)/m);c+=m;f=e}return null},getSegmentMidPoint:function(a,b){var c=this._segments[a];if(c)return this._segmentCalculateMidPoint(c,b);c=this.getNode(a);a=this.getNode(a+1);return this._calculateMidPoint(c,a,b)},_calculateMidPoint:function(a,b,c){if(!a||!b)return null;"undefined"==typeof c&&(c=.5);var d=a.lat()+(b.lat()-a.lat())*c;a=a.lng()+(b.lng()-a.lng())*c;return new k.LatLng(d,a)},getCumLengthAtNode:function(a){if(1>
a)return 0;for(var b=this.getPieces(),c=0,d=b.length,e=0;e<d;e++){var l=b[e],g=l.seg_ind;if(g[g.length-1]<a)c+=l.d;else{(a=f.sortedsearch(a,g))&&(c+=l.dArr[a.first]);break}}return c},getSegmentLength:function(a){return alp.reduce(alp.map(this.getPieceInfoArrForSegment(a),"v.piece.dArr[ v.last ] - v.piece.dArr[ v.first ]"),"+")},getSegmentLengths:function(a,b){var c=this.getPieces();if(!c.length)return[];null!=a||(a=0);var d;null!=b||(b=1+(d=c[c.length-1].seg_ind,d[d.length-1]));for(var e=Array(b-
a),l=c.length,g=0;g<l;g++){d=c[g];var m=d.dArr;d=d.seg_ind;var h=d[0],p=1+d[d.length-1];if(!(a>=p)){if(b<=h)break;for(var n=0;h<p;h++){n=f.sortedsearch(h,d,{first:n});var q=h-a;e[q]=(e[q]||0)+m[Math.min(1+n.last,m.length-1)]-m[n.first];n=1+n.last}}}return e},getSegmentParts:function(a,b,c){null==a&&(a=0);null==b&&(b=this._segments.length);var d="flat"===c;c="no_index"===c;a=Math.max(0,Math.min(this._segments.length-1,a));b=Math.max(0,Math.min(this._segments.length,b));for(var e=[];a<b;a++){var l=
this._segments[a],f=[];if(l)if(l=l.vertices,d)e=e.concat(l);else if(c)for(var g=0,m=l.length-1;g<m;g++)f.push([l[g],l[g+1]]);else for(g=0,m=l.length-1;g<m;g++)f.push([a,l[g],l[g+1]]);else d?(e.push(this.getNode(a)),a==b-1&&e.push(this.getNode(a+1))):c?f.push([this.getNode(a),this.getNode(a+1)]):f.push([a,this.getNode(a),this.getNode(a+1)]);d||e.push(f)}return e},getAttributeSegments:function(a){a=this.attributes.get(a);for(var b=Array(a.length),c=this._nodes.length-1,d={cache:{}},e=0;e<a.length;e++){var l=
alp.oCreate(a[e]);l.from=Math.max(0,l.from);l.to=Math.max(l.from,Math.min(c,l.to));l.vertices=[];var f=Math.floor(l.from),g=Math.floor(l.to);if(f==g)l.vertices=this._getSegmentVerticesPc(f,l.from-f,l.to-f,d);else if(f<g){f!=l.from&&(l.vertices.push.apply(l.vertices,this._getSegmentVerticesPc(f,l.from-f,1,d)),f++);for(;f<g;f++){var m=this._segments[f];m?l.vertices.push.apply(l.vertices,m.vertices):l.vertices.push(this._nodes[f],this._nodes[f+1])}g!=l.to&&l.vertices.push.apply(l.vertices,this._getSegmentVerticesPc(g,
0,l.to-g,d))}b[e]=l}for(e=b.length;e--;)l=b[e],l.to<l.from+1E-10&&b.splice(e,1);return b},_getSegmentVerticesPc:function(a,b,c,d){function e(a){if(1E-10>a)return{ind:0};if(1-1E-10<a)return{ind:p};a*=q;for(var b=Math.round(f.dichotomy(a,0,p,n));a+1E-10<n[b];)b--;for(n[b].toPrecision.call.a;a>1E-10+n[b+1];)b++;b=Math.min(p,b);n[b].toPrecision.call.a;var c=n[b],d=n[b+1];return c+1E-10<d?{ind:b,latlng:l._calculateMidPoint(h[b],h[b+1],(a-c)/(d-c))}:{ind:b}}var l=this;d=d&&d.cache||{};var m=l._segments[a];
if(!m)return[l.getSegmentMidPoint(a,b),l.getSegmentMidPoint(a,c)];var h=m.vertices,p=h.length-1,n=a in d?d[a]:d[a]=g.pathCumLength(h),q=n.total;q.toPrecision.call.a;a=e(b);c=e(c);return(a.latlng?[a.latlng]:[]).concat(h.slice(a.latlng?a.ind+1:a.ind,c.ind+1)).concat(c.latlng?[c.latlng]:[])},getIndexForPoint:function(a){for(var b=e.getClosestPointOnLines(g.latlng2xy(a),g.latlng2xy(this.getVertices())),c=0,d=0,l=this._nodes.length,f=0;f<l;f++){c+=d;d=1;var m=this._segments[f];m&&(d+=m.vertices.length-
2);if(c+d>=b.i)break}if(f==l)return null;m=this._segments[f];b=b.i-c;c=1;if(m){c=0;m=m.vertices;d=g.pathLength(m);for(l=1;l<b;l++)c+=m[l].distanceFrom(m[l-1]);c/=d}return{i:f+c,p:a}},_update_aggressive_highlight:alp.nowF(function(){var a=this.nextleg_to_highlight_st.get();null==a&&this.aggressive_network_highlight_st.get()&&(a=this.getNodeCount()-1);a=alp.m(this.node_info,"getTileLayerForNextLeg",a);this.current_tilelayer_main.set(a||"")})});e.RoutedPolylineModel.fromGeoJSON=function(d,f){"string"===
typeof d&&(d=alp.oFrom(d));var m=alp.opt(f,"default_routingengine")||alp.opt(f,"routing_engine_init")||e.ROUTING_ENGINE_OUTDOORACTIVE()+","+e.ROUTING_ENGINE_OSRM()+","+e.ROUTING_ENGINE_GOOGLE();(f=alp.oCreateMix({datatype_cfg:a,routing_engine_init:m,routing_engine:alp.cfg.routingengine(),attributes:alp.cfg.linref().attributes,attr_default:e.ATTR_DEFAULT,preferManualElevationSummary:!1},f))&&f.readOnlyOptim||(d=b.unpack(d));var h=d.type&&d.type.toUpperCase();"LINESTRING"!=h&&"MULTILINESTRING"!=h&&
(console.error("alp._gmap2_3.digitize.RoutedPolylineModel: Unsupported GeoJSON type: "+d.type),d={type:"MultiLineString",coordinates:[]},h=d.type.toUpperCase());var p=g.geojson.fromGeoJSON(d);if("LINESTRING"==h){h=p.length;for(var k=Array(h-1),v=0;v<h-1;v++)k[v]=[p[v],p[v+1]];p=k}h=p.length;k=[];v=[];for(var w=0;w<h;w++){var t=p[w];k[w]=2<t.length?{from:t[0],to:t[t.length-1],vertices:t}:null;0===w&&v.push(t[0]);v.push(t[t.length-1])}p=alp.opt(d,"node_info")||{};var x=(w=alp.opt(d,"defaultleg"))?alp.oCopy(alp.filterIn(w,
"!(w in this)",I)):{};null==x[q]&&(x[q]=n);null==x[B]&&(x[B]=!1);null==x[G]&&(x[G]=!1);if(x)for(w=h+(h in p?1:0);w--;){t=[w,r];var u=alp.mix({},x,alp.oGet(p,t)||{});alp.oSet(p,t,u)}for(w=h;w--;)t=p[w],t[c]||(t[c]=""),t[l]||(t[l]="");x=alp.opt(f,"default_datatype_name")||f.datatype_cfg._default;for(w=0;w<h;w++)t=[w,r,A],(u=alp.oGet(p,t))?x=u:alp.oSet(p,t,x);for(w=0;w<h;w++)t=[w,r,C],(u=alp.oGet(p,t))?m=u:alp.oSet(p,t,m);f=new e.RoutedPolylineModel(f,v,k,p);f.attributes.fromJSON(d.attributes);f.time_constraint_st.set(d.time_constraint);
return f}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.multi_rpm");
alp.gmap3(function(k){function h(a){function m(){h[c]=null;u()}function l(){h[c]=null}a&&(this.stageTours=a);var h=this,n=h[f]||(h[f]=new alp.Eh);n.clear();var q=h[e]=alp.map(h.stageTours,function(a){return g.RoutedPolylineModel.fromGeoJSON(a,alp.opt(h.cfg,["readOnlyOptim"]))});a=h[d]=new g.models.Attributes(this,q[0]._opts.attributes);var p=alp.ratelimitF(131,alp.nowF(function(){h.duration_ms_st.set(alp.reduce(q,"v + w.duration_ms_st.get()",0))})),k=alp.ratelimitF(133,alp.nowF(function(){function a(a,
b){return alp.oCreateMix(b,{d:b.d+e[a]})}var b=alp.filter(alp.map(q,".elevationSummary.get()"),"");if(b.length){var c=alp.arrMinIndex(b,"null!=v.highest  ?  -v.highest.z  :  +Infinity"),d=alp.arrMinIndex(b,"null!=v.lowest   ?   v.lowest.z   :  +Infinity"),e=[0].concat(alp.arrCumSum(b,".d"));b={all:alp.and(b,".all"),ascent:alp.reduce(b,"v+w.ascent",0),descent:alp.reduce(b,"v+w.descent",0),highest:a(c,b[c].highest),lowest:a(d,b[d].lowest)};if(c=h.cfg.preferManualElevationSummary&&alp.oGet(h,"cfg.data.elevation")){d=
c.maxAltitude;var l=c.minAltitude;alp.mix(b,alp.filterIn({ascent:c.ascent,descent:c.descent,highest:alp.isFiniteNumber(d)?alp.mix({},b.highest,{z:d}):null,lowest:alp.isFiniteNumber(l)?alp.mix({},b.lowest,{z:l}):null},"!=null"))}h.elevationSummary.set(b)}else h.elevationSummary.set(null)})),u=alp.ratelimitF(137,alp.nowF(function(){h[b]=alp.reduce(alp.map(q,".getLength()"),"+")}));a.fromJSON(g.attrConcat(alp.map(q,"{attributes:v.attributes,segmentCount:v.getSegmentCount()}")));p();k();u();alp.forEach(q,
function(a){n.push(a.duration_ms_st.change_cb(p));n.push(a.elevationSummary.change_cb(k));n.push(a.geomChangeEvt().bindEvent(h.geomChangeEvt()));n.push(h.geomChangeEvt().thenSoon(m));n.push(a.zChangeEvt().bindEvent(h.zChangeEvt()));n.push(h.zChangeEvt().thenSoon(l))})}var g=alp._gmap2_3.digitize;alp.declare("alp._gmap2_3.digitize.MultiRPM",null,function(a,b){this.stageTours=a;this.cfg=alp.mixCheck({preferManualElevationSummary:!1,data:null,readOnlyOptim:!1},b);this.duration_ms_st=new alp.State;this.elevationSummary=
new alp.ObjectState;h.call(this)},g.AbstractPolylineModel.prototype,{attributes:null,getLength:function(){return this[b]||0},getPieces:function(){function a(a,b){for(var c=a.length,e=0;e<c;e++){var l=a[e];l=alp.mix({},l,{piece_ind:d.length,seg_ind:alp.map(l.seg_ind,"+=this",h),stageIndex:b,routed_seg_info:alp.arr2o(alp.map(alp.o2arr(l.routed_seg_info),"[this+(+v[0]),v[1]]",h),0,1)});var f=d.length,m=g.length;d.push(l);g.push(1>m?0:d[f-1].d+g[m-1])}a=a[a.length-1].seg_ind;h+=1+a[a.length-1]}if(!this[c]){var b=
alp.map(this[e]||[],".getPieces()"),d=this[c]=[],f=d.d=alp.reduce(b,"v + w.d",0),g=d.cum_d=[],h=0;alp.forEach(b,a);if(1E-7<Math.abs(f-g[g.length-1]-d[d.length-1].d))throw Error("AGD:MRPM: insane `d` and/or `cum_d` !");}return this[c]},reinit:h,geomChangeEvt:alp.memM("geomChangeEvt",'alp.event("AGD:MRPM:geomChangeEvt",{then:1})'),zChangeEvt:alp.memM("zChangeEvt",'alp.event("AGD:MRPM:zChangeEvt",{then:1})')});var f="_eh",e="_rpmArr",d="attributes",b="_length",c="_piecesCache"});
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.const_elpro");
(function(){alp.sub("alp._gmap2_3.x",null,!0).ConstElpro={factDuration:"alp-tpwiz-fact-duration",factDurationH:"alp-tpwiz-fact-duration-h",factDurationM:"alp-tpwiz-fact-duration-m",factAscent:"alp-tpwiz-fact-ascent",factDescent:"alp-tpwiz-fact-descent",factHighest:"alp-tpwiz-fact-highest",factLowest:"alp-tpwiz-fact-lowest",factLength:"alp-tpwiz-fact-length",elproCanvas:"alp-tpwiz-elpro-canvas",elproLegendHeight:"alp-tpwiz-elpro-legend-height",elproLegendDistance:"alp-tpwiz-elpro-legend-distance",
elproLegendStageDistance:"alp-tpwiz-elpro-legend-stage-distance",elproClipping:"alp-tpwiz-elpro-clipping",elproClippingLeft:"alp-tpwiz-elpro-clipping-left-val",elproClippingRight:"alp-tpwiz-elpro-clipping-right-val",elproMiniClass:"alp-tpwiz-ep-mini",linrefEditCont:"alp-tpwiz-activate-linref-edit",linrefEditToggle:"alp-tpwiz-activate-linref-toggle-button",linrefEditActivate:"alp-tpwiz-activate-linref-edit-button",linrefEditCancel:"alp-tpwiz-activate-linref-cancel-button",linrefEditSave:"alp-tpwiz-activate-linref-save-button",
linrefEditView:"alp-tpwiz-activate-linref-edit-view",linrefEditLegend:"alp-tpwiz-attr-legend",linrefEditActiveClass:"alp-tpwiz-linref-edit-active",linrefEditInactiveClass:"alp-tpwiz-linref-edit-inactive"}})();"undefined"!==typeof dojo&&dojo.provide("alp.util.color");
(function(){alp.sub("alp.util",null,!0).color=function(h){if("string"!==typeof h)return h;if(h in k)return k[h];if(!/^#/.test(h))throw Error('alp.util.color: "'+h+'" not supported!');var g=h.length;g=(4===g?h+"F":7===g?h+"FF":h).slice(1);var f=g.length;if(4===f)g=alp.map(g.split(""),"parseInt(v,16)/15");else if(8===f)g=alp.map(g.match(/../g),"parseInt(v,16)/255");else throw Error('alp.util.color: "'+h+'" not supported!');return k[h]=g};var k={}})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.util");
(function(){function k(f,e){var d=f.eps||1E-10;if(null!=f.fromSoft){var b=f.fromSoft|0;var c=f.fromSoft-b}else b=f.fromInt,c=f.fromFrac;if(null!=f.toSoft){var a=f.toSoft|0;f=f.toSoft-a}else a=f.toInt,f=f.toFrac;alp.forEach([d,b,c,a,f],".toPrecision.call.a");var g=[];b<<=1;a<<=1;if(c<d)alp.arrPushBig(g,e.slice(b,a+2));else{var l=b;g.push(e[l]*(1-c)+e[l+2]*c,e[l+1]*(1-c)+e[l+3]*c);alp.arrPushBig(g,e.slice(b+2,a+2))}d<f&&(l=a,c=f,g.push(e[l]*(1-c)+e[l+2]*c,e[l+1]*(1-c)+e[l+3]*c));return g}var h=alp.sub("alp.gr",
null,!0),g=alp.util;h.cutFlatGeom=k;h.determineLineSteps=function(f,e,d){function b(b,c,d){d=g.color(d);d={geomF:alp.bindF(k,null,{fromInt:m,fromFrac:l,toInt:b,toFrac:c,eps:1E-10}),cfg:alp.oCreateMix(e,{color:d})};a.push(d);m=b;l=c}var c=e.color;f>>=1;var a=[],m=0,l=0,h=0,n=d[h],q=n&&n.from,p=n&&q|0;q=n&&q-p;var v=n&&n.to,u=n&&v|0;for(v=n&&v-u;;){if(!n){m<f-1&&b(f-1,0,c);break}m<p||l<q-1E-10?b(p,q,c):(b(u,v,n.color),h++,q=(n=d[h])&&n.from,p=n&&q|0,q=n&&q-p,v=n&&n.to,u=n&&v|0,v=n&&v-u)}return a};h.flattenGeom=
function(f){for(var e=[],d=f.length,b=0;b<d;b++)e.push.apply(e,f[b]);return e};h.notSupported=function(){"undefined"!==typeof console&&console.error("GR: operation not supported")}})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.c2");
(function(){var k=alp.sub("alp.gr",null,!0);k.gr_lineGeom_2_c2Geom=function(g,f,e){"number"!==typeof f[0]&&(f=k.flattenGeom(f));if(e)return f;e=f.length;var d=Array(e),b=g._w2;g=g._h2;for(var c=0;c<e;d[c]=(1+f[c])*b,c++,d[c]=(1-f[c])*g,c++);return d};k.gr_rectGeom_2_c2Geom=function(g,f,e){"number"!==typeof f[0]&&(f=k.flattenGeom(f));var d=f[0],b=f[1],c=f[2];f=f[3];if(e)return[d,b,c-d,f-b];e=g._w2;g=g._h2;return[(1+d)*e,(1-f)*g,(c-d)*e,(f-b)*g]};k.getColorC2=function(g){var f=g.join(",");return f in
h?h[f]:h[f]="rgba("+[Math.max(0,Math.min(255,Math.round(255*g[0]))),Math.max(0,Math.min(255,Math.round(255*g[1]))),Math.max(0,Math.min(255,Math.round(255*g[2]))),g[3]||1].join()+")"};var h={}})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.c2vml");
(function(){function k(a){this.cont=a;this._styleHeap=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1}function h(a){a=a.fill;for(var b=g(a?this.fillStyle:this.strokeStyle),c=f(this),d=this._path,e=d.length,m=0;m<e;m++){var h=d[m];if(4E3<h.length){for(var k=Array(4E3),t=h.length,w=t/k.length,x=k.length>>1;x--;){var y=Math.min(t-1,Math.max(0,2*Math.round(x*w)));k[x<<1]=h[y];k[(x<<1)+1]=h[y+1]}h=k}k=a?"fill":"stroke";h='<polyline style="behavior: url(#default#VML);'+(null==b.opacity100?"":
"filter: alpha(opacity="+b.opacity100+"); zoom: 1;")+'" xmlns="urn:schemas-microsoft.com:vml" '+k+'color="'+b.color+'" '+(a?"":'strokeweight="'+this.lineWidth+'" ')+'points="'+h.join(",")+'" filled="'+(a?"t":"f")+'" stroked="'+(a?"f":"t")+'" ><'+k+'  xmlns="urn:schemas-microsoft.com:vml"></'+k+"></polyline>";console.log(h);c.appendChild(document.createElement(h))}}function g(b){var c=b.match(a);return c?(b=Math.round(100*c[2]),{color:"rgb("+c[1]+")",opacity100:100>b?b:null}):{strokecolor:b}}function f(a){if(!a._vml_topgroup){var b=
document.createElement("div");b.setAttribute("style","position: absolute; width: 100%; height: 100%; margin: 0; padding: 0; ");var c=document.createElement('<group style="behavior: '+d+'; position: absolute; rotation: 0deg; width: 1000px; height: 1000px; margin: 0; padding: 0;" xmlns="urn:schemas-microsoft.com:vml" coordorigin="0,0" coordsize="1000,1000">');b.appendChild(c);a._vml_bgcolordiv=b;a._vml_topgroup=c;a.cont.appendChild(b);a.vmlResize()}return a._vml_topgroup}alp.sub("alp.gr",null,!0);alp.gr.emulateCanvas2dUsingVml=
function(a){if(null==e){var c=document.createElement("group"),f=c.style;f.behavior=d;if(e=!!c.adj)for(var g in{transform:1,KhtmlTransform:1,OTransform:1,msTransform:1,MozTransform:1,webkitTransform:1})if(!(g in b)&&g in f){e=!1;break}}return e&&new k(a)};var e,d="url(#default#VML)",b={},c=k.prototype;c.save=function(){this._styleHeap.push({strokeStyle:this.strokeStyle,fillStyle:this.fillStyle,lineWidth:this.lineWidth})};c.restore=function(){var a=this._styleHeap.pop();a&&(this.strokeStyle=a.strokeStyle,
this.fillStyle=a.fillStyle,this.lineWidth=a.lineWidth)};c.strokeStyle=function(a){this.strokeStyle=a};c.lineWidth=function(a){this.lineWidth=a};c.fillStyle=function(a){this.fillStyle=a};c.beginPath=function(){this._path=[]};c.moveTo=function(a,b){this._path.push(this._subpath=[a,b])};c.lineTo=function(a,b){this._subpath.push(a,b)};c.stroke=function(){h.call(this,{fill:!1})};c.fill=function(){h.call(this,{fill:!0})};c.fillRect=function(a,b,c,d){var e=g(this.fillStyle);f(this).appendChild(document.createElement('<rect xmlns="urn:schemas-microsoft.com:vml" style="behavior: url(#default#VML);'+
(null==e.opacity100?"":"filter: alpha(opacity="+e.opacity100+"); zoom: 1;")+"left:"+(a|0)+"px; top:"+(b|0)+"px; width: "+(c|0)+"px; height: "+(d|0)+'px;" fillcolor="'+e.color+'" strokecolor="'+e.color+'" ><fill xmlns="urn:schemas-microsoft.com:vml"></fill></rect>'))};c.resize=function(){};c.vmlClear=function(a){a||(a=this._vml_need_to_clear);var b=a&&a.color,c=100;"string"!==typeof b&&(c=Math.max(0,Math.min(100,Math.round(100*b[3]))),b="rgb("+Math.max(0,Math.min(255,Math.round(255*b[0])))+","+Math.max(0,
Math.min(255,Math.round(255*b[1])))+","+Math.max(0,Math.min(255,Math.round(255*b[2])))+")");var d=this._vml_topgroup;if(d){for(;a=d.lastChild;)d.removeChild(a);b&&(this._vml_bgcolordiv.style.backgroundColor=b,this._vml_bgcolordiv.style.filter=100>c?"alpha(opacity="+c+")":"",this._vml_bgcolordiv.style.zoom=1);delete this._vml_need_to_clear}else a&&(this._vml_need_to_clear=a)};c.vmlResize=function(){var a=this.cont,b=this._vml_topgroup;a&&b&&(a=a.getBoundingClientRect(),b=a.bottom-a.top|0,a.right-a.left|
0&&b&&this._vml_need_to_clear&&this.vmlClear())};var a=/^rgba\((\s*\d+\s*,\s*\d+\s*,\s*\d+\s*),\s*([^\)]+?)\s*\)$/i})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.gl");
(function(){function k(a,b,c){b="_gl_"+b+"_progwrap";if(!(b in a))try{a[b]=m(a._gl,c(a._gl))}catch(z){if(!v.test(z))throw z;a[b]=z}if(a[b]instanceof Error)throw a[b];c=a[b];a[t]!==c&&(a._gl.useProgram(c.program),a[t]=c);return c}function h(a){return{vertexShader:d(a,"uniform highp vec2 uShift; attribute vec2 aPosition; void main() { gl_Position = vec4(aPosition+uShift, 0, 1); }"),fragmentShader:b(a,"uniform highp vec4 uColor; void main() { gl_FragColor = uColor; }"),attrName2cfg:{aPosition:{size:2}},
unifName2cfg:{uShift:{vec:"2f"},uColor:{vec:"4f"}}}}function g(a){return{vertexShader:d(a,"uniform highp vec2 uShift; attribute vec2 aPosition; attribute vec4 aVertexColor; varying lowp vec4 vColor; void main() { gl_Position = vec4(aPosition+uShift, 0, 1); vColor = aVertexColor; }"),fragmentShader:b(a,"varying lowp vec4 vColor; void main() { gl_FragColor = vColor; }"),attrName2cfg:{aPosition:{size:2},aVertexColor:{size:4}},unifName2cfg:{uShift:{vec:"2f"}}}}function f(a,b){var c=alp.bindF(a,b);return function(a){if(a._gl)try{return c.apply(null,
arguments)}catch(A){if(!v.test(A))throw A;console.error(""+A);setTimeout(function(){throw A;});return!1}l.notSupported()}}function e(a){a=p+a;console.error(a);throw Error(a);}function d(b,c){return a(b,b.VERTEX_SHADER,c)}function b(b,c){return a(b,b.FRAGMENT_SHADER,c)}function c(a,b){var c=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),a.STATIC_DRAW)}function a(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);a.getShaderParameter(b,
a.COMPILE_STATUS)||e(p+"An error occured compiling the shaders: "+a.getShaderInfoLog(b));return b}function m(a,b){function c(b){var c=this.TypedArrayCtor||Float32Array,d=this.type||r,e=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,e);a.bufferData(a.ARRAY_BUFFER,new c(b),a.STATIC_DRAW);a.enableVertexAttribArray(this.pointer);a.vertexAttribPointer(this.pointer,this.size,a[d],!1,0,0)}function d(b){a["uniform"+this.vec+"v"](this.pointer,new (this.TypedArrayCtor||Float32Array)(b))}function l(b){a["uniformMatrix"+
this.mat+"v"](this.pointer,!1,new (this.TypedArrayCtor||Float32Array)(b))}var f=b.program=a.createProgram();a.attachShader(f,b.vertexShader);a.attachShader(f,b.fragmentShader);a.linkProgram(f);a.getProgramParameter(f,a.LINK_STATUS)||e(p+"Unable to initialize the shader program.");var g=b.attrName2cfg,m=b.attr={},h;for(h in g)if(!(h in u)){var n=g[h];m[h]={pointer:a.getAttribLocation(f,h),size:n.size,set:c}}g=b.unifName2cfg;m=b.unif={};for(h in g)h in u||(n=g[h],m[h]={pointer:a.getUniformLocation(f,
h),vec:n.vec,mat:n.mat,set:n.vec?d:l});return b}var l=alp.sub("alp.gr",null,!0),r=l.GL_FLOAT="FLOAT";l.GL_WHOLE=[-1,-1,1,1];l.GL_TRIANGLES="TRIANGLES";var n=l.GL_TRIANGLE_FAN="TRIANGLE_FAN";l.GL_TRIANGLE_STRIP="TRIANGLE_STRIP";var q=l.GL_LINE_STRIP="LINE_STRIP",p=l.GR_GL_ERROR_PREFIX="alp.gr.gl:WebGL: ",v=l.GR_GL_ERROR_PREFIX_RX=/\balp\.gr\.gl:WebGL: /;l.getLineVxViModeGL=function(a,b){return{mode:q,vert:a,vind:null}};l.getPolyFillVxViModeGL=function(a,b){return{mode:n,vert:a,vind:null}};l.glCatch=
function(a,b,c){var d=alp.Aps.call(arguments,2);f(a,b).apply(null,d)};l.glCatchF=f;l.gl_consoleThrowError=e;l.gl_getFragmentShader=b;l.gl_getVertexShader=d;l.gl_setVind=c;l.gr_lineGeom_2_glGeom=function(a,b,c){"number"!==typeof b[0]&&(b=l.flattenGeom(b));if(!c)return b;c=b.length;var d=Array(c),e=a._w2;a=a._h2;for(var f=0;f<c;d[f]=-1+b[f]/e,f++,d[f]=1-b[f]/a,f++);return d};l.gr_rectGeom_2_glGeom=function(a,b,c){"number"!==typeof b[0]&&(b=l.flattenGeom(b));if(c){c=a._w2;var d=a._h2;a=b[0];var e=b[1];
var f=b[2]-a;b=b[3]-e;a=-1+a/c;e=1-e/d;c=a+f/c;d=e-b/d}else a=b[0],d=b[1],c=b[2],e=b[3];return[a,d,c,d,c,e,a,e]};l.gr_paintGL=f(function(a,b){var d=a._gl,e=k(a,"paint",h);a=e.unif;e=e.attr;a.uShift.set(b.uShift);a.uColor.set(b.uColor);e.aPosition.set(b.vert);b.vind?(c(d,b.vind),d.drawElements(d[b.mode],b.vind.length,d.UNSIGNED_SHORT,0)):d.drawArrays(d[b.mode],0,b.vert.length/2)});l.gr_paintGL_many=f(function(a,b){function d(b,d){if(b.length){var g=[[0,0]];if(d){g=a._gl_hpx;var m=a._gl_hpy,h=2*g,p=
2*m;g=d?[[-g,-m],[g,m],[-g,m],[g,-m],[-h,-p],[h,p],[-h,p],[h,-p],[-h,0],[h,0],[0,p],[0,-p]]:[[0,0]]}m=b[0].cfg.pixel;if(!alp.and(b,"!!v.cfg.pixel === "+!!m))throw Error("_AGR_gr_paintGL_many_impl: all `pixel` values must be the same!");d=[];h=[];var n=null;p=b.length;for(var q=0;q<p;q++){var k=b[q],r=k.cfg.color,v=k.geom;if(n){n=n.geom;var w=n.length,t=v[0],x=v[1];1E-7<Math.max(Math.abs(t-n[w-2]),Math.abs(x-n[w-1]))&&(d.push(0,0,0,0,0,0,0,0),h.push(t,x,t,x))}n=k;alp.arrPushBig(d,alp.arrRep(r,v.length>>
1));alp.arrPushBig(h,v)}b=l.gr_lineGeom_2_glGeom(this,h,m);b=l.getLineVxViModeGL(b);m=f.unif;h=f.attr;h.aPosition.set(b.vert);h.aVertexColor.set(d);d=g.length;for(h=0;h<d;h++)m.uShift.set(g[h]),b.vind?(c(e,b.vind),e.drawElements(e[b.mode],b.vind.length,e.UNSIGNED_SHORT,0)):e.drawArrays(e[b.mode],0,b.vert.length/2)}}var e=a._gl,f=k(a,"paintmany",g),m=alp.filter(b,"!v.cfg.thick");b=alp.filter(b,".cfg.thick");d(m);d(b,!0)});l.gr_useGetProgwrapGL=k;var u={},t=l.GL_CUR="_glCurrentProgwrap"})();
"undefined"!==typeof dojo&&dojo.provide("alp.gr._core");
(function(){function k(a,b){function c(){f.resize()}function d(){f.resize({only_if_changed:!0})}var e=b&&b.no_webgl,l=b&&b.no_autoresize,f=this;null==e&&(e=(e=(/\bWindows NT (\d+(?:\.\d+))/.exec(navigator.userAgent)||[])[1])&&6.1>e||alp.likeIE());f.cont=a;a.childNodes.a;var g=n.get(a);g&&alp.orphan(g);g=n.setNow(a,document.createElement("canvas"));var m=g.getContext;m&&(g[r]("style","width: 100%; height: 100%; margin: 0; padding: 0;"),f.canvas=g,a.appendChild(g));a=f._=(f._gl=m&&!e&&(g.getContext("webgl")||
g.getContext("experimental-webgl")))||(f._c2=m&&g.getContext("2d"))||(f._c2=f._c2vml=alp.gr.emulateCanvas2dUsingVml(a));this.bestPerfWithPixel=f._!==f._gl;f.onresize=b&&b.onresize&&alp.ratelimitF(10,alp.asyncF(0,b.onresize));if(a){if(b=f._gl)b.disable(b.DEPTH_TEST),b.enable(b.BLEND),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);f.resize();window.addEventListener?window.addEventListener("resize",c):window.attachEvent("onresize",c);l||setInterval(d,129)}else"undefined"!==typeof console&&console.error("getInitGR: Found neither WebGL nor 2d support on this canvas, nor VML support!")}
function h(b,d){var l=e.color(d&&d.color||c),g=b&&d&&d.pixel,m=this.canvas||this.cont,h=this._gl;d=this._c2;b||(b=a);h?f.notSupported():d?(b===a&&0===l[3]?(d.save(),d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,m.clientWidth,m.clientHeight)):(b=f.gr_rectGeom_2_c2Geom(this,b,g),l=f.getColorC2(l),d.save(),d.fillStyle=l,d.fillRect.apply(d,b)),d.restore()):f.notSupported();return this}function g(a){var b=this.canvas||this.cont,c=this.canvas,d=this._gl,e=this._c2,h=b.clientWidth;b=b.clientHeight;var n=this._w!==
h||this._h!==b;if(!a||!a.only_if_changed||n){this._w=h;this._h=b;this._w2=h/2;this._h2=b/2;this[m]=1/h;this[l]=1/b;c?(c.width!==h&&(c.width=h),c.height!==b&&(c.height=b),d?d.viewport(0,0,h,b):e&&e.resize&&e.resize()):this._.vmlResize?this._.vmlResize():f.notSupported();if(0<h&&0<b){if(this.onresize)this.onresize(this);n&&alp.asyncF(257,g,this)()}else alp.asyncF(123,g,this)();return this}}var f=alp.sub("alp.gr",null,!0),e=alp.util;f.glc2=function(a,b,c,d){var e=alp.Aps.call(arguments,3);if(d._gl)return f.glCatch.apply(f,
[a,b].concat(e));if(d._c2)return c[a].apply(c,e);f.notSupported()};alp.GR=k;var d=k.prototype,b=f.BLACK=d.BLACK=[0,0,0,0],c=f.WHITE=d.WHITE=[1,1,1,1],a=d.GL_WHOLE=alp.gr.GL_WHOLE;d.clear=function(a){this._.vmlClear?this._.vmlClear(a):h.call(this,null,a)};d.getHeightPixel=function(){return this._h};d.getWidthPixel=function(){return this._w};d.line=function(a,c){var d=e.color(c&&c.color||b),g=a&&c&&c.pixel,h=c&&c.thick,n=c&&c.colorsteps,p=this._gl,q=this._c2;c=c&&c.maxsteps||(p?1E4:1E3);var k={color:d,
pixel:g,thick:h};if(n)d=f.determineLineSteps(a.length,k,n),d=alp.map(d,"{ cfg : v.cfg, geom : (v = v.geomF( this )), left : v[0], right : v[v.length-2], xspan : v[v.length-2]-v[0] }",a),d.length>c&&(d=d.sort(function(a,b){return b.xspan-a.xspan}).slice(0,c)),p?f.gr_paintGL_many(this,d):alp.forEach(d,"this.line( v.geom, v.cfg )",this);else if(p)for(q=f.gr_lineGeom_2_glGeom(this,a,g),q=f.getLineVxViModeGL(q),p=this[m],a=this[l],c=2*p,g=2*a,h=h?[[-p,-a],[p,a],[-p,a],[p,-a],[-c,-g],[c,g],[-c,g],[c,-g],
[-c,0],[c,0],[0,g],[0,-g]]:[[0,0]];q.uShift=h.pop();)q.uColor=d,f.gr_paintGL(this,q);else if(q){p=f.gr_lineGeom_2_c2Geom(this,a,g);d=f.getColorC2(d);q.save();q.strokeStyle=d;h&&(q.lineWidth="number"===typeof h?h:3.5);q.beginPath();q.moveTo(p[0],p[1]);d=p.length;for(h=2;h<d;q.lineTo(p[h++],p[h++]));q.stroke();q.restore()}else f.notSupported();return this};d.polyFill=function(a,b){var d=e.color(b&&b.color||c),l=b&&b.pixel,g=this._gl;b=this._c2;a=a.concat(a.slice(0,2));if(g)b=f.gr_lineGeom_2_glGeom(this,
a,l),b=f.getPolyFillVxViModeGL(b),b.uShift=[0,0],b.uColor=d,f.gr_paintGL(this,b);else if(b){a=f.gr_lineGeom_2_c2Geom(this,a,l);d=f.getColorC2(d);b.save();b.strokeStyle="rgb(0,0,0,0)";b.lineWidth=0;b.fillStyle=d;b.beginPath();b.moveTo(a[0],a[1]);d=a.length;for(l=2;l<d;b.lineTo(a[l++],a[l++]));b.fill();b.restore()}else f.notSupported()};d.rectFill=h;d.resize=g;d.flattenGeom=alp.gr.flattenGeom;var m="_gl_hpx",l="_gl_hpy",r="setAttribute",n=alp.mapany()})();"undefined"!==typeof dojo&&dojo.provide("alp.gr");
"undefined"!==typeof dojo&&dojo.provide("alp.gr.c2.elpro_background");
(function(){var k=alp.gr;alp.sub("c2",k,!0).elproBackground=function(h,g,f){var e=h._c2;g=k.gr_lineGeom_2_c2Geom(h,g,f.pixel);var d=k.getColorC2(f.earthTop),b=k.getColorC2(f.earthBottom),c=k.getColorC2(f.skyTop),a=k.getColorC2(f.skyBottom);e.save();var m=h.getWidthPixel();h=h.getHeightPixel();if(e.createLinearGradient){var l=e.createLinearGradient(0,0,0,h);l.addColorStop(0,d);l.addColorStop(1,b);e.fillStyle=l}else e.fillStyle=k.getColorC2(alp.map(alp.zip(f.earthTop,f.earthBottom),"Math.min(v[0],v[1])")),
console.log(e.fillStyle);e.beginPath();e.moveTo(g[0],g[1]);d=g.length;for(b=2;b<d;e.lineTo(g[b++],g[b++]));e.lineTo(m-1,h-1);e.lineTo(0,h-1);e.lineTo(g[0],g[1]);e.fill();e.createLinearGradient?(l=e.createLinearGradient(0,0,0,h),l.addColorStop(0,c),l.addColorStop(1,a),e.fillStyle=l):e.fillStyle=k.getColorC2(alp.map(alp.zip(f.skyTop,f.skyBottom),"Math.min(v[0],v[1])"));e.beginPath();e.moveTo(g[0],g[1]);d=g.length;for(b=2;b<d;e.lineTo(g[b++],g[b++]));e.lineTo(m,0);e.lineTo(0,0);e.lineTo(g[0],g[1]);e.fill();
e.restore()}})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.gl.array_access_code_gen");(function(){function k(h,g,f,e){if(g>=f)return"";if(g===f-1){h=e.length;f=Array(h);for(var d=0;d<h;d++){var b=e[d];f[d]=b[0]+"="+b[1]+"["+g+"];"}return f.join("\n")}d=g+f>>1;return["if("+h+"<"+d+"){",k(h,g,d,e),"}else{",k(h,d,f,e),"}"].join("\n")}alp.sub("alp.gr.gl",null,!0).arrayAccessCodeGen=k})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.gl.elpro_background");
(function(){function k(g){var f=g.getParameter&&g.getParameter(g.MAX_FRAGMENT_UNIFORM_VECTORS);f=f&&1<<-1+Math.floor(Math.log(f-16)/Math.log(2))||16;f=Math.min(64,f);return{vertexShader:h.gl_getVertexShader(g,"attribute vec2 aPosition; attribute float aPix; varying vec2 vPY; void main() { gl_Position = vec4(aPosition, 0, 1); vPY = vec2( aPix, aPosition.y ); }"),fragmentShader:h.gl_getFragmentShader(g,["uniform highp mat4 uEarthSky;","uniform highp float uYmin["+f+"];","uniform highp float uYmax["+
f+"];","varying highp vec2  vPY;\nvoid main() {\n  int iPix = int( vPY.x );\n  highp float y = vPY.y;\nhighp float yMin; highp float yMax;",h.gl.arrayAccessCodeGen("iPix",0,f,[["yMin","uYmin"],["yMax","uYmax"]]),"  if (y < yMin)\n    gl_FragColor = mix( uEarthSky[0], uEarthSky[1], (1. + y) / 2. );\n  else if (y > yMax)\n    gl_FragColor = mix( uEarthSky[2], uEarthSky[3], (1. + y) / 2. );\n  else\n    discard;\n}"].join("\n")),attrName2cfg:{aPosition:{size:2},aPix:{size:1}},unifName2cfg:{uEarthSky:{mat:"4f"},
uYmin:{vec:"1f"},uYmax:{vec:"1f"}},misc:{blocksize:f}}}var h=alp.gr;alp.sub("gl",h,!0).elproBackground=function(g,f,e){for(var d=f.length,b=0;b<Math.min(6,d);b++)alp.isFiniteNumber(f[b])||(void 0).bug;d=f.length;for(b=Math.max(0,d-6);b<d;b++)alp.isFiniteNumber(f[b])||(void 0).bug;d=g.getWidthPixel();var c=h.gr_useGetProgwrapGL(g,"elproBackground",k);b=c.unif;var a=c.attr;g=g._gl;c=c.misc.blocksize;var m=2/d;b.uEarthSky.set(alp.arrChain([e.earthBottom,e.earthTop,e.skyBottom,e.skyTop]));e=(f[0]/m|0)*
m;for(var l=[],r=[],n=0,q=f.length,p=e+m,v=!1;n<q;){var u=f[n],t=f[n+1];if(v)u<p?(w=Math.min(w,t),x=Math.max(x,t),n+=2):(l.push(w),r.push(x),p+=m,v=!1);else if(u<p){var w=t,x=t;n+=2;v=!0}else l.push(null),r.push(null),p+=m}for(;l.length<d;)l.push(null),r.push(null);null==l[0]&&(l[0]=r[0]=f[1]);d=l.length-1;null==l[d]&&(l[d]=r[d]=f[f.length-1]);f=l.length;d=0;for(u=null;d<f;d++)if(w=null==l[d],null==u)w&&(u=d-1);else if(!w){w=d;x=1/(w-u);n=l[u];q=r[u];p=l[w];v=r[w];u+=1;for(t=x;u<w;u++,t+=x){var y=
1-t;l[u]=y*n+t*p;r[u]=y*q+t*v}u=null}f=l.length;for(w=0;w<f;w+=c-1)x=Math.min(f,w+c),d=x-w,n=l.slice(w,x),q=r.slice(w,x),b.uYmin.set(n),b.uYmax.set(q),n=e+w*m,x=e+(x-1)*m,x=[n,-1,n,1,x,-1,x,1],d=[0,0,d-1-1E-9,d-1-1E-9],a.aPosition.set(x),a.aPix.set(d),g.drawArrays(g[h.GL_TRIANGLE_STRIP],0,x.length/2)}})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.elpro_background");
(function(){var k=alp.gr,h=alp.util;k.elproBackground=function(f,e,d){var b=alp.mix(alp.oCreateMix(g,d));alp.forEach(["earthBottom","earthTop","skyBottom","skyTop","stageVlineColor"],function(a){b[a]=h.color(b[a])});k.glc2("elproBackground",k.gl,k.c2,f,e,b);if(e=b.stageVlineArr){d=e.length;for(var c=0;c<d;c++){var a=e[c];f.line([a.x,a.y_bottom,a.x,a.y_top],{color:b.stageVlineColor,thick:b.stageVlineThick,pixel:b.pixel})}}};var g={earthBottom:[0,.1,0,1],earthTop:[.17,.66,.33,1],skyBottom:[.9,.9,1,
1],skyTop:[.1,.26,.9,1],stageVlineArr:null,stageVlineColor:[0,0,0,1],stageVlineThick:!0}})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.elpro_highest_lowest");
(function(){var k=alp.gr,h=alp.i18n.unit;alp.ensureCss(alp.cssBase()+"alp/x.css");k.elproHighestLowest=function(d,b){var c=alp.oCreateMix({highLowClassPrefix:"alp-gr-elpro-"},b),a=alp.opt(c,"elevationSummary"),m=a.all,l=d[g]||(d[g]={});b=alp.filter(alp.map([e,f],function(b){var e=l[b]||(l[b]=alp.cE("div",null,{"class":c.highLowClassPrefix+"hl "+c.highLowClassPrefix+b})),f=alp.opt(a,b),g=c.left,k=c.right,r=c.top,t=c.bottom,w=d.getWidthPixel(),x=d.getHeightPixel();if(m&&f&&alp.and([f.d,f.z,g,k,r,t],
"!=null")&&g<=f.d&&f.d<=k){var y='<div class="'+c.highLowClassPrefix+b+'-value">'+h.meterWithLabel(Math.round(f.z))+"</div>";e.innerHTML=y+"&#9679;";e.style.visibility="hidden";"absolute"!==e.style.position&&(e.style.position="absolute");alp.aC(d.cont,e);y=e.clientWidth;var z=e.clientHeight;g=Math.round(w*(f.d-g)/(k-g)-y/2/2);r=Math.round(x*(f.z-t)/(r-t));t=g+y;x=r+z;k={position:"absolute",left:g+"px",visibility:""};k.bottom=r+"px";alp.style(e,k);return{what:b,z:f.z,node:e,left_pix:g,bottom_pix:r,
right_pix:t,top_pix:x,width_pix:y,height_pix:z}}alp.orphan(e)}),"");return alp.arr2o(b,"what")};var g="_highest_lowest",f="highest",e="lowest"})();"undefined"!==typeof dojo&&dojo.provide("alp.util.math.grid");
(function(){alp.sub("alp.util.math.grid",null,!0).interval=function(k){var h=k.preferred,g=k.min,f=k.max;k=k.factors||[1,2,5,10];alp.forEach([h,g,f].concat(k),".toPrecision.call.a");for(var e=1,d=0,b;(b=e/k[d])*h>f;)d++,d>=k.length&&(e/=k[k.length-1],d=0);e=b;for(d=0;(b=e*k[d])*h<g;)d++,d>=k.length&&(e*=k[k.length-1],d=0);return b*h}})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.elpro_hlines");
(function(){function k(d,b,c,a,e,l,f,g){f=b.pixel;a=alp.loop2arr(c,a+1E-10*e,{step:"+="+e});c=alp.map(a,"{v:v,pieceArr:[]}");alp.forEach(c,function(a){a.y=h(b,a.v)});if(b.full_width)for(var m=d[0],n=d[d.length-2],k=c.length;k--;){d=c[k];e=d.y;var r=f?l-k*g:l+k*g;d.pieceArr.push({begin_i_geom:0,begin_x:m,target_y:r,geom:[m,e,n,e]})}else{var t=-1;m=-Infinity;for(var w={},x=0,y=d.length;x<=y;x+=2){if(x<y){var z=d[x];e=d[x+1];k=Math.floor((f?l-e:e-l)/g);k-=t}else z=null,e=-Infinity,k=-(1+t);if(0<k)for(;k--;){var A=
++t;m=a[A];m.toPrecision.call.a;m=z;r=f?l-A*g:l+A*g;if(1<x){n=d[x-2];var C=d[x-1];e!==C&&(m=n+(z-n)*(r-C)/(e-C))}w[A]={begin_i_geom:x,begin_x:m,target_y:r}}else if(0>k)for(;k++;)A=t--,m=w[A],w[A]=null,e=x-2,n=d[e],null!=z&&(n+=(z-n)*(1-(d[x+1]-m.target_y)/(d[x+1]-d[x-1]))),m.end_i_geom=e,m.end_x=n,n.toPrecision.call.a,e=c[A].y,m.geom=[m.begin_x,e,n,e],c[A].pieceArr.push(m)}}return c}function h(d,b){return d.pixel?d.height_pix*(d.top_v-b)/d.dv_tb:-1+2*(b-d.bottom_v)/d.dv_tb}var g=alp.gr,f=alp.util.math.grid,
e=alp.i18n.unit;alp.ensureCss(alp.cssBase()+"alp/x.css");g.elproHlines=function(d,b,c){c=alp.oCreateMix({color:"#c56f0019",full_width:!0},c);var a=c.pixel,g={cfg:c};var l=e.meterValue(c.dv_tb);l=f.interval({preferred:c.preferred_meter/l*c.height_pix,min:c.min_pix,max:c.max_pix});a=a?l:l/c.height_pix*2;var r=l/c.height_pix*c.dv_tb,n=Math.ceil(c.min_v/r)*r,q=Math.floor(c.max_v/r)*r,p=h(c,n);l=h(c,q);g.arr=k(b,c,n,q,r,p,l,a);b=g.arr;for(a=b.length;a--;)for(l=b[a].pieceArr,r=l.length;r--;)d.line(l[r].geom,
c);return g}})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.elpro_hlines_legend");
(function(){var k=alp.i18n.unit;alp.gr.elproHlinesLegend=function(g,f,e){function d(a){var b=Infinity;a=(a.begin_x+a.end_x)/2;for(var c=v.length;c--;)b=Math.min(b,Math.abs(a-v[c].x));return b}var b=alp.oCreateMix({className:"alp-gr-elpro-hline-legend",dxmin_pix:36,between_peaks_factor:4,nmax:4},e);e=b.className;for(var c=g.cont,a=g[h]||(g[h]=[]),m;m=a.pop();)alp.orphan(m);m=f.cfg;var l=m.pixel;f=alp.arrSorted(alp.filter(f.arr,".pieceArr.length"),"v.v > w.v  ?  +1  :  -1");var r=g.getWidthPixel();
g=g.getHeightPixel();for(var n=l?b.dxmin_pix:2*b.dxmin_pix/r,q=r-n,p=b.between_peaks_factor*n,v=[],u=f.length;u--&&v.length<b.nmax;)for(var t=f[u],w=alp.filter(t.pieceArr,"v.end_x - v.begin_x > "+n),x=alp.arrSortOrder(alp.map(w,d)),y=x.order,z=x.arr,A,C;(C=z.pop(),A=w[y.pop()])&&C>p&&A.end_x-A.begin_x>n&&v.length<b.nmax;)x=(A.begin_x+A.end_x)/2,n<x&&x<q&&v.push({v:t.v,x:x});for(u=f.length;u--;)for(t=f[u],A=t.v,C=k.meterWithLabel(A|0),b=(A-m.bottom_v)/m.dv_tb*g,n=v.length;n--;)x=v[n],A<x.v+1E-10&&
(x=x.x,x=l?x:(1+x)/2*r,q=alp.cE("div",c,{style:"visibility: hidden; position: absolute; bottom: "+b+"px;","class":e},{innerHTML:C}),p=alp.gBCR(q),q.style.left=x-p.width/2+"px",a.push(alp.style(q,{visibility:""})))};var h="_hlines_legend"})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.elpro_hlines_legend_extra");
(function(){var k=alp.i18n.unit;alp.gr.elproHlinesLegendExtra=function(h,g,f){f=alp.oCreateMix({className:"alp-gr-elpro-hline-legend-extra"},f).className;alp.empty(h);"relative"!==h.style.position&&(h.style.position="relative");var e=g.cfg,d=e.pixel;e=e.height_pix;g=g.arr;for(var b=g.length,c=0;c<b;c++){var a=g[c];alp.cE("span",h,{"class":f,style:"position: absolute; top: "+(d?a.y:e*(1-a.y)/2)+"px;"},{innerHTML:k.meterWithLabel(a.v,{round:10})})}}})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.elpro_stage_label");
(function(){var k=alp.gr;alp.ensureCss(alp.cssBase()+"alp/_gmap2_3.css");k.elproStageLabel=function(g,f){var e=alp.oCreateMix({stageLabelClass:alp.cfg.css.cssStageLabel},f),d=e.i18n_stage,b=alp.arr2o(e.arr,alp.f(".info.stageIndex")),c=g[h]||(g[h]={});f=alp.oCreateMix(c,b);var a=g.getWidthPixel()/2,m=g.getHeightPixel()/2,l=a<<1,k=alp.map(e.arr,".info.stageIndex"),n=Math.min.apply(Math,k);Math.max.apply(Math,k);0<n&&Infinity>n&&"x"in b[n]&&(f[n-1]=b[n-1]=1);alp.forIn(f,function(f,h){function n(b){return null!=
b.x?{x:b.pixel?b.x:a*(1+b.x),y:b.pixel?b.y_top:m*(1-b.y_top)}:b instanceof Object&&"info"in b?{x:0,y:0}:null}f=c[h];if(h in b){h|=0;f||(f=c[h]=alp.aC(alp.cE("div",null,{"class":e.stageLabelClass,style:"visibility : hidden; position : absolute;"}),alp.cE("span",null,{"class":e.stageLabelClass+"_text"},{innerHTML:alp.tmpl(d,{i:1+h})})));alp.isDescendant(f,g.cont)||alp.aC(g.cont,f);var p=b[h],q=b[h+1];h=p&&n(p);p=q&&n(q);q=f.clientWidth;alp.style(f,!h&&!p||h&&h.x+q>l||p&&0>p.x-q?{visibility:"hidden"}:
{left:.6*-q+(Math.max(0,h?h.x:0)+Math.min(l,p?p.x:l)>>1)+"px",bottom:"0px",visibility:""})}else f&&alp.orphan(f)});return alp.oCreate(c)};var h="_stage_label"})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.elpro_stage_start");
(function(){var k=alp.gr;alp.ensureCss(alp.cssBase()+"alp/x.css");k.elproStageStart=function(g,f){var e=alp.oCreateMix({stageStartClass:alp.cfg.css.stageStart},f),d=e.stage_start_icon,b=alp.arr2o(e.arr,alp.f(".info.stageIndex")),c=g[h]||(g[h]={});f=alp.oCreateMix(c,b);var a=g.getWidthPixel()/2,m=g.getHeightPixel()/2;alp.forIn(f,function(l,f){l=c[f];if(f in b){if(!l){l="string"===typeof alp.fVal(d,f)?alp.fVal(alp.cfg.marker[d]):d;var h=l.xy,q=l.anchor_xy;l=c[f]=alp.aC(alp.cE("div",null,{"class":e.stageStartClass,
style:"visibility : hidden; position : absolute;  margin-left: -"+q[0]+"px; margin-top : -"+q[1]+"px;"}),alp.cE("img",null,{src:l.url,style:"width : "+h[0]+"px; height : "+h[1]+"px;"}))}alp.isDescendant(l,g.cont)||alp.aC(g.cont,l);f=b[f];h=f.pixel?f.x:a*(1+f.x);alp.style(l,{left:h+"px",top:(f.pixel?f.y_top:m*(1-f.y_top))+"px",visibility:h>>1>a?"hidden":""})}else l&&alp.orphan(l)});return alp.oCreate(c)};var h="_stage_start"})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.elpro_tpoi");
(function(){var k=alp.gr;alp.ensureCss(alp.cssBase()+"alp/x.css");k.elproTpoi=function(l,f){var n=f.tpoiMindistpix||32,q=f.tpoiNmax||16,p=f.tpoiIconName||"iconTransparentUrl",k=f.tpoiIconNameHighlight||"iconUrl",r=f.tpoiIconClass||"alp-gr-elpro-tpoi-icon",t=f.tpoiIconClassHighlight||"alp-gr-elpro-tpoi-icon-highlight",w=f.tpoiIconContClass||"alp-gr-elpro-tpoi-icon-cont",x=f.tpoiTitleClassHighlight||"alp-gr-elpro-tpoi-title-highlight",y=f.tpoiLowestOverlapClass||"alp-gr-elpro-tpoi-lowest-overlap",z=
f.tpoiLowestOverlapClass||"alp-gr-elpro-tpoi-highest-overlap",A=f.tpoiHighClass||"alp-gr-elpro-tpoi-high",C=alp.oGet(f,"highest_lowest.lowest"),E=alp.oGet(f,"highest_lowest.highest"),G=f.left,B=f.right,I=f.top,L=f.bottom,J=alp.filter(f.tpoiMultiProject,G+"<v.multiProject[0].h && v.multiProject[0].h<"+B+'  ||  alp.or(v.multiProject.slice(1),"'+G+"<v.h && v.h<"+B+'")').sort(function(a,b){return b.tourPoiRank-a.tourPoiRank});f=[];var P={},H=l.getWidthPixel(),F=l.getHeightPixel();if(H&&F&&G<B&&L<I){var D=
(B-G)/H,M=1/D,R=1/((I-L)/F);D*=n;I=J.length;for(var S=0;S<I&&f.length<q;S++)for(var T=J[S],Q=T.multiProject,O=Q.length,N=0;N<O&&f.length<q;N++){var X=Q[N];if(!(X.h<G||X.h>B)&&alp.and(f,D+"< Math.abs( v.b.h - "+X.h+" )")){var V=X.h+"#"+T.id;f.push({a:T,b:X,hid:V});P[V]=1}}}N=l[e]||(l[e]={});q=l[d]||(l[d]={});Q=l[b]||(l[b]={});B=l[c]||(l[c]={});O=l[h]||(l[h]={});X=l[g]||(l[g]={});alp.forIn(l[m]||{},"alp.orphan(this[w])",N);I=f.length;J=Array(I);T={};for(S=0;S<I;S++){var K=f[S];V=K.hid;var U=K.a.id,
W=(K.b.h-G)*M,Y=(K.b.v-L)*R,aa=null,Z=!(V in N);(T[U]||(T[U]=[])).push(S);if(Z){var ba=K.a.category;K=K.a.title||"";(U||0).substring.call.a;K=N[V]=alp.aC(alp.cE("div",null,{"class":w,style:"position: absolute;"}),alp.cE("img",null,{"class":r,src:ba[p],alt:K,title:K}),alp.cE("img",null,{"class":t,src:ba[k],alt:K,title:K}),ba=q[V]=alp.cE("div",null,{"class":x},{innerHTML:K}));(O[U]||(O[U]=[])).push(K);(X[U]||(X[U]=[])).push(ba)}else K=N[V],ba=q[V];ba.style.visibility="hidden !important";var da=!1;U=
!1;C&&C.left_pix-n<=W&&W<=C.right_pix+n?(Y=C.top_pix,da=!0):E&&E.left_pix-n<=W&&W<=E.right_pix+n&&(Y=null,aa=F-E.bottom_pix+n/2,U=!0);var ca=!alp.hasClass(K,y)!==!da||!alp.hasClass(K,z)!==!U;alp.setClass(K,[[y,da],[z,U]]);da=(J[S]=Math.round(W))+"px";var fa=null!=Y?Math.round(Y)+"px":"",ka=null!=aa?Math.round(aa)+"px":"";K.style.left!==da&&(K.style.left=da);K.style.bottom!==fa&&(K.style.bottom=fa,ca=!0);K.style.top!==ka&&(K.style.top=ka,ca=!0);alp.aC(l.cont,K);if(Z){Z=ba.clientWidth;da=ba.clientHeight;
16<da&&Z<2*da&&(ba.style.width=Math.round(2*Z)+"px",Z=ba.clientWidth);da=-Math.round(Z/2);var ha;0>(ha=W+da)?da-=ha:0<(ha=W+da+Z-H)&&(da-=ha);ba.style.marginLeft=da+"px";B[V]=Z}else Z=B[V];W=Math.round(null!=aa?aa:F-Y);Y=!ca&&V in Q?Q[V]:Q[V]=ba.offsetTop;alp.setClass(K,A,U||0>W+Y)}for(S=0;S<I;S++){K=f[S];p=J[S]+n;k=p+B[K.hid]-n;t=T[K.a.id];r=!1;for(N=t.length;N--;)if(x=t[N],x!==S&&(w=J[x],x=w+B[f[x].hid],w<=p&&p<=x||w<=k&&k<=x)){r=!0;break}ba=q[V];alp.style(ba,{visibility:r?"hidden !important":"",
display:r?"none":"block"})}l[a]=f;l[m]=P;l=alp.oCopy(f);l.mindisth=D;l.mindistpix=n;return l};k.elproTpoi_setHighlightId=function(a,b,c){c||(c="alp-gr-elpro-tpoi-highlight");var d=a[f];d!==b&&((d=d&&alp.oGet(a,[h,d]))&&alp.setClass(d,c,!1),(d=b&&alp.oGet(a,[h,b]))&&alp.setClass(d,c,!0),a[f]=b)};var h="_elproTpoi_id_2_noli",g="_elproTpoi_id_2_noli_title",f="_elproTpoi_curr_h_id",e="_elproTpoi_hid_2_node",d="_elproTpoi_hid_2_node_title",b="_elproTpoi_hid_2_node_title_offsetTop",c="_elproTpoi_hid_2_node_title_w",
a="_elproTpoi_visarr",m="_elproTpoi_hid_visset"})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.elpro_vlines");
(function(){var k=alp.gr,h=alp.util.math.grid,g=alp.i18n.unit;k.elproVlines=function(f,e,d){var b=d.pixel,c=g.kmValue(d.dh_rl),a=h.interval({preferred:d.preferred_meter/1E3/c*d.width_pix,min:d.min_pix,max:d.max_pix});c=a/d.width_pix*d.dh_rl;var m=c*Math.ceil(d.left_h/c),l=(m-d.left_h)/d.dh_rl;f=alp.gr.elproVlinesDraw(f,e,alp.oCreateMix(d,{pixel:b,x_offset:b?l*d.width_pix:-1+2*l,x_interval:b?a:a/d.width_pix*2}));f.offset_h=m;f.interval_h=c;e=f.arr;for(b=e.length;b--;)c=e[b],c.h=d.left_h+d.dh_rl*(c.x+
1)/2,c.v=d.bottom_v+d.dv_tb*(c.y+1)/2;return f};k.elproVlinesDraw=function(f,e,d){d=alp.oCreateMix({pixel:!1,x_offset:0,x_interval:.1,color:"#dddddd"},d);var b=[],c={cfg:d,arr:b},a=e.length>>1,g=d.pixel,l=d.x_offset,h=d.x_interval;d=d.color;for(var n=f.getHeightPixel(),q=f.getWidthPixel(),p=g?f.getHeightPixel()-1:-1,k=e[0],u=e[e.length-2];l<u;l+=h)if(!(l<k)){for(var t=~~alp.util.dichotomy(l,0,a-1,"this[ v << 1 ]",{that:e});t&&l<e[t<<1];)t--;var w=e[t<<1];w=(l-w)/(e[t+1<<1]-w);t=(1-w)*e[1+(t<<1)]+
w*e[3+(t<<1)];f.line([l,p,l,t],{color:d,pixel:g});w={};w[g?"xpix":"x"]=l;w[g?"ypix":"y"]=t;g?(w.x=-1+2*l/q,w.y=1-2*t/n):(w.xpix=q*(1+l)/2,w.ypix=n*(1-t)/2);b.push(w)}return c}})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.elpro_vlines_legend");
(function(){var k=alp.i18n.unit;alp.gr.elproVlinesLegend=function(g,f,e){e=alp.oCreateMix({className:"alp-gr-elpro-vline-legend"},e).className;for(var d=g.cont,b=g[h]||(g[h]=[]),c;c=b.pop();)alp.orphan(c);c=g.getWidthPixel();g.getHeightPixel();g=[].concat(f.arr).sort(function(a,b){return a.xpix-b.xpix});f=100<=~~Math.round(f.interval_h);for(var a=g.length,m=!1,l=0;l<a;l++){var r=g[l],n=k[f?"kmWithLabel":"meterWithLabel"](Math.round(r.h)|0);r=Math.round(r.xpix);n=alp.cE("div",d,{style:"visibility: hidden; position: absolute; left: "+
r+"px; bottom: 0px","class":e},{innerHTML:n});(m=m||r+150>c&&r+n.clientWidth>c)?alp.orphan(n):b.push(alp.style(n,{visibility:""}))}};var h="_vlines_legend"})();"undefined"!==typeof dojo&&dojo.provide("alp.gr.elpro");
(function(){function k(d,b,c){null==c||c.substring.call.a;c&&(b=alp.filter(b,'.key==="'+c+'"'));c=b.length;for(var a=Array(c),e=d.length-1,f=0;f<c;f++){var g=b[f],h=g.from,q=g.to,p=g.value;if(0<f&&g&&g.from<b[f-1].to)throw Error("elpro: overlapping segments are not permitted!");var k=Math.max(0,Math.min(e,h|0));g=Math.max(0,Math.min(e,q|0));var u=d[k],t=d[g];if(u.length&&t.length){var w=u[0][0];h=w+(h-k)*(u[u.length-1][0]-w);k=t[0][0];q=k+(q-g)*(t[t.length-1][0]-k);if(0<f&&a[f-1]&&a[f-1].h_to>h)throw Error("elpro: obtained overlapping h segments! I must be buggy.");
a[f]={h_from:h,h_to:q,value:p}}}a=alp.filter(a,"");a.sort(function(a,b){return a.h_from>b.h_from?1:-1});return a}function h(d,b,c,a,f,l,g,h,k,p,v,u,t){function m(d){var m=d.start;if(b<m+1E-7&&m<c+1E-7)return m=~~e.dichotomy(m,0,f.length-1,"this[v|0][0]",{that:f}),-1<m&&{x:l+(f[m][0]-g)*h,y_bottom:k+(u-p)*v,y_top:k+(f[m][1]-p)*v,pixel:a,info:d}}b.toFixed.call.a;c.toFixed.call.a;if(d)return alp.filter(alp.map(d,m),"")}var g=alp.GR.prototype,f=alp.arr2o(alp.filter(alp.cfg.linref().attributes.availableKeys,
'.id==="waytype"')[0].values,"id"),e=alp.util;g.elpro=function(d,b){if(0!==d.length){var c={};b=alp.oCreateMix({color:f[0],thick:!1,background:{},dv_min:110,vlines_interval_pix_min:100,vlines_interval_pix_max:300,vlines_interval_meter_preferred:1E3,vlines:{},vlines_nolegend:!1,hlines_interval_pix_min:16,hlines_interval_pix_max:48,hlines_interval_meter_preferred:100,hlines:{},hlines_nolegend:!1,hlines_extra_legend:null,hlines_full_width:!0,left_meters:-Infinity,right_meters:Infinity,buffer_top:.1,
buffer_bottom:b&&b.stageInfoArr?.33:.165,attributes:[],attributes_key:"waytype",attributes_cfg:f,epsilon:1E-10,elevationSummary:null,stageInfoArr:null,stage_start_icon:null,c2_max_npoints:1666,tpoiMultiProject:null,tpoiHighlightId:null},b);var a=b.epsilon,g=this.getWidthPixel(),l=this.getHeightPixel();if(0<g&&0<l){d="number"!==typeof d[0][0]?d:[d];var r=alp.arrChain(d),n=b.c2_max_npoints;if(this._c2&&null!=n&&n<r.length){for(var q=r.length-1,p=Array(n),v=q/(n-1),u=0;u<n;u++)p[u]=r[Math.max(0,Math.min(q,
Math.round(u*v)))];r=p}q=r.length;var t=k(d,b.attributes,b.attributes_key);if(r.length){v=Math.max(r[0][0],Math.min(r[q-1][0],b.left_meters));var w=Math.max(r[0][0],Math.min(r[q-1][0],b.right_meters)),x=-Infinity===v||1===q?0:Math.max(0,Math.round(-1+e.dichotomy(v,0,q-1,"this[ Math.round( v ) ][ 0 ]",{that:r})));d=r[x][0];var y=Infinity===w||1===q?q-1:Math.min(q-1,Math.round(1+e.dichotomy(w,0,q-1,"this[ Math.round( v ) ][ 0 ]",{that:r})));p=r[y];n=p[0];p=p[1];var z=1+y-x;w-=v;var A=p,C=p;if(1<z&&
.1<w){for(u=0;u<q;u++)p=r[u][1],A=Math.min(A,p),C=Math.max(C,p);A=Math.min(A,C-b.dv_min/4);C=Math.max(C,A+3*b.dv_min/4);p=C-A;q=C+b.buffer_top*p;p=0>A?A:A-b.buffer_bottom*p;var E=q-p,G=this.bestPerfWithPixel,B=G?0:-1,I=G?0:-1,L=G?q:p,J=((G?g-1:1)-B)/w||1,P=(G?-1:1)*((G?l-1:1)-I)/(q-p)||1,H=Array(z),F=x;u=0;z<<=1;for(var D;u<z;D=r[F++],H[u++]=B+(D[0]-v)*J,H[u++]=I+(D[1]-L)*P);D=r;u=b.attributes_cfg;a.toPrecision.call.a;null!=x||(x=0);null!=y||(y=D.length-1);x.toPrecision.call.a;y.toPrecision.call.a;
if(z=t.length){F=[];for(var M=D[x][0],R=D[y][0],S=x,T=0,Q=t[T],O=Math.max(M,Math.min(R,Q.h_from)),N=Math.max(M,Math.min(R,Q.h_to)),X=(u[Q.value]||u._default).color,V=!1;S<=y&&T<z;)if(N-O<a){if(V)throw Error("alp.gr.elpro: prepare_colorsteps: I am buggy.");T++;if(T>=z)break;Q=t[T];O=Math.max(M,Math.min(R,Q.h_from));N=Math.max(M,Math.min(R,Q.h_to));X=(u[Q.value]||u._default).color;V=!1}else{if(0<T&&Q&&Math.max(M,Math.min(R,t[T-1].h_to))>a+O)throw Error("elpro: buggy input data `seg_attributes_h`! Overlaps are not permitted.");
var K=D[S][0],U=!1;if(!V){if(K>O-a)if(U=V=!0,K<O+a)var W=S;else{var Y=D[S-1][0];K=K>a+Y?(O-Y)/(K-Y):0;W=S-1+K}}else if(K>N-a||S===y){K<N+a?Q=S:(Y=D[S-1][0],K=K>a+Y?(N-Y)/(K-Y):0,Q=S-1+K);if((O=F[F.length-1])&&O.to>a+W)throw Error("elpro: obtained buggy (= overlapping) colorsteps!");F.push({from:W-x,to:Q-x,color:X});V=!1;U=!0;T++;if(T>=z)break;Q=t[T];O=Q.h_from;N=Q.h_to;X=(u[Q.value]||u._default).color}U||S++}W=F}else W=void 0;a=h(b.stageInfoArr,d,n,G,r,B,v,J,I,L,P,p,q);b.background&&alp.gr.elproBackground(this,
H,alp.oCreateMix(b.background,{pixel:G,stageVlineArr:a}));b.vlines&&(g=alp.oCreateMix(b.vlines,{pixel:G,preferred_meter:b.vlines_interval_meter_preferred,min_pix:b.vlines_interval_pix_min,max_pix:b.vlines_interval_pix_max,width_pix:g,left_h:d,bottom_v:p,dh_rl:w,dv_tb:E}),c.vlines=alp.gr.elproVlines(this,H,g),b.vlines_nolegend||alp.gr.elproVlinesLegend(this,c.vlines));b.hlines&&(g=alp.oCreateMix(b.hlines,{pixel:G,preferred_meter:b.hlines_interval_meter_preferred,min_pix:b.hlines_interval_pix_min,max_pix:b.hlines_interval_pix_max,
height_pix:l,full_width:b.hlines_full_width,max_v:C,min_v:A,left_h:d,bottom_v:p,top_v:q,dh_rl:w,dv_tb:E}),c.hlines=alp.gr.elproHlines(this,H,g),b.hlines_nolegend||alp.gr.elproHlinesLegend(this,c.hlines),b.hlines_extra_legend&&alp.gr.elproHlinesLegendExtra(b.hlines_extra_legend,c.hlines));this.line(H,{color:b.color,thick:b.thick,pixel:G,colorsteps:W});c.view={left_h:d,right_h:n,top_v:q,bottom_v:p};(l=b.stage_start_icon)&&a&&(l=alp.gr.elproStageStart(this,{arr:a,stage_start_icon:l}))&&(c.stage_start=
l);if((l=b.i18n_stage)&&a){g=a;if(!g.length)for(u=b.stageInfoArr.length;u--;)if(W=b.stageInfoArr[u],d>W.start){g=[{info:W}];break}if(l=alp.gr.elproStageLabel(this,{arr:g,i18n_stage:l}))c.stage_label=l}b.elevationSummary&&(l=alp.gr.elproHighestLowest(this,{left:d,right:n,top:q,bottom:p,elevationSummary:b.elevationSummary}))&&(c.highest_lowest=l);if(b.tpoiMultiProject){if(l=alp.gr.elproTpoi(this,{left:d,right:n,top:q,bottom:p,highest_lowest:c.highest_lowest,tpoiMultiProject:b.tpoiMultiProject}))c.tpoi=
l;alp.gr.elproTpoi_setHighlightId(this,b.tpoiHighlightId)}return c}}}}}})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.scroll_simple");
(function(){alp.sub("alp.dom",null,!0).scrollSimple=function(k,h){var g=k===alp.body()||k===document.documentElement||k===window,f="number"===typeof h.dx,e=h.max_slst||null;if(f){var d=h.dx;var b=h.dy;b.toPrecision.call.a}else{var c=h.left;var a=h.top;c.toPrecision.call.a;a.toPrecision.call.a}if(g){var m=alp.gWindowScroll();h=m.left;m=m.top}else h=k.scrollLeft,m=k.scrollTop;f?(f=h+d,a=m+b):f=c;!g&&e&&(b=e.max_scrollLeft,e=e.max_scrollTop,isFinite(b)&&(f=Math.max(0,Math.min(b,f))),isFinite(e)&&(a=
Math.max(0,Math.min(e,a))));if(e=h!==f||m!==a)g?window.scroll(f,a):(k.scrollLeft=f,k.scrollTop=a);return e}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.dnd.i_dummy");
(function(){alp.x||(alp.x={});alp.declare("alp.x.Interface_DND_Dummy",null,function(k,h){this.dnd=k;alp.mixCheck(this,h);this._setup()},{dnd:null,create:function(k,h){return this._standard_create(k,h)},update:!0,updateEvt:alp.memM("updateEvt",'alp.event("i_dummy:updateEvt",{then:1})'),css_class:"oax_dnd_dummy",node:null,remove:function(){if(this.node){var k=this.node.parentNode;k&&k.removeChild(this.node);this.node=null}},_standard_create:function(k,h){k=this.dnd;h=alp.gBCR(k.node);this.node=alp.cE("div",
null,{style:"width: "+h.width+"px;height : "+h.height+"px;","class":this.css_class});alp.place(this.node,k.node,"after")},_setup:alp.nowF(function(){var k=this,h=k.dnd;h.beforeStartDragEvt().then(function(){k.remove();k.create(h.startX,h.startY)});k.update&&h.movedToEvt().then(function(){k.updateEvt().triggerSoon(h.x,h.y,h.x-h.startX,h.y-h.startY,h.startX,h.startY)});h.droppedAtEvt().then(function(){k.remove()})})})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.dnd");alp.x||(alp.x={});
(function(){function k(b){var a=b.container;return b._scroll_cont=a?"string"===typeof a?h(b.node,a):(a.childNodes.a,a):alp.body()}function h(b,a){return b?(b.childNodes.a,a)?(a.substring.call.a,alp.hasClass(b,a))?b:h(b.parentNode,a):b.offsetParent:alp.body()}var g=alp.dom,f=alp.mapany(),e=!1;alp.x.dnd=function(b,a){(b.substring||b.childNodes).a;var c;if(c="string"===typeof b?alp.gEBI(b)||alp.gEBCN(b)[0]:b)return b=a&&alp.filterIn(a,'w!="force_new"'),e=!0,a=a&&a.force_new?new alp.x._DND(c,b):f.get(c)||
f.setNow(c,new alp.x._DND(c,b)),e=!1,a;console.error("alp.x.dnd could not find DOM node for elt:",b)};var d=new alp.State({init_value:null});alp.x.dnd.current=d;alp.x.dnd.XY_CONSTRAIN_V=function(b,a,d,e,f){return{x:e,y:b.y}};alp.x.dnd.XY_CONSTRAIN_H=function(b,a,d,e,f){return{x:b.x,y:f}};alp.declare("alp.x._DND",null,alp.nowF(function(c,a){function f(a){var b=k(h),c=b&&alp.gBCR(b);q=b&&c&&alp.filterIn({max_scrollLeft:b.scrollWidth-c.width,max_scrollTop:b.scrollHeight-c.height},">0");alp.orIn(q)||
(q=null);return a}function l(a){if("function"===typeof requestAnimationFrame&&d.is(h)){var b=h._scroll_cont,c=h.scroll.get();if(b&&c){var e=null!=a&&a-n;if(isFinite(e)){e=Math.max(0,Math.min(1,e/15));var f=Math.round(e*c.dx);c=Math.round(e*c.dy);0<=e&&1>=e||null.bug;isFinite(f)||null.bug;isFinite(c)||null.bug;g.scrollSimple(b,{dx:f,dy:c,max_slst:q});b=h._last_setpos_x;c=h._last_setpos_y;null!=b&&null!=c&&h.setPosition(b,c)}n=a;requestAnimationFrame(l)}}}var h=this;if(!e)throw Error("Direct construction forbidden. Use alp.x.dnd()");
if(h.node="string"===typeof c?alp.gEBI(c)||alp.gEBCN(c)[0]:c){h.dndid=b=1+~~b;h.clickable=h.node;alp.mixCheck(h,a);c=h.clickable;null!=c&&("string"===typeof c?(a=alp.gEBI(c),h.clickable=a?[a]:alp.gEBCN(c,h.node)):"parentNode"in c&&(h.clickable=[c]));h._eh=new alp.Eh;h.active=new alp.BoolState({init_value:!0});h._eh.push(h.active.change_v_cb(!1,"release",h,!0));h.scroll=new alp.ObjectState;h._eh.push(h.scroll.change_cb(alp.bindF(l,null,null)));h._eh.push(d.change_cb(function(a){a!==h&&h.release()}));
alp.forEach(h.clickable,function(a){h._h_selectstart=alp.aEL(a,"selectstart dragstart",alp.f(".preventDefault()"));h.mouse&&(h._h_onmousedown=alp.aEL(a,"mousedown",alp.chainF(f,alp.bindF("onmousedown",h)),!0),h._h_onmouseup=alp.aEL(a,"mouseup",alp.bindF("onmouseup",h),!0));h.touch&&(h._h_ontouchstart=alp.aEL(a,"touchstart",alp.chainF(f,alp.bindF("ontouchstart",h)),!0))});h._drag_eh=new alp.Eh;h.dummy_cfg&&(h.dummy=new alp.x.Interface_DND_Dummy(h,h.dummy_cfg));var n,q}else console.error("alp.x._DND could not find a node for elt:",
c)}),{node:null,mouse:!0,touch:!0,start_drag_after_ms:0,isParentRelative:!1,css_class:"oax_dnd_dragged",xy_constrain:null,clickable:null,leave_it:!1,container:null,dummy_cfg:!0,dummy:null,dragEvt:alp.memM("dragEvt",'alp.event("dnd:dragEvt",{then:1})'),dropEvt:alp.memM("dropEvt",'alp.event("dnd:dropEvt",{then:1})'),beforeStartDragEvt:alp.memM("beforeStartDragEvt",'alp.event("dnd:beforeStartDragEvt",{then:1})'),startDragEvt:alp.memM("startDragEvt",'alp.event("dnd:startDragEvt",{then:1})'),movedToEvt:alp.memM("movedToEvt",
'alp.event("dnd:movedToEvt",{then:1})'),droppedAtEvt:alp.memM("droppedAtEvt",'alp.event("dnd:droppedAtEvt",{then:1})'),active:null,initialMouseX:null,initialMouseY:null,startX:null,startY:null,x:null,y:null,initialStyleAttr:null,initialStyle:null,getScrollCont:function(){return k(this)},is:function(){return d.is(this)},destroy:function(){var b=this;b._eh.clear();b._drag_eh.clear();alp.forEach(this.clickable,function(a){(a=b.mouse&&b._h_selectstart)&&alp.rEL(a);(a=b.mouse&&b._h_onmousedown)&&alp.rEL(a);
(a=b.mouse&&b._h_onmouseup)&&alp.rEL(a);(a=b.touch&&b._h_ontouchstart)&&alp.rEL(a)});f.del(this.node);alp.forIn(b,function(a,c){b[c]=null})},onmousedown:function(b){function a(){d.initialMouseX=b.clientX;d.initialMouseY=b.clientY;var a=alp.gBCR(d.node);d.initialMouseX_delta=d.initialMouseX-a.left;d.initialMouseY_delta=d.initialMouseY-a.top;delete d.initialTouchX;delete d.initialTouchY;delete d.initialTouchID;d.start_drag()}function c(){null!=e&&e===d._down_date_ms&&a()}var d=this;if(d.mouse&&d.active.get()){var e=
d._down_date_ms=+new Date;0<d.start_drag_after_ms?setTimeout(c,d.start_drag_after_ms):(b=b||window.event,alp.stopEvent(b),a())}},onmouseup:function(b){delete this._down_date_ms},ontouchstart:function(b){function a(){null!=e&&e===c._down_date_ms&&c.start_drag(!0)}var c=this;if(c.touch&&c.active.get()){b||(b=window.event);var d=b.touches;if(1===d.length){d=d[0];delete c.initialMouseX;delete c.initialMouseY;c.initialTouchX=d.pageX;c.initialTouchY=d.pageY;c.initialTouchID=d.identifier;var e=c._down_date_ms=
+new Date;0<c.start_drag_after_ms?setTimeout(a,c.start_drag_after_ms):(alp.stopEvent(b),c.start_drag(!0))}}},start_drag:alp.nowF(function(b){d.is(this)||(this.initialStyleAttr=this.node.getAttribute("style")||null,this.initialStyle={position:this.node.style.position,left:this.node.style.left,top:this.node.style.top,"float":this.node.style["float"],width:this.node.style.width,height:this.node.style.height});var a=alp.gBCR(this.node);alp.now("triggerSoon",this.beforeStartDragEvt());d.set(this);this.startX=
this.node.offsetLeft;this.startY=this.node.offsetTop;this.start_parent=this.node.parentNode;this.start_parent_pos=this.isParentRelative?{left:0,top:0}:alp.gBCR(this.start_parent);this.node.setAttribute("style",(this.initialStyleAttr||"")+"; position: absolute; float: none;");this.node.style.position="absolute";this.node.style.width=a.width+"px";this.node.style.height=a.height+"px";this.setPosition_rel(0,0);alp.setClass(this.node,this.css_class,!0);a=this._drag_eh.clear();b?this.touch&&a.push(alp.aEL(alp.body(),
"touchmove",alp.bindF("drag_touch",this),!0)).push(alp.aEL(alp.body(),"touchend",alp.bindF("release_touch",this),!0)).push(alp.aEL(alp.body(),"touchcancel",alp.bindF("release_touch",this),!0)).push(alp.aEL(alp.body(),"touchleave",alp.bindF("release_touch",this),!0)):this.mouse&&a.push(alp.aEL(document,"mousemove",alp.bindF("drag_mouse",this))).push(alp.aEL(document,"mouseup",alp.bindF("release",this,!1),!0));this.startDragEvt().triggerSoon()}),drag_mouse:function(b){function a(a){return(0>a?-1:0<
a?1:0)*Math.max(5,Math.min(10,g.height/10))}b=b||window.event;alp.stopEvent(b);this.setPosition_rel(b.clientX-this.initialMouseX,b.clientY-this.initialMouseY);var c=k(this);if(c){b=alp.gBCR(c);var d=c===alp.body(),e=d&&alp.gViewportSize();b=alp.gBCR(c);var f=e?{top:0,bottom:e.height,left:0,right:e.width}:b,g=alp.gBCR(this.node);c=g.top-f.top;e=Math.min(Math.min(g.top+this.initialMouseY_delta+100,g.bottom),d?b.bottom-10:Infinity)-f.bottom;b=Math.min(Math.min(g.left+this.initialMouseX_delta+100,g.right),
d?b.right-10:Infinity)-f.right;b=0>=g.left-f.left?-1:0<=b?1:0;d=0>=c?a(c):0<=e?a(e):0;b={x:b,y:d};b=this.xy_constrain?this.xy_constrain(b,0,0,0,0):b;b={dx:b.x,dy:b.y};this.scroll.setNow(b.dx||b.dy?b:null)}return!1},drag_touch:function(b){b=b||window.event;alp.stopEvent(b);b=b.touches;1!==b.length||b[0].identifier!==this.initialTouchID?this.release_touch():(b=b[0],this.setPosition_rel(b.pageX-this.initialTouchX,b.pageY-this.initialTouchY));return!1},setPosition_rel:function(b,a){this.setPosition(this.startX+
b,this.startY+a)},setPosition:alp.nowF(function(b,a){this._last_setpos_x=b;this._last_setpos_y=a;var c=this.isParentRelative?{left:0,top:0}:alp.gBCR(this.start_parent);a={x:b-(c.left-this.start_parent_pos.left),y:a-(c.top-this.start_parent_pos.top)};this.xy_constrain&&(a=this.xy_constrain(a,a.x-this.startX,a.y-this.startY,this.startX,this.startY));this.x=a.x;this.y=a.y;c=this.isParentRelative&&alp.gBCR(this.start_parent);b="propX"in a?a.propX:c&&a.x/c.width;c="propY"in a?a.propY:c&&a.y/c.height;var d=
alp.isFiniteNumber(b),e=alp.isFiniteNumber(c),f=alp.isFiniteNumber(a.x),g=alp.isFiniteNumber(a.y),h=this.node.style;d&&(this.propX=b);e&&(this.propY=c);d?h.left=100*b+"%":f&&(h.left=a.x+"px");e?h.top=100*c+"%":g&&(h.top=a.y+"px");this._moved_to(a.x,a.y,this.startX,this.startY);a={x:a.x,y:a.y,startX:this.startX,startY:this.startY,dx:a.x-this.startX,dy:a.y-this.startY};d&&(a.propX=b);e&&(a.propY=c);this.dragEvt().triggerSoon(a)}),release:alp.nowF(function(b,a){var c=this;c._drag_eh.clear();alp.setClass(c.node,
c.css_class,!1);if(d.is(c)&&(c.leave_it||(c.initialStyleAttr?c.node.setAttribute("style",c.initialStyleAttr):null===c.initialStyleAttr&&c.node.removeAttribute("style"),null!=c.initialStyleAttr&&c.initialStyle&&alp.forIn(c.initialStyle,function(a,b){c.node.style[b]=a})),d.set(null),!b&&null!=c.startX&&null!=c.startY&&(null!=c.x||null!=c.y||null!=c.propX||null!=c.propY))){c._dropped_at(c.x,c.y,c.startX,c.startY);b=alp.opt(c,"startX startY x y propX propY".split(" "),!0);var e=b.dx=b.x-b.startX,f=b.dy=
b.y-b.startY;0<(b.d2=e*e+f*f)&&alp.stopEvent(a);c.dropEvt().triggerSoon(b)}}),release_touch:function(){this.release()},moved_to:alp.nowF(function(b,a,d,e){this.movedToEvt().triggerSoon(b,a,d,e)}),dropped_at:alp.nowF(function(b,a,d,e){this.droppedAtEvt().triggerSoon(b,a,d,e)}),_moved_to:alp.asyncF(0,"moved_to"),_dropped_at:alp.asyncF(0,"dropped_at")});var b})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.bbox_extend");
(function(){alp.sub("alp.maps",null,!0).bbox_extend=function(k,h){var g,f=k.slice&&4===k.length&&"number"===typeof k[0]?k:(g=k.getSouthWest(),[g.lng(),g.lat()]).concat((g=k.getNorthEast(),[g.lng(),g.lat()]));g=f[0];var e=f[1],d=f[2],b=f[3];k=h?k:f.slice();"0"in k||(alp.mix(k,f),"0"in k||null.bug);"west"in k||(k.west=g,k.south=e,k.east=d,k.north=b);"sw"in k||(k.sw={lat:e,lng:g},k.ne={lat:b,lng:d});return k}})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.qt7bit.const");
(function(){var k=alp.sub("alp.maps.qt7bit",null,!0);k.NBITS=22;k.QT7BIT_BYTELENGTH=Math.ceil(2*k.NBITS/7);k.ID="id";k.CATID="catid";k.GEOM="geom";k.NCHUNKS="____nChunks____";k.NQTDATAPOINT="____nQTDataPoint____";k.FIRST="____first____";k.LAST="____last____";k.DATABBOX="____dataBbox____";k.METADATA_ARR=[k.NCHUNKS,k.NQTDATAPOINT,k.FIRST,k.LAST,k.DATABBOX];k.METADATA_SET=alp.arr2oSimple(k.METADATA_ARR)})();"undefined"!==typeof dojo&&dojo.provide("alp.util.math.arr10");
(function(){function k(f,e){var d=e;for(e=0;d||e<f.length;e++){d=(f[e]||0)+d;var b=d%10;b=0>b?b+10:b;f[e]=b;d=(d-b)/10>>0}}function h(f,e){e=Math.abs(e);for(var d=0,b=0;d||b<f.length;b++){d=(f[b]||0)*e+d;var c=d%10;f[b]=0>c?c+10:c;d=d/10>>0}}var g=alp.sub("alp.util.math.arr10",null,!0);g.from_str10=function(f){f=f.split("").reverse();for(var e=f.length;e--;)f[e]>>=0;return f};g.sub1=function(f){k(f,-1)};g.add=k;g.div2=function(f){h(f,5);f.shift()};g.mul=h})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.qt7bit._core");
(function(){function k(a){for(var b=a.length,c=Array(b),d=b;d--;)c[d]=a[b-1-d];return String.fromCharCode.apply(String,c)}function h(a){for(var b=a.length,c=Array(b),d=b;d--;)c[d]=a.charCodeAt(b-1-d);return c}function g(a){a||(a=y);if(!(a in g)){for(var b=Array(Math.ceil(2*a/7)),c=b.length;c--;)b[c]=0;c=k(b);var d=p(b,a);g[a]={lat:d.lat,lng:d.lng,qt_arr:b,qt_str:c}}return g[a]}function f(a){a||(a=y);if(!(a in f)){var b=n(g(a).qt_arr,a),c=k(b),d=p(b,a);f[a]={lat:d.lat,lng:d.lng,qt_arr:b,qt_str:c}}return f[a]}
function e(a,b){b||(b=y);a=u.project_SM(a);var c=1<<b,d=c-1;return l({x:Math.max(0,Math.min(d,(w+a.x)/x*c)),y:Math.max(0,Math.min(d,(w-a.y)/x*c))},b)}function d(a){if("string"===typeof a)return d[a]||(d[a]=d(h(a)));var b=a[9]&1,c=b?"-":"";if(b){var e=a[0]^127;var f=a[1]^127;var l=a[2]^127;var g=a[3]^127;var m=a[4]^127;var n=a[5]^127;var p=a[6]^127;var k=a[7]^127;var q=a[8]^127}else e=a[0],f=a[1],l=a[2],g=a[3],m=a[4],n=a[5],p=a[6],k=a[7],q=a[8];a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];f=(e|0)+(f<<
7)+(l<<14)+(g<<21)+((m&3)<<28)+1073741824*(((k&7)<<19)+(p<<12)+(n<<5)+(m>>2))+"";e=f.length;for(l=0;e--;)a[l++]=f.charCodeAt(e)-48;f=(q<<4)+(k>>3);if(b||0!==f)for(k=f+f,q=k+f,e=k+k,f=e+f,l=e+k,g=e+q,m=e+f,a[0]+=l,a[1]+=m,a[2]+=e,a[4]+=g,a[5]+=q,a[6]+=g,a[7]+=k,a[8]+=l,a[9]+=m,a[10]+=m,a[11]+=f,a[12]+=q,a[14]+=f,a[15]+=e,b&&a[0]++,b=0,k=a.length,e=0;e<k;e++)q=a[e]+b,f=q%10,f===q?(b&&(a[e]=q),b=0):(b=(q-f)/10,a[e]=f);for(;1<a.length&&0===a[a.length-1];)a.pop();a.reverse();return c+a.join("")}function b(a){var e=
b[a]||(b[a]=k(c(a)));e in d||(d[e]=a);return e}function c(a){var b=a;if(b in c)return c[b];a=a.replace(/(^\s+|\s+$)/g,"");var d="-"===a.charAt(0);/^[\+\-]/.test(a)&&(a=a.substring(1));a=t.from_str10(a);d&&t.sub1(a);for(var e=[].concat(z),f=0,l=0,g=1,m=0;63>m;m++){d^a[0]%2&&(e[f]|=g);6===l?(f++,l=0,g=1):(l++,g<<=1);for(var h=0,n=0;h||n<a.length;n++){h=5*(a[n]||0)+h;var p=h%10;a[n]=0>p?p+10:p;h=h/10>>0}a.shift()}d&&(e[9]|=1);Object.freeze&&Object.freeze(e);return c[b]=e}function a(b,c){var d=null==
c&&"string"===typeof b;if(d&&b in a)return a[b];c||(c=y);var e=m(b,c),l=A[c];l||(l={nw:g(c),se:f(c)},l.lng_min=l.nw.lng,l.lng_span=l.se.lng-l.nw.lng,l.x_max=m(l.se.qt_arr,c)[0],l.prop_den=1<<y-1,l.half_pi=Math.PI/2,l.ratio=180/Math.PI,alp.forEach(alp.oKeys(l),'(this[v]  &&  "object" === typeof this[v])  ||  (isNaN( this[v] )  ? "bad"  :  this[v]).toPrecision.call.a',l),A[c]=l);c={lat:(l.half_pi-2*Math.atan(Math.exp((-1+e[1]/l.prop_den)*Math.PI)))*l.ratio,lng:l.lng_min+e[0]/l.x_max*l.lng_span};d&&
(a[b]=c);return c}function m(a,b){b||(b=y);if("string"===typeof a){var c=b+".str:"+a;if(c in C)return C[c];a=h(a)}a.splice.call.a;a[0].toPrecision.call.a;b.toPrecision.call.a;if(E){var d=b+".arr:["+a.join(",")+"]";if(d in C)return C[d]}for(var e=0,f=0,l=0,g=a[l],m=0,n=1;b--;)g&1&&(f|=n),g>>=1,m++,7===m&&(l++,g=a[l],m=0),g&1&&(e|=n),g>>=1,m++,7===m&&(l++,g=a[l],m=0),n<<=1;b=[e,f];c&&(C[c]=b);d&&(C[d]=b);return b}function l(a,b){b||(b=y);var c=a.x;a=a.y;for(var d=[0],e=0,f=0,l=1;b--;)a&1&&(d[e]|=l),
a>>=1,f++,7===f?(d.push(0),e++,f=0,l=1):l<<=1,c&1&&(d[e]|=l),c>>=1,f++,7===f?(d.push(0),e++,f=0,l=1):l<<=1;return d}function r(a,b){return"string"===typeof a?k(r(h(a),b)):q(a,1,b)}function n(a,b){return"string"===typeof a?k(n(h(a),b)):q(a,-1,b)}function q(a,b,c){c=c||y;if("string"===typeof a)return k(q(h(a),b,c));a=[].concat(a);for(var d=a.length,e=0;e<d;e++){for(var f=Math.min(7,2*c-7*e),l=1<<f,g=a[e],m=(g+b)%l;0>m;)m+=l;b-=m-g;a[e]=m;b>>=f}return a}function p(a,b){b||(b=y);a=m(a,b);b=1<<b;b=u.unproject_SM({x:Math.PI*
(-1+2*a[0]/b),y:Math.PI*(1-2*a[1]/b)});b.lat.toPrecision.call.a;b.lng.toPrecision.call.a;return b}var v=alp.sub("alp.maps.qt7bit",null,!0),u=alp.maps,t=alp.util.math.arr10,w=Math.PI,x=2*w,y=v.NBITS;v.BITID_LENGTH=10;v.ORIG_NW=g;v.ORIG_SE=f;v.bitarr_2_bitstr=k;v.bitstr_2_bitarr=h;v.latlng_2_int64str10=function(a,b){return d(e(a,b))};v.latlng_2_qt7bitarr=e;v.latlng_2_qt7bitstr=function(a,b){return k(e(a,b))};v.mapbbox_2_from_to=function(a,b){return{qt7bit_from:v[b]({lat:a[3],lng:a[0]}),qt7bit_to:v[b]({lat:a[1],
lng:a[2]})}};v.mapbbox_normalize=function(a){var b=a[0],c=b;if(-180>c||180<c){for(c%=360;180<c;)c-=360;for(;-180>c;)c+=360;a=[c,a[1],a[2]+(c-b),a[3]]}return a};v.qt7bit_2_int64str10=d;v.int64str10_2_qt7bitstr=b;v.int64str10_2_qt7bitarr=c;v.qt7bit_2_latlng=a;v.qt7bit_2_tilexy=m;v.qt7bit_add=q;v.qt7bit_minus_1=n;v.qt7bit_plus_1=r;v.qt7bit_sub=function(a,b,c){return q(a,-b,c)};v.tilexy_2_qt7bitarr=l;v.tilexy_2_qt7bitstr=function(a,b){return k(l(a,b))};var z=alp.arrRep([0],10),A={},C={},E=!(alp.likeIE()&&
alp.likeIE8minus_backslash_v())})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.qt7bit");"undefined"!==typeof dojo&&dojo.provide("alp.util.math.angle");
(function(){function k(b,c){c||(c=0);for(b=(b-c)%360;-180>b;)b+=360;for(;180<b;)b-=360;return b}function h(b){var c=Math.abs(b);b=c|0;c=60*(c-b);var a=c|0;return b+"\u00b0 "+a+"' "+Math.round(6E5*(c-a))/1E4+'"'}function g(b){return!!e(b)}function f(b){var c=b.match(/(\d+(?:\.\d+)?)/g);b=parseFloat(c[0])||0;var a=parseFloat(c[1])||0;c=parseFloat(c[2])||0;return b+a/60+c/3600}function e(b){var c=/^\s*([-\+]?\d+(?:\.\d*))\s*,\s*([-\+]?\d+(?:\.\d*))\s*$/.exec(b);if(!c)return null;b=parseFloat(c[1]);c=
parseFloat(c[2]);var a=[c,b];a.x=a.lng=c;a.y=a.lat=b;return a}var d=alp.sub("alp.util.math",null,!0);d.angleDelta=k;d.angleInterpolate=function(b,c,a){return b+a*k(c,b)};d.angleRad=function(b){return b/180*Math.PI};d.angleWmean=function(b,c,a){var d=0,e=0,f=0;if(c&&b.length!==c.length)throw Error('alp.util.math.angleWmean: the two arrays "angles" and "weights" must have the same length');a=a?1:Math.PI/180;for(var g=b.length,h=0;h<g;h++){var p=c?c[h]:1;d+=p;var k=b[h]*a;e+=p*Math.cos(k);f+=p*Math.sin(k)}return Math.atan2(f/
d,e/d)/a};d.degrees_decimal_2_minsec=h;d.degrees_is_minsec=function(b){return!g(b)&&1<(b.match(/\b\d+(?:\.\d+)?\b/g)||[]).length&&!(b.match(/[a-z]/gi)||[]).join("").match(/[^NSEW]/g)};d.degrees_is_strdec=g;d.degrees_minsec_2_decimal=f;d.degrees_minsec_2_xy=function(b){var c=b.match(/(\d+(?:\.\d+)?)/g),a=c.length>>1,d=f(c.slice(0,a).join(" "));d=-1<b.lastIndexOf("S")?-d:d;c=f(c.slice(a).join(" "));b=-1<b.lastIndexOf("W")?-c:c;c=[b,d];c.x=c.lng=b;c.y=c.lat=d;return c};d.degrees_strdec_2_xy=e;d.degrees_xy_2_minsec=
function(b){var c="x"in b?b.x:b[0];b="y"in b?b.y:b[1];return[h(b),0>b?"S":"N",h(c),0>c?"W":"E"].join(" ")};d.degrees_xy_2_strdec=function(b,c){null!=c||(c=6);var a="x"in b?b.x:b[0];return("y"in b?b.y:b[1]).toFixed(c)+","+a.toFixed(c)}})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.bounds");
(function(){function k(b,a){a=alp.reduce(b,"{west : Math.min( v.west, w.lng), east : Math.max( v.east, w.lng), north : Math.max( v.north, w.lat), south : Math.min( v.south, w.lat)}",a||{west:Infinity,east:-Infinity,north:-Infinity,south:Infinity});return h(a)}function h(b){var a="north"in b&&"south"in b&&"east"in b&&"west"in b;if(a&&b instanceof Array&&4===b.length&&"center"in b&&"span"in b)return b;a||(b.getSouthWest&&b.getNorthEast?(a=b.getSouthWest(),b=b.getNorthEast(),b={west:a.lng(),east:b.lng(),
north:b.lat(),south:a.lat()}):(b instanceof Array&&4===b.length||null.not_supported,b={west:b[0],east:b[2],north:b[3],south:b[1]}));a=b.north-b.south;for(var c=b.east-b.west;0>a;)a+=360;for(;0>c;)c+=360;return alp.mix([b.west,b.south,b.east,b.north],b,{center:{lng:(b.east+b.west)/2,lat:(b.north+b.south)/2},span:{lng:c,lat:a}})}var g=alp.sub("alp.maps",0,1),f=alp.maps.qt7bit,e=alp.util.math,d=e.angleDelta,b=e.angleWmean;g.bounds=k;g.bounds_buffer=function(c,a,e){if(!a&&!e)return c;var f=e&&e.min_dx||
0;e=e&&e.min_dy||0;var g=c.west,m=c.east,h=c.north,p=c.south;c=b([m,g]);var v=b([p,h]);a=1+2*(a||0);f=Math.max(f,a*d(m,g));e=Math.max(e,a*d(h,p));return k([{lng:c-f/2,lat:v-e/2},{lng:c+f/2,lat:v+e/2}])};g.bounds_extended=h;g.bounds_from_xy=function(b,a){a=alp.reduce(b,"{west : Math.min( v.west, w[0]), east : Math.max( v.east, w[0]), north : Math.max( v.north, w[1]), south : Math.min( v.south, w[1])}",a||{west:Infinity,east:-Infinity,north:-Infinity,south:Infinity});return h(a)};g.bounds_center=function(c){if(!c.center||
!alp.isFiniteNumber(c.center.lat)){if("west"in c&&alp.isFiniteNumber(c.west)){var a=c.west;var d=c.south;var e=c.east;var f=c.north}else a=c[0],d=c[1],e=c[2],f=c[3];c.center={lat:b([d,f]),lng:b([a,e])}}return c.center};g.bounds_union=function(b,a){var c=Math.max(b.north,a.north),d=Math.min(b.south,a.south),e=Math.PI;b=[b.west,b.east,a.west,a.east];a=alp.map(b,"/180*"+e);e=Math.atan2(alp.reduce(alp.map(a,"Math.sin(v)"),"+")/4,alp.reduce(alp.map(a,"Math.cos(v)"),"+")/4)/e*180;a=alp.map(b,"(v-this)%360",
e);b=e+Math.min.apply(Math,a);e+=Math.max.apply(Math,a);return h({north:c,south:d,west:b,east:e})};g.bounds_2_fromto=function(b){if(!b.fromto){if("west"in b&&alp.isFiniteNumber(b.west)){var a=b.west;var c=b.south;var d=b.east;var e=b.north}else a=b[0],c=b[1],d=b[2],e=b[3];if(Math.abs(d-a)>360-1E-10)a=-180,d=180;else{for(;180<a;)a-=360,d-=360;for(;-180>a;)a+=360,d+=360;180<d&&(d-=360)}var g=f.latlng_2_qt7bitstr({lat:e,lng:a}),h=f.latlng_2_qt7bitstr({lat:c,lng:d}),p=null,k=null,u=!1;if(a>d||g>h)u=!0,
k=h,h=f.ORIG_SE().qt_str,p=f.ORIG_NW().qt_str;var t=f.qt7bit_2_latlng(g),w=f.qt7bit_2_latlng(h);b.fromto=[{qtfrom:g,qtto:h,qtnorthwest:t,qtsoutheast:w,west:t.lng,north:e,east:w.lng,south:c}];u&&(g=f.qt7bit_2_latlng(p),h=f.qt7bit_2_latlng(k),b.fromto.push({qtfrom:p,qtto:k,qtnorthwest:g,qtsoutheast:h,west:g.lng,north:e,east:h.lng,south:c}));p=b.fromto;p.b=b;p.w=a;p.s=c;p.e=d;p.n=e;for(a=d-a;0>a;)a+=360;p.dx=a;p.dy=e-c}return b.fromto}})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.project_point_on_bounds");
(function(){var k=alp.sub("alp.maps",null,!0),h=k.bbox_extend,g=k.bounds_extended;k.project_point_on_bounds=function(e,d,b){"number"!==typeof e[0]&&"number"!==typeof e[1]&&null!=e.lat&&(e="function"===typeof e.lat?[e.lng(),e.lat()]:[e.lng,e.lat]);alp.and(e,".toPrecision.call.a");var c=!(d instanceof Array&&"object"===typeof d[0]);c&&(d=[d]);var a=b&&b.tolerance,m=b&&b.radius||6378137,l=b&&b.inplace;b=e[0];e=e[1];var k=d.length,n;0<k&&"function"===(n=d[0]).getCenter&&"function"===n.getCenter().lng&&
"function"===n.toSpan&&n.toSpan();var q=alp.map(d,"(v = this(v)) ,(v.bc = (w = v.center)), (v.bc_lat = w.lat), (v.bc_lng = w.lng),(v.sp = (w = v.span)), (v.hx = w.lng / 2), (v.hy = w.lat / 2),v",function(a){return g(h(a,l),l)});d=Array(k);for(n=0;n<k;n++){var p=q[n],v=p.bc_lng,u=p.bc_lat,t=p.hx,w=p.hy,x=p.west,y=p.east,z=p.north,A=p.south;p=-180+(180+b-v)%360;for(var C=e-u;180<p;)p-=360;for(;-180>p;)p+=360;x=[[x,z],[y,z],[x,A],[y,A]];-t<p&&p<t&&x.push([b,u+(0>C?-w:+w)]);-w<C&&C<w&&x.push([v+(0>p?
-t:+t),e]);v=Infinity;u=null;t=-Infinity;w=null;y=x.length;for(z=0;z<y;z++){p=x[z];var E=f*(p[0]-b),G=f*e,B=f*p[1];C=Math;A=C.cos(E)*C.cos(B)-C.cos(G);E=C.sin(E)*C.cos(B);G=C.sin(B)-C.sin(G);A=C.sqrt(A*A+E*E+G*G);C=2*C.asin(A/2)*m;C<v&&(v=C,u=p);C>t&&(t=C,w=p)}u&&w&&isFinite(v)&&isFinite(t)&&v-1E-10<t||(void 0).bug;d[n]={closest:u,closest_d:v,farthest:w,farthest_d:t,ind:n}}if(1<d.length&&null!=a){m=alp.reduce(d,"Math.min( v, w.farthest_d )",Infinity);a=(1+a)*m;for(n=d.length;n--;)d[n].closest_d>a&&
d.splice(n,1);d.length||(void 0).bug}return c?d[0]:d};var f=Math.PI/180})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.project_point_on_line_pieces");
(function(){var k=alp.sub("alp.maps",null,!0);k.project_point_on_line_pieces=function(g,f,e){f instanceof Array||(f=[f]);var d=k.project_point_on_bounds(g,alp.map(f,".bounds"),e),b=e&&e.tolerance||.2;e=e&&e.radius||6378137;var c=g[0];g=g[1];var a=1+b,m=b/10;b=[];c.toPrecision.call.a;g.toPrecision.call.a;for(var l=d.length,r=0;r<l;r++){var n=d[r].ind,q=f[n],p=q.xy_arr;q=p.length;for(var v=q-2,u=Array(q),t=Infinity,w=null,x=q;x--;){var y=p[x],z=h*(y[0]-c),A=h*g,C=h*y[1];y=Math;var E=y.cos(z)*y.cos(C)-
y.cos(A);z=y.sin(z)*y.cos(C);A=y.sin(C)-y.sin(A);A=y.sqrt(E*E+z*z+A*A);y=y.asin(A/2);y=u[x]=2*y*e;y<t&&(t=y,w=x)}if(null!=w)for(A=t*a,E=t*m,x=0;x<q;x++)x===w?b.push({pieceInd:n,pointInd0:x,pointInd1:x,alpha:0,d:t}):(y=u[x],y>A||!(1>x||y+E<u[x-1])||!(x>v||y+E<u[x+1])||(p={pieceInd:n,pointInd0:x,pointInd1:x,alpha:0,d:y},b.push(p)))}for(r=b.length;r--;)p=b[r],q=f[p.pieceInd],d=q.first_ind,alp.isFiniteNumber(d)&&(p.globalPointInd0=d+p.pointInd0,p.globalPointInd1=d+p.pointInd1);return b};var h=Math.PI/
180})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.util.project_point_on_line_pieces");(function(){alp.sub("alp._gmap2_3.util",null,!0).project_point_on_line_pieces=alp.maps.project_point_on_line_pieces})();"undefined"!==typeof dojo&&dojo.provide("alp.x.elpro_tourpoi_model");
(function(){function k(h){var g=h.m,f=alp.m(g.tpoi,["_get_no_clone","get"]),e=alp.m(g.dzInfoArr,["_get_no_clone","get"]),d=e.cum_d,b=g.tpoiMultiProject;f&&e&&e.all_z?(b=alp.map(f.poiArr,"alp._gmap2_3.util.project_point_on_line_pieces(v.geometryObj, this.pieces, this.opt)",{pieces:alp.map(e,".piece"),opt:{tolerance:h.multiProjectionTolerance}}),b=alp.map(b,function(b,a){var c=alp.reduce(b,"Math.min( v, w.d )",Infinity)*(1+h.multiProjectionTolerance),l=f.poiArr[a];return alp.reduce(alp.map(alp.filter(b,
".d<"+c),function(a){var b=e[a.pieceInd].hvArr;b=alp.interpolate(b[a.pointInd0],b[a.pointInd1],a.alpha);b[0]+=d[a.pieceInd];return alp.oCreateMix(a,{hv:b,h:b[0],v:b[1]})}),function(a,b){if(a.length){var c=a[a.length-1],d=Math.abs(c.h-b.h),e=Math.max(c.d,b.d);if(1E-5>d||d<e/h.multiProjectionTolerance)return e=l.altitude,null!=e?(d=c.v-e,e=b.v-e,c=c.d*c.d+d*d,d=b.d*b.d+e*e):(c=c.v,d=b.v),d<c&&(a[a.length-1]=b),a}return a.concat([b])},[])}),b=alp.map(f.poiArr,"alp.oCreateMix( v, { multiProject : this[ i ] } )",
b),g.tpoiMultiProject.set(b)):b.set()}alp.declare("alp.x.ElproTourPoiModel",alp.x.ElproModel,null,{multiProjectionTolerance:.2,augmentModel:function(h){h.tpoi=this.tourpoiModel||new alp.ObjectState;h.tpoiMultiProject=new alp.ObjectState},setInitVal:function(h,g,f,e){k(h)},connectModel2Model:function(h,g,f,e){h=alp.ratelimitF(181,k,null,h);g.push(f.tpoi.change_cb(h));g.push(f.dzInfoArr.change_cb(h))}})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.slider");
(function(){function k(a,b,c){return function(){b.set(c[a.get()])}}function h(a,b,c){return function(){a.set(alp.arrMinIndex(c,"Math.abs("+b.get()+"-v)"))}}function g(a,b,c){a[G]=Date.now?Date.now():+new Date;a.m[b?"_highVis":"_lowVis"].setPropNow(q(a,0,1,c[a.horiz?"propX":"propY"]))}function f(a,b,c){a[G]=Date.now?Date.now():+new Date;c=q(a,0,1,c[a.horiz?"propX":"propY"]);a.m[b?"_highVis":"_lowVis"].setProp(c);a.m[b?"high":"low"].setProp(c);a.mouseChangeEvt().triggerSoon()}function e(a,b){a[G]=Date.now?
Date.now():+new Date;b=b[a.horiz?"propX":"propY"];var c=a.m,d=(c._highVis.get()-c._lowVis.get())/(a.vMax-a.vMin);a.isRTL?(c._lowVis.setProp(b+d),c._highVis.setProp(b)):(c._lowVis.setProp(b),c._highVis.setProp(b+d))}function d(a,b){a[G]=Date.now?Date.now():+new Date;b=b[a.horiz?"propX":"propY"];var c=a.m,d=(c.high.get()-c.low.get())/(a.vMax-a.vMin);a.isRTL?(c.low.setProp(b+d),c.high.setProp(b)):(c.low.setProp(b),c.high.setProp(b+d));a.mouseChangeEvt().triggerSoon()}function b(a,b){if(!(750>(Date.now?
Date.now():+new Date)-a[G])){b||(b=window.event);alp.stopEvent(b);var c=b.target||window.target;if(c!==a[C]&&c!==a[E]){c=alp.gBCR(a[v]);var d=a.horiz?c.left:c.top;b=q(a,0,1,((a.horiz?b.clientX:b.clientY)-d)/((a.horiz?c.right:c.bottom)-d));a.range?(c=Math.abs(b-a.m.low.getProp()),Math.abs(b-a.m.high.getProp())<c?a.m.high.setPropNow(b):a.m.low.setPropNow(b)):a.m.low.setPropNow(b);a.mouseChangeEvt().triggerSoon()}}}function c(a,b){var c=a.m,d=c[b?"_highVis":"_lowVis"],e=d.get();d=d.getProp();c=a.discreteValues&&
c[b?"_highDvalVis":"_lowDvalVis"].get();var f=a[b?w:u].style,l=a.horiz;"absolute"!==f.position&&(f.position="absolute");var g=a.isRTL?"right":"left";f[l?g:"top"]=(100*(e-a.vMin)/(a.vMax-a.vMin)).toFixed(5)+"%";"none"===f.display&&(f.display="");a.extraVisValueHtml&&(alp.setProp(a[b?E:C],"innerHTML",a.extraVisValueHtml(e,d)),a.extraVisValueNodes&&a.extraVisValueNodes(a[C],a[E]));if(d=a[b?A:z])c=a.discreteValues?c:e,c=a.htmlDisplay?a.htmlDisplay(c):c,alp.setText(d,c+(!a.discreteValues&&b&&a.highDisplayPlus&&
e==a.vMax?"+":""))}function a(a){var b=a.m._lowVis.get(),c=a.m._highVis.get();b=100*(b-a.vMin)/(a.vMax-a.vMin);c=100*(c-a.vMin)/(a.vMax-a.vMin);var d=a[y].style;if(!a.range)if("left"===a.singleSel)c=b,b=0;else if("right"===a.singleSel)c=100;else throw Error("alp.x.Slider: Unrecognized value "+a.singleSel+" for `singleSel`. Must be either left or right or nulley.");"absolute"!==d.position&&(d.position="absolute");"none"===d.display&&(d.display="");a.horiz?(d[a.isRTL?"right":"left"]=b+"%",d.width=c-
b+"%"):(d.top=b+"%",d.height=c-b+"%")}function m(a){var b=a.m._lowVis,c=a.m._highVis;b=b.min!==b.get()||c.max!==c.get();a.extraOnPart(b)}function l(a,b,c,d,e){c=a.m[b?"high":"low"].getProp();var f=alp.gBCR(a[v]);b=a.horiz;d=q(a,0,1,Math.max(0,Math.min(1,q(a,c,c,b?d/f.width:e/f.height))));if(e=a.discreteStep)a=e/(a.vMax-a.vMin),d=a*Math.round(d/a);return b?{propX:d}:{propY:d}}function r(a,b,c,d,e,f){c=a.horiz;d=alp.gBCR(a[v]);var l=alp.gBCR(a[y]);b=c?b.x:b.y;var g=a.discreteStep;g&&(a=d[c?"width":
"height"]*g/(a.vMax-a.vMin),b=a*Math.round(b/a));return c?{x:Math.max(0,Math.min(d.width-l.width,b)),y:f}:{x:e,y:Math.max(0,Math.min(d.height-l.height,b))}}function n(a,b){alp.setClass(a[y],a.draggedClass,b)}function q(a,b,c,d){return a.isRTL&&a.horiz?c-d:b+d}alp.ensureCss(alp.cssBase()+"alp/x.css");alp.onDCL(function(){alp.imgPreload(alp.cssBase()+"alp/images/slider_dragged.png")});alp.x.setupSlider=function(a,b){return new alp.x.Slider(alp.oCreateMix(b||{},{cont:a}))};alp.declare("alp.x.Slider",
alp.x.AbstractController,null,{cont:null,range:!1,drag:!1,singleSel:null,vMin:0,vMax:10,discreteStep:null,discreteValues:null,lowDisplay:null,highDisplay:null,highDisplayPlus:!1,htmlDisplay:null,vInit:null,horiz:null,isRTL:null,horizontalClass:"alp-x-slider-h",verticalClass:"alp-x-slider-v",barClass:"alp-x-slider-bar",lowClass:"alp-x-slider-low",highClass:"alp-x-slider-high",selClass:"alp-x-slider-sel",lowDraggableClass:"alp-x-slider-low-draggable",highDraggableClass:"alp-x-slider-high-draggable",
lowValueClass:"alp-x-slider-low-value",highValueClass:"alp-x-slider-high-value",valueClass:"alp-x-slider-value",draggableClass:"alp-x-handcur",draggedClass:"alp-x-dragged",extremityClass:"alp-x-slider-extremity",extremity:!0,extraVisValueHtml:null,extraVisValueState:null,extraVisValueNodes:null,extraOnPart:null,augmentModel:function(a){function b(a,b){a=Math.max(d.vMin,Math.min(d.vMax,a));var c=d.discreteStep;c&&(a=c*Math.round(a/c));return g.call(this,a,b)}function c(a,b){a=alp.arrMinIndex(d.discreteValues,
alp.f("Math.abs("+a+" -v)"));return e[a]}var d=this,e=d.discreteValues;null===d.isRTL&&(d.isRTL=alp.isRTL());e&&(d.vMin=0,d.vMax=e.length-1,d.discreteStep=1);var f=null!==d.vInit?d.vInit:d.range?[d.vMin,d.vMax]:(d.vMin+d.vMax)/2;"number"===typeof f&&(f=[f,f]);var l=f[0];f=f[1];var g=alp.MinMaxState.constrain_min_max_impl;a.low=new alp.MinMaxState({min:d.vMin,max:d.vMax,init_value:l,constrain_all:b});a.high=new alp.MinMaxState({min:d.vMin,max:d.vMax,init_value:f,constrain_all:b});e&&(a.lowDval=new alp.State({constrain_all:c}),
a.highDval=new alp.State({constrain_all:c}));a._lowVis=new alp.MinMaxState({min:d.vMin,max:d.vMax,init_value:l,constrain_all:b});a._highVis=new alp.MinMaxState({min:d.vMin,max:d.vMax,init_value:f,constrain_all:b});e&&(a._lowDvalVis=new alp.State({constrain_all:c}),a._highDvalVis=new alp.State({constrain_all:c}))},augmentKids:function(a){function b(){c.hasContNode();c.init()}var c=this;c.hasContNode()?b():c.contNodeDfrd().then(b)},setInitVal:function(a,b,c,d){var e=alp.map(["_lowVis","_highVis","low",
"high"],function(a){return c[a]}),f=alp.map(e,alp.f(".getProp()"));alp.forEach(e,function(b){b.min=a.vMin;b.max=a.vMax});alp.now(function(){alp.forEach(e,function(a,b){a.setProp(f[b])})});alp.m(a.lowDnd,"destroy");a.lowDnd=null;alp.m(a.highDnd,"destroy");a.highDnd=null;b=a.range&&a[w];a.lowDnd=alp.x.dnd(a[u],{leave_it:!0,xy_constrain:alp.bindF(l,null,a,!1),isParentRelative:!0,dummy_cfg:!1,clickable:a[t]});b&&(a.highDnd=alp.x.dnd(a[w],{leave_it:!0,xy_constrain:alp.bindF(l,null,a,!0),isParentRelative:!0,
dummy_cfg:!1,clickable:a[x]}));a.range&&a[y]&&a.drag&&(a.selDnd=alp.x.dnd(a[y],{leave_it:!0,xy_constrain:alp.bindF(r,null,a),isParentRelative:!0,dummy_cfg:!1}),alp.setClass(a[y],a.draggableClass,!0))},connectModel2Model:function(a,b,c,d){function e(a,b,c,d){b.push(c.change_cb_init(function(){d.setNow(Math.max(d.get(),c.get()))}));b.push(d.change_cb_init(function(){c.setNow(Math.min(d.get(),c.get()))}))}b.push(c.low.bind_to(c._lowVis));c.high&&b.push(c.high.bind_to(c._highVis));c.lowDval&&(b.push(c.low.change_cb_init(k(c.low,
c.lowDval,a.discreteValues))),b.push(c.lowDval.change_cb(h(c.low,c.lowDval,a.discreteValues))),c._lowDvalVis&&b.push(c._lowVis.change_cb_init(k(c._lowVis,c._lowDvalVis,a.discreteValues))));c.highDval&&(b.push(c.high.change_cb_init(k(c.high,c.highDval,a.discreteValues))),b.push(c.highDval.change_cb(h(c.high,c.highDval,a.discreteValues))),c._highDvalVis&&b.push(c._highVis.change_cb_init(k(c._highVis,c._highDvalVis,a.discreteValues))));a.range&&(e(a,b,c.low,c.high),e(a,b,c._lowVis,c._highVis),c._lowDvalVis&&
c._highDvalVis&&e(a,b,c._lowDvalVis,c._highDvalVis))},connectModel2View:function(b,d,e,f){if(b.hasContNode()){f=b.lowDisplay;var l=b.highDisplay;b[z]=f&&("string"===typeof f?alp.gEBCN(f):f);b.range&&(b[A]=l&&("string"===typeof l?alp.gEBCN(l):l));d.push(e._lowVis.change_cb_init(alp.bindF(c,null,b,!1)));b.range&&d.push(e._highVis.change_cb_init(alp.bindF(c,null,b,!0)));if(b.range||b.singleSel)d.push(e._lowVis.change_cb_init(alp.bindF(a,null,b))),d.push(e._highVis.change_cb_init(alp.bindF(a,null,b)));
b.range&&b.extraOnPart&&(f=alp.bindF(m,null,b),d.push(e._lowVis.change_cb_init(f)),d.push(e._highVis.change_cb(f)));b.extraVisValueState&&(d.push(b.extraVisValueState.change_cb(alp.bindF(c,null,b,!1))),b.range&&d.push(b.extraVisValueState.change_cb(alp.bindF(c,null,b,!0))))}},connectView2Model:function(a,c,l,m){a.hasContNode()&&(l=a.lowDnd.dragEvt(),c.push(l.then(alp.bindF(g,null,a,!1))),l=a.lowDnd.dropEvt(),c.push(l.then(alp.bindF(f,null,a,!1))),a.highDnd&&(l=a.highDnd.dragEvt(),c.push(l.then(alp.bindF(g,
null,a,!0))),l=a.highDnd.dropEvt(),c.push(l.then(alp.bindF(f,null,a,!0)))),a.selDnd&&(l=a.selDnd.dragEvt(),c.push(l.then(alp.bindF(e,null,a))),l=a.selDnd.dropEvt(),c.push(l.then(alp.bindF(d,null,a)))),c.push(alp.aEL(a.getContNode(),"click",alp.bindF(alp.nowF(b),null,a))))},connectPureView:function(a,b,c,d){a.selDnd&&(c=a.selDnd.dragEvt(),b.push(c.then(alp.bindF(n,null,a,!0))),c=a.selDnd.dropEvt(),b.push(c.then(alp.bindF(n,null,a,!1))))},contNodeDfrd:alp.memM("contNodeDfrd","alp.subDfrd( this.getContNode, this )"),
hasContNode:function(){return!!this.getContNode()},getContNode:function(){var a;if(!(a=this[p])){a=p;var b="string"===typeof this.cont?alp.gEBI(this.cont)||alp.gEBCN(this.cont)[0]:"function"===typeof this.cont?this.cont():this.cont;if(b){this[v]=alp.gEBCN(this.barClass,b)[0]||alp.cE("div",b,{"class":this.barClass});this[u]=alp.gEBCN(this.lowClass,b)[0]||alp.cE("div",null,{"class":this.lowClass,style:"display: none;"});this[t]=alp.gEBCN(this.lowDraggableClass,this[u])[0]||alp.cE("div",this[u],{"class":this.lowDraggableClass});
this.extraVisValueHtml&&(this[C]=alp.gEBCN(this.lowValueClass,this[u])[0]||alp.cE("div",this[u],{"class":this.lowValueClass+" "+this.valueClass}));alp.place(this[u],this[v],"first");this.range&&(this[w]=alp.gEBCN(this.highClass,b)[0]||alp.cE("div",null,{"class":this.highClass,style:"display: none;"}),this[x]=alp.gEBCN(this.highDraggableClass,this[w])[0]||alp.cE("div",this[w],{"class":this.highDraggableClass}),this.extraVisValueHtml&&(this[E]=alp.gEBCN(this.highValueClass,this[w])[0]||alp.cE("div",
this[w],{"class":this.highValueClass+" "+this.valueClass})),alp.place(this[w],this[v],"last"));if(this.range||this.singleSel)this[y]=alp.gEBCN(this.selClass,this[v])[0]||alp.cE("div",this[v],{"class":this.selClass,style:"display: none;"}),alp.place(this[y],this[v],"first");if(null==this.horiz){var c=this.horizontalClass,d=this.verticalClass,e=alp.hasClass(b,c),f=alp.hasClass(b,d);e^f?this.horiz=e:(e=alp.gBCR(b),f=alp.gBCR(this[v]),this.horiz=e.width||e.height?!(e.height>e.width):!(f.height>f.width))}alp.setClass(b,
c,this.horiz);alp.setClass(b,d,!this.horiz);if(this.extremity){for(;!(1<(c=alp.gEBCN(this.extremityClass,this[v])).length);)alp.cE("div",this[v],{"class":this.extremityClass});alp.setClass(c[0],"alp-x-slider-min",!0);alp.setClass(c[1],"alp-x-slider-max",!0)}(c=!this.range&&this.singleSel)&&alp.setClass(b,"alp-x-slider-singlesel-"+c,!0)}a=this[a]=b}return a},mouseChangeEvt:alp.memM("mouseChangeEvt",'alp.event("AXS:mouseChangeEvt",{then:1})')});var p="_contNode",v="_barNode",u="_lowNode",t="_lowDraggableNode",
w="_highNode",x="_highDraggableNode",y="_selNode",z="_low_display",A="_high_display",C="_low_value",E="_high_value",G="_last_drop_date"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.elpro");
(function(){function k(a,b,c,d){if(a=a[c]){for(var e=a.piece.gll_arr,f=e.length,l=0;l<f&&!b.contains(e[l]);l++);return d[c]+a.dArr[l]}}function h(a,b,c,d){if(a=a[c]){for(var e=a.piece.gll_arr,f=e.length-1;-1<f&&!b.contains(e[f]);f--);return d[c]+a.dArr[f]}}function g(a){var b=a._canvasSubNode,c=a._gr,d=alp.m(c,"getWidthPixel");c=alp.m(c,"getHeightPixel");if(b&&0<b.clientWidth&&0<b.clientHeight&&0<d&&0<c){b=a.m;var e=b.restrictedHV.get(),f=b.visible.get();if(e&&f&&e.length){f.left.toPrecision.call.a;
f.right.toPrecision.call.a;a={color:[.8,.8,.6,1],thick:!0,left_meters:f.left,right_meters:f.right,vlines_nolegend:!1,hlines_nolegend:!0,elevationSummary:b.elevationSummary.get(),background:a.background,hlines:a.hlines,vlines:a.vlines,stage_start_icon:b.stageStartIcon.get(),i18n_stage:b.i18n_stage.get(),_hash_grWidth:d,_hash_grHeight:c};if(d=e.stageInfoArr)a.stageInfoArr=d;b.elproViewOpt.set(a)}else b.elproViewOpt.set(null)}else setTimeout(a[t],100)}function f(a){var b=a._canvasSubNode;if(b&&0<b.clientWidth&&
0<b.clientHeight){var c=a.m;b=a._gr=a._gr||new alp.GR(b,{onresize:a[t]});var d=c.restrictedHV.get(),e;if(e=d){e=c.attrSorted.get();var f=d.delta_seg_ind;if(e&&e.length){for(var l=0,g=0,m=f+d.length,h=e.length,n=0;n<h;n++){var p=e[n];if(p.to>=f){l=n;break}}for(n=e.length;n--;)if(p=e[n],p.from<m){g=n;break}e=alp.filter(alp.map(e.slice(-1<l?l:0,-1<g?1+g:Infinity),"{ key : v.key, value : v.value, from : v.from - "+f+", to : v.to - "+f+" }"),"v.from < v.to - 1e-6")}else e=[]}f=d&&c.elproViewOpt.get();
d&&f&&(l=a.tpoiShow,c=alp.oCreateMix(f,{attributes:e,hlines_extra_legend:a.heightNode,tpoiMultiProject:l&&alp.m(c.tpoiMultiProject,["_get_no_clone","get"]),tpoiHighlightId:l&&c.tpoiHighlightId.get(),tpoiMindistpix:l&&a.tpoiMindistpix}),c=b.elpro(d,c),a.m.elproWidthPixel.set(b.getWidthPixel()),a.m.elproHeightPixel.set(b.getHeightPixel()),a.m.elproInfo.set(c))}else setTimeout(a[w],157)}function e(a){var b=a._gr;b&&alp.gr.elproTpoi_setHighlightId(b,a.m.tpoiHighlightId.get())}function d(a){var b=a.m,
c=a.stageDistanceNode&&alp.nodify(a.stageDistanceValueCont,a.stageDistanceNode);if(c){var d=b.i18n_stage.get();b=b.stageInfoArr.get();if(d&&b){var e=a._stageDistanceTmplHtml||(a._stageDistanceTmplHtml=alp.nodify(a.stageDistanceTmplClass,a.stageDistanceNode).innerHTML),f=document.createDocumentFragment();alp.forEach(b,function(b){var c=alp.tmpl(d,{i:1+(b.stageIndex|0)});b=alp.i18n.dotComma((.001*b.d).toFixed(1));var l=alp.cE("span",f,{"class":a.stageDistanceValueClass},{innerHTML:e});alp.aC(alp.nodify(a.stageDistanceTitleClass,
l),alp.aC(alp.cE("span",null,{"class":a.cssStageLabel}),alp.cE("span",null,{"class":a.cssStageLabel+"_text"},{innerHTML:c})));alp.setText(alp.nodify(a.stageDistanceLengthClass,l),b)});alp.empty(c);alp.aC(c,f)}else alp.empty(c)}}function b(a){var b=a.distanceNode&&alp.nodify(a.attrDistanceValueCont,a.distanceNode);if(b){var c=a._distanceTmplHtml||(a._distanceTmplHtml=alp.nodify(a.attrDistanceTmplClass,a.distanceNode).innerHTML),d=a.m.attrSummary.get_property(a.attrDistanceKey);d=alp.arrSorted(alp.o2arr(d),
"v[1].total_distance_m > w[1].total_distance_m  ?  -1  :  +1");var e=a._attrSummary_v_node_cache||(a._attrSummary_v_node_cache={}),f=document.createDocumentFragment();alp.forEach(d,function(b){var d=b[0];b=b[1].total_distance_m;if(0<b){var l=e[d];l||(l=e[d]=alp.cE("span",null,{"class":a.attrDistanceValueClass},{innerHTML:c}),alp.setText(alp.nodify(a.attrDistanceTitleClass,l),a.polyModel.attributes.getLabel(a.attrDistanceKey,d)),alp.style(alp.nodify(a.attrDistanceColorClass,l),{color:""+a.polyModel.attributes.getColor(a.attrDistanceKey,
d)}));alp.setText(alp.nodify(a.attrDistanceLengthClass,l),u.kmString(Math.max(100,b)));f.appendChild(l)}});alp.empty(b);b.appendChild(f)}}function c(a){var b=a.m.hoverPointMode,c=a.m.elproInfo.get();a=alp.sub("highest_lowest."+alp.x.ELPRO_HIGHEST,c);c=alp.sub("highest_lowest."+alp.x.ELPRO_LOWEST,c);var d=alp.cfg.css.cssHover;a&&alp.setClass(a,d,b.is(alp.x.ELPRO_HIGHEST));c&&alp.setClass(c,d,b.is(alp.x.ELPRO_LOWEST))}function a(a){var b=a.m;if(b.hoverPointMode.is(alp.x.ELPRO_GENERIC)){var c=b.visible.get(),
d=c&&c.left;c=c&&c.right;var e=b.highlightD.get();b=b.elproWidthPixel.get();if(null!=d&&null!=c&&null!=e&&null!==b&&0<b&&d<c&&d<=e&&e<=c){alp.style(a._highlightNode,{left:Math.round(b*(e-d)/(c-d))+"px",position:"absolute"});a._showHighlightNodeHeight(e);a._showHighlightNodeDistance(e);m(a,e);a._highlightNode.style.display="block";return}}a._highlightNode.style.display="none";m(a,null)}function m(a,b){var c=a._attrSummary_v_node_cache||(a._attrSummary_v_node_cache={}),d=(b=null!=b&&a.polyModel.attributes.get(a.attrDistanceKey,
a.polyModel.getIndexForD(b)))&&b.value;alp.forIn(c,function(b,c){alp.setClass(b,a.attrSummaryHighlightClass,c===d)})}function l(a){a=null==a?null:this.polyModel.getHeightForD(a);alp.style(this._highlightNodeHeight,"visibility",null==a?"hidden":"visible");null!=a&&(this._highlightNodeHeight.innerHTML=null==a?"":u.meterWithLabel(a))}function r(a){alp.style(this._highlightNodeDistance,"visibility",null==a?"hidden":"visible");null!=a&&(this._highlightNodeDistance.innerHTML=u.kmWithLabel(a))}function n(a){var b=
a._gr;if(b){var c=b.getWidthPixel();b=b.getHeightPixel();var d=c+","+b;c&&b||a.m.elproViewOpt.set(null);a[x]!==d&&(a[x]=d,y in a&&clearTimeout(a[y]),a[y]=setTimeout(alp.bindF("resize",a),357))}}var q=alp.util,p=q.math,v=alp._gmap2_3,u=alp.i18n.unit;alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.Elpro",alp.x.ElproTourPoiModel,function(){this._showHighlightNodeHeight=alp.ratelimitF(123,l);this._showHighlightNodeDistance=alp.ratelimitF(123,r)},{polyModel:null,tourpoiModel:null,canvasNode:null,
heightNode:null,distanceNode:null,clippingNode:null,stageDistanceNode:null,cssStageLabel:alp.cfg.css.cssStageLabel,autoResize:!0,canvasSubClass:"alp-x-elpro-canvas-sub",highlightClass:"alp-x-elpro-highlight",highlightHeightClass:"alp-x-elpro-highlight-height",highlightDistanceClass:"alp-x-elpro-highlight-distance",dragClass:"alp-x-elpro-drag",draggableClass:"alp-x-handcur",draggedClass:"alp-x-dragged",clippingLeft:null,clippingRight:null,attrDistanceTmplClass:"alp-tpwiz-eld-tmpl",attrDistanceKey:"waytype",
attrDistanceValueCont:"alp-tpwiz-eld-cont",attrDistanceValueClass:"alp-tpwiz-eld-value",attrDistanceColorClass:"alp-tpwiz-eld-color",attrDistanceTitleClass:"alp-tpwiz-eld-title",attrDistanceLengthClass:"alp-tpwiz-eld-length",attrSummaryHighlightClass:"alp-x-elpro-attr-legend-highlight",stageDistanceTmplClass:"alp-tpwiz-eldstage-tmpl",stageDistanceValueCont:"alp-tpwiz-eldstage-cont",stageDistanceValueClass:"alp-tpwiz-eldstage-value",stageDistanceTitleClass:"alp-tpwiz-eldstage-title",stageDistanceLengthClass:"alp-tpwiz-eldstage-length",
helptextClass:"alp-x-elpro-slider-helptext-cont",background:{skyBottom:"#444444ff",skyTop:"#444444ff",earthBottom:"#5d5d5dff",earthTop:"#949494ff"},hlines:{color:"#ffffff33"},vlines:{color:"#ffffff33"},tpoiShow:!0,tpoiMindistpix:null,centerOnD:alp.nowF(function(a,b){var c=this.m.restrictedHV.get(),d=c&&c.left_meters;c=c&&c.right_meters;null!==d&&null!==c&&(this.m.center.set((a-d)/(c-d)),b&&this.mouseZoomEvt().triggerSoon())}),destroy:function(){this.disconnect();alp.orphan(this._canvasSubNode);alp.orphan(this._dragNode);
this.canvasNode=this.heightNode=this.distanceNode=this.stageDistanceNode=this.clippingNode=this._canvasSubNode=this._dragNode=null},fitLeftRight:alp.nowF(function(a,b){var c=this.m.restrictedHV.get();if(c){c=c.right_meters-c.left_meters;var d=Math.max(0,-Math.log((b-a)/c)/Math.log(2));this.m.center.set((a+b)/(2*c));this.m.zoom.set(d)}}),fitBounds:function(a){var b=this.m.dzInfoArr.get(),c=b.cum_d,d=alp.reduce(b,"v[2].intersects( w.piece.bounds ) ? [ Math.min( v[0], i ), Math.max( v[1], i ), v[2] ] : v",
[Infinity,-Infinity,a]),e=d[0];d=d[1];if(e<=d){for(var f=null;e<=d&&!alp.isFiniteNumber(f=k(b,a,e,c));e++);for(var l=null;e<=d&&!alp.isFiniteNumber(l=h(b,a,d,c));d--);e<=d&&alp.isFiniteNumber(f)&&alp.isFiniteNumber(l)&&f<l&&this.fitLeftRight(f,l)}},getBounds:function(a){var b=this.m.visible.get(),c=b&&this.m.dzInfoArr.get(),d;if(b&&c&&c.length){var e=c.cum_d,f=b.left;b=b.right;f.toPrecision.call.a;b.toPrecision.call.a;for(var l=c.length;l--;){var g=c[l],m=g.dArr,h=m.length,n=h-1,p=e[l],k=p+m[0];h=
p+m[h-1];if(!(b<k-1E-10||f>h+1E-10)){k=f<k+1E-10;h=h-1E-10<b;if(k&&h)g=g.piece.bounds;else{var r={precision:1E-10};k=k?0:Math.max(0,Math.min(n,Math.round(q.dichotomy(f-p,0,n,m,r))));m=h?n:Math.max(0,Math.min(n,Math.round(q.dichotomy(b-p,0,n,m,r))));g=v.bounds_fromPath(g.piece.gll_arr,{first:k,last:m})}d?d.union(g):d=new a.LatLngBounds(g.getSouthWest(),g.getNorthEast())}}}return d},resize:function(){alp.m(this._gr,"resize")},zoomDelta:alp.nowF(function(a,b){this.m.zoom.set(this.m.zoom.get()+a);b&&
this.mouseZoomEvt().triggerSoon()}),mouseZoomEvt:alp.memM("mouseZoomEvt",'alp.event("AX:elpro:mouseZoomEvt",{then:1})'),mouseDragEvt:alp.memM("mouseDragEvt",'alp.event("AX:elpro:mouseDragEvt",{then:1})'),mouseDropEvt:alp.memM("mouseDropEvt",'alp.event("AX:elpro:mouseDropEvt",{then:1})'),touchPinchEvt:alp.memM("touchPinchEvt",'alp.event("AX:elpro:touchPinchEvt,{then:1}")'),tpoiClickEvt:alp.memM("tpoiClickEvt",'alp.event("AX:elpro:tpoiClickEvt",{then:1})'),augmentKids:function(a){function b(a,b){var c=
(a=e.m.restrictedHV.get())&&a.left_meters;return u.kmWithLabel(c+((a&&a.right_meters)-c)*b||0)}function c(a,b){a=alp.gBCR(a);var c=alp.gBCR(b),d=c.left<a.right+40;b.style.visibility=d?"hidden":"";if(b=alp.opt(e.clippingLeft,0)){var f=alp.gBCR(b);b.style.visibility=a.left<f.right+20?"hidden":""}if(b=alp.opt(e.clippingRight,0))f=alp.gBCR(b),b.style.visibility=f.left<(d?a:c).right+40?"hidden":""}function d(a){alp.style(e._helptextNode,{visibility:a?"hidden":""})}var e=this;this._canvasSubNode=alp.cE("div",
this.canvasNode,{"class":this.canvasSubClass});this._highlightNode=alp.cE("div",this.canvasNode,{"class":this.highlightClass});this._highlightNodeHeight=alp.cE("div",this._highlightNode,{"class":this.highlightHeightClass});this._highlightNodeDistance=alp.cE("div",this._highlightNode,{"class":this.highlightDistanceClass});this._dragNode=alp.cE("div",this.canvasNode,{"class":this.dragClass});a.dnd=alp.x.dnd(this._dragNode);this.clippingNode&&(this._helptextNode=alp.gEBCN(this.helptextClass,this.clippingNode),
a.clipping=new alp.x.Slider({cont:this.clippingNode,range:!0,drag:!0,extraVisValueHtml:b,extraVisValueState:e.m.restrictedHV,extraVisValueNodes:c,extraOnPart:d}))},connectModel2View:function(l,m,h,n){function p(){var a=h.center.get(),b=h.zoom.get();b=Math.pow(2,-1-b);n.clipping.m.low.setProp(a-b);n.clipping.m.high.setProp(a+b)}function k(){var a=h.restrictedHV.get(),b=a&&a.left_meters;a=a&&a.right_meters;l.clippingLeft&&alp.setText(l.clippingLeft,null==b?"":(0===b?"0":alp.i18n.dotComma((b/1E3).toFixed(1)))+
" km");l.clippingRight&&alp.setText(l.clippingRight,null==a?"":(0===a?"0":alp.i18n.dotComma((a/1E3).toFixed(1)))+" km")}var q=l[t]=alp.ratelimitF(157,alp.nowF(g),null,l),r=l[w]=alp.ratelimitF(133,alp.nowF(f),null,l);m.push(h.restrictedHV.change_cb(q));m.push(h.attrSorted.change_cb(q));m.push(h.visible.change_cb(q));m.push(h.elevationSummary.change_cb(q));q();m.push(h.isDraggable.change_cb_init(function(){alp.setClass(l._dragNode,l.draggableClass,!0)}));n.clipping&&(m.push(h.center.change_cb_init(p)),
m.push(h.zoom.change_cb(p)));(l.clippingLeft||l.clippingRight)&&m.push(h.restrictedHV.change_cb_init(k));m.push(h.attrSummary.change_cb_init(function(){l.polyModel.attributes.getLabelDfrd().then(alp.bindF(b,null,l))}));l.stageDistanceNode&&(m.push(h.stageInfoArr.change_cb(d,null,l)),m.push(h.i18n_stage.change_cb(d,null,l)),d(l));m.push(h.elproViewHash.change_cb_init(r));m.push(h.tpoiHighlightId.change_cb_init(alp.ratelimitF(57,alp.nowF(e),null,l)));m.push(h.hoverPointMode.change_cb_init(c,null,l));
alp.forEach(["hoverPointMode","highlightD","visible","elproWidthPixel"],function(b){m.push(h[b].change_cb(alp.ratelimitF(20,a,null,l)))});a(l)},connectView2Model:function(a,b,c,d){function e(b){b||(b=window.event);alp.stopEvent(b);var d=c.zoom.get();c.zoom.set(c.zoom.get()+(0>b.wheelDelta?-1:1));var e=c.zoom.get();if(!e!==d){var f=alp.gBCR(a.canvasNode),l=f.left;f=f.width;b=b.clientX;null!=l&&null!=f&&null!=b&&(l=Math.max(0,Math.min(1,(b-l)/f)),c.center.set(p.center_after_zoom_no_overflow(c.center.get(),
l,d,e)));a.mouseZoomEvt().triggerSoon()}}function f(b){if(d.dnd.is()){var e=null!=a._dragStartCenter?a._dragStartCenter:a._dragStartCenter=c.center.get(),f=c.zoom.get(),l=Math.pow(2,-1-f);b=Math.max(l,Math.min(1-l,e-b.dx/(a._dragNode.clientWidth*Math.pow(2,f))));if(1E-9<Math.abs(e-b))return c.center.setNow(b),a.mouseDragEvt().triggerSoon(),a._last_actual_drag_date=Date.now?Date.now():+new Date,b;a._last_actual_drag_date=null}}function l(){var b=d.clipping.m,e=b.low.getProp();b=b.high.getProp();var f=
Math.max(0,-Math.log(Math.max(1E-10,b-e))/Math.log(2));c.center.set((e+b)/2);c.zoom.set(f);a.mouseZoomEvt().triggerSoon()}function g(b){if(!d.dnd.is()&&c.mouseWithinCanvas.get()){b||(b=window.event);var e=alp.gBCR(a.canvasNode);b=(b.clientX-e.left)/e.width;var f=c.visible.get();e=f&&f.left;f=f&&f.right;alp.and([b,e,f],"alp.isFiniteNumber(v)")&&c.highlightD.set(e+b*(f-e))}}a.canvasNode.childNodes.a;b.push(alp.aEL(a.canvasNode,"click",alp.nowF(function(b){var d=a._last_actual_drop_date&&(Date.now?Date.now():
+new Date)-a._last_actual_drop_date;alp.isFiniteNumber(d)&&250>d||!(d=c.tpoiHighlightIdManual.get())||(alp.stopEvent(b),a.tpoiClickEvt().triggerSoon(d))})));b.push(alp.aEL(a.canvasNode,"dblclick",alp.nowF(function(a){a||(a=window.event);e(alp.mix(a,{wheelDelta:1}))})));b.push(alp.aEL(a.canvasNode,"mousewheel",alp.nowF(e)));b.push(alp.aELdblrightclick(a.canvasNode,alp.nowF(function(a){e(alp.mix(a||window.event,{wheelDelta:-1}))})));b.push(d.dnd.dragEvt().thenSoon(function(b){alp.setClass(a._dragNode,
a.draggedClass,!0)}));b.push(d.dnd.dragEvt().thenSoon(alp.ratelimitF(87,alp.nowF(f))));b.push(d.dnd.dropEvt().thenSoon(function(b){var c=null!=a._dragStartCenter;alp.setClass(a._dragNode,a.draggedClass,!1);f(b);a._dragStartCenter=null;c?(a.mouseDropEvt().triggerSoon(),a._last_actual_drop_date=a._last_actual_drag_date&&(Date.now?Date.now():+new Date)||null):a._last_actual_drop_date=null}));d.clipping&&b.push(d.clipping.mouseChangeEvt().then(l));b.push(alp.aEL(a.canvasNode,"mouseover",alp.nowF(function(a){c.mouseWithinCanvas.set(!0);
g(a)})));b.push(alp.aEL(a.canvasNode,"mousemove",alp.nowF(g)));b.push(alp.aEL(a.canvasNode,"mouseout",alp.nowF(function(){c.mouseWithinCanvas.set(!1)})));b.push(alp.touchFollow(2,a._dragNode,alp.nowF(function(b){if(b.isStart)m=c.zoom.get(),h=c.center.get(),n=alp.gBCR(a._dragNode);else{var d=b.tArr_start[0].x,e=b.tArr_start[1].x,f=b.tArr[0].x,l=b.tArr[1].x;b=m+Math.log(Math.abs(f-l)/(Math.abs(d-e)||1))/Math.log(2);d=Math.pow(2,-m)*((d+e)/2-(n.left+n.right)/2)/n.width;e=alp.gBCR(a._dragNode);f=h+d-
Math.pow(2,-b)*((f+l)/2-(e.left+e.right)/2)/e.width;0>b&&(b=0,f=.5);c.zoom.set(b);c.center.set(f);a.touchPinchEvt.triggerSoon()}})));var m,h,n},connectPureView:function(a,b,c,d){a.autoResize&&(a=alp.ratelimitF(127,alp.nowF(n),null,a),b.push(alp.aEL(window,"resize",a)),b.push(setInterval(a,57),clearInterval))}});var t="_elpro_update_view",w="_elpro_update_view_impl",x="_last_gr_size",y="_gr_resize_h"})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.elpro_view");
(function(){function k(){return this.m.tourPoiLayer.get()}function h(a){this.m.tourPoiLayer.setNow(a)}function g(b){function e(){function e(b){f.tourPoiLayer.is(l)&&(b=b.tour[0].geoJson,(b||0).substring.a,f.aggregate.set({tour:c.RoutedPolylineModel.fromGeoJSON(b,alp.oCreateMix(a,{elevation:g.elevation})),tourpoi:l.getTourPoiData()}))}if(f.tourPoiLayer.is(l)){var g=l.getTourData()[0];g&&(g.id||0).substring.a;g?g.isStagesTour?f.aggregate.set({tour:new c.MultiRPM(alp.map(g.stageTours,".geoJson"),alp.oCreateMix(a,
{data:g}))}):(f.aggregate.set(),(new d.GeometryOOIs([g.id],{proj:b.proj})).load(e)):f.aggregate.set()}}var f=b.m,l=f.tourPoiLayer.get();l?l.whenLoaded(e):f.aggregate.set()}function f(a){function b(){var b=a.m.tourPoiLayer.get();b=(b=b&&b.getTourData())&&1===b.length&&b[0].time;a._qf_update_duration_values(b&&6E4*b.min||g.duration_ms_st.get())}function c(){a._qf_update_elpro_summary_values(g.elevationSummary.get())}function d(){a._qf_update_tourLength_value(g.getLength())}var e=a[m]||(a[m]=new alp.Eh);
e.clear();alp.m(a[l],"disconnect");a[l]=null;var f=a.m.aggregate.get(),g=f&&f.tour;g&&(a[l]=new alp.x.Elpro({initNow:!0,polyModel:g,tourpoiModel:alp.partState(a.m.aggregate,"tourpoi"),canvasNode:a._elproCanvas_noli[0],heightNode:a._elproLegendHeight_noli[0],distanceNode:a._elproLegendDistance_noli[0],stageDistanceNode:a._elproLegendStageDistance_noli[0],clippingNode:a._elproClipping_noli[0],clippingLeft:a._elproClippingLeft_noli,clippingRight:a._elproClippingRight_noli}),b(),c(),d(),e.push(a.m.tourPoiLayer.change_cb(function(a){a&&
a.whenLoaded(d)})),e.push(g.duration_ms_st.change_cb(b)),e.push(g.elevationSummary.change_cb(c)),e.push(g.geomChangeEvt().thenSoon(d)),e.push(a.m.stageStartIcon.bind_to(a[l].m.stageStartIcon,{loose:!0})),e.push(a.m.i18n_stage.bind_to(a[l].m.i18n_stage)),e.push(a[l].tpoiClickEvt().then(function(b){alp.m(a.m.tourPoiLayer.get(),"triggerClickFromId",b)})),e.push(a[l].m.tpoiHighlightIdManual.change_cb(function(b,c){var d=a.m.tourPoiLayer.get();b?alp.m(d,"triggerMouseoverFromId",b):alp.m(d,"triggerMouseoutFromId",
c);alp.m(d,"setPoiBounceHighlight",b)})))}function e(a){function b(){alp.m(a[n],"disconnect");a[n]=null;var b=f.get(),d=a.m.aggregate.get(),g=d&&d.tour;d=a[l];b&&g&&d&&(a[n]=new c.SimpleHoverPoints({initNow:!0,simple:{map:b,model:g,_x_elpro:d,_factHighest_noli:a._factHighest_noli,_factLowest_noli:a._factLowest_noli,tourPoiLayer:e}}));b&&d&&(g=a[q]||(a[q]=new alp.Eh),g.clear(),c.controllers.link_map_bounds_and_elpro_bounds(g,b,d,{mapPadding:a.mapPadding}))}var d=a[r]||(a[r]=new alp.Eh);d.clear();alp.m(a[n],
"disconnect");a[n]=null;var e=a.m.tourPoiLayer.get(),f=alp.m(e,"getMapSt");f&&(d.push(f.change_cb(b)),d.push(a.m.aggregate.change_cb(b)),b())}var d=alp.data,b=alp._gmap2_3,c=b.digitize;alp.ensureCss(alp.cssBase()+"alp/x.css");b.x.setupElproView=function(a){function c(a){a=a.answer;a="ok"===a.status&&a.html;(a||null).substring.call.a;a=alp.aC(alp.cE("div",null,{"class":"oax_ep_open"}),alp.cE("div",null,{"class":"oax-ep-wrapper"},{innerHTML:a}));alp.style(alp.gEBCN("alp-tpwiz-activate-linref-toggle-button",
a),{display:"none"});alp.aC(e,a);d.done()}var d=alp.dfrd("setupElproView",{then:1}),e=a.top,f=new b.x.ElproView(a);alp.setClass(e,"oax",!0);if(e.childNodes.length)d.done(f);else{a=alp.sub("oax.ELPRO_MARKUP_JSONP_URL");if(!a)throw Error("setupElproView: OAX API mandatory!");alp.jsonp(a).then(c)}d.then(function(){f.init()});return d};alp.declare("alp._gmap2_3.x.ElproView",alp.x.AbstractController,null,b.x.ConstElpro,c.InterfaceSimpleQuickFacts,{top:null,proj:null,mapPadding:.1,geomLayer:null,augmentModel:function(a){a.tourPoiLayer=
new alp.State({init_value:this.geomLayer});a.aggregate=new alp.State;a.stageStartIcon=new alp.State;a.i18n_stage=new alp.StringState},setInitVal:function(a,b,c,d){alp.forEach("factAscent factDescent factHighest factLowest factDuration factDurationH factDurationM factLength elproCanvas elproLegendHeight elproLegendDistance elproLegendStageDistance elproClipping elproClippingLeft elproClippingRight".split(" "),function(b){a["_"+b+"_noli"]=alp.gEBCN(a[b],a.top)})},connectModel2Model:function(a,b,c,d){b.push(c.tourPoiLayer.change_cb_init(g,
null,a))},connectModel2View:function(a,b,c,d){b.push(c.aggregate.change_cb_init(f,null,a));b.push(c.tourPoiLayer.change_cb_init(e,null,a))},connectView2Model:function(a,b,c,d){b.push(c.tourPoiLayer.change_cb_init(function(){c.stageStartIcon.set(alp.opt(c.tourPoiLayer.get(),"stageStartIcon"))},null,a));b.push(c.tourPoiLayer.change_cb_init(function(){var a=c.tourPoiLayer.get();alp.m(alp.m(a,"_get_i18n_stage_dfrd"),"thenSoon",function(b){c.tourPoiLayer.is(a)&&c.i18n_stage.set(b)})},null,a));b.push(c.tourPoiLayer.change_cb_init(function(){function b(b){b=
b.id;var c=a[l]&&a[l].m.tpoiHighlightId;b&&c&&c.is(b)&&c.set()}function d(b){b=b.id;var c=a[l]&&a[l].m.tpoiHighlightId;b&&c&&c.set(b)}var e=a._tpl_v2m_eh();e.clear();var f=c.tourPoiLayer.get();f&&e.push(f.listen("poiMouseout",b)).push(f.listen("poiMouseover",d))},null,a))},getGeomLayer:k,setGeomLayer:h,getTourPoiLayer:k,setTourPoiLayer:h,_tpl_v2m_eh:alp.memM("_tpl_v2m_eh","new alp.Eh")});var a={preferManualElevationSummary:!0,readOnlyOptim:!0},m="_aggregate_eh",l="_x_elpro",r="_hover_and_bounds_eh",
n="_hover_x",q="_bounds_eh"})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.catmap");alp.sub("alp.data.api",null,!0).catmap=function(k){function h(e){if(e)if("category"in e)for(e=[].concat(e.category);e.length;)h(e.pop());else{var d=e.id,b=e.datatypes,c=[];d&&c.push(d);e.name===f&&c.push(f);for(b&&("string"===typeof b?c.push(b):c=c.concat(b));c.length;)g[c.pop()]=e}}var g={},f=alp.data.api.catmap.DEFAULT();h(k);return g};alp.data.api.catmap.DEFAULT=function(){return"default"};
"undefined"!==typeof dojo&&dojo.provide("alp.map");
(function(){function k(b){b&&null.not_supported_yet;this[d]=alp.mapany()}function h(){var b=[];this.forEach(function(c,a){b.push(a)});return b}function g(){var b=[];this.forEach(function(c,a){b.push(c)});return b}function f(){var b=[];this.forEach(function(c,a){b.push([a,c])});return b}var e="function"===typeof Map&&Map.prototype&&/\{\s*\[\s*native code\s*\]\s*\}/.test(""+Map)&&"function"===typeof Map.prototype.set;alp.Map=function(b){b&&null.not_supported_by_IE11;b=e?new Map:new k;b.keys||(b.keys=
h);b.values||(b.values=g);b.entries||(b.entries=f);return b};var d="_mapany";alp.mix(k.prototype,{has:function(b){return this[d].has(b)},get:function(b){return this[d].get(b)},set:function(b,c){this[d].setNow(b,c);return this},"delete":function(b){var c=this.has(b);c&&this[d].delNow(b);return c},forEach:function(b,c){var a=this;a[d].forEach(function(d,e){b.call(c,d,e,a)})}})})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.mapboxgl.util.draw_tour_geom");
(function(){alp.sub("alp.maps.mapboxgl",null,!0).draw_tour_geom=function(e){function d(){a.getSource(k)&&a.removeSource(k);a.getSource(h)&&a.removeSource(h);alp.m(alp.subDfrd(b),["to","then"],c)}function b(){var b=a.isStyleLoaded(),c=a.getSource(k),d=a.getSource(h);b&&(c&&a.removeSource(k),r&&d&&a.removeSource(h));return b&&!c}function c(){a.addSource(k,{type:g,data:{type:"FeatureCollection",features:[{type:"Feature",properties:{color:p},geometry:{type:"MultiLineString",coordinates:[m]}}]}});r&&a.addSource(h,
{type:g,data:{type:"FeatureCollection",features:[{type:"Feature",properties:{degrees:180,"marker-symbol":"startComb",text:""},geometry:{type:"Point",coordinates:m[0]}}]}});var b=r?/^(?:^|,)geojson(-markers)?(?:,|$)/:/^(?:^|,)geojson(?:,|$)/;a.getStyle().layers.filter(function(a){return b.test(a.metadata.groups.join(","))}).forEach(function(b){a.setLayoutProperty(b.id,"visibility","visible")});n.done()}var a=e.glmap,m=e.xyarr,l=e.style||{},r=e.withStartPoint,n=alp.dfrd("AMMGL_draw_tour_geom",{then:1});
f||(f=alp.Map());var q=a&&f.get(a);if(!(q&&alp.oEqual(m,q.xyarr)&&alp.oEqual(l,q.style)&&r===q.withStartPoint)){f.set(a,e);var p=l.color||l.strokeColor||"#ff0000";alp.m(alp.subDfrd(a.isStyleLoaded,a),["to","then"],d)}return n};var k="geojson",h="geojson-markers",g="geojson",f})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.layer.tour_poi_layer");alp.i18n.fetch("alp.all");
alp.gmap3(function(k){function h(a,d){if(d){d[0]||(d=[d]);var e=a[n]||(a[n]={}),f=a[q]||{};d=alp.arr2o(d);f=alp.oDelta(d,f);alp.forEach(f.del,"this[v].setMap( null )",e);alp.forEach(f.add,function(d){var f=this[d];if(f){if(!(d in e)){var l=c.ooi_geometry(f,{polyline:!0});l=b.xy2latlng(l&&l.polyline||[]);f=alp.mix(alp.oCreateMix({strokeColor:"#ff0000"},f.lineOptions),{path:l});e[d]=b.polylineGen(f)}e[d].setMap(a.getMap())}},d);a[q]=d}}function g(a){function c(a){e.hovering_st.get()&&(a||(a=window.event),
(a=b.fromContainerPixelToLatLng(f,new k.Point(a.clientX,a.clientY)))&&d.triggerEvent("polylineMousemove",{latLng:a}))}var d=this;a=d[u]||(d[u]=new alp.Eh);a.clear();var e=d._,f=e.map_st.get(),l=alp.m(f,"getDiv");l&&a.push(alp.aEL(l,"mousemove",c,!0))}function f(a){a.listen("markerClick",function(d){var e=a._.map_st.get();if(e){var f=c.ooi_geometry(d);f=b.xy2latlng(f);d=a.customIW.render(d);b.iwOpen(e,f,d)}})}function e(){var a=this._.map_st.get(),c=this[t]||(this[t]=new alp.Eh);c.clear();a&&(c.push(b.event("addListener")(a,
"maptypeid_changed",alp.bindF("_try_to_use_vector",this)),b.event("removeListener")),this._try_to_use_vector())}function d(){function a(a,e){function l(a){if(c===b._.map_st.get()&&d===alp.m(c,"getMapTypeId")&&g){var e=alp.map(g.path,"[v.lng(),v.lat()]"),f=alp.filterIn(alp.sub({color:"strokeColor",opacity:"strokeOpacity",weight:"strokeWeight"},g),"");m({glmap:a,xyarr:e,style:f,withStartPoint:!0})}}var g=a._oa_vt_cfg;e=g&&g.strokeOpacity;e=alp.isFiniteNumber(e)?e:1;var h=c&&alp.m(alp.oGet(c,"_.lf_baselayer"),
"get"),n=!(!h||!h.glmapDfrd);n=f&&n;var k=a.setOptions,p=a.setVisible;0<e&&(p||k)&&(p?a.setVisible(!n):k?a.setOptions({strokeOpacity:n?.001:e}):null.bug,n&&h.glmapDfrd().then(l))}var b=this,c=b._.map_st.get(),d=alp.m(c,"getMapTypeId"),e=c&&d&&c.mapTypes.get(d);e=e&&alp.oGet(e,["_alp_imtcfg_arr",0,"vector_mtcfg"]);var f=b.preferVector&&e&&e._enableVector&&"vector"===e.type;b._.tourView.ovForEach(a);(e=b._.dirarrowView)&&a(e,"dav");(e=b._.startPointView)&&e.ovForEach(a)}var b=alp._gmap2_3,c=alp.data,
a=alp.lang,m=alp.maps.mapboxgl.draw_tour_geom,l=alp.content,r=alp.i18n.fetch("alp.all");alp.declare("alp._gmap2_3.TourPoiLayer",b.AbstractEarthFlyable,alp.nowF(function(l,m){function n(a){var b=w.get();if(b){for(var c=!1,d=b.length;d--;){var e=b[d],f=e.stageTours;if(e.isStagesTour&&f)for(e=f.length;e--;){var l=f[e];l[p]||(l[p]=alp.tmpl(a,{i:1+e}),c=!0)}}c&&w.set(b)}}function k(a){r._poiMouseoverTourSt.setNow(a)}function q(a){r._poiMouseoverTourSt.is(a)&&r._poiMouseoverTourSt.setNow()}var r=this;alp.mixCheck(r,
m);a.deprecate(r,"allPoisActive","markersActive");a.deprecate(r,"poiMouseoverTourGeom","mouseoverTourGeom");a.deprecate(r,"alpIW","defaultIW");a.deprecate(r,"poiActiveCursor","markerActiveCursor");a.deprecate(r,"poiInactiveCursor","markerInactiveCursor");r.addEvent("poiClick");r.addEvent("poiMouseover");r.addEvent("poiMouseout");r.addEvent("markerClick");r.addEvent("markerMouseover");r.addEvent("markerMouseout");r.addEvent("polylineMousemove");r.addEvent("polylineMouseover");r.addEvent("polylineMouseout");
r.addEvent("stageClick");r.addEvent("stageMouseover");r.addEvent("stageMouseout");r.addEvent("iwSelect");r.proj||(console.error("alp._gmap2_3.TourPoiLayer: it STRONGLY advised to give a `proj` parameter (project key), so that the POI icons appear correctly."),setTimeout(function(){throw Error("alp._gmap2_3.TourPoiLayer: it STRONGLY advised to give a `proj` parameter (project key), so that the POI icons appear correctly.  ###no_sampling###");}));r.customIW&&(r.defaultIW=!1,r.customIW.loadingHTML||
(r.customIW.loadingHTML="Laden..."),f(r));var v=r._={tourPoiModel:new b.data.TourPoiModel,map_st:new alp.State,hovering_st:new alp.BoolState,poi_catmap_st:new alp.State,poiBounceHighlight_st:new alp.StringState,stageTourHighlight_st:new alp.StringState,poisVisible_st:new alp.BoolState({init_value:r.initShowPois})},w=v.tourPoiModel.tour_data_st(),t=v.tourPoiModel.poi_data_st();v.tourView=new b.view.Overlays({map:v.map_st,data:w,ovgen:alp.bindF("_tourViewOvGen",r)});r._get_i18n_stage_dfrd().thenSoon(function(a){w.change_cb_init(n,
null,a)});if(m=r._elproViewNode=alp.nodify(r.elproViewNode))r.elproAutoClass&&(m.className+=" "+r.elproAutoClass),r._elproViewDfrd=b.x.setupElproView({top:m,proj:r.proj,geomLayer:r});r.tourDirectionArrow&&(v.dirarrowView=new b.view.DirectionArrow({map_st:v.map_st,tour_data_st:w,arrowType:r.tourDirectionArrowType}),v.dirarrowView._oa_vt_cfg=!1);v.poiView=new b.view.Overlays({map:alp.andState([v.poisVisible_st,v.map_st],{filter:function(a){return a||null}}),data:function(){return v.poi_catmap_st.get()&&
t.get()},ovgen:alp.bindF("_poiViewOvGen",r)});v.startPointView=new b.view.Overlays({map:v.map_st,data:w,ovgen:alp.bindF("_startPointViewOvGen",r,"digitize_node_start",9998)});v.map_st.change_cb("_fit_bounds",r);v.tourPoiModel.change_cb("_fit_bounds",r);v.poi_catmap_st.change_cb("update",v.poiView);t.change_cb("update",v.poiView);r.showAllToursOnMap&&v.poiView.visibleDataSt.change_cb(alp.bindF(h,null,r));v.poiBounceHighlight_st.change_cb("_updatePoiBounceHighlightView",r);v.poiView.viewChangeEvt().then(alp.bindF("_updatePoiBounceHighlightView",
r));v.stageTourHighlight_st.change_cb_init("_updateStageTourHighlightView",r);r.defaultIW&&r._install_defaultIW();r.mouseoverTourGeom&&(r._poiMouseoverTourSt=new alp.State({is_same:function(a,b){return!a&&!b||a&&b&&a.id&&a.id===b.id}}),r._poiMouseoverTourSt.change_cb_init(function(){var a=r._poiMouseoverTourSt.get();h(r,a)}),r.listen("poiMouseover",k),r.listen("poiMouseout",q));v.map_st.change_cb_init(g,r);r._try_to_use_vector=alp.ratelimitF(123,d,r);v.map_st.change_cb_init(e,r);v.tourView.viewChangeEvt().then(alp.bindF("_try_to_use_vector",
r));v.startPointView.viewChangeEvt().then(alp.bindF("_try_to_use_vector",r));r.init(l);c.api_cat({project:r.proj||"default"}).thenSoon(function(a){v.poi_catmap_st.set(c.api.catmap(a))});r._updatePoiBounceHighlightView()}),{proj:null,tourStrokeColor:null,tourStrokeOpacity:.85,tourStrokeWeight:null,tourDirectionArrow:!0,tourDirectionArrowType:null,preferVector:!1,fitTourBounds:!0,fitPoiBounds:null,padding:.1,initShowPois:!0,markersActive:!1,allPoisActive:null,defaultIW:!1,alpIW:null,customIW:null,tourWaypointAsPoi:!1,
markerActiveCursor:null,markerInactiveCursor:"default",poiActiveCursor:null,poiInactiveCursor:null,mouseoverTourGeom:!1,poiMouseoverTourGeom:null,showAllToursOnMap:!1,stageLabelClass:alp.cfg.css.cssStageLabel,poiMarkerOpt:null,stageStartIcon:"digitize_node_start",elproViewNode:"oax-api-elpro",elproAutoClass:"alp-tpwiz-elpro-container alp-tpwiz-linref-edit-inactive",onPoiClick:null,onPoiMouseout:null,onPoiMouseover:null,onMarkerClick:null,onMarkerMouseout:null,onMarkerMouseover:null,onPolylineMouseout:null,
onPolylineMouseover:null,onStageClick:null,onStageMouseout:null,onStageMouseover:null,onIwSelect:null,init:function(a){a!==this._last_init_a&&(this._last_init_a=a,this._init_dfrd=alp.dfrd("TourPoiLayer init finished"),this._init_data(a))},whenLoaded:function(){alp.now("thenSoon",this._init_dfrd,alp.bindF.apply(alp,arguments))},getMap:function(){return this._.map_st.get()},getMapSt:function(){return this._.map_st},setMap:function(a){this._.map_st.setNow(a)},getData:function(){return{tours:this.getTourData()||
{},pois:this.getPoiData()||{},tour_poi:this.getTourPoiData()||{}}},getTourBounds:function(){return this._.tourPoiModel.getTourBounds()},getTourData:function(){return this._.tourPoiModel.getTourData()},hasTourData:function(){return 0<alp.opt(this.getTourData(),"length")},getPoiBounds:function(){return this._.tourPoiModel.getPoiBounds()},getPoiData:function(){return this._.tourPoiModel.getPoiData()},hasPoiData:function(){return 0<alp.opt(this.getPoiData(),"length")},getTourPoiData:function(){return this._.tourPoiModel.getTourPoiData()},
hasTourPoiData:function(){return!!this.getTourPoiData()},setHighlight:function(a){a||(a=null);this.setPoiBounceHighlight(a);this.setStageTourHighlight(a)},getPoiBounceHighlight:function(){return this._.poiBounceHighlight_st.get()},setPoiBounceHighlight:function(a){this._.poiBounceHighlight_st.setNow(a||null)},getPoisVisibility:function(){return this._.poisVisible_st.get()},setPoisVisibility:function(a){return this._.poisVisible_st.setNow(a)},getStageTourHighlight:function(){return this._.stageTourHighlight_st.get()},
setStageTourHighlight:function(a){this._.stageTourHighlight_st.setNow(a||null)},getBounds:function(){var a=this.fitTourBounds,b=this.fitPoiBounds;if(a||b||null===b){var c=new k.LatLngBounds;(a=a&&this._.tourPoiModel.getTourBounds())&&c.union(a);(a=(b||null===b&&!a)&&this._.tourPoiModel.getPoiBounds())&&c.union(a);return c}},getZoomCenter:function(a){return alp._gmap2_3.bounds2zoomcenter(this.getBounds(),a,{padding:this.padding})},triggerClickFromId:function(a){this._triggerGmapEventFromId(a,"click")},
triggerMouseoverFromId:function(a){this._triggerGmapEventFromId(a,"mouseover")},triggerMouseoutFromId:function(a){this._triggerGmapEventFromId(a,"mouseout")},showTour:function(a){a?this.triggerMouseoverFromId(a):(a=(a=this._poiMouseoverTourSt.get())&&a.id)&&this.triggerMouseoutFromId(a)},_triggerGmapEventFromId:function(a,c){var d=this;d.whenLoaded(function(){var e=d._.poiView.fetchOvFromId(a)||d._fetchStageOvFromId(a);e&&b.event("trigger")(e,c,alp.m(e,"getPosition"))})},_fetchStageOvFromId:function(a){},
_init_data:function(a,b){function d(a,c){c&&f._.tourPoiModel.setPoiArray(c);alp.m(b,"done")}function e(){(new c.SingleOOI(a,{proj:f.proj,acceptUnpublished:!0})).load(function(b){function d(a){function d(a){if(a=a&&alp.arrChain(alp.filter(alp.oValues(a),"v instanceof Array  &&  v[0].geometry"))){a=[].concat(a);for(var b=a.length;b--;){var c=alp.oGet(a[b],"meta.workflow.state");c&&(c=c.toLowerCase(),"deleted"!==c&&"waste"!==c||a.splice(b,1))}}f._.tourPoiModel.setPoiArray(a);w.done()}var l;l||(l=[]);
var p;if(h){for(p=m.length;p--;)(a=m[p])?(a=a.split(","),m[p]=[parseFloat(a[0]),parseFloat(a[1])]):m.splice(p,1);p=!!b.data.isStagesTour;p={coordinates:m,id:e,lineOptions:g,isStagesTour:p,stageTours:p&&b.data.stageTours};var q=b&&b.data;a=q&&q.time;q=q&&q.elevation;a&&(p.time=a);q&&(p.elevation=q);n&&(p.poiArr=n,p.poiObj=alp.arr2o(n));k.tour=p;p=alp.dfrd("TPL:tour_dfrd")}if(n||l){a=[];if(n)if("string"===typeof n[0])a=n;else for(a=[],q=n.length;q--;){var r=n[q],v=alp.oGet(r,"meta.workflow.state");
if(v&&(v=v.toLowerCase(),"deleted"===v||"waste"===v))continue;a.push(r.id)}l&&a.push.apply(a,l);if(a.length){var w=alp.dfrd("TPL:poi_dfrd");(new c.OOIs({idlist:a,proj:f.proj})).load(d)}}l=alp.gatherDfrd(alp.filter([p,w],""));alp.now("thenSoon",l,alp.bindF("done",f._init_dfrd));f._init_data(k,p||!1)}var e=b&&b.data&&b.data.id,l=b&&b.data&&b.data.geometry,g=b&&alp.sub("data.lineOptions",b),m=l&&l.split&&l.split(/\s+/),h=1<alp.opt(m,"length"),n=h?alp.sub("data.pois.poi",b):[b.data],k={};h&&f.tourWaypointAsPoi?
(new c.GeometryOOIs([a],{proj:f.proj})).load(d):d()})}var f=this;b||!1===b||(b=this._init_dfrd);if(null===a)f._.tourPoiModel.setPoiArray([]),alp.m(b,"done");else if("object"===typeof a&&"number"===typeof a.length&&"string"===typeof a[0])(new c.OOIs({idlist:a,proj:f.proj})).load(d);else{if("string"===typeof a){var l=alp.gEBI(a)||alp.gEBCN(a)[0];if(!l){e();return}a=l.value}a&&"null"!=a&&"undefined"!=a?(f._.tourPoiModel.set("string"===typeof a?alp.oFrom(a):a),alp.m(b,"done")):console.error("alp._gmap2_3.TourPoiLayer.constructor() could not extract any meaningful value from: "+
a)}},_tourViewOvGen:function(a){function c(a,c){a={path:b.xy2latlng(a),strokeColor:n,strokeOpacity:k,strokeWeight:q};var d=c&&c.label_text;c=c&&c.label_class;d&&(alp.oSet(a,"alp.placemark.name",d),alp.oSet(a,"alp.placemark.class",c));c=b.polylineGen(a);c._oa_vt_cfg=a;return c}function d(a,b){return{id:a.id,poly:c(alp.arrChain(alp.oFrom(a.geoJson).coordinates),{label_text:a[p],label_class:g.stageLabelClass})}}function e(b){g.triggerEvent("stageClick",alp.mix({},b,{stagesTourId:a.id}))}function f(b){g.triggerEvent("stageMouseout",
alp.mix({},b,{stagesTourId:a.id}))}function l(b){g.triggerEvent("stageMouseover",alp.mix({},b,{stagesTourId:a.id}))}var g=this,m=b.util.coord.tour(a),h=a.lineOptions||{},n=g.tourStrokeColor||h.strokeColor||"#ff0000",k=g.tourStrokeOpacity||h.strokeOpacity||1,q=g.tourStrokeWeight||h.strokeWeight||5;if(m)return a.isStagesTour?(m=new b.view.Multiline({arr:alp.map(a.stageTours,d),initNow:!0,highlight:!0,style_normal:{strokeWeight:q},style_highlight:{strokeWeight:2*q},stage_start_icon:!!g.stageStartIcon,
stage_start_icon_standard_name:g.stageStartIcon}),m.clickEvt().thenSoon(e),m.mouseoutEvt().thenSoon(f),m.mouseoverEvt().thenSoon(l)):m=c(m),b.event("addListener")(m,"mouseover",function(a){g.triggerEvent("polylineMouseover",a);g._.hovering_st.setNow(!0)}),b.event("addListener")(m,"mouseout",function(a){g._.hovering_st.setNow(!1);g.triggerEvent("polylineMouseout",a)}),m;console.error("alp._gmap2_3.TourPoiLayer tourViewOvGen(): could not create polyline for ovdata:",a)},_startPointViewOvGen:function(a,
c,d){if(!d.isStagesTour){var e=b.util.coord.tour(d);if(e)return a=b.marker_gen({position:b.xy2latlng(e[0]),zIndex:c},a),a._oa_vt_cfg=!1,a;console.error("alp._gmap2_3.TourPoiLayer _startPointViewOvGen(): could not create polyline for ovdata:",d)}},_poiViewOvGen:function(a){var d=this,e=d._.poi_catmap_st.get();if(e){var f=alp.oGet(a,"category.iconMapUrl"),l=alp.oGet(a,"category.id")||a.cat,g=f?alp.oGet(a,"category"):e[l]||e[c.api.catmap.DEFAULT()],m=c.ooi_geometry(a),h=a.url||d.markersActive,n=!d.hasTourData()&&
1===d.getPoiData().length;n=h||n?g.iconMapUrl:g.iconInactiveMapUrl;var p=(h?g.iconMapSize:g.iconInactiveMapSize)||alp.cfg.marker.caticon();g=new k.Size(p.width,p.height);p=null!==p.anchor_x&&null!==p.anchor_y&&new k.Point(p.anchor_x,p.anchor_y);m=alp.mix({clickable:!0,icon:b.markerImage_gen(n,g,null,p),position:new k.LatLng(m.lat,m.lng),title:a.name||a.title||""},d.poiMarkerOpt);if(n=h?d.markerActiveCursor:d.markerInactiveCursor)m.cursor=n;m=b.marker_gen(m);h&&(b.event("addListener")(m,"click",function(){d.triggerEvent("markerClick",
a);d.triggerEvent("poiClick",a)}),b.event("addListener")(m,"mouseout",function(){d.triggerEvent("markerMouseout",a);d.triggerEvent("poiMouseout",a)}),b.event("addListener")(m,"mouseover",function(){d.triggerEvent("markerMouseover",a);d.triggerEvent("poiMouseover",a)}));if(!f&&!e[l]){var q="alp._gmap2_3.TourPoiLayer: Watch out! Could not find POI category "+l+" in the category tree of project:"+this.proj+" (for POI id: "+alp.opt(a,"id")+" ). Falling back on default icon. ";console.error(q);setTimeout(function(){throw Error(q+
" ###no_sampling###");})}return m}},_fit_bounds:function(){var a=this.getMap();if(a){var c=this.getBounds();c&&!c.isEmpty()&&a.whenLoaded("set_bbox",b,a,c,this.padding)}},_install_defaultIW:function(){var a=this;a.listen("markerClick",alp.nowF(function(d){function e(){(new c.SingleOOI(d.id,{proj:a.proj})).load(f)}function f(b){a.triggerEvent("iwSelect",alp.mix(c.external_info(alp.opt(b,"data"))||{},{id:d.id}))}var g=c.ooi_geometry(d),m=a.getMap();m&&r.thenSoon(function(c){alp._gmap2_3.iwOpen(m,new k.LatLng(g.lat,
g.lng),c.ooi_iw_loading);b.iwOpenOOI(m,d.id,{proj:a.proj,onClick:alp.nowF(e)});a.proj&&d.id&&l.trackTeaser({id:d.id,proj:a.proj})})}))},_updatePoiBounceHighlightView:function(){var a=this[v],b=this._.poiBounceHighlight_st.get();!(!a&&!b||a&&b===a.id)&&(a&&(a.marker.setAnimation(),this[v]=null),a=b&&this._.poiView.fetchOvFromId(b))&&(this[v]={id:b,marker:a},a.setAnimation(k.Animation.BOUNCE))},_updateStageTourHighlightView:function(){var a=this._.stageTourHighlight_st.get();this._.tourView.ovForEach(function(b){alp.m(alp.oGet(b,
"m.mouseover"),"set",a||null)})},_get_i18n_stage_dfrd:alp.memF(function(){var a=alp.dfrd("TPL:i18n:stage",{then:1});r.then(function(b){a.triggerSoon(b&&b.stage||"stage (i18n missing)")});return a})});var n="_poi_id_2_mouseover_overlay",q="_poi_mouseover_overlay_id",p="_tour_line_label_text",v="_last_poi_bounced",u="_map_mousemove_eh",t="_map_eh"});"undefined"!==typeof dojo&&dojo.provide("alp.util.updater");
(function(){alp.declare("alp.util.Updater",null,function(){var k=arguments;k=k&&0<k.length&&k[k.length-1]||{};"object"===typeof k&&(this._updateInactive=k.init_inactive);this._updateHitch=alp.asyncF(0,"updateSync",this)},{isUpdateActive:function(){return!this._updateInactive},setUpdateActive:function(k,h,g){if(2>arguments.length)console.error('alp.util.Updater.setUpdateActive() requires at least 2 arguments "origin" and "enabled"');else{if(1<alp.sub("djConfig.isDebug")){var f=(Date.now?Date.now():
+new Date)/1E3;console.group("alp.util.Updater.setUpdateActive() - "+f);this._log_who("alp.util.Updater: setUpdateActive() start for",this,arguments)}f=!h;this._updateInactive!==f&&(this._updateInactive=f,h&&!g&&(1<alp.sub("djConfig.isDebug")&&console.log("alp.util.Updater: setUpdateActive( ...) calling this.update( origin ) for this:",this),this.update(k)));1<alp.sub("djConfig.isDebug")&&(this._log_who("alp.util.Updater: setUpdateActive() end for",this,arguments),console.groupEnd())}},update:function(k){if(1<
alp.sub("djConfig.isDebug")){var h=(Date.now?Date.now():+new Date)/1E3;console.group("alp.util.Updater.update() - "+h);this._log_who("alp.util.Updater.update():",this,arguments)}this._updateInactive||this._updateHitch.apply(this,arguments);1<alp.sub("djConfig.isDebug")&&console.groupEnd()},updateSync:alp.nowF(function(k){if(1<alp.sub("djConfig.isDebug")){var h=(Date.now?Date.now():+new Date)/1E3;console.group("alp.util.Updater.updateSync() - "+h);this._log_who("alp.util.Updater.updateSync():",this,
arguments);console.log("this._updateInactive:",this._updateInactive)}if(this._updateInactive)1<alp.sub("djConfig.isDebug")&&(console.log("alp.util.Updater.updateSync(): this._updateInactive - abort"),console.groupEnd());else{this.setUpdateActive(k,!1,!0);try{h=[];for(var g=1;g<arguments.length;g++)h.push(arguments[g]);this.updateImpl.apply(this,h)}finally{this.setUpdateActive(k,!0,!0)}1<alp.sub("djConfig.isDebug")&&(console.log("alp.util.Updater.updateSync() done."),console.groupEnd())}}),_log_who:function(k,
h,g){console.log(k,"origin + args:",g," - for "+(h&&h.declaredClass)+" this:",h)},updateImpl:function(){}})})();"undefined"!==typeof dojo&&dojo.provide("alp.data.quadtree");
(function(){var k,h,g,f={};alp.declare("alp.data.QuadTree",null,alp.nowF(function(e){if(!(!!e.get_xy^!!e.get_qt))throw Error("alp.data.QuadTree.constructor(): you must provide *either* `cfg.get_xy` or `cfg.get_qt`.");this.idset_st=new alp.PrimitiveSetState;alp.mixCheck(this,e);this._id2qt={};this._qt2idset=[];alp.util.add_sortedinsert(this._qt2idset,{compare_fun:function(d,b){return d[0]<b[0]?-1:1}});this.idset_st.change_cb("_update_idset",this)}),{get_xy:null,get_qt:function(e){return k(this.get_xy(e),
30)},idset_st:null,has:function(e){return e&&!!this._id2qt[e]},update:alp.nowF(function(e,d){var b=this._id2qt[e],c=this.get_qt(e);if(b!=c){b&&this._delete_id(e);if(c)if(this._id2qt[e]=c,b=this._searchqt(c)){if(!("first"in b&&"last"in b&&b.first===b.last))throw Error("alp.data.QuadTree is buggy #0.");this._qt2idset[b.first][1][e]=1}else b={},b[e]=1,this._qt2idset.sortedinsert([c,b]);d||this.change().triggerSoon()}}),search:function(e){var d=this._searchqt(e);e=this._qt2idset;var b=this._id2qt,c=[],
a=[];if(d){var g=d.first;for(d=d.last;g<=d;g++){var l=e[g][1],h;for(h in l)h in f||(c.push(h),a.push(b[h]))}}return{idlist:c,qtlist:a}},change:alp.memM("change",'alp.event("quadtree:change")'),_update_idset:function(){var e=!1,d=this.idset_st._get_no_clone()||{},b=this._last_idset||{},c;for(c in b)c in d||(this._delete_id(c),e=!0);for(c in d)c in b||(this.update(c,!0),e=!0);this._last_idset=d;e&&this.change().triggerSoon()},_delete_id:function(e){var d=this._id2qt[e];if(!d)throw Error("alp.data.QuadTree is buggy #1.");
delete this._id2qt[e];d=this._searchqt(d);if(!(d&&"first"in d&&"last"in d&&d.first===d.last))throw Error("alp.data.QuadTree is buggy #2.");var b=this._qt2idset[d.first][1];if(!(e in b))throw Error("alp.data.QuadTree is buggy #3.");delete b[e];alp.oIsEmpty(b)&&this._qt2idset.splice(d.first,1)},_searchqt:function(e){return this._searcher().search(e)},_searcher:function(){var e=this,d=new alp.util.SortedDataSearcher(function(){return e._qt2idset.length},function(b,c){b=e._qt2idset[b][0];var a=c.length;
b.length>a&&(b=b.substring(0,a));return b<c?-1:b>c?1:0});return(this._searcher=function(){return d})()}});alp.data.QuadTree.xy2qt=k=function(e,d){null==d&&(d=30);var b=1<<d;return h(e.x*b>>0,e.y*b>>0,d)};alp.data.QuadTree.ijz2qt=h=function(e,d,b){for(var c=Array(b);b--;)c[b]=113+((d&1)<<1)+(e&1),e>>=1,d>>=1;return String.fromCharCode.apply(String,c)};alp.data.QuadTree.qt2ijz=g=function(e,d,b){null==d&&(d=e.length);for(var c=0,a=0,f=0;f<d;f++){c<<=1;a<<=1;var l=e.charCodeAt(f)-113;c|=l&1;a|=l>>1&1}c=
{i:c,j:a,z:d};b&&(e=g(e.substring(d,d+b),b),c.subi=e.i,c.subj=e.j);return c}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.interface_cm_load_oois");(function(){alp._gmap2_3.InterfaceClusterModelLoadOOIs={load_OOIs:function(k,h){return(new alp.data.OOIs(alp.mix({idlist:k,proj:this.url_default_param.proj,language:this.cfg.language||alp.i18n.language(),acceptUnpublished:this.cfg.acceptUnpublished},h))).load_dfrd()}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.interface_cm_manualooi_model");
alp.gmap3(function(k){var h=alp.sub("alp._gmap2_3",null,!0),g=alp.sub("alp.data",null,!0),f=alp.sub("cluster",h,!0).MANUALOOI_CATID="manualooi";alp._gmap2_3.InterfaceClusterManualOOIModel={add_manual_oois:function(e,d){var b=this,c=alp.db.common();d&&alp.forIn(d,function(a,d){var e={};e[a.frontendtype]=[a];c._getset_unsafe(g.ooi_db_key(d,b.url_default_param.proj),e)});var a=e.length;for(d=Array(a);a--;){var f=e[a];d[a]="string"===typeof f?f:g.createCustomOOI(f)}this.manual_ooi_ids().addArray(d);return d},
remove_manual_oois:function(e){this.manual_ooi_ids().delArray(e)},get_manual_ooi_ids:function(){return this.manual_ooi_ids().getArray()},manual_ooi_ids:function(){function e(b,d){g.is_ooi_db_key(b)&&(a()?(b=(b=alp.data.single_ooi(d||c._getset_unsafe(b)))&&b.data&&b.data.id)&&f.has(b)&&f.update(b):alp.asyncF(789,e)(b,d))}var d=new alp.PrimitiveSetState,b=this,c=alp.db.common(),a=function(){return alp.m(b,"get_gproj")},f=new alp.data.QuadTree({get_xy:function(d){var e=c._getset_unsafe(g.ooi_db_key(d,
b.url_default_param.proj));(e=(e=e&&alp.data.single_ooi(e).data)&&e.id&&(e.id===d||alp.data.ooiid.is_external(d))&&alp.data.ooi_geometry(e))||console.error("cluster_manualooi_model: insufficient xy data for id:",d);e=e||{};"number"!==typeof e.lat&&(e.lat=-80);"number"!==typeof e.lng&&(e.lat=-159);if(e&&a())return h.fromLatLngToUnitPoint(a(),new k.LatLng(e.lat,e.lng))},idset_st:d});c.changeEvt().thenSoon(alp.ratelimitF(100,e));d.change_cb(function(a){f.idset_st.set(a)});f.change().bindEvent(b.change());
var l=this.manual_ooi_ids=function(){return d};l.qtree=f;return l()},get_manual_oois_in_tile:function(e,d,b){e=alp.data.QuadTree.ijz2qt(e,d,b);e=this._init().manual_ooi_ids.qtree.search(e);return this.get_manual_oois(e.idlist,e.qtlist)},get_manual_oois:function(e,d){for(var b=alp.db.common(),c=Array(e.length),a=c.length;a--;){var m=e[a],l=alp.data.single_ooi(b._getset_unsafe(g.ooi_db_key(m,this.url_default_param.proj)),m);l=c[a]=alp.oCreate(l.data);var h=l.category&&l.category.id;l.t||(l.t=f);l.id=
m;l.ismanualooi=!0;l.t_img=h;d&&(l.qt=d[a])}return c},_init:alp.nowF(function(){var e=this;e.manual_ooi_ids();return(e._init=function(){return e})()})}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit.const");(function(){var k=alp.sub("alp._gmap2_3.qt7bit",null,!0);k.NBITS=22;k.ID="id";k.CATID="catid";k.GEOM="geom";k.NCHUNKS="____nChunks____";k.NQTDATAPOINT="____nQTDataPoint____";k.FIRST="____first____";k.LAST="____last____";k.DATABBOX="____dataBbox____"})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit._core");
alp.gmap3(function(k){function h(a){a>>=0;return[a/7>>0,a%7]}function g(a){if("string"===typeof a)return g(c(a));var b=a[9]&1,d=b?"-":"";if(b){var e=a[0]^127;var f=a[1]^127;var l=a[2]^127;var m=a[3]^127;var h=a[4]^127;var n=a[5]^127;var k=a[6]^127;var p=a[7]^127;var q=a[8]^127}else e=a[0],f=a[1],l=a[2],m=a[3],h=a[4],n=a[5],k=a[6],p=a[7],q=a[8];a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];f=(e|0)+(f<<7)+(l<<14)+(m<<21)+((h&3)<<28)+1073741824*(((p&7)<<19)+(k<<12)+(n<<5)+(h>>2))+"";e=f.length;for(l=0;e--;)a[l++]=
f.charCodeAt(e)-48;f=(q<<4)+(p>>3);if(b||0!==f)for(p=f+f,q=p+f,e=p+p,f=e+f,l=e+p,m=e+q,h=e+f,a[0]+=l,a[1]+=h,a[2]+=e,a[4]+=m,a[5]+=q,a[6]+=m,a[7]+=p,a[8]+=l,a[9]+=h,a[10]+=h,a[11]+=f,a[12]+=q,a[14]+=f,a[15]+=e,b&&a[0]++,b=0,p=a.length,e=0;e<p;e++)q=a[e]+b,f=q%10,f===q?(b&&(a[e]=q),b=0):(b=(q-f)/10,a[e]=f);for(;1<a.length&&0===a[a.length-1];)a.pop();a.reverse();return d+a.join("")}function f(a){var b=a;if(b in f)return f[b];a=a.replace(/(^\s+|\s+$)/g,"");var c="-"===a.charAt(0);/^[\+\-]/.test(a)&&
(a=a.substring(1));a=C.from_str10(a);c&&C.sub1(a);for(var d=[].concat(E),e=0,l=0,g=1,m=0;63>m;m++){c^a[0]%2&&(d[e]|=g);6===l?(e++,l=0,g=1):(l++,g<<=1);for(var h=0,n=0;h||n<a.length;n++){h=5*(a[n]||0)+h;var k=h%10;a[n]=0>k?k+10:k;h=h/10>>0}a.shift()}c&&(d[9]|=1);Object.freeze&&Object.freeze(d);return f[b]=d}function e(a,b){return l(d(a,b))}function d(a,c){c||(c=z);a=x.fromLatLngToPixel(A(),a,c);return b({x:a.x/256>>0,y:a.y/256>>0},c)}function b(a,b){b||(b=z);var c=a.x;a=a.y;for(var d=[0],e=0,f=0,l=
1;b--;)a&1&&(d[e]|=l),a>>=1,f++,7===f?(d.push(0),e++,f=0,l=1):l<<=1,c&1&&(d[e]|=l),c>>=1,f++,7===f?(d.push(0),e++,f=0,l=1):l<<=1;return d}function c(a){for(var b=a.length,c=Array(b),d=b;d--;)c[d]=a.charCodeAt(b-1-d);return c}function a(b){b||(b=z);if(!(b in a)){for(var c=Array(Math.ceil(2*b/7)),d=c.length;d--;)c[d]=0;d=l(c);var e=v(c,b);a[b]={lat:e.lat(),lng:e.lng(),qt_arr:c,qt_str:d}}return a[b]}function m(b){b||(b=z);if(!(b in m)){var c=t(a(b).qt_arr,b),d=l(c),e=v(c,b);m[b]={lat:e.lat(),lng:e.lng(),
qt_arr:c,qt_str:d}}return m[b]}function l(a){for(var b=a.length,c=Array(b),d=b;d--;)c[d]=a[b-1-d];return String.fromCharCode.apply(String,c)}function r(a,b){if("string"===typeof a)return r(c(a),b);a=[].concat(a);a.reverse();return a.join(".")}function n(a,c){a=p(a);c=p(c);return b({x:a.x+c.x>>1,y:a.y+c.y>>1})}function q(a,b){a="string"===typeof a?c(a):a;b="string"===typeof b?c(b):b;for(var d=a.length,e=Array(d);d--;)e[d]=a[d]+b[d]>>1;return e}function p(a,b){b||(b=z);a:{if("string"===typeof a){var d=
b+".str:"+a;if(d in B){d=B[d];break a}a=c(a)}if(I){var e=b+".arr:["+a.join(",")+"]";if(e in B){d=B[e];break a}}for(var f=0,l=0,g=0,m=a[g],h=0,n=1;b--;)m&1&&(l|=n),m>>=1,h++,7===h&&(g++,m=a[g],h=0),m&1&&(f|=n),m>>=1,h++,7===h&&(g++,m=a[g],h=0),n<<=1;b=[f,l];d&&(B[d]=b);e&&(B[e]=b);d=b}return{x:d[0],y:d[1]}}function v(a,b){b||(b=z);a=p(a,b);return x.fromPixelToLatLng(A(),new k.Point(256*a.x,256*a.y),b)}function u(a,b){return"string"===typeof a?l(u(c(a),b)):w(a,1,b)}function t(a,b){return"string"===
typeof a?l(t(c(a),b)):w(a,-1,b)}function w(a,b,d){d=d||z;if("string"===typeof a)return l(w(c(a),b,d));a=[].concat(a);for(var e=a.length,f=0;f<e;f++){for(var g=Math.min(7,2*d-7*f),m=1<<g,h=a[f],n=(h+b)%m;0>n;)n+=m;b-=n-h;a[f]=n;b>>=g}return a}var x=alp.sub("alp._gmap2_3",null,!0),y=alp.sub("qt7bit",x,!0),z=y.NBITS;y.qt7bit_2_latlng=function(b,c){c||(c=z);b=p(b,c);var d=G[c];if(!d){d={nw:a(c),se:m(c)};d.lng_min=d.nw.lng;d.lng_span=d.se.lng-d.nw.lng;var e=p(d.se.qt_arr,c);d.x_max="x"in e?e.x:e[0];d.prop_den=
1<<z-1;d.half_pi=Math.PI/2;d.ratio=180/Math.PI;G[c]=d}return new k.LatLng((d.half_pi-2*Math.atan(Math.exp((-1+("y"in b?b.y:b[1])/d.prop_den)*Math.PI)))*d.ratio,d.lng_min+("x"in b?b.x:b[0])/d.x_max*d.lng_span)};y.qt7bit_2_tilexy=p;y.latlng_2_qt7bitstr=e;y.latlng_2_qt7bitarr=d;y.tilexy_2_qt7bitarr=b;y.tilexy_2_qt7bitstr=function(a,c){return l(b(a,c))};y.ORIG_NW=a;y.ORIG_SE=m;y.bitarr_2_bitstr=l;y.bitstr_2_bitarr=c;y.bitdotstr=r;y.geom_2_bitarr=function(a,b){if("string"===typeof a)return c(a);if(a instanceof
k.LatLng)var e=a;else if("lat"in a&&"lng"in a){var f=alp.fVal(a.lat);var l=alp.fVal(a.lng);alp.isFiniteNumber(f)&&alp.isFiniteNumber(l)&&(e=new k.LatLng(f,l))}return e?d(e,b||z):a};y.geom_2_bitstr=function(a,b){if("string"===typeof a)return a;if(a instanceof k.LatLng)var c=a;else if("lat"in a&&"lng"in a){var d=alp.fVal(a.lat);var f=alp.fVal(a.lng);alp.isFiniteNumber(d)&&alp.isFiniteNumber(f)&&(c=new k.LatLng(d,f))}return c?e(c,b||z):l(a)};y.geomiddle_str=function(a,b){return l(n.apply(null,arguments))};
y.geomiddle_arr=n;y.middle_str=function(a,b){return l(q.apply(null,arguments))};y.middle_arr=q;y.get_7bit=function(a,b){a=h(a);return!!(b[a[0]]&1<<a[1])};y.qt7bit_2_int64str10=g;y.int64str10_2_qt7bitstr=function(a){return l(f(a))};y.int64str10_2_qt7bitarr=f;y.set_7bitarr=function(a,b,c){c||(c=[]);var d=h(a);a=d[0];for(d=d[1];c.length<a+1;)c.push(0);c[a]=b?c[a]|1<<d:c[a]&~(1<<d);return c};y.bit_2_7bybi=h;y.qt7bit_plus_1=u;y.qt7bit_minus_1=t;y.qt7bit_sub=function(a,b,c){return w(a,-b,c)};y.qt7bit_add=
w;var A=alp.memF(function(){return new k.MercatorProjection(31)}),C=alp.util.math.arr10,E=alp.arrRep([0],10),G={},B={},I=!(alp.likeIE()&&alp.likeIE8minus_backslash_v())});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit");"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.abstract_cm_updater");
alp.gmap3(function(k){function h(e){var d=e.getCat(),b=e._flatmap_catName2Id={},c=e._flatmap_catId2Name={};alp.treeForEach(d,"children",function(a,d,e){d=d[a].name;b[d]=a;c[a]=d})}var g=alp._gmap2_3,f={};alp.declare("alp._gmap2_3.AbstractClusterModelUpdater",alp.util.Updater,null,alp.util.InterfaceWithInit,g.InterfaceClusterManualOOIModel,g.InterfaceClusterModelLoadOOIs,{load:null,_isloaded:null,url_default_param:null,_start_loading_clusters:function(){this._cluster_loading=!0;this.cluster_loading_starts().triggerSoon()},
_stop_loading_clusters:function(){this._cluster_loading=!1;this.cluster_loading_stops().triggerSoon()},_static:{},is_cluster_loading:function(){return!!this._cluster_loading},reset:function(){this._loaded={}},tour_shortinfo_map_fun:function(){return this._tour_shortinfo_map_fun=this._tour_shortinfo_map_fun||this.cfg&&this.cfg.tour_shortinfo_map_fun||alp.sub("alpConfig.cluster.tour_shortinfo_map_fun")},getCat:function(){return this.cfg.cat},catName2Id:function(e){this._flatmap_catName2Id||h(this);
return this._flatmap_catName2Id[e]},catId2Name:function(e){this._flatmap_catId2Name||h(this);return this._flatmap_catId2Name[e]},fromPixelToLatLng:function(e,d,b){return g.fromPixelToLatLng(this.get_gproj(),new k.Point(e,d),b)},fromLatLngToPixel:function(e,d,b){return g.fromLatLngToPixel(this.get_gproj(),new k.LatLng(e,d),b)},get_gproj:function(){return this._gproj},set_gproj:function(e){g.equalProjection(this._gproj,e)||(this._gproj=e,this.reset(),this._gproj&&this.mark_init_done())},tileint:function(e,
d,b){e=Math.floor(e/this.cfg.tile_size);for(b&&(e%=d);0>e;)e+=d;return e},tilediff:function(e,d,b){var c=(e-d)%b;e=(d-e)%b;return Math.min(Math.min(Math.abs(c),Math.abs(c+b)),Math.min(Math.abs(e),Math.abs(e+b)))},tile_subtile:function(e,d){var b=this.tileint(e.x,d,!0);d=this.tileint(e.y,d,!0);void 0===this._p_2_sub&&this._init_p_2_sub();var c=this.tileint(e.x*this._p_2_sub,this._p_2_sub,!0);e=this.tileint(e.y*this._p_2_sub,this._p_2_sub,!0);return{x:b,y:d,sub_x:c,sub_y:e}},tile_subtile_neighbor:function(e,
d,b,c,a,f,l){void 0===this._p_2_sub&&this._init_p_2_sub();return this.tile_subtile(new k.Point((e+(b+a)/this._p_2_sub)*this.cfg.tile_size,(d+(c+f)/this._p_2_sub)*this.cfg.tile_size),l)},_init_p_2_sub:function(){this._p_2_sub=1<<this.cfg.tile_sublevels},leveloffset:function(e){var d=this.cfg.level_offset;if("number"===typeof d)return d;var b=d.length;if(e>=b)return d[b-1];var c=d[e];"number"!==typeof c&&(c=d[b-1],console.error("alp._gmap2_3.AbstractClusterModelUpdater.leveloffset("+e+"): not found! Returning the last one in the config array: "+
c));return c},setLoadOpts:function(e){this._loadOpts=e;var d=this._last_loadOpts_str;this._last_loadOpts_str=e=alp.oToString(e);d!==e&&this.loadOptsChanged().triggerSoon()},updateImpl:function(e,d,b,c,a){var f=Math.pow(2,a);b<e&&(b+=f*this.cfg.tile_size);0>c&&(c=0);e=this.tileint(e,f);d=this.tileint(d,f);b=this.tileint(b,f);f=this.tileint(c,f);c=!1;e=[e,f,b,d];f=Math.pow(2,a);d=e[0];for(b=e[2];d<=b;d++)for(var l=d%f,g=e[1],h=e[3];g<=h;g++){var k=g%f;this._isloaded(l,k,a,a)||(k=this.load(l,k,a,a),
c||(c=k))}c&&!this.manual_ooi_ids().getArray().length||this._alreadyloaded()},_trigger_update_later:function(e){alp.asyncF(e||500,"_changed",this)()},_safe_substitute:function(e,d){d=alp.oCreate(d);for(var b in d)b in f||(null==d[b]&&(d[b]=""),0>e.indexOf(b)&&(e+="&"+b+"=${"+b+"}"));e=alp.tmpl(e,d,null,"").split("?");return e[0]+"?"+e[1].replace(/[^=&]+=&|[\?&][^=&]=$/g,"")},_idlist_str:function(e){return alp.map(e.idlist,alp.fVal).join(",")},change:alp.memM("change",'alp.event("AGC:CM:change")'),
alreadyloaded:alp.memM("alreadyloaded",'alp.event("AGC:CM:alreadyloaded")'),loadOptsChanged:alp.memM("loadOptsChanged",'alp.event("AGC:CM:loadOptsChanged")'),cluster_loading_starts:alp.memM("cluster_loading_starts",'alp.event("AGC:M:cluster_loading_starts")'),cluster_loading_stops:alp.memM("cluster_loading_stops",'alp.event("AGC:M:cluster_loading_stops")'),reset_evt:alp.memM("reset_evt",'alp.event("AGC:M:reset_evt")'),_changed:alp.nowF(function(){this.change().triggerSoon()}),_alreadyloaded:alp.nowF(function(){this.alreadyloaded().triggerSoon()})})});
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.interface_cm_getinfos");
alp.gmap3(function(){var k=alp._gmap2_3,h=k.qt7bit,g=k.cluster.MANUALOOI_CATID;alp._gmap2_3.InterfaceClusterModelGetInfos={getInfos:function(f,e,d,b,c,a){var g=1<<c;d<f&&(d+=g*this.cfg.tile_size);0>f&&(f=0);0>b&&(b=0);var l=this.tileint(f,g);f=this.tileint(e,g);var k=this.tileint(d,g),n=this.tileint(b,g);b={tile_sw_x:l,tile_sw_y:f,tile_ne_x:k,tile_ne_y:n};g=1<<c;d={};if(this._tree[c]||a){e=[];var q=l+k>>1,p=f+n>>1;if(alp.likeIE()&&alp.likeIE8minus_backslash_v())for(;l<=k;l++)for(var v=n,u=f;v<=u;v++)e.push([l,
v,h.tilexy_2_qt7bitstr({x:l,y:v},c)]);else for(;l<=k;l++)for(v=n,u=f;v<=u;v++)e.push([l,v,Math.max(Math.abs(l-q),Math.abs(v-p))]);e.sort(function(a,b){return a[2]<b[2]?-1:1});f=Date.now?Date.now():+new Date;l=0;for(n=e.length;l<n&&!(q=e[l][0]%g,p=e[l][1]%g,(k=this.getInfosTile(q,p,c,a))&&((d[q]||(d[q]={}))[p]=k),125<(Date.now?Date.now():+new Date)-f);l++);l<n&&this._trigger_update_later()}b.infos=d;return b},getInfosTile:function(f,e,d,b){var c=this.fetch_from_tree(f,e,d);if(b&&(f=this.get_manual_oois_in_tile(f,
e,d),e=f.length)){c=c&&alp.oCopy(c)||{};b=/^\s*\S+(\s|$)/;for(var a=0;a<e;a++){var m=f[a],l=alp.data.QuadTree.qt2ijz(m.qt,d,this.cfg.tile_sublevels),h=c[l.subi]||(c[l.subi]={});h=h[l.subj]||(h[l.subj]={});l=m.t||g;h=h[l]||(h[l]=[]);var n=m.geometry&&m.geometry.match(b)[0].split(",");h.push({c:1,lat:n?parseFloat(n[1]):m.lat||m.y,lng:n?parseFloat(n[0]):m.lng||m.x,qt:m.qt,t:l,t_img:m.t_img,title:m.title||"",id:m.id,ismanualooi:!0})}}return c},fetch_from_tree:null}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.interface_cm_single_ooi");
(function(){var k=alp.sub("alp._gmap2_3",null,!0),h=alp.data;k.InterfaceClusterModelSingleOOI={dbk:alp.memM("dbk","{ geometry: 'geometry', geometry_simplified: 'geometry_simplified' }"),_ooi_iw_url:function(g){g=alp.mapIn(alp.oCreateMix(this.url_default_param,g),alp.fVal);g.idlist&&(g.idlist=alp.map(g.idlist,alp.fVal));return this._safe_substitute(this.cfg.ooi_iw_url,g)},get_ooi_iw:function(g,f){function e(b){alp.jsonp(d._ooi_iw_url(b)).then(function(a,c){"object"===typeof a&&(a=a.html);(c=d.tour_shortinfo_map_fun())&&
(a=c(a));alp.isJsXd()&&d.cfg.xdomain_iw_fix&&(a=d.cfg.xdomain_iw_fix.call(d,a,b));f(a)})}var d=this,b=alp.fVal(g.id);g.ismanualooi?alp.m(alp.iw.htmlDfrd(this.cfg.proj,b),["then","to"],f):h.ooiid.is_external(b)?(new h.SingleOOI(b,{proj:this.url_default_param.proj,language:d.cfg.language||alp.i18n.language(),acceptUnpublished:d.cfg.acceptUnpublished})).load(function(b){e(alp.mix({},g,{id:b.data.id}))}):e(g)},_ooi_geometry_url:function(g){var f=this.cfg.ooi_geometry_url;return f&&this._safe_substitute(f,
alp.oCreateMix(this.url_default_param,{idlist:alp.fVal(g.id)||"",catid:g.catid||""}))},get_ooi_geometry:function(g,f){function e(a){a=alp.oGet(a,"dataPoint.catid");d(a?alp.oCreateMix(g,{catid:a}):g)}function d(a){var c=b._ooi_geometry_url(a);c&&alp.jsonp(c).then(function(b,c){(c=b&&b[a.id+""])?f(c):alp.sub("djConfig.debug")&&console.error('ClusterModel.get_ooi_geometry... Could not find id "'+a.id+'" in the received json:',b)})}var b=this,c=alp.db.common();var a=g.id+"."+b.dbk()[g&&g.simplified?"geometry_simplified":
"geometry"];c.has(a)?f(alp.mix(c.getset(a),{id:g.id})):g.catid?d(g):b.getDataPoint(g.id).thenSoon(e)}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.const");(function(){var k=alp.sub("alp._gmap2_3.cluster",null,!0);k.DEFAULT_noZoomInCountMax=alp.memF("10");k.DEFAULT_zoomInMaxLevel=alp.memF("14")})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit.interface_loader_all_ids");
(function(){function k(c){return c[b]||(c[b]=new alp.SetState({do_not_clone:!0}))}function h(b){var a=e.WORLD_SPAN();alp.now(g,null,b);b.isloaded(a)?f(b):b.load_all()}function g(b){function a(){f(b)}b._allIds_all_loaded_connected||(b.all_chunks_loaded().thenSoon(a),b.modifiedDataPoint().thenSoon(alp.asyncF(13,alp.ratelimitF(111,alp.nowF(a)))),b._allIds_all_loaded_connected=1)}function f(b){var a=k(b).get();if(0<a.length){var c=b.get(e.WORLD_SPAN(),!0);b=[];for(var f in c)c in d||(b=b.concat(c[f].get_all_ids()));
for(f=a.length;f--;)a[f].set([].concat(b))}}var e=alp.sub("alp._gmap2_3.qt7bit",null,!0),d={};e.InterfaceLoaderAllIds={allIds_listen:function(b){k(this).add(b);alp.asyncF(1,alp.nowF(h))(this)},allIds_drop:function(b){k(this).remove(b)}};var b="_allIds_listener_set_instance"})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit.datapoint");
(function(){var k=alp._gmap2_3.qt7bit,h=alp.data,g=k.ID,f=k.CATID,e=k.GEOM;k.dataPointFromDataObj=function(d,b){d=d.data||d;var c={},a=c[k.ID]=d.id,e=c[k.CATID]=d.category.id;c[k.GEOM]="object"===typeof b&&b||h.ooi_geometry(d);if(!e)throw Error("AGQ.dataPointFromDataObj: could not determine category of OOI "+a+". Please make sure that the OOI belongs to the project you used to fetch the OOI.");return new k.DataPoint(c)};alp.declare("alp._gmap2_3.qt7bit.DataPoint",null,function(d){if(!alp.and([g,f,
e],function(b){return b in d&&null!=d[b]}))throw Error("alp._gmap2_3.qt7bit.DataPoint() requires all 3 values `"+g+"`, `"+f+"` and `"+e+"`. Given: "+g+":"+d[g]+", "+f+":"+d[f]+" and "+e+":"+d[e]);this[g]=d[g];this[f]=d[f];this[e]=k.geom_2_bitstr(d[e])},{equals:function(d){return 0===this.compareTo(d)},compareTo:function(d){var b=this[e],c=d[e];if(b<c)return-1;if(b>c)return 1;b=this[g];c=d[g];if(b<c)return-1;if(b>c)return 1;b=this[f];d=d[f];return b<d?-1:b>d?1:0}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit.chunk_extend_bitidcache");
(function(){function k(d,b){var c=b.qt7bit_length,a=b.id_length,e=alp.dfrd("AGQ: chunk_extend_bitidcache: async_fill_bitidcache"),l={},h=d.cat_data,n=alp.oKeys(h),k=n.length,p=0,v=0,u=alp.nowF(function(){for(var b=Date.now?Date.now():+new Date,d=0;p<k;p++,v=0)for(var m=n[p],q=h[m].data;v<q.length;){var r=v+c,A=r+a,C=q.substring(v,r);r=q.substring(r,A);var E={};E[f]=m;E[g]=C;l[r]=E;v=A;if(!(++d&255)&&(A=(Date.now?Date.now():+new Date)-b,129<A))return setTimeout(u,90+A)}e.triggerSoon(l)});u();return e}
var h=alp._gmap2_3.qt7bit,g=h.GEOM,f=h.CATID,e=h.ID;h.chunk_extend_bitidcache=function(d,b){function c(a,b){var c=m[a];if(c){var d={};d[f]=c[f];d[g]=c[g];d[e]=b||h.qt7bit_2_int64str10(a);return new h.DataPoint(d)}}var a=alp.dfrd("AGQ: chunk_extend_bitidcache: ensure_id_cache");d.has_idcache=function(){return!!m};d.ensure_idcache=function(){if(l)return a;l=!0;k(d,b).thenSoon(function(b){m=b;a.triggerSoon(!0)});return a};d.get_byid=function(a){return c(h.int64str10_2_qt7bitstr(a),a)};d.get_bybitid=
c;return{insert_in_bitidcache:function(b,c,d){a.thenSoon(function(){var a={};a[f]=c;a[g]=d;m[b]=a})},remove_from_bitidcache:function(b){a.thenSoon(function(){delete m[b]})}};var m,l}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit.span");
alp.gmap3(function(k){var h=alp._gmap2_3.qt7bit,g=alp.util.math,f=180-1E-10;h.WORLD_SPAN=function(a){return new h.Span(h.ORIG_NW(a).qt_str,h.ORIG_SE(a).qt_str)};h.spanFromBounds=function(l){e||(e=h.ORIG_NW(),b=e.lat,c=e.lng,d=h.ORIG_SE(),a=d.lat,m=d.lng);var r=l.getSouthWest(),n=l.getNorthEast();l=r.lat();r=g.angleDelta(r.lng());r=r>f?-f:r;var q=n.lat();n=g.angleDelta(n.lng());var p=n<-f?f:n;n=h.latlng_2_qt7bitstr(new k.LatLng(Math.min(b,Math.max(l,q)),Math.max(c,Math.min(r,p))));l=h.latlng_2_qt7bitstr(new k.LatLng(Math.max(a,
Math.min(l,q)),Math.min(m,Math.max(r,p))));return new h.Span(n,l)};var e,d,b,c,a,m;alp.declare("alp._gmap2_3.qt7bit.Span",null,function(a,b){if("string"!==typeof a)throw Error("alp._gmap2_3.qt7bit.Span.ctor failure on qt7bit_from: must be a string");if("string"!==typeof b)throw Error("alp._gmap2_3.qt7bit.Span.ctor failure on qt7bit_to: must be a string");if(a.length!=b.length)throw Error("alp._gmap2_3.qt7bit.Span.ctor failure: qt7bit_from and qt7bit_to must have the same length");if(!(a<=b))throw Error("alp._gmap2_3.qt7bit.Span.ctor failure: qt7bit_from must be <= qt7bit_to");
this.from=a;this.to=b},{equals:function(a){return this.from===a.from&&this.to===a.to},intersection:function(a){var b=this.from,c=this.to,d=a.from;a=a.to;b=b>d?b:d;c=c<a?c:a;return b<=c?new h.Span(b,c):null},intersects:function(a){var b=this.from,c=this.to,d=a.from;a=a.to;return(b>d?b:d)<=(c<a?c:a)},is_a_single_point:function(){return this.from.length&&this.from===this.to},lessthan:function(a){var b=this.to;a=a.from;return b<a||b==a&&this.from<a},union_sup:function(a){return new h.Span(this.from<a.from?
this.from:a.from,this.to>a.to?this.to:a.to)},contains_one:function(a){return this.from<=a&&a<=this.to},from_latlng:function(){return h.qt7bit_2_latlng(this.from)},to_latlng:function(){return h.qt7bit_2_latlng(this.to)},from_arr:function(){return h.bitstr_2_bitarr(this.from)},to_arr:function(){return h.bitstr_2_bitarr(this.to)},from_dotstr:function(){return h.bitdotstr(this.from)},to_dotstr:function(){return h.bitdotstr(this.to)},from_int64str:function(){return h.qt7bit_2_int64str10(this.from)},to_int64str:function(){return h.qt7bit_2_int64str10(this.to)},
to_center:function(){return this.to_bounds().getCenter()},to_bounds:function(){var a=this.from_latlng(),b=this.to_latlng();return new k.LatLngBounds(new k.LatLng(b.lat(),Math.max(-f,a.lng())),new k.LatLng(a.lat(),Math.min(f,b.lng())))},toString:function(){return'alp._gmap2_3.qt7bit.Span(from:"'+this.from+'" ('+this.from_latlng()+'), to:"'+this.to+'" ('+this.to_latlng()+"))"}})});"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.bbox_of_gmbounds");
(function(){alp.sub("alp.maps",null,!0).bbox_of_gmBounds=function(k){var h=k.getSouthWest();k=k.getNorthEast();return[h.lng(),h.lat(),k.lng(),k.lat()]}})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.bbox_union");
(function(){function k(h,g,f,e){for(;g<h;)g+=360;for(;e<f;)e+=360;for(var d=h+360;f>d;)f-=360,e-=360;for(;f<h;)f+=360,e+=360;e<g||(g=e);e=g-h;-1E-10<e||null.bug;return{span:e,w:-180+(180+h%360)%360,e:-180+(180+g%360)%360}}alp.sub("alp.maps",null,!0).bbox_union=function(h,g){if(!h||!g)return h||g||null;var f=h[0],e=h[2],d=g[0],b=g[2],c=Math.max(h[3],g[3]);h=Math.min(h[1],g[1]);g=k(f,e,d,b);f=k(d,b,f,e);f=f.span<g.span?f:g;return[f.w,h,f.e,c]}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit.chunk_extend");
alp.gmap3(function(k){var h=alp._gmap2_3.qt7bit,g=alp.maps,f=h.ORIG_NW();h.ORIG_SE();var e=h.latlng_2_qt7bitstr(new k.LatLng(f.lat,0)),d=h.GEOM,b=h.CATID,c=h.ID;h.chunk_extend=function(a,f){function l(a,b,c,d,e){if(!(a in t))return null;a=t[a];return(a.searcher||(a.searcher=p(a))).search(b,c,d,e)}function m(a,b){function c(){return k||(k=c._alpId=h.qt7bit_2_int64str10(l[1]))}var d=t[a],e=d.decoded,f=e[b];if(f)return f;f=d.arr;var l=f[b];if(!l){var g=b*u,m=g+v,n=m+10;d=d.s;l=f[b]=[d.substring(g,m),
d.substring(m,n)]}return e[b]={catid:a,qt7bit:l[0],bitid:l[1],id:c};var k}function n(b){var c=a.cat_data[b],d=c.n;t[b]={catobj:c,n:d,s:c.data,arr:Array(d),decoded:Array(d),searcher:null}}function k(b,c){b=a.cat_data[b];if(!b)return 0;b=b.data;var d=0,e=b.length/u;if(c<b.substring(0,v))return 0;if(c>b.slice(-u,-10))return e;for(;5<e-d;){var f=e+d>>1,l=f*u;c<b.substring(l,l+v)?e=f:d=f}for(f=d*u;d<=e&&!(c<b.substring(f,f+v));d++,f+=u);return d}function p(a){var b=a.n,c=a.s,d=a.arr;a={};f&&(a.read_only_optim=
f,a.data_compare_fun=function(a,b){return a.lessthan(b)?-1:b.lessthan(a)?1:0});return new alp.util.SortedDataSearcher(b,function(a,b){var e=d[a];if(!e){e=a*u;var f=e+v,l=f+10;e=d[a]=[c.substring(e,f),c.substring(f,l)]}a=e[0];if(b.contains_one(a))return 0;if(a<b.from)return-1;if(a>b.to)return 1;throw Error("qt7bit_chunk_extend:_create_searcher():compare_fun(): found a bug!");},null,a)}if(a.no_data)throw Error("alp._gmap2_3.qt7bit.chunk_extend() needs a final chunk of data, not a summary chunk.");if(alp.and(["get_cat_span",
"search_span","decode_one"],function(b){return"function"===typeof a[b]}))return a;var v=a.qt_start.length,u=v+10;(function(){for(var b in a.cat_data)if(a.cat_data.hasOwnProperty(b)){b=a.cat_data[b];if(b.data.length!==b.n*u)throw Error("qt7bit_chunk_extend:_sanity_check(): inconsistency detected!");break}})();var t={};(function(){var b=a.cat_data,c;for(c in b)b.hasOwnProperty(c)&&n(c)})();a.add_datapoint=alp.nowF(function(e,f){var l=e[b];f=e[d];var m=e[c],p=k(l,f),q=0===a.n,r=a.cat_data[l];if(!r){if(a.cat_data[l])throw Error("chunk_extend: _create_cat("+
l+"): the chunk already has the category!");a.cat_data[l]={data:"",n:0};n(l);if(0!==p)throw Error("chunk_extend: _insert_in_cat() found a bug!");r=a.cat_data[l]}p*=u;var v=h.int64str10_2_qt7bitstr(m);r.data=r.data.substring(0,p)+f+v+r.data.substring(p);r.n++;a.n++;n(l);w.insert_in_bitidcache(v,l,f);x&&x.push(m);m=h.qt7bit_2_latlng(f);l=m.lat();m=m.lng();l=[m,l,m,l];q?(this.qt_first=this.qt_last=f,this.data_bbox=l):(f<this.qt_first&&(this.qt_first=f),f>this.qt_last&&(this.qt_last=f),this.data_bbox=
g.bbox_union(this.data_bbox,l));return{dataPoint:e}});a.decode_one=m;a.get_all_ids=function(){if(x)return x;var a=[],b=0,c;for(c in t)if(t.hasOwnProperty(c)){var d=t[c].n;for(a[b+d-1]=null;d--;)a[b++]=this.decode_one(c,d).id()}return x=a};a.get_cat_span=function(a){var b=t[a];if(!b)return null;if("span"in b)return b.span;var c=b.n;return 0<c?b.span=new h.Span(m(a,0).qt7bit,m(a,c-1).qt7bit):b.span=null};a.get_cat_span_refresh=function(a){var b=t[a];b&&"span"in b&&delete b.span;return this.get_cat_span(a)};
a.get_datapoint=function(a){var e=a[b],f=a[d],g=a[c];if(f=l(e,new h.Span(f,f)))for(var n=f.first,k=f.last;n<=k;n++)if(f=m(e,n),f.id()===g)return{dataPoint:a};return!1};a.remove_datapoint=alp.nowF(function(e,f){var g=e[b];f=e[d];var k=e[c],p=l(g,new h.Span(f,f));if(p)for(var q=this.qt_first,r=this.qt_last,t=p.first,y=p.last;t<=y;t++)if(p=m(g,t),p.id()===k){p=a.cat_data[g];y=t*u;t=(t+1)*u;var z=p.data.substring(y+v,t);w.remove_from_bitidcache(z);p.data=p.data.substring(0,y)+p.data.substring(t);p.n--;
a.n--;n(g);x&&x.splice(alp.lastIndexOf(x,k),1);(f<=q||f>=r)&&this.update_meta();return{dataPoint:e}}return!1});a.search_span=l;a.update_meta=function(){if(t){var a,b;for(f in t)if(t.hasOwnProperty(f)){var c=this.get_cat_span_refresh(f),d=c.to<e&&c;c=!d&&c;d&&(a=a?a.union_sup(d):d);c&&(b=b?b.union_sup(c):c)}if(a||b){var f=this.qt_start;d=this.qt_end;c=a.from;var l=b.to;(f>d||c>l||c<f||l>d)&&null.bug;this.qt_first=c;this.qt_last=l;a=a.to_bounds();b=b.to_bounds();this.data_bbox=g.bbox_union(g.bbox_of_gmBounds(a),
g.bbox_of_gmBounds(b))}else this.qt_first=this.qt_start,this.qt_last=this.qt_end,this.data_bbox=null}};var w=h.chunk_extend_bitidcache(a,{qt7bit_length:v,id_length:10});return a;var x}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit.dplist2chunk");
alp.gmap3(function(k){function h(h,k,p){function n(a,b){for(a=b.length;a--;){var c=b[a],d=c.id,e=c.category.id,h=g.ooi_geometry(c),n={};n[m]=d;n[l]=e;n[r]=h;e=new f.DataPoint(n);z.add_datapoint(e);c=d in A?A[d]:A[g.ooiid(g.external_info(c))];w[c]=e}z.update_meta();q.triggerSoon(x)}p=p&&p.acceptUnpublished;var q=alp.dfrd("AGQ: dplist2chunk",{then:1}),t={},w=[].concat(k),x={answer:t,request:{dataPointList:k},finalDataPointList:w},y=k.length;t[e]=1;t[d]=y;var z=t[b.qt_str]=f.chunk_extend({qt_start:c,
qt_end:a,qt_first:c,qt_last:a,n:0,chunk_ind:[0],cat_data:{}});t=[];for(var A={},C=0;C<y;C++){var E=k[C];"string"===typeof E?(t.push(E),A[E]=C):(z.add_datapoint(E),w[C]=E)}z.n=y;t.length?(new g.OOIs({proj:h,idlist:t,minimal:!0,acceptUnpublished:p})).load(n):(z.update_meta(),q.triggerSoon(x));return q}var g=alp.data,f=alp._gmap2_3.qt7bit,e=f.NCHUNKS,d=f.NQTDATAPOINT,b=f.ORIG_NW();k=f.ORIG_SE();var c=b.qt_str,a=k.qt_str,m=f.ID,l=f.CATID,r=f.GEOM;f.emptychunk=function(a){var b;alp.now(function(){h(a,
[]).then(function(a){b=a.answer[f.ORIG_NW().qt_str]})});b||null.bug;(b.qt_start||null).substring.call.a;return b};f.dplist2chunk=h});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit.loader_spandata_api_idsearch");
(function(){function k(g){function f(){p=[].concat(c._data_arr);v=p.length;u=!0;t=Date.now?Date.now():+new Date;d(0)}function e(a){var b=(Date.now?Date.now():+new Date)-t,c=m.call(arguments,1);87>b?a.apply(null,c):setTimeout(alp.nowF(function(){t=Date.now?Date.now():+new Date;a.apply(null,c)}),91+b)}function d(l){if(v!=c._data_arr.length)e(f);else if(l>=v)u?a.triggerSoon(!1):a.triggerSoon(null);else{var g=p[l],m=c._get_chunk_span_se(g);if(g.no_data||1>l&&n!==m.from||l>v-2&&q!==m.to||l<v-1&&h.qt7bit_plus_1(m.to)<
p[l+1].from)u=!1;g.no_data?e(d,l+1):g.has_idcache()?b(g,l):g.ensure_idcache().thenSoon(function(){t=Date.now?Date.now():+new Date;b(g,l)})}}function b(b,c){(b=b.get_bybitid(l))?a.triggerSoon({dataPoint:b}):e(d,c+1)}var c=this,a=alp.dfrd("AGQ: loader_spandata: async_fetch_byid",{then:1}),m=Array.prototype.slice,l=h.int64str10_2_qt7bitstr(g);g=h.ORIG_NW();var k=h.ORIG_SE(),n=g.qt_str,q=k.qt_str;alp.now(f);return a;var p,v,u,t}var h=alp._gmap2_3.qt7bit;h.loader_spandata_api_idsearch=function(){return{async_fetch_byid:k}}})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit.loader_spandata");
(function(){function k(b){return new g.Span(b.qt_start,b.qt_end)}function h(b){return{qt_start:b.from,qt_end:b.to}}var g=alp._gmap2_3.qt7bit,f=alp.maps,e=alp.util,d=g.GEOM,b={};alp.declare("alp._gmap2_3.qt7bit.LoaderSpanData",null,function(){function b(a,b){return{data_compare_fun:function(c,d){var e=c[a];c=c[b];var f=d[a];d=d[b];return c<f||c===f&&e<f?-1:d<e||d===e&&f<e?1:0}}}this._key2data={};var a=this._data_arr=[],d=b("qt_start","qt_end"),f={compare_fun:d.data_compare_fun};e.add_sortedsearch(a,
d);e.add_sortedinsert(a,f);var g=b("qt_first","qt_last").data_compare_fun;this._first_last_searcher=new e.SortedDataSearcher(function(){return a.length},function(b,c){return g(a[b],c)})},g.loader_spandata_api_idsearch(),function(){return{has_key:function(b){return b in this._key2data},delete_key:function(b){if(!this.has_key(b))throw Error("alp._gmap2_3.qt7bit.LoaderSpanData.delete_key(): key not found!");var a=this._key2data,c=a[b];delete a[b];b=this._data_arr;c=b.sortedsearch(c);if(null==c||c.first!==
c.last){var d="alp._gmap2_3.qt7bit.LoaderSpanData.delete_key() detected a bug! #1 There should one and only one span. `where`:"+alp.oToString(c);console.error(d);setTimeout(function(){throw Error(d);})}else c=c.first,c.toPrecision.call.a,b.splice(c,1)},set:function(b,a){(b||null).substring.call.a;b!==a.qt_start&&null.bug;var c=this.has_key(b),d=this._key2data;c&&d[b]===a||(c&&this.delete_key(b),d[b]=a,this._data_arr.sortedinsert(a))},get_meta_span_n:function(){var c,a,d=this._key2data,e=0,h;for(h in d)if(!(h in
b)){var n=d[h];e+=n.n;var k=n.qt_first,p=n.qt_last;n=n.data_bbox||null;if(c){k<c&&(c=k);p>a&&(a=p);var v=f.bbox_union(v,n)}else c=k,a=p,v=n}return c?{n:e,span:new g.Span(c,a),data_bbox:v||null}:null},get_datapoint:function(b){var a=b[d];a=new g.Span(a,a);a=this.get_span(a,!0);for(var c in a)if(a.hasOwnProperty(c)){var e=a[c];if(!e.no_data)return e.get_datapoint(b)}return null},remove_datapoint:function(b){var a=b[d];a=new g.Span(a,a);a=this.get_span(a,!0);for(var c in a)if(a.hasOwnProperty(c)){var e=
a[c];if(!e.no_data&&e.remove_datapoint(b))return}throw Error("alp._gmap2_3.qt7bit.LoaderSpanData.remove_datapoint(): did not find the datapoint!");},add_datapoint:function(b){var a=this.get_datapoint(b);if(null==a)return null;if(!1!==a)throw Error("alp._gmap2_3.qt7bit.LoaderSpanData.add_datapoint(): the datapoint already exists! This is forbidden. Please call remove_datapoint() first.");a=b[d];a=new g.Span(a,a);a=this.get_span(a,!0);for(var c in a)if(a.hasOwnProperty(c)){var e=a[c];if(!e.no_data&&
e.add_datapoint(b))return!0}throw Error("alp._gmap2_3.qt7bit.LoaderSpanData.add_datapoint(): found a bug! The safety checks were not enough.");},get_span:function(b,a){var c=this._data_arr,d=a?"qt_start":"qt_first",e=a?c.sortedsearch(h(b)):this._first_last_searcher.search({qt_first:b.from,qt_last:b.to});b={};if(null!=e)for(a=e.first,e=e.last;a<=e;a++){var f=c[a],g=f[d];(g||null).substring.call.a;b[g]=f}return b},intersection_list:function(b,a){var c=this._data_arr;b=b._data_arr;for(var d=[],e=c.length;e--;){var f=
c[e],g=k(f);f=f.chunk_ind;for(var h=1<f.length&&alp.arr2oSimple(f),v=null,u=b.length;u--;){var t=b[u],w=k(t);t=t.chunk_ind;if(!(1<t.length)){var x=g.intersection(w);if(x&&(!a||!x.is_a_single_point())){w={intersection:x,this_start_end:g,this_chunk_ind:f,other_start_end:w,other_chunk_ind:t};var y;v&&h&&f===v.this_chunk_ind&&1===t.length&&alp.and(y=v.other_chunk_ind.concat(t),"v in this",h)?(v.other_start_end=v.other_start_end.union_sup(w.other_start_end),v.other_chunk_ind=y,v.intersection=g.intersection(v.other_start_end)):
d.push(v=w)}}}}return d},intersects_span:function(b){return!!this._darr.sortedsearch(h(b))},contains_span:function(b){var a=this._data_arr,c=a.sortedsearch(h(b));if(null==c)return!1;var d=a[c.first],e=a[c.last];if(!(d.qt_start<=b.from&&b.to<=e.qt_end)||e.chunk_ind-d.chunk_ind!==c.last-c.first)return!1;b=[];for(d=c.first;c<=c.last;c++)b.push(a[d].chunk_ind);d=1;for(a=b.length;d<=a;d++)if(b[d]!=1+b[d-1])throw Error("alp._gmap2_3.qt7bit.LoaderSpanData: contains_span() detected a bug!");return!0},_get_chunk_span_se:k}}())})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.qt7bit.loader");
alp.gmap3(function(k){function h(a,b){return alp.tmpl(alp.fVal(a.cm2_chunk_url),{chunk_ind:b,proj:a.proj})}function g(a,b){var c=a.intersection_list(b,!0),d=b.intersection_list(a,!0);a=a.intersection_list(a,!0);b=b.intersection_list(b,!0);c=c.concat(d).concat(a).concat(b);for(d=c.length;d--;)if(b=c[d],b.this_chunk_ind.join("#")===b.other_chunk_ind.join("#")&&!b.this_start_end.equals(b.other_start_end))return!0;return!1}function f(a){var b={},c;for(c in a)if(!(c in q)){var d=a[c],e=d.summaryItems,
f=e&&e.length;if(1<f){for(var l=alp.mapIn(d.cat_data,".n"),g=alp.oCreate(l),m=Array(f),h=d.n;f--;)m[f]=e[f].n/h;for(f=e.length;f--;){h=alp.oCreateMix(d,e[f]);var n=h.cat_data={},k=h.n;k.toPrecision.call.a;for(h.ctype="summary";0<k;)for(var p in g)if(!(p in q)){var r=Math.min(k,g[p],Math.ceil(m[f]*l[p]));0<r&&(n[p]={n:r},k-=r,g[p]-=r)}0===k||null.bug;b[h.qt_start]=h}alp.andIn(g,"===0")||null.bug}else b[c]=d}return b}var e=alp.data,d=alp._gmap2_3.qt7bit,b=alp.maps,c=d.NCHUNKS,a=d.NQTDATAPOINT,m=d.FIRST,
l=d.LAST,r=d.DATABBOX,n={},q={};n[a]=1;n[m]=1;n[l]=1;n[r]=1;alp.declare("alp._gmap2_3.qt7bit.Loader",null,alp.nowF(function(b){var c=this;alp.mix(c,alp.filterIn(b||{},alp.f("!=null")));c._dataPointList=c.initDataPointList;c.isloading_st=new alp.BoolState;c.cluster_meta_st||(c.cluster_meta_st=new alp.ObjectState);c._auto_preferred_bounds_st=new alp.State;alp.ratelimitM(-3E3,"_load_preferred_bounds",c);c._auto_preferred_bounds_st.change_cb("_load_preferred_bounds",c);c.modifiedDataPoint().thenSoon(alp.ratelimitF(189,
alp.nowF(function(){var b=c.getMetaSpanN(),d=alp.oCreate(c.cluster_meta_st.get()||{});if(b){var e=b.n,f=b.span,g=f.from,h=f.to,n=f.from_latlng(),k=n.lat();n=n.lng();var p=f.to_latlng();f=p.lat();p=p.lng();d[m]=g;d[l]=h;d[r]=b.data_bbox||[n,f,p,k];d[a]=e}else d[a]=0;c.cluster_meta_st.set(d)})));c._reset()}),d.InterfaceLoaderAllIds,{initDataPointList:null,cm2_url:"http://192.168.80.128:8080/cgi-bin/clusmod2/c_serve_chunk.py?from=${qt7bit_from}&to=${qt7bit_to}&proj=${proj}",cm2_chunk_url:"http://192.168.80.128:8080/cgi-bin/clusmod2/c_serve_chunk.py?chunk_ind=${chunk_ind}&proj=${proj}",
proj:null,xdomain:null,nbits:d.NBITS,read_only_optim:!0,cluster_meta_st:null,manual_preferred_bounds_st:null,reset_on_inconsistency:!1,acceptUnpublished:!1,isloading_st:null,isloaded:function(a){return this._fulldata.contains_span(a)},reset:alp.nowF(function(){this._reset();this.changed().triggerSoon()}),get:function(a,b){return alp.oCreateMix(this._summary.get_span(a,b),this._fulldata.get_span(a,b))},getMetaSpanN:function(){var a=this._fulldata.get_meta_span_n(),c=this._summary.get_meta_span_n();
return a&&c&&a.n&&a.s?{span:a.span.union_sup(c.span),n:a.n+c.n,data_bbox:b.bbox_union(a.data_bbox,c.data_bbox)}:a||c||null},getResetCount:function(){return this._reset_count|0},load_all:function(){this.load(d.WORLD_SPAN())},load:function(a){console.log("alp._gmap2_3.qt7bit.Loader.load("+a+") starts.");this._update_auto_preferred_bounds_with(a);return!this.isloaded(a)},_update_auto_preferred_bounds_with:function(a){var b=this._auto_preferred_bounds_st,c=b.get(),d=this._update_auto_preferred_bounds_last_date;
a=alp.m(a,"to_bounds");var e=Date.now?Date.now():+new Date;this._update_auto_preferred_bounds_last_date=e;if(alp.and([c,d,a,e])){d=.9*Math.max(0,-.01+Math.exp(-.008*(e-d)));e=1-d;var f=c.getSouthWest();c=c.getNorthEast();var l=a.getSouthWest();a=a.getNorthEast();f=new k.LatLng(e*l.lat()+d*f.lat(),e*l.lng()+d*f.lng());a=new k.LatLng(e*a.lat()+d*c.lat(),e*a.lng()+d*c.lng());b.set(new k.LatLngBounds(f,a))}else b.set(a)},_load_preferred_bounds:alp.nowF(function(){var a=this._auto_preferred_bounds_st.get();
if(a&&(a=d.spanFromBounds(a),!this.isloaded(a))){var b=this._dataPointList;b?this._first_reset_with_dplist(b):(a=alp.tmpl(alp.fVal(this.cm2_url),{qt7bit_from:a.from_int64str(),qt7bit_to:a.to_int64str(),proj:this.proj}),b=alp.fVal(this.cm2_url_getInputMeta),this._load(a,b))}}),_first_reset_with_dplist:function(a){this._first_reset_with_dplist_done||this.reset_with_dplist(a)},reset_with_dplist:function(a){function b(){alp.gatherDfrd(alp.map(a,"this.getDataPoint(v)",e)).thenSoon(c)}function c(a){h.then(function(){m===
e._reset_count&&f.triggerSoon(alp.arrChain(alp.reduce(a,"w=w[0], w && v.push(w.dataPoint), v",[])))})}this._dataPointList=a;var e=this;e._first_reset_with_dplist_done=!0;var f=alp.dfrd("AGQ Loader: reset_with_dplist",{then:1});if(!a)return e._reset(),f.done(),e._load_preferred_bounds(),f;a=[].concat(a);for(var l=a.length;l--;){var g=a[l];"string"===typeof g||g instanceof d.DataPoint||(a[l]=new d.DataPoint(g))}e._reset();var m=e._reset_count,h=d.dplist2chunk(e.proj,[]);h.then(function(c){if(m===e._reset_count){e._receive(e._reset_count,
null,c);e.changed().triggerSoon();c=alp.map(a,"this.addDataPoint(v)",e);var d=alp.gatherDfrd(c);d.thenSoon(b);for(var f=alp.ratelimitF(771,alp.nowF(function(){m===e._reset_count&&(e.changed().triggerSoon(),d.triggered()&&e.reset_done().triggerSoon())})),l=c.length;l--;)c[l].thenSoon(f)}});return f},load_chunk_dfrd:function(a){var b=h(this,a),c=this._load_xhr_cache[b];c||(this.load_chunk(a),c=this._load_xhr_cache[b]);return c},load_chunk:function(a){console.log("alp._gmap2_3.qt7bit.Loader.load_chunk("+
a+")");if(!alp.isInteger(a))throw Error("alp._gmap2_3.qt7bit.Loader.load_chunk(): chunk_ind must be an integer!");if(this._is_chunk_loaded[a])return!1;a=h(this,a);var b=alp.fVal(this.cm2_url_getInputMeta);return!!this._load(a,b)},getNChunks_dfrd:function(){return this._nChunks_dfrd||(this._nChunks_dfrd=alp.subDfrd("_nChunks",this,{test_fun:"!= null"}))},getNChunks_cb:function(a){this.getNChunks_dfrd().then(alp.bindF.apply(alp,arguments))},changed:alp.memM("changed",'alp.event("QT7Bit:Loader: changed")'),
alreadyloaded:alp.memM("alreadyloaded",'alp.event("QT7Bit:Loader: alreadyloaded")'),all_chunks_loaded:alp.memM("all_chunks_loaded",'alp.event("QT7Bit:Loader: all_chunks_loaded")'),modifiedDataPoint:alp.memM("modifiedDataPoint",'alp.event("QT7Bit:Loader: modifiedDataPoint")'),reset_done:alp.memM("reset_done",'alp.event("QT7Bit:Loader: reset_done")'),getDataPoint:alp.nowF(function(a){return"string"===typeof a?this._async_fetch_byid(a):this._async_fetch_bydatapoint(a instanceof d.DataPoint?a:new d.DataPoint(a))}),
getDataPointArray:alp.nowF(function(a){var b=alp.dfrd("AGQ: Loader: getDataPointArray",{then:1});alp.gatherDfrd(alp.map(a,this.getDataPoint,this)).thenSoon(function(a){b.triggerSoon(alp.map(a,"v[0].dataPoint"))});return b}),removeDataPoint:alp.nowF(function(a){var b=alp.dfrd("AGQ: Loader: removeDataPoint",{then:1}),c=this;c.getDataPoint(a).thenSoon(function(a){var d=!1;a&&(a=a.dataPoint,c._sync_remove_datapoint(a),c.modifiedDataPoint().triggerSoon(d={oldDataPoint:a}));b.triggerSoon(d)});return b}),
addDataPoint:alp.nowF(function(a){function b(a,b){a?f._async_add_datapoint(d.dataPointFromDataObj(a,b),c):c.done(null)}var c=alp.dfrd("AGQ: Loader: addDataPoint",{then:1}),f=this;f.getDataPoint(a).thenSoon(function(l){l?c.triggerSoon(!1):"string"===typeof a?(new e.SingleOOI(a,{proj:f.proj,minimal:!0,acceptUnpublished:f.acceptUnpublished})).load(b):f._async_add_datapoint(a instanceof d.DataPoint?a:new d.DataPoint(a),c)});return c}),_reset:function(){this._is_chunk_loaded={};this._queue={};this._reset_count=
(this._reset_count>>0)+1;delete this._nChunks;delete this._nChunks_dfrd;this._fulldata=new d.LoaderSpanData;this._summary=new d.LoaderSpanData;this.isloading_st.set(!1);this.reset_done().triggerSoon()},_load:function(a,b){var c=this,d=c._load_xhr_cache||(c._load_xhr_cache={}),e=d[a];if(e)return e.then(function(a){c._receive(c._reset_count,b,a,null)}),!1;c.isloading_st.set(!0);(d[a]=alp.jsonp(a)).then(alp.bindF("_receive",c,c._reset_count,b));return!0},_receive:alp.nowF(function(a,b,e){function l(a,
b){if(b===c)if("number"!==typeof a)console.error("alp._gmap2_3.qt7bit.Loader._receive(): `nChunks` must be a number! Received a "+typeof a+": ",a);else if(null==m._nChunks)m._nChunks=a;else{if(m._nChunks!=a){var e="alp._gmap2_3.qt7bit.Loader._receive(): inconsistent `nChunks`! Current: "+m._nChunks+",  received: "+a;console.error(e);setTimeout(function(){throw Error(e);});m._nChunks=a}}else if(b in n)r[b]=a;else if("summaryItems"!==b&&!(h.has_key(b)||a.no_data&&k.has_key(b))){if(a.no_data)k.set(b,
a);else{if(h.has_key(b))return;h.set(b,d.chunk_extend(a,m.read_only_optim));k.has_key(b)&&k.delete_key(b);if(v=g(h,k))return;if(null==a.chunk_ind[0])throw Error("alp._gmap2_3.qt7bit.Loader._receive(): chunk_ind must be an integer!");m._is_chunk_loaded[a.chunk_ind[0]]=!0}p=!0}}var m=this;if(m._reset_count===a){e=this._parse_response(e);console.log("alp._gmap2_3.qt7bit.Loader_receive:",e);a=alp.oCreateMix(e,{answer:f(e.answer)});var h=m._fulldata,k=m._summary,p=!1,r=b?{inputMeta:alp.oCopy(b)}:{};if(a&&
a.answer&&a.request){var v=!1;b=a.answer;if(0===b[c]){var u=d.emptychunk(m.proj);h.set(u.qt_start,u);m._nChunks=1;p=!0}else for(u in b)if(!(b in q)&&(l(b[u],u),e=m.reset_on_inconsistency,v&&!m._inconsistency_has_already_reset_once)){m._inconsistency_has_already_reset_once=!0;var G="alp._gmap2_3.qt7bit.Loader._receive(): inconsistency detected between `fulldata` and `summary`. Most likely we landed in the middle of browser cache expiration (see also Alpstein#8108)."+(e?" Resetting and reloading everything.":
" Leaving it as is.")+" (reset_on_inconsistency: "+e+")";console.error(G);setTimeout(function(){throw Error(G);});if(e){m.reset();return}}p?m.changed().triggerSoon():m.alreadyloaded().triggerSoon();m._update_queue(a);m.cluster_meta_st.set(r)}else console.error("alp._gmap2_3.qt7bit.Loader._receive():  invalid response:",a)}}),_update_queue:function(a){var b=this,e=b._queue;alp.f(".lat()");alp.f(".lng()");var f=a.answer[c]||b._nChunks;alp.forIn(a.answer,function(a,c){/^(___+)[^_]+\1$/.test(c)||"summaryItems"===
c||alp.forEach(a.chunk_ind,function(c){a.no_data&&!b._is_chunk_loaded[c]?e[c]=[a.qt_first,a.qt_last]:c in e&&delete e[c]})});var l=[];alp.forIn(e,function(a,b){l.push([a,b])});if(l.length){a=alp.m(b.manual_preferred_bounds_st,"get")||b._auto_preferred_bounds_st.get();var g=d.spanFromBounds(a);a=alp.filter(l,function(a){return a[0][0]<=g.to&&a[0][1]>=g.from});1>a.length?b.isloading_st.set(!1):(a=alp.map(a,function(a){return a[1]|0}),a.sort(),b.load_chunk(a[a.length>>1]))}else{b.isloading_st.set(!1);
for(a=f;a--;)if(!b._is_chunk_loaded[a]){b.load(d.WORLD_SPAN());return}b.all_chunks_loaded().triggerSoon()}},_parse_response:function(a){return"string"===typeof a?alp.oFrom(a):a},_async_fetch_bydatapoint:function(a){var b=alp.dfrd("AGQ: Loader: _async_fetch_bydatapoint",{then:1});a=this._try_to_fetch_gen(a,b);null==a()&&this.changed().thenSoon(a);return b},_try_to_fetch_gen:function(a,b){function c(){var e=d._fulldata.get_datapoint(a);null!=e&&(d.changed().dropSoon(c),b.triggerSoon(e));return e}var d=
this;return c},_sync_remove_datapoint:function(a){this._fulldata.remove_datapoint(a)},_async_add_datapoint:function(a,b,c){a=this._try_to_add_gen(a,b,c);null==a()&&this.changed().thenSoon(a)},_try_to_add_gen:function(a,b,c){function d(){if(f)return alp.now(function(){e.changed().dropSoon(d)}),f;f=e._fulldata.add_datapoint(a);if(null!=f){alp.now(function(){e.changed().dropSoon(d)});var l=alp.oCreateMix(c||{},{dataPoint:a});e.modifiedDataPoint().triggerSoon(l);b.triggerSoon(l)}return f}var e=this;return d;
var f},_async_fetch_byid:function(a){function b(){l._fulldata.async_fetch_byid(a).thenSoon(c)}function c(a){null!=a?f.triggerSoon(a):l.getNChunks_cb(d)}function d(a){for(;a--;)if(!(l._is_chunk_loaded[a]||a in g)){g[a]=1;l.load_chunk_dfrd(a).thenSoon(b);break}}var f=alp.dfrd("AGQ: Loader: _async_fetch_byid",{then:1}),l=this,g={};e.ooiid.is_external(a)?(new e.SingleOOI(a,{proj:l.proj,minimal:!0})).load(function(c){a=c.data.id;l.getNChunks_cb(b)}):l.getNChunks_cb(b);return f}})});
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.cluster_model");
alp.gmap3(function(k){var h=alp._gmap2_3,g=alp.util,f=g.math,e=h.cluster,d=e.DEFAULT_noZoomInCountMax(),b=e.DEFAULT_zoomInMaxLevel(),c=h.qt7bit,a=c.ID,m=c.CATID,l=c.GEOM,r={},n=alp.declare("alp._gmap2_3.ClusterModel",h.AbstractClusterModelUpdater,alp.nowF(function(a){function b(a){return g.test(a)?a:f+a}function d(a,c){var d=a[c];a[c]=function(){return b(d.apply(e,arguments))}}var e=this;e.url_default_param={proj:"",id:""};"string"===typeof a.proj&&(e.url_default_param.proj=a.proj);var f=a.base_url||
alp.sub("alpConfig.base_href")||document.baseURI||"/";"/"!==f.slice(-1)&&(f+="/");var l=/_url$/,g=/^(\/|https?:\/\/)/,m;for(m in a)m in r||!l.test(m.toLowerCase())||("string"===typeof a[m]?a[m]=b(a[m]):"function"===typeof a[m]&&d(a,m));e.cfg=alp.mix({language:alp.i18n.language(),google_min_zoom_level:0,retryCountMax:5,retryDelayMs:250,tile_sublevels:2,max_requested_urls:1E3,v:"1",manualOnly:!1,initDataPointList:null,xdomain:null,xdomain_iw_fix_remove_links:!0,xdomain_iw_fix:function(a,b){alp.iw.ensure_css();
var c=/(<img\s+([^<>]+\s+)?src\s*=\s*(['"](?!http)))([^'"]+)\3/gi;a=a.replace(c,"$1http://www.outdooractive.com$4$3");c=/(a\s+([^<>]+\s+)?href\s*=\s*(['"](?!http)))([^'"]+)\3/gi;a=a.replace(c,"$1http://www.outdooractive.com$4$3");e.cfg.xdomain_iw_fix_remove_links&&(c=/<\s*\\?\s*a[^<>]+>/gi,a=a.replace(c,""));0>a.indexOf(h.IW_CLASS())&&b&&b.id&&(a='<div class="'+h.IW_CLASS()+'">'+a+'<input type="hidden" name="id-value" value="'+alp.fVal(b.id)+'"></div>');return a}},a);e._tree={};e._loaded={};e._requested_urls=
[];e._changed=alp.ratelimitF(alp.likeIE8minus_backslash_v()?750:391,"_changed",e);e._alreadyloaded=alp.ratelimitF(50,"_alreadyloaded",e);e.cfg.tile_sublevels=alp.likeIE8minus_backslash_v()?1:2;e.cfg.proto&&(e.cfg.cm2_url="http://192.168.80.128:8080/cgi-bin/clusmod2/c_serve_chunk.py?from=${qt7bit_from}&to=${qt7bit_to}&proj=${proj}",e.cfg.cm2_chunk_url="http://192.168.80.128:8080/cgi-bin/clusmod2/c_serve_chunk.py?chunk_ind=${chunk_ind}&proj=${proj}",e.cfg.ooi_iw_url="http://192.168.80.128:8080/cgi-bin/clusmod2/d_serve_iw.py?idlist=${id}&proj=${proj}");
e.cfg=alp.oCreateMix({search_depth_merge:2,search_depth_extract:0},e.cfg);e.cfg.cluster_meta_st||(e.cfg.cluster_meta_st=new alp.ObjectState);e.manual_preferred_bounds_st=e.cfg.manual_preferred_bounds_st||(e.cfg.manual_preferred_bounds_st=new alp.State);e._dataPointIcon={};e._dataPointUnmergeable={};e._dataPointUnmergeable_per_cat_arr={};e._dataPointUnmergeable_per_cat_span={};e._dataPointUnmergeable_n=0;e.updateVisibleIds_st=new alp.BoolState({init_value:!1});e.updateAllIds_st=new alp.BoolState({init_value:!1});
e.allIds_st=new alp.SortedArrayState({init_value:null});e._qt7bitloader=new c.Loader(alp.opt(e.cfg,"proj initDataPointList cm2_url cm2_url_getInputMeta cm2_chunk_url cm2_chunk_url_getInputMeta xdomain nbits cluster_meta_st manual_preferred_bounds_st acceptUnpublished".split(" ")));e.updateVisibleIds_st.change_v_cb(!0,"clearAllClusters",e);e.updateAllIds_st.change_v_cb(!0,"_update_all_ids_later",e);e.updateAllIds_st.change_v_cb(!1,"_forget_all_ids",e);e._qt7bitloader.changed().thenSoon(alp.bindF("_changed",
e,e));e._qt7bitloader.alreadyloaded().thenSoon(alp.bindF("_alreadyloaded",e,e));e._qt7bitloader.reset_done().thenSoon(alp.bindF("clearAllClusters",e));a=e._qt7bitloader.isloading_st;a.change_v_cb(!0,function(){e._start_loading_clusters()});a.change_v_cb(!1,function(){e._stop_loading_clusters()})}),h.InterfaceClusterModelGetInfos,h.InterfaceClusterModelSingleOOI,{default_tile_sublevels:1,updateVisibleIds_st:null,updateAllIds_st:null,allIds_st:null,cluster_meta_st:null,manual_preferred_bounds_st:null,
mix_cfg:function(a){alp.mix(this.cfg,a);this._qt7bitloader.mix_cfg(a);this.reset()},reset:function(){n.parent.prototype.reset.apply(this,arguments);this._tree2={};this._qt7bitloader.reset();this._changed(this);this._update_all_ids_later();this.reset_evt().triggerSoon()},getResetCount:function(){return alp.m(this._qt7bitloader,"getResetCount")|0},getDataPoint:function(){return this._qt7bitloader.getDataPoint.apply(this._qt7bitloader,arguments)},getDataPointArray:function(){return this._qt7bitloader.getDataPointArray.apply(this._qt7bitloader,
arguments)},removeDataPoint:function(){this._ensure_on_modifiedDataPoint();var a=this._qt7bitloader.removeDataPoint.apply(this._qt7bitloader,arguments);a.then(alp.bindF("_update_all_ids_later",this));return a},addDataPoint:function(){this._ensure_on_modifiedDataPoint();var a=this._qt7bitloader.addDataPoint.apply(this._qt7bitloader,arguments);a.then(alp.bindF("_update_all_ids_later",this));return a},setDataPointList:function(a){var b="_last_datapointlist"in this,c=b?this._last_datapointlist:this.initDataPointList;
this._last_datapointlist=a;if(b&&(!c&&!a||c&&a&&alp.oEqual(c,a)))return b=alp.dfrd("CM:setDataPointList: unchanged",{then:1}),b.done(),b;this._ensure_on_modifiedDataPoint();b=this._qt7bitloader.reset_with_dplist.apply(this._qt7bitloader,arguments);b.then(alp.bindF("_update_all_ids_later",this));return b},setDataPointIcon:function(b,d){var e=this;e.getDataPoint(b).then(function(f){if(f=f&&f.dataPoint){var g=c.int64str10_2_qt7bitstr(f[a]);e._dataPointIcon[g]="function"===typeof d?d:function(){return d};
e.clearClusterAtPoint(f[l])}else console.error("alp._gmap2_3.ClusterModel.setDataPointIcon("+b+", ... ) could not find the datapoint.")})},unsetDataPointIcon:function(b){var d=this;d.getDataPoint(b).then(function(e){if(e=e&&e.dataPoint){var f=c.int64str10_2_qt7bitstr(e[a]);delete d._dataPointIcon[f];d.clearClusterAtPoint(e[l])}else console.error("alp._gmap2_3.ClusterModel.unsetDataPointIcon("+b+") could not find the datapoint.")})},setDataPointUnmergeable:function(b,d){var e=this;e.getDataPoint(b).then(function(f){if(f=
f&&f.dataPoint){var g=c.int64str10_2_qt7bitstr(f[a]),m=!!d;!!e._dataPointUnmergeable[g]!=m&&(m?e._add_to_unmergeable(f,g):e._remove_from_unmergeable(f,g),e.clearClusterAtPoint(f[l]))}else console.error("alp._gmap2_3.ClusterModel.setDataPointUnmergeable("+b+", "+d+") could not find the datapoint.")})},clearAllClusters:function(){this._tree2={};this._changed(this)},clearClusterAtPoint:function(a){var b=this._tree2;if(b){var d=c.NBITS,e=c.qt7bit_2_tilexy(a,d);a=e.x;e=e.y;for(var f;-1<d;d--,a>>=1,e>>=
1)if((f=b[d])&&(f=f[a])&&e in f){delete f[e];var l=!0}}l&&this._changed(this)},load:function(a,b,c,d,e){console.log("alp._gmap2_3.ClusterModel loading bk_x bk_y bk_z zoom:",a,b,c,d);a=this._bk_2_qt7bit(a,b,c,d);(a=this._qt7bitloader.load(a))||this._alreadyloaded(this);return a},_isloaded:function(a,b,c,d){return this.cfg.manualOnly?!0:this._qt7bitloader.isloaded(this._bk_2_qt7bit(a,b,c,d))},_bk_2_qt7bit:function(a,b,d,e){e=this._qt7bitloader.nbits;d=e-d;a=c.tilexy_2_qt7bitarr({x:a<<d,y:b<<d},e);b=
[].concat(a);if(0<d)for(d*=2;d--;)b[d/7>>0]|=1<<d%7;return new c.Span(c.bitarr_2_bitstr(a),c.bitarr_2_bitstr(b))},_add_to_unmergeable:function(b,c){function d(b,c){return b[a]-c[a]}if(c in this._dataPointUnmergeable)throw Error("alp._gmap2_3.ClusterModel._add_to_unmergeable() found a bug!");if(this._dataPointUnmergeable[c]!==b){this._dataPointUnmergeable_n++;this._dataPointUnmergeable[c]=b;c=b[m];var e=this._dataPointUnmergeable_per_cat_arr,f=e[c];f||(f=e[c]=[],g.add_sortedinsert(f,{compare_fun:d}),
g.add_sortedsearch(f,{data_compare_fun:d}));f.sortedinsert(b);this._update_unmergeable_cat_span(c)}},_update_unmergeable_cat_span:function(a){var b=alp.map(this._dataPointUnmergeable_per_cat_arr[a],'v["'+l+'"]');b.sort();this._dataPointUnmergeable_per_cat_span[a]=new c.Span(b[0],b[b.length-1])},_remove_from_unmergeable:function(a,b){if(!(b in this._dataPointUnmergeable))throw Error("alp._gmap2_3.ClusterModel._remove_from_unmergeable() found a bug!");this._dataPointUnmergeable_n--;delete this._dataPointUnmergeable[b];
b=a[m];var c=this._dataPointUnmergeable_per_cat_arr,d=this._dataPointUnmergeable_per_cat_span,e=c[b];a=e.sortedsearch(a);if(!a||a.first!==a.last||!alp.isInteger(a.first))throw Error("alp._gmap2_3.ClusterModel._remove_from_unmergeable() found a bug when searching! "+(a&&a.first)+" "+(a&&a.last));a=a.first;if(!(-1<a))throw Error("alp._gmap2_3.ClusterModel._remove_from_unmergeable() found a bug in index!");e.splice(a,1);0<e.length?this._update_unmergeable_cat_span(b):(delete c[b],delete d[b])},fetch_from_tree:function(a,
b,d){var e=this._tree2||(this._tree2={});if(e=alp.oGet(e,[d,a,b]))return e;var f=Math.min(c.NBITS-1,d+this.cfg.search_depth_merge);if(f<d)throw Error("cluster_model_2._get_clusters(): bug! zoom must be <= from_z_max.");for(var l=d+1;l<=f;l++)if(e=this._merge_clusters(a,b,d,l))return e;f=Math.min(c.NBITS-1,d+this.cfg.search_depth_extract);if(d<f)return this._merge_clusters(a,b,d,f,!0);a=this._get_clusters_from_qt7bit(a,b,d);return a.finaldata||a.summarydata},_merge_clusters:function(a,c,e,l,g){var m=
this._tree2,h=alp.oGet(m,[e,a,c]),n=this.updateVisibleIds_st.get();if(h)return h;var k=l-e,q=1<<k,p=m[l]||(m[l]={}),r=a<<k,v=r+q,t=c<<k;q=t+q;for(var u=[],L=!0;r<v;r++)for(var J=t;J<q;J++){var P=alp.oGet(p,[r,J]);if(P)u.push(P);else{if(!g)return null;P=this._get_clusters_from_qt7bit(r,J,l);var H=P.finaldata;H?u.push(H):(u.push(P.summarydata),L=!1)}}h={};var F=(1<<this.cfg.tile_sublevels)-1;alp.forEach(u,function(a){var c;for(c in a)if(a.hasOwnProperty(c)){var l=a[c];for(var g in l)if(l.hasOwnProperty(g)){var m=
l[g];for(var q in m)if(m.hasOwnProperty(q)){var p=m[q];for(var r=0,v=p.length;r<v;r++){var t=p[r];var w=t.tx>>k,x=t.ty>>k,u=w&F,y=x&F;u=h[u]||(h[u]={});y=u[y]||(u[y]={});y=y[q]||(y[q]=[]);if(!y.length||t.isUnmergeable||y.length&&y[0].isUnmergeable)w={c:t.c,t:q,lat:t.lat,lng:t.lng,tx:w,ty:x},t.idlist&&(w.idlist=n?alp.map(t.idlist,'"string"===typeof v ? v : v._alpId||v()'):t.idlist),t.iconFun&&(w.iconFun=t.iconFun),t.isUnmergeable&&(w.isUnmergeable=t.isUnmergeable),y.push(w);else if(w=y[0],alp.likeIE()?
(x=(w.lat+t.lat)/2,y=(w.lng+t.lng)/2):(y=[w.lng,t.lng],u=[w.c,t.c],x=f.angleWmean([w.lat,t.lat],u),y=f.angleWmean(y,u)),w.c+=t.c,w.lat=x,w.lng=y,n||!(e<b&&w.c>d)&&w.idlist&&t.idlist)w.idlist=w.idlist.concat(t.idlist),n&&(w.idlist=alp.map(w.idlist,'"string"===typeof v ? v : v._alpId||v()'))}}}}});L&&alp.oSet(m,[e,a,c],h);return h},_get_clusters_from_qt7bit:function(a,e,f){function l(a){var b=c.qt7bit_2_latlng(a,B);a=c.qt7bit_2_tilexy(a,B);var d=a.x>>B-I,e=a.y>>B-I;return{latlng:b,tilexy:a,zx:a.x>>
B-f,zy:a.y>>B-f,tx:d,ty:e,subx:P&d,suby:P&e}}function g(a){var b=l(a.qt7bit),c=a.bitid,d={c:1,id:a.id,idlist:[r?alp.fVal(a.id):a.id]};c in h._dataPointIcon&&(d.iconFun=h._dataPointIcon[c]);c in h._dataPointUnmergeable&&(d.isUnmergeable=!!h._dataPointUnmergeable[c]);m(b,a.catid,d)}function m(b,c,d){if(b.zx===a&&b.zy===e){var f={t:c,lat:b.latlng.lat(),lng:b.latlng.lng(),qt:function(){return alp.data.QuadTree.ijz2qt(b.tx,b.ty,I)},tx:b.tx,ty:b.ty};for(l in d)d.hasOwnProperty(l)&&(f[l]=d[l]);var l=b.subx;
d=b.suby;l=p[l]||(p[l]={});d=l[d]||(l[d]={});(d[c]||(d[c]=[])).push(f)}}var h=this,n=h._tree2,q=[f,a,e],p=alp.oGet(n,q),r=h.updateVisibleIds_st.get();if(p)return{finaldata:p};p={};for(var v=h._bk_2_qt7bit(a,e,f,f),G=h._qt7bitloader.get(v),B=h._qt7bitloader.nbits,I=Math.min(B,f+h.cfg.tile_sublevels),L=I-f,J=1<<L,P=J-1,H=[],F=0;F<J;F++)for(var D=0;D<J;D++){var M={subx:F,suby:D,tx:(a<<L)+F,ty:(e<<L)+D};M.qt7bit_span=h._bk_2_qt7bit(M.tx,M.ty,I,I);H.push(M)}H.sort(function(a,b){return a.qt7bit_span.lessthan(b.qt7bit_span)?
1:-1});var R=h._isloaded(a,e,f,f),S=Date.now?Date.now():+new Date;alp.forIn(G,function(a,e){var n=a.qt_last;if(v.intersects(new c.Span(e,n))){var q=a.centroid;e=q?c.latlng_2_qt7bitstr(new k.LatLng(q.lat,q.lng)):c.middle_str(e,n);n=l(e);e=a.cat_data;if(a.no_data){R=!1;for(var p in e)e.hasOwnProperty(p)&&m(n,p,{c:a.cat_data[p].n,from_summary:!0})}else for(p in e)if(e.hasOwnProperty(p)){n=p;if((q=a.get_cat_span(n))&&v.intersects(q)){var t=a.search_span(n,v);if(t){q=t.first;for(var w=t.last,x=H.length;x--;){var u=
H[x];if(t=a.search_span(n,u.qt7bit_span,q,w,!0)){var y=t.first;t=t.last;q=t+1;if(y==t){var z=a.decode_one(n,y);u.qt7bit_span.contains_one(z.qt7bit)&&g(z)}else if(y<t){var G=a.decode_one(n,y),E=a.decode_one(n,t);G=c.geomiddle_str(G.qt7bit,E.qt7bit);if(u.qt7bit_span.contains_one(G)){var A=h._dataPointUnmergeable;z=h._dataPointUnmergeable_per_cat_span;E={};var C=0;if(n in z&&u.qt7bit_span.intersects(z[n]))for(var B=y;B<=t;B++)z=a.decode_one(n,B),A[z.bitid]&&(E[B]=!0,C++,g(z));var I=t-y+1-C;A={c:I};if(1<
I){if(r||!(f<b&&I>d)){u=A.idlist=Array(I);if(0<C)for(C=0,B=y;B<=t;B++)E[B]||(z=a.decode_one(n,B),u[C++]=z.id);else for(C=0,B=y;B<=t;B++)z=a.decode_one(n,B),u[C++]=z.id;if(C!==I)throw"alp._gmap2_3.ClusterModel._get_clusters_from_qt7bit(): place_final_clusters(): found a bug in the cluster case: mc:"+I+", jj(final):"+C;r&&(A.idlist=alp.map(u,'"string"===typeof v ? v : v._alpId||v()'))}y=l(G);m(y,n,A)}else if(0<I)for(B=y;B<=t;B++)if(!E[B]){z=a.decode_one(n,B);u.qt7bit_span.contains_one(z.qt7bit)&&g(z);
break}}}else console.error("alp._gmap2_3.ClusterModel populate_ret() found a bug: !(i_begin < i_ret) , i_begin:"+y+", i_end:"+t)}}}}if(388<(Date.now?Date.now():+new Date)-S){R=!1;break}}}});return R?(alp.oSet(n,q,p),{finaldata:p}):{summarydata:p}},_ensure_on_modifiedDataPoint:alp.nowF(function(){var a=this;a._ensure_on_modifiedDataPoint=function(){};a._qt7bitloader.modifiedDataPoint().thenSoon(function(b){b.oldDataPoint&&a.clearClusterAtPoint(b.oldDataPoint[c.GEOM]);b.dataPoint&&a.clearClusterAtPoint(b.dataPoint[c.GEOM]);
if(b=b.dataPoint){var d=c.int64str10_2_qt7bitstr(b.id),e=a._dataPointUnmergeable[d];e&&!e.equals(b)&&(a._remove_from_unmergeable(e,d),a._add_to_unmergeable(b,d))}})}),_update_all_ids_later:function(){this.updateAllIds_st.get()&&(this._qt7bitloader.load_all(),this._qt7bitloader.allIds_listen(this.allIds_st))},_forget_all_ids:function(){this._qt7bitloader.allIds_drop(this.allIds_st);this.allIds_st.set(null)}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.point");
alp.gmap3(function(k){var h=alp.sub("alp._gmap2_3.point",null,!0);h.add=function(g,f){return new k.Point(g.x+f.x,g.y+f.y)};h.sub=function(g,f){return new k.Point(g.x-f.x,g.y-f.y)};h.alpha=function(g,f){return new k.Point(f*g.x,f*g.y)}});"undefined"!==typeof dojo&&dojo.provide("alp.anim._core");
(function(){alp.declare("alp.Anim",null,function(h){alp.mix(this,h);this.st||(this.st=new alp.MinMaxState(alp.opt(this,["min","max","init_value"])));this.speed||(this.speed=this.st.max-this.st.min);if(!(0<this.speed))throw Error("alp.Anim.constructor: speed must be a non-negative number!");this._queue=[];this._distorsion_f="string"===typeof this.distorsion?alp.f(this.distorsion):this.distorsion},{st:null,min:0,max:1,init_value:0,speed:null,distorsion:"",interval_ms:13,cancel:function(){this._queue.splice(0);
k(this);return this},nextAction:function(h){this._queue.push(h);k(this);return this},nextTarget:function(h){this._queue.push(h);k(this);return this},currentTarget:function(){var h=this._queue,g=h[0];if(h.length&&"number"===typeof g)return Math.max(this.st.min,Math.min(this.st.max,g))},hasTarget:function(){return 0<this._queue.length},nextTargetMax:function(){return this.nextTarget(this.st.max)},nextTargetMin:function(){return this.nextTarget(this.st.min)},isCurrentTargetMax:function(){return this.st.is_same(this.currentTarget(),
this.st.max)},isCurrentTargetMin:function(){return this.st.is_same(this.currentTarget(),this.st.min)},evtEpsilon:1E-10,reachMinEvt:alp.memM("reachMinEvt",'alp.event("AA:reachMinEvt", {then:1})'),reachMaxEvt:alp.memM("reachMaxEvt",'alp.event("AA:reachMaxEvt", {then:1})')});var k=alp.nowF(function(h){function g(){h._startDate=Date.now?Date.now():+new Date;h._startValue=h.st.get()}null==h._startDate&&g();for(var f=h._queue,e=Math.max(0,(Date.now?Date.now():+new Date)-h._startDate);f.length;){var d=f[0];
if("function"===typeof d)if(alp.sub("dojo.config.debugAtAllCosts"))d();else try{d()}catch(a){console.error('_Anim_check_queue caught an error "'+a+'" while executing todo: '+d)}else{var b=h.st.min,c=h.st.max;d=h.currentTarget();if(!h.st.is(d)&&(b=Math.abs(c-b),c=Math.abs(b*h._distorsion_f(Math.min(1,Math.max(0,e/1E3*h.speed/b)))),b=h.st.get(),c=d>h._startValue?Math.min(d,h._startValue+c):Math.max(d,h._startValue-c),h.st.setNow(c),h.evtEpsilon>Math.abs(c-h.min)&&h.evtEpsilon<Math.abs(b-h.min)?h.reachMinEvt().triggerSoon():
h.evtEpsilon>Math.abs(c-h.max)&&h.evtEpsilon<Math.abs(b-h.max)&&h.reachMaxEvt().triggerSoon(),!h.st.is(d))){alp.asyncF(h.interval_ms,k)(h);return}}f.shift();g()}h._startDate=h._startValue=null})})();"undefined"!==typeof dojo&&dojo.provide("alp.anim");"undefined"!==typeof dojo&&dojo.provide("alp.util.math.circle_spread");
(function(){function k(g,f,e){for(var d=0,b=0;d<f;){var c=Math.min(f-d,Math.floor(2*Math.PI/(2*Math.asin(e.min_dist/2/g))));d+=c;b++;g-=e.min_dist;if(0>g||0>d||0>c)return Infinity}return b}var h=alp.sub("alp.util.math",null,!0);h.circle_spread=alp.memF(function(g){function f(a){var b=g,c=k(a,e,b);return a-(c-1)*b.min_dist<b.min_radius-1E-10?-Infinity:a}var e=g.n;g=alp.oCreateMix(h.circle_spread.default_cfg(),g);var d=g.min_radius,b=g.min_radius+g.min_dist*(e-1),c=Math.max(0,f(d)),a;for(a=0<c?d:alp.util.dichotomy(c,
d,b,f,{n_iter_max:100});0>f(a);)a+=g.min_dist/3;d=[];b=0;for(c=k(a,e,g)-1;b<e;){for(var m=Math.min(e-b,Math.floor(2*Math.PI/(2*Math.asin(g.min_dist/2/a)))),l=2*Math.PI/m,r=g.first_angle(c),n=[],q=0;q<m;q++){var p={r:a,a:r-l*q};p.x=p.r*Math.cos(p.a);p.y=p.r*Math.sin(p.a);p.x=1E-10*Math.round(p.x/1E-10);p.y=1E-10*Math.round(p.y/1E-10);n.push(p)}n.reverse();d=d.concat(n);b+=m;a-=g.min_dist;c--}if(b!==e||a<g.min_radius-g.min_dist-1E-5)throw Error("alp.util.math.circle_spread() has a bug! n:"+e+", n_placed:"+
b,", radius:"+a);d.reverse();return d.cfg=d});h.circle_spread.default_cfg=function(){return{min_radius:40,min_dist:40,first_angle:function(g){return Math.PI/2*(1-g)}}}})();"undefined"!==typeof dojo&&dojo.provide("alp.util.math.optim_permute");
(function(){function k(h,g){for(var f=g.length,e=Array(f),d=0;d<f;++d)for(var b=h[g[d]],c=0;c<f;++c)if(e[c]){m=e[c].visited;var a=alp.arrMinIndex(b,function(a,b){return m[b]?Infinity:a});e[c].cost+=b[a];e[c].path.push(a);e[c].visited[a]=!0}else{var m={};m[c]=!0;e[c]={cost:b[c],path:[c],visited:m}}for(c=f;c--;)e[c].path=alp.arrUnpermute(e[c].path,g);for(c=f;c--;)e[c].path.cost=e[c].cost;return e}alp.sub("alp.util.math",null,!0).optim_permute=function(h,g){g=alp.oCreateMix({way:"optim_worst"},g);var f=
h.length,e=Array(f);if("optim_worst"===g.way)e=alp.arrSortOrder(alp.map(h,function(d){return-Math.max.apply(Math,d)})).order;else for(g=f;g--;)e[g]=g;h=k(h,e);e=alp.arrMinIndex(h,".cost");return h[e].path}})();"undefined"!==typeof dojo&&dojo.provide("alp.util.math.circle_spread_data");
(function(){function k(c,a){if(5<c.length)throw Error("alp.util.math.circle_spread_data(): _spread_data_on_one_circle() received too many points!");var f=c.length;c=alp.map(c,function(a){return(Math.atan2(a.y,a.x)+d)%d});c.sort(function(a,b){return a<b?-1:a>b?1:0});for(var l=Array(f),h=0,n=f;n--;)l[n]=(c[h]-c[n]+d)%d,h=n;h=[].concat(l);for(var k={};b-1E-10>h[n=alp.arrMinIndex(h)];)h[n]=b,k[n]=!0,g(h,k);n=alp.arrMinIndex(l);l=Array(f);l[n]=(e.angleWmean([c[n],c[(n+1)%f]])-h[n]/2+d)%d;for(c=f-1;c--;)k=
n,n=(n+1)%f,l[n]=(l[k]+h[n])%d;h=Array(f);for(c=f;c--;)f={r:a.min_radius,a:l[c]},f.x=f.r*Math.cos(f.a),f.y=f.r*Math.sin(f.a),h[c]=f;return h}function h(b,a){for(var c={},d=[],e=b.length;e--;){var g=b[e],h=g.r;h in c||(d.push(h),c[h]=[]);c[h].push(g)}d.sort(function(a,b){return a<b?-1:a>b?1:0});var k=d.length;g=Array(k);var v=Array(k);for(e=0;e<k;e++){var u=0<e?v[e-1]+a.min_dist:a.min_radius;h=d[e];u=Math.max(u/h,f(h,c[h],a.min_dist));g[e]=u;v[e]=u*h}b=b.length;a=Array(b);for(e=0;k--;){h=v[k];u=g[k];
for(var t=c[d[k]],w=t.length;w--;){var x=t[w];a[e++]={a:x.a,r:h,x:x.x*u,y:x.y*u}}}if(e!==b)throw Error("circle_spread_data found itself being insane!");return a}function g(b,a){for(var c=0,e=0,f=b.length;f--;){var g=b[f],h=a[f];c+=g;h||(e+=g)}if(!(d-1E-10<c&&c<d+1E-10)&&0<e){c=(e-(c-d))/e;if(!(0<c))throw Error("alp.util.math.circle_spread_data(): _scale_non_fixed_delta_angles() found a bug (scaling_factor)!");for(f=b.length;f--;)a[f]||(b[f]*=c)}}function f(b,a,d){a.sort(function(a,b){return a.a<b.a?
-1:1});b=a.length;var c=Infinity;if(!(1<b))return 1;for(var e=b;e--;){var f=a[e],g=a[(e+1)%b],h=f.x-g.x;f=f.y-g.y;c=Math.min(c,h*h+f*f)}return d/Math.sqrt(c)}var e=alp.sub("alp.util.math",null,!0),d=2*Math.PI,b=d/5;e.circle_spread_data=function(b,a){a=alp.oCreateMix(e.circle_spread_data.default_cfg(),a);if(1>b.length)return[];var c=5<b.length?e.circle_spread(alp.oCreateMix(a,{n:b.length})):k(b,a);a=c=h(c,a);c=a.length;for(var d=Array(c),f=c;f--;){for(var g=b[f],q=d[f]=Array(c),p=Infinity,v=c;v--;){var u=
a[v],t=u.x-g.x;u=u.y-g.y;t=t*t+u*u;q[v]=t;p=Math.min(t,p)}for(v=c;v--;)q[v]-=p}b=e.optim_permute(d);return alp.arrPermute(a,b)};e.circle_spread_data.default_cfg=e.circle_spread.default_cfg})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.interface_cv_on_cluster_mouseover");
alp.gmap3(function(k){function h(a,b){function c(){var c=a.gmapSt.get();if(c){var f=e.st.getProp(),l=d(a),g=alp.mix({},l.get());if(1E-10>f)r in g&&delete g[r];else if(b._alpMouseoverRadiusPixel&&b._alpMouseoverSingleMarkerArr){var h=b._alpMouseoverCenter;f=f*b._alpMouseoverRadiusPixel+b._alpMouseoverRadiusExtraPixel;g[r]={c_latlng:h,c_pix:b._alpMouseoverCenterPixel,r_pix:f,except_mids_arr:alp.map([b].concat(b._alpMouseoverSingleMarkerArr),'v["'+n+'"]'),cfg:{shape:"circle",coords:[h.lng(),h.lat(),
{pixel:f}],z:c.getZoom()}}}l.set(g)}}if(!b._alpMouseoverAnim){for(var e=b._alpMouseoverAnim=new alp.Anim(alp.oCreateMix(l,a.clusterPopup)),f=b._alpInfoArray,h=[],m=[],k=f.length;k--;){var q=f[k];if(q.ismanualooi)m.push(q);else{q=q.idlist;if(!q){h=null;break}h=h.concat(alp.map(q,alp.fVal))}}if(h&&h.length||m&&m.length)f=a.dynamicTooltip&&(a.dynamicTooltipLoad?a.dynamicTooltipLoad(h):a.model.load_OOIs(h)),f._idlist=h,a.model.getDataPointArray(h).then(alp.bindF(g,null,a,b,m,f));var r=p++;e.st.change_cb_init(c)}return b._alpMouseoverAnim}
function g(c,d,l,g,n){function q(a,b){return p(a,b,{c:1,info_array:[a],lat:a.lat,lng:a.lng})}function p(a,e,l){function m(b,c){c||(c=alp.data.allMaintype(b,g._idlist));(b=(b=alp.filter(c,'.id=="'+a.id+'"')[0])&&b.title)&&b!==q.getTitle()&&q.setTitle(b)}var n=v;e=new k.Point(t.x+x[e].x,t.y+x[e].y);e=b.fromContainerPixelToLatLng(r,e);var q=u.group_2_marker(l,{middle_anchor_y:!0});q._alpOrigLatLng=n;q._alpTargetLatLng=e;l=h(c,d).st;q._alpH=l.change_cb_init(f,null,r,q,l);g&&q.setTitle&&g.thenSoon(m);
return q}var r=c.gmapSt.get();if(r&&d.getMap()){n.concat(l);var v=d.getPosition(),t=b.fromLatLngToContainerPixel(r,v),w=alp.map(n,function(a){return b.qt7bit.qt7bit_2_latlng(a.geom)}).concat(alp.map(l,function(a){return new k.LatLng(a.lat,a.lng)}));r.getZoom();w=alp.map(w,function(a){a=b.fromLatLngToContainerPixel(r,a);return new k.Point(a.x-t.x,a.y-t.y)});var x=m.circle_spread_data(w,{min_dist:c.clusterPopupMinDist,min_radius:c.clusterPopupMinRadius});w=Math.sqrt(Math.max.apply(Math,alp.map(x,"v.x * v.x + v.y * v.y")));
var u=c._mapqueue;l=alp.map(n,function(b,d){var e=v,f=e.lat(),l=e.lng(),g=b[a.ID];e=a.int64str10_2_qt7bitstr(g);b={c:1,id:g,lat:f,lng:l,t:b[a.CATID]};f=c.model._dataPointIcon;e in f&&(b.iconFun=f[e]);return q(b,d)}).concat(alp.map(l,q));n=[e(r,d,x)];d._alpMouseoverSingleMarkerArr=l;d._alpMouseoverMelArr=n;d._alpMouseoverCenter=v;d._alpMouseoverCenterPixel=t;d._alpMouseoverRadiusPixel=w;d._alpMouseoverRadiusExtraPixel=c.clusterPopupMinDist}}function f(a,d,e){var f=e.get();if(f>e.min){a!==d.getMap()&&
d.setMap(a);e=b.fromLatLngToContainerPixel(a,d._alpOrigLatLng);var l=b.fromLatLngToContainerPixel(a,d._alpTargetLatLng);f=c.add(e,c.alpha(c.sub(l,e),f));a=b.fromContainerPixelToLatLng(a,f);d.setPosition(a)}else d.setMap(null)}function e(a,d,e){e=25+Math.max.apply(Math,alp.map(e,alp.f(".r")));var f=e*e,l;return l=b.event("addListener")(a,"mousemove",function(e){if(d._alpMouseoverAnim){var g=d.getPosition();g=b.fromLatLngToContainerPixel(a,g);if(b.iwOpen.isLastVisible()){var h=b.iwOpen.lastLatLng();
h=b.fromLatLngToContainerPixel(a,h);h=c.sub(h,g);if(h.x*h.x+h.y*h.y<=f)return}e=b.fromLatLngToContainerPixel(a,e.latLng);e=c.sub(e,g);e.x*e.x+e.y*e.y>f&&d._alpMouseoverAnim.cancel().nextTargetMin()}else b.event("removeListener")(l)})}function d(a){function c(){var c=f.get()||{},d={},l={},g=a.gmapSt.get();if(g){for(var h in c)if(!(h in q)){var m=c[h];alp.forEach(m.except_mids_arr,"this[v]=1",l);m=alp.filter(b.marker_fetch(m.cfg),"v.getMap()===this   ||  !v.getMap()",g);alp.forEach(m,'this[v["'+n+'"]] = 1',
d)}c={};for(h in d)h in q||h in l||(c[h]=1);e.set(c)}}function d(){var c=a[u]||{},d=e.get(),f=alp.oDelta(d,c);c=f.add;f=f.del;a[u]=d;if(c.length||f.length)d=alp.arr2o(f,alp.f(),alp.f("null")),alp.forIn(c,"this[v]={setMap:null}",d),b.marker_tmp_set(d)}if(!(v in a)){var e=a[t]=new alp.ObjectState({init_value:{}}),f=a[v]=new alp.State;a[u]=null;f.change_cb(alp.ratelimitF(100,alp.nowF(c)));e.change_cb(d)}return a[v]}var b=alp._gmap2_3,c=b.point,a=b.qt7bit,m=alp.util.math,l={speed:7},r=m.circle_spread_data.default_cfg(),
n=b.MARKER_ID(),q={};alp._gmap2_3.InterfaceClusterViewOnClusterMouseover={gmapSt:null,model:null,clusterPopup:null,dynamicTooltip:!1,dynamicTooltipLoad:null,clusterPopupMinDist:r.min_dist,clusterPopupMinRadius:r.min_radius,on_cluster_mouseover:alp.nowF(function(a){function c(){n.cancel().nextTargetMin()}null==this.clusterPopup&&(this.clusterPopup=!!alp.opt(this.model,"getDataPointArray"));this.clusterMarkerMouseoverEvt().triggerSoon(a);if(this.clusterPopup){var d=this,e=d.gmapSt.get(),f=d.model,l=
alp.m(a._alpGmap,"getZoom"),g=alp.m(a._alpMouseoverAnim,"isCurrentTargetMax"),m=d._ocmc=alp.filter(d._ocmc||[],"v.marker === this  ?  v  :  (v(),false)",a);if(!g&&f.getDataPointArray&&null!=l&&!alp.m(a,"_alpIsClosed",l)){var n=h(d,a);n.cancel().nextTargetMax();c.marker=a;m.push(c);e&&b.event("addListener")(e,"zoom_changed",alp.nowF(function(){if(e!==a._alpGmap||l!==e.getZoom()){var c=h(d,a).st;c.setNow(0);delete a._alpMouseoverAnim;var f=a._alpMouseoverSingleMarkerArr;for(delete a._alpMouseoverSingleMarkerArr;f&&
f.length;){var g=f.pop();c.drop_cb(g._alpH);g.setMap(null)}f=a._alpMouseoverMelArr;for(delete a._alpMouseoverMelArr;f&&f.length;)b.event("removeListener")(f.pop())}}))}}}),clusterMarkerMouseoverEvt:alp.memM("clusterMarkerMouseoverEvt",'alp.event( "AG CV: clusterMarkerMouseoverEvt" )')};var p=0,v="_cv_cmov_hide_st",u="_cv_cmov_hide_prev",t="_cv_cmov_hide_markeridset_st"});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.marker_opts");
(function(){var k=alp._gmap2_3,h=k.cluster;h.marker_opts_arr=function(g){function f(d){d=alp.oCreateMix({xy:d.size,anchor_xy:d.anchor,noNumberDisplay:!1},d);d.anchor_xy=d.anchor_xy||[d.xy[0]>>1,d.xy[1]>>1];d.label_offset_y=d.label_offset_y||0;d=alp.cfg._ooi_normalize_xy(d);var b={marker_opts:{icon:k.markerImage_gen(d.url,d.xy,null,d.anchor_xy),shadow:d.shadow_url&&k.markerImage_gen(d.shadow_url,d.shadow_xy,null,d.anchor_xy),shape:d.shape,noNumberDisplay:d.noNumberDisplay},label_offset_y:d.label_offset_y};
null!=d.zIndex&&(b.marker_opts.zIndex=d.zIndex);return b}g=g||alp.cfg.cluster_markers();var e=alp.map(g,f);e._get_cluster_marker_opts=f;return(h.markers_opts_arr=function(){return e})()}})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.trigger_click");
(function(){function k(g,f){(g||null).substring.call.a;f.childNodes.a;if("function"===typeof MouseEvent)try{var e=new MouseEvent(g,{view:window,bubbles:!0,cancelable:!0});f.dispatchEvent(e);return e}catch(d){}if("function"===typeof document.createEvent)return e=document.createEvent("MouseEvents"),e.initEvent(g,!0,!1),f.dispatchEvent(e),e;if(document.createEventObject&&f.fireEvent)return e=document.createEventObject(),f.fireEvent("on"+g,e),e;throw Error("Click event triggering: implementation not done yet for the present browser "+
navigator.userAgent);}var h=alp.sub("alp.dom",null,!0);h.trigger=k;h.triggerClick=alp.bindF(k,null,"click")})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.custom_marker");
alp.gmap3(function(k){var h=alp.dom,g=!!k.__alp_lf__;alp.declare("alp._gmap2_3.CustomMarker",k.OverlayView,alp.nowF(function(b){var a=this;b.prop||(b.prop={});b.html&&(b.prop.innerHTML=b.html);a.position=b.position;a.className=b.className||"oax-ag-custom-marker";a.cfg=b;a.setMap(b.map);a.position.lat.a;a.position.lng.a;a.positionSt().setNow(a.position);a.positionSt().change_cb(function(){a.position=a.positionSt().get();a.draw()})}),{onAdd:alp.f(),draw:function(){function c(a,b){b||(b=a);y.on(a,function(){h.trigger(b,
z)})}var a=this.cfg,m=a.width,l=a.height,k=a.anchor_x,n=a.anchor_y,q=a.zIndex,p=alp.dflt(a.interactive,!0),v=this.div;null==m&&(m=20);null==l&&(l=20);null==k&&(k=m>>1);null==n&&(n=l>>1);var u=g?this.getMap():this._gm_map,t=alp.sub("L"),w=t&&u&&u.__alp_lf__;if(g){v=this.position.__alp_lf__;u=v.lat;var x=v.lng,y;if(y=this[e])k=y.getLatLng(),k.lat===u&&k.lng===x||y.setLatLng({lat:u,lng:x});else{u=this[d]="oax-ag-custom-marker-intid-"+b++;k={icon:t.divIcon({html:a.html,iconAnchor:[k,n],iconSize:[m,l],
className:this.className+" "+u}),title:alp.oGet(a,"attr.title")||"",interactive:p};isFinite(q)&&(k.zIndexOffset=q);y=this[e]=t.marker(v,k);var z=this.div=this.divMouse=alp.cE("div");c("click");c("mouseover");c("mouseout")}k=this[f];k!==w&&(k&&y.remove(),w&&y.addTo(w),this[f]=w)}else u&&(v||(w=m+"px",l+="px",v=this.div=alp.aC(alp.style(alp.cE("div",null,alp.mix({"class":this.className},a.attr),alp.mix({innerHTML:""},a.prop)),alp.filterIn(alp.mix({position:"absolute",cursor:"pointer",width:w,height:l,
background:"transparent",zIndex:isFinite(q)?q:null},a.style),"!=null")),alp.style(this.divMouse=alp.cE("div",null,alp.mix({"class":"oax-ag-custom-marker-mouseover"})),{position:"absolute",width:w,height:l,left:0,top:0})),"undefined"!==typeof this.cfg.marker_id&&(v.dataset.marker_id=this.cfg.marker_id)),q=this.getPanes()[p?"overlayMouseTarget":"markerLayer"],q!==v.parentNode&&q.appendChild(v),q=this.getProjection().fromLatLngToDivPixel(this.position))&&(v.style.left=q.x-k+"px",v.style.top=q.y-n+"px")},
onRemove:function(){if(g){var b=this[e];b&&(b.remove(),this[f]=null)}else this.div&&alp.orphan(this.div)},positionSt:alp.memM("positionSt","new alp.State"),getDiv:function(){return this.div},getDivMouse:function(){return this.divMouse},getPosition:function(){return this.position},getMap:function(){return this._gm_map},setMap:function(b){this._gm_map=b;k.OverlayView.prototype.setMap.apply(this,arguments)}});var f="_last_lf_map",e="_lf_marker",d="_lf_cn_w_intid",b=0});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.marker_labeled");
alp.gmap3(function(k){var h=alp._gmap2_3;h.marker_labeled_gen=function(g,f,e){function d(){a.setMap(c.getMap())}"string"===typeof f&&(f={label_text:f,label_style:{}});var b=alp.Aps.call(arguments,2);f&&k.isLeafletGshim&&(g=alp.oCreateMix(g,{alp_label_opts:f}));var c=h.marker_gen.apply(h,[g].concat(b));if(f){var a=c._alpLabel;if(a)d(),h.event("addListener")(c,"map_changed",d);else if(h.Label){var m=g&&g.icon&&g.icon.size;b=m&&m.width;m=m&&m.height;if(isFinite(b)&&isFinite(m)&&0<b&&0<m){var l=f.label_style||
(f.label_style={});l.width=b+"px";l.height=m+"px";l["margin-left"]=-(b>>1)+"px";l["margin-top"]=-(m>>1)+"px"}a=new h.Label(f);h.bind_label_to_marker(a,c);c._alpLabel=a}}return c}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.marker");alp.i18n.fetch("alp.all");
alp.gmap3(alp.nowF(function(k){var h=alp._gmap2_3,g=h.cluster,f=alp.mapany(),e=g.DEFAULT_noZoomInCountMax(),d=g.DEFAULT_zoomInMaxLevel(),b={};alp.i18n.fetch("alp.all").thenSoon(function(a){b=a});h.cluster.create_marker=function(a,m){var l=a.map;if(!l)throw Error("alp._gmap2_3.cluster.create_marker requires `options.map`.");var k="zoomInMaxLevel";null==a[k]&&(a[k]=d);k="noZoomInCountMax";null==a[k]&&(a[k]=e);k="clickable";null==a[k]&&(a[k]=!0);if(null!=a.number){var n=Math.floor(Math.log(a.number)/
Math.log(10));var q=alp.tmpl((b||{})[1<a.number?"bubble_title_n":"bubble_title_1"]||"${n} item(s) here",{n:a.number});var p=g.marker_opts_arr(a.cluster_marker_cfg);k=Math.min(p.length-1,Math.max(0,n));var v=alp.oCreateMix(p[k].marker_opts,{title:q});if(v.noNumberDisplay)var u=null;else u={label_text:""+a.number,label_class:"oax-cluster-marker",label_style:{}},k=alp.oGet(v,"icon.size.height"),isFinite(k)&&0<k&&alp.oSet(u,["label_style","line-height"],k+"px")}v=alp.oCreateMix(v,alp.oCreateMix({position:a.position,
map:a.map,clickable:a.clickable},a.marker_opts));if(m||h.V3()){if(a.cluster_marker_cfg)n=h.marker_labeled_gen(v,u);else{k=a.cluster_style_cfg||{};m=k.cssClass||"";var t=k.sizeFun||alp.f("26 + v * 9");k=v.title;l=v.map;p=v.position;k=u&&u.label_text;t=t(n);n=new h.CustomMarker({position:p,map:l,width:t,height:t,anchor_x:t>>1,anchor_y:t>>1,html:'<div class="oax-cluster-marker-cont '+m+" oax-cluster-marker-n-"+n+'" style="width: '+t+"px; height: "+t+"px; border-radius: "+(4+(t>>1))+'px;"><span class="oax-cluster-marker-label" style="line-height: '+
t+'px">'+(k||"&nbsp;")+"</span></div>",attr:{title:q||""}})}c(n,a);h.marker_register(n)}else{var w="";alp.forEach([a.zoomInMaxLevel,a.noZoomInCountMax,v.clickable,u.label_class,v.title],function(a){w+="("+a+")"});n=alp.now(function(b){var d;var e=f.get(l)||f.set(l,{});if(d=e[b]=e[b]||[],0<d.length)return b=d.pop(),alp.m(b&&b._alpLabel,"setText",u.label_text),b.setPosition(a.position),c(b,a),b.setVisible(!0),b;b=h.marker_labeled_gen(v,u);b._alpPoolRemove=function(){this.setVisible(!1);d.push(this)};
c(b,a);return b},null,w)}return n};var c=function(a,b){function c(){var c=a.getMap();if(c){var d=c.getZoom();a._alpIsClosed(d)?(c.setCenter(a.getPosition(),d+1),k.__alp_lf__||c.setZoom(d+1)):b.click_fun&&b.click_fun(a)}}function d(){b.mouseover_fun(a)}a._alpEh&&a._alpEh.clear();a._alpEh=new alp.Eh;a._alpIsClosed=function(a){return a<b.zoomInMaxLevel&&(null===b.number||b.number>b.noZoomInCountMax)};var e=a instanceof h.CustomMarker&&alp.subDfrd(a.getDivMouse,a);e?e.then(function(b){a._alpEh.push(alp.aEL(b,
"click",c))}):a._alpEh.push(h.event("addListener")(a,"click",c),h.event("removeListener"));b.mouseover_fun&&(e?e.then(function(b){a._alpEh.push(alp.aEL(b,"mouseover",d))}):a._alpEh.push(h.event("addListener")(a,"mouseover",d),h.event("removeListener")),e?e.then(function(b){a._alpEh.push(alp.aEL(b,"click",d))}):a._alpEh.push(h.event("addListener")(a,"click",d),h.event("removeListener")))}}));"undefined"!==typeof dojo&&dojo.provide("alp.util.iter");
alp.sub("alp.util",null,!0).first_last_iter=function(k,h){var g=!0,f=function(){var e="function"===typeof k?k():k;e=g?0:e.length-1;h||f.switchit();return e};f.switchit=function(){g=!g};return f};"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.cluster_view_queue");
alp.gmap3(function(k){function h(a){var d=a.gmapSt.get(),e=a._latest_single_marker_arr,f=a.dynamicTooltipLoad||a.load_OOIs;if(!a[b]&&d&&e&&e.length&&a.dynamicTooltip&&f){for(var g=[],h={};e.length&&20>g.length;){var k=e.pop();if(d===k.getMap()){var v=k._alpInfo.id,u=a._id_2_singleMarkerOptions[v];u&&u.title||(g.push(v),h[v]=k)}}a[b]=!0;f(g,{minimal:!0}).thenSoon(function(d,e){e||(e=alp.data.allMaintype(d,g));a[b]=!1;d=a[c];for(var f=e.length;f--;){var l=e[f];if(l){var m=l.id,k=m&&h[m];k&&(l=(m=a._id_2_singleMarkerOptions[m])&&
m.title||l.title)&&k.setTitle&&l!==k.getTitle()&&k.setTitle(l)}else d||(console.error("OAX:ClusterViewQueue: Could not find id "+g[f]+", probably because it is a wrong id or unpublished content."),a[c]=!0)}})}}function g(a,b,c){var d=b[c];d&&"object"===typeof d&&(b=alp.oCreate(b),a=a["get"+alp.sCamel(c)](),b[c]=a&&"object"===typeof a?alp.oCreateMix(a,d):d);return b}var f=alp._gmap2_3,e=/^\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*([\w\W]+)$/,d="zoom x y sub_x sub_y gmap_name qq".split(" ");
alp.declare("alp._gmap2_3.ClusterViewQueue",alp.util.Background,alp.nowF(function(a){var b=this;alp.forEach(["gmapSt","selectionDfrd"],function(b){a[b]||console.error("alp._gmap2_3.ClusterViewQueue.constructor(): opts."+b+" is mandatory.")});alp.mixCheck(b,a);b._latest_single_marker_arr=[];b._id_2_singleMarker={};b._id_2_singleMarkerOptions={};b._gmapEh=new alp.Eh;alp.m(b.gmapSt,["change_cb","changed_cb"],function(a){a&&b.clear(a)});alp.m(b.gmapSt,["change_cb","changed_cb"],"reinitGmap",b);this.reinitGmap();
b.selectionDfrd.thenSoon(function(a){b._selection=a})}),{gmapSt:void 0,selectionDfrd:void 0,marker_opts:void 0,on_cluster_click:void 0,on_cluster_mouseover:void 0,single_ooi_marker_opts:void 0,on_ooi_click:void 0,on_ooi_dblclick:void 0,on_ooi_marker_mouseover:void 0,on_ooi_marker_mouseout:void 0,filter_dz_max:2,max_hidden:alp.likeIE()?123:1234,img_default_domain:void 0,dynamicTooltip:!0,dynamicTooltipLoad:null,pause_max_ms:357,waker_interval_ms:357,setMap:function(a){alp.m(this.gmapSt,["setNow","set"],
a)},getMap:function(){return this.gmapSt.get()},setSingleMarkerOptions:function(a,b){(a||0).substring.call.a;alp.oSet(this,["_id_2_singleMarkerOptions",a],b);if(a=this._id_2_singleMarker[a])b=g(a,b,"icon"),b=g(a,b,"shadow"),a.setOptions(b)},getSingleMarkerOptions:function(a){return(a=alp.oGet(this,["_id_2_singleMarkerOptions",a]))&&alp.oCreate(a)},getDraggedMarker:function(){return this._cvq_dragged_marker},reinitGmap:function(){var a=this,b=a.gmapSt.get();b!==a._lastReinitGmap&&(a._lastReinitGmap=
b,a._gmapEh.clear(),b&&(alp.forEach([f.V2()?"movestart":"dragstart"],function(c){a._gmapEh.push(f.event("addListener")(b,c,alp.bindF("_on_gmap_"+c,a)),f.event("removeListener"))}),alp.forEach([f.V2()?"moveend":"dragend"].concat(f.V2()?["load"]:[]),function(c){a._gmapEh.push(f.event("addListener")(b,c,alp.asyncF(0,"_on_gmap_"+c,a)),f.event("removeListener"))})))},_on_gmap_dragstart:function(){this._on_gmap_movestart()},_on_gmap_dragend:function(){this._on_gmap_moveend()},_on_gmap_movestart:function(){this._gmap_moving=
!0},_on_gmap_moveend:alp.nowF(function(){this._gmap_moving=!1;this._delayedDfrd&&(this._delayedDfrd.triggerSoon(!0),this._delayedDfrd=void 0)}),_on_gmap_load:function(){this._on_gmap_moveend()},_todo:[],_last_will:{},do_one_impl:alp.nowF(function(){var a=arguments,b=this,c=b.gmapSt.get();if(!(c&&b._todo&&0<b._todo.length))return c&&h(b),!1;if(!c.isLoaded())return!1;b._filter_current_zoom_level();var d=!1,e=!1,f=!1;d||(d=!b._selection);f||(f=b._gmap_moving);e||(e=d||!c.isLoaded()||b._cvq_dragged_marker);
d&&b.selectionDfrd.thenSoon(function(a){b._selection=a});e&&(b._delayedDfrd||(b._delayedDfrd=alp.dfrd("AG CVQ: delayedDfrd"))).thenSoon(alp.asyncF(0,function(){b.do_some.apply(b,a)}));if(!e&&!f){for(b._todo_iter||(b._todo_iter=alp.util.first_last_iter(function(){return b._todo},!0));b._todo&&0<b._todo.length;)if(c=b._todo_iter(),d=b._todo.splice(c,1)[0])if(c=b._last_will[d],b._last_will[d]=void 0,c&&(d=c.name))if(b[d]&&"function"===typeof b[d])if(c=c.args){var g=b[d].apply(b,c);if(g){b._todo_iter.switchit();
break}}else console.error("ClusterViewQueue.do(): missing args array - skipping this action.");else console.error("ClusterViewQueue.do(): unrecognised action name: ",d," - skipping this action.");return g}}),_where_str_2_cell:function(a){a=this._where_str_2_cellindex(a);return alp.oGet(this._cells,[a.zoom,a.x,a.y,a.sub_x,a.sub_y])},_where_str_2_cellindex:function(a){a=e.exec(a).slice(1);for(var b=d.length;b--;)a[d[b]]=a[b];return a},_where_str:function(a){if("string"===typeof a)return a;if(a&&a.length&&
6===a.length)return a="("+a.join(",")+")",a+=this.gmap_ind_str();console.error('ClusterViewQueue._where_str() expects either a String or a 7-element array: [ Integer: zoom, Integer: tile_x, Integer: tile_y, Integer: sub_x, Integer: sub_y, Integer: qq,  LatLng|LatLng.toString() ], and was given an incorrect "where":',a)},gmap_ind:function(a){a=a||this.gmapSt.get();var b=this._gmap_arr||(this._gmap_arr=[]),c=alp.lastIndexOf(b,a);0>c&&(c=b.length,b.push(a));return c},gmap_ind_str:function(a){return"_gmap#"+
this.gmap_ind(a)},gmap_str2ind:function(a){return a.match(/_gmap#(\d+)/)[1]>>0},group_2_marker:function(a,b){function c(){e._cvq_dragged_marker=m}function d(){e._cvq_dragged_marker===m&&(e._cvq_dragged_marker=null,e.do_some())}b=b||{};var e=this,g=e.gmapSt.get();var h=new k.LatLng(a.lat,a.lng);if(1<a.c){var m=alp._gmap2_3.cluster.create_marker(alp.oCreateMix(e.marker_opts||{},{map:g,position:h,number:a.c,click_fun:e.on_cluster_click,mouseover_fun:e.on_cluster_mouseover}));m._alpInfoArray=[].concat(a.info_array)}else{var u=
alp.oCreate(e.single_ooi_marker_opts||{}),t=a.info_array;if(t&&1!==t.length)throw console.error(a),Error("alp._gmap2_3.ClusterViewQueue: inconsistent number of OOIs in a singleton cluster!");if(t)t=t[0];else if(a.isUnmergeable)t=a;else throw Error("alp._gmap2_3.ClusterViewQueue: could not understand `alpGroup`. Most likely a bug.");var w;var x=(x=(x=t.t_img&&(w=e._selection[t.t_img])&&e._selection[t.t_img].img)||t.t&&(w=e._selection[t.t])&&e._selection[t.t].img)||"";/^(https?:)?\/\//i.test(x)||(x=
this.img_default_domain+x);if(t.iconFun){var y=t.iconFun(x);"string"===typeof y?x=y:(x=y.url,w=y)}if(w){var z=alp.cfg._ooi_normalize_xy(alp.filterIn(alp.opt(w,["size","anchor","origin","scaledSize"]),alp.f()));z.size&&(z.scaledSize=z.scaledSize||z.size)}w=alp.oCreateMix(u.icon||{},z);var A;w&&(A=w.scaledSize||w.size)&&(b.middle_anchor?w.anchor=new k.Point(A.width>>1,A.height>>1):b.middle_anchor_y&&(w.anchor=new k.Point(w.anchor.x||A.width>>1,A.height>>1)));x&&w&&(u.icon=f.markerImage_gen(x,w.size,
w.origin,w.anchor,w.scaledSize));u=alp.oCreateMix(u,{map:g,position:h,clickable:!0,title:t.title||alp.oGet(e._selection,[t.t,"title"])||""});(h=(b=alp.fVal(t.id||t.idlist[0]))&&e._id_2_singleMarkerOptions[b])&&alp.mix(u,h);m=f.marker_gen(u);m._alpInfo=alp.oCreateMix(t||{},{id:b});e._id_2_singleMarker[b]=m;f.event("addListener")(m,"dragstart",c);f.event("addListener")(m,"dragend",d);e.on_ooi_click&&f.event("addListener")(m,"click",alp.bindF(e.on_ooi_click,e,m,t));e.on_ooi_dblclick&&f.event("addListener")(m,
"dblclick",alp.bindF(e.on_ooi_dblclick,e,m,t));e.on_ooi_marker_mouseover&&f.event("addListener")(m,"mouseover",alp.bindF(e.on_ooi_marker_mouseover,e,m,t));e.on_ooi_marker_mouseout&&f.event("addListener")(m,"mouseout",alp.bindF(e.on_ooi_marker_mouseout,e,m,t));e.on_ooi_marker_dragend&&f.event("addListener")(m,"dragend",alp.bindF(e.on_ooi_marker_dragend,e,m,t));e._latest_single_marker_arr.push(m)}m._alpGroup=a;m._alpGmap=g;return m},remove_cell_later:function(a,b,c){var d=this._where_str(a);this._update_todo(d,
{name:"_remove_cell",args:[d]},b);if(!c&&(a=this._where_str_2_cell(a)))for(b=a.length;b--;)c=a[b],c="string"===typeof c?this._markers[c]:c,this._hide(c)},update_marker_later:function(a,b,c){a=this._where_str(a);this._update_todo(a,{name:"_update_marker",args:[a,b]},c)},_update_todo:function(a,b,c){if(this._last_will[a]){for(var d;-1<(d=alp.lastIndexOf(this._todo,a));)this._todo.splice(d,1);this._last_will[a]=void 0}this._todo[c?"unshift":"push"](a);this._last_will[a]=b},_remove_cell:function(a){var b=
this._where_str_2_cellindex(a);a=(a=(a=(a=(a=this._cells[b.zoom])&&a[b.x])&&a[b.y])&&a[b.sub_x])&&a[b.sub_y];if(!a)return!1;var c=!1;b=b.qq;var d=a[b];d&&this._remove_marker(d)&&(delete a[b],c=!0);return c},_remove_marker:function(a){var b,c;(c=(b=this._markers)&&b[a])||console.error("alp._gmap2_3.ClusterViewQueue._remove_marker(): found a bug! `h` must not be falsy-null-like.");if(c){var d=this._cells;delete d[c._alpWhereStr];c._alpPoolRemove?c._alpPoolRemove():(c.setMap(null),c._alpUnleak&&c._alpUnleak());
delete b[a];return!0}return!1},_get_cell:function(a,b,c,d,e,f){var l;return(l=this._cells)?null==a?l:(l=l[a])?null==b?l:(l=l[b])?null==c?l:(l=l[c])?null==d?l:(l=l[d])?null==e?l:(l=l[e])?null==f?l:(l=l[f])?l:null:null:null:null:null:null:null},_set_cell:function(a,b,c,d,e,f,g){var l=this._cells=this._cells||{};l=l[a]=l[a]||{};l=l[b]=l[b]||{};l=l[c]=l[c]||{};l=l[d]=l[d]||{};l=l[e]=l[e]||[];l[f]=g},_update_marker:function(a,b){var c=!1,d,e;if(this.gmapSt.get()){var f=this._markers=this._markers||{};
this._cells=this._cells||{};b&&(d=(e=this._get_cell(b.zoom,b.x,b.y,b.sub_x,b.sub_y,b.qq))&&f[e])&&(d._alpWhereStr===a&&this._equal_groups(d._alpGroup,b)||(c=c||this._remove_cell(e)));if(d=f[a]){if(this._equal_groups(d._alpGroup,b))return this._show(d),c;c=c||this._remove_cell(a)}if(!(b&&0<b.c)||1===b.c&&alp.oGet(b,["info_array",0,"from_summary"]))return c;d=this.group_2_marker(b);d._alpWhereStr=a;f[a]=d;this._set_cell(b.zoom,b.x,b.y,b.sub_x,b.sub_y,b.qq,a);this._show(d);return!0}console.error("alp._gmap2_3.ClusterViewQueue_update_marker() is buggy: no gmap found.")},
_equal_groups:function(a,b){if(!a||!b)return!1;var c=a.info_array,d=b.info_array,e=a.pix,f=b.pix;if(a.c!==b.c||a.zoom!==b.zoom||a.iconFun!==b.iconFun||!!e!==!!f||e&&!e.equals(f)||!!c!==!!d||c&&c.length!==d.length)return!1;if(c)for(e=c.length;e--;){f=c[e];var g=d[e];if(f.qt!==g.qt||f.t!==g.t)return!1}a=a.idlist;b=b.idlist;if(a^b)return!1;if(a){if(a.length!==b.length)return!1;for(e=a.length;e--;)if(c=a[e],c="string"===typeof c?c:c._alpId||c(),d=b[e],d="string"===typeof d?d:d._alpId||d(),c!==d)return!1}return!0},
_show:function(a){a&&!a.getMap()&&a.setMap(a._alpGmap)},_hide:function(a){a&&a.getMap()&&a.setMap(null)},clear:function(a){this.filter_zoom_levels(Infinity,!0,a)},DECISION_SHOW:2,DECISION_NOTHING:1,DECISION_HIDE:0,DECISION_REMOVE:-1,filter_zoom_levels:function(a,b,c){var d=this,e,l;c||(c=d.gmapSt.get());if(c){if("function"!==typeof a){var g=""+a;a=function(a,b){if(b&&b!==c)return d.DECISION_REMOVE;a-=g;return 0===a?d.DECISION_NOTHING:Math.abs(a)<=d.filter_dz_max?d.DECISION_HIDE:d.DECISION_REMOVE}}d._todo&&
0<d._todo.length&&(d._todo=alp.filter(d._todo,function(b){return(b=d._last_will&&d._last_will[b])&&(b.name="_update_marker")&&b.args&&1<b.args.length?d.DECISION_HIDE<a(b.args[1].zoom):!0}));var h=[];(l=d._markers)&&alp.forIn(l,function(l,g){var m=a(l._alpGroup.zoom,l._alpGmap);m!==d.DECISION_HIDE||l.getMap()||(m=d.DECISION_NOTHING);g=[g,l,m];b||(l=l.getPosition(),m=(e=c.getCenter())||l,g.push(alp.likeIE()?f.xyD2({x:l.lng(),y:l.lat()},{x:m.lng(),y:m.lat()}):m.distanceFrom(l)));h.push(g)});if(!b&&h&&
0<h.length){var m=h[0].length-1;h.sort(function(a,b){return b[m]-a[m]})}var k=0;alp.forEach(h,function(c){var e=0;var f=c[e++];var l=c[e++];e=c[e++];e===d.DECISION_HIDE&&k>=d.max_hidden&&(e=d.DECISION_REMOVE);e===d.DECISION_SHOW&&d._show(l);e!==d.DECISION_NOTHING&&(e===d.DECISION_HIDE?(d._hide(l),d._last_will[f]=void 0,k++):e===d.DECISION_REMOVE?(d._hide(l),d.remove_cell_later(f,!0)):console.error("ClusterViewQueue.filter_zoom_levels( decisionmaker: ",a,", do_not_sort_from_center:",b,"): unknown decision:",
e," for d:",c))});this.do_some()}},_filter_current_zoom_level:function(){var a=this.gmapSt.get();if(a){var b=alp.sub("_instanced._filter_current_zoom_level",this,!0);var c=a.getZoom();"number"!==typeof c||b._last_zoom===c&&b._last_gmap===a||(b._last_zoom=c,b._last_gmap=a,this.filter_zoom_levels(c))}else console.warn("alp._gmap2_3.ClusterViewQueue._filter_current_zoom_level(): no gmap found!")},update_rectangle_later:function(a,b,c,d,e){var l=this,g,h,m,n,r=this.gmapSt.get();if(r){if(e)var x=e.dbg_t();
var y=l._cells;var z=l._markers;var A=1<<a;var C=1<<c;var E=0;l.gmap_ind_str();var G=new RegExp("^\\("+a+",("+function(){var a,c,d=[];for(a=b.tile_sw_x;a<=b.tile_ne_x;a++){var e=[];for(c=b.tile_ne_y;c<=b.tile_sw_y;c++)e.push(c%A);d.push(a%A+",("+e.join("|")+")")}return d}().join("|")+")\\).*$");l._todo=alp.filter(l._todo,function(a){return!G.test(a)});l._last_will=alp.filter(l._last_will,function(a,b){return!G.test(b)});l.filter_zoom_levels(a);var B=l.gmap_ind();c=[];var I=y&&y[a];for(var L=b.tile_sw_x;L<=
b.tile_ne_x;L++){var J=L%A;var P=I&&I[J];y=d&&d[J];for(var H=b.tile_ne_y;H<=b.tile_sw_y;H++){var F=H%A;var D=P&&P[F];var M=y&&y[F];for(m=0;m<C;m++){var R=D&&D[m];var S=M&&M[m];for(n=0;n<C;n++){var T=R&&R[n];var Q=S&&S[n];var O=[];Q&&(O=[Q],Q.unmergeable_array.length&&(O=O.concat(Q.unmergeable_array)));for(var N=O.length;N--;)0<O[N].c||O.splice(N,1);N=0;for(var X=Math.max(O.length,T&&T.length||0);N<X;++N){var V=T&&T[N];if(Q=O[N]){var K={};for(var U in Q)U in K||(K[U]=Q[U]);Q=K;Q.zoom=a;Q.x=J;Q.y=F;
Q.sub_x=m;Q.sub_y=n;Q.qq=N}K=void 0;z&&V&&(K=V,K=z&&z[K]);V=void 0;Q&&(V=new k.LatLng(Q.lat,Q.lng));if(h=K&&Q&&V&&V.equals(K.getPosition())&&l._equal_groups(K._alpGroup,Q)&&l.gmap_str2ind(K._alpWhereStr)===B)l._show(K),l._last_will[K._alpWhereStr]=null;else{h=[void 0,void 0,void 0,void 0];var W=void 0;K&&(W=W||h,W[0]=K.getPosition(),W[2]=K,W[3]=K._alpWhereStr);Q&&(W=W||h,W[0]=V,W[1]=Q,W[3]=l._where_str([Q.zoom||a,J,F,m,n,N]));W&&c.push(W)}}}}}}e&&(a=e.dbg_t(),e.dbg_t_node_write("<p> - CVQ rectangle decide: "+
(a-x)/1E3+" seconds.</p>"));if(e)var Y=e.dbg_t();alp.forEach(c,function(a){g=g||r.getCenter();var b=a[0],c=g||b;a.push(alp.likeIE()?f.xyD2({x:b.lng(),y:b.lat()},{x:c.lng(),y:c.lat()}):c.distanceFrom(b))});if(c&&0<c.length){var aa=c[0].length-1;c.sort(function(a,b){return b[aa]-a[aa]})}e&&(x=e.dbg_t(),e.dbg_t_node_write("<p> - CVQ rectangle order: "+(x-Y)/1E3+" seconds.</p>"));if(e)var Z=e.dbg_t();alp.forEach(c,function(a){var b=a[0]&&a[1];a[2]&&(E<l.max_hidden?(l._hide(a[2]),E++):l.remove_cell_later(a[3]));
b&&l.update_marker_later(a[3],a[1])});e&&(Y=e.dbg_t(),e.dbg_t_node_write("<p> - CVQ rectangle update: "+(Y-Z)/1E3+" seconds.</p>"));this.do_some()}else console.warn("alp._gmap2_3.ClusterViewQueue.update_rectangle_later(): no gmap found!")}});var b="_cvq_reqing_s_m_info",c="_cvq_prob_not_pub"});"undefined"!==typeof dojo&&dojo.provide("alp.util.math.arr");
(function(){var k=alp.sub("alp.util.math",null,!0);k.median=function(h){h=[].concat(h);var g=h.length;h.sort(function(f,e){return f-e});return g%2?parseFloat(h[(g-1)/2]):(parseFloat(h[g/2])+parseFloat(h[g/2-1]))/2};k.mean=function(h){for(var g=0,f=0;f<h.length;f++)g+=h[f];return g/h.length}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.cluster_view");alp.i18n.fetch("alp.all");
alp.gmap3(function(k){var h=alp._gmap2_3,g=alp.content,f=alp.util,e=f.math,d=alp._gmap2_3.cluster.MANUALOOI_CATID,b={},c=alp.Aps;alp.i18n.fetch("alp.all").then(function(a){alp.mix(alp.sub("alp.all.i18n",null,!0),a)});alp.declare("alp._gmap2_3.ClusterView",f.Updater,alp.nowF(function(a,b,c){function d(a){alp.m(a,"bind_to",e.allIds_st,{delay_ms:e.updateAllIds_mindelay_ms})}var e=this;e.active_st=new alp.BoolState({init_value:!alp.opt(c,"init_inactive")});e.active_st.change_cb("_update_visibility",e);
e._get_polylineview_dfrd=alp.memF(alp.bindF("_get_polylineview_dfrd",e),"info");alp.mixCheck(e,c);null==e.infoWin_cluster&&(e.infoWin_cluster=!e.clusterPopup);e.model=a;e.gmapSt=b;e._gmapEh=new alp.Eh;alp.m(e.gmapSt,["changed_cb","change_cb"],function(){e.reinitGmap()});e.single_ooi_marker_opts=alp._gmap2_3.marker_opts.ooi_single_default();e.manualooivis_st=new alp.BoolState({init_value:!0});e.manualooivis_st.change_cb(function(){e.update("alp._gmap2_3.ClusterView:manulooivis_st changed",!0)});e.boundsCatCount_st||
(e.boundsCatCount_st=new alp.ObjectState);e.updateVisibleIds_st=new alp.BoolState({init_value:!1});e.boundsIds_st=new alp.SortedArrayState({init_value:[]});e.boundsVisibleIds_st=new alp.SortedArrayState({init_value:[]});e.updateAllIds_st=new alp.BoolState({init_value:!1});e.allIds_st=new alp.SortedArrayState({init_value:[]});(a=e.model.updateVisibleIds_st)&&e.updateVisibleIds_st.bind_to(a);(a=e.model.updateAllIds_st)&&e.updateAllIds_st.bind_to(a);e.model.change().thenSoon(alp.bindF("update",e,"model changed",
!0));e.model.alreadyloaded().thenSoon(alp.bindF("update",e,"model alreadyloaded",!0));(a=e.alternateSource_allIds_st_dfrd)?a.then(d):d(e.model.allIds_st);e.reinitGmap();e._view_cluster_loading(!1);e.cluster_wait_q&&(e.model.cluster_loading_stops().triggerSoon(alp.bindF("_view_cluster_loading",e,!1)),e.model.cluster_loading_starts().triggerSoon(alp.bindF("_view_cluster_loading",e,!0)));e.catSelStr_init&&e.getSelectionDfrd().thenSoon(function(){e.setCatSelStr(e.catSelStr_init)})}),h.InterfaceClusterViewOnClusterMouseover,
{init_inactive:!1,catLeavesOnly:!0,catSelDefault:!1,catSelCookie:!0,catSelCookieName:"alpOutdooractiveCatSel",catSelCookieOpt:{path:"/",expires:999999},extra_buffer:alp.likeFF()?0:.66,infoWinOpts:{suppressMapPan:!0,opacity:.88},do_merge:!0,cluster_min_dist_pix:alp.likeIE8minus_backslash_v()||alp.likeFF()?66:function(a){return Math.max(5,66-.5*a-(10<a?9*(a-10):0))},cluster_wait_class:"js-cluster-loading",cluster_wait_display:["none","inline"],lineOptions:null,lineOptionsDefault:{strokeColor:"#FF0000",
strokeWeight:5,strokeOpacity:.85},marker_opts:void 0,infoWin_cluster:null,infoWin_ooi:!0,polymouseover:!0,polylineModelOpts:{noNearestFinder:!0},dataTourMaxPoints:Infinity,dataTourMaxPointsPropAngle:.5,alternateSource_allIds_st_dfrd:null,catSelStr_init:null,info_window_gmap_shift:function(a,b,c){return{x:b+Math.max(10,a.getSize().width/7),y:c-Math.max(20,a.getSize().height/5)}},iwClass:null,info_window_cont_class:"js-cv-iw  cluster-view-iw",info_window_custom_html_or_node:null,ooi_iw_wait_html:function(){return alp.all.i18n.ooi_iw_loading||
"Laden..."},iw_domnode_customconnect:null,img_default_domain:alp.cfg.url.img_default_domain(),acceptUnpublished:!1,gmapSt:null,manualooivis_st:null,boundsCatCount_st:null,updateVisibleIds_st:null,updateVisibleIds_mindelay_ms:500,updateAllIds_st:null,updateAllIds_mindelay_ms:500,boundsIds_st:null,boundsVisibleIds_st:null,allIds_st:null,catName2Id:function(a){return this.model.catName2Id(a)},catId2Name:function(a){return this.model.catId2Name(a)},setMap:function(a){this.gmapSt.setNow(a)},getMap:function(){return this.gmapSt.get()},
setSingleMarkerOptions:function(a,b){var c=this;c.model.getDataPoint(a).then(function(d){(d=d&&d.dataPoint)?(d=d.id,(d||0).substring.call.a,c._mapqueue.setSingleMarkerOptions(d,b)):console.error("alp._gmap2_3.ClusterView.setSingleMarkerOptions("+a+") could not find the datapoint.")})},reinitGmap:function(a){var b=this._lastReinitGmap,c=this.gmapSt.get();this.clear_tour_overlays();c!==b&&(this._lastReinitGmap=c,b&&h.iwCloseAll(b),this._gmapEh.clear(),c&&h.V2()&&(this._gmapEh.push(h.event("addListener")(c,
"clearoverlays",function(){console.log("clearoverlays")}),h.event("removeListener")),this._gmapEh.push(h.event("addListener")(c,"clearoverlays",alp.asyncF(0,"update",this,"gmap clearoverlays",!0)),h.event("removeListener"))),a||(this._update_visibility(),this.update("alp._gmap2_3.ClusterView.reinitGmap("+a+")",!0)))},_view_cluster_loading:function(a){var b=this;alp.forEach(alp.gEBCN(b.cluster_wait_class),function(c){c.style.display=b.cluster_wait_display[a?1:0]})},set_active:function(a){this.active_st.set(a)},
_update_visibility:function(){var a=this.declaredClass+"._update_visibility()",b=this.gmapSt.get(),c=this.gmapSt.getPrevious();b=b&&this.active_st.get();this._view_cluster_loading(this.model.is_cluster_loading());b?(this.showhide_tour_overlays(!0),this.setUpdateActive(a,!0,!0),this.update(a,!0)):(this.showhide_tour_overlays(!1),this.setUpdateActive(a,!1),alp.m(this._mapqueue,"clear",c))},is_active:function(){return this.active_st.get()},gmap_ind_str:function(){return this._mapqueue&&this._mapqueue.gmap_ind_str()},
update_later:function(a,b,c){this._update_later_impl||(this._update_later_impl=alp.ratelimitF(alp.likeFF()?451:125,"update",this));alp.asyncF(a,"_update_later_impl",this)(b,c)},updateImpl:alp.nowF(function(a){function b(){var a=alp.opt(d,"gmapSt marker_opts single_ooi_marker_opts img_default_domain acceptUnpublished dynamicTooltip dynamicTooltipLoad".split(" "));alp.forEach("on_cluster_click on_cluster_mouseover on_ooi_click on_ooi_marker_mouseover on_ooi_marker_mouseout on_ooi_marker_dragend".split(" "),
function(b){a[b]=alp.bindF(b,d)});a.selectionDfrd=d.getSelectionDfrd();a.load_OOIs=alp.bindF("load_OOIs",d.model);return new alp._gmap2_3.ClusterViewQueue(a)}function c(a,b){a.proj=b;if(alp.m(d._mapqueue,"getDraggedMarker"))d.update_later(250,"CV_proj2update:do not update during dragging of a marker");else{a.dbg_t_out="";a.dbg_t_node_write=alp.asyncF(0,function(b){a.dbg_t_out+="\n"+b});a.dbg_t=function(){return Date.now?Date.now():+new Date};for(b=0;100>b&&d._current_ws===a;b++){var c=d["_updateStep"+
b];c&&c.call(d,a)}setTimeout(function(){a.dbg_t_node=alp.gEBI("dbg_t_measure");a.dbg_t_node&&(a.dbg_t_node.innerHTML=a.dbg_t_out)})}}var d=this;if(d.is_active()){if(1<alp.sub("djConfig.isDebug")){var f=(Date.now?Date.now():+new Date)/1E3;console.group("ClusterView.updateImpl( "+a+") "+f);console.trace()}d._mapqueue||(d._mapqueue=b());d.isSelectionInitialized()||d._initSelection();var g=d.gmapSt.get();if(g){var k=h.getProjection(g);var v=k&&g.getWorldBounds();f=k&&g.getZoom();if(k&&v&&null!=f){var u=
h.fromLatLngToPixel(k,v.getSouthWest(),f);v=h.fromLatLngToPixel(k,v.getNorthEast(),f);f=alp.oToString({bounds:[u.x,u.y,v.x,v.y],zoom:f})+d.gmap_ind_str()+"#"+d.model.getResetCount();if(!a&&this._last_loc_str&&this._last_loc_str===f){1<alp.sub("djConfig.isDebug")&&(console.log("ClusterView.updateImpl(): this._last_loc_str === loc_str  -> abort"),console.groupEnd());return}this._last_loc_str=f}d.catSelCookie&&!d._catSelCookieRead&&((a=alp.cookie(d.catSelCookieName))&&d.setCatSelStr(a,!1),d._catSelCookieRead=
!0);d.catSelCookie&&d._catSelCookieRead&&d._updateCatSelCookie();alp.subDfrd(alp.bindF("getWorldBounds",g)).thenSoon(function(a){var b={};d._current_ws=b;b.bounds=a;b.bounds_sw=a.getSouthWest();b.bounds_ne=a.getNorthEast();b.bounds_north=e.angleDelta(b.bounds_ne.lat(),0,180,90);b.bounds_south=e.angleDelta(b.bounds_sw.lat(),0,180,90);b.bounds_east=e.angleDelta(b.bounds_ne.lng(),0,360,180);b.bounds_west=e.angleDelta(b.bounds_sw.lng(),0,360,180);b.bounds_dateline_crossed=b.bounds_west>b.bounds_east;
b.zoom=g.getZoom();b.ntiles_zoom=Math.pow(2,b.zoom);b.npix_zoom=b.ntiles_zoom*d.model.cfg.tile_size;d.model.manual_preferred_bounds_st.set(a);h.getProjectionDfrd(g).thenSoon(alp.bindF(c,null,b))});1<alp.sub("djConfig.isDebug")&&(console.log("ClusterView.updateImpl(): done"),console.groupEnd())}else 1<alp.sub("djConfig.isDebug")&&(console.log("ClusterView.updateImpl(): !gmap  -> abort"),console.groupEnd())}}),_updateStep0:alp.nowF(function(a){if(!a.failed){var b=a.dbg_t();var c=a.gmap=this.gmapSt.get();
a.modelinfos=void 0;a.infos=void 0;if(c){var d=c.getSize();c=d.height||this._last_map_height||600;d=d.width||this._last_map_width||800;this._last_map_height=c;this._last_map_width=d;var e=a.bounds.getSouthWest(),f=a.bounds.getNorthEast();e=h.fromLatLngToPixel(a.proj,e,a.zoom);f=h.fromLatLngToPixel(a.proj,f,a.zoom);f.x<e.x&&(f.x+=a.npix_zoom);var g=new k.Size(Math.min(a.npix_zoom,d*(1+2*this.extra_buffer)),Math.min(a.npix_zoom,c*(1+2*this.extra_buffer)));c=new k.Size(Math.max(0,g.width-d),Math.max(0,
g.height-c));d=new k.Point(Math.round(e.x-c.width/2),Math.round(e.y+c.height/2));c=new k.Point(Math.round(f.x+c.width/2),Math.round(f.y-c.height/2));a.modelinfos=this.model.getInfos(d.x,d.y,c.x,c.y,a.zoom,this.manualooivis_st.get());a.infos=a.modelinfos&&a.modelinfos.infos}if(!a.modelinfos||!a.modelinfos.infos)return a.failed=!0,!1;c=a.dbg_t();a.dbg_t_node_write("<p>dbg_t_end_0 - dbg_t_start_0: "+(c-b)/1E3+" seconds.</p>");return!0}}),_updateStep1:alp.nowF(function(a){function b(a,c){if(c)if("c"in
c&&"lat"in c&&"lng"in c&&"t"in c){if(a=c.lat,!(a<E||G<a)){a=c.lng;if(z){if(C<a&&a<A)return}else if(a<A||C<a)return;a=c.t;null==f[a]&&(f[a]=0);f[a]+=c.c;if(c=y&&c.idlist){var d=g.hasOwnProperty(a)?g[a]:g[a]=[];1E4>c.length?d.push.apply(d,c):g[a]=g[a].concat(c)}}}else for(d in c)c.hasOwnProperty(d)&&b(d,c[d])}function c(){this._last_uvids=t;var a=this.manualooivis_st.get(),b;for(b in g)if(g.hasOwnProperty(b)){var c=g[b],e=c.length;1E4>e?h.push.apply(h,c):h=h.concat(c);if(b===d?a:this.isCategoryVisible(b))1E4>
e?k.push.apply(k,c):k=k.concat(c)}}if(!a.failed){var e=a.dbg_t(),f=a.bounds_cat_count=this._bounds_cat_count_0(),g=a.bounds_cat_ids={},h=[],k=[],u=this._last_uvids,t=Date.now?Date.now():+new Date,w=this.updateVisibleIds_st.get();u=u?this.updateVisibleIds_mindelay_ms-(t-u):0;var x=0<u,y=w&&!x,z=a.bounds_dateline_crossed,A=a.bounds_west,C=a.bounds_east,E=a.bounds_south,G=a.bounds_north;w&&x&&this.update_later(100+u,"need_to_uvids  &&  uvids_too_early",!0);b(null,a.infos);y&&c.call(this);w="undefined"!==
typeof JSON&&"function"===JSON.stringify?JSON.stringify(f):null;w&&w===this._last_bcc_summary_hash||(w&&(this._last_bcc_summary_hash=w),this.boundsCatCount_st.set(a.bounds_cat_count),this.catCountEvt().triggerSoon(a.bounds_cat_count));y&&(this.cat2idsCountEvt().triggerSoon(g),this.boundsIds_st.set(h),this.boundsVisibleIds_st.set(k),this.visibleIdsUpdateEvt().triggerSoon(k));w=a.dbg_t();a.dbg_t_node_write("<p>dbg_t_end_1 - dbg_t_start_1: "+(w-e)/1E3+" seconds.</p>")}}),_bounds_cat_count_0:function(){var a=
this._selection;if(!a)return{};var c={},d;for(d in a)d in b||a[d].children||(c[d]=0);return c},_updateStep2:alp.nowF(function(a){if(!a.failed){var b=a.dbg_t();a.groups={};var c,e,f,g,h,k,u=this.manualooivis_st.get(),t=1<alp.sub("djConfig.isDebug");for(C in a.infos)if(a.infos.hasOwnProperty(C)){var w=a.infos[C];for(c in w)if(w.hasOwnProperty(c)){var x=w[c];for(e in x)if(x.hasOwnProperty(e)){var y=x[e];for(f in y)if(y.hasOwnProperty(f)){var z=y[f];for(g in z)if(z.hasOwnProperty(g)&&((h=g===d)?u:this.isCategoryVisible(g)))if(!h&&
this._selection&&null==this._selection[g])t&&console.error("clusterview.js: updateImpl: Unknown category catid",g," in me._selection:",this._selection);else for(k=z[g].length;k--;)if(h=z[g][k],!h.ismanualooi||u){var A=a.groups[C]||(a.groups[C]={});A=A[c]||(A[c]={});A=A[e]||(A[e]={});A=A[f]||(A[f]=[]);A.push(h)}}}}}var C=a.dbg_t();a.dbg_t_node_write("<p>dbg_t_end_2 - dbg_t_start_2: "+(C-b)/1E3+" seconds.</p>")}}),_updateStep3:alp.nowF(function(a){if(!a.failed){var b=a.dbg_t();a.merged_groups={};a.msub_arr=
[];var c,d,e,f;for(c in a.groups)if(a.groups.hasOwnProperty(c)){var g=a.groups[c];for(d in g)if(g.hasOwnProperty(d)){var h=g[d];for(e in h)if(h.hasOwnProperty(e)){var k=h[e];for(f in k)if(k.hasOwnProperty(f)){var t=k[f];0<t.length&&(t=this._merge_groups(t,a.zoom,a.proj,a.ntiles_zoom),this._put_group(a.merged_groups,t,a.proj,a.ntiles_zoom),a.msub_arr.push(t))}}}}g=a.dbg_t();a.dbg_t_node_write("<p>dbg_t_end_3 - dbg_t_start_3: "+(g-b)/1E3+" seconds.</p>")}}),_updateStep4:alp.nowF(function(a){if(!a.failed){var b=
a.dbg_t(),c=this;a.do_merge=alp.fVal(c.do_merge,a.zoom);a.cluster_min_dist_pix=alp.fVal(c.cluster_min_dist_pix,a.zoom);(function(){if(a.do_merge){var b=Math.pow(2,a.zoom),d=a.cluster_min_dist_pix*a.cluster_min_dist_pix,e=[].concat(a.msub_arr);e.sort(function(a,b){return b.c-a.c});alp.forEach(e,function(e){if(e=c._get_group(a.merged_groups,e)){for(var f=[],l=2>b,g=-1;2>g;g++)for(var m=-1;2>m;m++)if(0!==g||0!==m){var k=c.model.tile_subtile_neighbor(e.x,e.y,e.sub_x,e.sub_y,g,m,b);(k=c._get_group(a.merged_groups,
k))&&h.xyD2(e.pix,k.pix)<d&&(!l||0>alp.lastIndexOf(f,k))&&f.push(k)}0<f.length&&(e=[e].concat(f),f=c._merge_groups(e,a.zoom,a.proj,a.ntiles_zoom),alp.forEach(e,function(b){a.merged_groups[b.x][b.y][b.sub_x][b.sub_y]=null}),c._put_group(a.merged_groups,f,a.proj,a.ntiles_zoom))}})}})();var d=a.dbg_t();a.dbg_t_node_write("<p>dbg_t_end_4 - dbg_t_start_4: "+(d-b)/1E3+" seconds.</p>")}}),_updateStep6:alp.nowF(function(a){if(!a.failed){var b=a.dbg_t();this._mapqueue.update_rectangle_later(a.zoom,a.modelinfos,
this.model.cfg.tile_sublevels,a.merged_groups,a);var c=a.dbg_t();a.dbg_t_node_write("<p>dbg_t_end_6 - dbg_t_start_6: "+(c-b)/1E3+" seconds.</p>")}}),_merge_groups:function(a,b,c,d){void 0===d&&(d=Math.pow(2,b));for(var f=0,l=[],g=[],m=[],r=[],t,w=[],x=a.length;x--;)if(t=a[x]){if(t.info_array)r=r.concat(t.info_array),t.unmergeable_array&&(w=w.concat(t.unmergeable_array));else if(t.isUnmergeable){w.push(t);continue}else r.push(t);l.push(t.c);g.push(t.lat);m.push(t.lng);f+=t.c}if(0<f)if(alp.likeIE()){var y=
e.mean(g);var z=e.mean(m)}else y=e.angleWmean(g,l),z=e.angleWmean(m,l);else 0<w.length&&(z=w[0],y=z.lat,z=z.lng);c=h.fromLatLngToPixel(c,new k.LatLng(y,z),b);d=this.model.tile_subtile(c,d);return{info_array:r,c:f,lat:y,lng:z,pix:c,zoom:b,x:d.x,y:d.y,sub_x:d.sub_x,sub_y:d.sub_y,unmergeable_array:w}},_get_group:function(a,b){if(a=a[b.x])if(a=a[b.y])if(a=a[b.sub_x])if(b=a[b.sub_y])return b},_put_group:function(a,b,c,d){var e=b.x,f=b.y,l=b.sub_x,g=b.sub_y;a=a[e]||(a[e]={});f=a[f]||(a[f]={});l=f[l]||(f[l]=
{});(f=l[g])?b.zoom!==f.zoom?(console.error("Inconsistent zoom levels! o:",b,", old:",f),l[g]=b):l[g]=this._merge_groups([f,b],b.zoom,c,d):l[g]=b},on_ooi_click:alp.nowF(function(a,b){var c=a._alpGmap;c?1!==b.c?console.error("clusterview.js _on_ooi_click: wrong info.c != 1",b):(b.id||(b=alp.oCreateMix(b,{id:b.idlist[0]})),b.id?(this.ooiMarkerClickEvt().triggerSoon(a,b),this.infoWin_ooi?this.openInfoWindowOOI(b,c,a.getPosition()):b.id&&this.ooiClickEvt().triggerSoon(b.id)):console.error("ClusterView:_on_ooi_click: could not extract the OOI id!")):
console.error("alp._gmap2_3.ClusterView._on_ooi_click(): missing marker._alpGmap on marker:",a)}),openInfoWindowOOI:function(a,b,c,d){"string"===typeof a&&(a={id:a});var e=this,f=alp.dfrd("AG CV: openInfoWindowOOI");if(b=b||e.gmapSt.get()){c&&(e._prepareGmapForInfo(c,b),e.openInfoWindow(b,c,e.ooi_iw_wait_html,e.infoWinOpts));var l=alp.opt(d,"html_source")||function(b,c){return function(b){e.model.get_ooi_iw(a,b)}},h=function(c,h){l(c,h)(function(l){e._prepareGmapForInfo(c,b);setTimeout(alp.nowF(function(){function h(){e.ooiClickEvt().triggerSoon(alp.fVal(a.id),
!0)}if(d&&d.html_source||"undefined"!==typeof alpregio||alp.sub("oax.api")){if(e.iwClass){var m="string"===typeof e.iwClass?e.iwClass:e.iwClass.join(" ");l="string"===typeof l?'<div class="'+m+'">'+l+"</div>":alp.aC(alp.cE("div",null,{"class":m}),l)}e.openInfoWindow(b,c,l,alp.oCreateMix(e.infoWinOpts||{},alp.opt(a,["id"],!0)))}else alp._gmap2_3.iwOpenOOI(b,alp.fVal(a.id),{proj:alp.oGet(e,"model.cfg.proj"),language:e.model.cfg.language||alp.i18n.language(),onClick:alp.nowF(h),iwClass:e.iwClass,position:c});
f.triggerSoon(!0);(m=d&&d.proj||alp.oGet(e,"model.cfg.proj"))&&g.trackTeaser({id:alp.fVal(a.id),proj:m})}))})};c?h(c):(new alp.data.SingleOOI(a.id,alp.oCreateMix(d||{},{language:e.model.cfg.language||alp.i18n.language()}))).load(function(a){var b=alp.data.ooi_geometry(a);b&&h(new k.LatLng(b.y,b.x),a)});return f}},openInfoWindow:function(a,b,c,d){c=alp.fVal(c);if(!a)throw Error("alp._gmap2_3.ClusterView.openInfoWindow: missing gmap parameter!");h.iwCloseAll(a);var e=this,f=alp._gmap2_3.iw_domnode_geomconnect(c,
alp.nowF(function(a,b,c){e.ooiClickEvt().triggerSoon(a,b,c)}),function(a,b,c){e.on_ooi_mouseover(a,b,c)},alp.oCreateMix(alp.opt(d,["id"],!0),{mouseover_without_geom:1}));c=alp.cE("div",null,{"class":e.info_window_cont_class});var l=e.iw_domnode_customconnect;l&&(l="function"===typeof l?[l]:l,alp.forEach(l,function(a){a.call(e,f)}));c.appendChild(f);this.info_window_custom_html_or_node&&(c=this.info_window_custom_html_or_node(c,alp.fVal(alp.opt(d,"id"))));alp._gmap2_3.iwOpen(a,b,c,d)},on_ooi_marker_mouseout:alp.nowF(function(a,
b){this._last_ooi_marker_mouseover===a&&(this._last_ooi_marker_mouseover=null,this.on_ooi_mouseover(),this.ooiMarkerMouseoutEvt().triggerSoon(a,b))}),on_ooi_marker_mouseover:alp.nowF(function(a,b){function c(a){(a=alp.data.single_ooi(a,e))?(a=g||alp.oGet(a,"data.title"),d(a)):console.error('cluster_view:set_tooltip: no data for id "'+e+'"')}function d(b){b&&a.setTitle&&b!==a.getTitle()&&a.setTitle(b)}if(this._last_ooi_marker_mouseover!==a)if(this._last_ooi_marker_mouseover=a,1!==b.c)console.error("clusterview.js : on_ooi_marker_mouseover: wrong info.c != 1",
b),this.on_ooi_mouseover();else{if(this.dynamicTooltip&&a.setTitle){var e=alp.fVal(b.id||b.idlist[0]),f=this._mapqueue.getSingleMarkerOptions(e),g=f&&f.title;g?d(g):(f=this.dynamicTooltipLoad?this.dynamicTooltipLoad([e]):this.model.load_OOIs([e],{minimal:!0}),alp.m(f,["thenSoon","then"],c))}this.on_ooi_mouseover(b);this.ooiMarkerMouseoverEvt().triggerSoon(a,b)}}),on_ooi_marker_dragend:alp.nowF(function(a,b,c){function d(){h.triggerSoon(a,b,l)}var e=alp.fVal(b.id||b.idlist[0]),f=alp.fVal(b.t),l=c.latLng,
g=this.model,h=this.ooiMarkerDragendEvt();(e||0).substring.call.a;(f||0).substring.call.a;g.removeDataPoint(alp.fVal(e)).then(function(){g.addDataPoint({id:e,catid:f,geom:l}).then(d)})}),showhide_tour_overlays:function(a){this._touroverlays().forEach(function(b,c){c.setMap(a?b:null)})},clear_tour_overlays:function(){this.showhide_tour_overlays(!1);this._touroverlays().clear()},_touroverlays:function(){var a=alp.mapany();return(this._touroverlays=function(){return a})()},on_ooi_mouseover:alp.nowF(function(a,
b){function c(a){var b=f.gmapSt.get();a&&b&&(f.clear_tour_overlays(),a.setMap(b),f._touroverlays().set(a,b))}if(a){a=alp.fVal(a);if("object"===typeof a){var d=alp.fVal(a.t);var e=alp.fVal(a.id||alp.fVal(a.idlist)[0])}else e=a;(e||null).substring.call.a}var f=this;f._last_on_ooi_mouseover_id!==e&&((f._last_on_ooi_mouseover_id=e)?f.polymouseover&&f._get_polylineview_dfrd({id:e,catid:d}).thenSoon(c):f.clear_tour_overlays())}),_get_polylineview_dfrd:function(a){if("string"===typeof a)var b=a;else{b=a.id;
var c=a.catid}b.substring.call.a;null==c||c.substring.call.a;var d=this,e=alp.dfrd("AG CV: _get_polylineview_dfrd");d.model.get_ooi_geometry({id:b,simplified:!0,catid:c},alp.nowF(function(a){function c(a){return a&&a.length&&("number"===typeof a[0][0]?h.xy2latlng(a):alp.map(a,c))}var f=b+".clusterview_geom_simplified_coord",l=alp.db.common();"string"===typeof a&&(a=alp.oFrom(a));!a.coordinates&&a.tour&&a.tour&&(a.coordinates=a.tour.coordinates||a.tour.encPolyline&&h.decodePolyline(a.tour.encPolyline).xy);
var g=a.coordinates;var m=alp.mix({},d.lineOptionsDefault,a.lineOptions,alp.sub("tour.lineOptions",a),d.lineOptions);if(a.type&&"multipolygon"===a.type.toLowerCase()){for(;g.length&&"number"!==typeof g[0][0][0];)g=alp.arrChain(g);g=c(g);m=alp.oCreateMix({paths:g},m);m=new k.Polygon(m)}else if(g&&g[0]&&g[0]instanceof Array){a=d.dataTourMaxPoints;var n=d.dataTourMaxPointsPropAngle;a&&g&&(g=alp.simplifyGeom(g,a,n));l.getset(f,g);g=c(g);m=alp.oCreateMix({path:g},m);m=h.polylineGen(m)}else m=null;e.triggerSoon(m)}));
return e},_prepareGmapForInfo:function(a,b){b=b||a._alpGmap;if(!this.clusterPopup){var c=alp.m(a,"getPosition")||a;if(a=h.getProjection(b)){var d=b.getZoom();c=h.fromLatLngToPixel(a,c,d);c=this.info_window_gmap_shift(b,c.x,c.y);c=h.fromPixelToLatLng(a,c,d)}b.setCenter(c)}},on_cluster_click:alp.nowF(function(a){if(a){var b=a._alpInfoArray;!b||!b.length||1>b.length?console.error("clusterview.js  on_cluster_click: missing _alpInfoArray field!"):this.clusterMarkerClickEvt().triggerSoon(a)}}),infoArray_fetch_visible_idlist_cb:function(a,
b){var d=alp.bindF.apply(alp,c.call(arguments,1)),e=this.clusteriwlist_visible(a),f=e.idlist.concat(alp.map(e.manual_qtidlist,function(a){return a[1]}));e=e.qttypelist;if(f&&!e)d(f);else throw Error("ClusterView: qttypelist not supported anymore because we dropped support for cluster info windows!");},clusteriwlist_visible:function(a){var b=this,c=[],d=[],e=b.manualooivis_st.get();alp.forEach(a,function(a){var f=e&&a.ismanualooi;if(f||b.isCategoryVisible(a.t)){if(f){if(a.idlist){d=d.concat(alp.map(a.idlist,
function(b){return[a.qt,b]}));return}if(a.id){d.push([a.qt,a.id]);return}}else{if(a.idlist){c=c.concat(a.idlist);return}if(a.id){c.push(a.id);return}}throw Error("ClusterView: qttypelist not supported anymore because we dropped support for cluster info windows!");}});return{idlist:alp.map(c,alp.fVal),manual_qtidlist:alp.map(d,alp.fVal)}},setAllCatVisible:function(a,b){this._selection||this._initSelection();if(this._selection){var c=this._selection,d=!1,e;for(e in c)c.hasOwnProperty(e)&&c[e].enabled!==
a&&(c[e].enabled=a,d=!0,b||this._catSelChanged(e,c[e].enabled));d&&!b&&this.update("ClusterView.setAllCatVisible("+a+","+b+")",!0)}else console.error("clusterview.js setAllCatVisible( enabled:",a,"): this._selection initialisation failed.")},setCatSelected:function(a,b,c,d){2<alp.sub("djConfig.isDebug")&&console.group("clusterview.js setCatSelected( origin:",a,"catid:",b,", enabled:",c,"): start.");"string"!==typeof b&&(b=""+b);this._selection||this._initSelection();if(!this._selection)console.error("clusterview.js setCatSelected( origin:",
a,"catid:",b,", enabled:",c,"): this._selection initialisation failed.");else if(!this._selection[b])console.error("clusterview.js setCatSelected( origin:",a,"catid:",b,", enabled:",c,"): this._selection[ "+b+" ] is undefined.");else if(this._selection[b].enabled!==c){this._selection[b].enabled=c;this._catSelChanged(b,this._selection[b].enabled);2<alp.sub("djConfig.isDebug")&&console.group("ClusterView.setCatSelected: update children");var e=this._selection[b].children,f;for(f in e)e.hasOwnProperty(f)&&
(2<alp.sub("djConfig.isDebug")&&console.log("child x:",f),this.setCatSelected("ClusterView.setCatSelected(origin:"+a+") - updateChildren",f,c,!0));2<alp.sub("djConfig.isDebug")&&console.groupEnd();2<alp.sub("djConfig.isDebug")&&console.group("ClusterView.setCatSelected: update parents");for(e=this._selection[b];f=e.parent;){2<alp.sub("djConfig.isDebug")&&console.log("parent_id:",f);e=this._selection[f];var l=!1,g;for(g in e.children)if(e.children.hasOwnProperty(g)&&(l=l||this._selection[g].enabled))break;
2<alp.sub("djConfig.isDebug")&&console.log("parent_id:",f," -> ",l,e.enabled);l!==e.enabled&&(e.enabled=l,this._last_loc_str=null,2<alp.sub("djConfig.isDebug")&&console.log("parent_id:",f,", newState:",l,", current.enabled:",e.enabled,"this._selection[ parent_id ].enabled:",this._selection[f].enabled),this._catSelChanged(f,this._selection[f].enabled))}2<alp.sub("djConfig.isDebug")&&console.groupEnd();d||(this.update("ClusterView.setCatSelected("+a+","+b+","+c+","+d+")",!0),this.catSelCookie&&this._updateCatSelCookie(),
this._trigger_allCatSelChangeEvt())}2<alp.sub("djConfig.isDebug")&&console.groupEnd()},_trigger_allCatSelChangeEvt:function(){this.allCatSelChangeEvt().triggerSoon(this.getAllCatSel())},getAllCatSel:function(){return alp.mapIn(this._selection,".enabled")},isCategoryChecked:function(a){if(!a)return!1;"string"!==typeof a&&(a=""+a);this._selection||this._initSelection();if(!this._selection)return this.catSelDefault;if(!this._selection[a]){var b=alp.sub("_unknown",this,!0);!a||/^(undefined|null|NaN)$/i.test(a)||
b[a]||(b[a]=1,console.error("alp._gmap2_3.ClusterView The data (e.g. clv2.json) contains a category id "+a+" not in the category tree (ClusterConfig). This category will thus not appear on the map. "));return this.catSelDefault}return this._selection[a].enabled},isCategoryLeaf:function(a){return this._selection[a]?!this._selection[a].children:(console.error("clusterview.js isCategoryLeaf( catid:",a," ): this._selection[ "+a+" ] is undefined."),!0)},isCategoryVisible:function(a){if(a===alp._gmap2_3.cluster.MANUALOOI_CATID)return this.manualooivis_st.get();
var b=this.isCategoryChecked(a);b&&this.catLeavesOnly&&this._selection[a]&&(b=this.isCategoryLeaf(a));return b},areAllCatVisible:function(){if(!this._selection)return!0;for(var a in this._selection)if(this._selection.hasOwnProperty(a)&&(!this.catLeavesOnly||this.isCategoryLeaf(a))&&!this.isCategoryChecked(a))return!1;return!0},whichCatVisible:function(){this._selection||this._initSelection();var a=[],b;for(b in this._selection)this._selection.hasOwnProperty(b)&&this.isCategoryVisible(b)&&a.push(b);
return a},getParents:function(a){var b=this.getSelection(),c=[];for(a={parent:a+""};a.parent&&(a=b&&b[a.parent])&&a.parent;)c.unshift(a.parent);return c},getSelection:function(){this._selection||this._initSelection();return this._selection},getSelectionDfrd:alp.memM("getSelectionDfrd",'alp.dfrd( "AG CV: selection", { then : 1 } )'),_initSelection:function(){var a=this;if(!a._selection){var b=a.model.getCat();if(b){var c={};alp.treeForEach(b,"children",function(b,d,e){d=alp.filterIn(d[b],function(a,
b){return"children"!==b||0<alp.oKeys(a).length});d.enabled=a.catSelDefault;d.parent=e;c[b]=d;b=d.name;!b||b in c||(c[b]=d)});a._selection=c;a.getSelectionDfrd().triggerSoon(a._selection)}}},isSelectionInitialized:function(){return!!this._selection},connectCheckbox:alp.nowF(function(a){1<alp.sub("djConfig.isDebug")&&(console.group("ClusterView.connectCheckbox: "),console.log("checkbox:",a));var b=this;a._alpClickEvt.thenSoon(function(c){c=alp.gA(a,"catid");var d=typeof c;if("number"===d||"string"===
d)c=[c];alp.forEach(c,function(c){b.setCatSelected("ClusterView.connectCheckbox()",c,a.checked,!1)});b.update("ClusterView.connectCheckbox() after setCatSelected()",!0)});this.getSelectionDfrd().thenSoon(function(b){var c=alp.gA(a,"catid");if(c){var d=typeof c;if("number"===d||"string"===d)c=[c];if(0<c.length){d=0;for(var e=c.length;d<e;d++){var f=b[c[d]];f&&(f.cblist||(f.cblist=[])).push(a)}}}return b});1<alp.sub("djConfig.isDebug")&&console.groupEnd()}),_updateCatSelCookie:function(){var a=alp.cookie(this.catSelCookieName);
alp.cookie(this.catSelCookieName,this.getCatSelStr(),this.catSelCookieOpt);var b=this.getCatSelCookie();a!==b&&this.catSelCookieChangeEvt().triggerSoon(b)},getCatSelCookie:function(){return alp.cookie(this.catSelCookieName)},getCatSelStr:function(){return f.iawEncode(alp.map(this._getSelectionCatidSorted(),function(a){return this.isCategoryChecked(a)?1:0},this))},setCatSelStr:function(a,b){if(a){var c=f.iawDecode(a),d=this._getSelectionCatidSorted();if(d.length!==c.length)console.warn("clusterview setCatSelStr error",
d.length,c.length);else{for(var e=Math.min(d.length,c.length),g=0;g<e;g++){var h=d[g];this.catLeavesOnly&&!this.isCategoryLeaf(h)||this.setCatSelected("ClusterView.setCatSelStr()",h,!!c[g],!0)}b||this.update('alp._gmap2_3.ClusterView.setCatSelStr("'+a+'", '+b+")",!0)}}},_getSelectionCatidSorted:function(){var a=alp.oKeys(this._selection);a.sort();return a},catSelChangeEvt:alp.memM("catSelChangeEvt",'alp.event("AG CV: catSelChange")'),allCatSelChangeEvt:alp.memM("allCatSelChangeEvt",'alp.event("AG CV: allCatSelChangeEvt")'),
catCountEvt:alp.memM("catCountEvt",'alp.event("AG CV: catCount")'),cat2idsCountEvt:alp.memM("cat2idsCountEvt",'alp.event("AG CV: cat2idsCount")'),catSelCookieChangeEvt:alp.memM("catSelCookieChangeEvt",'alp.event("AG CV: catSelCookieChange")'),ooiClickEvt:alp.memM("ooiClickEvt",'alp.event("AG CV: ooiClickEvt")'),ooiMarkerClickEvt:alp.memM("ooiMarkerClickEvt",'alp.event("AG CV: ooiMarkerClickEvt")'),ooiMarkerMouseoverEvt:alp.memM("ooiMarkerMouseoverEvt",'alp.event("AG CV: ooiMarkerMouseoverEvt")'),
ooiMarkerMouseoutEvt:alp.memM("ooiMarkerMouseoutEvt",'alp.event("AG CV: ooiMarkerMouseoutEvt")'),ooiMarkerDragendEvt:alp.memM("ooiMarkerDragendEvt",'alp.event("AG CV: ooiMarkerDragendEvt")'),clusterMarkerClickEvt:alp.memM("clusterMarkerClickEvt",'alp.event( "AG CV: clusterMarkerClickEvt" )'),clusterMarkerMouseoverEvt:alp.memM("clusterMarkerMouseoverEvt",'alp.event( "AG CV: clusterMarkerMouseoverEvt" )'),visibleIdsUpdateEvt:alp.memM("visibleIdsUpdateEvt",'alp.event( "AG CV: visibleIdsUpdateEvt" )'),
_catSelChanged:alp.nowF(function(a,b){this.getSelectionDfrd().thenSoon(function(c){c=c[a].cblist||[];b=!!b;alp.forEach(c,function(a){a.checked!==b&&(a.checked=b)})});this.catSelChangeEvt().triggerSoon(a,b)})})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.cluster_controller");
alp.gmap3(function(k){var h=alp._gmap2_3;alp.declare("alp._gmap2_3.ClusterController",alp.util.Updater,function(g,f,e){var d=this;d._opts=e;var b=e.acceptUnpublished;d.url_or_source=f;d.marker_opts=e&&e.marker_opts;d.model_ctor=e&&e.model_ctor||d.default_model_ctor;d.model_opts=alp.oCreate(e&&e.model_opts||d.default_model_opts);d.model_opts.acceptUnpublished=b;d.boundsCatCount_st=e.boundsCatCount_st||new alp.ObjectState;d.view_ctor=e&&e.view_ctor||d.default_view_ctor;d.view_opts=alp.oCreateMix(e&&
e.view_opts||d.default_view_opts,{init_inactive:e&&e.init_inactive,boundsCatCount_st:d.boundsCatCount_st});d.view_opts.acceptUnpublished=b;d.init_loadOpts=alp.opt(e,"init_loadOpts");d.init_force=alp.opt(e,"init_force");d.gmapSt=g instanceof alp.State||g instanceof alp.data.State?g:new alp.State({init_value:g});d._gmapEh=new alp.Eh;alp.m(d.gmapSt,["changed_cb","change_cb"],function(){d.reinitGmap()});g=typeof f;if("object"==g)d._init(f);else if("string"==g)alp.jsonp(f).then(alp.bindF("_init",d));else throw Error("Invalid type "+
g);},{default_model_ctor:alp._gmap2_3.ClusterModel,default_model_opts:{},default_view_ctor:alp._gmap2_3.ClusterView,default_view_opts:{},clusterMaxZoom:17,_init:alp.nowF(function(g){var f=this;f._cfg=g;f._model=new f.model_ctor(alp.oCreateMix(f._cfg,f.model_opts));alp.forEach(["cluster_loading_starts","cluster_loading_stops"],function(e){f._model[e]().thenSoon(alp.bindF("triggerSoon",f[e]()))});f._view=new f.view_ctor(f._model,f.gmapSt,f.view_opts);f.reinitGmap(!0);f._model.whenLoaded(function(){f.modelDfrd().triggerSoon(f._model);
f.viewDfrd().triggerSoon(f._view)});f.init_cb("update",f);f.update("alp._gmap2_3.ClusterController._init("+g+")",f.init_loadOpts,f.init_force)}),init_dfrd:function(){return this.viewDfrd()},init_cb:alp.nowF(alp.eventCB("init_dfrd")),setMap:function(g){this.gmapSt.setNow(g)},getMap:function(){return this.gmapSt.get()},reinitGmap:function(g){var f=this,e=f.gmapSt.get();e!==f._lastReinitGmap&&(f._lastReinitGmap=e,f._gmapEh.clear(),e&&(f._gmapEh.push(h.event("addListener")(e,"bounds_changed",alp.asyncF(0,
function(){f.update("gmap moveend")})),h.event("removeListener")),f.model_cb(function(d){d.reset_evt().thenSoon(alp.asyncF(0,function(){f.update("model reset")}))}),g||this.update("alp._gmap2_3.ClusterController.reinitGmap()",void 0,!0)))},set_active:function(g){var f=g&&!this.is_active(),e=this;e.view_cb(function(d){d.set_active(g);f&&(d.setUpdateActive("clustercontroller.set_active",!0,!0),e.setUpdateActive("clustercontroller.set_active",!0,!0),e.update(),e.is_active_changed().triggerSoon())})},
is_active:function(){var g=this._view&&this._view.is_active();1<alp.sub("djConfig.isDebug")&&console.log("---------- "+this.declaredClass+".is_active(): returning: "+g);return g},active_st_dfrd:function(){var g=alp.dfrd("AGC_CC: active_st");this.view_cb(function(f){g.triggerSoon(f.active_st)});return(this.active_st_dfrd=function(){return g})()},active_st_cb:alp.nowF(alp.eventCB("active_st_dfrd")),getCat:function(){return this._model&&this._model.getCat()},setAllCatVisible:function(g,f){this.view_cb(function(e){e.setAllCatVisible(g,
f)})},setCatSelected:function(g,f){alp.sub("djConfig.isDebug")&&console.group("ClusterController.setCatSelected( "+g+","+f+")");var e=this._view&&this._view.setCatSelected("ClusterController.setCatSelected()",g,f);alp.sub("djConfig.isDebug")&&(console.log("ClusterController.setCatSelected( "+g+","+f+") returning ret:",e),console.groupEnd());return e},setSelection:function(g){this._selection=g;this.update("alp._gmap2_3.ClusterController.setSelection("+g+")")},getSelection:function(){return this._view&&
this._view.getSelection()},isSelected:function(g){var f=this.getSelection();return f&&f[g]&&f[g].enabled},modelDfrd:alp.memM("modelDfrd",'alp.dfrd("AGC_CC: modelDfrd")'),model_cb:alp.nowF(alp.eventCB("modelDfrd")),viewDfrd:alp.memM("viewDfrd",'alp.dfrd("AGC_CC: viewDfrd")'),view_cb:alp.nowF(alp.eventCB("viewDfrd")),infoArray_fetch_visible_idlist_cb:function(g,f){var e=arguments;this.view_cb(function(d){d.infoArray_fetch_visible_idlist_cb.apply(d,e)})},set_manual_ooi_vis:function(g){this.view_cb(function(f){f.manualooivis_st.set(g)})},
get_manual_ooi_vis:function(){var g=this._view;return g&&g.manualooivis_st.get()},add_manual_oois:function(g,f){this.model_cb(function(e){e.init_cb("add_manual_oois",e,g,f)})},remove_manual_oois:function(g){this.model_cb(function(f){f.init_cb("remove_manual_oois",f,g)})},get_manual_ooi_ids:function(){var g=this._model;return g&&g.get_manual_ooi_ids()||[]},setDataPointIcon:function(g,f){this.model_cb(function(e){e.setDataPointIcon(g,f)})},unsetDataPointIcon:function(g){this.model_cb(function(f){f.unsetDataPointIcon(g)})},
setDataPointUnmergeable:function(g,f){this.model_cb(function(e){e.setDataPointUnmergeable(g,f)})},setSingleMarkerOptions:function(g,f){var e=this;e.model_cb(function(d){e.view_cb(function(b){b.setSingleMarkerOptions(g,f)})})},updateImpl:alp.nowF(function(g,f){if(alp.sub("djConfig.isDebug")){var e=Date.now?Date.now():+new Date;console.group("alp._gmap2_3.ClusterController.updateImpl() "+e);console.log("alp._gmap2_3.ClusterController.updateImpl() start",g,", this:",this,", this && this.declaredClass:",
this&&this.declaredClass)}var d=this,b=alp.sub("_instanced.updateImpl",this,!0);g||(g=b._last_loadOpts);b._last_loadOpts=g;if(d.is_active()){var c=d.gmapSt.get();alp.and([c,d._model,d._view])?(h.getProjectionDfrd(c).thenSoon(function(a){alp.subDfrd(function(){return c.getBounds()}).then(function(){function e(){a=d._model.get_gproj();var b=h.fromLatLngToPixel(a,g,q),c=h.fromLatLngToPixel(a,k,q);!f&&d._eqLastUpdate(q,b,c,p,v)?alp.sub("djConfig.isDebug")&&(console.log("                Update already done"),
console.groupEnd()):(d._model.setLoadOpts(v),d._model.update("alp._gmap2_3.ClusterController.updateImpl()",b.x,b.y,c.x,c.y,q))}var l=c.getBounds(),g=l.getSouthWest(),k=l.getNorthEast(),q=Math.min(d.clusterMaxZoom,c.getZoom()),p=d._view.getCatSelStr(),v=b._last_loadOpts;g.equals(k)?(l=b._last_up_bounds||l,g=l.getSouthWest(),k=l.getNorthEast()):l&&(b._last_up_bounds=l);d._model.set_gproj(a);d._model.init_cb(alp.bindF("whenLoaded",c,e));d._model.init_cb(alp.bindF("then",alp.subDfrd(function(){return d._model&&
d._model.get_gproj()}),e))})}),alp.sub("djConfig.isDebug")&&(console.log("alp._gmap2_3.ClusterController.updateImpl() end"),console.groupEnd())):alp.sub("djConfig.isDebug")&&(console.log("!all( [gmap:",c,", me._model:",d._model,", me._view:",d._view,"] )  -> abort"),console.groupEnd())}else alp.sub("djConfig.isDebug")&&console.groupEnd()}),_eqLastUpdate:function(g,f,e,d,b){var c=this._last;b=alp.oToString(b);if(!this._model)return!1;var a=Math.pow(2,g);f=alp.map([f.x,f.y,e.x,e.y],function(b){return this._model.tileint(b,
a)},this);e=this.gmapSt.get();var h=this._model.getResetCount();if(c&&c.zoom===g&&c.tile_bbox&&c.tile_bbox[0]===f[0]&&c.tile_bbox[1]===f[1]&&c.tile_bbox[2]===f[2]&&c.tile_bbox[3]===f[3]&&c.catselstr===d&&c.loadOptsStr===b&&c.gmap===e&&c.resetCount===h)return!0;c={};c.zoom=g;c.tile_bbox=f;c.catselstr=d;c.loadOptsStr=b;c.gmap=e;c.resetCount=h;this._last=c;return!1},is_active_changed:alp.memM("is_active_changed",'alp.event("AGC:CC:is_active_changed")'),cluster_loading_starts:alp.memM("cluster_loading_starts",
'alp.event("AGC:CC:cluster_loading_starts")'),cluster_loading_stops:alp.memM("cluster_loading_stops",'alp.event("AGC:CC:cluster_loading_stops")')})});"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.bounds_extend");
(function(){alp.sub("alp.maps",null,!0).bounds_extend=function(k,h){var g,f,e=k.slice&&2===k.length&&"object"===typeof k[0]&&2===k[0].length&&"number"===typeof k[0][0]?k:(g=k.getSouthWest(),f=k.getNorthEast(),[[g.lat(),g.lng()],[f.lat(),f.lng()]]);g=e[0][1];f=e[0][0];var d=e[1][1],b=e[1][0];k=h?k:alp.oCopy(e);"0"in k||(alp.mix(k,e),"0"in k||null.bug);"west"in k||(k.west=g,k.south=f,k.east=d,k.north=b);"sw"in k||(k.sw={lat:f,lng:g},k.ne={lat:b,lng:d});return k}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.layer.cluster_layer");
(function(){function k(a,b,c){var d=a.getPosition();this.map=a._alpGmap;this.latlng=new r.LatLng(d.lat(),d.lng());this.is_cluster=!a._alpInfo;if(!this.is_cluster)this.id=a._alpInfo.id,this.catid=a._alpInfo.t,alp.mix(this,alp.data.external_info(this.id));else if(a._alpInfoArray){d=alp.map(a._alpInfoArray,alp.f(".idlist"));if(alp.and(d)){for(var e=d[0],f=1,l=d.length;f<l;f++)e=e.concat(d[f]);this.idlist=alp.map(e,alp.fVal)}this.catid=a._alpInfoArray.t}this.load=function(d){var e=alp.bindF.apply(alp,
arguments);b.infoArray_fetch_visible_idlist_cb(a._alpInfoArray||[a._alpInfo],function(a){(new alp.data.OOIs({proj:c.proj,idlist:a,language:c.locale||alp.i18n.language(),xdomain:null,lightweightApp:c.lightweightApp,acceptUnpublished:b._opts.acceptUnpublished})).load(e)})}}function h(a,b){function c(b){(new m.OOIs({idlist:b,proj:a.proj,language:a.locale||alp.i18n.language(),acceptUnpublished:a.acceptUnpublished})).load(function(c,d){a.init_cb(function(){var c=alp.arr2o(d);alp.forEach(d,"(w = alp.data.external_info(v,null,true)), (w && (this[ w ] = v))",
c);a._alp.cc.add_manual_oois(b,c)})})}for(b=[].concat(b);b.length;)c(b.splice(0,100))}function g(a,b){a.init_cb(function(){a._alp.cc.remove_manual_oois(b)})}function f(d){var e={};if(d){if(null!=d[b]&&(e.n=d[b],null!=d[c])){var f=d[c],l=new r.LatLngBounds(new r.LatLng(f[1],f[0]),new r.LatLng(f[3],f[2]));e.bbox=a.bbox_extend(f);e.bounds=a.bounds_extend(l);e.gmBounds=l}d.inputMeta&&(e.inputMeta=d.inputMeta)}return e}var e=alp._gmap2_3,d=e.qt7bit,b=d.NQTDATAPOINT,c=d.DATABBOX,a=alp.maps;d=alp.util;var m=
alp.data,l=alp.Aps,r;alp.gmap3(function(a){r=a});alp.declare("alp._gmap2_3.ClusterLayer",e.AbstractIWMarkerLayer,alp.nowF(function(b){function c(){null!=h&&clearTimeout(h);h=setTimeout(function(){var b=d._alp.mapSt.get();if(b){var c=d.getMetaData();if(c=c&&c.gmBounds){var e=a.bounds2zoomcenter(c,b.getDiv());alp.gmap3(function(a){var c=e.center,d=e.zoom;b.setCenter(new a.LatLng(c.lat,c.lng),d);b.__alp_lf__||b.setZoom(d)})}}},250)}var d=this;if(this.clusterPopup&&!this.clusmod2)throw Error("alp._gmap2_3.ClusterLayer: constructor(): `clusterPopup != false` requires `clusmod2 != false`!");
this.config_url||(this.config_url=this.config_url_default);d._alp.boundsCatCount_st=new alp.ObjectState;d.addEvent("visibleCatCountChange");d._alp.boundsCatCount_st.change_cb(alp.bindF("triggerEvent",d,"visibleCatCountChange"));d.addEvent("visibleIdsUpdate");d._alp.dataPointList_st=new alp.State({init_value:d.initDataPointList});var e=d.mapIcon&&(d.mapIcon.scaledSize||d.mapIcon.size);e=e&&1.5*Math.max.apply(Math,e);alp.isFiniteNumber(e)&&(null==d.clusterPopupMinDist&&(d.clusterPopupMinDist=.75*e),
null==d.clusterPopupMinRadius&&(d.clusterPopupMinRadius=13+.6*e));d.cc_opts=alp.oCreateMix(d.cc_opts_default(),d.cc_opts);b.base_url&&(d.cc_opts.model_opts.base_url=b.base_url);d.cc_opts.model_opts.base_url=alp.tmpl(d.cc_opts.model_opts.base_url,d);d.cc_opts.model_opts.language=d.locale;if(d.v2=d.clusmod2)d.cc_opts.model_ctor=d.cluster_model_ctor,alp.oSet(d.cc_opts,"view_opts.extra_buffer",alp.likeFF()||alp.likeIE8minus_backslash_v()?0:.22);alp.mix(d.cc_opts.model_opts,alp.opt(d,["proj","manualOnly",
"initDataPointList","proto"]));e=d.cc_opts.view_opts=d.cc_opts.view_opts||{};e.clusterPopup=d.clusterPopup;e.dynamicTooltip=d.dynamicTooltip;e.dynamicTooltipLoad=d.dynamicTooltipLoad;e.catSelCookie=!1;e.iwClass=d.iwClass;e.lineOptions=null;var l="clusterPopupMinDist";null!=d[l]&&(e[l]=d[l]);l="clusterPopupMinRadius";null!=d[l]&&(e[l]=d[l]);e.infoWin_ooi=!d.noAlpIW;e.infoWin_cluster=!(d.noAlpIW||d.clusterPopup);l=d.clusterIcon;var g=d.clusterStyle;l&&g&&console.error("cluster_layer: either `clusterIcon` or `clusterStyle`, but not both!");
alp.oSet(e,"marker_opts.cluster_marker_cfg",l);l||alp.oSet(e,"marker_opts.cluster_style_cfg",g);b.view_opts&&alp.mixCheck(d.cc_opts.view_opts,b.view_opts);d.addEvent("manualooiidlistChange");d._alp.manualoois_st=new alp.PrimitiveSetState;d._alp.manualoois_st.change_cb(function(){d.triggerEvent("manualooiidlistChange")});d._alp.clusterConfigSt.change_cb("_install_clusterConfig",d);d._alp.cc_dfrd=alp.dfrd("ClusterLayer: ClusterController dfrd",{then:1});d.addEvent("clusterLoadStart");d.addEvent("clusterLoadEnd");
d.cc_cb(alp.nowF(function(a){a.cluster_loading_starts().thenSoon(function(){d.triggerEvent("clusterLoadStart")});a.cluster_loading_stops().thenSoon(function(){d.triggerEvent("clusterLoadEnd")})}));d.addEvent("allCatSelChange");d._catSelChangedListeners={};d.addEvent("clusterMetaChange");d._first_cmc_emitted_dfrd=alp.dfrd("CL:cmc:first");(d.cc_opts.model_opts.cluster_meta_st=d._alp.cluster_meta_st=new alp.ObjectState).change_cb(function(a){a=f(a);d.triggerEvent("clusterMetaChange",a);d._first_cmc_emitted_dfrd.done()});
d.fitDataBounds&&(d._alp.cluster_meta_st.change_cb_init(c),d._alp.mapSt.change_cb(c));var h}),d.InterfaceWithInit,{base_url:null,cl_url:alp.cfg.url.cluster_layer_cl(),cc_opts_default:function(){return{model_opts:{base_url:alp.cfg.url.cluster_layer_base(),xdomain:null},boundsCatCount_st:this._alp.boundsCatCount_st,acceptUnpublished:this.acceptUnpublished}},cc_opts:null,view_opts:null,proj:null,lightweightApp:null,initCat:"showall",manualOnly:!1,initDataPointList:null,fitDataBounds:!1,clusterIcon:null,
clusterStyle:null,clusterPopup:!0,clusterPopupMinDist:null,clusterPopupMinRadius:null,clusmod2:!0,proto:!1,dynamicTooltip:!0,dynamicTooltipLoad:null,acceptUnpublished:!1,onAllCatSelChange:null,onManualooiidlistChange:null,onClusterLoadStart:null,onClusterLoadEnd:null,onClusterMetaChange:null,onVisibleCatCountChange:null,cluster_controller_ctor:alp.f("alp._gmap2_3.ClusterController"),hideAllCats:function(){this.setAllCatsSelected(!1)},showAllCats:function(){this.setAllCatsSelected(!0)},setAllCatsSelected:function(a){this._view_cb(function(b){b.setAllCatVisible(a)})},
isCatSelected:function(a){var b=this._alp&&this._alp.cc;return b&&b.isSelected(a)},setCatSelected:function(a,b){this._view_cb(function(c){c.setCatSelected("alp._gmap2_3.ClusterLayer.setCatSelected()",a,b)})},addCatSelChangedListener:function(a,b){return this._addCatSelChangedListener.apply(this,arguments)},dropCatSelChangedListener:function(a){return this._dropCatSelChangedListener.apply(this,arguments)},getMetaData:function(){return f(this._alp.cluster_meta_st.get())},hideManualOOIs:function(){this.setManualOOIVis(!1)},
showManualOOIs:function(){this.setManualOOIVis(!0)},setManualOOIVis:function(a){var b=this;b.init_cb(function(){b._alp.cc.set_manual_ooi_vis(a)})},areManualOOIsVisible:function(){var a=this._alp&&this._alp.cc;return a&&a.get_manual_ooi_vis()},addManualOOIs:alp.nowF(function(a){a=alp.map(a,function(a){return"string"===typeof a?a:alp.data.createCustomOOI(a)});this._alp.manualoois_st.addArray(a);h(this,a);return a}),removeManualOOIs:alp.nowF(function(a){this._alp.manualoois_st.delArray(a);g(this,a)}),
getManualOOIids:function(){return this._alp.manualoois_st.getArray()},setManualOOIs:alp.nowF(function(a){for(var b=a.length,c=Array(b),d=this._alp.manualoois_st;b--;){var e=a[b];c[b]="string"===typeof e?e:m.createCustomOOI(e)}a=d.setArray(c,!0);g(this,a.del);h(this,a.add);return c}),iwOpenOOI:function(a,b){var c=this;c._view_cb(function(d){function f(){b&&b.fit&&c.fitOOI(a,{iw:!0})}function l(){var b={proj:c.proj};c.noAlpIW&&(b.html_source=function(a,b){return function(a){a(c.customIW.render([b.data]))}});
return d.openInfoWindowOOI({id:a},null,null,b)}b&&b.showTour&&c.showTour(a);e.V3()?(f(),alp.asyncF(0,l)()):l().then(f)})},showTour:function(a){this._view_cb(function(b){alp.m(b,"on_ooi_mouseover",a)})},centerOOI:function(a,b){b=alp.oCreateMix(b||{},{proj:this.proj});var c=this.getMap();c?c.centerOOI(a,b):console.error("alp._gmap2_3.ClusterLayer.centerOOI(): no map instance (this.getMap()==null). Please call this.setMap(map) first.")},fitOOI:function(a,b){b=alp.oCreateMix(b||{},{proj:this.proj});var c=
this.getMap();if(c)return c.fitOOI(a,b);console.error("alp._gmap2_3.ClusterLayer.fitOOI(): no map instance (this.getMap()==null). Please call this.setMap(map) first.")},cc_cb:alp.eventCB("_cc_dfrd",{then:1}),sendDataPoint:function(a,b){var c=alp.dfrd("ClusterLayer: sendDataPoint",{then:1});this.removeDataPoint(a).then(function(a){function d(b){c.triggerSoon(alp.mix({},a,b))}a?b.addDataPoint(a.oldDataPoint).then(d):c.triggerSoon(!1)});return c},getDataPoint:function(a){return this._modifyDataPoint.apply(this,
["get"].concat(l.call(arguments)))},getDataPointArray:function(a){return this._modifyDataPoint.apply(this,["getDataPointArray"].concat(l.call(arguments)))},removeDataPoint:function(a){return this._modifyDataPoint.apply(this,["remove"].concat(l.call(arguments)))},addDataPoint:function(a){return this._modifyDataPoint.apply(this,["add"].concat(l.call(arguments)))},getDataPointList:function(){var a=this._alp.dataPointList_st.get();return a?a.slice():a},setDataPointList:alp.nowF(function(a){this._alp.dataPointList_st.set(a);
return this._modifyDataPoint.apply(this,["setDataPointList"].concat(l.call(arguments)))}),setDataPointIcon:function(a,b){var c=arguments;this.cc_cb(function(a){a.setDataPointIcon.apply(a,c)})},unsetDataPointIcon:function(a){var b=arguments;this.cc_cb(function(a){a.unsetDataPointIcon.apply(a,b)})},setDataPointUnmergeable:function(a,b){var c=arguments;this.cc_cb(function(a){a.setDataPointUnmergeable.apply(a,c)})},setSingleMarkerOptions:function(a,b){var c=arguments;this.cc_cb(function(a){a.setSingleMarkerOptions.apply(a,
c)})},whenLoaded:alp.nowF(d.AbstractWithInit.prototype.whenLoaded),init_cb:alp.nowF(d.AbstractWithInit.prototype.init_cb),_cc_dfrd:function(){return this._alp.cc_dfrd},_view_cb:function(a){var b=alp.bindF.apply(alp,arguments);this.cc_cb(function(a){a.view_cb(b)})},_model_cb:function(a){var b=alp.bindF.apply(alp,arguments);this.cc_cb(function(a){a.model_cb(b)})},_install_clusterConfig:alp.nowF(function(a){function b(a,b){var d=c._alp.cc=new (alp.fVal(c.cluster_controller_ctor))(c._alp.mapSt,b,c.cc_opts);
c._alp.cc_dfrd.triggerSoon(d);d.view_cb(alp.nowF(function(b){if(c.initCat){var e=c.initCat.toLowerCase();"showall"===e?b.setAllCatVisible(!0):"hideall"===e&&b.setAllCatVisible(!1)}b.catSelChangeEvt().thenSoon(alp.bindF("_notifyCatSelChanged",c));b.allCatSelChangeEvt().thenSoon(function(a){c.triggerEvent("allCatSelChange",a)});c.triggerEvent("allCatSelChange",b.getAllCatSel());b.ooiMarkerClickEvt().thenSoon(function(a){c.triggerEvent("markerClick",new k(a,d,c))});b.ooiMarkerMouseoverEvt().thenSoon(function(a){c.triggerEvent("markerMouseover",
new k(a,d,c))});b.ooiMarkerMouseoutEvt().thenSoon(function(a){c.triggerEvent("markerMouseout",new k(a,d,c))});b.ooiMarkerDragendEvt().thenSoon(function(b,e){e=new a.LatLng(alp.fVal(e.lat),alp.fVal(e.lng));c.triggerEvent("markerDragend",new k(b,d,c),{oldPosition:e})});c.clusterPopup||alp.forEach([{from:"clusterMarkerClickEvt",to:"markerClick"},{from:"clusterMarkerMouseoverEvt",to:"markerMouseover"}],function(a){b[a.from]().thenSoon(function(b){c.triggerEvent(a.to,new k(b,d,c))})});c.noAlpIW||b.ooiClickEvt().thenSoon(function(a,
b,d){if(b){var e=d||alp.data.external_info(a),f=function(){c.triggerEvent("iwSelect",alp.oCreateMix(e,{id:a}))};e?f():(new alp.data.SingleOOI(a,{proj:c.proj})).load(function(a){e=alp.data.external_info(a.data);f()})}});c.stEventHasListeners("visibleIdsChange").bind_to(b.updateVisibleIds_st);b.boundsVisibleIds_st.change_cb("triggerEvent",c,"visibleIdsChange");b.visibleIdsUpdateEvt().thenSoon(function(a){c.triggerEvent("visibleIdsUpdate",a)});c.stEventHasListeners("allIdsChange").bind_to(b.updateAllIds_st);
b.allIds_st.change_cb("triggerEvent",c,"allIdsChange");c._first_cmc_emitted_dfrd.thenSoon(alp.bindF("mark_init_done",c))}))}var c=this;a&&!c._alp.cc&&alp.gmap3(function(c){b(c,a)})}),_notifyCatSelChanged:function(a,b){if(a=this._catSelChangedListeners[a])for(var c=0,d=a.length;c<d;c++)alp.asyncF(0,a[c])(b)},_addCatSelChangedListener:function(a,b){if(a&&"string"===typeof a){var c=this._catSelChangedListeners;c=c[a]||(c[a]=[]);var d=alp.bindF.apply(alp,l.call(arguments,1)),e=[a,d];c.push(d);return e}console.error("catId must be a non-empty string, you gave:",
a)},_dropCatSelChangedListener:function(a){var b=a[1],c=(a=this._catSelChangedListeners[a[0]])&&alp.lastIndexOf(a,b);if(-1<c)return b===a.splice(c,1)},_modifyDataPoint:function(a){var b=l.call(arguments,1),c=alp.dfrd("ClusterLayer: modifyDataPoint: "+a,{then:1}),d=/datapoint/i.test(a)?a:a+"DataPoint";this._model_cb(alp.nowF(function(a){if(!a[d])throw Error('alp._gmap2_3.ClusterLayer._modifiyDataPoint(): the model does not support method "'+d+'"');a[d].apply(a,b).then(alp.bindF("triggerSoon",c))}));
return c}})})();"undefined"!==typeof dojo&&dojo.provide("alp.data.pagermodel");
(function(){var k=function(){throw Error(this.declaredClass+" is abstract. Provide your own implementation.");},h=alp.Aps,g=alp.sub("alp.data",null,!0);g.InterfacePagerModel={content_dfrd:function(f){k()},content_cb:function(f){var e=this.content_dfrd(f);alp.m(e,["then","addCallback"],alp.bindF.apply(alp,h.call(arguments,1)))},contents_dfrd:function(f){var e=alp.dfrd("AD InterfacePagerModel: contents_dfrd",{then:1});f&&0<f.length?(f=alp.map(f,this.content_dfrd,this),alp.sub("dojo.Deferred")&&f[0]instanceof
dojo.Deferred?dojo.DeferredList.prototype.gatherResults(f).addCallback(alp.nowF(function(d){e.triggerSoon(d)})):alp.gatherDfrd(f,{then:1}).then(function(d){e.triggerSoon(h.call(d))})):e.triggerSoon([]);return e},contents_cb:function(f){alp.m(this.contents_dfrd(f),["then","addCallback"],alp.bindF.apply(alp,h.call(arguments,1)))},nitems:function(){k()},item_cb:function(f){var e=alp.bindF.apply(alp,h.call(arguments,1));this.contents_cb([f],function(d){if(null==d[0])throw Error("InterfacePagerModel.item_cb: got an empty item #"+
f,d[0]);e(d[0])})},changed:function(){},_changed:alp.asyncF(0,"changed")};alp.declare("alp.data.PagerReadOnlyModel",null,function(f){this._data=f||[]},alp.data.InterfacePagerModel,{content_dfrd:function(f){var e=alp.dfrd("AD PagerReadOnlyModel: content_dfrd: a:"+f);e.triggerSoon(this._data[f]);return e},nitems:function(){return this._data.length}});alp.declare("alp.data.PagerReadWriteModel",null,function(f){this._data=f||[]},alp.data.InterfacePagerModel,{content_dfrd:function(f){var e=alp.dfrd("AD PagerReadWriteModel: content_dfrd: a: "+
f,{then:1});e.triggerSoon(this._data[f]);return e},nitems:function(){return this._data.length},insert:function(f,e){var d=Math.max(0,Math.min(this.nitems(),f));f!==d&&console.error(this.declaredClass+".insert("+f+","+e+") fixed the index to "+d);this._data.splice(d,0,e);this._changed()},push:function(f){this._data.push(f);this._changed()},del:function(f){if(1>this.nitems())console.error(this.declaredClass+".pop(): model empty.");else{var e=Math.max(0,Math.min(this.nitems()-1,f));f!==e&&console.error(this.declaredClass+
".del("+f+") fixed the index to "+e);f=this._data.splice(e,1);this._changed();return f}},pop:function(){if(1>this.nitems())console.error(this.declaredClass+".pop(): model empty.");else{var f=this._data.pop();this._changed();return f}}});alp.declare("alp.data.PagerPagingModel",null,function(f,e,d){this.nipp=f;this.loadPageImpl=e;alp.mix(this,d);this._items=this._nitems=void 0;this._init_dfrd=alp.dfrd("alp.data.pagermodel init",{then:1});this._loading={};this.init_json&&this.install_load_result(alp.oFrom(this.init_json));
this.init()},g.InterfacePagerModel,{buffer_npages:2,nipp:10,init_json:void 0,init:function(){this.is_initialized()||this._is_initializing||(this._is_initializing=!0,this._load_page(0))},init_dfrd:function(){return this._init_dfrd},init_cb:alp.eventCB("init_dfrd",{then:1}),is_initializing:function(){return!!this._is_initializing},is_initialized:function(){return this._init_dfrd.triggered()},_load_page:function(f,e,d){var b=this;e=e||b.nipp*(1+b.buffer_npages);b._loading=b._loading||{};b._loading[e]=
b._loading[e]||{};if(b._loading[e][f])return d?void 0:b._loading[e][f];d=b._loading[e][f]=b.loadPageImpl(f,e);alp.m(d,["then","addCallback"],alp.nowF(function(c){b._loading[e][f]=void 0;b.install_load_result(c)}));return d},install_load_result:function(f){if(f&&void 0!==f.nitems&&void 0!==f.items){var e=!1,d=this;d._nitems!==f.nitems&&(d._nitems=f.nitems,d._items=Array(d._nitems),e=!0);d._items||(d._items=[]);alp.forIn(f.items,function(b,c){b=b||null;d._items[c]!==b&&(d._items[c]=b,e=!0)});d.is_initialized()||
(e=!0,d._init_dfrd.triggerSoon(!0));e&&d._changed()}else console.error(this.declaredClass+".install_load_result() received a wrong load_result object:",f)},nitems:function(){return this.is_initialized()?this._nitems:0},content_dfrd:function(f){var e=alp.dfrd("PagerPagingModel: content_dfrd: "+f,{then:1});this.contents_dfrd([f]).then(function(d){e.triggerSoon(d[0])});return e},contents_dfrd:function(f){var e=(f||[]).slice(),d=alp.dfrd("AD PagerPagingModel: contents_dfrd",{then:1}),b=this;this._init_dfrd.then(function(){function c(a){return alp.filter(a,
function(a){return-1<a&&a<b._nitems&&void 0===b._items[a]})}function a(){d.triggerSoon(alp.map(f,function(a){var c=b._items[a];alp.sub("djConfig.isDebug")&&void 0===c&&console.error(b.declaredClass+".contents_dfrd() insane ! n, this._nitems, this._items:",a,b._nitems,b._items);return c}))}var g;var l=b.nipp;var h=[];if((g=e&&e.length&&[Math.min.apply(Math,e),Math.max.apply(Math,e)])&&0<g.length){var k=g[1];for(g=k+1;g<k+1+l*b.buffer_npages;g++)h.push(g)}h=c(h);g=c(e);var q=l*(1+Math.max(0,b.buffer_npages));
var p={};alp.forEach(g,function(a){p[Math.floor(a/q)]=!0},b);var v={};alp.forEach(h,function(a){a=Math.floor(a/q);v[a]=!p[a]},b);var u=[];alp.forIn(p,function(a,c){(a=b._load_page(c,q))&&u.push(a)},b);alp.forIn(v,function(a,c){b._load_page(c,q)},b);alp.sub("dojo.Deferred")&&u[0]instanceof dojo.Deferred?dojo.DeferredList.prototype.gatherResults(u).addCallback(a):alp.gatherDfrd(u,{then:1}).then(a)});return d}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.filter_pager_model");
(function(){var k=alp.Aps;alp.sub("alp._gmap2_3.cluster",null,!0).filter_pager_model=function(h,g,f,e,d,b){function c(a){return d.has(l(a))}function a(a,b,c,e){var f={};f.nitems=e;f.items={};for(e=0;e<a.length;e++)f.items[e+b*c]=d.getset(l(a[e]));return f}function m(f,k){var n=this,q=!(b||n.is_initialized()),u;void 0===k&&(k=g);f=parseInt(f,10);k=parseInt(k,10);q=e(h.sw,h.ne,void 0,alp.oCreateMix(h,{page:parseInt(f,10)+1,ntpp:h.ntpp||k,allids:!!q}));var t=alp.dfrd("agcFPM_loadPageImpl: p:"+f+" ntpp:"+
k,{then:1});if(n.is_initialized()&&r){var w=[];for(u=f*k;u<Math.min((f+1)*k,n.nitems());u++)w.push(r[u]);if(alp.and(w,c)){var x=a(w,f,k,n.nitems());t.triggerSoon(x);return t}}(m[q]||(m[q]=alp.jsonp(q))).then(function(c){n.is_initialized()||(n._nitems=c.nresult,!b&&c.allids&&"number"===typeof c.allids.length&&(r=c.allids,n._nitems!==r.length&&(console.error(n.declaredClass+": invalid data received! that._nitems:"+n._nitems+" differs from _allids.length:"+r.length),n._nitems=Math.min(n._nitems,r.length))));
r||(r=Array(n._nitems));u=f*k;alp.forEach(c.ids,function(a){r[u]=a||r[u];u++},n);for(var e=f*k;e<u;e++)/^[+-]?\d+$/.test(r[e])||console.error("filter_pager_model: invalid id",e,r[e]);e=c.ids;c=c.html;for(var g=e.length,h=0;h<g;h++){var m=e[h],q=c[h];if(!m||!q){console.error('alp._gmap2_3.cluster.filter_pager_model: XHR returned an invalid pair(id, html): id:"'+m+'", html:"'+q+'"');return}d.getset(l(m),q+"")}x=a(e,f,k,n.nitems());t.triggerSoon(x)});return t}d||(d=alp.db.common());var l=alp.f('+".shorthtml"');
return new alp.data.PagerPagingModel(g,m,{buffer_npages:f,nitems:function(){return this._nitems},cancel:function(){},idToN_dfrd:function(a){var b=alp.dfrd("agcFPM_idToN_dfrd: id:"+a,{then:1});this.init_cb(function(){b.triggerSoon(a&&r&&alp.indexOf(r,a))});return b},idToN_cb:function(a){this.idToN_dfrd(a).then(alp.bindF.apply(alp,k.call(arguments,1)))},nToId_dfrd:function(a){var b=alp.dfrd("agcFPM_nToId_dfrd: n:"+a,{then:1});this.init_cb(function(){var c=r&&r[a];null!=c?b.triggerSoon(c):console.error("agcFPM_nToId_dfrd: "+
a+" failed to find an `id`.")});return b},nToId_cb:function(a){this.nToId_dfrd(a).then(alp.bindF.apply(alp,k.call(arguments,1)))}});var r}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.filter_cluster_model");
alp.gmap3(function(k){var h=alp._gmap2_3.ClusterModel,g=alp.sub("alp._gmap2_3",null,!0),f=alp.declare("alp._gmap2_3.FilterClusterModel",h,function(e){var d=this;d._filterDefaultParam=d._filterDefaultParam();e.initFilter&&alp.mix(d._filterDefaultParam,e.initFilter);alp.forEach(["proj","request","v","splithtml"],function(b){"undefined"!==typeof e[b]&&(d._filterDefaultParam[b]=""+e[b])});alp.forEach("tour_list_min_delay_ms ntpp auto_load_tour_list pager_buffer pager_db pager_never_allids".split(" "),
function(b){void 0!==e[b]&&(d[b]=e[b])});d.pager_buffer=Math.max(0,d.pager_buffer)},{_filterDefaultParam:function(){return{proj:"",request:"tours",category:"",checks:"",types:"",typ:"",area:"",period_s:"",period_e:"",price_s:"",price_e:"",asc_s:"",asc_e:"",tim_s:"",tim_e:"",len_s:"",len_e:"",dif_e:"false",dif_m:"false",dif_d:"false",qul_b:"true",qul_p:"true",qul_s:"true",tags:"",ntpp:"",splithtml:"false",v:"1",allids:"false",sortedBy:"",state:"",q:""}},tour_list_min_delay_ms:1E3*(alp.likeIE()?3.45:
1),auto_load_tour_list:!1,pager_buffer:2,pager_db:void 0,pager_never_allids:!0,ntpp:function(){void 0===this._ntpp&&(this._ntpp=this.ntpp);void 0===this._ntpp&&(this._ntpp=alp.sub("alpConfig.cluster.tour_list_ntpp"));return this._ntpp||""},tour_list_pixmin2:function(){var e=this.cfg.tour_list_pixmin;void 0===e&&(e=50);return e*e},updateImpl:function(e,d,b,c,a){function f(){this._load_tour_list(v,k,n)}var l=this._loadOpts||{};this._checkFilterSettings();h.prototype.updateImpl.apply(this,arguments);
if(this.auto_load_tour_list){var k=this.fromPixelToLatLng(e,d,a),n=this.fromPixelToLatLng(b,c,a),q=new GPoint(e,d),p=new GPoint(b,c),v=Date.now?Date.now():+new Date;l=l&&l._tourlist_last_sw_ne;l&&a===l.zoom&&this.tour_list_pixmin2()>Math.max(g.xyD2(q,l.sw),g.xyD2(p,l.ne))||(this._loadOpts=this._loadOpts||{},this._loadOpts._tourlist_last_sw_ne={zoom:a,sw:q,ne:p,date:v},f=alp.likeIE()||l&&l.date?alp.asyncF(this.tour_list_min_delay_ms,f,this):alp.bindF(f,this),f())}},_load_url_template:function(){return this.cfg.filter_cluster_url},
_load_url:function(e,d,b,c,a){return this._safe_substitute(this._load_url_template(),alp.mix({},this._filterDefaultParam,{x:e,y:d,z:b,l:c},this._loadOpts))},_load:function(e,d,b,c,a){this._checkFilterSettings();return f.parent.prototype._load.apply(this,arguments)},_checkFilterSettings:function(){var e={gmap_lat:1,gmap_lng:1,gmap_z:1,gmap_type:1,sortedBy:1},d=function(b,a){return!(a in e)},b=alp.filterIn(this._loadOpts||{},d);d=this._old_loadOpts&&alp.filterIn(this._old_loadOpts||{},d);alp.oEqual(d,
b)||(this._old_loadOpts=alp.oCopy(b),d&&this.reset())},_load_tour_list:function(e,d,b,c){var a=this,f=a._loadOpts&&a._loadOpts._tourlist_last_sw_ne;if(f&&f.date&&f.date!==e&&f.date>e)return!1;null==c&&(c=a.cfg.retryCountMax);c=a._load_tour_list_url(d,b,c);if(c===a._last_tour_list_url)return!1;a._last_tour_list_url=c;alp.jsonp(c).then(function(c){var f=a._loadOpts&&a._loadOpts._tourlist_last_sw_ne;f&&f.date&&f.date!==e&&f.date>e||(f.date=void 0,a._tourListReceive(e,d,b,c))});return!0},_load_tour_list_url:function(e,
d,b,c){c=c||this._loadOpts||{};e=alp.mix({},this._filterDefaultParam,{bbox:c.use_current_bbox?[e.lng(),e.lat(),d.lng(),d.lat()]:["","","",""],ntpp:this.ntpp()},c);e.subids&&(e.types=e.types||e.subids);e.bbox&&e.bbox.length&&e.bbox[0]>e.bbox[2]&&(0<e.bbox[2]?e.bbox[0]-=360:e.bbox[2]+=360);return this._safe_substitute(this._load_tour_list_url_template(),e)},_load_tour_list_url_template:function(){return this.cfg.filter_list_url},_tourListReceive:function(e,d,b,c){if(e=this.tour_shortinfo_map_fun())c.html=
"string"!==typeof c.html?alp.map(e,c.html):e(c.html);this.tourListReceivedEvt().triggerSoon(c)},get_pager_model:function(e,d,b,c){var a=arguments.length;return alp._gmap2_3.cluster.filter_pager_model(e,d,this.pager_buffer,alp.bindF("_load_tour_list_url",this),2<a?b:this.pager_db,3<a?c:this.pager_never_allids)},tourListReceivedEvt:alp.memM("tourListReceivedEvt",'alp.event( "AG: FCM: tourListReceivedEvt")')})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.cluster.filter_cluster_controller");
alp.gmap3(function(k){var h={},g=alp.sub("alp._gmap2_3",null,!0),f=alp.declare("alp._gmap2_3.FilterClusterController",alp._gmap2_3.ClusterController,function(e,d,b){e=b.single_docType_or_all;null!=e&&(this.single_docType_or_all=e)},{default_model_ctor:alp._gmap2_3.FilterClusterModel,default_view_opts:{catSelCookie:!1},single_docType_or_all:!0,constructor:function(e,d,b){e=b.single_docType_or_all;null!=e&&(this.single_docType_or_all=e)},_init:function(e){var d=this;alp.forEach([{orig:"filter_cluster2_url",
must_be_variable:{qt7bit_from:"${qt7bit_from}",qt7bit_to:"${qt7bit_to}"}},{orig:"filter_cluster2_chunk_url",must_be_variable:{chunk_ind:"${chunk_ind}"}}],function(a){function b(){return alp.mix({proj:"${proj}"},d._model._filterDefaultParam,d._model._loadOpts,alp.m(d._opts.filter_st,"get"))}var c=a.orig.replace("filter_cluster","cm"),f=e[a.orig];"string"===typeof f&&(e[c]=function(){var c=alp.mix(b(),a.must_be_variable),d;for(d in c)d in h||d&&0>f.indexOf("&"+d+"=")&&(f+="&"+d+"=${"+d+"}");c=alp.tmpl(f,
c,function(a){return alp.isNaN(a)||null==a?"":a},"").split("?");return c[0]+"?"+c[1].replace(/[^=&]+=&|[\?&][^=&]=$/g,"")},e[c+"_getInputMeta"]=b)});f.parent.prototype._init.apply(this,arguments);var b=e.filter_cluster_selection;if(b)for(var c in b)b.hasOwnProperty(c)&&this._view.setCatSelected("FilterClusterController._init()",c,b[c])},updateImpl:function(e,d){function b(a){var b=c._updateImpl_lastLoadOpts;b&&(b=a.catName2Id(b.activity_name)||b.activity_name,a.setUpdateActive("FilterClusterControler.updateImpl() callback",
!1),b?(a.setAllCatVisible(!1,!0),a.setCatSelected("FilterClusterController.updateImpl() callback",b,!0,!0)):a.setAllCatVisible(!0,!0),a.setUpdateActive("FilterClusterControler.updateImpl() callback",!0),a.update("alp._gmap2_3.FilterClusterController.updateImpl()",d))}var c=this;e&&"object"===typeof e?c._updateImpl_lastLoadOpts=e:e=c._updateImpl_lastLoadOpts;if(c.is_active()){var a=alp.oToString(e);if(d||e&&e.use_current_bbox||c._last_loadOpts_str!==a)c._last_loadOpts_str=a}e&&c.single_docType_or_all&&
c.view_cb(b);f.parent.prototype.updateImpl.apply(c,arguments);if(c.is_active()&&(c._update_pagerlikes(e),a=c._model.cfg.cluster_meta_st)){var g=a.get()||{};g=alp.mix({},g,{inputMeta:e});a.set(g)}},control_pager:function(e){this._pagerlike_arr=this._pagerlike_arr||[];-1<alp.lastIndexOf(this._pagerlike_arr,e)||(this._pagerlike_arr.push(e),this.update())},release_pager:function(e){this._pagerlike_arr&&(e=alp.lastIndexOf(this._pagerlike_arr,e),0>e||this._pagerlike_arr.splice(e,1))},set_pager_type_name:function(e,
d){this._pager_type_name!==e&&(this._pager_type_name=e,d||this.update())},_update_pagerlikes:function(e){var d=this;d.view_cb(function(b){var c;b.is_active()&&d.model_cb(function(a){c=a.tour_list_min_delay_ms;void 0===c&&(c=1E3);d._loadOpts=alp.mix({},e,{typ:d._pager_type_name});a=!1;var b=Date.now?Date.now():+new Date;null!=d._update_pagerlikes_impl_last_call_time&&(a=b-d._update_pagerlikes_impl_last_call_time<c);d._update_pagerlikes_impl_last_call_time=b;a?window.setTimeout(function(){d._update_pagerlikes_impl_last_call_time===
b&&d._update_pagerlikes_now(d._loadOpts)},c):d._update_pagerlikes_now(d._loadOpts)})})},_update_pagerlikes_now:function(e){var d,b,c,a=alp.sub("_instanced._update_pagerlikes",this,!0),f=this;e&&f.model_cb(function(l){f.view_cb(function(h){function m(){var a=k.getCenter();var c=k.getZoom();var d=l.fromLatLngToPixel(a.lat(),a.lng(),c);var e=alp.m(k,"getWorldBounds")||alp.m(k,"getBounds");if(a&&void 0!==c&&e){var f=e.getSouthWest();var g=e.getNorthEast();var h=l.fromLatLngToPixel(f.lat(),f.lng(),c);
var m=l.fromLatLngToPixel(g.lat(),g.lng(),c);alp.mix(b,{center:a,center_pix:d,zoom:c,sw:f,ne:g,sw_pix:h,ne_pix:m,bbox:[f.lng(),f.lat(),g.lng(),g.lat()],bbox_pix:[h.x,h.y,m.x,m.y],swne:e})}}var k=f.gmapSt.get();k&&h.is_active()&&(l.get_gproj()?(b=alp.oCreateMix(f._model._filterDefaultParam,e),alp.mix(b,{gmap_lat:0,gmap_lng:0,gmap_type:0,gmap_z:0}),b.use_current_bbox&&m(),c=alp.oToString(alp.oCreateMix(alp.mapIn(b,function(a,b){return null==a?"":a}),{bbox:[0,0,0,0],bbox_pix:[0,0,0,0],sw:0,ne:0,sw_pix:0,
ne_pix:0,swne:0,center:0,center_pix:0,zoom:0})),d=a._last_opts_str!==c,b.use_current_bbox&&!d&&a._last_opts&&(d=b.zoom!==a._last_opts.zoom||l.tour_list_pixmin2()<Math.max(g.xyD2(b.ne_pix,a._last_opts.ne_pix))||l.tour_list_pixmin2()<Math.max(g.xyD2(b.sw_pix,a._last_opts.sw_pix))),d&&(a._last_opts=b,a._last_opts_str=c),alp.forEach(f._pagerlike_arr||[],function(a){if(!a.model||d)l.get_pager_model?(a.model&&a.model.cancel&&a.model.cancel(),a.set_model(l.get_pager_model(b,a.nipp()))):console.error(f.declaredClass+
"._update_pagerlikes(): self.model.get_pager_model not found!")},f)):setTimeout(function(){f._update_pagerlikes_now(f._loadOpts)},345))})})}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.fcl_ids_sorter");
(function(){function k(b){b.svis_has_listeners_st.get()?b[e]||(b[e]=b.vis_ids_listen(function(c){b.m.vis.set(c)})):b[e]&&(b.vis_ids_drop(b[e]),b[e]=null)}function h(b){if(b.svis_has_listeners_st.get()){var c=b.m.sortedAll.get(),a=b.m.visSet.get(),d=a.set;a.n&&c&&c.length?b.m.sortedVis.set(alp.filter(c,"v in this",d)):b.m.sortedVis.set([])}}function g(b){if((b.svis_has_listeners_st.get()||b.sall_has_listeners_st.get())&&b.clusterConfigSt.get()){var c=b.dataPointList_st.get();if(c&&!alp.opt(b.filter_st.get(),
"sortedBy"))b.m.sortedAll.setNow(c);else{var a=f(b);(d[a]||(d[a]=alp.jsonp(a))).then(function(c){a===f(b)&&b.m.sortedAll.setNow(c?c.allids:[])})}}}function f(b){var c=b.clusterConfigSt.get().filter_list_url.replace(/$\{bbox\}/g,""),a=alp.oCreateMix(b.filter_st.get(),{proj:b.proj,allids:!0,nohtml:!0});alp.oDropNaN(a);alp.oUndefToNull(a);/^(https?:|\/)/.test(c)||(c=b.base_url+c);b=alp.filter(alp.oKeys(a),'0 > this.str.indexOf( "${" + v + "}" )',{str:c});0<b.length&&(c+=(0>c.indexOf("?")?"?":"&")+alp.map(b,
'v+"=${"+v+"}"').join("&"));return alp.tmpl(c,a,'||""',"")}alp.declare("alp._gmap2_3.x.FclIdsSorter",alp.x.AbstractController,null,{proj:null,base_url:"/",svis_has_listeners_st:null,sall_has_listeners_st:null,clusterConfigSt:null,dataPointList_st:null,filter_st:null,vis_ids_listen:null,vis_ids_drop:null,svis_ids_trigger:null,sall_ids_trigger:null,augmentModel:function(b){b.vis=new alp.State({init_value:[]});b.sortedAll=new alp.SortedArrayState({init_value:[]});b.visSet=new alp.State({init_value:{n:0,
set:{}}});b.sortedVis=new alp.SortedArrayState({init_value:[]})},connectModel2Model:function(b,c,a,d){a.vis.change_cb_init(function(){var b=a.vis.get()||[];a.visSet.set({n:b.length,set:alp.arr2oSimple(b)})});c.push(a.sortedAll.change_cb(h,null,b));c.push(a.visSet.change_cb(h,null,b));h(b)},connectModel2View:function(b,c,a,d){b.sall_ids_trigger&&c.push(a.sortedAll.change_cb(b.sall_ids_trigger));b.svis_ids_trigger&&c.push(a.sortedVis.change_cb(b.svis_ids_trigger))},connectView2Model:function(b,c,a,
d){c.push(b.svis_has_listeners_st.change_cb_init(k,null,b));c.push(b.svis_has_listeners_st.change_cb_init(g,null,b));c.push(b.sall_has_listeners_st.change_cb_init(g,null,b));c.push(b.clusterConfigSt.change_cb_init(g,null,b));c.push(b.dataPointList_st.change_cb_init(g,null,b));c.push(b.filter_st.change_cb_init(g,null,b))}});var e="_h_listen_2_vis",d={}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.layer.filter_cluster_layer");
(function(){function k(f){f.cc_cb(function(e){e.set_pager_type_name(f._filter_st().get_property("activity_name")||"",!0)})}var h=alp.sub("alp._gmap2_3",null,!0),g=alp.declare("alp._gmap2_3.FilterClusterLayer",h.ClusterLayer,alp.nowF(function(f){function e(b){b.update("alp._gmap2_3.FilterClusterLayerfilter_st.changed_cb",d._filter_st().get())}var d=this;d.outSettingFilterState=new alp.BoolState;d.addEvent("setFilterDone");d.addEvent("sortedVisibleIdsChange");d.addEvent("sortedIdsChange");d._filter_st().change_cb(function(){d.cc_cb(e)});
d.listen("clusterMetaChange",function(b){d._alp.lastFilterDoneClusterMeta=b;d.triggerEvent("setFilterDone",b)});d.listen("setFilterDone",function(){d.outSettingFilterState.setNow(!1)});k(d);d._alp.fcl_ids_sorter=new h.x.FclIdsSorter({proj:d.proj,base_url:alp.sub("cc_opts.model_opts.base_url",d),clusterConfigSt:d._alp.clusterConfigSt,dataPointList_st:d._alp.dataPointList_st,filter_st:d._filter_st(),vis_ids_listen:alp.bindF("listen",d,"visibleIdsChange"),vis_ids_drop:alp.bindF("drop",d),svis_has_listeners_st:d.stEventHasListeners("sortedVisibleIdsChange"),
sall_has_listeners_st:d.stEventHasListeners("sortedIdsChange"),svis_ids_trigger:alp.bindF("triggerEvent",d,"sortedVisibleIdsChange"),sall_ids_trigger:alp.bindF("triggerEvent",d,"sortedIdsChange")});d.listen("addListener",function(b){"sortedVisibleIdsChange"==b?alp.bindF.apply(alp,alp.Aps.call(arguments,1))(d._alp.fcl_ids_sorter.m.sortedVis.get()):"sortedIdsChange"==b&&alp.bindF.apply(alp,alp.Aps.call(arguments,1))(d._alp.fcl_ids_sorter.m.sortedAll.get())});d._alp.fcl_ids_sorter.init()}),{initFilter:null,
single_docType_or_all:!1,onSetFilterDone:null,onSortedVisibleIdsChange:null,onSortedIdsChange:null,actual_filter_init:alp.memM("actual_filter_init","alp.oCreateMix( /*object*/ this.INITFILTER_DEFAULT() , /*?object? (optional) */ this.initFilter )"),getFilter:function(){return this._filter_st().get()},setFilter:function(f,e){this.outSettingFilterState.setNow(!0);(f=this._filter_st().set_flex_now(f,e))&&k(this);!f&&this.is_initialized()&&this.triggerEvent("setFilterDone",this._alp.lastFilterDoneClusterMeta)},
controlTourList:function(f){var e=this;e.cc_cb(function(d){function b(b,a){var c=alp.opt(alp.gEBCN("geometry-simplified-value",b)[0],"value");alp.m(alp.opt(f,"model"),"nToId_cb",a,function(a){c&&alp.db.common().getset(a+".geometry_simplified",alp.oFrom(c));e.showTour(a)})}d.control_pager(f);f.mouseoverEvt().then(b);f._alp_invasive_fcl_h=b})},releaseTourList:function(f){this.cc_cb(alp.nowF(function(e){f.mouseoverEvt().dropSoon(f._alp_invasive_fcl_h);e.release_pager(f)}))},INITFILTER_DEFAULT:function(){return{area:"",
dif_d:!0,dif_m:!0,dif_e:!0,asc_s:"",asc_e:"",tim_s:"",tim_e:"",len_s:"",len_e:"",qul_b:!0,qul_p:!0,qul_s:!0,docType_id_name:"",category:"",checks:"",types:"",typ:"",period_s:"",period_e:"",price_s:"",price_e:"",tags:"",state:"",type:this.type,q:"",ntpp:"",lsfd:"",sft_s:"",sft_e:"",opened:""}},cluster_controller_ctor:alp.f("alp._gmap2_3.FilterClusterController"),cc_opts_default:function(){var f=g.parent.prototype.cc_opts_default.call(this),e=this.actual_filter_init();alp.mix(f,alp.opt(this,["single_docType_or_all"]));
alp.mix(f.model_opts,{initFilter:e});f.init_loadOpts=e;f.filter_st=this._filter_st();alp.oSet(f,"view_opts.alternateSource_allIds_st_dfrd",alp.subDfrd("_alp.fcl_ids_sorter.m.sortedAll",this));return f},_filter_st:alp.memM("_filter_st","new alp.ObjectState( { init_value : this.actual_filter_init() } )")})})();"undefined"!==typeof dojo&&dojo.provide("alp.key");
alp.key={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,HELP:47,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_PLUS:107,NUMPAD_ENTER:108,NUMPAD_MINUS:109,NUMPAD_PERIOD:110,NUMPAD_DIVIDE:111,
F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,NUM_LOCK:144,SCROLL_LOCK:145};"undefined"!==typeof dojo&&dojo.provide("alp.dom.image");
(function(){function k(f){if(!(f in k)){var e=alp.cE("img",alp.body(),{style:"position: absolute; left: -99999px; top: -99999px; visibility: hidden;",src:f}),d=e.naturalWidth,b=e.naturalHeight;alp.orphan(e);if(!(0<d&&0<b))return;k[f]={w:d,h:b}}return alp.oCreate(k[f])}function h(f){return f in h?h[f]:h[f]=alp.subDfrd(alp.bindF(k,null,f))}var g=alp.sub("alp.dom",null,!0);g.getImgSize=k;g.getImgSizeDfrd=h})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.visible_viewport");
(function(){var k=alp.sub("alp.dom",null,!0);k.isVisibleWithinViewport||(k.isVisibleWithinViewport=function(h){h=alp.gBCR(h);var g=alp.gViewportSize();return!(0>h.bottom||h.top>=g.height||0>h.right||h.left>=g.width)})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.spinner");
(function(){function k(a){function c(b,c){return alp.vStyle(alp.cE("div"),{position:"absolute",width:a.length+a.width+"px",height:a.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/a.lines*e+a.rotate)+"deg) translate("+a.radius+"px,0)",borderRadius:(a.corners*a.width>>1)+"px"})}for(var d=a.lines,e=0;e<d;e++){var f=alp.vStyle(alp.cE("div"),{position:"absolute",top:1+~(a.width/2)+"px",transform:a.hwaccel?"translate3d(0,0,0)":"",opacity:a.opacity,animation:b&&g(a.opacity,
a.trail,e,a.lines)+" "+1/a.speed+"s linear infinite"});a.shadow&&alp.aC(f,alp.vStyle(c("#000","0 0 4px #000"),{top:"2px"}));alp.aC(a.node,alp.aC(f,c(a.color,"0 0 1px rgba(0,0,0,.1)")))}}function h(a,b,c,d){a=a.childNodes;b<a.length&&(a[b].style.opacity=c)}function g(a,d,e,f){var g=["opacity",d,~~(100*a),e,f].join("-");e=.01+e/f*100;f=Math.max(1-(1-a)/d*(100-e),a);var h=b.substring(0,b.indexOf("Animation")).toLowerCase();l[g]||(c.insertRule("@"+(h&&"-"+h+"-"||"")+"keyframes "+g+"{0%{opacity:"+f+"}"+
e+"%{opacity:"+a+"}"+(e+.01)+"%{opacity:1}"+(e+d)%100+"%{opacity:"+a+"}100%{opacity:"+f+"}}",c.cssRules.length),l[g]=1);return g}function f(a,b){a=document.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">');alp.setProp(a,b);return a}function e(a){function b(){return alp.vStyle(f("group",{coordsize:g+" "+g,coordorigin:-e+" "+-e}),{width:g,height:g})}function c(c,g,l){alp.aC(h,alp.aC(alp.vStyle(b(),{rotation:360/d*c+"deg",left:~~g}),alp.aC(alp.vStyle(f("roundrect",{arcsize:a.corners}),
{width:e,height:a.width,left:a.radius,top:-a.width>>1,filter:l}),f("fill",{color:a.color,opacity:a.opacity}),f("stroke",{opacity:0}))))}var d=a.lines,e=a.length+a.width,g=2*e,l=2*-(a.width+a.length)+"px",h=alp.vStyle(b(),{position:"absolute",top:l,left:l});if(a.shadow)for(l=1;l<=d;l++)c(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=d;l++)c(l);alp.aC(a.node,h)}function d(a,b,c,d){a=a.firstChild;d=d.shadow&&d.lines||0;a&&b+d<a.childNodes.length&&
(a=alp.oGet(a.childNodes[b+d],"firstChild.firstChild"))&&(a.opacity=c)}var b,c,a,m;alp.declare("alp.x.Spinner",null,function(f){f&&alp.mixCheck(this,f);c||(f=alp.cE("style",alp.head(),{type:"text/css"}),c=f.sheet||f.styleSheet,f=alp.vStyle(alp.cE("group"),{behavior:"url(#default#VML)"}),!alp.vendor(f,"transform")&&f.adj?(c.addRule(".spin-vml","behavior:url(#default#VML)"),a=e,m=d):(a=k,m=h,b=alp.vendor(f,"animation")));this.targetInit&&this.setTarget(this.targetInit)},{targetInit:null,stopOnFirstRemoval:!0,
lines:12,length:5.3,width:2.6,radius:8.1,rotate:0,corners:1,color:"#000",speed:1,trail:50,opacity:.25,fps:20,zIndex:2E9,className:"alp-x-spinner",top:"auto",left:"auto",position:"relative",shadow:!1,hwaccel:!1,setTarget:function(a){null==a||a.childNodes.a;var b=this;b.node&&(b.stop(),alp.orphan(b.node),b.node=null);if(b.target=a){b.start();var c=b.target.offsetParent!==alp.body()&&alp.offset(b.node,b.target),d=b.radius+b.length+b.width;c&&alp.vStyle(b.node,{left:/^.+%$/.test(b.left)?b.left:("auto"===
b.left?-c.offsetLeft+(a.offsetWidth>>1):(b.left|0)+d)+"px",top:/^.+%$/.test(b.top)?b.top:("auto"===b.top?-c.offsetTop+(a.offsetHeight>>1):(b.top|0)+d)+"px"});b.stopOnFirstRemoval&&alp.subDfrd(function(){return!(b.node&&alp.isDescendant(b.node,alp.body()))}).then(function(){b.stop()})}return b},start:function(){function c(){if(d.node===e){f++;for(var a=d.lines;a;a--)m(e,d.lines-a,Math.max(1-(f+a*k)%l*h,d.opacity),d);d.timeout=setTimeout(c,~~(1E3/g))}}var d=this,e=d.node||(d.node=alp.vStyle(alp.cE("div",
null,{"class":d.className,role:"progressbar"}),{position:d.position,width:0,zIndex:d.zIndex}));e.childNodes.length||a(d);if(!b){var f=0,g=d.fps,l=g/d.speed,h=(1-d.opacity)/(l*d.trail/100),k=l/d.lines;clearTimeout(d.timeout);c()}d.target.firstChild!==d.node&&alp.place(d.node,d.target,"first");return d},stop:function(){this.node&&(clearTimeout(this.timeout),alp.orphan(this.node));return this}});var l={}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.waitbox");
(function(){function k(g){delete g.timeout;if(g[h]&&g.target&&!alp.likeIE8minus_backslash_v()){var f=g.background;g.node||(g.node=alp.cE("div",null,{"class":g.className}),g.node.style.opacity=0);var e=g.node,d=g.target,b=!!f,c="fill"===f;e.parentNode!==d&&alp.aC(d,e);var a=(d.offsetParent||d.parentNode===alp.body()||d===alp.body())&&alp.gBCR(d);if(a&&a.width&&a.height||alp.dom.isVisibleWithinViewport(d)){alp.setClass(e,g.bgClass,b);alp.setClass(e,g.nobgClass,!b);alp.setClass(e,g.fillClass,c);alp.setClass(e,
g.nofillClass,!c);if(b&&!c){var m=f.w+"px";var l=f.h+"px";var r="-"+(f.w>>1)+"px";var n="-"+(f.h>>1)+"px"}alp.style(e,alp.filterIn({width:m,height:l,marginLeft:r,marginTop:n},alp.f()));if(!g.waiter)if("spinner"===g.waiterType)g.waiter=new alp.x.Spinner(g.waiterOpt);else throw Error('alp.x.Waitbox: unknown waiter type "'+g.waiterType+'"');alp.likeIE8minus_backslash_v()||(e.style.display=null);e.style.display&&(e.style.display="block");g.waiter.setTarget(g.node);e.style.opacity=null}else g.timeout=
setTimeout(alp.bindF(k,null,g),g.delay_ms)}}alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.Waitbox",null,function(g){g&&alp.mixCheck(this,g);this.targetInit&&this.setTarget(this.targetInit)},{targetInit:null,delay_ms:678,background:"fill",waiterType:"spinner",waiterOpt:null,targetClass:"alp-x-has-waitbox",className:"alp-x-waitbox",bgClass:"alp-x-waitbox-bg",nobgClass:"alp-x-waitbox-nobg",fillClass:"alp-x-waitbox-fill",nofillClass:"alp-x-waitbox-nofill",setTarget:function(g){if(this.target!==
g){var f=this.target;f&&(this.stopWait(),this.node&&alp.orphan(this.node),alp.setClass(f,this.targetClass,!1));(this.target=g)&&alp.setClass(g,this.targetClass,!0);f&&this.startWait()}return this},startWait:function(){this[h]=!0;0<this.delay_ms?"timeout"in this||(this.timeout=setTimeout(alp.bindF(k,null,this),this.delay_ms)):k(this);return this},stopWait:function(){this[h]=!1;"timeout"in this&&(clearTimeout(this.timeout),delete this.timeout);alp.likeIE8minus_backslash_v()||(this.node&&(this.node.style.opacity=
0,this.node.style.display="none"),this.waiter&&this.waiter.setTarget());return this}});var h="_isWaiting"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.image");
(function(){function k(b){var c=b.m,d=c.url.get(),e=0<b.cont.clientWidth&&0<b.cont.clientHeight;b=b.img;var f=b.complete;f=d&&(d!==alp.gA(b,"src")||!f);c._isWaiting.setNow(!e||f);!d||f||0!==b.naturalWidth&&0!==b.naturalHeight||(c=m[d]=a,alp.sA(b,"src",c))}function h(a){function b(){a.m._isAnimatingPanorama.setNow(!1)}a.dndZoom&&alp.m(a._dndZoom,"destroy");a.dndSwipe&&alp.m(a._dndSwipe,"destroy");g(a,"img","imgPrev");alp.setClass(a.img,a.imgPrevClass,!1);alp.setClass(a.imgPrev,a.imgPrevClass,!0);a.cont.insertBefore(a.imgPrev,
a.img);var d=a.m._opacity_img.st,l=a.m._opacity_imgPrev.st,h=d.get(),k=l.get();d.set(k);l.set(h);d=a.m.is_pano.get();a.dndZoom&&(l={dummy_cfg:!1,leave_it:!0},d&&(l.xy_constrain=alp.x.dnd.XY_CONSTRAIN_H),l.xy_constrain=c(a,l.xy_constrain),a._dndZoom=alp.x.dnd(a.img,l),a._dndZoom.startDragEvt().then(b),a._dndZoom.dropEvt().then(alp.bindF(f,null,a)),a.m.fit.bind_to(a._dndZoom.active,{transform:"!"}));a.dndSwipe&&(a._dndSwipe=alp.x.dnd(a.img,{mouse:!1,force_new:!0,dummy_cfg:!1,leave_it:!0,xy_constrain:alp.x.dnd.XY_CONSTRAIN_H}),
a._dndSwipe.startDragEvt().then(b),a._dndSwipe.dropEvt().then(alp.bindF(e,null,a)),d||a.m.fit.bind_to(a._dndSwipe.active))}function g(a,b,c){var d=a[b];a[b]=a[c];a[c]=d}function f(a,b){if(1E4<b.d2){a._last_drop=Date.now?Date.now():+new Date;var c=alp.gBCR(a.img),d=b.dx/c.width;b=b.dy/c.height;a.m.imgCxProp.set(a.m.imgCxProp.get()-d);a.m.imgCyProp.set(a.m.imgCyProp.get()-b)}}function e(a,b){var c=a.img.clientWidth/3;b.dx<-c?a.swipeEvt().triggerSoon("left"):b.dx>c&&a.swipeEvt().triggerSoon("right")}
function d(a){k(a);a=a.m;var b=a._isWaiting.get();a._opacity_img.cancel();a._opacity_img[b?"nextTargetMin":"nextTargetMax"]();b||a.showedSince.set(Date.now?Date.now():+new Date);a._opacity_imgPrev.cancel();a._opacity_imgPrev.nextTargetMin()}function b(a){var b=a.m,c=b.url.get(),d=b.is_pano.get(),e=b._isWaiting.get();c=(e=c&&!e&&alp.dom.getImgSize(c))&&e.w;e=e&&e.h;if(0<c&&0<e){var f=alp.gBCR(a.cont),g=f&&f.width;f=f&&f.height;if(0<g&&0<f){d&&e>f&&(c*=f/e,e=f);if(a.fitTooBig){var h=Math.max(f/e,g/
c);d=~~(h*e);h=~~(h*c)}else{h=Math.min(e,f);var k=Math.min(c,g);h=Math.min(h,k/c*e);k=Math.min(k,h/e*c);d=Math.min(h,k/c*e);h=Math.min(k,h/e*c)}k=g/2-h/2;var m=f/2-d/2,r=b._zoom_anim.st.get(),A=h,C=d,E=k,G=m,B=h<c||d<e;1E-10<r&&B&&(E=g*b.contCxProp.get()-c*b.imgCxProp.get(),A=f*b.contCyProp.get()-e*b.imgCyProp.get(),E=r*E+(1-r)*k,G=r*A+(1-r)*m,A=r*c+(1-r)*h,C=r*e+(1-r)*d);E=Math.round(E);G=Math.round(G);A=Math.round(A);C=Math.round(C);alp.style(a.img,{position:"absolute",left:E+"px",top:G+"px",width:A+
"px",height:C+"px"});a[l]={left:E,top:G,w:A,h:C,cont_w:g,cont_h:f};alp.setClass(a.cont,a.zoomableClass,a.zoomClick&&B&&!b.is_pano.get());b.is_zoomable.setNow(B)}}}function c(a,b){return function(c,d,e,f,g){b&&(c=b.apply(null,arguments));var h=a[l];h&&(h.w>h.cont_w&&(c.x=Math.max(-(h.w-h.cont_w),Math.min(0,c.x))),h.h>h.cont_h&&(c.y=Math.max(-(h.h-h.cont_h),Math.min(0,c.y))));return c}}alp.ensureCss(alp.cssBase()+"alp/x.css");var a=alp.cfg.image().transp_1x1.url,m={};alp.declare("alp.x.Image",alp.x.AbstractController,
null,{cont:null,imgClass:"alp-x-image-img",imgPrevClass:"alp-x-image-img-prev",imgContClass:"alp-x-image-cont",zoomableClass:"alp-x-image-zoomable",zoominClass:"alp-x-image-zoomin",initUrl:"",initTitle:"",waitboxBackground:{w:109,h:73},opacitySpeed:2.7,zoomClick:!0,zoomWheel:!0,zoomSpeed:5.4,dndZoom:!0,dndSwipe:!1,fitTooBig:!1,imgDomFirst:!0,animPanoSpeed:111,resize:function(){b(this)},finishZoomOutEvt:alp.memM("finishZoomOutEvt",'alp.event("AXI:finishZoomOutEvt",{then:1})'),swipeEvt:alp.memM("swipeEvt",
'alp.event("AXI:swipeEvt",{then:1})'),augmentModel:function(a){a.url=new alp.State({init_value:this.initUrl||""});a.title=new alp.State({init_value:this.initTitle||""});a.showedSince=new alp.State;a.contCxProp=new alp.MinMaxState({min:0,max:1,init_value:.5});a.contCyProp=new alp.MinMaxState({min:0,max:1,init_value:.5});a.imgCxProp=new alp.MinMaxState({min:0,max:1,init_value:.5});a.imgCyProp=new alp.MinMaxState({min:0,max:1,init_value:.5});a.is_pano=new alp.BoolState({init_value:!1});a.fit=new alp.BoolState({init_value:!0});
a.is_zoomable=new alp.BoolState;a._isWaiting=new alp.BoolState({init_value:!0});a._opacity_img=new alp.Anim({speed:this.opacitySpeed});a._opacity_imgPrev=new alp.Anim({speed:this.opacitySpeed});a._zoom_anim=new alp.Anim({speed:this.zoomSpeed,interval_ms:11});a._isAnimatingPanorama=new alp.BoolState},augmentKids:function(a){this.cont.childNodes.a;alp.setClass(this.cont,this.imgContClass,!0);this.img=alp.gEBCN(this.imgClass,this.cont)[0]||alp.cE("img",this.cont,{"class":this.imgClass});this.imgPrev=
alp.gEBCN(this.imgPrevClass,this.cont)[0]||alp.cE("img",this.cont,{"class":this.imgClass});alp.setClass(this.imgPrev,this.imgClass,!0);this.imgDomFirst&&(alp.place(this.imgPrev,this.cont,"first"),alp.place(this.img,this.cont,"first"));a.waitbox=new alp.x.Waitbox({targetInit:this.cont,background:this.waitboxBackground})},connectModel2Model:function(a,b,c,e){function f(){var a=c.url.get(),b=c.is_pano.get(),d=c._isWaiting.get();a=[a,b,d].join("#^#");m!==a&&(m=a,b=b&&!d,c._isAnimatingPanorama.is(b)||
c._isAnimatingPanorama.set(b))}function g(a){h&&(alp.now(l,null,a),requestAnimationFrame(g))}function l(b){alp.isFiniteNumber(b)||null.bug;var d=[c.url.get(),c.is_pano.get(),c._isAnimatingPanorama.get(),c._isWaiting.get()].join("#^#");n!==d&&(n=d,q=null);if(c.is_pano.get()&&c._isAnimatingPanorama.get()&&!c._isWaiting.get()){var e=a.cont,f=e&&e.clientWidth,g=a.img;d=g&&g.complete&&g.clientWidth;if(alp.and([f,e&&e.clientHeight,d,g&&g.complete&&g.clientHeight],">0")){null!=q||(q=b);e=d-f;b=a.animPanoSpeed*
Math.max(0,-100+b-q)/1E3%(e<<1);c.imgCxProp.set((b<e?b:e-(b-e))/d);c.imgCyProp.set(.5);c.contCxProp.set(0);c.contCyProp.set(.5);return}}q=null}b.push(c.is_pano.change_cb(function(){var a=c.url.get(),b=c.is_pano.get();a=[a,b].join("#^#");k!==a&&(k=a,c.contCxProp.set(b?0:.5),c.contCyProp.set(.5),c.imgCxProp.set(b?0:.5),c.imgCyProp.set(.5))}));e=alp.bindF(d,null,a);b.push(c.url.change_cb(e));b.push(c._isWaiting.change_cb(e));e();b.push(c.fit.change_cb(function(){c._zoom_anim.cancel();c._zoom_anim[c.fit.get()?
"nextTargetMin":"nextTargetMax"]()}));c._zoom_anim.cancel();c._zoom_anim.st.set(c.fit.get()?c._zoom_anim.min:c._zoom_anim.max);b.push(c.url.change_cb_init(f));b.push(c.is_pano.change_cb(f));b.push(c._isWaiting.change_cb(f));var h=!0;b.push(requestAnimationFrame(g),function(){h=!1});var k,m,n,q},connectModel2View:function(a,c,e,f){function g(b,c){alp.setOpacity(a[c],b.get())}c.push(e.url.change_cb_init(function(){var c=e.url.get();c=m[c]||c;var f=e.title.get();c&&(h(a),alp.sA(a.img,{src:c,alt:f}));
a.img.style.display=c?"":"none";d(a);b(a)}));c.push(e._isWaiting.change_cb_init(function(){f.waitbox[e._isWaiting.get()?"startWait":"stopWait"]()}));c.push(e.fit.change_cb_init(function(){alp.setClass(a.cont,a.zoominClass,!e.fit.get())}));var l=e._opacity_img.st;c.push(l.change_cb_init(g,null,l,"img"));l=e._opacity_imgPrev.st;c.push(l.change_cb_init(g,null,l,"imgPrev"));var k=alp.bindF(b,null,a);alp.forEach("url showedSince contCxProp contCyProp imgCxProp imgCyProp fit is_pano _isWaiting".split(" "),
function(a){c.push(e[a].change_cb(k))});c.push(e._zoom_anim.st.change_cb(k));c.push(alp.aEL(window,"resize",k));k();c.push(e._zoom_anim.reachMinEvt().bindEvent(a.finishZoomOutEvt()))},connectView2Model:function(a,b,c,d){function e(){c._isAnimatingPanorama.setNow(!1)}function f(a){alp.stopEvent(a);c.is_pano.get()||(e(),c.fit.get()^0>a.wheelDeltaY&&g(a))}function g(b){if(!(100>(Date.now?Date.now():+new Date)-a._last_drop)){b||(b=window.event);var d=b.target||b.srcElement;if(d===a.img){e();d=alp.gBCR(d);
var f=b.clientX-d.left,g=b.clientY-d.top,l=alp.gBCR(a.cont),h=b.clientY-l.top;c.contCxProp.set((b.clientX-l.left)/l.width);c.contCyProp.set(h/l.height);c.imgCxProp.set(f/d.width);c.imgCyProp.set(g/d.height);alp.hasClass(a.cont,a.zoomableClass)?c.fit.toggle():c.fit.set(!1)}}}b.push(setInterval(alp.bindF(k,null,a),107),clearInterval);b.push(alp.aEL(a.cont,"mousedown",alp.nowF(e)));a.zoomClick&&b.push(alp.aEL(a.cont,"click",alp.nowF(g)));a.zoomWheel&&b.push(alp.aEL(a.cont,"mousewheel",alp.nowF(f)));
d=alp.nowF(function(b){function d(a){var b=a[1].x-a[0].x;a=a[1].y-a[0].y;return Math.sqrt(b*b+a*a)}if(!b.isStart){var e=d(b.tArr_start),f=d(b.tArr);f<.9*e?c.fit.set(!0):e<.9*f&&c.fit.get()&&g({target:a.img,clientX:(b.tArr[0].x+b.tArr[1].x)/2,clientY:(b.tArr[0].y+b.tArr[1].y)/2})}});b.push(alp.touchFollow(2,a.img,d));b.push(alp.touchFollow(2,a.imgPrev,d))}});var l="_last_place_info"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.imagebar");
(function(){function k(){var a=this.m,b=a.cfg.get_property("length");a.current.setNow((a.current.get()+b-this.stepCurrent)%b)}function h(){var a=this.m;a.current.setNow((a.current.get()+this.stepCurrent)%a.cfg.get_property("length"))}function g(a){function b(b){var c=alp.cE("div",null,{"class":a.notSelectedClass});a.selectOnClick&&(alp.aEL(c,"click",function(){a.m.selected.setNow(b)}),alp.aEL(c,"touchstart",function(){a.m.selected.setNow(b)}));m.isVideo&&alp.cE("span",c,{"class":"oax-icon-play"});
return new alp.x.Image({cont:c,zoomClick:!1,zoomWheel:!1,fitTooBig:!0,opacitySpeed:Infinity})}for(var g=a.m.cfg.get(),l=g.length,h=a.kx.imageArr;h.length>l;)alp.orphan(h.pop().cont);for(var k=0;k<l;k++){var m=g[k%l],q=m.imgurl,p=m.title||"",r=h[k]||(h[k]=b(k));q.substring.call.a;r.m.url.set(q);r.m.title.set(p);r._index=k}a.m.selected.set(0);a.m.current.set(0);d(a);f(a);e(a);c(a);n(a)}function f(a){function b(a,b){return b[0]<b[1]?b[0]<=a&&a<=b[1]:!(b[1]<a&&a<b[0])}var c=a.m.selected.get(),d=a.m.current.get(),
e=a[v],f=a.kx.imageArr[c];e!==f&&(e&&alp.setClass(e.cont,alp.arr2o([[a.selectedClass,!1],[a.notSelectedClass,!0]],0,1)),alp.setClass(f.cont,alp.arr2o([[a.selectedClass,!0],[a.notSelectedClass,!1]],0,1)),a[v]=f,1===a.stepCurrent?a.m.current.set(c):(e=a.m.cfg.get_property("length"),f=[(d+e-a.stepCurrent)%e,(d+a.stepCurrent)%e],b(c,f)||(d=b(c,[f[1],(d+~~(e/2))%e])?-1:1,a.m.current.set((c+e+d)%e))))}function e(a){var b=a.m.current.get(),d=a.kx.imageArr,e=d.length;c(a);if(e){a=alp.opt(a.m._contInfo.get(),
"max_n_odd")||30;var f=1+Math.round(1.3*(a>>1));a=b-f;for(b+=f;a<b;a++)f=d[(a%e+e)%e],f[u]||(f[u]=!0,f.init())}}function d(a,b){var c=a._imgcont.clientHeight||alp.gBCR(a._imgcont).height;if(0<c){b=a.m.interspace.get();var e=c*a.widthFactor;a.m._size.set({h:c,w:e});c=e+b;var f=a.m.cfg.get_property("length")*c-b,g=a.m.maxWidth.get();Infinity===g||f<g?a.m._contInfo.setNow({needed_w:f}):(f=Math.min(f,g)/c|0,f=f&1?f:f-1,a.m._contInfo.setNow({max_n_odd:f,im_wpi:c,im_width:e,interspace:b,w:f*c-b,withScrolling:!0}))}else b||
alp.asyncF(100,alp.nowF(d))(a,!0)}function b(a){var b=a.m._contInfo.get();alp.style(a._imgcont,"width",b&&b.w?b.w+"px":b&&b.needed_w?b.needed_w+"px":null);c(a);r(a)}function c(a){var b=a.m,c=b.cfg.get_property("length"),d=b._contInfo.get(),e=~~b._firstAndPixel.get_property("first"),f=e-(c&&(e%c+c)%c);if(d&&d.withScrolling){d=b.current.get()-(d.max_n_odd>>1);d=(d-e)%c;d=[d,d+c,d-c];f=b.current.get();var g=b.current.getPrevious();f=null!==g?f-g:NaN;a=f===a.stepCurrent||f===a.stepCurrent-c;c=alp.arrMinIndex(d,
"Math.abs(v)");var l;a&&0>d[c]?l="v < 0 ? Infinity : v":!a&&0<d[c]&&(l="v > 0 ? Infinity : v");l&&(c=alp.arrMinIndex(d,l));d=e+d[c]}else d=f;if(!alp.isFiniteNumber(d))throw Error("imagebar bug on target number");b._targetFirst.set(d)}function a(a){var b=a.m,c=b._targetFirst.get(),d=b._firstAndPixel;b=~~d.get_property("first");var e=~~d.get_property("pixelShift");d=~~d.get_property("current_f");if(c!==b||0!==e)c=a.m,a._anim_start_f=null!=d?d:b,c._anim.cancel(),c._anim.st.set(c._anim.min),c._anim.nextTargetMax()}
function m(a){var b=a.m;b._anim.cancel();b._anim.st.set(b._anim.min);a._anim_start_f=null}function l(a){var b=a._anim_start_f;if(null!=b){a=a.m;var c=a._anim.st.get();if(0<c){var d=a._targetFirst.get();b+=c*(d-b);c=Math.floor(b);d=(b-c)*(a._size.get().w+a.interspace.get())|0;a._firstAndPixel.set({first:c,pixelShift:d,current_f:b})}}}function r(a){var b=a.m._size.get(),c=b.w,d=b.h,e=a.kx.imageArr,f=e.length;b=a.m.interspace.get();if(0<c&&0<d){alp.forEach(e,function(a){alp.style(a.cont,{width:c+"px",
height:d+"px","float":"left"});a.resize()});e=a._subcont;f=f*(c+b)-b;var g=alp.opt(a.m._contInfo.get(),"w")||a.m.maxWidth.get();alp.style(e,{width:f+"px"});a.stepCurrent=Math.floor(g/(c+b)/2)||1;alp.setClass(a._nextBtn,"oax_no_display",g>=f);alp.setClass(a._prevBtn,"oax_no_display",g>=f)}}function n(a){var b=a.m,c=b.interspace.get(),d=a.kx.imageArr,e=b.cfg.get_property("length"),f=a.m._contInfo.get();a.m.maxWidth.get();f&&f.withScrolling?(a._imgcont.style.position="relative",a._subcont.style.position=
"absolute",a._subcont.style.textAlign="left"):(a._imgcont.style.position="",a._subcont.style.position="");var g=b._firstAndPixel.get(),l=b._firstAndPixel.getPrevious();b=~~g.first;alp.opt(l,"first");g=~~g.pixelShift;b=(b%e+e)%e;a=a._subcont;alp.style(a,{left:f?g?-g+"px":null:null});for(f=0;f<e;f++,b++)g=d[(b%e+e)%e].cont,l=a.childNodes[f],alp.style(g,"marginLeft",1>f?"0px":c+"px"),g!==l&&(l?a.insertBefore(g,l):a.appendChild(g))}alp.ensureCss(alp.cssBase()+"alp/x.css");var q=["imgurl","title","isVideo"],
p=function(a){return alp.opt(a,q)};alp.declare("alp.x.ImageBar",alp.x.AbstractController,null,{cont:null,initCfg:[],initSelected:0,widthFactor:1,initMaxWidth:Infinity,stepCurrent:1,selectOnClick:!0,thumbNextClass:"alp-lightboxview-next",thumbPrevClass:"alp-lightboxview-prev",imgcontClass:"alp-lightboxview-thumb-images-cont",subcontClass:"alp-imagebar-subcont",selectedClass:"alp-imagebar-selected",notSelectedClass:"alp-imagebar-not-selected",resize:alp.ratelimitF(113,alp.nowF(function(){d(this)})),
selectPrevious:function(){var a=this.m,b=a.cfg.get_property("length");a.selected.setNow((a.selected.get()+b-1)%b)},selectNext:function(){var a=this.m;a.selected.setNow((a.selected.get()+1)%a.cfg.get_property("length"))},setMaxWidth:function(a){var b=this.m.maxWidth;b.is(a)||(b.setNow(a),this.resize())},augmentModel:function(a){a.cfg=new alp.SetState({ordered:!0,do_not_clone:!0,constrain_all:function(a,b){a=alp.SetState.prototype.constrain_all.call(this,a,b);return alp.filter(alp.map(a,p),"")},is_same_element:alp.oEqual,
init_value:this.initCfg});var b=this.initSelected;a.selected="number"!==typeof b?b:new alp.MinMaxState({min:0,max:0,init_value:b});a.selected.setNow.call.a;a.current="number"!==typeof b?b:new alp.MinMaxState({min:0,max:0,init_value:b});a.maxWidth=new alp.State({init_value:this.initMaxWidth});a.interspace=new alp.MinMaxState({init_value:1,min:0,max:Infinity});a._size=new alp.ObjectState({init_value:{w:0,h:0}});a._contInfo=new alp.State({init_value:null});a._targetFirst=new alp.NumberState({init_value:0});
a._anim=new alp.Anim({interval_ms:11,distorsion:alp.f("1-(1-v)*(1-v)")});a._firstAndPixel=new alp.ObjectState({init_value:{first:0,pixelShift:0}})},augmentKids:function(a){alp.style(this.cont,{overflow:"hidden"});alp.empty(this.cont);this._prevBtn=alp.cE("div",this.cont,{"class":this.thumbPrevClass});this._imgcont=alp.cE("div",this.cont,{"class":this.imgcontClass,style:"overflow:hidden;"});this._subcont=alp.cE("div",this._imgcont,{"class":this.subcontClass});this._nextBtn=alp.cE("div",this.cont,{"class":this.thumbNextClass});
a.imageArr=[]},connectModel2Model:function(a,b,c,d){b.push(c.cfg.change_cb_init(function(){c.selected.min=0;c.selected.max=c.cfg.get_property("length")-1;c.selected.set(0);c.current.min=0;c.current.max=c.cfg.get_property("length")-1;c.current.set(0)}))},connectModel2View:function(c,d,h,k){d.push(h.cfg.change_cb_init(alp.bindF(g,null,c)));d.push(h.selected.change_cb_init(alp.bindF(f,null,c)));d.push(h.current.change_cb_init(alp.bindF(e,null,c)));var q=alp.bindF("resize",c);d.push(h.maxWidth.change_cb_init(function(){q()}));
d.push(alp.aEL(window,"resize",function(){q()}));d.push(h.interspace.change_cb(function(){q();n(c)}));d.push(h._contInfo.change_cb_init(alp.bindF(b,null,c)));d.push(h._targetFirst.change_cb_init(alp.bindF(a,null,c)));d.push(h._anim.st.change_cb_init(alp.bindF(l,null,c)));d.push(h._anim.reachMaxEvt().then(alp.bindF(m,null,c)));d.push(h.interspace.change_cb_init(alp.bindF(r,null,c)));d.push(h._size.change_cb_init(alp.bindF(r,null,c)));d.push(h._firstAndPixel.change_cb_init(alp.bindF(n,null,c)))},connectView2Model:function(a,
b,c,d){b.push(alp.aEL(a._prevBtn,"click",alp.bindF(k,a)));b.push(alp.aEL(a._nextBtn,"click",alp.bindF(h,a)))}});var v="_lastSelectedDom",u="_axibAlreadyInit"})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.fullscreen");
(function(){function k(){return e.length&&"string"===typeof e[0]}function h(){if(k()){var b=d.length&&d[0];if(b)return document[b];console.error("Fullscreen element function not available!")}else console.error("No fullscreen support!")}var g=alp.sub("alp.dom",null,!0),f=alp.filter(["requestFullScreen","mozRequestFullScreen","webkitRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen"],'"function" === typeof this[v]',document.createElement("div")),e=alp.filter(["exitFullscreen","mozCancelFullScreen",
"webkitExitFullscreen","webkitRequestFullscreen","msExitFullscreen"],'"function" === typeof this[v]',document),d=alp.filter(["fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement"],"this[v] !== undefined",document);g.isFullscreenSupported=k;g.aELfullscreen=function(b,c){return alp.aEL(document,"fullscreenchange webkitfullscreenchange mozfullscreenchange msfullscreenchange",b,c)};g.requestFullscreen=function(b){b.childNodes.a;if(k()){var c=f.length&&f[0];if(c)return b[c]();
console.error("Request fullscreen function not available")}else console.error("No fullscreen support!")};g.exitFullscreen=function(){if(k()){var b=e.length&&e[0];if(b)return document[b]();console.error("Exit fullscreen function not available!")}else console.error("No fullscreen support!")};g.elementFullscreen=h;g.isFullscreen=function(){if(k())return null!==h();console.error("No fullscreen support!")}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.dnd.group");
(function(){function k(){var e=this;alp.forEach(["push","pop","shift","unshift","splice"],function(d){var b=e[d];e[d]=alp.nowF(function(){var c=b.apply(e,arguments);e.update_reg();return c})});e._reg=alp.mapany();e.update_reg()}function h(e){"string"===typeof e&&(e=alp.f(e));var d=alp.body();return"sourceIndex"in d?e?function(b,c){return e(b).sourceIndex-e(c).sourceIndex}:function(b,c){return b.sourceIndex-c.sourceIndex}:"compareDocumentPosition"in d?e?function(b,c){return 3-(e(b).compareDocumentPosition(e(c))&
6)}:function(b,c){return 3-(b.compareDocumentPosition(c)&6)}:null}alp.x.dnd.group=function(e,d,b){var c=[];alp.mix(c,f,g);c._domsort_later=alp.ratelimitF(87,"domsort",c);b&&alp.mixCheck(c,b);k.apply(c);1<arguments.length&&!d&&(c.dom_update=null);e&&c.append.apply(c,e);c.domsort();return c};alp.x.dnd.is_group=function(e){return e&&e.is_alp_x_dnd_group===g.is_alp_x_dnd_group};alp.x.dnd.group.topLeft_refPoint_of_bcr=function(e){return{x:e.left,y:e.top,x_next:e.left,y_next:e.bottom}};var g={is_alp_x_dnd_group:function(){return!0},
append:function(){for(var e=arguments.length,d=0;d<e;d++){var b=arguments[d];b&&(b instanceof alp.x._DND?this.push(b):this.append.apply(this,b))}return this},clear:function(){for(;this.length;)this.pop()},concat:function(){return alp.x.dnd.group(Array.prototype.concat.apply(this,arguments))},destroyAll:function(){var e=[].concat(this);this.clear();alp.forEach(e,".destroy()")},dom_update:function(e,d,b){var c=b&&b.node;if(c&&c.parentNode){var a=(b=b.getScrollCont())&&b.scrollTop,f=b&&b.scrollLeft,
g=this[e];e=e>d?"after":"before";g||(g=this.last(),e="after");alp.place(c,g.node,e);this.domsort();b&&(b.scrollTop=a,b.scrollLeft=f)}},last:function(){return this[this.length-1]},toArray:function(){for(var e=this.length,d=Array(e);e--;)d[e]=this[e];return d},update_reg:function(){var e=alp.arr2o(this,"dndid"),d=this._reg.filter(function(a,b){a=b.dndid;a.toPrecision.call.a;return!(a in e)}),b;for(;b=d.pop();)this._unregister(b);d=alp.reduce(this._reg.keys(),"w=w.dndid,w.toPrecision.call.a,v[w]=1,v",
{});b=this.length;for(var c=0;c<b;c++){var a=this[c],f=a.dndid;f.toPrecision.call.a;f in d||this._register(a,d)}this._domsort_later()},domsort:function(){this._last=null;return this.sort(this._domsort_compare())},refPoint_of_bcr:alp.x.dnd.group.topLeft_refPoint_of_bcr,is_dragging_st:alp.memM("is_dragging_st","new alp.BoolState()"),draggingDummyEvt:alp.memM("draggingDummyEvt",'alp.event("dnd:group:draggingDummyEvt",{then:1})'),startDragEvt:alp.memM("startDragEvt",'alp.event("dnd:group:startDragEvt",{then:1})'),
movedEvt:alp.memM("movedEvt",'alp.event("dnd:group:movedEvt", {then:1})')};var f={_domsort_compare:function(){var e;return function(){return e=e||h(".node")}}(),_register:function(e,d){var b=this,c=e.dndid;c.toPrecision.call.a;if(d?c in d:-1<b._reg.indexOf(e))throw Error("xxx debug DND group _register dnd -> already:",b._reg.indexOf(e));d&&(d[c]=1);d=new alp.Eh;e.dummy&&(d.push(e.startDragEvt().then(alp.bindF("domsort",b))),d.push(e.dummy.updateEvt().then(alp.bindF("_update_dummy",b,e))),d.push(e.droppedAtEvt().then(alp.bindF("_moved",
b))));d.push(e.startDragEvt().then(function(){b.is_dragging_st().set(!0);b.startDragEvt().triggerSoon()}));d.push(e.droppedAtEvt().then(function(){b.is_dragging_st().unset()}));b._reg.set(e,d)},_unregister:function(e){this._reg.del(e).clear()},_update_dummy:alp.nowF(function(e,d,b,c,a,f,g){if(e.dummy&&e.dummy.node&&(a=e.dummy,d=alp.indexOf(this,e),!(0>d||(b=this.toArray(),b.splice(d,1),b.push(a),b.sort(this._domsort_compare()),c=alp.indexOf(b,a),b=this._compare_centers(b,e),b=alp.arrMinIndex(b),b>=
c+1&&b--,c===b&&this._last&&this._last.dnd===e&&this._last.to===b)))){this._last={dnd:e,from:d,to:b};c=(f=this[b+(b>=d?1:0)])?"before":"after";f=f&&f.node||this.last()&&this.last().node;a=a.node;if(f&&("before"===c?a.nextSibling!==f:f.nextSibling!==f)){var l=(g=e.getScrollCont())&&g.scrollTop,h=g&&g.scrollLeft;alp.place(a,f,c);g&&(g.scrollTop=l,g.scrollLeft=h)}this.draggingDummyEvt().triggerSoon(b,d,e)}}),_compare_centers:function(e,d){var b=alp.map(e,alp.bindF("_center",this));e=b.length;0<e&&b.push(alp.sub({x:"x_next",
y:"y_next"},b[e-1]));e=b.length;var c=Array(e),a=Array(e),f=Array(e),g=this._center(d),h=g.x;g=g.y;var k=d.xy_constrain,q=null,p=null,v=!0,u=!0;for(d=e;d--;){var t=b[d];if(t){var w=h-t.x;t=g-t.y;k&&(t=k({x:w,y:t},0,0,0,0),w=t.x,t=t.y)}else t=w=Infinity;c[d]=w;a[d]=t;null!=q&&(v=v&&w===q,u=u&&t===p);q=w;p=t}if(v^u){b=v?a:c;c=!1;for(d=e;d--;)a=b[d],a=0<a?Infinity:-a,f[d]=a,isFinite(a)&&(c=!0);c||(f[e-1]=-Infinity)}else for(d=e;d--;)w=c[d],t=a[d],f[d]=w*w+t*t;return f},_center:function(e){return this.refPoint_of_bcr(alp.gBCR(e.node))},
_moved:function(){if(this._last){var e=this._last.from,d=this._last.to,b=this._last.dnd;this._dom_update(d,e,b);this.movedEvt().triggerSoon(d,e,b)}},_dom_update:function(e,d,b){this.dom_update&&this.dom_update(e,d,b)}}})();"undefined"!==typeof dojo&&dojo.provide("alp.i.state");
(function(){var k=alp.sub("alp.i.state",null,!0),h=alp.Later;k.bindTo=function(g,f,e){return h?g.bindTo(f,e):g.bind_to(f,{transform:e})};k.boolState=function(g){var f=0<arguments.length;return h?alp.boolState(f&&{init:g}):new alp.BoolState(f&&{init_value:g})};k.chen=function(g){var f=g[h?"chen":"change_cb"],e=Array.prototype.slice.call(arguments);e.splice(0,1);return f.apply(g,e)};k.chenInit=function(g){var f=g[h?"chenInit":"change_cb_init"],e=Array.prototype.slice.call(arguments);e.splice(0,1);return f.apply(g,
e)};k.hg=function(){return h?alp.hg():new alp.Eh};k.intState=function(g){var f=0<arguments.length;return h?alp.intState(f&&{init:g}):new alp.NumberState(f&&{init_value:g})};k.modeState=function(g,f,e){function d(a,b){var c=Object.getPrototypeOf(this);a=h?alp.modeState_constrain.call(this,a):c.constrain_all.call(this,a,b);return e.call(this,a,b)}var b=h?["init","constrain"]:["init_value","constrain_all"],c={};c[b[0]]=1<arguments.length?f:null;h&&(c.modeArr=g);e&&(c[b[1]]=d);return h?alp.modeState(c):
alp.modeStateFromArr(g,c)};k.nowF=function(){var g=Array.prototype.slice.call(arguments);h?g=alp.nowF.apply(alp,g):(2>g.length&&(g=g.concat([null])),g=alp.bindF.apply(alp,g.concat([null])),g=alp.nowF(g));return g};k.objectState=function(g,f){var e=h?["init","constrain"]:["init_value","constrain_all"],d={};0<arguments.length&&(d[e[0]]=g);f&&(d[e[1]]=f);return h?alp.state(d):new alp.ObjectState(d)};k.set=function(g,f,e){h?g.set(f,e):f.set(e)};k.setNow=function(g,f){h?alp.now.set(g,f):g.setNow(f)};k.state=
function(g){var f=0<arguments.length;return h?alp.state(f&&{init:g}):new alp.State(f&&{init_value:g})};k.stringState=function(g){var f=0<arguments.length;return h?alp.stringState(f&&{init:g}):new alp.StringState(f&&{init_value:g})};k.to=function(g,f){var e=alp.Aps.call(arguments,1);return g[h?"to":"then"].apply(g,e)};k.trigger=function(g,f){var e=Array.prototype.slice.call(arguments);h?(e.splice(0,1),g.trigger.apply(g,e)):(e.splice(0,2),f.triggerSoon.apply(f,e))}})();"undefined"!==typeof dojo&&dojo.provide("alp.i.i_youtube_player");
(function(){function k(d,b){var c=d.m.src.get();c&&c.id&&(d=d.playlist[c.id]||(d.playlist[c.id]={}),b={status:b.getPlayerState(),startSeconds:b.getCurrentTime(),duration:b.getDuration()||c.duration||0,index:d.isPlaylist?b.getPlaylistIndex():-1},alp.mix(d,b))}function h(d){var b=alp.sHash(d),c=alp.gEBI(b),a=alp.dfrd("yt:iframe:api",{then:1}),e=alp.nowF("done",a);c?e():(b=alp.cE("div",null,{id:b}),d=alp.cE("script",b,{type:"text/javascript",src:d}),c=alp.body(),alp.aEL(d,"load readystatechange",e),
c.appendChild(b));return a}function g(d){return function(){var b=(f?[]:[null]).concat([].slice.call(arguments));return d.apply(this,b)}}var f=alp.Later,e=alp.i.state;alp.sub("alp.i",null,!0).IYTPlayer={cont:null,videoid:"",previewUrl:"",width:"100%",height:"100%",autoplay:!1,allowfullscreen:!1,var_modestbranding:1,var_rel:0,var_showinfo:0,contClass:"oax-yt-wrapper",videoContClass:"oax-yt-video-wrapper",videoClass:"oax-yt-video",previewImgContClass:"oax-yt-preview",pausedClass:"oax-yt-status-pause",
stoppedClass:"oax-yt-status-stop",playlist:{},playerDfrd:null,playVideo:alp.nowF(g(function(){alp.m(this.playerDfrd,["to","then"],function(d){d.playVideo()})})),pauseVideo:alp.nowF(g(function(d,b){var c=this;alp.m(this.playerDfrd,["to","then"],function(a){var d=a.getPlayerState();if(d===YT.PlayerState.PLAYING||d===YT.PlayerState.PAUSED)b&&k(c,a),a.pauseVideo(),alp.setClass(c.videoCont,[[c.stoppedClass,!1],[c.pausedClass,!0]])})})),changeVideo:alp.nowF(g(function(d,b,c){var a=this,f=null;b&&(f=a.playlist[b]||
(a.playlist[b]={}),f.id=b,alp.opt(c,"optImgUrl")&&!f.previewImg&&(f.previewImg=c.optImgUrl));alp.m(this.playerDfrd,["to","then"],function(b){alp.opt(c,"saveCur")&&k(a,b);e.setNow(a.m.src,f);alp.opt(c,"autoplay")&&b.playVideo()})})),cuePlaylist:alp.nowF(g(function(d,b,c){var a=this,f=null;b&&(f=a.playlist[b]||(a.playlist[b]={}),f.isPlaylist=!0,f.id=b,alp.opt(c,"optImgUrl")&&!f.previewImg&&(f.previewImg=c.optImgUrl));alp.m(this.playerDfrd,["to","then"],function(b){alp.opt(c,"saveCur")&&k(a,b);e.setNow(a.m.src,
f);alp.opt(c,"autoplay")&&b.playVideo()})})),close:function(d){var b=this;d&&alp.m(this.playerDfrd,["to","then"],function(c){k(b,c)});/^iframe$/.test(b.video.tagName.toLowerCase())&&(e.setNow(b.m.src,null),b.playerDfrd=alp.dfrd("yt:player",{then:1}))},destroy:function(){alp.m(this.playerDfrd,["to","then"],function(d){try{d.destroy()}catch(b){}})},playerStateChangeEvt:alp.memM("playerStateChangeEvt",'alp.event( "yt:playerStateChangeEvt", { then:1 })'),loadFromSrc:null,fetch_or_create:function(d,b,
c,a,e){b.childNodes.a;c||(c="div");var f=this[d+"Class"];f.substring.call.a;this[d]||(this[d]=alp.gEBCN(f,b)[0]||alp.cE(c,b,alp.oCreateMix({"class":f},a),e))},i_augmentModel:function(d){this.cont.childNodes.a;this.playerDfrd=alp.dfrd("yt:player",{then:1});d.src=e.objectState({id:this.videoid||null,status:-1,startSeconds:0,duration:0,previewImg:this.previewUrl||null,isPlaylist:!1,index:0})},i_augmentKids:function(d){d=alp.setClass(this.cont||(this.cont=alp.cE("div")),this.contClass,!0);alp.setClass(d,
"oax-full-height",!!alp.Later);this.fetch_or_create("videoCont",this.cont);this.fetch_or_create("video",this.videoCont);this.fetch_or_create("previewImgCont",this.videoCont);this.previewImg=alp.gEBTN("img",this.previewImgCont)[0]||alp.cE("img",this.previewImgCont);alp.gEBTN("span",this.previewImgCont)[0]||alp.cE("span",this.previewImgCont,{"class":"oax-icon-play oax_video_play"})},i_connectModel2View:function(d,b,c,a){e.chenInit(c.src,alp.nowF(function(){alp.m(d.playerDfrd,["to","then"],function(a){var b=
c.src.get(),e=alp.opt(b,"id");e&&(d.previewImg.src=b.previewImg?b.previewImg:alp.tmpl("https://i1.ytimg.com/vi/${youtubeId}/maxresdefault.jpg",{youtubeId:e}),alp.setClass(d.videoCont,[[d.stoppedClass,!0],[d.pausedClass,!1]]),d.loadFromSrc(b,a))})}))},connectPureView:function(d,b,c,a){function e(){if("undefined"===typeof YT)return setTimeout(alp.bindF(e),234);YT.ready(f)}function f(){function a(a){if("function"===typeof d.onPlayerStateChange)d.onPlayerStateChange(this,a);a?a.trigger(d.playerStateChangeEvt()):
d.playerStateChangeEvt().triggerSoon(this)}var b=d.m.src.get();b={videoId:alp.opt(b,"id"),width:d.width,height:d.height,playerVars:{modestbranding:d.var_modestbranding,controls:d.var_controls,enablejsapi:d.var_enablejsapi,origin:oa.SERVER,autoplay:d.autoplay?1:0,rel:d.var_rel,showinfo:d.var_showinfo,fs:d.allowfullscreen?1:0},events:{onReady:alp.nowF(g(function(b,c){if(d.video!==c.target.getIframe()){var e=null;setInterval(function(){var b=c.target.getPlayerState();e!==b&&(alp.now(a,{target:c.target,
data:b}),e=b)},100);d.video=c.target.getIframe();d.allowfullscreen&&alp.Later||alp.rA(d.video,"allowfullscreen")}d.playerDfrd.done(c.target)}))}};new YT.Player(d.video,b)}alp.m(h("https://www.youtube.com/iframe_api"),["to","then"],e)}}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.youtube_player");
(function(){function k(f,e){return function(d){alp.stopEvent(d||window.event);var b=alp.offset(f),c=alp.gBCR(f);e.set((d.pageX-b.offsetLeft)/c.width)}}function h(f,e,d,b){var c=alp.x.dnd(f,{clickable:e,xy_constrain:alp.x.dnd.XY_CONSTRAIN_H,dummy_cfg:function(a){return{css_class:a,create:function(a,b){this._standard_create(a,b);alp.style(this.node,{width:this.dnd.initialMouseX_delta+"px"})}}}(b)});c.droppedAtEvt().then(alp.nowF(function(a,b,e){b=alp.gBCR(c.node.parentElement).width;d.set(Math.max(0,
Math.min(c.initialMouseX_delta+a-e,b))/b)}));c.dummy.updateEvt().then(function(a,b,d){a=alp.gBCR(c.node.parentElement).width;alp.style(c.dummy.node,{width:Math.max(0,Math.min(c.initialMouseX_delta+d,a))+"px"})});return c}alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.YTPlayer",alp.x.AbstractController,null,alp.i.IYTPlayer,{cont:null,proj:null,videoid:null,hideControls:!0,var_controls:0,var_enablejsapi:1,controlsClass:"oax-yt-controls",playBtnClass:"oax-yt-play-btn",playIconClass:"oax-icon-play",
pauseIconClass:"oax-icon-pause",replayIconClass:"oax-icon-arrow-circle-right",timeContClass:"oax-yt-time",curTimeClass:"oax-yt-current-time",durTimeClass:"oax-yt-duration",volumeContClass:"oax-yt-volume",volumeStatusClass:"oax-yt-volume-status",volStatOnClass:"oax-icon-speaker",volStatOffClass:"oax-icon-speaker-mute",volumeBarContClass:"oax-yt-volume-bar-cont",volumeBarClass:"oax-yt-volume-bar",fullScreenContClass:"oax-yt-fs-cont",fullScreenBtnClass:"oax-yt-fs-btn",enterFsIconClass:"oax-icon-maximize",
exitFsIconClass:"oax-icon-minimize",progressContClass:"oax-yt-progress-cont",progressBarClass:"oax-yt-progress-bar",loadFromSrc:function(f,e){var d=YT.PlayerState.ENDED===f.status?0:f.startSeconds||0,b=0<f.duration?d/f.duration:0;this.m.duration.set(f.duration||0);this.m.progressVis.set(b);f.isPlaylist?e.cuePlaylist({listType:"playlist",list:f.id,index:0<=f.index?f.index:0,startSeconds:d,suggestedQuality:"large"}):e.cueVideoById({videoId:f.id,startSeconds:d,suggestedQuality:"large"})},onPlayerStateChange:function(f){function e(){var a=
b.getDuration(),c=b.getCurrentTime();0<a&&d.m.progressVis.set(c/a)}var d=this,b=f.target,c=f.data===YT.PlayerState.PLAYING,a=b.getDuration(),h={};h.oax_yt_playing=c;h.oax_yt_paused=!c&&f.data!==YT.PlayerState.ENDED;h.oax_yt_replay=!c&&f.data===YT.PlayerState.ENDED;alp.setClass(d.playBtn,h);switch(f.data){case YT.PlayerState.PLAYING:g||(g=setInterval(alp.nowF(e),500));case YT.PlayerState.BUFFERING:d.hideControls&&alp.style(b.getIframe(),{"pointer-events":"none"});alp.setClass(this.videoCont,[[this.stoppedClass,
!1],[this.pausedClass,!1]]);break;case YT.PlayerState.CUED:case YT.PlayerState.PAUSED:d.hideControls&&alp.style(b.getIframe(),{"pointer-events":""});clearInterval(g);g=null;alp.style(d.controls,{height:""});break;case YT.PlayerState.ENDED:alp.style(d.controls,{height:""}),alp.setClass(this.videoCont,[[this.stoppedClass,!0],[this.pausedClass,!1]])}a&&d.m.duration.set(a)},augmentModel:function(f){this.i_augmentModel(f);f.duration=new alp.NumberState;f.mute=new alp.BoolState;f.volume=new alp.MinMaxState({init_value:0,
min:0,max:1});f.volumeVis=new alp.MinMaxState({init_value:0,min:0,max:1});f.progress=new alp.MinMaxState({init_value:0,min:0,max:1});f.progressVis=new alp.MinMaxState({init_value:0,min:0,max:1});f.fullscreen=new alp.BoolState({init_value:!1})},augmentKids:function(f){this.i_augmentKids(f);this.fetch_or_create("progressCont",this.cont);this.fetch_or_create("progressBar",this.progressCont);this.fetch_or_create("controls",this.cont);this.fetch_or_create("playBtn",this.controls,"button");this.fetch_or_create("pauseIcon",
this.playBtn,"span");this.fetch_or_create("playIcon",this.playBtn,"span");this.fetch_or_create("replayIcon",this.playBtn,"span");this.fetch_or_create("timeCont",this.controls);this.fetch_or_create("curTime",this.timeCont,"span");alp.cTxN(" / ",this.timeCont);this.fetch_or_create("durTime",this.timeCont,"span");this.fetch_or_create("volumeCont",this.controls);this.fetch_or_create("volumeStatus",this.volumeCont);this.fetch_or_create("volStatOn",this.volumeStatus,"span");this.fetch_or_create("volStatOff",
this.volumeStatus,"span");this.fetch_or_create("volumeBarCont",this.volumeCont);this.fetch_or_create("volumeBar",this.volumeBarCont);this.allowfullscreen&&(this.fetch_or_create("fullScreenCont",this.controls),this.fetch_or_create("fullScreenBtn",this.fullScreenCont),this.fetch_or_create("enterFsIcon",this.fullScreenBtn,"span"),this.fetch_or_create("exitFsIcon",this.fullScreenBtn,"span"))},setInitVal:function(f,e,d,b){f.playerDfrd.then(function(b){d.duration.set(b.getDuration());d.mute.set(b.isMuted());
d.volume.set(b.getVolume()/100);d.volumeVis.set(b.getVolume()/100)})},connectModel2View:function(f,e,d,b){function c(){var a=d.mute.get(),b=d.volume.get(),c={};c.oax_yt_volume_on=!a;c.oax_yt_volume_off=a;alp.setClass(f.volumeStatus,c);alp.style(f.volumeBar,{width:a?0:100*b+"%"})}f.i_connectModel2View(f,e,d,b);d.fullscreen.change_cb_init(function(){alp.dom.isFullscreenSupported?(d.fullscreen.get()?alp.dom.requestFullscreen(f.cont):alp.dom.exitFullscreen(),alp.setClass(f.cont,"oax-yt-fullscreen-on",
d.fullscreen.get()),alp.setClass(f.cont,"oax-yt-fullscreen-off",!d.fullscreen.get())):console.error("Fulscreen not supported")});d.duration.change_cb_init(function(){var a=d.duration.get();alp.setText(f.durTime,alp.sec2str(a))});d.mute.change_cb_init(alp.bindF(function(){this.playerDfrd.then(function(a){d.mute.get()?a.mute():a.unMute()})},f));d.mute.change_cb(c);d.volume.change_cb_init(alp.nowF(function(){this.playerDfrd.then(function(a){var b=d.volume.get();d.mute.set(!1);a.setVolume(100*b)})},f));
d.volumeVis.change_cb_init(c);d.progress.change_cb(alp.nowF(function(){this.playerDfrd.then(function(a){var b=f.m.progress.get(),c=a.getDuration()||f.m.duration.get();a.seekTo(c*b)})},f));d.progressVis.change_cb_init(alp.nowF(function(){this.playerDfrd.then(function(a){a=d.progressVis.get();alp.style(f.progressBar,{width:100*a+"%"});alp.setText(f.curTime,alp.sec2str(a*(d.duration.get()||0)))})},f))},connectView2Model:function(f,e,d,b){function c(a){d.fullscreen.toggle()}function a(a){d.fullscreen.set(alp.dom.isFullscreen())}
function g(a){alp.stopEvent(a||window.event);f.playerDfrd.then(function(a){a.getPlayerState();switch(a.getPlayerState()){case YT.PlayerState.PLAYING:case YT.PlayerState.BUFFERING:a.pauseVideo();break;case YT.PlayerState.ENDED:a.seekTo(0);case YT.PlayerState.CUED:case YT.PlayerState.PAUSED:a.playVideo()}})}function l(a){function b(){f.playerDfrd.then(function(a){a.getPlayerState()===YT.PlayerState.PLAYING&&(alp.style(f.controls,{height:"0"}),n=!0)})}n&&(alp.style(f.controls,{height:""}),n=!1);0<a?
(clearTimeout(r),r=setTimeout(b,a)):b()}e.push(alp.aEL(f.playBtn,"click",alp.nowF(g)));f.allowfullscreen&&(e.push(alp.aEL(f.fullScreenBtn,"click",alp.nowF(c))),e.push(alp.dom.aELfullscreen(alp.nowF(a))));e.push(alp.aEL(f.volumeStatus,"click",alp.nowF(function(a){alp.stopEvent(a||window.event);d.mute.set(!d.mute.get())})));e.push(alp.aEL(f.volumeBarCont,"click",alp.nowF(k(f.volumeBarCont,d.volume))));e.push(alp.aEL(f.progressCont,"click",alp.nowF(k(f.progressCont,d.progress))));e.push(alp.aEL([f.playBtn,
f.volumeStatus,f.volumeBarCont,f.progressCont],"mouseup",function(a){alp.stopEvent(a||window.event)}));f.hideControls&&(e.push(alp.aEL(f.videoCont,"click",alp.nowF(g))),e.push(alp.aEL(f.cont,"mousemove",alp.bindF(l,null,2E3))),e.push(alp.aEL(f.cont,"mouseleave",alp.bindF(l,null,0))));h(f.volumeBar,f.volumeBarCont,d.volume,f.volumeBarClass+" oax_volume_dummy");h(f.progressBar,f.progressCont,d.progress,f.progressBarClass);var r,n=!1},connectModel2Model:function(f,e,d,b){d.volume.bind_to(d.volumeVis);
d.progress.bind_to(d.progressVis)}});var g})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.image_variations");
(function(){alp.sub("alp.data.api",null,!0).image_variations_dfrd=alp.memF(function(){var k=alp.dfrd("image_variations",{then:1});alp.m(alp.jsonp(alp.cfg.url.api_image_variations_xd()),["to","then"],function(h){h=alp.arr2o(h.property,"text",alp.f("alp.map(v.property,\"(v=v.text.split(',')),(v.length<2?v[0]|0:[v[0]|0,v[1]|0])\")"));var g=h.widthAndHeight,f=h.widthOrHeight;g&&(h.width=alp.arrSorted(alp.map(g,"v[0]")),h.height=alp.arrSorted(alp.map(g,"v[1]")));f&&(f.sort(alp.f("v-w")),h.min=f[0],h.max=
f[f.length-1]);k.done(h)});return k})})();"undefined"!==typeof dojo&&dojo.provide("alp.i.i_thumb_gallery");
(function(){function k(a,b,c,d,e,f){a=a.widthAndHeight;var g=-1<d.indexOf("${h}"),l=-1<d.indexOf("${w}");a&&g&&!l||null.not_supported;b=alp.or(a,1.5<b/c?"v[1] >= "+e+"  &&  v":"v[0] >= "+f+"  &&  v")||[b,c];return{wh:b,url:alp.tmpl(d,{h:b[1]})}}function h(g,h){e.to(f.image_variations_dfrd(),function(f){function t(){alp.forEach(M,w)}function w(a,b){var c=a.clientWidth,d=a.clientHeight;if(!(0<c&&0<d))return alp.asyncF(123,w)(a,b);var e=G[b],g=e.width/e.height>c/d,l=e.srcTmpl;if(l){e=J[b];var h=G[b].width;
var k=G[b].height;d={width:c,height:d};c=L[b];var m=f.widthAndHeight,n=-1<l.indexOf("${h}"),q=-1<l.indexOf("${w}");m&&n&&!q||null.not_supported;h=alp.or(m,"v[0]>=this.width && v[1]>=this.height && v",d)||[h,k];h[0]>c[0]||h[1]>c[1]?(l=alp.tmpl(l,{h:h[1]}),h={wh:h,url:l}):h=void 0;l=h&&h.wh;h=h&&h.url;l&&h!==e&&(L[b]=l,J[b]=h,b=F[b],b.src===e&&(b.src=h))}alp.setClass(a,[["oax-landscape",g],["oax-portrait",!g]]);alp.style(a,{visibility:""})}function u(a,b){var c=a.width,l=a.height,h=a.srcTmpl,m=a.imgurl;
h?(c=k(f,c,l,h,g.initThumbWidth,g.initThumbHeight),L.push(c.wh),h=c.url):h=m;I.push(h);J.push(h);c=alp.cE("div",B,{"class":A,style:"visibility: hidden"});l=alp.cE("div",c,{"class":C});h=alp.cE("img",l,{src:b<g.nLoadAtOnce?h:d});P.push(c);H.push(l);F.push(h);a.isVideo&&alp.cE("span",l,{"class":"oax-icon-play"});alp.aELtouchup(c,alp.nowF(function(c){g._last_thumb_click={i:b,one:a};e.trigger(c,g.thumbClickEvt())}))}var A=g.thumbClass,C=g.innerClass,E=g[c]||(g[c]=e.hg());if(h.isVisible.get()){var G=h.cfg.get(),
B=document.createDocumentFragment(),I=[],L=g[a]=[],J=g[m]=[],P=g[l]=[],H=g[r]=[],F=g[n]=[];g[q]=[];g[p]=[];g[v]=[];alp.forEach(G||[],u);var D=alp.oToString(I);if(D!==g[b]){E.clear();g[b]=D;alp.aC(alp.empty(g.cont),B);var M=alp.gEBCN(A,g.cont);t();setTimeout(t,1810);E.push(alp.aEL(window,"resize",alp.ratelimitF(178,alp.chainF(t,alp.asyncF(250,t)))))}}})}function g(a){var b=a[m],c=a[l],d=a[r],e=a[n],f=a[q],g=a[p],h=a[v],k=a.showLoadingIndicatorAfterMs,u=b&&e&&b.length;if(0<u){b.length===e.length&&b.length==
d.length||null.bug;var B=alp.map(e,"v.src===this[ i ]  &&  v.complete",b);var I=alp.and(B);if(!I){var L=alp.map(e,"v.src===this[ i ]  &&  !v.complete  ?  1  :  0",b),J=alp.reduce(L,"+"),P=a.nLoadAtOnce-J;if(!(1>P))for(J=0;J<u&&0<P;J++)B[J]||L[J]||(P--,e[J].src=b[J],L[J]=!0)}for(J=0;J<u;J++){e=I?!1:L[J];P=I?!0:B[J];var H=[b[J],e,P].join("#"),F=Date.now(),D=H===g[J]&&h[J]||(h[J]=F);F-=D;F=e&&F>k;g[J]=H;if(D=alp.sub("alp.x2.spinner"))H=f[J],!F&&H&&H.parentNode&&alp.orphan(H),F&&(H||(H=f[J]=D.create_node()),
F=d[J],H&&F===H.parentNode&&H==F.firstElementChild||alp.place(H,F,"first"));alp.setClass(c[J],[[a.loadingClass,e],[a.completeClass,P]])}}}var f=alp.data.api,e=alp.i.state,d=alp.cfg.image().transp_1x1.url;alp.sub("alp.i",null,!0).IThumbGallery={cont:null,m_input:null,thumbClass:"oax-gallerythumb",innerClass:"oax-gallerythumb-inner",nLoadAtOnce:3,loadingClass:"oax-img-loading",completeClass:"oax-img-complete",showLoadingIndicatorAfterMs:3500,initThumbWidth:350,initThumbHeight:300,thumbClickEvt:alp.memM("thumbClickEvt",
'alp.event("thumbClickEvt",{then:1})'),getLastThumbClick:alp.f('this["_last_thumb_click"]'),augmentModel:function(a){a.cfg=e.objectState();a.isVisible=e.boolState();a.selected=e.intState();var b=this.m_input;b&&alp.mixCheck(a,b)},augmentKids:function(a){this.cont.childNodes.a},connectModel2View:function(a,b,c,d){d=alp.bindF(h,null,a,c);b.push(e.chenInit(c.isVisible,d));b.push(e.chen(c.selected,d));b.push(setInterval(alp.bindF(g,null,a),233),clearInterval)}};var b="_previous_uniq",c="_thumb_hg",a=
"_current_wh_arr",m="_current_imgurl_arr",l="_current_topnode_arr",r="_current_innernode_arr",n="_current_imgnode_arr",q="_current_spinner_arr",p="_current_status_arr",v="_last_stat_chg_arr"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.thumb_gallery");(function(){alp.declare("alp.x.ThumbGallery",alp.x.AbstractController,null,alp.i.IThumbGallery)})();"undefined"!==typeof dojo&&dojo.provide("alp.view.lightboxview");
(function(){function k(a){a.showed.setMax(a.cfg.get().length-1)}function h(a){var b=a.ctrlThumbCont.clientWidth;b?a.kx.imageBar.setMaxWidth(b-88):a.kx.imageBar.setMaxWidth(a.cont.clientWidth-88)}function g(a,b,d,e,f,h){d.childNodes.a;e||(e="div");if("*"===b.slice(-1)){b=b.slice(0,-1);b=new RegExp("^("+b+".+)Class$");for(var l in a)l in c||(h=(f=l.match(b))&&f[1],f&&g(a,h,d,e))}else l=a[b+"Class"],l.substring.call.a,a[b]||(a[b]=alp.gEBCN(l,d)[0]||alp.cE(e,d,alp.oCreateMix({"class":l},f),h))}function f(a){function b(){var c=
(Date.now?Date.now():+new Date)-a.kx.image.m.showedSince.get()-a.pauseDurationMs,d=0<=c;d&&a.showNext();a._play_h=setTimeout(b,d?a.pauseDurationMs:c||133)}var c=a.m.playing.get();alp.setClass(a.cont,a.playingClass,c);alp.setClass(a.cont,a.pausedClass,!c);c?(null==a._play_h&&(a._play_h=setTimeout(b,a.pauseDurationMs)),setTimeout(alp.bindF("showNext",a),2E3)):(null!=a._play_h&&clearTimeout(a._play_h),a._play_h=null)}function e(a,b){b=b.galleryOpen.get();alp.setClass(a.cont,a.galleryVisibleClass,b)}
alp.cfg.image();var d="imgurl legend width height is_pano isVideo youtubeId title".split(" "),b=function(a){return alp.opt(a,d)},c={},a=alp.i18n.fetch("alp.all");alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.view.LightboxView",alp.x.AbstractController,null,{cont:null,initPlaying:!1,pauseDurationMs:3E3,withGallery:!1,widthFactor:1,initThumbOpen:null,initGalleryOpen:!1,contClass:"alp-lightboxview-cont",galleryContClass:"alp-lightboxview-gallery-cont",galleryVisibleClass:"alp-lightboxview-gallery-visible",
imgContClass:"alp-lightboxview-img-cont",imgNextClass:"alp-lightboxview-next",imgPrevClass:"alp-lightboxview-prev",videoContClass:"alp-lightboxview-video-cont",ctrlThumbTopClass:"alp-lightboxview-thumb-top",ctrlThumbContMaskClass:"alp-lightboxview-thumb-cont-mask",ctrlThumbContClass:"alp-lightboxview-thumb-cont",ctrlWrapClass:"alp-lightboxview-ctrl-wrapper",ctrlContMaskClass:"alp-lightboxview-ctrl-cont-mask",ctrlContClass:"alp-lightboxview-ctrl-cont",ctrlPauseClass:"alp-lightboxview-pause",ctrlPlayClass:"alp-lightboxview-play",
ctrlCounterClass:"alp-lightboxview-counter",ctrlIndexClass:"alp-lightboxview-index",ctrlDivideClass:"alp-lightboxview-divide",ctrlTotalClass:"alp-lightboxview-total",ctrlLegendClass:"alp-lightboxview-legend",ctrlThumbBtnClass:"alp-lightboxview-thumb-btn",onlyOneClass:"alp-lightboxview-has-only-one",manyBtnArr:"imgNext imgPrev ctrlPause ctrlPlay ctrlIndex ctrlTotal ctrlThumbTop ctrlThumbBtn ctrlCounter".split(" "),manyBtnClass:"alp-lightboxview-many-btn",playingClass:"alp-lightboxview-playing",pausedClass:"alp-lightboxview-paused",
thumbOpenClass:"alp-thumb-open",getShowedIndex:function(){return this.m.showed.get()},getTotalNumber:function(){return this.m.cfg.get_property("length")},isPlaying:function(){return this.m.playing.get()},pause:function(){this.m.playing.setNow(!1)},play:function(){this.m.playing.setNow(!0)},keyMessageTmpl:'<img src="'+alp.cssBase()+'alp/images/lightbox_humane_cursor.png"><br /><br /><p>${key_message_text}</p>',keyMessageActive:!1,showKeyMessage:function(){function b(a){alp.humane(alp.tmpl(c.keyMessageTmpl,
a),{extraClass:"alp-lightboxview-humane"})}var c=this;c.keyMessageActive&&a.then(b)},showOne:function(a){if("number"!==typeof a){a=b(a);for(var c=this.m.cfg.get(),d=c.length,e=0;e<d;e++)if(alp.oEqual(a,c[e]))return this.showOne(e);return!1}k(this.m);this.m.showed.setNow(a);var f=this;setTimeout(function(){f.kx.imageBar.m.selected.setNow(f.m.showed.get())},222);return!0},showNext:function(){var a=this.getShowedIndex(),b=this.getTotalNumber();this.m.showed.setNow((a+1)%b)},showPrevious:function(){var a=
this.getShowedIndex(),b=this.getTotalNumber();this.m.showed.setNow((a+b-1)%b)},augmentModel:function(a){a.cfg=new alp.SetState({ordered:!0,do_not_clone:!0,constrain_all:function(a,c){a=alp.SetState.prototype.constrain_all.call(this,a,c);return alp.map(a,b)}});a.showed=new alp.MinMaxState({min:0,max:0});a.playing=new alp.BoolState({init_value:this.initPlaying});var c=this.initThumbOpen;null==c&&(c=this.withGallery);a.thumbOpen=new alp.BoolState({init_value:c});a.galleryOpen=new alp.BoolState({init_value:this.initGalleryOpen});
a._thumbOpacityAnim=new alp.Anim({interval_ms:18,speed:1.7,init_value:~~a.thumbOpen.get(),distorsion:"Math.pow(v, 0.25)"})},augmentKids:function(a){var b=this;alp.setClass(b.cont||(b.cont=alp.cE("div")),b.contClass,!0);g(b,"imgNext",b.cont);g(b,"imgPrev",b.cont);g(b,"imgCont",b.cont);g(b,"videoCont",b.cont);g(b,"ctrlThumbTop",b.cont);g(b,"ctrlThumbContMask",b.ctrlThumbTop);g(b,"ctrlThumbCont",b.ctrlThumbTop);g(b,"ctrlWrap",b.cont);g(b,"ctrlContMask",b.ctrlWrap);g(b,"ctrlCont",b.ctrlWrap);g(b,"ctrlPlay",
b.ctrlCont);g(b,"ctrlPause",b.ctrlCont);g(b,"ctrlCounter",b.ctrlCont);g(b,"ctrlIndex",b.ctrlCounter);g(b,"ctrlDivide",b.ctrlCounter,"span",null,{innerHTML:"/"});g(b,"ctrlTotal",b.ctrlCounter);g(b,"ctrlLegend",b.ctrlCont);g(b,"ctrlThumbBtn",b.ctrlCont);b.withGallery&&g(b,"galleryCont",b.cont);alp.setClass(alp.map(b.manyBtnArr,function(a){return b[a]}),b.manyBtnClass,!0);var c=alp.map(alp.filter(b.manyBtnArr,"!/legend/i.test(v)"),"this[v]",b);alp.forEach(["mousedown","selectstart"],"alp.aEL(this,v,function (e) { alp.stopEvent( e || window.event ); })",
c);a.image=new alp.x.Image({cont:b.imgCont,dndSwipe:!0,opacitySpeed:4.8,zoomSpeed:5});a.video=new alp.x.YTPlayer({cont:b.videoCont,hideControls:!1});alp.style(b.videoCont,{visibility:"hidden",opacity:"0"});a.imageBar=new alp.x.ImageBar({cont:b.ctrlThumbCont,initSelected:b.m.showed.get(),widthFactor:b.widthFactor});b.withGallery&&(a.gallery=new alp.x.ThumbGallery({cont:b.galleryCont,m_input:{cfg:b.m.cfg,isVisible:b.m.galleryOpen,selected:b.m.showed}}));this.m.is_pano=a.image.m.is_pano;this.m.fit=a.image.m.fit},
connectModel2Model:function(a,b,c,d){b.push(c.cfg.change_cb_init(function(){k(c);h(a)}));b.push(c.thumbOpen.change_cb_init(function(){alp.setClass(a.imgCont,a.thumbOpenClass,c.thumbOpen.get());c._thumbOpacityAnim.cancel();c._thumbOpacityAnim[c.thumbOpen.get()?"nextTargetMax":"nextTargetMin"]()}));d.video&&d.video.playerStateChangeEvt().thenSoon(function(b){1===b.data&&a.pause()})},connectModel2View:function(a,b,c,d){function g(b){var e=c.showed.get(),f=c.showed.getPrevious(),g=c.cfg.get_property("length");
alp.setClass(a.cont,a.onlyOneClass,!(1<c.cfg.get().length));alp.setText(a.ctrlIndex,1+e);alp.setText(a.ctrlTotal,g);c.cfg.get_property([f,"isVideo"])&&(d.video.pauseVideo(!0),d.video.playBtn.focus());var l=c.cfg.get_property([e,"isVideo"])||!1;l?(f=c.cfg.get_property([e,"imgurl"]),d.video.changeVideo(c.cfg.get_property([e,"youtubeId"]),{saveCur:!1,autoplay:b,optImgUrl:f})):(d.image.m.url.set(c.cfg.get_property([e,"imgurl"])),d.image.m.title.set(c.cfg.get_property([e,"title"])),b=c.cfg.get_property([e,
"is_pano"]),d.image.m.is_pano.set(b),d.image.m.fit.set(!b));e=c.cfg.get_property([e,"legend"])||"";b=a.ctrlLegend;b.innerHTML!==e&&(b.innerHTML=e);setTimeout(function(){alp.style(a.imgCont,{visibility:l?"hidden":"",opacity:l?"0":""});alp.style(a.videoCont,{visibility:l?"":"hidden",opacity:l?"":"0"})},100)}b.push(c.cfg.bind_to(d.imageBar.m.cfg));b.push(c.showed.bind_to(d.imageBar.m.selected));var l=alp.ratelimitF(123,alp.asyncF(12,function(){if(this.without_check)c.thumbOpen.setNow(!0);else if(d.image.m.is_zoomable.get()&&
!d.image.m.is_pano.get()){var a=d.image.m.fit.get();c.thumbOpen.setNow(a)}}));b.push(c.showed.change_cb(l,{without_check:!0}));b.push(d.image.m.fit.change_cb(l));b.push(d.image.m.is_pano.change_cb(l));b.push(d.image.m.is_zoomable.change_cb(l));b.push(c.cfg.change_cb_init(alp.bindF(g,null,!0)));b.push(c.showed.change_cb_init(alp.bindF(g,null,!1)));b.push(c.playing.change_cb_init(f,null,a));l=[a.ctrlThumbTop];a.withGallery&&l.push(a.ctrlWrap);b.push(c._thumbOpacityAnim.st.change_cb_init(function(b){var c=
a.m._thumbOpacityAnim.st.get();alp.likeIE()?alp.forEach(b,'(v.style.visibility = this > 0.5 ?  ""  :  "hidden")',c):(alp.setOpacity(b,c),alp.forEach(b,'(v.style.visibility = 1e-10 < this  ?  ""  :  "hidden")',c))},null,l));b.push(c.galleryOpen.change_cb_init(e,null,a,c))},connectView2Model:function(a,b,c,d){function e(){var a=d.gallery.getLastThumbClick().i;alp.isFiniteNumber(a)||null.bug;c.showed.set(a);c.galleryOpen.set(!1)}b.push(d.imageBar.m.selected.bind_to(c.showed));b.push(d.image.m.fit.change_v_cb(!1,
function(){c.playing.set(!1)}));b.push(d.image.swipeEvt().then(function(b){"right"===b?a.showPrevious():a.showNext()}));b.push(alp.aEL(d.image.cont,"mousedown mousewheel click keydown touchstart",function(){a.isPlaying()&&a.pause()},!0));b.push(alp.aEL(d.image.cont,"mouseup",function(a){a=d.image.m.is_zoomable.get();var b=c.cfg.get_property(c.showed.get());if(b.isVideo||b.is_pano||a)c.thumbOpen.toggleNow(),d.image.resize()}));b.push(alp.aEL([a.imgNext],"click",function(){a.showNext();a.isPlaying()&&
(a.pause(),a.play())}));b.push(alp.aEL([a.imgPrev],"click",function(){a.showPrevious();a.isPlaying()&&(a.pause(),a.play())}));b.push(alp.aEL(a.ctrlPlay,"click",function(){a.play()}));b.push(alp.aEL(a.ctrlPause,"click",function(){a.pause()}));b.push(alp.aEL([a.imgNext,a.imgPrev,a.ctrlPlay,a.ctrlPause],"selectstart",function(a){alp.stopEvent(a||window.event)}));b.push(alp.aEL(document,"keyup",alp.nowF(function(b){b=(b||window.event).keyCode;b===alp.key.LEFT_ARROW?a.showPrevious():b===alp.key.RIGHT_ARROW?
a.showNext():b===alp.key.SPACE&&c.playing.toggle()})));b.push(alp.aEL(a.ctrlThumbBtn,"click",function(){h(a);c[a.withGallery?"galleryOpen":"thumbOpen"].toggleNow();var b=c.showed.get();c.cfg.get_property([b,"isVideo"])&&a.withGallery&&d.video&&d.video.pauseVideo()}));b.push(alp.aEL(window,"resize",alp.bindF(h,null,a)));h(a);d.gallery&&b.push(d.gallery.thumbClickEvt().then(e))}})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.lightbox");
(function(){function k(a){a.kx.view.m.cfg.set(a.m.cfg.get())}function h(b,e){function l(a){a.childNodes.a;a.style.display;var c=alp.domWalkSelect(a,b.domnode2id,!0);if(c)return{id:b.domnode2id(c),clickable:a};console.error("alp.x.Lightbox could not extract id from domnode. Ignoring it. domnode: ",a)}if(!e)return e;"string"===typeof e&&(e={ooiid:e});if(e.ooiid){var h=this;setTimeout(function(){f(b,e,h)},0);return e}e.slides&&(e=e.slides);"number"!==typeof e.length&&(e=[e]);e instanceof Array||(e=alp.Aps.call(e));
e=e.slice();for(var k=e.length;k--;){var m=e[k];if("childNodes"in m&&m.style){var n=b.domnode2info?b.domnode2info(m):l(m);if(m=(m=alp.nodify(b.imageinfoclass,m))&&alp.oFrom(m.value)){alp.mix(n,m);if(n.is_pano=a.is_panorama(m))n.imgurl=n.imgurl.replace(c.img2max_rx,"/img2/").replace(c.img2max_id_and_rest_rx,"/img2/$1/-x"+Math.min(2048,m.height)+"s/t.jpg");n.is_video=a.is_video(m)}e[k]=n}}e=alp.filter(e,"");k=alp.reduce(e,function(a,b,c){g(b)||a.push(c);return a},[]);k.length&&d(b,e,this,k);return e}
function g(a){return"object"!==typeof a?!1:!!a.imgurl}function f(a,b,c){var d=b.ooiid,f=b.proj||a.proj;d.substring.call.a;f.substring.call.a;(new alp.data.SingleOOI(d,{proj:f,acceptUnpublished:!0})).load(function(d){console.log("xxx TODO lightbox receive ooi info",d);if(!c.get()||c.is(b))d=alp.map(alp.filter(alp.oGet(d,"data.images.image")||[],".gallery"),e,a),c.set(d)})}function e(a){var b=a.author,d=alp.sub("meta.source.name",a),e=alp.filter([b||"",d||""],"").join(", ");e=alp.tmpl(this._legendTmplHtml||
"${title} ${author_source}",{title:a.title||"",author_source:e?" ("+e+")":"",author:b||"",source:d||""});e=alp.cE("div",null,null,{innerHTML:e});var f=alp.gEBCN(this.authorClass,e),g=alp.gEBCN(this.sourceClass,e);alp.style(f,{display:b?"":"none"});alp.style(g,{display:d?"":"none"});e=e.innerHTML;return{imgurl:c.img_from_id(a.id,"max"),legend:e,is_pano:a.is_pano||!1,isVideo:a.isVideo||!1,youtubeId:a.isVideo?a.video.youtubeId:null}}function d(a,b,c,d){d=alp.map(d,function(a){a=b[a];a="string"===typeof a?
a:a.id;a.substring.call.a;return a});a=a.proj;a.substring.call.a;(new alp.data.OOIs({idlist:d,proj:a})).load(function(a,d){console.log("xxx TODO lightbox receive img infos",a,d);c.is(b)})}var b=alp.sub("alp.x",null,!0),c=alp.cfg.url,a=alp.cfg.image(),m=new alp.PoliteSetState,l;alp.ensureCss(alp.cssBase()+"alp/x.css");b.genLightbox=function(a,b){return new alp.x.Lightbox(alp.oCreateMix(b||{},{init_value:a}))};alp.declare("alp.x.Lightbox",alp.x.AbstractController,null,{init_value:null,proj:null,pauseDurationMs:3E3,
withGallery:/[\?&]glr=(?:1|t|true)(?:$|&)/i.test(location.search),widthFactor:1,extrathumb:null,extrathumb_default:{w:70,h:40},initNow:!0,interceptOpenCloseClick:null,domnode2info:null,domnode2id:function(a){return alp.opt((a.className||"").match(/(^|\s)oax-claim-(\d+)(\s|$)/),2)},imageinfoclass:"oax-one-image-info",contClass:"alp-x-lightbox-cont",contDelay:.678,maskClass:"alp-x-lightbox-mask",foreClass:"alp-x-lightbox-fore",contCloseClass:"alp-x-lightbox-close",contCloseHTML:"&times;",isOpenBodyClass:"alp-x-lightbox-visible",
legendTmpl:null,authorClass:"oax-lightbox-author",sourceClass:"oax-lightbox-source",open:function(a){a.toPrecision.call.a;r(this,a)},setView:alp.nowF(function(a){this.kx.view.m.cfg.get().length||this.kx.view.m.cfg.set(this.m.cfg.get());return this.kx.view.showOne(a)}),show:alp.nowF(function(a){a&&this.m.cfg.set(a);this.kx.view.m.cfg.set(this.m.cfg.get());this.m.open.set(!0)}),hide:function(){this.m.open.setNow(!1)},isOpen:function(){return this.m.open.get()},isReady:function(){var a=this.m.cfg.get();
return a&&a instanceof Array&&alp.and(a,g)},augmentModel:function(a){a.cfg=new alp.State({constrain_all:alp.bindF(h,null,this),init_value:this.init_value});a.open=new alp.BoolState;m.add(a.open)},augmentKids:function(a){var b=this,c;b.cont||(b.cont=alp.aC(alp.cE("div",null,{"class":b.contClass}),alp.cE("div",null,{"class":b.maskClass}),c=alp.cE("div",null,{"class":b.foreClass}),alp.cE("div",null,{"class":b.contCloseClass},{innerHTML:b.contCloseHTML,onclick:function(){alp.m(b,["interceptOpenCloseClick",
"hide"])}})));a.view=new alp.view.LightboxView(alp.mix(alp.opt(b,["pauseDurationMs","withGallery","widthFactor"]),{cont:c}));this._legendTmplHtml=(a=this.legendTmpl)&&("string"===typeof a?a:a.innerHTML)},connectModel2View:function(a,b,d,e){function f(){function b(b){function c(){a.setView(b);a.interceptOpenCloseClick(!0)}var e=b.clickable;e&&d.push(alp.aEL(e,"click",a.interceptOpenCloseClick?c:alp.bindF(r,null,a,b)))}var c=a.m.cfg.get();if(a.isReady()){var d=a._clickable_eh();d.clear();alp.forEach(c,
b)}}function g(){function b(b,e){var f=b.offsetWidth,g=b.offsetHeight;if(e=alp.oGet(d,[e,"imgurl"])){f&&g||(g=a.extrathumb_default,f=g.w,g=g.h);(f||null).toPrecision.call.a;(g||null).toPrecision.call.a;var l=e.replace(c.img2max_id_extract_rx,"/img2/"+f+"x"+g+"f/");l===e&&console.error("ImgTouchBox could not build `extrathumb_url`.");alp.cE("img",b,{src:l,width:f,height:g})}else alp.style(b,{display:"none"})}var d=a.m.cfg.get();a.isReady()&&alp.forEach(alp.children(a.extrathumb),b)}var h=alp.nowF(function(){function b(){a.m.open.get()||
alp.orphan(a.cont)}var c=a.isOpen(),d=a.isReady();c&&d?(k(a),alp.aC(alp.body(),a.cont),e.view.m.playing.set(!1),1<e.view.m.cfg.get_property("length")&&!l&&(l=!0,e.view.showKeyMessage())):c?setTimeout(h,100):(e.view.kx.video&&e.view.kx.video.close(!0),setTimeout(b));alp.setOpacity(a.cont,c?1:0);alp.setClass(alp.body(),a.isOpenBodyClass,!!c)});b.push(d.open.change_cb(h));b.push(d.cfg.change_cb(h));b.push(d.open.change_cb(f));b.push(d.cfg.change_cb(f));a.extrathumb&&b.push(d.cfg.change_cb_init(g));h();
f()},connectView2Model:function(a,b,c,d){function e(c,d){b.push(alp.aEL(c,"click",alp.bindF(r,null,a,d)));alp.setClass(c,"alp-x-clickable",!0)}b.push(alp.aEL(alp.body(),"keyup",function(b){c.open.get()&&(b||(b=window.event),b.keyCode===alp.key.ESCAPE&&(alp.stopEvent(b),a.interceptOpenCloseClick?a.interceptOpenCloseClick(!1):c.open.setNow(!1)))}));a.extrathumb&&alp.forEach(a.extrathumb.children,e)},_clickable_eh:alp.memM("_clickable_eh","new alp.Eh")});var r=alp.nowF(function(a,b){k(a);a.kx.view.showOne(b)&&
a.m.open.set(!0)})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.animation");
(function(){var k=alp.sub("alp.x",0,1);k.Easing={easeNone:function(h,g,f,e){return f*h/e+g},easeIn:function(h,g,f,e){return f*(h/=e)*h+g},easeOut:function(h,g,f,e){return-f*(h/=e)*(h-2)+g},easeBoth:function(h,g,f,e){return 1>(h/=e/2)?f/2*h*h+g:-f/2*(--h*(h-2)-1)+g},easeInStrong:function(h,g,f,e){return f*(h/=e)*h*h*h+g},easeOutStrong:function(h,g,f,e){return-f*((h=h/e-1)*h*h*h-1)+g},easeBothStrong:function(h,g,f,e){return 1>(h/=e/2)?f/2*h*h*h*h+g:-f/2*((h-=2)*h*h*h-2)+g},elasticIn:function(h,g,f,
e,d,b){if(1E-10>Math.abs(h))return g;if(1==(h/=e))return g+f;b||(b=.3*e);!d||d<Math.abs(f)?(d=f,f=b/4):f=b/(2*Math.PI)*Math.asin(f/d);return-(d*Math.pow(2,10*--h)*Math.sin(2*(h*e-f)*Math.PI/b))+g},elasticOut:function(h,g,f,e,d,b){if(1E-10>Math.abs(h))return g;if(1==(h/=e))return g+f;b||(b=.3*e);if(!d||d<Math.abs(f)){d=f;var c=b/4}else c=b/(2*Math.PI)*Math.asin(f/d);return d*Math.pow(2,-10*h)*Math.sin(2*(h*e-c)*Math.PI/b)+f+g},elasticBoth:function(h,g,f,e,d,b){if(1E-10>Math.abs(h))return g;if(2==(h/=
e/2))return g+f;b||(b=.3*e*1.5);if(!d||d<Math.abs(f)){d=f;var c=b/4}else c=b/(2*Math.PI)*Math.asin(f/d);return 1>h?-.5*d*Math.pow(2,10*--h)*Math.sin(2*(h*e-c)*Math.PI/b)+g:d*Math.pow(2,-10*--h)*Math.sin(2*(h*e-c)*Math.PI/b)*.5+f+g},backIn:function(h,g,f,e,d){"undefined"==typeof d&&(d=1.70158);return f*(h/=e)*h*((d+1)*h-d)+g},backOut:function(h,g,f,e,d){"undefined"==typeof d&&(d=1.70158);return f*((h=h/e-1)*h*((d+1)*h+d)+1)+g},backBoth:function(h,g,f,e,d){"undefined"==typeof d&&(d=1.70158);return 1>
(h/=e/2)?f/2*h*h*(((d*=1.525)+1)*h-d)+g:f/2*((h-=2)*h*(((d*=1.525)+1)*h+d)+2)+g},bounceIn:function(h,g,f,e){return f-k.Easing.bounceOut(e-h,0,f,e)+g},bounceOut:function(h,g,f,e){return(h/=e)<1/2.75?7.5625*f*h*h+g:h<2/2.75?f*(7.5625*(h-=1.5/2.75)*h+.75)+g:h<2.5/2.75?f*(7.5625*(h-=2.25/2.75)*h+.9375)+g:f*(7.5625*(h-=2.625/2.75)*h+.984375)+g},bounceBoth:function(h,g,f,e){return h<e/2?.5*k.Easing.bounceIn(2*h,0,f,e)+g:.5*k.Easing.bounceOut(2*h-e,0,f,e)+.5*f+g}};(function(){var h=new alp.util.Background({pause_work_ratio:1,
work_max_ms:0,pause_min_ms:alp.likeIE()?10:0,pause_max_ms:10,_entry_list:[],do_one_impl:function(){var e=!1,d=[];alp.forEach(this._entry_list,function(b){var c=b.arr,a=b.start_sec,f=(Date.now?Date.now():+new Date)/1E3,g=[];alp.forEach(c,function(b){if(b&&b.node&&b.attr&&b.duration_sec){var c=a+b.duration_sec;this._update_anim(b.node,b.attr,Math.max(0,Math.min(1,(f-a)/b.duration_sec)),b.easing);e=!0;if(f<c)g.push(b);else if(b.on_end)try{e=!0,b.on_end()}catch(q){console.error("alp.x: _animator.do_one_impl(): caught exception while calling on_end:",
b.on_end," of o:",b),console.error("alp.x: _animator.do_one_impl(): exception:",q)}}},this);0<g.length&&d.push({arr:g,start_sec:a})},this);this._entry_list=d;return e},start_anim:function(e){this._entry_list.push({arr:e,start_sec:(Date.now?Date.now():+new Date)/1E3});this.do_some()},_update_anim:function(e,d,b,c){c=c||k.Easing.easeNone;alp.forIn(d,function(a,d){var f=c(b,a.from,a.delta,1);a.no_neg&&(f=Math.max(f,0));e.style?(e.style[d]=f+(a.unit||""),"opacity"===d&&alp.setOpacity(e,f)):e[d]&&(e[d]=
f)})}}),g=/width|height|opacity|padding/i,f=/width|height|top$|bottom$|left$|right$/i;k.animate=function(){var e=alp.filter(alp.Aps.apply(arguments),function(d){return"object"===typeof d&&d.node&&d.duration_sec&&d.from&&d.to});e.length!==arguments.length&&console.error("alp.x.animate(): some invalid arguments were dropped ",arguments," -> ",e);e=alp.map(e,function(d){var b={};b.node=d.node;b.duration_sec=d.duration_sec;b.easing=d.easing||k.Easing.easeNone;b.on_end=d.on_end;b.attr=void 0;var c=function(a){return"function"===
typeof a?a(d.node):a};alp.forIn(d.from,function(a,e){if(void 0!==d.to[e]){b.attr=b.attr||{};a=c(d.from[e]);var l=c(d.to[e]);b.attr[e]={from:a,delta:l-a,unit:d.unit&&d.unit[e]||(f.test(e)?"px":""),no_neg:g.test(e)}}});return b});h.start_anim(e)}})()})();"undefined"!==typeof dojo&&dojo.provide("alp.x.slideshow");
(function(){function k(b,c){var d=b.style,e;for(e in c)if(!(e in a)){var f=c[e];d[e]=f;"opacity"===e&&alp.setOpacity(b,f)}}function h(a){if("string"===typeof a){var b=alp.gEBI(a);a=alp.gEBCN(a);return(b?[b]:[]).concat(a)}return"parentNode"in a?[a]:a}function g(a){var b=alp.gEBTN("img",a)[0];if(b){var d=alp.nodify("oax-wrap-claim",a);return{imgurl:(b.src||alp.gA(b,"src")||(b.srcset||alp.gA(b,"srcset")).split(/\s/g)[0]).replace(/\/\d+\/\d+\/fit\//,"/").replace(c.url.img2_fit_rx,"/max/").replace(/\/\d+x\d+[^\/]?\/([^\/]*)$/,
"/$1"),legend:d&&alp.outerHTML(d),clickable:a}}}function f(a){for(var b=a[l]=alp.Aps.call(alp.children(a.extraslide)),c=1<a.slides.length?Math.min(a.slides.length,b.length):0;c<b.length;)alp.orphan(b.pop());alp.forEach(b,function(c,e){alp.setClass(c,"alp-x-clickable",!0);alp.aEL(c,"click",function(){var c=a._slide_index(a.currentSlide+d(e,b.length));a.interceptOpenCloseClick?(a.lightbox.setView(c),a.interceptOpenCloseClick("lightbox")):a.lightbox.open(c)})})}function e(a){function b(b,c){var e=a._slide_index(k+
d(c,h.length));c=f(e,b);var g=alp.nodify("oax-one-image-info",a.slides[e]);g=(m[e]=g&&alp.oFrom(g.value)).isVideo||!1;e=k===e;b=alp.cE("div",alp.setClass(b,[["oax-slish-extra-slide-current",e],["oax-slish-extra-slide-not-current",!e]]),{style:"width: "+b.clientWidth+"px; height: "+b.clientHeight+"px;"});g=alp.cE("span",b,{"class":"oax_video_play_small oax-icon-play"+(g?"":" oax_no_display")});c=new alp.x.Image({cont:b,zoomClick:!1,zoomWheel:!1,fitTooBig:!0,initUrl:c,waitboxBackground:{w:16,h:10},
initNow:!0});c._node=g;return c}function e(b,c){var e=a._slide_index(k+d(c,h.length));c=f(e,h[c]);if(!m[e]){var g=alp.nodify("oax-one-image-info",a.slides[e]);m[e]=g&&alp.oFrom(g.value)}alp.setClass(b._node,"oax_no_display",!m[e].isVideo);b.m.url.setNow(c)}function f(b,d){var e=alp.dataset(d),f=e[n];if(!f){f=d.offsetWidth;var l=d.offsetHeight,h=a.extraslide_default;!h||!h.force&&f&&l||(f=h.w,l=h.h,f&&l&&alp.style(d,{width:f+"px",height:l+"px"}));f=e[n]=f+","+l}d=f.split(",");f=parseFloat(d[0]);l=
parseFloat(d[1]);b=g(a.slides[b]).imgurl;(b||null).substring.call.a;return f&&l?b.replace(c.url.img2max_id_extract_rx,"/img2/$1/"+f+"x"+l+"f/"):b}var h=a[l],k=a.currentSlide,m=[];h&&(a[r]?alp.forEach(a[r],e):a[r]=alp.map(h,b))}function d(a,b){a.toPrecision.call.a;b.toPrecision.call.a;return a-(b-1>>1)}var b=alp.sub("alp.x",0,1),c=alp.cfg,a={};b.Transitions={none:{},staticTL:{from:{top:0,left:0},to:{top:0,left:0}},staticTR:{from:{top:0,right:0},to:{top:0,right:0}},staticBL:{from:{bottom:0,left:0},
to:{bottom:0,left:0}},staticBR:{from:{bottom:0,right:0},to:{bottom:0,right:0}},fadeIn:{from:{opacity:0},to:{opacity:1}},fadeOut:{from:{opacity:1},to:{opacity:0}},swipeInLTR:{from:{left:function(a){return parseInt(-a.parentNode.offsetWidth,10)}},to:{left:0}},swipeOutLTR:{from:{left:0},to:{left:function(a){return parseInt(a.parentNode.offsetWidth,10)}}},swipeInRTL:{from:{right:function(a){return parseInt(-a.parentNode.offsetWidth,10)}},to:{right:0}},swipeOutRTL:{from:{right:0},to:{right:function(a){return parseInt(a.parentNode.offsetWidth,
10)}}},swipeInTTB:{from:{top:function(a){return parseInt(-a.parentNode.offsetHeight,10)}},to:{top:0}},swipeOutTTB:{from:{top:0},to:{top:function(a){return parseInt(a.parentNode.offsetHeight,10)}}},swipeInBTT:{from:{bottom:function(a){return parseInt(-a.parentNode.offsetHeight,10)}},to:{bottom:0}},swipeOutBTT:{from:{bottom:0},to:{bottom:function(a){return parseInt(a.parentNode.offsetHeight,10)}}}};var m=alp.mapany();alp.declare("alp.x.SlideShow",null,function(a,b){var c=this,d=function(a){a&&new alp.x.SlideShow(a,
b)};if("string"===typeof a){if(!alp.gEBI(a)){var e=alp.subDfrd(function(){return alp.gEBI(a)},null,{maxdelay_ms:5E3});e.then(d);return e}this.id=a;this.container=alp.gEBI(this.id)}else if(a.id)this.id=a.id,this.container=alp.gEBI(this.id);else{if("number"===typeof a.length)return alp.forEach(a,d),!0;this.container=a}if(!alp.opt(b,"force")&&(d=m.get(this.container)))return console.warn("alp.x.slideshow found an already existing slideshow for this container."),d;m.setNow(this.container,this);this._eh=
new alp.Eh;(this.slides=alp.filter(this.container.childNodes,function(a){return!!a.style&&!alp.hasClass(a,c.ignore_slide)}))&&this.slides.length||console.error("alp.x.SlideShow.constructor(): did not find any slide!");alp.mix(this,b);this.withLightbox&&(this.lightbox=alp.x.genLightbox(this,{proj:this.lightbox_proj,domnode2info:this.lightbox_domnode2info,pauseDurationMs:this.interval,withGallery:!0,widthFactor:1.77,extrathumb:this.lightbox_extrathumb,extrathumb_default:this.lightbox_extrathumb_default,
interceptOpenCloseClick:this.interceptOpenCloseClick}),d=this.isLightboxOpenSt)&&(this._eh.push(this.lightbox.m.open.bind_to(d)),this._eh.push(d.bind_to(this.lightbox.m.open)));this.extraslide&&(this.withLightbox?f(this):console.error("extraslide requires withLightbox"));this._init()},{force:!1,withLightbox:!1,lightbox_proj:null,lightbox_domnode2info:g,lightbox_extrathumb:null,lightbox_extrathumb_default:{w:70,h:40},extraslide:null,extraslide_default:{w:70,h:40,force:!0},zIndex:{container:1,slides:2,
nextSlide:3,currentSlide:4},transIn:b.Transitions.fadeIn,transOut:b.Transitions.fadeOut,easingIn:b.Easing.easeOut,easingOut:b.Easing.easeOut,initTransTo:!0,currentSlide:0,interval:7E3,duration_sec:.5,autoplay:!0,debug:!1,loop:!1,previousButton:!1,nextButton:!1,playButton:!1,pauseButton:!1,slideSelector:!1,stopOnUser:!0,current_slide_number_display_q:void 0,max_slide_number_display_q:void 0,cont_slide_number_display_q:null,always_slide_number_display:!1,each_slide_number_display_q:"alp-x-slideshow-each-i",
each_slide_max_display_q:"alp-x-slideshow-each-n",each_slide_cont_display_q:"alp-x-slideshow-each-cont",each_slide_number_always:!1,ignore_slide:"alp-x-not-a-slide",mouseover_autoplay:!1,mouseover_container:null,isLightboxOpenSt:null,interceptOpenCloseClick:null,HTML_EXAMPLE:'<div id="controls"><span class="prev">&nbsp;</span><span class="play">&nbsp;</span><span class="pause hidden">&nbsp;</span><span class="next">&nbsp;</span></div><ul id="emotionals"><li class="slide"><img src="res/temp/img_claim_startseite.jpg" alt="#" /><div class="claim"><h2>Foobar</h2><p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p></div></li><li class="slide"><img src="res/temp/img_claim_startseite.jpg" alt="#" /><div class="claim"><h2>Foobar 2</h2><p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p></div></li><li class="slide show"><img src="res/temp/img_claim_startseite.jpg" alt="#" /><div class="claim"><h2>Hier werden Touren gemacht!</h2><p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p></div></li></ul>',
_slide_index:function(a){var b=this.slides.length;for(a=parseInt(a,10)||0;0>a;)a+=b;a%=b;if("number"===typeof a&&!isNaN(a))return a},slideChangeEvt:alp.memM("slideChangeEvt",'alp.event("slideChangeEvt",{then:1})'),slideChange:function(a){if(this.slides&&1<this.slides.length){var c=this.declaredClass+".slideChange()";if("string"===typeof a)"next"===a?this.slideChange(this.currentSlide+1):"previous"===a?this.slideChange(this.currentSlide-1):console.error(c+": invalid parameter ",a);else{this._setCurrentSlide(this._slide_index(this.currentSlide));
a=this._slide_index(a);var d=alp.mix({node:this.slides[this.currentSlide||0],duration_sec:this.duration_sec,easing:this.easingOut,on_end:alp.bindF(function(){d.node.style.zIndex=this.zIndex.slides},this)},this.transOut),f=alp.mix({node:this.slides[a],duration_sec:this.duration_sec,easing:this.easingIn,on_end:alp.bindF(function(){f.node.style.zIndex=this.zIndex.currentSlide},this)},this.transIn);f.node.style.zIndex=this.zIndex.nextSlide;b.animate(d,f);this._setCurrentSlide(a);this.extraslide&&e(this)}}},
startLoop:function(){var a=this;a.loop||!0!==a.autoplay||(!1===a.debug?a.loop=window.setInterval(function(){a.slideChange("next")},a.interval):!0===a.debug&&(a.loop=window.setTimeout(function(){a.slideChange("next")},a.interval)))},stopLoop:function(){this.loop&&window.clearInterval(this.loop);this.loop=void 0},disconnect:function(){this.stopLoop();alp.m(this._eh,"clear");alp.m(this.lightbox,"disconnect")},_init:function(){function a(){for(var b=0,c=!1,d=l.slides.length;d--;){var e=l.slides[d];(e=
alp.and(alp.gEBTN("img",e),".complete")&&alp.gBCR(e))&&e.height?b=Math.max(e.height,b):c=!0}(b=b&&b+"px")&&E.height!==b&&(E.height=b);c&&0<G--&&setTimeout(a,234)}function b(a,b){return"function"===typeof a?a(B):a}function c(a,b){a=alp.cE("a",I,{rel:""+b,"class":"slide_control"});alp.aEL(a,"click",alp.bindF("slideChange",L,b))}function d(){var a=l.currentSlide,b=alp.gEBTN("a",I);alp.forEach(b,function(b){var c=parseInt(alp.gA(b,"rel"));alp.setClass(b,"selected",a==c)})}function f(){alp.setText(h(l.current_slide_number_display_q),
""+(1+l._slide_index(l.currentSlide)))}function g(){alp.setText(h(l.max_slide_number_display_q),""+l.slides.length)}var l=this,m,n=l._slide_index(l.currentSlide);l._setCurrentSlide(n);var r=l.slides.length;alp.forEach(l.slides,function(a,b){a.style.position="absolute";a.style.zIndex=l.zIndex[b===n?"currentSlide":"slides"]});var C=l.each_slide_number_always||1<r;alp.forEach(l.slides,function(a,b){var c=alp.nodify(l.each_slide_cont_display_q,a);c&&(c.style.display=C?"":"none",C&&(a=alp.nodify(l.each_slide_number_display_q,
c),c=alp.nodify(l.each_slide_max_display_q,c),a&&alp.setText(a,b+1),c&&alp.setText(c,r)))});var E=l.container.style;E.position="relative";E.zIndex=l.zIndex.container;var G=100;a();l.slides&&l.slides.length&&(l.slides[l.currentSlide].zIndex=l.zIndex.currentSlide,l.slides[l._slide_index(l.currentSlide+1)].zIndex=l.zIndex.nextSlide);if(l.initTransTo)for(m=0;m<l.slides.length;m++){var B=l.slides[m];k(B,alp.mapIn(m===l.currentSlide?l.transIn.to:l.transOut.to,b))}(m=l.previousButton)&&(m=h(m)).length&&
(1<l.slides.length?(alp.style(m,"visibility","visible"),alp.aEL(m,"click",function(){l.stopOnUser&&l.stopLoop();l.slideChange("previous")})):alp.style(m,"visibility","hidden"));(m=l.nextButton)&&(m=h(m)).length&&(1<l.slides.length?(alp.style(m,"visibility","visible"),alp.aEL(m,"click",function(){l.stopOnUser&&l.stopLoop();l.slideChange("next")})):alp.style(m,"visibility","hidden"));(m=l.playButton)&&alp.aEL(h(m),"click",alp.bindF("startLoop",l));(m=l.pauseButton)&&alp.aEL(h(m),"click",alp.bindF("stopLoop",
l));var I=(m=l.slideSelector)&&("string"===typeof m?alp.gEBCN(m)[0]||alp.gEBI(m):m);if(I)if(alp.empty(I),1<l.slides.length){I.style.visibility="visible";var L=l;alp.forEach(l.slides,c);l.slideChangeEvt().then(d);d()}else I.style.visibility="hidden";var J=l.always_slide_number_display||1<l.slides.length;(m=l.cont_slide_number_display_q)&&(m=h(m)).length&&alp.style(m,"display",J?"block":"none");(m=l.current_slide_number_display_q)&&(m=h(m)).length&&(J?(alp.style(m,"visibility","visible"),l.slideChangeEvt().then(f),
f()):alp.style(m,"visibility","hidden"));(m=l.max_slide_number_display_q)&&(m=h(m)).length&&(J?(alp.style(m,"visibility","visible"),l.slideChangeEvt().then(g),g()):alp.style(m,"visibility","hidden"));alp.onDCL(alp.asyncF(10,function(){alp.likeIE8minus_backslash_v()&&l.slideChange(l._slide_index(l.currentSlide));if(l.mouseover_autoplay){var a=l.mouseover_container||l.container;alp.aEL(a,"mouseover",function(b){alp.stopEvent(b||window.event);(b.target||b.srcElement)!==a||l.loop||(l.slideChange("next"),
l.startLoop())},!0);alp.aEL(a,"mouseout",function(b){alp.stopEvent(b||window.event);if(l.loop&&(b||(b=window.event),(b.target||b.srcElement)===a)){var c=alp.gBCR(a),d=b.clientX;b=b.clientY;c.left<=d&&d<=c.right&&c.top<=b&&b<=c.bottom||l.stopLoop()}},!0)}else l.startLoop()}));this.extraslide&&e(this)},_setCurrentSlide:alp.nowF(function(a){this.currentSlide=a;this.slideChangeEvt().triggerSoon()})});var l="_extraslide_noli",r="_extraslide_imxarr",n="_extraslide_wh"})();"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.full");
alp.gmap3(function(){var k=alp._gmap2_3.api_source_names(),h=[alp.gmap3,alp._gmap2_3,alp._gmap2_3.qt7bit,alp.data,alp.cfg,alp.x,alp.content],g=alp.sub("alp.gmap3.api",null,!0);alp.forEach(k,function(f){alp.forEach(h,function(e){g[f]||"function"===typeof e[f]&&(g[f]=e[f])})})});"undefined"!==typeof dojo&&dojo.provide("oa._api_install");
(function(){function k(e,d,b){h(e,d,"a non-empty string, or an array of non-empty strings","string",(b instanceof Array?b[0]:b)||null)}function h(e,d,b,c,a){(c||null).substring.call.a;if(c!==typeof a)throw Error(e+": "+d+" must be "+b+".");}function g(e){var d=f(e);return function(b,c){alp.forIn(c,function(a,c){(a=d(c,a,b))&&(b[c]=a)})}}function f(e){return function(d,b,c){function a(){var a=alp.Aps.call(arguments),f=e.API_CFG,g=b[1],l={},h;for(h in g)if(!(h in l)){var m=g[h],n="number"===typeof m,
r=n?m:m[0];m=n?f[h]:m[1];(n=a[r])?h in n||(n[h]=m):(a[r]={})[h]=m}if(k&&this===c)throw Error(d+" requires `new`.");return q.apply(this,a)}var f=b[0],g=b[2],h=g&&g.oldName,k=g&&g.requiresNew;null==k&&(k=d[0]===d[0].toUpperCase());var q=f&&f[h||d];if(q){if(2>b.length)return q;a.prototype=q.prototype;return a}}}alp.sub("oa",0,1)._api_install=function(e,d){function b(a){var b=a&&x._dp,c;b&&!b.isDestroyed()&&b.dpNode===(c=a.dpNode||x.DetailPage.prototype.dpNode)&&b.id===a.id&&console.error("detailpage instance with same id ("+
a.id+") & dpNode ("+c+") already exists!");a=x._dp=new x.DetailPage(y.opt2cfg(a));a.initASAP();return a}function c(a){var b=a&&x._fvp,c;b&&!b.isDestroyed()&&b.topCont===(c=a.topCont||x.FlexViewPage.prototype.topCont)&&console.error("flexviewpage instance with same topCont ("+c+") already exists!");a=x._fvp=new x.FlexViewPage(y.opt2cfg(a));a.initASAP();return a}function a(a,b){b||(b=a);alp.m(C.requestCategoryTree(alp.mix({proj:x.API_CFG.proj},a)),["to","then"],alp.chainF(".category",b))}function f(a,
b){if("function"!==typeof b)throw Error("oa.api.requestIds( request, callback ): callback must be a function.");var c="string"===typeof a?alp.arr2oSimple([a],"{}"):a;c=r(c);alp.m(C.requestIds(c),["to","then"],alp.chainF(alp.bindF(n,null,a),b))}function l(a,b){b.call.a;var c=r(a);alp.m(C.requestLocation(c),["to","then"],alp.chainF(alp.bindF(n,null,a),b))}function r(a){if("proj"in a||"project"in a)throw Error('invalid request: "proj" and "project" forbidden at the top level.');return alp.oCreateMix(a,
{proj:x.API_CFG.proj})}function n(a,b){return alp.mix({},b,{request:a})}function q(a,b){f({searchNearby:a},function(a){var c=a.success,d=c?"OK":"ERROR:"+alp.oToString(a.error);b(d,c?a.data.ids:null)})}function p(a,b){h("oa.api.track","subaspect","a non-empty string","string",a||null);a=e+alp.sCapitalize(a);z.trackApi(alp.mix({proj:x.API_CFG.proj,aspect:a},b))}function v(a,b){h("oa.api.trackDetail","id","a non-empty string","string",a||null);z.trackDetail(alp.mix({proj:x.API_CFG.proj,id:a},b))}function u(a,
b){k("oa.api.trackGPX","id",a);z.trackGPX(alp.mix({proj:x.API_CFG.proj,id:a},b))}function t(a,b){k("oa.api.trackKML","id",a);z.trackKML(alp.mix({proj:x.API_CFG.proj,id:a},b))}function w(a,b){k("oa.api.trackTeaser","id",a);z.trackTeaser(alp.mix({proj:x.API_CFG.proj,id:a},b))}(e||0).substring.call.a;var x=alp.sub(e,0,1);x.PREFIX=e;alp.m(alp.view,"browser_version_alert");alp.m(x.hash,"init");alp.m(x.ga_track_anonymous,"init");/[\?&]_fire=lite(?:&|$)/.test(location.search)&&alp.place(alp.aC(alp.cE("script",
null,{type:"text/javascript",src:alp.cssBase()+"firebug_lite_1.4/build/firebug-lite.js"}),alp.cTxN(alp.oToString({startOpened:!0,enableTrace:!0}))),alp.head(),"first");var y=alp.sub(e+".api",0,1),z=alp.content,A=alp.data,C=A&&A.api;y.cfg=function(){var a=x.API_CFG;if(!a)throw Error(e+'.api could not find a proper script tag "'+e+'_head". You might have forgotten the script src parameters, e.g. ?proj=<your project key>');var b=alp.filter(alp.map("ADLH ASYNC CALLBACK EXCLUDE_CSS CACHEBUST CACHEBUST_CAMEL LEAFLET_GSHIM USE_GMAP GLOADNOW GMAPKEY GMAPCLIENTID".split(" "),
e+"[v]"),"v in this",a);b.length&&(a=alp.mix({},a),alp.forEach(b,"delete this[v]",a));return a};y.opt2cfg=function(a){return alp.oCreateMix(y.cfg(),a)};x.DetailPage&&(y.detailpage=b);x.FlexViewPage&&(y.flexviewpage=c);z&&(z.trackDetail&&(y.trackDetail=alp.asyncF(1234,v)),z.trackGPX&&(y.trackGPX=alp.asyncF(1234,u)),z.trackKML&&(y.trackKML=alp.asyncF(1234,t)),z.trackTeaser&&(y.trackTeaser=alp.asyncF(1234,w)),z.track&&(y.track=alp.asyncF(1234,p),y.track(x._ORIGIN_BUILD||"Full")));C&&(C.requestCategoryTree&&
(y.requestCategoryTree=a),C.requestIds&&(y.requestIds=f,y.searchNearby=q),C.requestLocation&&(y.requestLocation=l));if(A=alp.humane)y.humane=A;d&&(A=g(x),d(e,x,y,A));alp.onDCL(function(){var a=x.API_CFG.callback;(a=a&&alp.sub(a))&&a()})}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.mapconfig");
(function(){var k=alp.sub("alp.data.api",null,!0);if(!k.get_mapconfig_paid_dfrd){var h=alp.i.state,g=alp.cfg.url,f=k.INVALID_TOKEN,e=["to","then"];k.get_mapconfig_paid_dfrd=function(b){function c(b,c){var d=h.nowF(function(b,c){a.done(c)});(alp.oGet(b,"payFeatures.length")||alp.oGet(b,"proFeatures.length"))&&c&&c!==k.INVALID_TOKEN?alp.m(k.get_mapconfig_dfrd({token:c}),e,d):d(b)}if(!b&&d)return d;var a=alp.dfrd("mapCfg",{then:1});alp.onDCL(function(){var a=b&&b.login_indicator||alp.sub("oa.util.community.login_indicator"),
d=k.get_mapconfig_dfrd(alp.opt(b,["proj","key","cachebust"],!0)),g=alp.fVal(a)&&k.token();g||(g=alp.dfrd("ADAMC:token:not logged",{then:1}),alp.now("done",g,f));alp.m(d,e,function(a){alp.m(g,e,function(b){c(a,b)})})});b||(d=a);return a};k.get_mapconfig_dfrd=function(b){b=alp.oCreateMix({proj:alp.sub("oa.API_CFG.proj")||"",key:alp.sub("oa.API_CFG.key")||"",cachebust:alp.sub("oa.API_CACHEBUST")||+new Date,token:""},b);b=alp.tmpl(g.api_mapconfig(),b);var c=alp.dfrd("ADA_get_mapconfig",{then:1});alp.m(alp.jsonp(b,
{cache:!0}),["to","then"],alp.bindF("done",c));return c};var d}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.request_category_tree");(function(){var k=alp.sub("alp.data.api",null,!0),h=alp.data;k.requestCategoryTree=function(g){var f=g.proj;(f||null).substring.call.a;var e=g.type;return h.api_cat_mcp({project:f,extra:(e?"/"+e:"")+(g.pruned?"/pruned":"")})}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.filter");
(function(){var k=alp.sub("alp.data.api",null,!0),h=alp.data;k.filter=function(g){var f={proj:g.proj||null.proj_required,request:g.frontendtype||"tours"},e=alp.filterIn(g,"!(w in this)",{proj:1,project:1,frontendtype:1});e=alp.o2arr(e,'k+"="+alp.util.url_hash.encodeURIComponentExceptComma(o[k]||"")').join("&");var d=alp.dfrd("ADAPI:filter",{then:1});f.rest=e?"&"+e:"";alp.m(h.api_filter(f),["to","then"],function(b){b=b&&(b.allids||b.ids);var c=b instanceof Array,a={request:g,success:c};c?a.data={ids:b}:
a.error="Internal failure.";d.done(a)});return d}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.request_location");
(function(){var k=alp.sub("alp.data.api",null,!0),h=alp.data;k.requestLocation=function(g){var f=g.id,e=g.proj,d=alp.dfrd("ADAPI:requestLocation",{then:1});(f||null).substring.call.a;(e||null).substring.call.a;(new h.SingleOOI(f,{proj:e,minimal:!0})).load(function(b,c){b=c.lat;var a=c.lng;b=(c=!alp.and([b,a],"alp.isFiniteNumber(v)")&&'requestIds: could not resolve location of id "'+f+'"')?{success:!1,error:c}:{success:!0,data:{lat:b,lng:a}};b.request=g;c&&console.error(c,": ",g," => ",b);d.done(b)});
return d}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.request_ids");
(function(){function k(e){function d(){var b=r.id;(b||null).substring.call.a;alp.m(h.requestLocation({id:b,proj:a}),["to","then"],function(a){if(a.success){a=a.data;var b=alp.oCreate(e);delete (b[l]=alp.mix({},e[l],{location:a})).id;alp.m(k(b),["to","then"],alp.bindF("done",q))}else q.done(a)})}function b(a,c){for(var d in a)if(!(d in f)){var e=a[d];var g=(g=e)&&g.lat&&g.lng?"function"===typeof g.lat?g.lng()+","+g.lat():g.lng+","+g.lat:g;e===g&&"object"===typeof e?(g=c[d]={},b(e,g)):c[d]=g}}function c(a){var b=
a.status,c=a.result||a;a=!b||/^ok$/i.test(b);var d={request:e,success:a};c=a&&n.unpack(c);a&&!c?(console.error("request_ids: inconsistent success / data (most likely an internal error)"),setTimeout(function(){throw Error("request_ids: inconsistent success / data (most likely an internal error)");},0),d.success=!1,d.error="request_ids: inconsistent success / data (most likely an internal error) - be_status: "+b):a?("searchNearby"===l&&(c.location=p),d.data=c):d.error=b;q.done(d)}var a=e.proj;(a||null).substring.call.a;
var m=alp.oKeys(e);2===m.length||null.invalid;var l=alp.filter(m,'!=="proj"')[0];m=e[l];var r="string"===typeof m?{q:m}:m;"toptipps"===l?(r.frontendtype=l,l="filter"):"list"===l&&r.q&&!r.idlist&&(r={idlist:r.q});m={project:a,proj:a};b(r,m);var n={filter:{apicall:h.filter,unpack:alp.f("{ ids : (v = v  &&  v.data  &&  v.data.ids) && v instanceof Array && v }")},list:{apicall:g.api_oois,unpack:alp.f('{ ids : alp.map(v.list,".sortedIds").join(",").split(",") }')},search:{apicall:r.type?g.api_search_type:
g.api_search,unpack:alp.f('{ ids : v.data instanceof Array  &&  alp.map( v.data, ".id" ) }')},searchNearby:{apicall:g.api_nearby,unpack:alp.f('{ ids : v instanceof Array  &&  alp.map( v, ".id" ) }')}}[l],q=alp.dfrd("ADAPI.requestIds:"+l,{then:1});if(!n)throw Error('requestIds: type "'+l+'" unknown or not supported yet.');var p=r.location;"searchNearby"!==l||p?alp.m(n.apicall(m),["to","then"],c):d();return q}var h=alp.sub("alp.data.api",null,!0),g=alp.data,f={};h.requestIds=k})();
"undefined"!==typeof dojo&&dojo.provide("alp.dom.anchor");
(function(){function k(g){function f(e){for(var d=e.length;d--;){var b=e[d];if(/^a$/i.test(b.tagName)){var c={};alp.forEach(["class","dir"],function(a){alp.hA(b,a)&&(c[a]=b.getAttribute(a))});b.parentNode.insertBefore(alp.cE("span",null,c,{innerHTML:k(b.innerHTML)}),b.nextSibling);alp.orphan(b)}else b.childNodes&&f(b.childNodes)}}g.substring.call.a;g=alp.cE("div",null,null,{innerHTML:g});f(g.childNodes);return g.innerHTML}var h=alp.sub("alp.dom.anchor",null,!0);h.NO_WRAP_OOI_SNIPPET=function(){return"oax-no-wrap-ooi-snippet"};
h.remove=k;h.wrap_ooi_snippet=function(g,f){function e(d,f){null!=f||(f=d.className.match(b)[1]);(f||0).substring.call.a;var g=c&&alp.gEBCN(c,d);if(g&&g.length)return alp.arrChain(alp.map(g,function(a){return e(a,f)}));g=alp.gEBTN("a",d);g=a?alp.filter(g,'-1 < alp.lastIndexOf( alp.gA(v, "href")  ||  v.href  ||  "", "'+f.split(".")[0]+'")'):g;var l=alp.filter(g,'alp.sIsExternalURL(alp.gA(v,"href")||v.href)');if(0<l.length){g=l[0];l=alp.or(l,'v.target==="_blank"  ||  alp.gA(v,"target")==="_blank"');
var h=alp.filter(g.className.split(/\s+/),"v  &&  !/_/.test(v)  &&  /-/.test(v)").join(" "),m=alp.gA(g,"title")||g.title;d.innerHTML='<a href="'+(alp.gA(g,"href")||g.href)+'"'+(l?' target="_blank"':"")+(h?' class="'+h+'"':"")+(m?' title="'+m+'"':"")+">"+k(d.innerHTML)+"</a>"}return d}g=alp.nodify(g);if(!(alp.hasClass(g,"oax-no-wrap-ooi-snippet")||0<alp.gEBCN("oax-no-wrap-ooi-snippet",g).length)){f=alp.oCreateMix({findClass:"oax-id",findIdRx:/(?:^|\s)oax-id-(\S+)(?:\s|$)/,restrictClass:"oax-domaw-restrict",
filterHrefId:!0},f);var d=f.findClass,b=f.findIdRx,c=f.restrictClass,a=f.filterHrefId;f=(alp.hasClass(g,d)?[g]:[]).concat(alp.Aps.call(alp.gEBCN(d,g)));return g&&alp.map(f,function(a){return e(a)})}}})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.image_reveal");
(function(){alp.sub("alp.dom",null,!0).imageReveal=function(h,g){a:{h.childNodes.a;for(var f=k.length,e=f;e--;){var d=k[e];if(d.container===h){e<f-33&&k.splice(e+32,0,k.splice(e,1)[0]);h=d.img_info_arr;break a}}d=alp.gEBTN("img",h);var b=[];f=d.length;for(e=0;e<f;e++){var c=d[e],a=alp.gA(c,"src"),m=alp.gA(c,"data-reveal-img-src");a&&m&&b.push({node:c,src:a,data_reveal:m})}k.push({container:h,img_info_arr:b});h=b}f=h.length;for(e=0;e<f;e++)b=h[e],d=b.node,b=g?b.data_reveal:b.src,d.src!==b&&(alp.sA(d,
"src",b),d.src=b)};var k=[]})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.resize");
(function(){alp.aELresize||(alp.aELresize=function(k,h,g){function f(){for(var d=e.length;d--;)e[d].clear()}var e=alp.map("childNodes"in k||k===window?[k]:k,function(d){function b(){var a=c.clientWidth,b=c.clientHeight;if(e!==a||f!==b)e=a,f=b,d===window||g?h({node:d,refNode:c,width:a,height:b}):g=!0}var c=d!==window?d:window.document.documentElement,a=alp.hg?alp.hg():new alp.Eh;a.push(alp.aEL(window,"resize",b));d!==window&&a.push(setInterval(b,331),clearInterval);return a;var e,f,g});return f._alpRemover=
f})})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.mapconfig.mtids");(function(){var k=alp.sub("alp.maps.mapconfig",null,!0),h=k.SEP();k.mtids=function(g){return alp.arrChain(alp.map(g.maps||[],function(f){var e=f.name||f.id;return alp.map(f.styles||[],function(d){return e+h+(d.name||d.id)})}))}})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.mapconfig.selection");
(function(){function k(e,d){function b(a){if(a){var b=a.style,c=alp.filter(e.maps,"v.id===this.bm  ||  v.name==this.bm",{bm:a.basemap||null.bug});return 0<c.length&&(!b||alp.or(c,'alp.or(v.styles  ||  v.mapStyles || [], "v.name==this.st",this)',{st:b}))&&a}}function c(a,b){function c(b){b=b.name||null.bug;if(a.test(b))return{basemap:d,style:b}}var d=b.name||null.bug;return a.test(d)?{basemap:d}:alp.or(b.styles,c)}(d||null).substring.call.a;var a=g(d);if(a)return{basemap:a.basename,style:a.style};
var h=/hybrid|satellite/i,l=/topo/i;a=/winter/i;h=h.test(d)?h:l.test(d)?/^topo$/i:null;if(!h){var k=b({oa_map:{basemap:"oac",style:"summer"},oa_map_summer:{basemap:"oac",style:"summer"},oa_map_winter:{basemap:"oac",style:"winter"},oa_osm:{basemap:"osm",style:"summer"},oa_osm_winter:{basemap:"osm",style:"winter"},oa_topo:{basemap:"topo",style:"topo"},roadmap:{basemap:"google",style:"roadmap"},satellite:{basemap:"google",style:"satellite"},terrain:{basemap:"google",style:"terrain"}}[d]);!k&&a.test(d)&&
(h=a)}h&&(k=alp.mapfilter(e.maps,alp.bindF(c,null,h),"")[0]);k||(a=f(e)[0],console.error('mapconfig.selection: "'+d+'" not found. Trying to fall back onto mtid:"'+a+'"'),(a=g(a))&&(k={basemap:a.basename,style:a.style}));return k||null}var h=alp.sub("alp.maps.mapconfig",null,!0),g=h.MAYBE_VECTOR_MAPTYPEID_SPLIT,f=h.mtids;h.selection_of_maptypeid=function(e,d,b){e||null.bug;if(!d&&!b)return e;d=d&&k(e,d);if(b)a:{d&&e&&b||null.bug;var c=d.basename||null,a=c||d.basemap;b=alp.oKeys(alp.filterIn(b.init,
""));for(var f,l,h=[],n=b.length;n--;){var q=b[n];(q||null).substring.call.a;var p=g(q)||a&&{basename:a,style:q};if(p)if(c&&p.basename!==c)console.error("_AMMC_further_selection_of_mapoverlay: mismatch between selected `map` "+c+" and mapoverlay "+q),b.splice(n,1);else{c=p.basename;f||(f=alp.or(e.maps,"v  &&  v.name === this.bn  &&  v",{bn:c}));if(!f){console.error('Could not find map basemap name "'+c+'" in the mapconfig. Candidates are: '+alp.map(e.maps,'"\\""+v.name+"\\""').join(", ")+".");break a}f.name===
c||null.bug;p=p.style;var v=alp.or(f.overlays||[],"v  &&  v.name === this.ov_name  &&  v",{ov_name:p});v?v.isActivity?(l&&console.error("_AMMC_further_selection_of_mapoverlay: only one network permitted, "+l+" already set, ignoring "+q),l=p):h.push(p):console.error("_AMMC_further_selection_of_mapoverlay: could not find in basemap "+c+" overlay "+q)}else console.error('_AMMC_further_selection_of_mapoverlay: could not split string "'+q+'"'),b.splice(n,1)}e=alp.arr2oSimple(h);d.basemap?d.basemap===a||
null.bug:d.basemap=a;d.network=l||"";d.extraov=e||{}}return d};h.isPreselected_modified=function(e,d){function b(b){var d=b.id||b.name;(d||null).substring.call.a;d=d===h;a(b,d);d&&(k&&alp.forEach(b.mapStyles||b.styles||[],c,{name:k}),q||p)&&(d={},q&&(d[q]=!0),p&&(d[p]=!0),alp.forEach(b.overlays||[],c,{name_set:d}))}function c(b){var c=this.name,d=this.name_set,e=b.name;(e||null).substring.call.a;a(b,c?c===e:!!d[e])}function a(a,b){!!a.isPreselected!==!!b&&(b?a.isPreselected=!0:delete a.isPreselected,
f=!0)}e.maps||null.missing;var f=!1;if(d){var g=alp.oCopy(e);var h=d.basemap,k=d.style,q=d.network,p=d.extraov;(h||null).substring.call.a;alp.forEach(g.maps,b)}return f?g:e}})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.mapconfig.polished");
(function(){function k(a){a.raster&&!a.styles&&(a.styles=[{name:a.name,title:a.title,type:"raster",raster:a.raster}],delete a.raster)}function h(a){a.styles&&(a.styles=alp.filter(a.styles,".raster"));a.overlays&&(a.overlays=alp.filter(a.overlays,".raster"))}function g(a){a=alp.oCopy(a);alp.forEach(a.maps,function(a){var b=alp.oGet(a,"raster.minZoom")||-Infinity,c=alp.oGet(a,"raster.maxZoom")||Infinity;if(-Infinity<b||Infinity>c)d(a.overlays,b,c),d(a.styles,b,c)});return a}function f(a){a=alp.oCopy(a);
alp.forEach(a.maps,function(a){alp.forEach(a.styles,function(b){var c=b.raster;if(c){var d=c.rasterStack;if(d){var e=c.minZoom,f=c.maxZoom;e=alp.isFiniteNumber(e);f=alp.isFiniteNumber(f);e&&f||(e||(e=alp.reduce(d,"(w=w.minZoom) == null ? v : Math.min(v,w)",Infinity),alp.isFiniteNumber(e)?c.minZoom=e:(/[\?&]xxxminmaxzoom=1(?:&|$)/.test(location.search)&&(c.minZoom=0),console.error("polished.js: Could not determine raster.minZoom! map:"+a.name+" style:"+b.name,a,b,c))),f||(f=alp.reduce(d,"(w=w.maxZoom) == null ? v : Math.max(v,w)",
-Infinity),alp.isFiniteNumber(f)?c.maxZoom=f:(/[\?&]xxxminmaxzoom=1(?:&|$)/.test(location.search)&&(c.maxZoom=17),console.error("polished.js: Could not determine raster.maxZoom! map:"+a.name+" style:"+b.name,a,b,c))))}}})});return a}function e(a){function b(a){a&&"object"===typeof a&&(a.type===x&&(v in a||(a[v]=d),w in a||(a[w]=e),t in a||(a[t]=f)),a.overlays&&alp.forEach(a.overlays,"."+u+"=true"),a.styles&&alp.forEach(a.styles,"."+u+"=false"),alp.forIn(a,b))}function c(a){if(a&&"object"===typeof a){var b=
a.name,d=a.styles;b&&d&&alp.forEach(d,'v._oa_maptypeid = this.basemap + "'+r+'" + v.name',{basemap:b});alp.forIn(a,c)}}var d=a[n],e=a[p],f=a[q];if(!d)return a;if(!e)return console.error("iMLP: when setting `enableVector`, you must also give a `"+p+"`!"),a;if(!f)return console.error("iMLP: when setting `enableVector`, you must also give a `"+q+"`!"),a;a=alp.oCopy(a);b(a);c(a);return a}function d(a,b,c){var e=a&&a.raster;if(e&&"object"===typeof e&&!e.rasterStack){if(!isFinite(e.minZoom)||e.minZoom<
b)e.minZoom=b;if(!isFinite(e.maxZoom)||e.maxZoom>c)e.maxZoom=c}if(a&&"object"===typeof a)for(var f in a)f in A||d(a[f],b,c)}function b(a,b){function c(a,b){return e[b]||a}b=alp.mix({proj:alp.sub("oa.API_CFG.proj")},b);var d=b.proj;d&&(b.project=d);var e=alp.filterIn(alp.oCreateMix(a,b),'"string"===typeof v');alp.oDeepWalk(a,function(b,d,e,f){/^(?:tiles|tileUrlTemplates)$/.test(f[f.length-2])&&isFinite(d)&&"string"===typeof b&&(d=b.replace(/\{([^\}]+)\}/g,c),b!==d&&alp.oSet(a,f,d))})}function c(a){var b=
{};alp.forEach(a.maps,function(a){function c(c){var d=c&&c.title;d&&(b[d]||(b[d]=[])).push({map:a,style:c})}a&&alp.forEach(a.styles||[],c)});alp.forIn(b,function(a,b){function c(a){var c=a.map.name;/^oac$/i.test(c)||(a.style.title_unique=b+" ("+(5>c.length?c.toUpperCase():c)+")")}1<a.length&&alp.forEach(a,c)})}function a(a){var b={terrain:"Google Terrain",roadmap:"Google Roadmap",satellite:"Google Satellite"}[a]||a;return{name:a,raster:{maxZoom:17,minZoom:0,rasterStack:[{name:a,maxZoom:17,minZoom:0,
type:"raster",_oa_google_mtid:a}]},subtitle:b,title:b,type:"raster",_enableVector:!1,_isOverlay:!1,_oa_maptypeid:"google#"+a,_oa_google_mtid:a}}var m=alp.sub("alp.maps.mapconfig",null,!0),l=alp.maps.has_gmap,r=m.SEP(),n=m.ENABLE_VECTOR(),q=m.MAPBOX_ACCESS_TOKEN(),p=m.STYLE_FILE(),v=m._ENABLE_VECTOR(),u=m._IS_OVERLAY(),t=m._MAPBOX_ACCESS_TOKEN(),w=m._STYLE_FILE(),x=m.VECTOR(),y=m.selection_of_maptypeid,z=m.isPreselected_modified,A={};m.get_polished_mapconfig=function(a,d){d||(d=alp.sub("oa.API_CFG.proj"));
1>a.maps.length&&console.error("mapconfig.polished: mapconfig.maps.length < 1 ; the rest might be difficult.");a=alp.oCopy(a);alp.forEach(a.maps,k);a=alp.oCopy(a);alp.forEach(a.maps,h);alp.forEach(a.maps,"v.id  ||  (v.id = v.name)");a.maps=alp.filter(a.maps,"v.styles  &&  v.styles.length");a=g(a);a=f(a);a=e(a);b(a,{proj:d});c(a);return a};m.is_style_vector_ready=function(a){return a&&t in a&&w in a};m.optional_init_from_mapboss=function(b,c){var d=alp.filter(b&&b.maptypeids||[],"v in this",{terrain:1,
roadmap:1,satellite:1});0<d.length&&l()&&(c=alp.oCopy(c),c.maps.push({id:"google",name:"google",sources:["google"],styles:alp.map(d,a),subtitle:"",title:"Google Maps",type:"raster",_enableVector:!1}));d=alp.m(b&&alp.oGet(b,"m.maptypeid"),"get");b=b&&b.mapoverlay;if(!d&&!b)return c;(b=y(c,d,b))&&(c=z(c,b));return c}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.layer.tracks_layer");
alp.gmap3(function(k){function h(a,b){var c=b?alp.oCopy(b):{};c.tracks&&c.tracks_arr&&c.trackparts&&c.trackparts_arr||(c.tracks?c.tracks_arr||(c.tracks_arr=alp.o2arr(c.tracks||(c.tracks={}))):c.tracks=alp.arr2o(c.tracks_arr||(c.tracks_arr=[])),c.trackparts?c.trackparts_arr||(c.trackparts_arr=alp.o2arr(c.trackparts||(c.trackparts={}))):c.trackparts=alp.arr2o(c.trackparts_arr||(c.trackparts_arr=[])));alp.forEach(c.tracks_arr,function(a){a.main||(a.main=[]);a.variants||(a.variants=[]);alp.forEach(a.main.concat(a.variants),
function(b){b=c.trackparts[b];(b.tracks_arr||(b.tracks_arr=[])).push(a)})});alp.forEach(c.trackparts_arr,function(b){!b.type_track&&b.tracks_arr&&1===b.tracks_arr.length&&(b.type_track=b.tracks_arr[0]);if(null==b.type&&b.tracks_arr){if(!b.type&&a.trackpart_type_extract){var c=a.trackpart_type_extract(b);c&&(b.type=c)}var d=alp.map(b.tracks_arr,alp.f(".type")),e=0;c=d[e];var f=a.trackpart_type_resolve;if(f)for(var g=f[c],l=1,h=d.length;l<h;l++){var k=d[l],m=f[k];m<g&&(e=l,c=k,g=m)}b.type||(b.type=
c);b.type_track=b.tracks_arr[e]}});return c}function g(b){function c(a){var c=b[a+"Color"],d=b[a+"Opacity"],e=b[a+"Weight"];c=m&&b.highlightStrokeColor||c;var f=h.type,g=typeof c;d={strokeColor:"string"===g?c:"function"===g?c(f):c[f],strokeOpacity:m&&b.highlightStrokeOpacity||d,strokeWeight:m&&b.highlightStrokeWeightDelta&&b.highlightStrokeWeightDelta(e)||e};/^outline/.test(a)&&(d.no3d=!0);a=[h.id,a,"high:"+m,alp.oToString(d)].join("#");a=alp.oCreateMix(d,{id:a,encPolyline:h.encPolyline,coordinates:h.coordinates,
trackpartId:h.id,type_track:h.type_track,type_trackId:alp.sub("type_track.id",h),type_trackName:alp.sub("type_track.name",h),type_trackIcon:alp.sub("type_track.icon",h),is_high:m});return b.postprocess_ovdata?b.postprocess_ovdata(a,h):a}var d=b.m.highlightSt.get(),e=b.m.defSt.get(),f=e.tracks;d=d&&f[d];e=e.trackparts;var g=b.m.restrictIdsSt.get()&&alp.arr2oSimple(b.m.restrictIdsSt.get());f=[];for(var l in e)if(!(l in a)){var h=e[l],k=h.tracks_arr;if(k&&(!g||alp.or(k,function(a){return a.id&&a.id in
g}))){var m=~~(d&&-1<alp.lastIndexOf(k,d));b.outline&&f.push(c("outlineStroke"));f.push(c("stroke"))}}b.m.ovDataSt.set(f);b.kx.overlays.update()}function f(a){a.m.mapSt.get()}function e(a){}function d(a){function d(b){l.clickEvt().triggerSoon(b,a.type_track)}var e=a.type_trackId,f=a.trackpartId,g=this[m]||(this[m]={}),l=this,h=c.util.coord.tour(a),k=alp.opt(a,["strokeColor","strokeWeight","strokeOpacity"]),w=alp.fVal(l.placemark_class,a)+(a.is_high?" "+l.placemark_class_highlight:"");if(f in g)return f=
g[f],f.setOptions(k),f;if(h)return k=c.polylineGen(alp.oCreateMix(k,{path:c.xy2latlng(h),alp:alp.oCreateMix(alp.opt(l,["pylon3d","alt3d"]),{placemark:l.placemark&&{name:a.type_trackName,"class":w,icon:a.type_trackIcon}})})),a.no3d&&(k._alp_no3d=!0),e&&(c.event("addListener")(k,"click",alp.nowF(d)),h=alp.ratelimitF(789,b,l),e=alp.bindF(h,null,e),h=alp.bindF(h,null,null),l.highlightOnClick&&c.event("addListener")(k,"click",e),l.highlightOnMouseover&&(c.event("addListener")(k,"mouseover",e),c.event("addListener")(k,
"mouseout",h))),g[f]=k;console.error("_TracksLayer_ovgen: could not create polyline for ovdata:",a)}function b(a){this.m.highlightSt.setNow(a)}var c=alp._gmap2_3,a={};alp.declare("alp._gmap2_3.TracksLayer",alp.x.AbstractController,null,{mapSt:null,highlightSt:null,restrictIdsSt:null,highlightOnClick:!0,highlightOnMouseover:!0,trackpart_type_extract:null,trackpart_type_resolve:null,strokeColor:"#ff0000",strokeOpacity:1,strokeWeight:5,highlightStrokeColor:null,highlightStrokeOpacity:null,highlightStrokeWeightDelta:alp.f("*2"),
outline:!1,outlineStrokeColor:"#ffffff",outlineStrokeOpacity:1,outlineStrokeWeight:6.5,flight3d:!1,flight3d_rangeMeters:2456,flight3d_wait_after_first_sec:null,alt3d:0,pylon3d:!1,placemark:!0,postprocess_ovdata:null,placemark_class:"",placemark_class_highlight:"alp-highlight",initNow:!0,augmentModel:function(a){a.mapSt=this.mapSt||new alp.State;a.highlightSt=this.highlightSt||new alp.State;a.defSt=new alp.State({constrain_all:alp.bindF(h,null,this)});a.ovDataSt=new alp.State;a.restrictIdsSt=this.restrictIdsSt||
new alp.State},augmentKids:function(a){a.overlays=new c.view.Overlays({map:this.m.mapSt,data:this.m.ovDataSt,ovgen:alp.bindF(d,this)})},connectModel2Model:function(a,b,c,d){b.push(c.defSt.change_cb_init(g,null,a));b.push(c.restrictIdsSt.change_cb_init(g,null,a))},connectModel2View:function(a,b,c,d){b.push(c.mapSt.change_cb_init(f,null,a));b.push(c.defSt.change_cb_init(e,null,a));b.push(c.highlightSt.change_cb_init(g,null,a))},getDef:function(){return this.m.defSt.get()},setDef:function(a){this.m.defSt.setNow(a)},
getMap:function(){return this.m.mapSt.get()},setMap:function(a){this.m.mapSt.setNow(a)},getMiddleLatLng:function(a){var b=this.m.ovDataSt.get()||[];if(a=(a=(a=alp.filter(b,alp.f('.type_trackId==="'+a+'"'))[0])&&c.util.coord.tour(a))&&c.util.coord.middleNodeXYi(a))return new c.xy2latlng(a[0])},clickEvt:alp.memM("clickEvt",'alp.event("TracksLayer:click",{then:1})'),clickCB:alp.eventCB("clickEvt"),clickDropCB:alp.eventDropCB("clickEvt")});var m="_ctaf"});"undefined"!==typeof dojo&&dojo.provide("alp.ski.skiresort_layer");
(function(){function k(a){function b(b){a.m.cfgSt.set(b)}var c=a.m.whatSt.get(),d="string"===typeof c?alp.gEBI(c)||alp.gEBCN(c)[0]:c;c="parentNode"in d?c.value:c;a._obj=d;a._o2=c;c.id&&c.id_proj?(d=c.proj,(d||null).substring.call.a,(new alp.data.SingleOOI(c.id,{proj:d})).load(b)):a.m.cfgSt.set(c)}function h(a){var b=a.m.cfgSt.get();b=b&&b.data.skiresort;a.m.tracksDefSt.set({tracks_arr:b&&b.tracks||[],trackparts_arr:b&&b.trackparts||[]})}function g(a){var b=a.m.cfgSt.get(),c=(b=b&&b.data.skiresort)&&
b.lifts||[];b=alp.map(c,function(b){return alp.oCreateMix(b,{main:["poly_"+b.id],variants:[],type:"lift",icon:b.opened?a.lift_icon_opened:a.lift_icon_closed})});c=alp.map(c,function(b){return m.ensure_enough_nodes({id:"poly_"+b.id,encPolyline:b.encPolyline,type:"lift"},a.lifts_min_n_nodes)});a.m.liftsDefSt.set({tracks_arr:b,trackparts_arr:c})}function f(a,b){a=a.get();a=alp.map(alp.opt(a,"tracks_arr")||[],alp.f(".id"));b.set(a)}function e(a,b,c){a.kx.tracks_layer.m.defSt.set(alp.opt(b,["tracks_arr",
"trackparts_arr"]))}function d(a,b,c){a.kx.lifts_layer.m.defSt.set(alp.opt(b,["tracks_arr","trackparts_arr"]))}function b(b,c){var d=this.m.mapSt.get();c=d&&alp.tmplJs(this.track_iw_tmpl,c);a.iwOpen(d,b.latLng,c)}function c(b,c){var d=this.m.mapSt.get();c=d&&alp.tmplJs(this.lift_iw_tmpl,c);a.iwOpen(d,b.latLng,c)}var a=alp._gmap2_3,m=a.util.coord;alp.declare("alp.ski.SkiresortLayer",alp.x.AbstractController,null,{id:null,proj:null,what:null,lifts_min_n_nodes:4,lift_icon_opened:alp.cssBase()+"alp/images/check-on-16.png",
lift_icon_closed:alp.cssBase()+"alp/images/check-off-16.png",lift_iw_tmpl:"<div class=\"alp-skilift-iw\"><p><img src=\"__data.icon__\"> __data.name || ''__ __data.title || ''__</p><p>__data.elevBegin && data.elevEnd  ?  data.elevBegin + '&nbsp;m - ' + data.elevEnd + '&nbsp;m' : ''__</p><p>&nbsp;</p></div>",track_iw_tmpl:"<div class=\"alp-skitrack-iw\"><p>__data.name || ''__ __data.title || ''__</p><p><p>&nbsp;</p></div>",initNow:!0,augmentModel:function(a){a.mapSt=new alp.State;a.whatSt=new alp.State({init_value:this.id?
{id:this.id,proj:this.proj,id_proj:!0}:this.what});a.cfgSt=new alp.ObjectState;a.tracksDefSt=new alp.State;a.liftsDefSt=new alp.State;a.highlightSt=new alp.State;a.restrictLiftIdsSt=new alp.State;a.restrictTrackIdsSt=new alp.State;a.lift_idlist_st=new alp.State;a.track_idlist_st=new alp.State},augmentKids:function(b){var c={yellow:"skiroute",blue:"easy",red:"medium",black:"hard"};b.tracks_layer=new a.TracksLayer({strokeColor:{easy:"#0000ff",medium:"#ff0000",hard:"#000000",skiroute:"#00cccc"},trackpart_type_extract:function(a){return(a=
a.color)&&c[a]},trackpart_type_resolve:{easy:0,medium:1,hard:2,skiroute:3},mapSt:this.m.mapSt,highlightSt:this.m.highlightSt,placemark:!1,restrictIdsSt:this.m.restrictTrackIdsSt});b.lifts_layer=new a.TracksLayer({strokeColor:"#554433",mapSt:this.m.mapSt,highlightSt:this.m.highlightSt,flight3d:!0,flight3d_wait_after_first_sec:4,pylon3d:!0,alt3d:33,postprocess_ovdata:function(a,b){a.opened=!!alp.sub("type_track.opened",b);return a},placemark_class:function(a){return"alp-skiresort-lift-name "+(a.opened?
"alp-opened":"alp-closed")},restrictIdsSt:this.m.restrictLiftIdsSt})},connectModel2Model:function(a,b,c,d){b.push(c.whatSt.change_cb_init(k,null,a));b.push(c.cfgSt.change_cb_init(h,null,a));b.push(c.cfgSt.change_cb_init(g,null,a));b.push(c.tracksDefSt.change_cb_init(f,null,c.tracksDefSt,c.track_idlist_st));b.push(c.liftsDefSt.change_cb_init(f,null,c.liftsDefSt,c.lift_idlist_st))},connectModel2View:function(a,b,c,f){b.push(c.tracksDefSt.change_cb_init(e,null,a));b.push(c.liftsDefSt.change_cb_init(d,
null,a))},connectView2Model:function(a,d,e,f){d.push(f.tracks_layer.clickCB(b,a),alp.bindF("clickDropCB",f.tracks_layer));d.push(f.lifts_layer.clickCB(c,a),alp.bindF("clickDropCB",f.lifts_layer))},getMap:function(){return this.m.mapSt.get()},setMap:function(a){this.m.mapSt.setNow(a)},iwOpen:function(a,d){d||(d=-1<alp.lastIndexOf(this.m.lift_idlist_st.get()||[],a)?"lift":"track");var e=this.m[d+"sDefSt"].get().tracks_arr;e=alp.filter(e,alp.f('.id=="'+a+'"'))[0];a=this.kx[d+"s_layer"].getMiddleLatLng(a);
e&&a&&("track"===d?b:c).call(this,{latLng:a},e)}})})();"undefined"!==typeof dojo&&dojo.provide("alp.util.browser_cookie_message");
(function(){alp.sub("alp.util",null,!0).bCookieMessage=function(g){function f(){var f=alp.nodify(b)||e.fallback&&alp.aC(alp.cE("div",null,{"class":b,style:"position: fixed; width : 100%; height: auto; z-index: 9999; padding: 3px;background-color: rgba(255,255,255,0.85)"},{innerHTML:"Diese Website verwendet cookies. "}),alp.cE("a",null,{"class":c,href:"http://www.outdooractive.com/de/datenschutz.html",target:"_blank"},{innerHTML:"Mehr dazu"}),alp.cE("button",null,{"class":a,style:"max-width : 4em; text-align: center"},
{innerHTML:"Ok"}));if(f){var g=alp.cE("div",null,{"class":b},{innerHTML:f.innerHTML});alp.installNode(0,0,g);g.style[d?"top":"bottom"]=0;alp.aEL(alp.gEBCN(a,g),"click",function(){alp.cookie(k,"true",{expires:90,path:"/"});alp.orphan(g)});alp.onDCL(function(){alp.aC(alp.body(),g)})}}if(alp.cookie.isSupported()&&!h&&!alp.cookie(k)){h=!0;var e=alp.oCreateMix({top:!1,cname:"oax-cookie-cont",more:"oax-cookie-more",ok:"oax-cookie-ok",fallback:!1},g),d=e.top,b=e.cname,c=e.more,a=e.ok;alp.onDCL(f)}};var k=
"_bCookieMsgShown",h})();"undefined"!==typeof dojo&&dojo.provide("alp.view.browser_version_alert");alp.i18n.fetch("alp.all");
(function(){function k(b){function a(a){return c[a](l)}if(!alp.likeMobile()&&(b&&b.force||!(alp.cookie(k.cookie_name)||/true/i.test(""+alp.sub("alpConfig.disableBrowserCheck"))||k.already_called))){k.already_called=1;var c=alp.mixCheck({prevent_bot:alp.f(".match( /bot\b/i )"),prevent_preview:alp.f(".match( /preview\b/i )"),test_ie:alp.f("alp.likeIE8minus_backslash_v() || (alp.likeIE() && /\\bMSIE 9\\./.test(navigator.userAgent))"),test_ff:h,test_sa:g,test_ch:f,expires:.8,path:"/",img_warning:alp.cssBase()+
"alp/images/warning.png",img_firefox:alp.cssBase()+"alp/images/browser_mozilla_small.png",img_chrome:alp.cssBase()+"alp/images/browser_chrome_small.png",img_safari:alp.cssBase()+"alp/images/browser_safari_small.png",img_ie:alp.cssBase()+"alp/images/browser_internet_small.png",basic_overlay_class:"alp-bva-basic-overlay",basic_overlay_opacity:.6,basic_alert_class:"alp-bva-basic",basic_alert_opacity:1,force:!1},b||{}),l=navigator.userAgent;(c.force||!alp.or(alp.filter(alp.oKeys(c),".match(/^prevent_/)"),
a)&&alp.or(alp.filter(alp.oKeys(c),".match(/^test_/)"),a))&&d.then(alp.bindF(e,null,c));c.force||(b=alp.filterIn(alp.opt(c,["expires","path"]),function(a,b){return null!=a}),alp.cookie(k.cookie_name,"shown",b))}}function h(b){return(b=/\bFirefox\s*\/\s*(\d+)/.exec(b))&&22>~~b[1]}function g(b){return(b=/\bSafari\b/.test(b)&&/\bVersion\s*\/\s*(\d+)/.exec(b))&&4>~~b[1]}function f(b){return(b=/\bChrome\s*\/\s*(\d+)/.exec(b))&&26>~~b[1]}function e(c,a){var d=alp.tmpl('<div class="alp-bva-wrapper"><span class="alp-bva-close" onclick="alp.view.browser_version_alert.close()">x</span><div class="alp-bva-title">${browser_version_alert_title}</div><p class="alp-bva-problem">${browser_version_alert_problem}</p><strong class="alp-bva-advice">${browser_version_alert_advice}</strong><div class="alp-bva-browser-list"><span class="alp-bva-browser"><a target="_blank" href="http://www.mozilla.org/firefox"><img src="${img_firefox}" alt="${browser_version_alert_browser_ff}" title="${browser_version_alert_browser_ff}" /></a><a target="_blank" href="http://www.mozilla.org/firefox">${browser_version_alert_browser_ff}</a></span><span class="alp-bva-browser"><a target="_blank" href="http://www.apple.com/safari/"><img src="${img_safari}" alt="${browser_version_alert_browser_sa}" title="${browser_version_alert_browser_sa}" /></a><a target="_blank" href="http://www.apple.com/safari/">${browser_version_alert_browser_sa}</a></span><div style="clear: both;"></div><span class="alp-bva-browser"><a target="_blank" href="http://www.google.com/chrome"><img src="${img_chrome}" alt="${browser_version_alert_browser_ch}" title="${browser_version_alert_browser_ch}" /></a><a target="_blank" href="http://www.google.com/chrome">${browser_version_alert_browser_ch}</a></span><span class="alp-bva-browser"><a target="_blank" href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home"><img src="${img_ie}" alt="${browser_version_alert_browser_ie}" title="${browser_version_alert_browser_ie}" /></a><a target="_blank" href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home">${browser_version_alert_browser_ie}</a></span><div style="clear: both;"></div></div>',
alp.oCreateMix(a,c));alp.onDCL(function(){b.push(alp.setOpacity(alp.place(alp.cE("div",null,{"class":c.basic_overlay_class}),alp.body(),"first"),c.basic_overlay_opacity),alp.setOpacity(alp.place(alp.cE("div",null,{"class":c.basic_alert_class},{innerHTML:d}),alp.body(),"first"),c.basic_alert_opacity))})}var d=alp.i18n.fetch("alp.all");alp.ensureCss(alp.cssBase()+"alp/x.css");alp.view.browser_version_alert=k;k.close=function(){alp.orphan(b);b=[]};k.cookie_name="browser_version_alert";var b=[]})();
"undefined"!==typeof dojo&&dojo.provide("oa._const_install");
(function(){var k=alp.sub("oa",0,1);k._const_install=function(h){var g=alp.sub(h,0,1),f=location.host,e=location.hostname;g.API_HEAD_SCRIPT_SRC_RX=new RegExp("^([\\s\\S]*\\/)?"+h+"_head\\.jsp?\\?([\\s\\S]+)$");(function(){var b=g._ORIGIN_URL&&g._ORIGIN_URL.match(g.API_HEAD_SCRIPT_SRC_RX),a=alp.filter(alp.map(alp.gEBTN("script"),function(a){return(a=alp.gA(a,"src"))&&a.match(g.API_HEAD_SCRIPT_SRC_RX)}),alp.f())[0];if(b=/(?:\?|&)oaserver=[^&]+/.test(location.search)?b||a:a||b){g.API_SERVER=b[1];g.API_HOST=
/^(?:https?:)?\/\//.test(g.API_SERVER)?g.API_SERVER.match(/^((?:https?:)?\/\/[^\/\?#]*)/)[0]+"/":/^\d+\.\d+\.\d+\.\d+|localhost:4443$/.test(e)?(console.error("out.API_HOST: fallback on OA (dev) #10237"),"http://"+(alp.dev()?alp.dev.isTesting()?" testing":alp.dev.isApproval()?"approval":"www":"www")+".outdooractive.com/"):location.protocol+"//"+f+"/";g.API_SAMEHOST="//"+f===g.API_HOST.replace(/^https?:|\/$/g,"");g.API_DEVHOST=/^(localhost|127\.0\.0\.1|192\.168\.80\.\d+):?/.test(g.API_HOST);a=g.API_SAMEHOST&&
k.API_HOST;var d=/^(https?:)?\/\/[^\/]+\//,l=a&&a.match(d),r=alp.cssBase();g.API_CSS_BASE=a?r.replace(d,l[0]):r;b=b[2];a=alp.filter(alp.map(b.split("&"),alp.f(".match(/^(.+)=(.+)$/)")),'v  &&  v[1]!=="lang"');a=g.API_CFG=alp.arr2o(a,1,2);"oax"!==h||a.leaflet_gshim||a.use_gmap||(a.leaflet_gshim="1");g.API_PROJ_KEY=alp.tmpl("&proj=${proj}&key=${key}",alp.oCreateMix({key:""},a));a=alp.sub("alpConfig.cachebust");a||(a=(b=b.match(/(?:^|&|\?)(cachebust=([^&]+)|(\d+))/)||[],b[2]||b[3])||alp.date2str(null,
"{YYYY}.{MM}.{DD}.{hh}"));a&&(g.API_CACHEBUST=alp.sub("alpConfig",null,!0).cachebust=a)}else g.API_CFG=g.API_SERVER=null,console.warn("OAX API CFG / SERVER not found.")})();var d="localhost"===f||"localhost:4443"===f||!/[a-zA-Z]/.test(e);g.SERVER=function(b){/\/$/.test(b)||(b+="/");/\/alpportal\/$/.test(b)||/\/(?:mobile|regio)\/$/.test(b)||(b+="alpportal/");return b}(alp.dev()?"//"+(d&&alp.dev.isApproval()?"approval.outdooractive.com":d&&alp.dev.isTesting()?"testing.outdooractive.com":f)+"/alpportal/":
g.API_SERVER||"//"+f+"/alpportal/");d=g.MARKUP_SERVER=g.SERVER;var b=/^\/(?:$|[^\/])/.test(g.API_SERVER)&&"oam"===h?"/mobile/":g.API_SERVER;g._WITH_MCP=function(b,a){return b&&0<a.length};g._WITH_MLP=function(b){return b&&0<b.length};g.XXX_WHERE_ALPSTEIN=0;g.ACTION_OPEN_IN_PAGE="in-page";g.ACTION_OPEN_IN_PAGE_IW="in-page-iw";g.ACTION_OPEN_PAGE_LOAD="page-load";g.ACTION_OPEN_PAGE_LOAD_PORTAL="page-load-portal";g.ACTION_OPEN_NONE="none";g.ACTIVE="oax_active";g.ADD_BASKET_CONT="oax-myBasket-container";
g.ADD_TO_LIST="oax-add-to-list";g.ADLH="alwaysDefaultLastHash";g.ASYNC="async";g.BACK2FLEXVIEW_CONT="oax-backcont-flexview";g.BACK2FLEXVIEW_LINK="oax-backlink-flexview";g.BACK2DETAILPAGE_CONT="oax-backcont-detailpage";g.BACK2DETAILPAGE_LINK="oax-backlink-detailpage";g.BACK2DETAILPAGE_TITLE="oax-backtitle-detailpage";g.BACK2OVERVIEW_LINK_ALL=[g.BACK2FLEXVIEW_LINK,"oax-back-to-overview",g.BACK2FLEXVIEW_CONT];g.BACK_NATIVE="oax-back-native";g.BASKET_ADD="oax-basket-action-add";g.BASKET_ADD_DIALOG_MARKUP_JSONP_URL_TMPL=
b+alp.i18n.language()+"/bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&page=/plugin/${plugintype}/inc/list.dialog.jsp"+g.API_PROJ_KEY;g.BASKET_ADD_ID="oax-basket-add-id";g.BASKET_REMOVE="oax-basket-action-remove";g.BASKETID_DEFAULT="default";g.CACHEBUST="cachebust";g.CACHEBUST_CAMEL="cacheBust";g.CALLBACK="callback";g.CAT_SETTINGS="oax-cat-settings";g.COMMENT_SCROLLTO_SESTOR="comment_scrollto";g.ID_NONE="<none>";g.LIST="list";g.COMMUNITY_LOGIN_DIALOG_MARKUP_JSONP_URL_TMPL=b+alp.i18n.language()+"/bodyPartJsonp?cachebust="+
g.API_CACHEBUST+"&page=/plugin/${plugintype}/community/common/login.modalwin.jsp"+g.API_PROJ_KEY;g.CONT_EACH_WRAP_ANCHOR="oax-cont-each-wrap-anchor";g.DELETE_LIST="oax-delete-basket";g.DETAILPANE_DATA="oax-detailpane-data";g.DETAIL_SELECT_STAGE="oax-select-stage";g.DETAILMAP_OOI_CLICK_ACTION_OPEN_TYPE={"*":g.ACTION_OPEN_PAGE_LOAD,listMap:g.ACTION_OPEN_IN_PAGE_IW,map:g.ACTION_OPEN_IN_PAGE_IW};g.EXCLUDE_CSS="excludeCss";g.FLEXVIEW_MARKUP_JSONP_URL_TMPL=d+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&plugintype=${plugintype}&frontendtype=${frontendtype}&viewtype=flexview&whattype=${whatType}&wheretype=${whereType}&lang="+
alp.i18n.language()+g.API_PROJ_KEY;g.DETAILPAGE_MARKUP_JSONP_URL_TMPL=d+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&plugintype=${plugintype}&frontendtype=${frontendtype}&viewtype=detail&i=${id}&lang="+alp.i18n.language()+g.API_PROJ_KEY;g.DISABLED="oax_disabled";g.LAZY_LOAD_JSONP_URL_TMPL=b+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&page=${file}&lang="+alp.i18n.language()+g.API_PROJ_KEY;g.ELPRO_MARKUP_JSONP_URL=d+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+"&page=/plugin/desktop/tour/inc/elpro.jsp"+
(g.API_PROJ_KEY||"");g.ERROR="oax_error";g.MODALWIN_SNIPPETS_MARKUP_JSONP_URL=b+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+"&page=/plugin/mobile/inc/${filename}.jsp%3Fi=${id}"+(g.API_PROJ_KEY||"");g.SHARE_MARKUP_JSONP_URL=b+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+"&page=/plugin/${plugintype}/inc/share.dialog.jsp%3Fi=${id}"+(g.API_PROJ_KEY||"");g.SHARE_AFTER_PUBLISH_MARKUP_JSONP_URL=b+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+
"&page=/plugin/${plugintype}/inc/shareAfterPublish.dialog.jsp%3Fi=${id}"+(g.API_PROJ_KEY||"");g.BACK2DETAILPAGE_SESTOR="oax-back-detailpage";g.FAV_BTN="oax-fav-btn";g.FAV_CNT="oax-fav-count";g.FAV_IS="oax-faved";g.FAV_NOT="oax-not-faved";g.FLEXVIEW_MODE_CLASS="oax-flexmode-";g.FLEXVIEWPAGE="flexviewpage";g.GEOLOC_DENIED="oax-geolocation-denied";g.GEOLOC_FAILED="oax-geolocation-failed";g.GEOLOC_OPT={timeout:1E4};g.GLOADNOW="gloadnow";g.GMAPKEY="gmapkey";g.GMAPCLIENTID="gmapclientid";g.HIGHLIGHT="oax-highlight";
g.ID="oax-id";g.ID_PREFIX="oax-id-";g.ID_RX=/\boax-id-(\S+)\b/;g.ID_FROM_DOMNODE=function(b){return(b=g.ID_RX.test(b.className)?b:alp.gEBCN("oax-id",b)[0])&&g.ID_RX.exec(b.className)[1]};g.IMAGE_UPLOAD_DIALOG_JSONP_URL=b+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+"&page=/plugin/common/inc/imageUpload.dialog.jsp"+(g.API_PROJ_KEY||"");g.JOURNEY_DIALOG_BTN="oax-plan-journey";g.JOURNEY_DIALOG_JSONP_TMPL=b+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+
"&page=/plugin/common/inc/planJourney.dialog.jsp%3Fi=${id}"+(g.API_PROJ_KEY||"");g.LAST_LOGIN_URL=h+"_lastLoginUrl";g.LAST_OVERVIEW_URL=h+"_lastOverviewUrl";g.LITERATURE_RELCONT_DIALOG_MARKUP_JSONP_URL_TMPL=b+alp.i18n.language()+"/bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&page=/plugin/${plugintype}/literature/inc/relatedContent.list.jsp%3Fi=${id}"+(g.API_PROJ_KEY||"");g.LEAFLET_GSHIM="leaflet_gshim";g.LOGIN_BUTTON="oax-login-connector-link";g.LOGIN_DIALOG="oax-login-dialog";g.LOGIN_INDICATOR="oax-login-indicator";
g.LOGIN_NEXTURL_SESTOR="login_nextURL";g.LOGIN_USERID="oax-login-userid";g.MAP_DETAIL="oax-map-detail";g.MODE_3D="3d";g.MODE_LIST="list";g.MODE_MAP="map";g.MODE_MAP_IW="map_iw";g.MODE_LISTMAP="listMap";g.MODE_GALLERY="gallery";g.MODE_MAGAZINE="magazine";g.MODE_OOI_LINK="ooiLink";g.NO_DISPLAY="oax_no_display";g.OOI_LINK="oax-ooi-link";g.OUTBOUND="oax-outbound";g.OUTBOUND_RX=/(?:^|\s)oax-outbound-([^\s]+)(?:\s|$)/;g.PAGE_HIDE_CLASS="oax-page-hide";g.PAGE_SHOW_CLASS="oax-page-show";g.PDF_DIALOG="oax-hidden-pdf-dialog";
g.PDF_DIALOG_MARKUP_JSONP_URL_TMPL=d+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+"&page=/plugin/${plugintype}/${frontendtype}/pdfDialog.jsp?i=${id}&withWaitingReadyDialog=${withWaitingReadyDialog}"+g.API_PROJ_KEY;g.PORTAL_OPEN_OOI_URL=function(b){var a=/\b(localhost)\b/.test(e),c=g.API_CFG&&"true"===g.API_CFG.regio,d=g.IS_MOBILE,f=(c?"":d?"mobile/":"")+alp.i18n.language()+"/r/";return c?k.API_CFG.customDomain?alp.tmpl(g.API_HOST+(d?"mobile/":"")+f+"${id}",b):alp.tmpl((a?
g.API_SERVER:g.API_HOST)+(d?"mobile/":"")+g.API_CFG.proj+"/"+f+"${id}",b):alp.tmpl(g.API_HOST+f+"${id}",b)+(a?"?dev=testing":"")};g.PROFILE_SAVED_SESTOR="oax-profile-saved";g.PURCHASE_BTN="oax-purchase-item-online";g.PURCHASE_MARKUP_JSONP_URL=b+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+"&page=/plugin/common/inc/purchase.dialog.jsp%3Fi=${id}"+(g.API_PROJ_KEY||"");g.SEARCH_CONT="oax-search-input-cont";g.SEARCH_CROSS="oax-icon-cross";g.SEARCH_INFO="oax-search-info";g.SEARCH_INPUT=
"oax-search-input";g.SEARCH_MAGNIFIER="oax-icon-magnifier";g.SEARCH_NOTFOUND="oax-search-notfound";g.SEARCH_OUTPUT="oax-search-output";g.SELECTED="oax_selected";g.SESS_EXP_TMPL="oax-session-expiration-tmpl";g.SHARE_BTN="oax-share";g.SNIPPET_ACTION="oax-snippetaction";g.SNIPPET_ACTION_RX=new RegExp("($|\\s)"+g.SNIPPET_ACTION+"-(\\S+)");g.SNIPPET_ACTION_TYPE=function(b){return b.match(g.SNIPPET_ACTION_RX)[2]};g.SNIPPET_ACTION_OPEN_ON_TOP=!0;g.SNIPPET_TMPL_HTML="_snippetTmplHtml";g.SNIPPET_TMPL_MARKUP_JSONP_URL=
d+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+"&page=/plugin/${plugintype}/${frontendtype}/${snippettype}.jsp"+g.API_PROJ_KEY;g.SNIPPET_TMPL_MARKUP_JSONP_URL_MOBILE=d+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+"&page=/plugin/common/${frontendtype}/snippet.jsp"+g.API_PROJ_KEY;g.SORT_BY_DISTANCE_FROM_USER="distancefromuser";g.START_HIDDEN="oax-start-hidden";g.STATISTIC_CONT="oax-statistics-cont";g.TAB_CB="oax-tab-cb";g.TEAMACTIVITY_DIALOG_MARKUP_JSONP_URL_TMPL=
b+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+"&page=/plugin/common/inc/teamActivity.dialog.jsp%3Fi=${id}"+g.API_PROJ_KEY;g.TEASER_MAP="oax-teaser-map";g.TO_FLEXVIEW="oax-to-flexview";g.TOGGLE_MAP="oax-view-map";g.TOP_CONT="oax-top-cont";g.TOUCH_SUPPORT_CLASS="oax-has-touch-support";g.TPWIZ_MARKUP_JSONP_URL_TMPL=d+"bodyPartJsonp?cachebust="+g.API_CACHEBUST+"&lang="+alp.i18n.language()+"&page=/plugin/desktop/tourplanner/tabs/geom.jsp"+(g.API_PROJ_KEY||"");g.URL_FROM_DOMNODE=
function(b){if(b=this&&alp.gEBCN(g.URL_CLICK_CLASS,b)[0])return alp.gA(b,"href")};g.URL_HASH_INPAGE_DETAIL="ipd";g.URL_SHORT_FROM_ID=function(b){return g.API_HOST+alp.i18n.language()+"/r/"+b};g.URL_HASH_ACTIVITY="cat";g.URL_HASH_ACTIVITY_ALL="*";g.URL_HASH_AREA="area";g.URL_HASH_AREA_ALL="*";g.URL_HASH_AVALANCHE_OPEN="avaldt";g.URL_HASH_BASEMAP="bm";g.URL_HASH_FILTER="filter";g.URL_HASH_FILTER_TYPE_CHECKBOX_CATSEL="c";g.URL_HASH_FILTER_TYPE_CHECKBOX_STANDARD="b";g.URL_HASH_FILTER_TYPE_CHECKBOX_TAG=
"t";g.URL_HASH_FILTER_TYPE_PIKADAYFROMTO="pft";g.URL_HASH_FILTER_TYPE_SELECTBTN="sb";g.URL_HASH_FILTER_TYPE_SLIDER="s";g.URL_HASH_FULLSCREEN="fu";g.URL_HASH_MAPOVERLAY="ov";g.URL_HASH_VIEW="view";g.URL_HASH_WHERETEXT="wt";g.URL_HASH_QTEXT="q";g.URL_HASH_ZOOMCENTER="zc";g.URL_HASH_ZOOMCENTER_RX="(?:^|&)"+g.URL_HASH_ZOOMCENTER+"=(\\d+),([^&]+),([^&]+)";g.URL_HASH_INIT_BBOX="bbox";g.URL_HASH_DETAILMAP="dm";g.URL_HASH_DETAILMAP_AVALANCHE="dmav";g.URL_HASH_DETAILMAP_LIGHTBOX="dmlb";g.URL_HASH_DETAILMAP_WEATHER=
"dmwr";g.URL_HASH_DETAILPAGE_DETAILTAB="dmdtab";g.URL_SEARCH_MLP_OPEN="mlpo";g.URL_SEARCH_MCP_OPEN="mcpo";g.USE_GMAP="use_gmap";g.VIEW_LIST_CONT="oax-view-list-cont";g.WEBAPP_HEADER="oax-webapp-header";g.WEBAPP_HEADER_CLOSE="oax-webapp-header-close";g.WEBAPP_HEADER_LOCSTO="oax-webapp-header-close-";g.WHERE_CLEAR="oax-where-clear";g.WHERE_FIT_COUNT=10;g.YOUTUBE_API_KEY="AIzaSyCtV1pwFLF4yF7e1s1zvzBf7_gmiNDr128";g.YOUTUBE_IMG_URL_TMPL="https://i1.ytimg.com/vi/${id}/mqdefault.jpg";g.YOUTUBE_VIDEO_URL_TMPL=
"http://www.youtube.com/watch?v=${id}";g.YOUTUBE_API_URL_TMPL="https://www.googleapis.com/youtube/v3/videos?id=${id}&key=${apiKey}&fields=${fields}&part=${part}";g.YOUTUBE_YOUTUBE_ID_FROM_URL=function(b){b=b.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);void 0!==b[2]&&(b=b[2].split(/[^0-9a-z_\-]/i),b=b[0]);return b};g.OAX_CLASS="oax";g.PART_CSS_CLASS="oax-part-";g.TYPE_CSS_CLASS_RX=/\boax-type-(\S+?)\b/}})();"undefined"!==typeof dojo&&dojo.provide("oax.const_tp");
(function(){var k=alp.sub("oax",null,!0);k.TP_DP_CONT="alp-tpwiz-wrapper";k.TP_MAP="alp-tpwiz-map-canvas";k.TP_MAP_CONT="alp-tpwiz-map-container";k.TP_TAB="alp-tpwiz-block";k.TP_TAB_GEOM="geom";k.TP_TAB_SHORT="short";k.TP_TAB_MEDIA="media";k.TP_TAB_DATA="data";k.TP_TAB_DETAIL="detail";k.TP_TAB_WAYPOINTS="waypoints";k.TABARR_TP=[k.TP_TAB_GEOM,k.TP_TAB_SHORT,k.TP_TAB_MEDIA,k.TP_TAB_DATA,k.TP_TAB_DETAIL,k.TP_TAB_WAYPOINTS];k.TABSET_TP=alp.arr2oSimple(k.TABARR_TP)})();"undefined"!==typeof dojo&&dojo.provide("oax.const");
(function(){var k=alp.sub("oax",null,!0);oa._const_install("oax");(function(){var h=k.API_CFG;!h||"mini"===h.build||"1"===h.leaflet_gshim||"1"===h.use_gmap&&(h.gmapkey||h.gmapclientid||"function"===typeof alp.sub("google.maps.Map"))||(console.error("oax_head.js/oa_head.js: please set either `?leaflet_gshim=1` or `?use_gmap=1&gmapkey=<YOUR GOOGLE MAPS KEY>` or `?use_gmap=1&gmapclientid=<YOUR GOOGLE MAPS CLIENTID>`. THIS WILL BECOME MANDATORY STARTING September 1st, 2016."),setTimeout(function(){throw Error("oax_head.js/oa_head.js: please set either `?leaflet_gshim=1` or `?use_gmap=1&gmapkey=<YOUR GOOGLE MAPS KEY>` or `?use_gmap=1&gmapclientid=<YOUR GOOGLE MAPS CLIENTID>`. THIS WILL BECOME MANDATORY STARTING September 1st, 2016.");
},0),(new Date>=new Date(2016,8,30)||/[\?&]gmcrash=1(?:&|$)/.test(location.search))&&(void 0)())})();k.ADD_COMMENT_CONT="oax-myComment-container";k.ADD_CONDITION_CONT="oax-myCondition-container";k.AVALANCHE_CONT="oax-avalanche";k.CONDITION_SLIDER_INIT=7;k.COOKIE_LAST_HASH="oax-last-hash";k.DETAIL_MAP_WRAPPER="oax-map-wrapper";k.DETAILMAP_VISIBLE="oax-detailmap-visible";k.DETAILPANE_MAPLIST_SNIPPET="oax-mapList-snippet";k.DETAILPANE_LAZYCONT="oax_detailpane_lazycont";k.DETAILPANE_TOURMAP_POI_SNIPPET=
[k.DETAILPANE_MAPLIST_SNIPPET,"oax-dp-poi-snippet"];k.DETAILPANE_TAB_CLASS_RX=/(^|\s)(oax-tab_(\d+))($|\s)/;k.DETAILPANE_TABNAME_CLASS_RX=/(^|\s)(oax-tabname_(\S+))($|\s)/;k.FLEXVIEW_MAP_CONT="oax-map-container";k.GET_PDF_CONT="oax-pdf-login";k.GET_PDF_ID="openPdf-";k.IW_PLACE_OTHER=["oax-map-info-other"];k.IW_OOI_TMPL_CLASS_PREFIX="oax-iw-ooi-tmpl-";k.MP_CONT="oax-map-panel-cont";k.MLP_CONT="oax-mlp-cont";k.MCP_CONT="oax-mcp-cont";k.MLP_TOGGLE="oax-mlp-toggle";k.MCP_TOGGLE="oax-mcp-toggle";k.MODEARR_FLEXVIEW=
[k.MODE_LIST,k.MODE_MAP,k.MODE_LISTMAP,k.MODE_GALLERY];k.MODESET_FLEXVIEW=alp.arr2o(k.MODEARR_FLEXVIEW,alp.f(),alp.f("1"));k.MODESET_FLEXVIEW_MODE_W_MAP=alp.arr2o([k.MODE_MAP,k.MODE_LISTMAP,k.MODE_3D],alp.f(),alp.f("1"));k.NO_FULLSCREEN="oax-no-fullscreen";k.GPX_DIALOG="oax-hidden-gpx-dialog";k.KML_DIALOG="oax-hidden-kml-dialog";k.PLACES_MAX_ZOOM=13;k.PLUGINTYPE="desktop";k.READY="oax-ready";k.SLIDER_CONT="oax-content-slider-cont";k.SNIPPET_CONTAINER="oax-snippet-container";k.SNIPPET_CONTAINER_MORE_RX=
/(?:^|\s)oax-(\S+)-cont(?:\s|$)/;k.SNIPPET_SLIDESHOW="oax-snippetslideshow";k.SNIPPET_SLIDESHOW_CTRL="oax-snippetslideshow-controller";k.SNIPPET_SLIDESHOW_PREV="oax-snippetslideshow-prev";k.SNIPPET_SLIDESHOW_NEXT="oax-snippetslideshow-next";k.SNIPPET_SLIDESHOW_CURRENT="oax-snippetslideshow-current";k.SNIPPET_SLIDESHOW_MAX="oax-snippetslideshow-max";k.STREETVIEW_VISIBLE="oax-streetview-visible";k.TEASER_MAP_WAIT="oax-teaser-map-wait";k.URL_CLICK_CLASS="oax-click-url";k.URL_SEARCH_GET_EDITCOND_ID=function(){return alp.opt(location.search.match(/[\?&]editcond=([^&]+)/),
1)};k.URL_SEARCH_GET_EDITCOND_BACK=function(){return decodeURIComponent(alp.opt(location.search.match(/[\?&]editcondback=([^&]+)/),1)||"")};k.URL_EDITCOND_CONT="oax-editcond-link-cont";k.URL_EDITCOND_RX=/\?editcond=[^&]+/;k.URL_EDITCONDBACK_RX=/[\?&]editcondback=[^&]+/;k.WEATHER_BOX_CONT="oax-weather";k.WEATHER_BOX_OPENER="oax-weather-open";k._js_tracking=function(h,g){setTimeout(function(){var f=alp.sub("oa.API_CFG")||{},e=f.proj||"",d=f.key||"",b=alp.sub("oa.PREFIX"),c=[];alp.forIn(f,'this.push(w+"="+v)',
c);c.sort();f=(g||[]).concat(["key="+d,"prefix="+b]).concat(c).join("&");alp.cE("img",alp.body(),{style:"width:1px;height:1px;visibility:hidden;",src:"//www.outdooractive.com/api/project/"+(e||"--missing-project--")+"/js-tracking/"+h+"?"+f})},5E3)}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.mode");
(function(){alp.declare("alp.x.Mode",alp.x.AbstractController,null,{name2bool:null,augmentModel:function(k){k.name=new alp.State;k._politeSet=new alp.PoliteSetState({init_value:alp.oValues(this.name2bool)})},setInitVal:function(k,h,g){k=alp.orIn(k.name2bool,"v.get()  &&  k")||null;g.name.set(k)},connectModel2Model:function(k,h,g){h.push(g.name.change_cb(function(){var f=g.name.get();alp.forIn(k.name2bool,'v.set( w === "'+f+'")')}));alp.forIn(k.name2bool,function(f,e){h.push(f.change_cb(function(){f.get()?
g.name.set(e):alp.orIn(k.name2bool,".get()")||g.name.set(null)}))})}})})();"undefined"!==typeof dojo&&dojo.provide("alp.view.modalwin");
(function(){function k(g){function f(a){a=a.target;"function"===typeof this.setSelectionRange?a.setSelectionRange(0,9999):a.select()}function e(a){setTimeout(function(){var b=a.target;if(window.getSelection){var c=window.getSelection();var d=document.createRange();d.selectNodeContents(b);c.removeAllRanges();c.addRange(d)}else document.body.createTextRange&&(d=document.body.createTextRange(),d.moveToElementText(b),d.select())},100)}function d(){if(document.body.contains(p)){b(!1);var a=alp.transitionEndName();
if(a&&!alp.likeNativeAndroid()){alp.setClass(p,"oax_fadeInOut",!1);var c=alp.aEL(u,a,function(){alp.orphan(p);alp.rEL(c)})}else alp.orphan(p);alp.forIn(alp.gEBCN("oax-fixPos-onMoviOpen"),function(a){a.style.marginLeft="auto"});alp.setClass(alp.body(),"oax_hidden",!1);alp.m(h,"onCloseLater",u,p,h);return h}}function b(a){alp.likeMobile()&&(a?alp.hasClass(alp.body(),"oax_modal_fixed_mobile")||(a=alp.gWindowScroll().top,alp.setClass(alp.body(),"oax_modal_fixed_mobile",!0),alp.style(alp.body(),{"margin-top":-1*
a+"px"})):1<alp.gEBCN("oax_modal_wrap").length||(a=-1*parseInt(alp.oGet(alp.body(),"style.marginTop")||0),alp.setClass(alp.body(),"oax_modal_fixed_mobile",!1),alp.style(alp.body(),{"margin-top":""}),alp.body().scrollTop=a,document.documentElement.scrollTop=a))}function c(a){var b=a.target;if(b===p||b===v)alp.stopEvent(a),d()}function a(a){a.keyCode===alp.key.ESCAPE&&(alp.stopEvent(a),d())}var h=alp.mixCheck({html:"",title:"",extraClass:"",autoClose:!0,onCreate:null,onOpenNow:null,onCloseLater:null,
width:null,height:null},g);g=h.html;var l=h.extraClass;(g||null).substring.call.a;l&&l.substring.call.a;var k={"class":"oax_modal_container"};if(h.width&&h.height){var n=alp.gViewportSize(),q=Math.min(h.height,n.height-40);k.style="width: "+Math.min(h.width,n.width-40)+"px; height: "+q+"px; margin-top: -"+q/2+"px; top: 50%;"}var p=alp.cE("div",null,{"class":"oax oax_modal_wrap "+l}),v=alp.cE("div",p,{"class":"oax_modal_bg"}),u=alp.cE("div",p,k);u.innerHTML=g;(g=alp.nodify("oax-modal-header",u))&&
h.title&&0<h.title.length&&(alp.setClass(g,"oax_no_display",!1),(l=alp.gEBTN("strong",g)[0])?l.innerText=h.title:alp.place(alp.cE("strong",null,null,{innerText:h.title}),g));g=alp.gEBCN("oax-modal-action-select",u);alp.forEach(g,function(a){var b=f;"DIV"===a.tagName&&(b=e);alp.aEL(a,"click",b)});alp.aEL(alp.gEBCN("oax-modal-action-close",u),"click",d);h.autoClose&&(alp.aEL([p,v],"click",c),alp.aEL(alp.body(),"keyup",a));h.ovCont=u;h.ovWrap=p;h.open=function(){alp.forIn(alp.gEBCN("oax-fixPos-onMoviOpen"),
function(a){var b=alp.gBCR(a).left|0;a.style.marginLeft=b+"px"});alp.setClass(alp.body(),"oax_hidden",!0);b(!0);alp.aC(alp.body(),p);setTimeout(function(){alp.setClass(p,"oax_fadeInOut",!0)},10);alp.m(h,"onOpenNow",u,p,h);return h};h.close=d;alp.m(h,"onCreate",u,p,h);return h}alp.ensureCss(alp.cssBase()+(alp.Later?"alp/x2.css":"alp/x.css"));var h=alp.sub("alp.view.modalwin",null,!0);h.open=function(g){return k(g).open()};h.close=function(g){return g.close()};h.create=k})();
"undefined"!==typeof dojo&&dojo.provide("alp.dom.form_confirm_leaving");
(function(){alp.sub("alp.dom",null,!0).formConfirmLeaving=function(k,h){function g(){var d=alp.reduce(["input","textarea"],function(b,c){return b.concat(alp.Aps.call(alp.gEBTN(c,k)))},[]);return alp.map(alp.filter(d,'"value" in v'),".value")}var f=g();return alp.aEL(window,"beforeunload",function(d){if(!alp.arrEqual(f,g()))return e||(e=h&&h.msg),"string"!==typeof e&&(e=alp.nodify(e).value),e||(e="Quit page without saving changes?"),e.substring.call.a,d.returnValue=e});var e}})();
"undefined"!==typeof dojo&&dojo.provide("alp.dom.window_exit_intercept");(function(){var k=alp.sub("alp.dom",null,!0);k.windowExitIntercept=function(g,f){var e=alp.aEL(window,"beforeunload",function(d){if(g=alp.fVal(g||"Are you sure?",d,f))return d||(d=window.event),d&&(d.returnValue=g),g});h.push(e);return e};k.windowExitInterceptClearAll=function(){for(;h.length;)try{alp.rEL(h.pop())}catch(g){}};var h=[]})();"undefined"!==typeof dojo&&dojo.provide("oax.layout");
(function(){function k(a,b,c,d){var e=alp.mapIn(b,function(a,b){return"eh"===b?a:"object"===typeof a?a:{className:"oax_no_display",bool:a}});b=e.eh||null;a=alp.aEL(alp.gEBCN(a,c),"click",function(){var a={},b;for(b in e)if(!(b in a)){var f=e[b];alp.setClass(alp.gEBCN(b,c),f.className,d?!f.bool:f.bool)}});alp.m(b,"push",a);return a}function h(a,b){return g(a,b)[0]}function g(a,c){function d(){for(var a=[alp.body()];a.length;){var b=a.pop(),c=b.className;if((c=c&&c.match&&c.match(/(?:^|\s)(oax-(?:toggle|mapList|part|show|filter|flexView|list|part|gallery|magazine|map|view|selectors|breadcrumb)[^\s]*)(?:\s|$)/g))&&
c.length)for(var d=c.length;d--;){var f=c[d];(f in e?e[f]:e[f]=[]).push(b)}for(c=(b=b.childNodes)&&b.length||0;c--;)a.push(b[c])}}c||(c={topCont:alp.body(),nodeCache:g});var e=c.nodeCache;c=c.topCont;if(null==b){var f=document.getElementsByClassName;f&&"function"===typeof f?d=!1:(d(),b=!0)}return e[a]||(e[a]=alp.gEBCN(a,c))}function f(a,b){var c=alp.map("string"!==typeof b?b:[b],function(b){return h(b,a)});alp.setClass.apply(alp,[alp.filter(c,"")].concat(alp.Aps.call(arguments,2)))}var e=alp.cfg,
d=alp.sub("oax.layout",null,!0);d.click_setup=k;d.click_setup_toggle=function(a,b,c,d){return[k(a,c,d),k(b,c,d,!0)]};d.getNode=h;d.getNodeArr=g;d.installRegionTeaser=function(a,b){b=b&&b.eh;alp.m(b,"push",alp.aEL(alp.gEBCN("oax-toggle-region-teaser-open",a),"click",function(a){a||(a=window.event);a=a.target||a.srcElement;a.parentNode.style.height="auto";alp.setClass(a,oax.NO_DISPLAY,!0);alp.setClass(a.nextSibling,oax.NO_DISPLAY,!1)}));alp.m(b,"push",alp.aEL(alp.gEBCN("oax-toggle-region-teaser-close",
a),"click",function(a){a||(a=window.event);a=a.target||a.srcElement;a.parentNode.style.height="";alp.setClass(a,oax.NO_DISPLAY,!0);alp.setClass(a.previousSibling,oax.NO_DISPLAY,!1)}))};d.setClassIfNode=function(a){f.apply(null,[null].concat(alp.Aps.call(arguments)))};d.setClassIfNodeCached=f;d.slideshow_setup=function(a,b){d.delayedImages();return alp.map(alp.gEBCN(oax.SLIDER_CONT,a),function(a){var d=alp.nodify("oax-content-slider-slides",a),e=alp.nodify("oax-content-slider-control",a);a=alp.nodify("oax-content-slider-thumbs",
a);if(d){var f=c.get(d);f&&f.stopLoop();f=alp.gEBCN(["oax-snippets-slide","oax_geo_slide"],d);0<f.length&&alp.forEach(f,function(a){alp.dom.anchor.wrap_ooi_snippet(a)});f=new alp.x.SlideShow(d,{previousButton:"oax-prev",nextButton:"oax-next",current_slide_number_display_q:"oax-content-slider-current",max_slide_number_display_q:"oax-content-slider-max",cont_slide_number_display_q:"oax-content-slider-numbercont",always_slide_number_display:!0,slideSelector:e,extraslide:a,withLightbox:b&&b.withLightbox&&
!(0<f.length),lightbox_proj:b&&b.proj,isLightboxOpenSt:b&&b.isLightboxOpenSt,interceptOpenCloseClick:b&&b.interceptOpenCloseClick});c.setNow(d,f);return f}})};d.lightbox_setup=function(b,c){function d(a){a=alp.dataset(a);if(!a._oax_lightbox_not_installed_yet)return a._oax_lightbox_not_installed_yet=!0}function f(b){alp.stopEvent(b||window.event);b=this.id.split("_");b=alp.filter(g,".id.match(/^"+b[0]+"_/)");var c=alp.lastIndexOf(b,this);b=alp.Aps.call(b,c).concat(alp.Aps.call(b,0,c));b=alp.map(b,
'{ legend: alp.opt( alp.nodify( "oax-wrap-claim", v ), "innerHTML" )  ||  alp.gA( v, "title" ), isVideo: v.dataset.isVideo === "true", youtubeId: v.dataset.youtubeId, imgurl: this.img_from_id( alp.gA( alp.gEBTN("img",v)[0], "src" ).match('+e.url.img2_id_extract_rx_str+')[1], "max" )}',e.url);a.show(b)}c=c&&c.eh||new alp.Eh;a||(a=new alp.x.Lightbox({proj:"outdooractive"}));if(alp.gEBCN("oax-show-OOI-in-lightbox",b)){var g=alp.filter(alp.gEBCN("oax-show-OOI-in-lightbox",b),d);c.push(alp.aEL(g,"click",
f))}return c};d.webappteaser_setup=function(a){return alp.map(alp.gEBCN("oax-webapp-teaser",a),function(a){var b=alp.dataset(a);if(!b.oax_webapp_teaser)return b.oax_webapp_teaser="done",new alp.x.SlideShow(a,{mouseover_container:a.parentNode,mouseover_autoplay:!0,interval:2E3,duration_sec:1})})};d.delayedImages=function(){alp.installNode("img","oax-delayed-img")};d.category_toggle_setup=function(a){var b=alp.gEBCN("oax-cat-toggle-lnk");b=alp.aEL(b,"click",function(a){a||(a=window.event);a=(a.currentTarget||
a.srcElement).parentNode;alp.hasClass(a,"oax-cat-toggle-exp")?alp.setClass(a,"oax-cat-toggle-exp",!1):(alp.setClass(alp.gEBCN("oax-cat-toggle-exp"),"oax-cat-toggle-exp",!1),alp.setClass(a,"oax-cat-toggle-exp",!0))});a&&alp.m(a,"push",b)};var b,c=alp.mapany(),a})();"undefined"!==typeof dojo&&dojo.provide("alp.styleform._core");alp.styleform||(alp.styleform={});
(function(){function k(a){var c=alp.oCreateMix({checkboxHeight:25,radioHeight:25,selectWidth:190,cont:document,labelCont:null,oncheck:null,onchoose:null,oncheck_init:null,onchoose_init:null},a||{});"string"===typeof c.cont&&(c.cont=alp.nodify(c.cont));a=w.get(c.cont)||w.setNow(c.cont,new alp.Eh);a.clear();var d="childNodes"in c.cont,g=d?alp.gEBTN("input",c.cont):c.cont.input||[];d=d?alp.gEBTN("select",c.cont):c.cont.select||[];c._input_arr=g;c._select_arr=d;var l=c.opt_state_info_arr=alp.map(g,alp.bindF(f,
null,c,a));alp.forEach(l,alp.bindF(e,null,c,a));alp.forEach(d,alp.bindF(b,null,c,a));a.push(alp.aEL("childNodes"in c.cont?c.cont:alp.Aps.call(g).concat(alp.Aps.call(d)),"mouseup",function(){m(c)}));m(c)}function h(a){alp.forEach(["radio","checkbox"],function(b){alp.orphan(alp.gEBCN("alp-styleform-"+b,a))});return a}function g(a,b){return"childNodes"in b.cont?p.test(a.className):!0}function f(b,e,f){var l=(f.type+"").toLowerCase(),h=v.test(l),k=!!alp.gA(f,"checked"),p=u.test(l),r=g(f,b),w=!!alp.gA(f,
"disabled");l="childNodes"in b.cont;if(r&&(h||p)&&(alp.setClass(f,"alp-styleform-styled",!1),r=h?b.checkboxHeight:b.radioHeight,k&&q(f,"0 -"+2*r+"px"),f.parentNode.insertBefore(f,f),!w)){var x=n(f.name,f.checked,{originalNode:f},b.oncheck_init);k=(k=f.className.match(t))&&alp.gEBCN(k[0],b.labelCont||(l?b.cont:f.parentNode));w=alp.bindF(d,null,f,k);w();k&&alp.setClass(k,"alp-x-clickable",!0);var y=alp.oCreateMix(b,{x:f,is_checkbox:h,is_radio:p,span:f,height:r,label_update_f:w,opt_state:x,cfg:b});e.push(alp.aEL(f,
"mousedown",function(a){alp.stopEvent(a||window.event);c(y)},!1));e.push(alp.aEL(f,"click",function(b){y.is_checkbox||alp.stopEvent(b||window.event);a(y,y.is_radio||(y.is_checkbox?f.checked:null));m(y)},!0));k&&k.length&&alp.aEL(alp.filter(k,function(a){return a!==f}),"click",function(){a(y,y.is_radio||null)});h=f.id&&alp.filter(alp.gEBTN("label",b.labelCont||(l?b.cont:f.parentNode)),alp.f('alp.gA(v,"for")=="'+f.id+'"'))||[];alp.setClass(h,"alp-x-clickable",!0);/^label$/i.test(f.parentNode.tagName)&&
h.push(f.parentNode);h.length&&(e.push(alp.aEL(h,"mousedown",function(a){alp.stopEvent(a||window.event);c(y)},!0)),e.push(alp.aEL(h,"mouseup",function(b){alp.stopEvent(b||window.event);var c=f.checked;setTimeout(function(b){a(y,p?!0:!c);m(y)},0)},!0)));if(x){e.push(x.change_cb(function(){var c=!!x.get();a(y,c,{no_clear:!0});y.is_radio&&m(b)}),alp.bindF("drop_cb",x));var z={opt_state:x,cfg2:y}}}return z}function e(b,c,d){d&&a(d.cfg2,d.opt_state.get())}function d(a,b){if(b)for(var c=a.checked,d=0,e=
b.length;d<e;d++){var f=b[d];f!==a&&alp.setClass(f,"alp-styleform-checked",c)}}function b(a,b,c){var d=g(c,a),e=!!alp.gA(c,"disabled");if(d){n(c.name,c.value,{originalNode:c},a.onchoose_init);var f=alp.gEBTN("option",c),l=f.length;d=l?f[0].childNodes[0].nodeValue:"";for(var h=1;h<l;h++)f[h].selected&&(d=f[h].childNodes[0].nodeValue);f=alp.cE("span",null,{"class":"alp-styleform-select"+(e?" alp-styleform-disabled":""),id:"alp-styleform-select-"+c.name});alp.cTxN(d,f);c.parentNode.insertBefore(f,c);
e||b.push(alp.aEL(c,"change",alp.bindF(r,null,a,c)))}}function c(a){q(a.span,"0 -"+(a.x.checked?3:1)*a.height+"px")}function a(a,b,c){var d=a.x,e=a.is_checkbox,f=a.span,g=a.height,l=a.opt_state;c=c&&c.no_clear;e=d.checked=null!=b?b:e?b:!0;q(f,e?"0 -"+2*g+"px":"0 0");alp.m(a,"label_update_f");alp.m(l,"setNow",e);if(b||a._last_information!==e)a._last_information=e,n(d.name,e,{originalNode:d},a.oncheck);(a=a.cfg)&&!c&&m(a)}function m(a){var b=a._input_arr||("childNodes"in a.cont?alp.gEBTN("input",a.cont):
a.cont.input||[]),c=b.length,d=0;for(;d<c;d++){var e=b[d],f=g(e,a),h=e.type,k=v.test(h);h=u.test(h);var m=k?a.checkboxHeight:a.radioHeight,n=e.previousSibling,p=n&&n.tagName;f&&(k||h)&&p&&/^span$/i.test(p)&&q(n,e.checked?"0 -"+2*m+"px":"0 0")}alp.now(l,null,a)}function l(a){if(a=a.opt_state_info_arr)for(var b=a.length,c=0;c<b;c++){var d=a[c],e=d&&d.opt_state;d=d&&d.cfg2.x;e&&d&&e.set(d.checked)}}function r(a,b){for(var c=b.name,d=alp.gEBTN("option",b),e,f=d.length,g=0;g<f;g++){var l=d[g];l.selected&&
(e=alp.gEBI("alp-styleform-select-"+c,a.cont).childNodes[0].nodeValue=l.childNodes[0].nodeValue)}n(c,e,{originalNode:b},a.onchoose)}function n(a,b,c,d){if(d&&(d="function"===typeof d?d:d[a]))return d(a,b,c)}function q(a,b){a=a.style;a.backgroundPosition!==b&&(a.backgroundPosition=b,alp.likeIE9plus()&&(alp.redrawIE9(a),b=a.display,a.display="none",a.display=b))}var p=/\balp-styleform-styled\b/,v=/^checkbox$/i,u=/^radio$/i,t=/\balp-styleform-label-(\S+)\b/;alp.ensureCss(alp.cssBase()+"alp/x.css");alp.styleform.init=
function(a){if(a&&a.now)k(a);else alp.onDCL(alp.bindF(k,null,a))};alp.styleform.remove_from_dom=h;alp.styleform.remove_from_html=function(a){return h(alp.cE("div",null,null,{innerHTML:a})).innerHTML};var w=alp.mapany()})();"undefined"!==typeof dojo&&dojo.provide("alp.styleform");"undefined"!==typeof dojo&&dojo.provide("alp.util.pw_strength");
(function(){function k(h,g){for(var f=0,e=0;e<h.length;e++)-1<g.indexOf(h.charAt(e))&&f++;return f}alp.util.pw_toggle=function(h,g){alp.stopEvent(h);h=alp.gEBCN("oax-pw-input",g||document)[0];"text"==h.getAttribute("type")?h.setAttribute("type","password"):h.setAttribute("type","text");h.focus()};alp.util.pw_check=function(h){h=alp.util.pw_complexity(h.value);var g=alp.gEBCN("oax-password-meter");alp.setClass(alp.gEBCN("oax-password-meter"),"oax_pwd_sucks",!0);0<h&&alp.setClass(g.splice(0,h),"oax_pwd_sucks",
!1);return h};alp.util.pw_complexity=function(h){h=alp.util.pw_strength(h);return 80<=h?5:60<=h?4:40<=h?3:25<=h?2:15<h?1:0};alp.util.pw_strength=function(h){var g=0;5>h.length?g+=5:4<h.length&&8>h.length?g+=10:7<h.length&&(g+=25);var f=k(h,"ABCDEFGHIJKLMNOPQRSTUVWXYZ"),e=k(h,"abcdefghijklmnopqrstuvwxyz"),d=f+e;0==f&&0!=e?g+=10:0!=f&&0!=e&&(g+=20);var b=k(h,"0123456789");3<=b?g+=20:1<=b&&(g+=10);h=k(h,"!@#$%^&*?_~");1==h&&(g+=10);1<h&&(g+=25);0!=b&&0!=d&&(g+=2);0!=b&&0!=d&&0!=h&&(g+=3);0!=b&&0!=f&&
0!=e&&0!=h&&(g+=5);return g}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.pikaday");
(function(){function k(b){if(this._v||b){var c=this._o;b=c.minYear;var d=c.maxYear,e=c.minMonth,f=c.maxMonth;this._y<=b&&(this._y=b,!isNaN(e)&&this._m<e&&(this._m=e));this._y>=d&&(this._y=d,!isNaN(f)&&this._m>f&&(this._m=f));this.el.innerHTML=a(this)+this.render(this._y,this._m);c.bound&&(d=alp.gBCR(c.field),b=d.left,d=d.bottom+1,c.scrollContainerNode||(d+=alp.gWindowScroll().top),this.el.style.cssText="position:absolute;left:"+b+"px;top:"+d+"px;",c.style&&alp.mix(this.el.style,c.style),setTimeout(function(){c.field.focus()},
1))}}function h(a){return{relativeDays:a._o.useRelativeDays&&(a._o.i118n||l).relativeDays}}function g(a){return"value"in a?a.value:alp.textContent(a)}function f(a,b){a._o||(a._o=d({},n,!0));a._o.isRTL=alp.isRTL();a=d(a._o,b,!0);a.isRTL=!!a.isRTL;a.field=a.field&&a.field.nodeName?a.field:null;a.bound=!!(void 0!==a.bound?a.field&&a.bound:a.field);b=parseInt(a.numberOfMonths,10)||1;a.numberOfMonths=4<b?4:b;e(a.minDate)||(a.minDate=!1);e(a.maxDate)||(a.maxDate=!1);a.minDate&&a.maxDate&&a.maxDate<a.minDate&&
(a.maxDate=a.minDate=!1);a.minDate&&(a.minYear=a.minDate.getFullYear(),a.minMonth=a.minDate.getMonth());a.maxDate&&(a.maxYear=a.maxDate.getFullYear(),a.maxMonth=a.maxDate.getMonth());a.yearRange instanceof Array?(b=(new Date).getFullYear()-10,a.yearRange[0]=parseInt(a.yearRange[0],10)||b,a.yearRange[1]=parseInt(a.yearRange[1],10)||b):(a.yearRange=Math.abs(parseInt(a.yearRange,10))||n.yearRange,100<a.yearRange&&(a.yearRange=100));return a}function e(a){return a instanceof Date&&!isNaN(a.getTime())}
function d(a,b,c){var f,g;for(f in b)if((g=void 0!==a[f])&&b[f]&&"object"===typeof b[f]&&void 0===b[f].nodeName)e(b[f])?c&&(a[f]=new Date(b[f].getTime())):b[f]instanceof Array?c&&(a[f]=b[f].slice(0)):a[f]=d({},b[f],c);else if(c||!g)a[f]=b[f];return a}function b(a,b,c){for(b+=a.firstDay;7<=b;)b-=7;return c?(a.i118n||l).weekdaysShort.split(",")[b]:(a.i118n||l).weekdays.split(",")[b]}function c(a,b,c,d,e){if(e)return'<td class="alp-pika-is-empty"></td>';e=[];d&&e.push("alp-pika-is-disabled");c&&e.push("alp-pika-is-today");
b&&e.push("alp-pika-is-selected");return'<td data-day="'+a+'" class="'+e.join(" ")+'"><button class="alp-pika-button" type="button">'+a+"</button></td>"}function a(a){var b=a._o,c=a._m,d=a._y,e=d===b.minYear,f=d===b.maxYear,g='<div class="alp-pika-title">',h=!0,k=!0;var m=[];for(a=0;12>a;a++)m.push('<option value="'+a+'"'+(a===c?" selected":"")+(e&&a<b.minMonth||f&&a>b.maxMonth?"disabled":"")+">"+(b.i118n||l).months.split(",")[a]+"</option>");g+='<div class="alp-pika-label">'+(b.i118n||l).months.split(",")[c]+
'<select class="alp-pika-select alp-pika-select-month">'+m.join("")+"</select></div>";if(b.yearRange instanceof Array){a=b.yearRange[0];var n=b.yearRange[1]+1}else a=d-b.yearRange,n=1+d+b.yearRange;for(m=[];a<n&&a<=b.maxYear;a++)a>=b.minYear&&m.push('<option value="'+a+'"'+(a===d?" selected":"")+">"+a+"</option>");g+='<div class="alp-pika-label">'+d+'<select class="alp-pika-select alp-pika-select-year">'+m.join("")+"</select></div>";e&&(0===c||b.minMonth>=c)&&(h=!1);f&&(11===c||b.maxMonth<=c)&&(k=
!1);return g+('<button class="alp-pika-prev'+(h?"":" alp-pika-is-disabled")+'" type="button">Previous Month</button>')+('<button class="alp-pika-next'+(k?"":" alp-pika-is-disabled")+'" type="button">Next Month</button>')+"</div>"}var m="function"===typeof window.moment;alp.ensureCss(alp.cssBase()+"alp/x.css");var l={},r=alp.i18n.fetch("alp.all");r.then(function(a){l=a});alp.declare("alp.x.Pikaday",null,function(a){function b(a){if(n._v){a=a||window.event;var b=a.target||a.srcElement;if(b){if(!alp.hasClass(b,
"alp-pika-is-disabled")){if(alp.hasClass(b,"alp-pika-button")&&!alp.hasClass(b,"alp-pika-is-empty")){n.setDate(new Date(n._y,n._m,parseInt(b.innerHTML,10)));q.bound&&setTimeout(function(){n.hide()},100);return}alp.hasClass(b,"alp-pika-prev")?n.prevMonth():alp.hasClass(b,"alp-pika-next")&&n.nextMonth()}if(alp.hasClass(b,"alp-pika-select"))n._c=!0;else if(a.preventDefault)a.preventDefault();else return a.returnValue=!1}}}function c(a){a=a||window.event;(a=a.target||a.srcElement)&&(alp.hasClass(a,"alp-pika-select-month")?
n.gotoMonth(a.value):alp.hasClass(a,"alp-pika-select-year")&&n.gotoYear(a.value))}function d(a){a=g(q.field);n._hasMoment?n.setDate(window.moment(a,q.format).toDate()):(a=n.parseDateString(a),n.setDate(e(a)?a:null));n._v||n.show()}function l(a){n.show()}function h(a){n.show()}function k(a){n._c||(n._b=setTimeout(function(){n.hide()},50));n._c=!1}var n=this,q=f(n,a);n._hasMoment=!q.dateTmpl&&m;n._onMouseDown=b;n._onChange=c;n._onInputChange=d;n._onInputFocus=l;n._onInputBlur=k;n._onInputClick=h;n._onClick=
function(a){a=a||window.event;var b=a=a.target||a.srcElement;if(a){a.addEventListener||!alp.hasClass(a,"alp-pika-select")||a.onchange||(a.setAttribute("onchange","return;"),alp.aEL(a,"change",n._onChange));do if(alp.hasClass(b,"alp-pika-single"))return;while(b=b.parentNode);n._v&&a!==q.field&&n.hide()}};n.el=alp.cE("div");n.el.className="alp-pika-single"+(q.isRTL?" alp-pika-is-rtl":"");q.isRTL&&alp.sA(n.el,"dir","rtl");alp.aEL(n.el,"mousedown",b,!0);alp.aEL(n.el,"change",c);q.field&&(q.bound?alp.body().appendChild(q.top_wrap?
n._topWrap_node=alp.aC(alp.cE("div",null,{"class":q.top_wrap}),n.el):n.el):q.field.parentNode.insertBefore(n.el,q.field.nextSibling),alp.aEL(q.field,"change",d),q.defaultDate||(a=g(q.field),q.defaultDate=n._hasMoment&&a?window.moment(a,q.format).toDate():n.parseDateString(a),q.setDefaultDate=!0));a=q.defaultDate;e(a)?q.setDefaultDate?n.setDate(a):n.gotoDate(a):n.gotoDate(new Date);q.bound?(n.hide(),n.el.className+=" alp-pika-is-bound",alp.aEL(q.field,"click",h),alp.aEL(q.field,"focus",l),alp.aEL(q.field,
"blur",k),q.clickNode&&alp.aEL(q.clickNode,"click",h)):n.show()},{selectEvt:alp.memM("selectEvt",'alp.event("pikaday selectEvt",{then:1})'),openEvt:alp.memM("openEvt",'alp.event("pikaday openEvt",  {then:1})'),closeEvt:alp.memM("closeEvt",'alp.event("pikaday closeEvt", {then:1})'),toString:function(a){return e(this._d)?this._hasMoment?window.moment(this._d).format(a||this._o.format):alp.date2str(this._d,this._o.dateTmpl,h(this)):""},getMoment:function(){return this._hasMoment?window.moment(this._d):
null},parseDateString:function(a){a=alp.sTrim(a);return this._hasMoment?this._xxx_call_moment_js_to_parse(a,a.format):this._o.dateTmpl?alp.str2date(a,this._o.dateTmpl,h(this)):new Date(Date.parse(a))},getDate:function(){return e(this._d)?new Date(this._d.getTime()):null},setDate:alp.nowF(function(a){function b(){function a(){var a=c._o.field,b=c.toString();"value"in a?a.value=b:alp.setText(a,b)}c._o.field&&r.then(a)}var c=this;if(+c._d!=+a){if(!a)return c._d=null,alp.m(c._o.onSelect,"call",c,null),
c.selectEvt().triggerSoon(null),b(),c.draw();"string"===typeof a&&(a=c.parseDateString(a));if(e(a)){var d=c._o.minDate,f=c._o.maxDate;e(d)&&a<d?a=d:e(f)&&a>f&&(a=f);c._d=new Date(a.getTime());c._d.setHours(0,0,0,0);c.gotoDate(c._d);b();a=c.getDate();alp.m(c._o.onSelect,"call",c,a);c.selectEvt().triggerSoon(a)}}}),getRelativeDay:function(){return alp.getRelativeDay(this.getDate())},setRelativeDay:function(a){this.setDate(alp.relativeDay2date(a))},gotoDate:function(a){e(a)&&(this._y=a.getFullYear(),
this._m=a.getMonth(),this.draw())},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(a){isNaN(a=parseInt(a,10))||(this._m=0>a?0:11<a?11:a,this.draw())},nextMonth:function(){11<++this._m&&(this._m=0,this._y++);this.draw()},prevMonth:function(){0>--this._m&&(this._m=11,this._y--);this.draw()},gotoYear:function(a){isNaN(a)||(this._y=parseInt(a,10),this.draw())},draw:function(a){r.then(alp.bindF(k,this,a))},render:function(a,d){var f=this._o,g=new Date,l=alp.getDaysInMonth(a,d),h=(new Date(a,
d,1)).getDay(),k=[],m=[];g.setHours(0,0,0,0);0<f.firstDay&&(h-=f.firstDay,0>h&&(h+=7));for(var n=l+h,p=n;7<p;)p-=7;n+=7-p;for(var q=p=0;p<n;p++){var r=new Date(a,d,1+(p-h)),G=f.minDate&&r<f.minDate||f.maxDate&&r>f.maxDate,B=e(this._d)?+r==+this._d:!1;m.push(c(1+(p-h),B,+r==+g,G,p<h||p>=l+h));7===++q&&(k.push("<tr>"+m.join("")+"</tr>"),m=[],q=0)}d=[];for(a=0;7>a;a++)d.push('<th scope="col"><abbr title="'+b(f,a)+'">'+b(f,a,!0)+"</abbr></th>");return'<table cellpadding="0" cellspacing="0" class="alp-pika-table">'+
("<thead>"+d.join("")+"</thead>")+("<tbody>"+k.join("")+"</tbody>")+"</table>"},isVisible:function(){return this._v},show:alp.nowF(function(){this._v||(this._o.bound&&alp.aEL(document,"click",this._onClick),this._v=!0,this.draw(),alp.setClass(this.el,"alp-pika-is-hidden",!1),alp.m(this._o.onOpen,"call",this),this.openEvt().triggerSoon())}),hide:alp.nowF(function(){var a=this._v;!1!==a&&(this._o.bound&&alp.rEL(document,"click",this._onClick),this.el.style.cssText="",alp.setClass(this.el,"alp-pika-is-hidden",
!0),this._v=!1,void 0!==a&&(alp.m(this._o.onClose,"call",this),this.closeEvt().triggerSoon()))}),destroy:function(){this.hide();alp.rEL(this.el,"mousedown",this._onMouseDown,!0);alp.rEL(this.el,"change",this._onChange);this._o.field&&(alp.rEL(this._o.field,"change",this._onInputChange),this._o.bound&&(alp.rEL(this._o.field,"click",this._onInputClick),alp.rEL(this._o.field,"focus",this._onInputFocus),alp.rEL(this._o.field,"blur",this._onInputBlur)));this.el.parentNode&&this.el.parentNode.removeChild(this._topWrapNode||
this.el)}});var n={field:null,style:null,scrollContainerNode:null,clickNode:null,bound:void 0,dateTmpl:"{DD}.{MM}.{YYYY}",format:null,defaultDate:null,setDefaultDate:!1,firstDay:0,minDate:null,maxDate:null,yearRange:10,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,useRelativeDays:!1,isRTL:!1,numberOfMonths:1,i18n:null,onSelect:null,onOpen:null,onClose:null,top_wrap:null}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.abstract_snippets");
(function(){function k(g){var f=g.m.ntoload.get(),e=g.m.data.get().length;!g._xhr_loading&&f>e&&(g._xhr_loading=alp.xhrGet(g.xhrUrl(e,f),{receiveJson:!0})).then(function(d){delete g._xhr_loading;alp.now("receiveData",g,g,d);if(0===g.m.data.get().length&&g.m.nfull.get()&&Infinity!==g.m.nfull.get())throw Error("There should be data but there is none!");k(g)})}function h(g){for(var f=g.m.ndisplayed.get(),e=g.m.data.get(),d=Math.min(e.length,g.m.ntodisplay.get());f<d;f++){0<f&&g.separatorHTML&&alp.cE("div",
g.snippetSubContNode,{"class":g.separatorClass},{innerHTML:g.separatorHTML});var b=alp.cE("div",null,{"class":g.snippetClass},{innerHTML:e[f]});alp.aC(g.snippetSubContNode,g.postProcess?g.postProcess(b,g):b)}g.data2view&&g.callSuperThenMe("data2view",[g,g.m,g.kx,d]);g.m.ndisplayed.set(d)}alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.AbstractSnippets",alp.x.AbstractController,null,{contNode:null,proj:null,snippetCont:null,separatorTmpl:null,numberDisplay:null,zeroMsg:null,snippetClass:null,
separatorClass:null,initLength:10,step:10,buffer:3,postProcess:null,assertParam:null,xhrUrl:null,augmentModel:function(g){function f(e){return Math.min(e,g.nfull.get())}g.nfull=new alp.State;g.ntoload=new alp.State({constrain_all:f});g.data=new alp.SortedArrayState;g.ntodisplay=new alp.State({constrain_all:f});g.ndisplayed=new alp.State},setInitVal:function(g,f,e,d){g.proj.substring.a;g.callSuperThenMe("assertParam");g._bufferstep=g.buffer*g.step;e.ntoload.set(0);e.nfull.set(Infinity);e.data.set([]);
e.ntodisplay.set(0);e.ndisplayed.set(0);g.contNode.childNodes.a;(g.snippetContNode=alp.nodify(g.snippetCont,g.contNode)).childNodes.a;alp.empty(g.snippetContNode);delete g.snippetContNode.style.height;g.snippetSubContNode=alp.cE("div",g.snippetContNode);g.separatorHTML=alp.opt(alp.nodify(g.separatorTmpl,g.contNode),"innerHTML");g.numberDisplayNode=alp.nodify(g.numberDisplay,g.contNode);g.zeroMsgNode=alp.nodify(g.zeroMsg,g.contNode)},connectModel2Model:function(g,f,e,d){f.push(e.ntoload.change_cb_init(alp.bindF(k,
null,g)));f.push(e.nfull.change_cb_init(function(b){e.ntoload.set(e.ntoload.get());e.ntodisplay.set(Math.max(g.initLength,e.ntodisplay.get()))}));f.push(e.ntodisplay.change_cb_init(function(b){e.ntoload.set(Math.min(e.nfull.get(),b+g._bufferstep))}))},connectModel2View:function(g,f,e,d){f.push(e.data.change_cb_init(alp.bindF(h,null,g)));f.push(e.ntodisplay.change_cb_init(alp.bindF(h,null,g)));f.push(e.nfull.change_cb(function(b){g.numberDisplayNode&&alp.setText(g.numberDisplayNode,Infinity>b?b:"");
var c=g.zeroMsgNode;c=c&&(g._zeroMsg||(g._zeroMsg=alp.cE("div",null,null,{innerHTML:c.innerHTML})));var a=g.contNode;c&&(0===b?alp.isDescendant(c,a)||alp.place(c,a,"first"):c.parentNode&&alp.orphan(c))}))},connectPureView:function(g,f,e,d){f.push(setInterval(function(){var c=g.snippetSubContNode.offsetParent,a=b;(b=c)&&c!==a&&h(g)},357),clearInterval);var b},receiveData:null,data2view:null})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.abstract_more_snippets");
(function(){alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.AbstractMoreSnippets",alp.x.AbstractSnippets,null,{snippetCont:"alp-moresnippets-snippetcont",moreButton:"alp-moresnippets-more",separatorTmpl:"alp-moresnippets-separator-tmpl",numberDisplay:"alp-moresnippets-number",zeroMsg:"alp-moresnippets-zero-msg",snippetClass:"alp-moresnippets-snippet",separatorClass:"alp-moresnippets-separator",hiddenClass:oax.NO_DISPLAY,initLength:3,step:3,buffer:3,postProcess:null,connectView2Model:function(k,
h,g,f){function e(){g.ntodisplay.setNow(k.step+g.ntodisplay.get())}h.push(alp.aEL(k.moreButtonNode,"click",e));h.push(alp.aEL(k.moreButtonNode,"touchstart",e))},receiveData:function(k,h){var g=h.responseJson,f=g.nitems||0;k.m.nfull.set(f);if(f){if(h=g.first,g=g.html,f&&null!=h&&g&&g.length){f=g.length;for(var e=[].concat(k.m.data.get()),d=0;d<f;d++)e[h+d]=g[d];k.m.data.set(e)}}else k.m.data.set([])},assertParam:function(){(this.moreButtonNode=alp.nodify(this.moreButton,this.contNode)).childNodes.a},
data2view:function(k,h,g,f){alp.setClass(k.moreButtonNode,k.hiddenClass,f>=h.nfull.get());h=alp.gBCR(k.snippetSubContNode).height;0<h&&(k.snippetContNode.style.height=h+"px")}})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.more_snippets");
(function(){alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.MoreSnippets",alp.x.AbstractMoreSnippets,null,{id:null,prefix:null,assertParam:function(){this.id.substring.call.a;this.prefix.substring.call.a},xhrUrl:function(k,h){return alp.cfg.url.api_more_snippets(this.prefix,this.id,this.proj,k,h)}});alp.declare("alp.x.MoreSnippetsListSearch",alp.x.MoreSnippets,null,{id:"",prefix:"listSearch",q:"",cat:"",xhrUrl:function(k,h){return alp.cfg.url.api_more_snippets(this.prefix,escape(this.q),
this.proj,k,h)}})})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.scroll_to_node");
(function(){function k(f,e){f=alp.nodify(f);var d=e&&e.t_ms||800,b=e&&e.onfinish||null;if(g){if(g.to===f)return;clearTimeout(g.h)}g=null;e=alp.gBCR(f).top;if(0!==e){var c=window.innerHeight,a=c&&document.documentElement.scrollHeight;(a=0<a&&a-c-window.pageYOffset)&&alp.isFiniteNumber(a)&&0<a&&e>a&&(e=a);c=c&&Math.abs(e)/c||null;d=alp.isFiniteNumber(c)&&1>c?c*d:d;c=alp.body();alp.vStyle(c,{transition:alp.vendor(c,"transform",!0)+" "+d+"ms ease-in-out",transform:"translate3d(0,"+-e+"px,0)"});g={to:f,
h:setTimeout(function(){g=!1;alp.vStyle(alp.body(),{transition:"",transform:""});window.scroll(0,alp.gBCR(f).top+window.pageYOffset);b&&b()},d+75)}}}var h=alp.sub("alp.dom",null,!0);h.scrollToNode=k;h.scrollToNodeInstall=function(f){var e=f&&(f.eh||f.hg)||(alp.Eh?new alp.Eh:alp.hg());alp.forEach(alp.gEBCN(f&&f.className||"oax-scroll-to-node",f&&f.cont),function(d){function b(a){alp.stopEvent(a||window.event);a=(alp.gA(d,"href")||d.href).match(/^#(.*)$/)[1];a=alp.gEBI(a);k(a,f)}var c=alp.dataset(d);
c._oax_scroll_to_node_install||(c._oax_scroll_to_node_install=!0,e.push(alp.aELtouchup(d,b,!0)),e.push(alp.aEL(d,"click",b,!0)))});return e};var g})();"undefined"!==typeof dojo&&dojo.provide("oa.util.community");
(function(){function k(){return/^true$/i.test(alp.opt(alp.nodify(oa.LOGIN_INDICATOR),"value")||"")}var h=alp.sub("oa.util.community",null,!0);if(!h.generic_login_barrier_after){h.generic_login_barrier_after=function(b,c){function a(a){return(a=a&&alp.oGet(a,g))&&alp.oFrom(a)}b=b.type;(b||null).substring.call.a;var d=alp.sessionStorage(),f=a(d);f||(d=alp.localStorage(),f=a(d));if(f&&b===f.type&&alp.sEndsWith(document.referrer,f.referrer)&&(-1<location.href.indexOf(f.href)||f.isTourplanner)&&(delete d[g],
alp.sEndsWith(e,f.referrer)||f.data&&f.data.embed))return c(f.data)};h.generic_login_barrier_before=function(b){var c=alp.sessionStorage();if(c)if(b.type){var a={type:b.type,referrer:b.referrer||location.href.replace(location.hash,""),href:b.href||location.href.replace(location.hash,""),isTourplanner:!!b.isTourplanner};b.data&&(a.data=b.data);c[g]=alp.oToString(a);if(b=alp.sub("oam.LOGIN_NEXTURL_SESTOR"))c[b]=location.href}else c[g]&&delete c[g]};h.generic_login_barrier_to_dom=function(b,c){var a=
alp.sessionStorage(),d=alp.localStorage();a=a?a[g]:null;c&&a&&(a=a.replace(/"referrer":"[^"]+",/,'"referrer":"",'),alp.cE("input",c,{type:"hidden",name:g,value:a}),b&&d&&(d[g]=a))};h.generic_login_barrier_fb_registration_fix_referrer=function(){var b=alp.sessionStorage(),c=b?b[g]:null;if(c=c&&alp.oFrom(c))c.referrer=location.href.replace(location.hash,""),b[g]=alp.oToString(c)};h.show_exception_msg=function(b,c){c=c||alp.body();var a={};try{var d=alp.nodify("oax-"+b.msgCode)}catch(n){console.error(n)}if(d){var e=
d.innerHTML;var f=d.dataset.target&&alp.nodify(d.dataset.target,c)}e||(e=b.message||b.msgCode);!f&&b.invalidField&&(f="object"===typeof b.invalidField?b.invalidField:alp.nodify("oax-"+b.invalidField,c));f||(f=alp.nodify("oax-exception-field",c));f?(alp.setClass(f,"oax_error",!0),alp.humane.timeout=Infinity,a={extraClass:"oax_error_msg",target:f}):(alp.humane.timeout=4E3,a={extraClass:"oax-validation-error"});e&&setTimeout(function(){alp.humane(e,a)},0)};h.get_user_id=function(){return k()&&alp.opt(alp.gEBI(oa.LOGIN_USERID),
"value")||!1};h.login_indicator=k;h.session_expiration_dfrd=alp.memF(alp.nowF(function(){var b=alp.dfrd("OUC.session_expiration_dfrd",{then:1}),c=1E3*oa._MAX_INACTIVE_INTERVAL;if(0<c){var a=+d+c,e=a-new Date;a=new Date(a);var f=alp.date2str(a,"{hh}:{mm}");c={begin_date:d,duration_ms:c,end_date:a,end_hhmm:f};alp.asyncF(Math.max(0,e-3E5),alp.nowF("triggerSoon",b))(c)}return b}));h.session_expiration_view=function(b){var c=alp.nodify(b).innerHTML;(c||null).substring.call.a;return h.session_expiration_dfrd().then(function(a){alert(alp.tmplJs(c,
a))})};var g="_glogb_after";if(!oa._glogb_done){oa._glogb_done=!0;var f=alp.sessionStorage();if(f){var e=f._glogb_lastu||"";f._glogb_lastu=location.href.replace(location.hash,"")}}var d=new Date}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.dfrd");(function(){alp.sub("oa.util",null,!0).to=function(k,h){alp.m(k,["to","then"],h)}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.spinner");
(function(){function k(g,f){var e=alp.f();g.m.setTarget?e=function(d){g.m.setTarget(d).startWait()}:g.m.create_wrapper&&(g.node=g.m.create_wrapper(),e=function(d){function b(){alp.aC(d||alp.body(),g.node)}alp.opt(f,"setTimeout")?g.timeout||(g.timeout=setTimeout(b,"number"===typeof f.setTimeout?f.setTimeout:678)):b()});return e}function h(g){var f=alp.f();g.m.setTarget?f=function(){g.m.stopWait().setTarget(null)}:g.m.create_wrapper&&(f=function(e){g.timeout&&(clearTimeout(g.timeout),delete g.timeout);
g.node&&alp.orphan(g.node)});return f}alp.sub("oa.util.spinner",null,!0).create_spinner=function(g){var f={};if(alp.x.Waitbox){var e={};var d=alp.opt(g,"setTimeout");"number"===typeof d?e.delay_ms=d:"boolean"!==typeof d||d||(e.delay_ms=0);f.m=new alp.x.Waitbox(e)}else alp.x2.spinner&&(f.m=alp.x2.spinner);return{startWait:k(f,g),stopWait:h(f)}}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.async_form");
(function(){var k=alp.sub("oa.util.asyncForm",null,!0),h=oa.util,g=h.community,f=h.spinner,e;h.to(alp.i18n.fetch("alp.all"),function(d){e=d});k.submit=function(d,b,c,a){function k(a){function b(a){alp.humane.forceNew=!1;c=a.dataset.msg||f;alp.dom.scrollToNode(a);g.show_exception_msg({invalidField:a,message:c})}var c,d=alp.gEBCN("oax-required",a),f=alp.opt(e,"required.defaultMessage")||"Required field";for(a=0;a<d.length;a++){var l=d[a];if(alp.hA(l,"required")){if(!l.validity.valid)return b(l),!1}else if("children"===
l.dataset.valid){var h=alp.reduce(alp.gEBTN("input",l),"v && w.validity.valid",!0);if(!h)return b(l),!1}else if("true"!==l.dataset.valid)return b(l),!1}return!0}function l(a){var b=a.responseJson;if(b)"ok"==b.status?c(b,u):(u.stopWait(),alp.setClass(alp.gEBTN(p,r),oa.ERROR,!1),g.show_exception_msg(b,q||alp.body()));else throw u.stopWait(),b="There was a server error while processing the request!\nStatus:"+a.status+"\nResponse"+a.response,console.error(b,a),Error(b,a);}var r=d.tagName?d:d.form,n=d.tagName?
d:d.cont,q=d.tagName?d:d.errorCont||d.cont,p=alp.gEBTN("input",r);d=alp.gEBTN("select",r);var v=alp.gEBCN("oax-required",r);(a||(a=window.event))&&alp.stopEvent(a);alp.humane.remove();alp.setClass(p,oa.ERROR,!1);alp.setClass(d,oa.ERROR,!1);alp.setClass(v,oa.ERROR,!1);if("function"!==typeof b||b(r))if(!b||k(r)){b=r.action;a=alp.reduce(alp.map(alp.filter(r.elements,"!!v.name"),'v.type !== "radio" || v.checked ? encodeURIComponent(v.name) + "=" + encodeURIComponent(v.type === "checkbox" ? v.checked : v.value) : "" '),
'w ? (v + w + "&") : v',"");var u=f.create_spinner({timeout:!0});d=!1;b&&a?(u.startWait(n),h.to(alp.xhrPost(b,{sendData:a+"async=true",throwError:!1,sendJson:!1,receiveJson:!0,header:{"Content-Type":"application/x-www-form-urlencoded"}}),l),d=!0):(console.error(null,"Url unknown or data invalid!"),d=!1);return d}}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.sestor");
(function(){function k(e){if(e=e&&"storage"in e?e.storage:alp.sessionStorage())return alp.filter((e[f]||"").split(","),"")}function h(e,d){return(d=d&&"storage"in d?d.storage:alp.sessionStorage())?(d[f]="string"===typeof e?e:e.join(","),!0):!1}var g=alp.sub("oa.util.sestor",0,1);g.last_visited_get=k;g.last_visited_push=function(e,d){var b=k(d);if(b)return b=alp.filter(b,'!=="'+e+'"'),b.unshift(e),h(b,d)};g.last_visited_set=h;g.profile_saved_alert_apply=function(){if(alp.cookie(oa.PROFILE_SAVED_SESTOR)){alp.cookie(oa.PROFILE_SAVED_SESTOR,
"",{path:"/",expires:-1});var e=alp.opt(alp.nodify(oa.PROFILE_SAVED_SESTOR),"innerHTML")||"Profile saved successfully.";(alp.humane||alert)(e)}};g.profile_saved_alert_mark=function(){alp.cookie(oa.PROFILE_SAVED_SESTOR,1,{path:"/",expires:1600/86400})};g.save_back2id=function(e,d){var b=alp.sessionStorage();if(b){var c=oa.BACK2DETAILPAGE_SESTOR;(c||0).substring.call.a;var a=alp.oFrom(b[c])||{};a[e]={id:d.back2id,title:d.back2title,frontendtype:d.back2frontendtype};b[c]=alp.oToString(a)}};var f="oa_last_visited"})();
"undefined"!==typeof dojo&&dojo.provide("oa.util.multistep_dialog_helper");
(function(){function k(f){this.cont=f.cont;this.nodes=alp.gEBCN("oax-multistep-dialog-href",this.cont);this.back=alp.gEBCN("oax-multistep-dialog-back",this.cont);this.viewsArr=alp.gEBCN("oax-multistep-dialog-view",this.cont);this.viewsMap=alp.reduce(this.viewsArr,"(v[w.id] = w, v)",{});this.mainView=alp.nodify("oax-multistep-dialog-main",this.cont).id;this.hist=g.state([this.mainView]);this.prevView=null}var h=alp.sub("oa.util.MultistepDialogHelper",null,!0),g=alp.i.state;h.init_steps=g.nowF(function(f,
e){var d=new k({cont:e});alp.setClass(d.cont,"oax-multistep-dialog",!0);alp.setClass(d.viewsArr,oa.NO_DISPLAY,!0);alp.setClass(d.viewsMap[d.mainView],oa.NO_DISPLAY,!1);alp.forEach(d.nodes,function(b){alp.aEL(b,"click",alp.stopEvent);alp.aELtouchup(b,function(b){b=b||window.event;b=b.currentTarget.href.split("#")[1];d.show_view(b)})});alp.forEach(d.back,function(b){alp.aEL(b,"click",alp.stopEvent);alp.aELtouchup(b,alp.bindF("view_back",d))});g.chen(d.hist,alp.bindF(function(){var b=this.hist.get(),
c=this.viewsMap[b[b.length-1]];alp.setClass(this.viewsMap[this.prevView||b[b.length-2]],oa.NO_DISPLAY,!0);alp.setClass(c,oa.NO_DISPLAY,!1);c.scrollTop=0;(b=alp.filter(alp.gEBTN("input",c),'alp.hA( v, "autofocus" )'))&&b.length&&b[0].focus();this.prevView=null},d));return d});k.prototype={get_main_view:function(){return this.viewsMap[this.mainView]},get_cur_view:function(){var f=this.hist.get();return this.viewsMap[f[f.length-1]]},show_view:function(f){if(f){var e=this.hist.get();g.setNow(this.hist,
e.concat(f))}else console.error("The target view does not exist")},view_back:function(){var f=this.hist.get();this.prevView=f[f.length-1];g.setNow(this.hist,f.splice(0,f.length-1))},view_reset:function(){var f=this.hist.get();this.prevView=f[f.length-1];g.setNow(this.hist,[this.mainView])}}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.init_from_url_hash");
(function(){function k(e,d){var b=e instanceof RegExp;b||(e||null).substring.call.a;e=b?e:new RegExp("(?:^|&)"+e+"=([^&]+)");(d=location.hash.substring(1).match(e)||d&&d.fallback_url_search&&location.search.substring(1).match(e))&&(d=alp.map(d,f.decodeURIComponent));return b?d:alp.opt(d,1)||null}function h(e,d){return e?alp.opt(h(null,d),e)||null:(e=k(oa.URL_HASH_FILTER||"filter",d))&&alp.arr2o(alp.filter(e.split(","),""),alp.f(".match(/^(\\w+-\\w+)-/)[1]"),alp.f('alp.map( v.replace(/^(\\w+-\\w+)-/,"").match(/\\d+/g), "|0" )'))}
var g=alp.sub("oa.util",null,!0),f=alp.util.url_hash;g.init_from_url_hash=k;g.init_from_url_hash_filter=h})();"undefined"!==typeof dojo&&dojo.provide("oa.util.init_tab_click_tracking");
(function(){function k(e){k._last=f.triggerClick(e)}var h=alp.sub("oa.util",null,!0),g=oa.URL_HASH_DETAILPAGE_DETAILTAB,f=alp.dom;h.init_from_tab_hash=function(e){var d=h.init_from_url_hash(g);if(d){var b=alp.gEBI(d);e=b&&alp.qS('label[for="'+d+'"]',e.topCont);b&&e&&(k(e),k(b))}};h.init_tab_click_handler=function(e,d){var b=alp.gEBCN(oa.TAB_CB,e.topCont);alp.forEach(b,function(a){function b(a){a||(a=window.event);(e.flexOpener||e._.flexOpener).writeOnly(e.flexOpenerPage||e,g,f);a!==k._last&&(b._last=
a,(a=h&&alp.textContent(h))&&c!==a&&e.tabClickEvt&&(c=a,e.tabClickEvt().triggerSoon({title:a})))}var f=a.id;if(f){var h=alp.qS('label[for="'+f+'"]',e.topCont);d.push(alp.aEL([a].concat(h?[h]:[]),"click",alp.nowF(b)))}});var c};h.get_current_tab=function(){return h.init_from_url_hash(g)}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.login");
(function(){function k(a){var c=alp.asyncSeq(),e=oa.LOGIN_DIALOG,f=alp.gEBCN(oa.LOGIN_BUTTON)[0],g,l=a&&a.opt_user_info,k=l&&l.isTemporary&&l.temp_accountid;f&&(f.href="#"+f.href);c.next(function(a){if(g=alp.gEBI(e))a();else{var b=alp.tmpl(oa.COMMUNITY_LOGIN_DIALOG_MARKUP_JSONP_URL_TMPL,{plugintype:oa.PLUGINTYPE});d.to(alp.jsonp(b,{cache:!0}),function(c){c=c.answer;if("ok"!==c.status)throw Error("login dialog got an error status:"+c.status+", code:"+c.code+" while fetching markup from URL: "+b);c=
alp.cE("div",alp.body(),{"class":oa.NO_DISPLAY,style:"display: none"},{innerHTML:c.html});g=alp.gEBI(e,c);a()})}}).next(function(c){m.open({html:alp.tmplJs(g.innerHTML),title:a?a.title:"",extraClass:"oax_login_dialog",onOpenNow:function(d){h({container:d,hash:a?a.hash:!1});b.generic_login_barrier_before(alp.opt(a||{},["type","data"],!0));if(a){var e=alp.gEBCN("oax-login-dynamicRedirect",d),f=alp.nodify("oax-fb-login-form",d);a.dynamicRedirect&&alp.forEach(e,function(b){b.value=a.dynamicRedirect});
a.context&&"default"!=a.context&&(alp.setClass(alp.gEBCN("oax-loginHeader",d),oa.NO_DISPLAY,!0),alp.setClass(alp.gEBCN("oax-loginHeader-"+a.context,d),oa.NO_DISPLAY,!1),alp.forEach(e,function(a){a.value="true"}));f&&b.generic_login_barrier_to_dom(!0,f);if(a.tourid&&a.token){e=alp.gEBTN("form",d);f=alp.sessionStorage();alp.nodify("oax-register-link");var g={type:a.type||"oax-tourplanner",isTourplanner:!0};alp.forEach(e,function(b){var c=alp.cE("input",b,{"class":"oax-takeover-content",type:"hidden",
name:"oax-takeover-content"});c.value=a.tourid;c=alp.cE("input",b,{"class":"oax-token",type:"hidden",name:"oax-token"});c.value=a.token;k&&alp.cE("input",b,{"class":"oax-evaluate-account",type:"hidden",name:"oax-evaluate-account"},{value:k});alp.aEL(b,"submit",alp.dom.windowExitInterceptClearAll);alp.aEL(alp.gEBCN("oax-tourplanner-nowarn",d),"click",alp.dom.windowExitInterceptClearAll)});b.generic_login_barrier_before(g);f&&(f["oax-tourplanner"]=alp.oToString({"oax-takeover-content":a.tourid,"oax-token":a.token}))}}c()},
onCloseLater:a&&a.onClose})})}function h(b){function d(a,c){if(c=alp.sessionStorage())c[oa.LAST_LOGIN_URL]=location.href;window.location.href=alp.opt(b,"hash")?a.redirect.replace(/([\?#].*?)?$/,"?"+ +new Date+"#"+oa.URL_HASH_DETAILPAGE_DETAILTAB+"="+oa.util.get_current_tab()):a.redirect}var e=b&&b.container||alp.nodify("oax-login-container"),l=alp.nodify("oax-login-form",e),h=e&&alp.nodify("oax-login-button",l),k=e&&alp.nodify("oax-email-input",l);if(e&&(g(e),c.init_steps(e),alp.humane.forceNew=!1,
k&&h)){alp.aEL(k,"input change",function(){alp.setClass(h,"oax_disabled",!k.validity.valid)});alp.setClass(h,"oax_disabled",!k.validity.valid);var m=alp.bindF(a.submit,null,l,null,d);alp.aEL(l,"keyup",function(a){a.keyCode===alp.key.ENTER&&k.validity.valid&&m(a)});f(h,m)}}function g(a){var b=alp.nodify("oax-toggle-pw",a);b&&f(b,function(b){return alp.util.pw_toggle(b,a)})}function f(a,b){alp.aEL(a,"click",alp.stopEvent);return alp.aELtouchup(a,b)}var e=alp.sub("oa.util.login",null,!0),d=oa.util,b=
oa.util.community,c=d.MultistepDialogHelper,a=oa.util.asyncForm,m=alp.view.modalwin;e.install=function(a){var b=alp.Eh?a&&a.eh||new alp.Eh:a&&a.hg||alp.hg(),c=alp.gEBCN(oa.LOGIN_BUTTON);c&&(c.href="#"+c.href,b.push(f(c,function(b){b||(b=window.event);alp.stopEvent(b);k(a)})));return b};e.open_login=k;e.async_submit_install=h;e.pwToggle_install=g;e.pwConfirm_install=function(a){a=a&&a.container||alp.nodify("oax-login-container");var b=alp.nodify("oax-login-form",a),c=a&&alp.nodify("oax-login-button",
b),d=a&&alp.nodify("oax-pw-input",b);g(a);c&&(alp.aEL(d,"input change",function(){alp.setClass(c,"oax_disabled",!d.validity.valid)}),alp.setClass(c,"oax_disabled",!d.validity.valid))}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.account");
(function(){function k(d,b){alp.aEL(d,"click",alp.stopEvent);return alp.aELtouchup(d,b)}var h=alp.sub("oa.util.account",null,!0),g=oa.util.community,f=oa.util.login,e=oa.util.asyncForm;h.edit_email_install=function(){function d(){var a=alp.nodify("oax-email-input"),b=!0;a&&!a.checkValidity()&&(g.show_exception_msg({msgCode:"emailMandatory"}),b=!1);return b}function b(a,b){b.stopWait();window.location.href=a.redirect}alp.humane.forceNew=!1;var c=alp.nodify("oax-change-email-submit"),a=alp.nodify("oax-change-email-form");
if(c){var f=alp.bindF(e.submit,null,a,d,b);alp.aEL(a,"keyup",function(a){a.keyCode===alp.key.ENTER&&f(a)});k(c,f)}};h.edit_pw_install=function(){function d(){var a=alp.nodify("oax-oldpwd"),b=alp.nodify("oax-pw-input"),c=!0;a&&!a.checkValidity()&&(g.show_exception_msg({msgCode:"oldpw-empty"}),c=!1);c&&b&&!b.checkValidity()&&(g.show_exception_msg({msgCode:"pw-too-short"}),c=!1);return c}function b(b,c){c.stopWait();a.reset();alp.humane.timeout=4E3;alp.humane(alp.nodify("oax-pwChange-success").innerHTML,
{extraClass:"oax-humane-success"})}f.pwToggle_install();alp.humane.forceNew=!1;var c=alp.nodify("oax-change-pw-submit"),a=alp.nodify("oax-change-pw-form"),h=alp.gEBI("oax-pwd-check");h&&alp.aEL(h,"keyup",alp.bindF(alp.util.pw_check,null,h));if(c){var l=alp.bindF(e.submit,null,a,d,b);alp.aEL(a,"keyup",function(a){a.keyCode===alp.key.ENTER&&l(a)});k(c,l)}}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.braintree");
(function(){function k(b,a){var c=alp.sHash(b);if(alp.gEBI(c))a();else{c=alp.cE("div",null,{id:c});b=alp.cE("script",c,{type:"text/javascript",src:b});var d=alp.body();alp.aEL(b,"load readystatechange",a);d.appendChild(c)}}function h(b){var a;b.authorizationNode?a=b.authorizationNode.value:b.authorizationToken?a=b.authorizationToken:console.error("Implement AJAX support");return a}function g(c,a){if(c){console.error(c.type+": "+c.msgCode+"\n"+c.message);var d={};"CUSTOMER"!==c.type?d={msgCode:"braintree-"+
c.type.toLowerCase(),message:c.message}:"THREEDS_VERIFICATION_FAILED"===c.msgCode&&(d={msgCode:"braintree-"+c.msgCode.toLowerCase(),message:c.message});b.show_exception_msg(d,a);return!1}return!0}var f,e=alp.sub("oa.util.braintree",null,!0),d=oa.util,b=d.community;d.to(alp.i18n.fetch("alp.all"),function(b){f=b});e.initBraintree=function(b){var a=alp.asyncSeq(),c={},d=alp.dfrd("oa.util.braintree",{then:1});c.authorization=h(b);a.next(alp.bindF(k,null,"https://js.braintreegateway.com/web/3.26.0/js/client.min.js"));
b.credit&&a.next(alp.bindF(k,null,"https://js.braintreegateway.com/web/3.26.0/js/hosted-fields.min.js"));b.threeDSecure&&a.next(alp.bindF(k,null,"https://js.braintreegateway.com/web/3.26.0/js/three-d-secure.min.js"));b.paypal&&a.next(alp.bindF(k,null,"https://js.braintreegateway.com/web/3.26.0/js/paypal.min.js")).next(alp.bindF(k,null,"https://js.braintreegateway.com/web/3.26.0/js/data-collector.min.js"));a.next(function(a){function d(d,e,f){g(e)?(c[d]=f,"undefined"===typeof c.credit&&b.credit||"undefined"===
typeof c.threeDSecure&&b.threeDSecure||"undefined"===typeof c.paypal&&b.paypal||"undefined"===typeof c.dataCollector&&b.paypal||a()):c[d]=null}braintree.client.create({authorization:c.authorization},function(c,e){if(g(c)){c={input:{"font-size":"16px","font-family":"Alto, Helvetica, Arial, sans-serif"},"input.invalid":{color:"#C51718"}};var l={number:{selector:"#card-number",placeholder:alp.opt(f,"placeholder.creditNumber")||"please enter your card number"},cvv:{selector:"#cvv",placeholder:alp.opt(f,
"placeholder.creditCvv")||"please enter your security code"},expirationDate:{selector:"#expiration-date",placeholder:alp.opt(f,"placeholder.creditExpiration")||"MM/YYYY"}};b.paypal&&(braintree.dataCollector.create({client:e,paypal:!0},alp.bindF(d,null,"dataCollector")),braintree.paypal.create({client:e},alp.bindF(d,null,"paypal")));b.credit&&braintree.hostedFields.create({client:e,styles:c,fields:l},alp.bindF(d,null,"credit"));b.threeDSecure&&braintree.threeDSecure.create({client:e},alp.bindF(d,null,
"threeDSecure"))}else a()})}).next(alp.nowF(function(){var a=1===arguments.length?arguments[0]:arguments[1];alp.m(d,["done","triggerSoon"],c);a()}));return d};e.handleError=g})();"undefined"!==typeof dojo&&dojo.provide("oa.util.payment");
(function(){function k(a,b){b||(b=window.event);alp.stopEvent(b);var c=(b.currentTarget||b.srcElement).parentNode.parentNode;b=alp.nodify("oax-hidden-payment-item-dialog");var d=alp.nodify("oax-payment-item-type",c),e={};alp.forEach(["title","id"],function(a){var b=alp.nodify("oax-payment-item-"+a,c);b&&(this[a]="INPUT"===b.tagName?b.value:b.innerHTML)},e);e.detail=alp.filter(alp.map("price id lastMod state validTo next place".split(" "),function(a){a=alp.nodify("oax-payment-item-"+a,c);var b=null;
a&&(b=[a.dataset.title,"INPUT"===a.tagName?a.value:a.dataset.value||a.innerHTML]);return b}),"v != null");r.open({html:alp.tmplJs(b.innerHTML,e),extraClass:"oax_payments_dialog",onOpenNow:function(b,c,e){d&&"4"!==d.value&&(c=alp.gEBCN("oax-subscriptionOnly"),alp.orphan(c));if(b=alp.nodify(a.terminateSubscriptionBtnClass,b))a._mowi=e,alp.aELtouchup(b,alp.bindF(g,null,"subscription",a))}})}function h(a){function e(c){c||(c=window.event);alp.stopEvent(c);var e=c.currentTarget.dataset.id;c=alp.hasClass(f.nextSibling,
a.currencyChangeDialog)?f.nextSibling:alp.nodify(a.currencyChangeDialog);r.open({html:alp.tmplJs(c.innerHTML),extraClass:"oax_purchase_dialog"+(alp.likeMobile()?" oam":""),onOpenNow:function(c){function f(d,e,f){b.handleError(e)&&("undefined"===typeof f.liabilityShifted||f.liabilityShifted?(alp.humane.remove(),e=alp.gEBCN(oa.ERROR,c),e.length&&alp.setClass(e,oa.ERROR,!1),d=alp.nodify(d,c),alp.nodify(a.paymentNonce,d).value=f.nonce,l.submit({form:d,cont:c},null,g)):b.handleError({type:"CUSTOMER",msgCode:"THREEDS_VERIFICATION_FAILED",
message:"3D Secure Verification failed"}))}function g(a){location.href=a.redirect}alp.humane.timeout=Infinity;alp.humane.forceNew=!1;var k=alp.gEBI(a.dialogCredit,c),n=alp.nodify(a.dialogCreditBtn,k),p=alp.gEBI(a.dialogPaypal,c),q=alp.nodify(a.dialogPaypalBtn,p);p=alp.gEBCN(a.paymentToken,c);var r=alp.asyncSeq();h.startWait(c);r.next(function(e){function g(d,e){function g(d,g){function l(b,c){alp.aC(m,c);v.show_view(a.dialogThreeDS);h.stopWait()}function k(){alp.orphan(m.children);v.show_view(alp.nodify(a.dialogCreditForm,
c).id);h.startWait(c)}if(b.handleError(d)){var m=alp.gEBI(a.dialogThreeDS,c)[0];h.startWait(c);a.is3DSecure?e.verifyCard({amount:1,nonce:g.nonce,addFrame:l,removeFrame:k},alp.bindF(f,null,a.dialogCreditForm)):f(a.dialogCreditForm,d,g)}}var l=!1;d.on("validityChange",function(a){var b=!0;alp.forIn(a.fields,function(a){b=b&&a.isValid});alp.setClass(n,oa.DISABLED,!(l=b));alp.setClass(alp.nodify("oax-"+a.emittedBy+"-exception",c),"humane-show",!a.fields[a.emittedBy].isPotentiallyValid)});d.on("inputSubmitRequest",
function(){l&&n.click()});d.on("cardTypeChange",function(a){console.log(a)});alp.aEL(n,"click",function(){d.tokenize(g)},!1)}var l=alp.gEBI(a.braintreeToken,c),k=alp.nodify(a.is3DSecure,c);a.is3DSecure=!!k&&"true"===k.value;d.to(b.initBraintree({authorizationNode:l,paypal:!0,credit:!0,threeDSecure:a.is3DSecure}),function(b){a.components=b;b.credit&&g(b.credit,b.threeDSecure);b.paypal&&alp.aEL(q,"click",alp.bindF("tokenize",b.paypal,{flow:"vault"},alp.bindF(f,null,a.dialogPaypalForm)),!1);e()});l&&
alp.orphan(l);alp.view.tooltip({select:alp.nodify(a.tooltip),extract:alp.nodify(a.tooltipCont),className:a.tooltipStyle})});e?(alp.sA(p,"value",e),alp.setClass(alp.gEBCN(a.backBtn,c),oa.NO_DISPLAY,!0),alp.setClass(alp.nodify(a.editCardInfo,c),oa.NO_DISPLAY,!0),alp.setClass(alp.nodify(a.changeCardInfo,c),oa.NO_DISPLAY,!1),alp.setClass(k,a.mainViewClass,!0)):alp.setClass(alp.gEBI(a.dialogMain,c),a.mainViewClass,!0);var v=m.init_steps(c);r.next(function(a){h.stopWait();a()})},onCloseLater:function(b){alp.humane.remove();
alp.forIn(a.components,"v && v.teardown && v.teardown()");delete a.components}})}var f=alp.nodify("oax-currencyType-change"),g=alp.gEBCN("oax-edit-payment"),h=c.create_spinner();f&&alp.aELtouchup(f,e);g.length&&alp.aELtouchup(g,e)}function g(b,d,e){function g(b){var c=alp.nodify("oax-terminate-now",b);alp.aELtouchup(c,function(){h.startWait(b);var c=k.value||alp.textContent(k);(c||null).substr.call.a;c={i:c,terminate:!0,async:!0,nextURL:alp.nodify("oax-next-url",b).value};c=alp.map(alp.o2arr(c),'v[0] + "=" + encodeURIComponent( v[1] )').join("&");
c=alp.xhrGet("/de/pay.subscription.ctrl?"+c,{throwError:!1,sendJson:!1,receiveJson:!0});a.to(c,l)});d._mowi&&(d._mowi.close(),delete d._mowi)}function l(a){h.stopWait();200===a.status&&(a=a.responseJson,"ok"===a.status?location.href=a.redirect:console.error(a))}e||(e=window.event);alp.stopEvent(e);var h=c.create_spinner(),k=alp.nodify(d.pContentIdClass,(e.currentTarget||e.srcElement).parentNode.parentNode);e=alp.nodify(d.terminateAboModalTmplClass);b={title:alp.opt(f,"terminate."+b+".title")||"terminate."+
b+".title",info:alp.opt(f,"terminate."+b+".info")||"terminate."+b+".info"};e&&r.open({html:alp.tmplJs(e.innerHTML,b),extraClass:d.terminateAboModalClass,onOpenNow:g})}var f,e=alp.sub("oa.util.payment",null,!0),d=oa.util,b=d.braintree,c=d.spinner,a=oa.util,m=d.MultistepDialogHelper,l=d.asyncForm,r=alp.view.modalwin;alp.i.state.to(alp.i18n.fetch("alp.all"),function(a){f=a});e.install=function(a){a=alp.mix({upgradeProBtnClass:"oax-upgrade-btn-pro",downgradeProBtnClass:"oax-downgrade-btn-pro",terminateMembershipBtnClass:"oax-payment-item-terminate-membership",
terminateSubscriptionBtnClass:"oax-payment-item-terminate-subscription",terminateAboModalTmplClass:"oax-terminate-abo-dialog-tmpl",terminateAboModalClass:"oax_terminate_abo_dialog",pRecordIdClass:"oax-payment-item-id",pContentIdClass:"oax-payment-content-id",currencyChangeDialog:"oax-hidden-currency-change-dialog",braintreeToken:"oax-braintree-token",is3DSecure:"oax-is-3dsecure",paymentNonce:"oax-payment-nonce",paymentToken:"oax-payment-token",mainViewClass:"oax-multistep-dialog-main",backBtn:"oax-multistep-dialog-back",
editCardInfo:"oax-edit-card-info",changeCardInfo:"oax-change-card-info",dialogMain:"oax-dialog-main",dialogCredit:"oax-purchase-credit",dialogCreditForm:"oax-credit-form",dialogCreditBtn:"oax-purchase-credit-btn",dialogThreeDS:"oax-purchase-threeDSecure",dialogPaypalForm:"oax-paypal-form",dialogPaypal:"oax-purchase-paypal",dialogPaypalBtn:"oax-purchase-paypal-btn",tooltip:"oax-tooltip",tooltipCont:"oax-tooltip-content",tooltipStyle:"oax_tooltip_content"},a);var b=alp.gEBCN("oax-payment-item-details");
b.length&&alp.aELtouchup(b,alp.bindF(k,null,a));h(a);b=alp.gEBCN(a.terminateSubscriptionBtnClass);b.length&&alp.aELtouchup(b,alp.bindF(g,null,"subscription",a));b=alp.gEBCN(a.terminateMembershipBtnClass);b.length&&alp.aELtouchup(b,alp.bindF(g,null,"membership",a));if(b=alp.gEBCN(a.downgradeProBtnClass)[0]){var c=alp.likeMobile()?oam.x.PurchaseBtn:oax.x.PurchaseBtn,d=alp.gA(b,"data-id");new c({node:b,proj:a.proj||"outdooractive",contentid:d,purchaseType:"membership",purchaseLoadingIndicatorTarget:alp.body(),
initNow:!0})}}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.cont_select");
(function(){alp.sub("oa.util",null,!0).contSelectInstall=function(k){function h(){var d=alp.nodify(g.selectedClass,g.cont);alp.setClass(d,g.selectedClass,!1);alp.setClass(e[f.selectedIndex],g.selectedClass,!0)}var g=alp.mix({cont:"oax-content-select-cont",selectClass:"oax-content-select",optionClass:"oax-content-select-option",selectedClass:"oax-content-select-selected"},k);"string"===typeof g.cont&&(g.cont=alp.nodify(g.cont));if(g.cont){var f=alp.nodify(g.selectClass,g.cont),e=alp.gEBCN(g.optionClass,
g.cont);alp.aEL(f,"change",h);g.lazyload&&"function"===typeof g.lazyload&&g.lazyload()}}})();"undefined"!==typeof dojo&&dojo.provide("oa.x.teamactivity");
(function(){function k(a){a||(a={});var b=alp.mix({id:null,cont:null,proj:null,tokenDfrd:alp.dfrd("receive:token",{then:1})},a);w.to(t.token(),function(a){b.token=a;b.tokenDfrd.done(a)});return b}function h(a){function b(b){if(b=alp.gEBI(b,a.cont))b.checked=!0,alp.dom.scrollToNode(b.nextElementSibling)}var c=alp.gEBCN("oax-open-tab",a.cont);alp.forEach(c,function(a){var c=/\boax-tab-name-(\S+)\b/.exec(a.className)[1];c&&alp.aELtouchup(a,alp.bindF(b,null,"oax-"+c))})}function g(a){function b(a){a&&
alp.stopEvent(a);A.login_indicator()?d&&d.length&&(a=alp.cfg.url.api_teamactivity_participate({ooiid:c.id,proj:c.proj,token:c.token,action:"request"}),w.to(alp.xhrPost(a),function(a){a&&200===a.status&&window.location.reload()})):(a={type:e},A.generic_login_barrier_before(a),C.open_login(a))}var c=alp.mix({requestBtn:"oax-ta-request-btn"},a),d=alp.gEBCN(c.requestBtn,c.cont),e="ta:join:"+c.id;d&&d.length&&alp.aELtouchup(d,b);A.generic_login_barrier_after({type:e},b)}function f(a){function b(a){a&&
alp.stopEvent(a);if(!A.login_indicator())a={type:g},A.generic_login_barrier_before(a),C.open_login(a);else if(f&&f.length&&(a||!l.get())){var b=c(e);w.to(alp.xhrPut(b[0]),function(a){a&&200===a.status&&w.setNow(l,b[1])})}}function c(a){a={ooiid:a.id,proj:a.proj,token:a.token};return l.get()?[alp.cfg.url.api_teamactivity_unwatch(a),!1]:[alp.cfg.url.api_teamactivity_watch(a),!0]}function d(){var a=l.get();alp.forEach(f,function(b){var c=alp.nodify("oax-ta-watch",b);b=alp.nodify("oax-ta-unwatch",b);
alp.setClass(c,oa.NO_DISPLAY,a);alp.setClass(b,oa.NO_DISPLAY,!a)})}var e=alp.mix({watchBtn:"oax-ta-watch-btn"},a),f=alp.gEBCN(e.watchBtn,e.cont),g="ta:watch:"+e.id,l=w.boolState();f&&f.length&&(l=w.boolState(alp.hasClass(alp.nodify("oax-ta-watch",f[0]),oa.NO_DISPLAY)),w.chen(l,d),alp.aELtouchup(f,b));A.generic_login_barrier_after({type:g},b)}function e(a){a=alp.mix({evtTarget:"oax-ta-accept-request",action:"accept",get_userid:q},a);n(a)}function d(a){a=alp.mix({modalBtnClass:"oax-ta-reject-request-modalwin",
modalTmplClass:"oax-ta-reject-request-tmpl",modalExtraClass:"oax-ta-reject-request-modal",modalHandler:function(a,b){var c=alp.mix({evtTarget:"oax-ta-reject-request",action:"reject",get_userid:alp.bindF(q,null,b),get_remark:function(){var a=alp.nodify("oax-ta-reject-request-remark",c.cont);return a?encodeURIComponent(a.value):""}},a);n(c)}},a);r(a)}function b(a){a=alp.mix({modalBtnClass:"oax-ta-accept-invite-modal",modalTmplClass:"oax-ta-confirm-tmpl",modalExtraClass:"oax-ta-confirm-modal",modalHandler:c},
a);r(a)}function c(a){a=alp.mix({evtTarget:"oax-ta-accept-invite",action:"accept"},a);n(a)}function a(a){a=alp.mix({modalBtnClass:"oax-ta-reject-invite-modal",modalTmplClass:"oax-ta-confirm-tmpl",modalExtraClass:"oax-ta-confirm-modal",modalHandler:m},a);r(a)}function m(a){a=alp.mix({evtTarget:"oax-ta-reject-invite",action:"reject"},a);n(a)}function l(a){a=alp.mix({modalBtnClass:"oax-cancel-team-activity",modalTmplClass:"oax-cancel-team-activity-tmpl",modalExtraClass:"oax-ta-cancel-dialog",modalHandler:function(a,
b){b=alp.nodify("oax-ta-cancel-send",a.cont);var c=alp.nodify("oax-ta-cancel-remark",a.cont);alp.aELtouchup(b,function(){var a=alp.nodify("oax-teamactivity-cancel-form"),b=alp.nodify("oax-ta-cancel-text",a),d=alp.nodify("oax-ta-cancel-flag",a);a?(b.value=c.value,d.value="true",y.submit(a,null,function(a,b){b.stopWait();"ok"===a.status&&(location.href=a.redirect)})):A.show_exception_msg({message:"No data available!"})})}},a);r(a)}function r(a){function b(b){b||(b=window.event);alp.stopEvent(b);x.open({html:d.innerHTML,
extraClass:a.modalExtraClass,onOpenNow:function(c,d,e){a.modalHandler({cont:c,id:a.id,proj:a.proj,token:a.token},b)}})}var c=alp.gEBCN(a.modalBtnClass),d=alp.nodify(a.modalTmplClass);c.length&&d&&alp.aELtouchup(c,b)}function n(a){function b(b){b||(b=window.event);var c=a.id;if(!c){for(c=b.currentTarget;!alp.hasClass(c,"oax_teamactivity_snippet")&&(c=c.parentElement););c=oa.ID_FROM_DOMNODE(c)}b=alp.cfg.url.api_teamactivity_participate({ooiid:c,token:a.token,proj:a.proj,action:a.action,participant:a.get_userid?
a.get_userid(b):null,remark:a.get_remark?a.get_remark(b):null});w.to(alp.xhrPost(b),function(a){200===a.status&&window.location.reload()})}var c=alp.gEBCN(a.evtTarget,a.cont);c&&c.length&&alp.aELtouchup(c,b)}function q(a){for(a=a.target;!alp.hasClass(a,"oax_snippet")&&(a=a.parentElement););return oa.ID_FROM_DOMNODE(a)}var p=alp.sub("oa.x.TeamActivity",null,!0),v=oa.util,u=alp.dom.anchor,t=alp.data.api,w=alp.i.state,x=alp.view.modalwin,y=oa.util.asyncForm,z=oa.util,A=z.community,C=z.login,E;p.install_all=
function(n){function p(){w.to(alp.i18n.fetch("alp.all"),function(a){E=a;alp.humane(alp.opt(E,"teamActivity.save.success"),{extraClass:"oax-humane-success"})})}var q=k(n);h(q);A.generic_login_barrier_after({type:"TA_NOTIF_SUCCESS_FACEBOOK"},alp.chainF(p,function(){var a=alp.nodify("oax-facebook-share-url",q.cont);(a=a&&a.value)&&window.open(a,"sharer","width=626,height=436")}));A.generic_login_barrier_after({type:"TA_NOTIF_SUCCESS"},p);w.to(q.tokenDfrd,function(h){var k=alp.gEBCN("oax-ta-participants",
q.cont);h=[g,f,e,d,b,c,a,m,l];k&&k.length&&(k=alp.gEBCN("oax-mapList-snippet",k[0]),alp.forEach(k,u.wrap_ooi_snippet));alp.forEach(h,"v.call( null, this )",q)});if(n=v.init_from_url_hash(oa.URL_HASH_DETAILPAGE_DETAILTAB)){var r=alp.gEBI(n);(n=r&&alp.qS('label[for="'+n+'"]',r.parentElement))&&setTimeout(alp.bindF("scrollToNode",alp.dom,n),123)}};p.install_mypage=function(a){var b=k(a);w.to(b.tokenDfrd,function(a){alp.forEach([c,m],"v.call( null, this )",b)});return b};p.accept_invite_install=c;p.reject_invite_install=
m})();"undefined"!==typeof dojo&&dojo.provide("alp.cfg.icon_mapping");(function(){alp.sub("alp.cfg",null,!0).getIconByType=function(k,h){switch(k){case "search":k="magnifier";break;case "lodging":k="hut";break;case "skiresort":k="skiResort";break;case "_my_loc":k="crosshair"}h&&h.onlyPartialClass||(k="oax-icon-"+k);return k}})();"undefined"!==typeof dojo&&dojo.provide("alp.cfg.i18n_msg");
(function(){(alp.cfg||(alp.cfg={})).i18n_msg={autocomplete_cannot_find:function(k,h){var g=alp.opt(k,"autocomplete_cannot_find")||"We cannot find${text}";return alp.tmpl(g,alp.oCreateMix(k,{text:" "+h+" "}))}}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.autocompleteabstract");alp.i18n.fetch("alp.all");
(function(){var k=alp.sub("alp.data",null,!0),h=alp.cfg,g={};alp.i18n.fetch("alp.all").then(function(f){g=f});k.DESCRIPTION="alpDescription";k.DISPLAY="alpDisplay";k.DISPLAYHTML="alpDisplayHTML";alp.declare("alp.data.AutoCompleteAbstract",null,alp.nowF(function(f){var e=this;alp.mix(e,f);e.query_st||(e.query_st=new alp.State({init_value:"",constrain_all:function(d){return""+(d||"")}}));e.query_opt_st=e.query_opt_st||new alp.State;e.result_st||(e.result_st=new alp.SetState({do_not_clone:!0,is_same_element:function(d,
b){var c=d.alpstein_id,a=b.alpstein_id;return d&&b&&e.to_display(d)===e.to_display(b)&&!((c||a)&&c!==a)},ordered:e.ordered}));e.query_st.change_cb(function(d){e.result_st.clear();e.fetch(d,e.query_opt_st.get())});"number"===typeof e.delay_ms&&(e.submit=alp.ratelimitF(Math.abs(e.delay_ms),"submit",e))}),{proj:null,to_display:alp.f(".address"),to_description:function(f){return this.to_display(f)},delay_ms:456,ordered:!0,submit:alp.nowF(function(f,e){1<arguments.length&&this.query_opt_st.set(e);this.query_st.set(f)}),
displayResultSnippets:!1,fetch:function(f,e){throw Error("[abstract] fetch(): please implement this method!");},receive:alp.nowF(function(f,e){var d=this;if(d.query_st.is(f)&&e){var b=!e.length;if(b){e=h.i18n_msg.autocomplete_cannot_find(g,f);var c=alp.textContent(alp.cE("div",null,null,{innerHTML:e}));e=[{q:f,alpDescription:alp.textContent(c),alpDisplay:alp.textContent(c),alpDisplayHTML:e,title:f,notfound:!0}]}e=alp.map(e,function(a){a=alp.oCreate(a);if(a.q&&a.q!==f)throw Error("Buggy autocomplete data!");
a.q=f;d.to_description&&!a[k.DESCRIPTION]&&(a[k.DESCRIPTION]=d.to_description(a));if(d.to_display&&(a[k.DISPLAYHTML]||(a[k.DISPLAYHTML]=d.to_display(a)),!a[k.DISPLAY])){var b=a,c=k.DISPLAY,e=alp.cE("div",0,0,{innerHTML:a[k.DISPLAYHTML]||""}),g=alp.nodify("oax_title",e),h=alp.nodify("oax_subtitle",e);e=g&&h?alp.textContent(g)+" ("+alp.textContent(h)+")":alp.textContent(e);b[c]=e||""}return a});d.result_st.merge(e);d.receiveEvt().triggerSoon(f,b?[]:e)}}),receiveEvt:alp.memM("receiveEvt",'alp.event("AC:abstract:receiveEvt",{then:1})')})})();
"undefined"!==typeof dojo&&dojo.provide("alp.data.autocompletemixgeocode");
(function(){function k(f){function e(b){return b?e[b]=b.split(/\s+/g).sort().reverse().join(" "):b}function d(b){if(b.geometry){b=h.getViewportLocationFromString(b.geometry);var c;if(b&&b.viewport)return c=b.viewport.toSpan(),c.lat()*c.lng();if(b&&b.location)return 0}return-Infinity}f=[].concat(f);f.sort(function(b,c){if(b.is_geocoded&&!c.is_geocoded)return-1;if(!b.is_geocoded&&c.is_geocoded)return 1;if(b.__acmg_source&&b.__acmg_source===c.__acmg_source){var a=b.__acmg_source_result_index,f=c.__acmg_source_result_index;
if(alp.isFiniteNumber(a)&&alp.isFiniteNumber(f))return a<f?-1:a>f?1:null.bug}var l=b.q.toLowerCase(),h=b[g.DESCRIPTION].toLowerCase();a=c.q.toLowerCase();f=c[g.DESCRIPTION].toLowerCase();var k=alp.sCommonStartLength(l,h),q=alp.sCommonStartLength(a,f);k=4>k?0:k;q=4>q?0:q;if(k>q)return-1;if(k<q)return 1;l=alp.sEditDistanceLevenshtein(e[l]||e(l),e[h]||e(h));a=alp.sEditDistanceLevenshtein(e[a]||e(a),e[f]||e(f));if(l<a)return-1;if(l>a)return 1;b=d(b);c=d(c);return b>c?-1:b<c?1:0});return f}var h=alp._gmap2_3,
g=alp.sub("alp.data",null,!0);g.orderByTextAndSpan=k;g.orderFromMapCenter=function(f){function e(a){var d;if(d=alp.sub("google.maps")){var e=new d.LatLngBounds;e.extend(b);a=new d.LatLng(a.y,a.x);e.extend(a);d=e.toSpan();e=d.lat();d=d.lng();e=e*e+d*d;c&&!c.contains(a)&&(e*=1E6);return e}}var d=this.map&&(this.map instanceof google.maps.Map?this.map:this.map.get()),b=d&&d.getCenter&&d.getCenter(),c=d&&d.getBounds&&d.getBounds();if(!b)return f;f=[].concat(f);f.sort(function(a,b){return e(a)<e(b)?-1:
1});(function(a){for(var b=[],c=0,d=a.length;c<d&&2>b.length;c++){var e=a[c];(/google/i.test(alp.opt(e.__acmg_source,"declaredClass"))||/google/i.test(alp.opt(e,"source")))&&b.push(c)}for(;b.length;)a.unshift(a.splice(b.shift(),1)[0])})(f);return f};alp.declare("alp.data.AutoCompleteMixGeocode",g.AutoCompleteAbstract,null,{source_arr:null,to_display:function(f){return f.__acmg_source.to_display(f)},map:null,order:k,fetch:function(f){var e=this;e._init();alp.forEach(e.source_arr,function(d){d.submit(f,
e.map)})},resort:function(){this.result_st.setNow(this.order(this.result_st.get()))},gclientgeocoder:function(){for(var f=this.source_arr.length;f--;){var e=this.source_arr[f].gclientgeocoder&&this.source_arr[f].gclientgeocoder();if(e)return e}},includeFreeSearch:!1,_init:alp.nowF(function(){function f(d){var b=d&&alp.filter(d,"!v.notfound");return b&&b.length&&b.length<d.length?b:d}var e=this;alp.forEach(e.source_arr,function(d,b){d.result_st.change_cb(function(c){alp.gmap3(function(a){a=e.query_st.get();
if(d.query_st.is(a)){c=alp.filter(c,"!v.freeSearch");var g=f(e.order(e.result_st.get().concat(alp.map(c,function(a,b){return alp.mix({},a,{__acmg_source:d,__acmg_source_result_index:b})}))));if(e.includeFreeSearch){var l={q:a,title:a,alpDescription:a,freeSearch:!0,__acmg_source:d};g[0]&&g[0].notfound?g[0]=l:g[0]&&g[0].freeSearch||g.unshift(l)}e.result_st.set(g);g=e._acc&&a===e._acc.q?e._acc:e._acc={q:a,arr:Array(e.source_arr.length)};g.arr[b]=d.result_st.get();alp.and(g.arr,"v && v.length")&&e.receiveEvt().triggerSoon(a,
e.result_st.get())}})})});alp.subDfrd(function(){if(e.map)return e.map instanceof alp.State?e.map.get():e.map}).then(function(d){function b(a){var b=e._gmap_eh||(e._gmap_eh=new alp.Eh);b.clear();var c=alp.ratelimitF(75,function(){e.resort()});h.V2()?b.push(h.event("addListener")(d,"move",c),h.event("removeListener")):a.event&&b.push(h.event("addListener")(d,"bounds_changed",c),h.event("removeListener"))}var c=alp.oGet(d,"_alp.gm");c?b(c):alp.gmap3(b)});e._init=function(){}})})})();
"undefined"!==typeof dojo&&dojo.provide("alp.data.autocomplete_where_alpstein");
(function(){alp.declare("alp.data.AutoCompleteWhereAlpstein",alp.data.AutoCompleteAbstract,null,{to_description:alp.f(".title"),to_display:function(k){var h=k.notfound&&(k.alpDisplayHTML||k.alpDisplay)||alp.data.api_autocomplete.TITLE_PLUS_CAT(k);if(!k.notfound&&k.q)if(this.displayResultSnippets)h='<div class="oax_title"><span class="'+alp.cfg.getIconByType(k.freeSearch?"search":k.type)+' oax_marg_right_10"></span>'+k.title+"</div>",h+=k.categoryTitle?'<div class="oax_subtitle">'+k.categoryTitle+
"</div>":"";else{var g=alp.indexOf(h.toLowerCase(),k.q.toLowerCase());-1<g&&(k=g+k.q.length,h=h.substring(0,g)+"<strong>"+h.substring(g,k)+"</strong>"+h.substring(k))}return h},subset:null,fetch:alp.nowF(function(k){var h=this;k&&alp.data.api_autocomplete(alp.filterIn({q:k,proj:this.proj,subset:this.subset},"")).thenSoon(function(g){g&&g.items&&null!=g.items.length&&h.receive(k,alp.map(g.items,'alp.oCreateMix( v, { q : "'+k+'", alpstein_id : v.id } )'))})})})})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.autocomplete_photon");
(function(){function k(d,b){function c(a){null!=k||(k=Math.PI/180);null!=q||(q=Math.sin(5E-5*k));return Math.sin(a/2*k)>q}var a=b.name,e=b.postcode,f=b.city,g=b.country;a?(g=h(" ",alp.filter([e,f,g],'!=="'+a+'"')),g=h(", ",[a,g])):(a=h(" ",[b.street,b.housenumber]),e=h(" ",[e,f]),g=h(", ",[a,e,g]));if(g)return a=(b=(b=b.extent)&&"number"===typeof b[3]&&alp.sub({w:"0",s:"3",e:"2",n:"1"},b))&&c(b.e-b.w)&&c(b.n-b.s),d=d&&d.coordinates&&d.coordinates.slice(0,2).join(" ")||null,{geometry:a?[alp.sub(["w",
"s"],b).join(" "),alp.sub(["e","n"],b).join(" ")].join():d,title:g,isRegion:a,pointGeometry:d};var k,q}function h(d,b){return alp.filter(alp.map(b,"v&&alp.sTrim(v)"),"").join(d)}var g=alp.sub("alp.data.api",null,!0),f={de:1,it:1,fr:1,en:1},e=alp.cfg.url;g.autocomplete_photon=function(d){var b=d.q,c=new XMLHttpRequest,a=alp.dfrd("ADA_autocomplete_photon");(b||null).substring.call.a;b=b.toLowerCase();var g=alp.i18n.language();b={q:b,lang:f[g]?g:"en",lat:"",lng:""};g=d.lng;isFinite(d.lat)&&isFinite(g);
var l=alp.tmpl(e.api_autocomplete_photon(),b);c.addEventListener("load",alp.nowF(function(b){b=alp.oFrom(b.target.response).features||[];b={items:alp.filter(alp.map(b,function(a){var b=a.geometry;a=a.properties;return b&&a&&k(b,a)}),"")};a.done(b)}));c.addEventListener("error",function(b){setTimeout(function(){throw Error("CORS failed for url: "+l+", e:"+b);});a.done({items:[]})});c.open("GET",l,!0);c.setRequestHeader("Accept","application/json");c.send();return a}})();
"undefined"!==typeof dojo&&dojo.provide("alp.data.autocomplete_where_photon");
(function(){var k=alp.data.api;alp.declare("alp.data.AutoCompleteWherePhoton",alp.data.AutoCompleteAbstract,null,{to_description:alp.f(".title"),to_display:function(h){var g=h.notfound&&(h.alpDisplayHTML||h.alpDisplay)||alp.data.api_autocomplete.TITLE_PLUS_CAT(h);if(!h.notfound&&h.q)if(this.displayResultSnippets)g='<div class="oax_title"><span class="'+alp.cfg.getIconByType(h.freeSearch?"search":h.type)+' oax_marg_right_10"></span>'+h.title+"</div>",g+=h.categoryTitle?'<div class="oax_subtitle">'+
h.categoryTitle+"</div>":"";else{var f=alp.indexOf(g.toLowerCase(),h.q.toLowerCase());-1<f&&(h=f+h.q.length,g=g.substring(0,f)+"<strong>"+g.substring(f,h)+"</strong>"+g.substring(h))}return g},subset:null,fetch:alp.nowF(function(h,g){if(/[\?&]where_oa=0(?:$|&)/.test(location.search)){var f=this;if(h){g=alp.m(g,"get");var e=alp.m(g,"getCenter");g=alp.m(e,"lat");e=alp.m(e,"lng");var d=isFinite(g)&&isFinite(e),b={q:h,proj:this.proj,subset:this.subset};d&&(b.lat=g,b.lng=e);k.autocomplete_photon(b).thenSoon(function(b){b&&
b.items&&null!=b.items.length&&f.receive(h,alp.map(b.items,'alp.oCreateMix( v, { q : "'+h+'" } )'))})}}else this.receive(h,[])})})})();"undefined"!==typeof dojo&&dojo.provide("alp.gplaces");(function(){alp.whenPlaces=function(){var h=alp.bindF.apply(alp,arguments);return k.then(h)};var k=alp.subDfrd("google.maps.places.Autocomplete")})();"undefined"!==typeof dojo&&dojo.provide("alp.data.autocomplete_where_places");
(function(){function k(a,b){g().then(function(c){c.getPlacePredictions(e(a),b)})}function h(a,b,c,d){d!=google.maps.places.PlacesServiceStatus.OK?console.error("alp.data.AutoCompleteWherePlaces: received PlacePredictions error status: ",d):a.receive(b,alp.map(c,function(a){var c;return alp.oCreateMix(a,{q:b,alpFetchGeometry:function(b){function d(a,d){d!=google.maps.places.PlacesServiceStatus.OK?console.error("alp.data.AutoCompleteWherePlaces: received PlaceDetails error status: ",d):b(c=a.geometry)}
c&&b(c);var e={reference:a.reference,callback:d};f().then(function(a){a.getDetails(e,d)})}})}))}function g(){g._dfrd||(g._dfrd=alp.subDfrd(alp.f('alp.sub("'+b+'")  &&  new '+b)),d.gmapDfrd());return g._dfrd}function f(){f._dfrd||(f._dfrd=alp.subDfrd(alp.f('alp.sub("'+c+'")  &&  new '+c+'( alp.cE("div"))')),d.gmapDfrd());return f._dfrd}function e(a){var b=google.maps;return!a.lat||!a.lng||a instanceof b.LatLng?!a.getSouthWest||!a.getNorthEast||a instanceof b.LatLngBounds?(b=a&&a.bounds)?alp.mix({},
a,{bounds:e(b)}):a:new b.LatLngBounds(e(a.getSouthWest()),e(a.getNorthEast())):new b.LatLng(a.lat(),a.lng())}var d=alp.gload_gmap;alp.declare("alp.data.AutoCompleteWherePlaces",alp.data.AutoCompleteAbstract,null,{to_description:alp.f(".description"),to_display:function(a){var b=a.description;if(a.matched_substrings){a=[].concat(a.matched_substrings);a.sort(function(a,b){return a.offset<b.offset?-1:1});for(var c=a.length;c--;){var d=a[c],e=d.offset;d=e+d.length;b=b.substring(0,e)+"<strong>"+b.substring(e,
d)+"</strong>"+b.substring(d)}}else a.q&&(c=alp.indexOf(b.toLowerCase(),a.q.toLowerCase()),-1<c&&(e=c+a.q.length,b=b.substring(0,c)+"<strong>"+b.substring(c,e)+"</strong>"+b.substring(e)));return b},fetch:function(a,b){k({input:a,bounds:alp.m(b,"getBounds")},alp.bindF(h,null,this,a))}});var b="google.maps.places.AutocompleteService",c="google.maps.places.PlacesService"})();"undefined"!==typeof dojo&&dojo.provide("alp.util.p");alp.util=alp.sub("util",alp,!0);
alp.util.detunif=function(k,h){if("number"!==typeof k||0>k)console.error("alp.util.detunif( n ) needs a positive integer, you gave me:",k);else{h=h||alp.util.detunif_iter;var g=Array(k);h=h(k);for(var f=0;f<k;f++)g[f]=h();return g}};
alp.util.detunif_iter=function(k){var h=0,g,f,e=function(){"number"!==typeof k||1>k?console.error("alp.util.detunif_iter( "+k+" ) needs a strictly positive integer, you gave me:",k):(g=Math.round(Math.ceil(Math.log(k)/Math.log(2))),f=(1<<g)-1,h&=f)};e();var d=function(){for(var b;;)if(b=alp.util.reverse_bit(h,g),h=1+h&f,b<k)return b};d.n=function(){return k};d.change_n=function(b){if(k===b)return!1;k=b;e();return!0};return d};"undefined"!==typeof dojo&&dojo.provide("alp.util.random");
alp.util=alp.sub("util",alp,!0);(function(){var k=0;alp.util.randint=function(h){return Math.max(0,Math.min(h-1,((k+=h*Math.random())>>0)%h))}})();alp.util.randperm_det=function(k){if(!k||!k.length)return k;for(var h=k.length,g=Array(h),f=alp.util.detunif_iter(h);h--;)g[f()]=k[h];return g};alp.util.randstr=function(k,h){h=h||"abcdefghijklmnopqrstuvwxyz";for(var g=[],f=h.length;k--;)g.push(h.charAt(alp.util.randint(f)));return g.join("")};"undefined"!==typeof dojo&&dojo.provide("alp.data.autocompleterandom");
(function(){alp.declare("alp.data.AutoCompleteRandom",alp.data.AutoCompleteAbstract,null,{to_display:alp.f(".address"),fetch:function(k){if(k){var h=this,g=[].concat(this._get(k)),f=alp.asyncF(123,function(){var e=g.shift();e&&(h.receive(k,[e]),f())});f()}},_get:function(k){var h=this._cache||(this._cache={});if(h[k])return h[k];for(var g=[],f=alp.util.randint(11);f--;)g[f]={address:k+alp.util.randstr(5),x:8+5*Math.random(),y:45+10*Math.random()};h[k]=g;return[].concat(g)}})})();
"undefined"!==typeof dojo&&dojo.provide("alp.view.table");
(function(){alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.view.Table",alp.util.Updater,alp.nowF(function(k,h){var g=this;g.array_st=new alp.SetState({do_not_clone:!0,ordered:!0,init_value:h&&h.array_init_value});g.vis_st=new alp.BoolState({init_value:!(h&&null!=h.vis_init?!h.vis_init:!k)});g.ref_st=new alp.State({init_value:k});g.selected_st=new alp.State({init_value:null});g.selected_index_st=new alp.State({init_value:-1,constrain_all:function(f){var e=g.array_st.get().length;return Math.min(e-
1,Math.max(-1,f>>0))}});g.min_width_st=new alp.State;g.width_st=new alp.State;alp.mix(g,h);g.array_st.change_cb("update",g);g.vis_st.change_cb("update",g);g.ref_st.change_cb("update",g);g.selected_st.change_cb("update",g);g.selected_index_st.change_cb(function(f){g.selected_st.set(g.array_st.get()[f])});g.min_width_st.change_cb("_place_domNode",g);g.width_st.change_cb("_place_domNode",g);alp.aEL(alp.body(),"mousewheel",function(){g._place_domNode()});alp.aEL(alp.body(),"mousedown",function(){g._place_domNode()});
alp.aEL(alp.body(),"mouseup",function(){g._place_domNode()});g.hide_on_mousewheel&&alp.aEL(alp.body(),"mousewheel",function(){g.hide()});g.hide_on_click&&alp.aEL(alp.body(),"click",g,"hide");g.vis_st.change_cb(function(){delete g._mov_last_a});setInterval(alp.ratelimitF(231,function(){var f=g.ref_st.get();f&&f.offsetParent&&g._place_domNode()}),345)}),{nrow_min:10,nrow_max:10,mouseselect:!0,vis_init:null,additionalClass:null,additionalRowClass:null,container_attr:{"class":"js-table-cont"},table_attr:{"class":"js-table-table",
cellpadding:"0",cellspacing:"0"},row_attr:{"class":"js-table-row"},selected_class:"js-row-selected",selected_is_same:function(k,h){return k===h},refnode2xy:function(k){k=alp.gBCR(k);var h=alp.gWindowScroll();return{x:k.left,y:k.bottom+h.top,w:k.width,h:k.height}},transform:null,empty_row:"&nbsp;",hideEmptyRow:!1,hideEmptyRowClass:"alp-table-hidden-empty-row",hide_on_mousewheel:!1,hide_on_click:!1,top_wrap:null,unselectableClass:null,prepareMultiBlockArray:null,getSubheadingN:null,array_st:null,vis_st:null,
ref_st:null,selected_st:null,selected_index_st:null,min_width_st:null,width_st:null,hide:function(){this.vis_st.setNow(!1)},show:function(){this.vis_st.setNow(!0)},is_selecting:function(){return-1<this.selected_index_st.get()},select:function(k){this.selected_index_st.setNow(k)},unselect:function(){this.select(-1)},select_shift:function(k){var h=this.selected_index_st.get();-1<h&&this.selected_index_st.setNow(Math.max(0,h+k))},select_none:function(){this.selected_index_st.setNow(-1)},n_visible_row:function(){return Math.min(this._nrow_max||
this.nrow_max,this.array_st.get().length)},clickEvt:alp.memM("clickEvt",'alp.event("clickEvt",{then:1})'),clicked:alp.nowF(function(k,h){this.clickEvt().triggerSoon(k,h)}),updateImpl:function(){var k=this.vis_st.get(),h=k&&this.array_st.get(),g=k&&this.ref_st.get(),f=k&&this.selected_st.get();k&&h&&h.length&&g?(alp.arrEqual(this._last_arr,h)&&this._last_selected===f||this._update_domNode(h,g),this._last_arr=h,this._last_selected=f,this._place_domNode(),""!==this.domNode.style.display&&(this.domNode.style.display=
"")):this.domNode&&"none"!==this.domNode.style.display&&(this.domNode.style.display="none")},_update_domNode:function(k){function h(a,c,d){b.push(alp.aEL(a,"mouseover",function(a){d!==g._mov_last_a&&(g._mov_last_a=d,g.selected_st.setNow(c))}));b.push(alp.aEL(a,"click",function(){g._clicked(c,d)}))}var g=this,f=g.domNode,e,d;f&&(e=alp.gEBTN("table",f)[0])&&alp.empty(e);e||((f=g._topWrapNode||f)&&f.parentNode&&f.parentNode.removeChild(f),f=alp.cE("div",null,g.container_attr),g.additionalClass&&alp.setClass(f,
g.additionalClass,!0),g.domNodeTable=alp.cE("table",f,g.table_attr));k="function"===typeof g.prepareMultiBlockArray?g.prepareMultiBlockArray(k):[k];var b=g.eh||g.eh||new alp.Eh;b.clear();var c=g.selected_st.get(),a=!1,m;for(m=e=0;m<k.length;m++)if(d=k[m].length){var l=Math.max(g.nrow_min,Math.min(g.nrow_max,d));d=alp.cE("tbody",g.domNodeTable);if("function"===typeof g.getSubheadingN){var r=g.getSubheadingN(m,k[m][0]);var n=alp.cE("tr",null);alp.cE("th",n,null,{innerHTML:r});d.appendChild(n)}for(r=
0;r<l;r++){var q=k[m][r];n=alp.cE("tr",null,g.row_attr);var p=alp.cE("td",n);var v=g.additionalRowClass;v&&alp.setClass(n,v,!0);if(c&&g.selected_is_same(q,c)){var u=n;alp.setClass(p,g.selected_class,!0);g.selected_st.set(q);g.selected_index_st.set(e);a=!0}v=alp.m(g,"unselectableClass",q);g.transform&&(q=q&&g.transform(q));if(q=q||g.empty_row)"object"===typeof q?p.appendChild(q):p.innerHTML=q;alp.setClass(p,g.hideEmptyRowClass,q===g.empty_row);v&&alp.setClass(p,v,!0);d.appendChild(n);g.mouseselect&&
!v&&h(n,k[m][r],e);q!==g.empty_row&&e++}}a?(k=u.offsetTop,u=u.clientHeight,a=(c=alp.gBCR(f))&&c.height,m=f.scrollTop,c=g.selected_index_st,m<k&&k+u<m+a||(u=c.getPrevious()>c.get()?k:u+k-a,f.scrollTop=0===c.get()?0:u)):(g.selected_st.set(null),f.scrollTop=0);this._nrow_max=e;e=alp.body();alp.isDescendant(f,e)||e.appendChild(g.top_wrap?g._topWrapNode=alp.aC(alp.cE("div",null,{"class":g.top_wrap}),f):f);g.domNode=f},_place_domNode:function(){var k=this.domNode,h=this.ref_st.get(),g=h&&this.refnode2xy(h),
f=this._last_dom_node||null,e=this._last_ref||null,d=e&&this._last_ref_xy;if(!(f&&e&&d&&f===k&&e===h&&alp.and(["x","y","w","h"],function(a){var b=d[a];return alp.isFiniteNumber(b)&&b===g[a]}))){this._last_dom_node=k;this._last_ref_xy=(this._last_ref=h)&&g;f=this.vis_st.get();e=this.min_width_st.get();var b=this.width_st.get();if((h=h||f&&this.ref_st.get())&&k){k&&e&&alp.isFiniteNumber(e)&&(k.style.minWidth=e+"px");k&&b&&alp.isFiniteNumber(b)&&(k.style.width=b+"px");if("string"===typeof h){var c=alp.gEBI(h)||
alp.gEBCN(h)[0];if(!c)return}else if("object"===typeof h)if(h.getAttribute&&h.setAttribute)c=h[0]||h;else{var a=h.x;a=null!=a?a:h[0];var m=h.y;m=null!=m?m:h[1]}else{console.error("alp.view.Table._place_domNode(): unsupported ref type:",typeof h,", ref:",h);return}c&&(h=this.refnode2xy(c),a=h.x,m=h.y);null!=a&&null!=m&&(this._last_x!==a&&(k.style.left=a+"px"),this._last_x=a,this._last_y!==m&&(k.style.top=m+"px"),this._last_y=m)}}},_clicked:alp.asyncF(0,"clicked")})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.autocomplete");
(function(){alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.AutoComplete",null,alp.nowF(function(k,h){var g=this;g.ti=k||(k=new alp.view.TextInput({inputNode:h.inputNode,text_inactive:""}));alp.mixCheck(g,h);g.initText&&(g.ti.input.setNow(g.initText),g._get_dom_in().value=g.initText);g.datasource||(g.datasource=new alp.data.AutoCompleteRandom);g.output_vis_st=g.output_vis_st||new alp.BoolState;g.active_st=k.active;g.input_st=k.input;g.input_active=k.input_active;k.reinitEvt().then(alp.bindF("reinit",
g));g.active_st.change_cb(function(){g.update()});g.input_st.change_cb(function(f,e){g.input_active.get()&&g.update()});k.key_pressedEvt().then(function(f){g.update(f)});g.selectEvt().then(function(f){f&&g.close_on_select&&(g.unselect(),g.input_active.setNow(!1),g.hide())});g.closeOnMouseDown&&alp.aEL(document,"mousedown",function(f){f||(f=window.event);var e=alp.filter([g._get_dom_in(),g.output.domNode],"");e.length&&!alp.isDescendant(f.target||f.srcElement,e)&&(g.unselect(),g.input_active.setNow(!1),
g.hide())});g.inputClickSelectAllText&&alp.aEL(g._get_dom_in(),"click",function(){alp.m(g._get_dom_in(),"select")});g.reinit()}),{minchar:3,datasource:null,ignoreBrackets:!0,alwaysPointGeometry:!1,inputNode:null,ti:null,stateNode:null,stateNodeEmptyClass:"alp-ac-empty",stateNodeNotEmptyClass:"alp-ac-not-empty",stateNodeActiveClass:"alp-ac-active",stateNodeInactiveClass:"alp-ac-inactive",stateNodeVisibleClass:"alp-ac-visible",stateNodeNotVisibleClass:"alp-ac-invisible",clickableClass:"alp-x-clickable",
close_click_excluded_divs:null,close_click_filter:function(k){k||(k=window.event);var h=k&&(k.target||k.srcElement);return h?(k=this.close_click_excluded_divs())&&k.length?!alp.or(k,function(g){return alp.isDescendant(h,g)}):!0:!0},close_on_select:!0,closeOnMouseDown:!1,initText:null,polite:!0,output_min_width:!0,output_width:!1,output_css:null,output_extra_css:".js-table-cont { opacity: 0.8; filter: alpha(opacity = 80); zoom: 1; }",output_prepareMultiBlockArray:null,output_getSubheadingN:null,inputClickSelectAllText:!1,
overwrite_input_on_mouseover:!1,defaultSelectFirstOnEnter:!1,outputNodeClass:null,keyUpDownFirstLastDirect:!0,top_wrap:null,unselectableClass:function(k){return k&&k.notfound&&"oax-ac-unselectable"},output_vis_st:null,reinit:function(){function k(){var a=f.ti.input_active.get();alp.setClass(f.stateNode,[[f.stateNodeActiveClass,a],[f.stateNodeInactiveClass,!a]])}function h(){var a=!f.ti.input.get();alp.setClass(f.stateNode,[[f.stateNodeEmptyClass,a],[f.stateNodeNotEmptyClass,!a]])}function g(){var a=
!!c.get();alp.setClass(f.stateNode,[[f.stateNodeVisibleClass,a],[f.stateNodeNotVisibleClass,!a]])}var f=this,e=f._get_dom_in();f.output&&f.output.hide();f._eh=f._eh||new alp.Eh;f._eh.clear();if(e){f._eh.push(f.datasource.receiveEvt().then(function(){function a(a){var b=a.geometry,c=a.pointGeometry;return c&&b!==c?alp.oCreateMix(a,{geometry:c}):a}var b=f.datasource.result_st.get();f.alwaysPointGeometry&&(b=alp.map(b,a));f.output&&f.output.array_st.set(b);f.input_active.get()&&f.output.show()}));var d=
{transform:f.datasource.to_display||alp.f(".title"),hideEmptyRow:!0,unselectableClass:f.unselectableClass,vis_init:!1},b;if(b=f.output_css)d.css=b;if(b=f.output_extra_css)d.extra_css=b;if(b=f.outputNodeClass)d.additionalClass=b;if(b=f.top_wrap)d.top_wrap=b;if(b=f.clickableClass)d.additionalRowClass=b;if(b=f.output_prepareMultiBlockArray)d.prepareMultiBlockArray=b;if(b=f.output_getSubheadingN)d.getSubheadingN=b;f.output=new alp.view.Table(e,d);f._eh.push(alp.aEL(alp.body(),"mousewheel",function(a){a||
(a=window.event);a=a.target||a.srcElement;(alp.isDescendant(e,a.parentNode)||alp.isDescendant(a,e.parentNode))&&f.output.hide()}));f.polite&&(f._static.table_set||f._static.table_set||new alp.PoliteSetState).add(f.output.vis_st);f._eh.push(f.output.vis_st.bind_to(f.output_vis_st,{loose:!0}));f._eh.push(f.output.clickEvt().then(alp.bindF("_selected",f)));f._eh.push(f.output.selected_index_st.change_cb("_on_selected_index_change",f));f._eh.push(alp.aEL(alp.body(),"onmousedown",function(a){a||(a=window.event);
var b=a.target||a.srcElement;if(b!==f._get_dom_in()){var c=f.output&&f.output.domNode;c&&alp.isDescendant(b,c)||!f.close_click_filter(a)||(f.output.hide(),f.ti.sleepy.setNow(!1),f._over())}}));f.output_min_width&&f._eh.push(f.output.vis_st.change_cb(function(){var a=f.output.vis_st.get(),b=f._get_dom_in();b=b&&b.parentNode&&alp.gBCR(b);var c=f.output;a&&b&&c&&c.min_width_st.set(b.width)}));f.output_width&&f._eh.push(f.output.vis_st.change_cb(function(){var a=f.output.vis_st.get(),b=f._get_dom_in();
b=b&&b.parentNode&&alp.gBCR(b);var c=f.output;a&&b&&c&&c.width_st.set(b.width)}));if(f.stateNode){f._eh.push(f.ti.input_active.change_cb_init(k));f._eh.push(f.ti.input.change_cb_init(h));var c=f.output.vis_st;f._eh.push(c.change_cb_init(g))}f.update()}},close:function(){function k(){h.unselect();h.hide()}var h=this;k();setTimeout(k,100)},hide:function(){this.output&&this.output.hide()},is_selecting:function(){return this.output&&this.output.is_selecting()},unselect:function(){this.output&&this.output.unselect()},
selectEvt:alp.memM("selectEvt",'alp.event("autocomplete selectEvt",{then:1})'),overEvt:alp.memM("overEvt",'alp.event("autocomplete overEvt",{then:1})'),selected:alp.nowF(function(k){var h=k[alp.data.DISPLAY];h&&this.ti.input.setNow(h);this.selectEvt().triggerSoon(k)}),over:alp.nowF(function(k,h){this.overEvt().triggerSoon(k,h)}),update:function(k){var h=alp.key.ENTER,g=alp.key.UP_ARROW,f=alp.key.DOWN_ARROW,e=alp.key.ESCAPE,d=this.output,b=this._get_dom_in(),c="number"===typeof k;h=c&&k===h;g=c&&k===
g;f=c&&k===f;var a=c&&k===e;d&&b||(this.reinit(),d=this.output,b=this._get_dom_in());e=this.ti.input.get()&&b&&b.value;var m=this._last_s!==e;c=c&&e.length&&(0===k||k===e.charCodeAt(e.length-1));this._last_s=e;a?(b&&(b.value=""),this.ti.input.setNow(""),this.output.hide()):c&&(b&&this.ti.input.setNow(b.value),this._last_dom_in_value=b.value,d.unselect());if(d&&b&&this.active_st.get()&&e&&"string"===typeof e){b=!a&&e&&e.length>=this.minchar;if(m){b=e;if(this.ignoreBrackets)for(c="";c!==b;)c=b,b=alp.sTrim(b.replace(/\([^\(\)]*(?:\)|$)|\[[^\[\]]*(?:\]|$)/g,
"").replace(/\s\s+/g," "));b.length>=this.minchar?(this.datasource.submit(b),b=null):b=!1}this.input_active.get()||(b=!1);if(null!==b)d[b?"show":"hide"]();if(h)g=this.datasource.result_st.get(),d=this.output.selected_index_st.get(),h=g&&alp.isFiniteNumber(d)&&g[d],0>d&&(d=this.input_st.get(),b=!g[0].notfound&&g[0],d!==b.title?(this._last_s=b.title,setTimeout(alp.nowF(alp.bindF("update",this,k)),222)):"function"===typeof this.defaultSelectFirstOnEnter?this.defaultSelectFirstOnEnter(g[0]):this.defaultSelectFirstOnEnter&&
(h=!g[0].notfound&&g[0])),h&&this._selected(h);else if(g||f)d=this.output.selected_index_st,k=this.output.n_visible_row(),h=d.get(),g=g?-1:1,d.set(this.keyUpDownFirstLastDirect?(k+h+g)%k:(k+2+h+g)%(1+k)-1)}else d&&d.hide()},_static:{},_get_dom_in:function(){return this.ti.get_dom_in()},_selected:alp.asyncF(0,"selected"),_over:alp.asyncF(0,"over"),_on_selected_index_change:function(k){var h=this._get_dom_in(),g=-1<k&&this.output.array_st.get()[k];this._over(g,k);if(h){var f=!!g,e=f&&!(-1<this._last_selected_index),
d=this._was_selecting&&!f;this._last_selected_index=k;this._was_selecting=f;e&&(this._last_manual_input=this.ti.input.get(),this._last_dom_in_value=h&&h.value);f?(this.ti.sleepy.setNow(f),h&&this.overwrite_input_on_mouseover&&(h.value=this.output.transform(g))):d&&(h&&this._last_dom_in_value&&this.overwrite_input_on_mouseover&&(h.value=this._last_dom_in_value),this.ti.sleepy.setNow(f))}}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.where_autocomplete");
(function(){function k(a,b){function c(b){a.inputPlaceOnly||(a.getInputTextSt().set(""),a._clearInputWithoutUpdate=!0);a.m.placeSt.set(b)}b.freeSearch?a.m.qSt.set(b):f(a,b,c)}function h(b){alp.m(b[m],"setMap",null);delete b[c];delete b[a];delete b[m]}function g(d,g){function l(f,l){d[c]=g;d[a]=l;var h=l.geometry;l=h.location;var n=h.viewport;h=alp.opt(d,["fillColor","fillOpacity","strokeColor","strokeOpacity","strokeWeight"]);if(n){l=d.prepareViewportRectangle(f,n);if(!l)return;f=new f.Rectangle(alp.mix(h,
{bounds:l}))}else f=alp.mix(d.get_special_marker_cfg({html:'<div class="oax-where-pin-cont"><img class="oax-where-pin-img" src="'+b+'"/></div>'},{gm:!0}),{map:k,position:l,style:{cursor:null},zIndex:50,interactive:!1}),f=new e.CustomMarker(f);d[m]=f;f.setMap(k)}var k=d.m.mapSt.get();(!k||g||d[a]&&d[a].geometry.viewport)&&h(d);k&&g&&alp.gmap3(function(a){f(d,g,alp.bindF(l,null,a))})}function f(a,b,c){function d(d){a[l]===b&&(delete a[l],f={name:b.description,matched_substrings:b.matched_substrings,
geometry:d},c(f))}delete a[l];var f=null;if(b&&alp.and(alp.sub(["title","geometry"],b))&&(b.alpstein_id?b.categoryTitle:1)&&"string"===typeof b.geometry){var g=e.getViewportLocationFromString(b.geometry);f={name:b.title+" ("+b.categoryTitle+")",geometry:g};alp.mix(f,alp.opt(b,["id","alpstein_id","isRegion","title","type"],!0));c(f)}else b&&alp.and(alp.sub(["description","matched_substrings","alpFetchGeometry"],b))&&"function"===typeof b.alpFetchGeometry&&(a[l]=b,b.alpFetchGeometry(d))}var e=alp.sub("alp._gmap2_3",
null,!0),d=alp.data,b=alp.cssBase()+"alp/gmap/resources/images/where_pin.svg";alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp._gmap2_3.x.WhereAutocomplete",alp.x.AbstractController,function(){this.inputNode.childNodes.a;this.proj.substring.a},alp.cfg.color.highlight(),{inputNode:null,proj:null,key:null,mapSt:null,defaultSelectFirstOnEnter:!0,inputPlaceOnly:!0,closeOnMouseDown:!0,inputNodeClass:"alp-whac-in",outputNodeClass:"alp-whac-out",clearNode:null,sourceArr:function(a){return[new d.AutoCompleteWhereAlpstein(alp.oCreateMix(a||
{},{proj:""})),new d.AutoCompleteWherePlaces(alp.oCreate(a||{})),new d.AutoCompleteWherePhoton(alp.oCreate(a||{}))]},stateNode:null,top_wrap:null,initText:null,includeFreeSearch:!1,displayResultSnippets:!1,prepareMultiBlockArray:null,getSubheadingN:null,get_special_marker_cfg:null,getInputTextSt:function(){return this.kx.autocomplete.input_st},clearInput:function(){this.getInputTextSt().setNow("");this.kx.autocomplete.close()},prepareViewportRectangle:function(a,b){var c=this.m.mapSt.get(),d=c.getProjection();
c=c.getZoom();var f=this.radiuspixel;if(b&&d){var g=b.getCenter();var l=b.getNorthEast();g=e.fromLatLngToPixel(d,g,c);l=e.fromLatLngToPixel(d,l,c);f*=1.2;Math.abs(l.x-g.x)<f&&(l=new a.Point(g.x+f,g.y-f),l=e.fromPixelToLatLng(d,l,c),b=new a.Point(g.x-f,g.y+f),b=e.fromPixelToLatLng(d,b,c),b=new a.LatLngBounds(b,l));d=b.getCenter();c=b.toSpan();b=c.lat()/3;c=c.lng()/3;l=new a.LatLngBounds(new a.LatLng(d.lat()-b,d.lng()-c),new a.LatLng(d.lat()+b,d.lng()+c))}return l},augmentModel:function(a){a.mapSt=
this.mapSt||new alp.State;a.placeSt=new alp.State;a.qSt=new alp.State({constrain_all:function(a){if(a){var b=a.q;b&&-1<b.indexOf(" ")&&!/^".*"$/.test(b)&&(a.qExt='"'+b+'" OR ('+b.split(" ").join(" AND ")+")")}return a}})},augmentKids:function(a){alp.setClass(this.inputNode,this.inputNodeClass,!0);var b=alp.fVal(this.sourceArr,this);b=new d.AutoCompleteMixGeocode({source_arr:b,map:this.mapSt,includeFreeSearch:this.includeFreeSearch});a.autocomplete=new alp.x.AutoComplete(null,{inputNode:this.inputNode,
outputNodeClass:this.outputNodeClass,inputClickSelectAllText:!0,datasource:b,defaultSelectFirstOnEnter:this.defaultSelectFirstOnEnter,closeOnMouseDown:this.closeOnMouseDown,stateNode:this.stateNode,top_wrap:this.top_wrap,initText:this.initText,output_prepareMultiBlockArray:this.prepareMultiBlockArray,output_getSubheadingN:this.getSubheadingN})},connectView2Model:function(a,b,e,f){function l(){var b=alp.oGet(a,[c,"q"]),g=alp.oGet(a,[c,d.DISPLAY]),l=f.autocomplete.input_st;b&&l.is(b)||g&&l.is(g)||h(a);
l.get()||e.placeSt.set()}b.push(f.autocomplete.selectEvt().then(alp.bindF(k,null,a)));b.push(f.autocomplete.overEvt().then(alp.bindF(g,null,a)));a.inputPlaceOnly?b.push(f.autocomplete.input_st.change_cb(l)):(b.push(e.placeSt.change_cb(function(){e.placeSt.get()||h(a)})),b.push(f.autocomplete.input_st.change_cb(function(){a._clearInputWithoutUpdate?delete a._clearInputWithoutUpdate:a.getInputTextSt().get()||e.qSt.set({q:"",freeSearch:!0})})));a.clearNode&&b.push(alp.aEL(a.clearNode,"click",alp.bindF("clearInput",
a)))}});var c="_over_data",a="_over_place",m="_over_view",l="_fetching_geometry"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.abstract_where");(function(){alp.declare("oax.x.AbstractWhere",alp.x.AbstractController,null,{getInputTextSt:null})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.wherealpstein");
(function(){function k(){var g=this.m.placeSt.get();this.placeChangeEvt().triggerSoon(g||null)}var h=alp._gmap2_3;alp.declare("oax.x.WhereAlpstein",oax.x.AbstractWhere,null,{node:null,proj:null,getInputNode:function(){var g=/^input$/i.test(this.node.tagName)?this.node:alp.gEBTN("input",this.node)[0];g.value;return g},key:null,useGooglePlaces:!1,usePhoton:!0,subset:null,clearClass:oax.WHERE_CLEAR,interceptUserSelect:null,initText:null,closeOnMouseDown:!0,clear:function(){this.m.placeSt.setNow(null);
this.getInputTextSt().setNow("")},getInputTextSt:function(){return this.kx.whereautocomplete.getInputTextSt()},getMap:function(){return this.m.mapSt.get()},setMap:function(g){this.m.mapSt.set(g)},placeChangeEvt:alp.memM("placeChangeEvt",'alp.event("placeChangeEvt",{then:1})'),placeChangeCB:alp.eventCB("placeChangeEvt"),placeChangeDropCB:alp.eventDropCB("placeChangeEvt"),augmentModel:function(g){g.mapSt=new alp.State;g.placeSt=new alp.State},augmentKids:function(g){var f={inputNode:this._inputNode=
this.getInputNode(),proj:this.proj,key:this.key,mapSt:this.m.mapSt,stateNode:this.node,clearNode:alp.gEBCN(this.clearClass,this.node),top_wrap:"oax",initText:this.initText,closeOnMouseDown:this.closeOnMouseDown},e=alp.fVal(h.x.WhereAutocomplete.prototype.sourceArr,alp.opt(this,["subset"],!0));this.useGooglePlaces||(e=alp.filter(e,"!/places/i.test( v.declaredClass )"));this.usePhoton||(e=alp.filter(e,"!/photon/i.test( v.declaredClass )"));f.sourceArr=e;g.whereautocomplete=new h.x.WhereAutocomplete(f)},
connectModel2View:function(g,f,e,d){f.push(e.mapSt.bind_to(d.whereautocomplete.m.mapSt));f.push(e.placeSt.change_cb_init(alp.nowF(k,g)))},connectView2Model:function(g,f,e,d){f.push(d.whereautocomplete.m.placeSt.change_cb(function(){var b=d.whereautocomplete.m.placeSt.get(),c=null;b&&b.name&&(alp.sub("geometry.location",b)||alp.sub("geometry.viewport",b))&&(c=b);g.interceptUserSelect?(c&&(g._showWhere[c.name]=c),g.interceptUserSelect(c)):e.placeSt.setNow(c)}))},_showWhere:function(g){if(g){var f=g&&
this._showWhere[g];f&&"object"===typeof f?this.m.placeSt.setNow(f):this.getInputTextSt().setNow(g)}else this.m.placeSt.setNow(null)}})})();"undefined"!==typeof dojo&&dojo.provide("oax.community_layout");
(function(){function k(a){c.login_indicator()||m.async_submit_install();h();oax.priv.communitypage(a)}function h(){alp.forEach(alp.gEBCN(["oax-register-form","oax-login-form","oax-newsletter-register","oax-accept-terms-form","oax-notifications"]),function(a){alp.styleform.init({now:!0,cont:a})})}function g(a){function c(a){var c=this;b.installLazyLoad_specific({cont:c.cont,oax_lazy_onload:function(b){var d=alp.nodify(c.selectedClass,c.cont);alp.setClass(d,c.selectedClass,!1);alp.setClass(b.node,c.selectedClass,
!0);b=a.cont;a.cont=c.cont;oa.x.TeamActivity.accept_invite_install(a);oa.x.TeamActivity.reject_invite_install(a);a.cont=b}})}f();var d=a&&a.wrap_filterHrefId,e="boolean"===typeof d?{filterHrefId:d}:null;alp.forEach(alp.gEBCN(oax.CONT_EACH_WRAP_ANCHOR),function(a){alp.dom.anchor.wrap_ooi_snippet(a,e)});if(alp.opt(a,"proj")){var g=oa.x.TeamActivity.install_mypage({proj:a.proj,cont:alp.nodify(oa.TOP_CONT)});b.to(g.tokenDfrd,function(a){b.contSelectInstall({lazyload:alp.bindF(c,null,g)})})}}function f(){var a=
alp.gEBCN("oax-sub-nav");a&&(alp.aEL(a,"mouseover",function(a){a||(a=window.event);alp.stopEvent(a);alp.setClass(a.target,"oax_hover",!0)}),alp.aEL(a,"mouseout",function(a){a||(a=window.event);alp.stopEvent(a);alp.setClass(a.target,"oax_hover",!1)}))}function e(){m.pwToggle_install();var a=alp.gEBI("oax-pwd-check");a&&alp.aEL(a,"keyup",alp.bindF(alp.util.pw_check,null,a));alp.nodify("oax-community-exception")&&c.show_exception_msg({msgCode:"community-exception"})}var d=alp.sub("oax.community_layout",
null,!0),b=oa.util,c=b.community,a=b.account,m=b.login,l=b.payment;d.login_install=function(a){alp.onDCL(alp.bindF(m.install,null,a))};d.community_install=function(a){alp.onDCL(alp.bindF(k,null,a))};d.submitLogin_install=function(a){alp.onDCL(alp.bindF(m.async_submit_install,null,a))};d.pwToggle_install=function(a){alp.onDCL(alp.bindF(m.pwToggle_install,null,a))};d.pwConfirm_install=function(a){alp.onDCL(alp.bindF(m.pwConfirm_install,null,a))};d.mypage_install=function(a){alp.onDCL(alp.bindF(g,null,
a))};d.pw_reset_install=function(){alp.onDCL(e)};d.edit_account_email_install=function(){alp.onDCL(function(){h();a.edit_email_install()})};d.edit_account_pw_install=function(){alp.onDCL(function(){h();a.edit_pw_install()})};d.payments_install=function(a){alp.onDCL(alp.bindF(l.install,null,a))};d.get_user_id=function(){return c.get_user_id()};d.login_indicator=c.login_indicator;d.open_login_dialog=function(a){alp.onDCL(alp.bindF(m.open_login,null,a))}})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.iframe_onclick");
(function(){alp.sub("alp.dom",null,!0).wait_for_child_iframe_and_listen_to_click=function(k,h){var g=alp.nodify(k,h),f=alp.event("listen_to_iframe_click",{then:!0});alp.subDfrd(function(){return alp.gEBTN("iframe",g)[0]}).then(function(e){var d,b=0;setInterval(alp.nowF(function(){alp.opt(document,"activeElement")===e?d||(d=!0,f.triggerSoon(++b)):d=!1}),200)});return f}})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.img_srcset");
(function(){var k=alp.sub("alp.dom",null,!0);k.img_srcset=function(d){function b(a){a=a instanceof Array?a:g;for(var b=alp.gViewportSize().width,c=a.length,d=0;d<c;d++){var f=a[d],h=alp.dataset(f),k=f.src||alp.gA(f,"src");h=h[e]||(h[e]=(f.srcset||alp.gA(f,"srcset"))+(k?", "+k:""));h=alp.map(h.split(/\s*,\s*/),"{url:v.split(/\\s+/)[ 0 ] , max:(+((v.match(/(?:\\s+).*?(\\b\\d+)(?:w\\b)/)||[])[1])) || +Infinity}");k=h.length;var m=f.sizes||alp.gA(f,"sizes")||"";m=alp.map(m.match(/\b\d[\.\d]*(?=vw\b)/g)||
[],"parseFloat(v)");m=m.length?Math.max.apply(Math,m):100;var t=f.clientWidth,w=Math.ceil(0<t?t:m/100*b);m=null;var x=Infinity;for(t={};k--;){var y=h[k],z=y.max-w;t[y.url]=z;z<x&&(m=y.url,x=z)}m?(h=f.src||alp.gA(f,"src"),0<t[h]||h===m||(alp.sA(f,"src",f.src=m),alp.rA(f,"srcset"))):console.error("img_srcset: !best_url - maybe a bug, or maybe empty src & srcset.")}}var c=d&&d.topCont;d=d&&(d.eh||d.hg)||(alp.Eh?new alp.Eh:alp.hg());var a;c&&(c=alp.nodify(c));if(null==h){if(h="srcset"in(a=alp.cE("img"))&&
"sizes"in a){k.img_srcset=alp.f();return}d.push(alp.aEL(window,"resize",b));d.push(setInterval(b,345),clearInterval);d.push(alp.onDCL(b))}c=alp.filter(alp.gEBTN("img",c),function(a){var b;if(alp.gA(a,"srcset")&&!(b=alp.dataset(a))[f])return b[f]="done"});b(c);g.push.apply(g,c);return d};var h,g=[],f="oax_img_srcset_filled",e="oax_img_srcset_srcset"})();"undefined"!==typeof dojo&&dojo.provide("alp.view.dialog.common");
(function(){alp.sub("alp.view.dialog",null,!0).InterfaceCommonExport={node:null,title:null,tourid:null,template:null,openModalwin:null,setupInteractivity:null,login_indicator:null,login_open_dialog:null,login_before:null,login_after:null,openModalwinOrLogin:function(k){(k||window.event)&&alp.stopEvent(k||window.event);this.login_indicator&&!this.login_indicator()&&this.hasLoginBarrierSet(k)?(this.login_before&&this.login_before(),this.login_open_dialog()):this.openModalwin(k)},openModalwinAfterLogin:function(k){k=
k||alp.bindF("openModalwin",this);this.login_indicator&&this.login_after&&this.login_indicator()&&this.login_after(k)},googleAdsPrepare:function(k){k&&k.childNodes&&(k=alp.gEBCN("oax_dialog_ad",k)[0])&&"undefined"!=typeof googletag&&((k=alp.gA(k,"id"))&&!googletag[k]?(alp.m(googletag,"display",k),googletag[k]=!0):alp.m(alp.m(googletag,"pubads"),"refresh"))},hasLoginBarrierSet:function(k){return alp.hasClass(k&&k.currentTarget?k.currentTarget:0<this.node.length?this.node[0]:this.node,"oax-login-barrier")}}})();
"undefined"!==typeof dojo&&dojo.provide("alp.view.dialog.gpx");
(function(){var k=alp.sub("alp.view.dialog.gpx",null,!0),h=alp.view.dialog,g=alp.data.api,f=alp.view.modalwin;h.InterfaceGPXExport={original:!1,openModalwin:function(e){(e||(e=window.event))&&alp.stopEvent(e||window.event);this.template=alp.nodify(this.template);e=alp.tmpl(this.template.innerHTML,this);e=alp.cE("div",null,null,{innerHTML:e});var d=alp.gEBCN("oax-hidden-gpx-ready-dialog")[0];d&&(d=alp.cE("div",null,null,{innerHTML:d.innerHTML}),alp.aC(e,d.children[0]));f.open({html:e.innerHTML,onOpenNow:alp.bindF("setupInteractivity",
this)})},setupInteractivity:function(e,d,b){function c(b,c){alp.sA(h,"href",alp.tmpl(l,a)+(c?"&exportWaypoints=true":""))}alp.installNode(null,null,e);var a=this,h=alp.nodify("oax-agbGpxOKButton",e),l=alp.gA(h,"href"),k=alp.gEBCN("oax-dialog",e),n=alp.gEBCN("oax-ready-dialog",e)[0];l=alp.tmpl(l,a)+(a.original?"&original=true":"");alp.sA(h,"href",l);g.token().then(function(a){a&&(l+="&token="+a,alp.sA(h,"href",l))});alp.styleform.init({now:!0,cont:e,oncheck_init:function(a,b,d){d.originalNode.checked=
!1;c(a,!1)},oncheck:c});alp.aEL(h,"click",function(c){(c||(c=window.event))&&alp.stopEvent(c||window.event);alp.cE("iframe",alp.body(),{src:alp.gA(h,"href"),style:"display:none"});n?(alp.setClass(k,oax.NO_DISPLAY,!0),alp.setClass(n,oax.NO_DISPLAY,!1),a.googleAdsPrepare(n)):f.close(b);return!1})}};k.init=function(e){var d=alp.mix({},h.InterfaceCommonExport,h.InterfaceGPXExport);alp.mixCheck(d,e);d.node.a;return d}})();"undefined"!==typeof dojo&&dojo.provide("alp.view.dialog.kml");
(function(){var k=alp.sub("alp.view.dialog.kml",null,!0),h=alp.view.dialog,g=alp.data.api,f=alp.view.modalwin;h.InterfaceKMLExport={openModalwin:function(e){(e||(e=window.event))&&alp.stopEvent(e||window.event);this.template=alp.nodify(this.template);e=alp.cE("div",null,null,{innerHTML:this.template.innerHTML});var d=alp.gEBCN("oax-hidden-kml-ready-dialog")[0];d&&(d=alp.cE("div",null,null,{innerHTML:d.innerHTML}),alp.aC(e,d.children[0]));f.open({html:e.innerHTML,onOpenNow:alp.bindF("setupInteractivity",
this)})},setupInteractivity:function(e,d,b){alp.installNode(null,null,e);var c=this,a=alp.nodify("oax-agbKmlOKButton",e),h=alp.gA(a,"href"),l=alp.gEBCN("oax-dialog",e),k=alp.gEBCN("oax-ready-dialog",e)[0];this.tourid&&(h=alp.tmpl(h,this||{}),alp.sA(a,"href",h));g.token().then(function(b){b&&(h+="&token="+b,alp.sA(a,"href",h))});alp.aEL(a,"click",function(d){(d||(d=window.event))&&alp.stopEvent(d||window.event);alp.cE("iframe",alp.body(),{src:alp.gA(a,"href"),style:"display:none"});k?(alp.setClass(l,
oax.NO_DISPLAY,!0),alp.setClass(k,oax.NO_DISPLAY,!1),c.googleAdsPrepare(k)):f.close(b);return!1})}};k.init=function(e){var d=alp.mix({},h.InterfaceCommonExport,h.InterfaceKMLExport);alp.mixCheck(d,e);d.node.a;return d}})();"undefined"!==typeof dojo&&dojo.provide("alp.i.i_slide_list");
(function(){function k(a,b){null!=b||(b=0);b.toPrecision.call.a;return Math.max(0,Math.min(h(a),b))}function h(a){var b=a._noli,c=b.length;return 2>c?0:c-g(b,a._list)}function g(a,b){var c=a.length;c.toPrecision.call.a;var d=0,e=0;b=b.clientWidth;if(0<b)for(var f;++e<=c&&0<(f=a[c-e].clientWidth);){var g=b-d;d+=f;if(Math.abs(g)<Math.abs(b-d)){e--;2<c&&b<a[c-1].clientWidth+a[c-2].clientWidth&&e--;break}}e>c&&(e=c);0<e&&e<=c||(e=1);return e}function f(a,b,c){a?a.set(b,c):b.set(c)}var e=alp.dom.anchor,
d=alp.Later,b=["change_cb","chen"],c=["change_cb_init","chenInit"];alp.sub("alp.i",null,!0).ISlideList={cont:null,prev:"oax-slide-list-prev",next:"oax-slide-list-next",list:"oax-slide-list",item:"oax-slide-list-item",idrx:/(?:^|\s)oax-id-(\S+)(?:\s|$)/,invisibleClass:null,alignLastItemRight:!1,wrap:!0,postProcess:null,showPrev:function(){this.show(this.m.index.get()-1)},showNext:function(){this.show(this.m.index.get()+1)},show:function(a){var b=this.m.index;a=k(this,a);d?alp.now.set(b,a):b.setNow(a)},
i_connectView2Model:function(a,b,c,d){b.push(alp.aEL(a._prev,"click",alp.bindF("showPrev",a)));b.push(alp.aEL(a._next,"click",alp.bindF("showNext",a)));var e=alp.nowF(function(b){var d=0<a.cont.clientWidth&&0<a.cont.clientHeight;d?f(b,c._domvis,d):setTimeout(e,257)});e()},setInitVal:function(a){return function(){var b=(d?[]:[null]).concat([].slice.call(arguments));return a.apply(this,b)}}(function(a,b,c,d,g){b._prev=alp.gEBCN(b.prev,b.cont);b._next=alp.gEBCN(b.next,b.cont);b._list=alp.nodify(b.list,
b.cont);b._list.childNodes.a;b._noli=alp.gEBCN(b.item,b._list);b.wrap&&alp.forEach(b._noli,function(a){return e.wrap_ooi_snippet(a,{filterHrefId:!1})});b.postProcess&&alp.forEach(b._noli,function(a){return b.postProcess(a,b)});f(a,d.n,b._noli.length);f(a,d.index,k(b,d.index.get()));alp.setClass(b._prev,"alp-x-clickable",!0);alp.setClass(b._next,"alp-x-clickable",!0)}),connectModel2View:function(a,d,e,f){function l(){var b=e.index.get(),c=1>b?0:a._noli[b].offsetLeft-a._noli[0].offsetLeft;if(a.alignLastItemRight){var d=
a._noli.length*a._noli[0].clientWidth-a._list.clientWidth;c>d&&(c=d)}alp.style(a._list,{transform:"translate3d(-"+c+"px,0,0)"});k(a._prev,0<b);k(a._next,b<h(a));b=a.cont;d=a._noli;c=d.length;d=g(d,a._list);alp.setClass(b,"oax_slide_list_inactive",!(d<c))}function k(b,c){var d=a.invisibleClass;d?alp.setClass(b,d,!c):alp.style(b,{visibility:c?"":"hidden"});alp.setClass(b,"oax_no_display",!1);alp.style(b,{display:""})}d.push(alp.m(e.index,c,l));d.push(alp.m(e._domvis,b,l))},connectPureView:function(a,
b,c,d){b.push(alp.aEL(a._prev,"selectstart",alp.stopEvent));b.push(alp.aEL(a._next,"selectstart",alp.stopEvent))}};alp.i.ISlideList.install=function(a){var b=this;return alp.map(alp.gEBCN("oax-slide-list-cont",a&&a.cont),function(c){var d=c.dataset;if(d){if(d._alp_x_slide_list)return;d._alp_x_slide_list="done"}return new b({cont:c,invisibleClass:null===(a&&a.invisibleClass)?null:"oax_inactive",postProcess:a&&a.postProcess,wrap:!(a&&a.postProcess),alignLastItemRight:a&&a.alignLastItemRight,initNow:!0})})}})();
"undefined"!==typeof dojo&&dojo.provide("alp.x.slide_list");(function(){alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.SlideList",alp.x.AbstractController,null,alp.i.ISlideList,{cont:null,augmentModel:function(k){this.cont.childNodes.a;k.index=new alp.NumberState;k.n=new alp.NumberState;k._domvis=new alp.BoolState},connectView2Model:function(k,h,g,f){k.i_connectView2Model(k,h,g,f)}});alp.x.SlideList.install=alp.i.ISlideList.install})();"undefined"!==typeof dojo&&dojo.provide("oa.track_tab");
(function(){var k=alp.sub("oa.track",null,!0),h=alp.data;k.clickTab=function(g){function f(d){var e=alp.gEBCN(oa.TAB_CB,b);alp.forEach(e,function(e){function f(){var e=alp.filter(alp.gEBTN("label",b),'alp.gA(v,"for")==="'+h+'"')[0];e=e&&alp.textContent(e)||h;var f=d.maintype,g="tour"!==f?f:f+" ("+alp.oGet(d,"data.category.name")+")";a({conttype:c,action:"tab: "+g+" > "+e,tablabel:e,maintype:f,fulltype:g})}var g=alp.dataset(e),l="oaxtabcb_done_"+k,h=e.id;g[l]||(g[l]=!0,h&&alp.aEL(e,"change",f))})}
var e=g.id,d=g.proj,b=g.cont,c=g.conttype,a=g.callback,k=g.callsort||g.callback.name;alp.and([e,d,c,k],"(v||null).substring.call.a");a.call.a;e===oa.ID_NONE?f({maintype:"list"}):(new h.SingleOOI(e,{proj:d,acceptUnpublished:!0})).load(f)}})();"undefined"!==typeof dojo&&dojo.provide("oa.content_track");
(function(){var k=alp.sub("oa.content_track",null,!0),h=oa.track,g=alp.content;k.clickTab=function(f){var e=f.proj,d=f.id;(e||null).substring.call.a;(d||null).substring.call.a;h.clickTab(alp.oCreateMix(f,{callback:function(b){g.trackDetailTab(alp.oCreateMix({proj:e,id:d,nocache:!0},b))}}))}})();"undefined"!==typeof dojo&&dojo.provide("alp.util.json");
(function(){function k(b){return d[b]}function h(b){if(void 0!==b){if(null===b)return"null";var c=typeof b;if("number"===c||"boolean"===c)return""+b;if("string"===c)return'"'+b.replace(e,k)+'"';if("function"===c)return null;if(b.nodeType&&b.cloneNode)throw Error("Can't serialize DOM nodes");if(b.toJSON&&b.toJSON.call)return h(b.toJSON());if(b instanceof Array){var a=b.length;c=Array(a);for(var d=0;d<a;d++)c[d]=h(b[d]);return"["+c.join(",")+"]"}c=[];for(a in b)if(!(a in f)){var g=b[a];void 0!==g&&
"function"!==typeof g&&(d='"'+("number"===typeof a?a:a.replace(e,k))+'"',g=h(g),c.push(d+":"+g))}return"{"+c.join(",")+"}"}}var g=alp.sub("alp.util.json",null,!0);g.stringify="undefined"!==typeof JSON&&JSON.stringify&&JSON.stringify.call?alp.bindF("stringify",JSON):h;g.stringifySafe=function(b){var c=!1;try{var a=b&&g.stringify(b)||"";c=/\b(undefined|NaN)\b/.test(a)}catch(m){c=!0}return c?g.stringify(alp.oUndefToNull(alp.oDropNaN(b))):a};var f={},e=/[\b\f\n\r\t"\\]/g,d={"\b":"\\b","\f":"\\f","\n":"\\n",
"\r":"\\r","\t":"\\t",'"':'\\"',"\\":"\\\\"}})();"undefined"!==typeof dojo&&dojo.provide("oa.ga_track_anonymous");
(function(){function k(b,c,a){a=a&&a.eh;var d=this.cont,e=this.conttype;d.childNodes.a;(e||null).substring.call.a;b="string"===typeof b?alp.gEBCN(b,d):alp.fVal(b,d);alp.m(a,"push",alp.aELtouchup(b,function(){g.emitCustomClick(e,c)},!0,{doNotStop:!0}))}function h(b,c,a,d){var e="function"===typeof alp.sub("_gaq.push"),f="function"===typeof alp.sub("ga");oa.API_SAMEHOST&&(e||f)&&(f?ga("send","event",b,c,a,d):e&&_gaq.push(["_trackEvent",b,c,a,d]))}var g=alp.sub("oa.ga_track_anonymous",null,!0),f=oa.track;
g.CLICK=function(){return oa.PREFIX+".api.click"};g.DETAIL="detail";g.FLEXVIEW="flexview";g.init=function(){function b(a,b,c,d){var e="livejserror ("+oa.PREFIX+")";b+=isFinite(c)?":(line:"+c+(isFinite(d)?",col:"+d:"")+")":"";"function"===typeof alp.sub("ga")?ga("send","exception",{exDescription:e+": "+a+", "+b,exFatal:!1}):h(e,a,b);console.log("OG_onerror: "+["category: "+e,"action: "+a,"label: "+b].join(" ### "))}if(!d){d=!0;var c=window.onerror;window.onerror=function(){if("function"!==typeof c)return b.apply(window,
arguments);try{var a=c.apply(window,arguments)}finally{b.apply(window,arguments)}return a}}};g.installTrackClick=k;g.installTrackClickMany=function(b,c,a){alp.forIn(c,function(c,d){k.call(b,c,d,a)})};g.installTrackClickOutbound=function(b){var c=b.conttype;b.cont.childNodes.a;(c||null).substring.call.a;alp.forEach(alp.gEBCN(oa.OUTBOUND),function(a){var b=a.className.match(oa.OUTBOUND_RX)[1];(b||null).substring.call.a;var d="outbound: "+b;alp.aELtouchup(a,function(){g.emitCustomClick(c,d)},!0,{doNotStop:!0})})};
g.installTrackClickTab=function(b){f.clickTab(alp.oCreateMix(b,{callback:function(b){g.emitCustomClick(b.conttype,b.action)}}))};g.emitCustom=h;g.emitCustomClick=function(b,c){var a;null!=e&&(a=(new Date-e)/1E3);h(alp.fVal(g.CLICK)+"."+b,c,location.href,a)};g.emitCustomAction=function(b,c){var a;null!=e&&(a=(new Date-e)/1E3);h(b,c,location.href,a)};var e,d})();"undefined"!==typeof dojo&&dojo.provide("oa.util.my");
(function(){function k(f){alp.aEL(alp.gEBCN("oax-confirm-delete",f),"click",function(e){e||(e=window.event);var d=alp.opt(h,"confirm_delete");confirm(d)||alp.stopEvent(e)});return f}var h;oa.util.to(alp.i18n.fetch("alp.all"),function(f){h=f});var g=alp.sub("oa.util.my",null,!0);g.addDeleteConfirm=k;g.toursPostProcess=function(f,e){alp.dom.anchor.wrap_ooi_snippet(f);f=k(f);var d=alp.nodify(oa.SHARE_BTN,f);d&&new oa.x.ShareBtn({proj:e.proj,node:d,initNow:!0,track_type:e.frontendtype});return f}})();
"undefined"!==typeof dojo&&dojo.provide("oa.util.touch");(function(){alp.sub("oa.util",null,!0).setTouchSupportClass=function(k){alp.setClass(k,oa.TOUCH_SUPPORT_CLASS,alp.supportsTouch())}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.webapp_header");
(function(){alp.sub("oa.util",null,!0).webappHeaderSetup=function(k,h,g){function f(){alp.setClass(e,"oax_no_height",!0);alp.locStoCookie(d,"closed")}(g||null).substring.call.a;var e=alp.gEBCN(oa.WEBAPP_HEADER,h);h=alp.gEBCN(oa.WEBAPP_HEADER_CLOSE,h);var d=oa.WEBAPP_HEADER_LOCSTO+g;alp.locStoCookie(d)?alp.setClass(e,"oax_no_height",!0):(alp.forEach(e,"alp.installNode(0,0,v)"),h.length&&k.push(alp.aEL(h,"click",f)),alp.setClass(e,"oax_no_height",!1))}})();"undefined"!==typeof dojo&&dojo.provide("oax.selectors");
(function(){function k(h,g){function f(e,d,b){alp.gBCR(e);b=alp.gWindowScroll();var c=alp.gBCR(alp.gEBCN("oax-filter-selectors-wrapper")[0]||alp.gEBCN("oax-selectors")[0]);e=b.left+c.left;b=Math.round(b.top+c.top+c.height);e={position:"absolute",left:alp.isRTL()?"auto":e+"px",right:alp.isRTL()?e+"px":"auto",top:b+"px"};alp.mix(d.style,e);null!=alp.gEBCN("oax-selectors-wrapper")[0]&&alp.setClass(d,"oax_large_what_dropdown",!0)}h=alp.gEBCN("oax-what-button")[0];g=alp.gEBCN("oax-what-dropdown")[0];h&&
g&&alp.view.tooltip({select:h,extract:g,className:"alp-view-tooltip oax-what-dropdown-wrapper",place_f:f,top_wrap:"oax",dom_event_open:"click",dom_event_close:"click",open_toggle:!0})}alp.sub("oax.selectors",null,!0).install=function(h,g){alp.onDCL(alp.bindF(k,null,h,g))}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.basket");
(function(){function k(g){g.title.substring.a;g=alp.mix({},g);delete g.proj;g.proj&&delete g.proj;g.userid&&delete g.userid;g.basketid&&delete g.basketid;return alp.util.json.stringify(g)}var h=alp.sub("alp.data.api",null,!0);h.basketAdd=function(g,f){g.proj.substring.a;g.userid.substring.a;g.ooiid.substring.a;var e=alp.dfrd("ADA:basketAdd",{then:1});alp.m(h.token(),["to","then"],function(d){d=alp.cfg.url.api_write_basket_add({proj:g.proj,token:d,userid:g.userid,ooiid:g.ooiid,basketid:g.basketid||
"default"});alp.m(alp.xhrPut(d,alp.oCreateMix(f||{},{receiveJson:!0})),["to","then"],alp.bindF("done",e))});return e};h.basketRemove=function(g,f){g.proj.substring.a;g.userid.substring.a;g.ooiid.substring.a;var e=alp.dfrd("ADA:basketRemove",{then:1});alp.m(h.token(),["to","then"],function(d){d=alp.cfg.url.api_write_basket_remove({proj:g.proj,token:d,userid:g.userid,ooiid:g.ooiid,basketid:g.basketid||"default"});alp.m(alp.xhrGet(d,alp.oCreateMix(f||{},{receiveJson:!0})),["to","then"],alp.bindF("done",
e))});return e};h.basketCreate=function(g,f){g.proj.substring.a;g.userid.substring.a;var e=alp.dfrd("ADA:basketCreate",{then:1});alp.m(h.token(),["to","then"],function(d){d=alp.cfg.url.api_write_basket_create({proj:g.proj,token:d,userid:g.userid});var b=k(g);alp.m(alp.xhrPost(d,alp.oCreateMix(f||{},{sendData:b,receiveJson:!0})),["to","then"],alp.bindF("done",e))});return e};h.basketDelete=function(g,f){g.proj.substring.a;g.userid.substring.a;var e=alp.dfrd("ADA:basketDelete",{then:1});alp.m(h.token(),
["to","then"],function(d){d=alp.cfg.url.api_write_basket_deleteUpdate({proj:g.proj,token:d,userid:g.userid,basketid:g.basketid});alp.m(alp.xhrDelete(d,alp.oCreateMix(f||{},{receiveJson:!0})),["to","then"],alp.bindF("done",e))});return e};h.basketClean=function(g,f){g.proj.substring.a;g.userid.substring.a;g.basketid.substring.a;var e=alp.dfrd("ADA:basketClean",{then:1});alp.m(h.token(),["to","then"],function(d){d=alp.cfg.url.api_write_basket_clean({proj:g.proj,token:d,userid:g.userid,basketid:g.basketid});
alp.m(alp.xhrGet(d,alp.oCreateMix(f||{},{receiveJson:!0})),["to","then"],alp.bindF("done",e))});return e};h.basketFavUnfav=function(g,f,e){var d=f.proj,b=f.userid,c=f.basketid;alp.forEach([d,b,c],"(v||null).substring.call.a");var a=alp.dfrd("ADA:basketFav",{then:1});alp.m(h.token(),["to","then"],function(f){f=alp.cfg.url.api_write_basket_fav_unfav({do_fav:g,proj:d,token:f,userid:b,basketid:c});alp.m(alp.xhrPut(f,alp.oCreateMix(e||{},{receiveJson:!0})),["to","then"],alp.bindF("done",a))});return a};
h.basketUpdate=function(g,f){g.proj.substring.a;g.userid.substring.a;var e=alp.dfrd("ADA:basketUpdate",{then:1});alp.m(h.token(),["to","then"],function(d){d=alp.cfg.url.api_write_basket_deleteUpdate({proj:g.proj,token:d,userid:g.userid,basketid:g.basketid});var b=k(g);alp.m(alp.xhrPut(d,alp.oCreateMix(f||{},{sendData:b,receiveJson:!0})),["to","then"],alp.bindF("done",e))});return e};h.basketGet=function(g,f){(g.proj||0).substring.call.a;(g.userid||0).substring.call.a;var e=alp.dfrd("ADA:basketGet",
{then:1});alp.m(h.token(),["to","then"],function(d){d=alp.cfg.url.api_read_basket_get({proj:g.proj,token:d,userid:g.userid,basketid:g.basketid||"default"});alp.m(alp.xhrGet(d,alp.oCreateMix(f||{},{receiveJson:!0})),["to","then"],alp.bindF("done",e))});return e}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_basket");
(function(){function k(a,b){b||(b=window.event);alp.stopEvent(b);b=alp.opt((b.target||b.srcElement).className.match(oa.ID_RX),1);h({listid:b,proj:a.proj,userid:a.userid,basketid:b,topCont:a.topCont})}function h(a){function b(b){if(200!==b.status){var c="Basket: delete failed ("+b.status+")";console.error(c,b);throw Error(c,b);}a.listid==a.basketid?(b=alp.gEBCN("oax-basket-defaulturl",a.topCont)[0],window.location=b.value):window.location.reload()}var c=alp.opt(n,"list.confirmDeletion");confirm(c)&&
w.to(q.basketDelete(a,{throwError:!1}),b)}function g(a,b,d){b=d.target||d.srcElement;b=/^li$/i.test(b.tagName)?b:b.parentNode;b=/^li$/i.test(b.tagName)?b:b.parentNode;b=alp.opt(b.className.match(oa.ID_RX),1);w.setNow(a.m.selectedBasket,b);c(a)}function f(a,b){function c(){alp.setClass(f,oa.NO_DISPLAY,!1);alp.setClass(k,oa.NO_DISPLAY,!1);alp.setClass(l,oa.NO_DISPLAY,!1);alp.setClass(h,oa.NO_DISPLAY,!0);alp.orphan(m)}function d(){var b=alp.sTrim(m.value);0===b.length?a.showNotification("missing-basket-title"):
w.to(q.basketUpdate({proj:a.proj,userid:a.userid,title:b,basketid:g},{throwError:!1}),function(b){if(200!==b.status){var c="Basket: update failed ("+b.status+")";console.error(c,b);a.showNotification("default-error","danger");throw Error(c,b);}window.location.reload()})}b||(b=window.event);alp.stopEvent(b);var e=b.target||b.srcElement,f=e,g=alp.opt(e.className.match(oa.ID_RX),1);e=/^li$/i.test(e.tagName)?e:e.parentNode;b=e=/^li$/i.test(e.tagName)?e:e.parentNode;var l=alp.gEBCN(oa.DELETE_LIST,b),h=
alp.gEBCN("oax-abort",b);alp.setClass(l,oa.NO_DISPLAY,!0);alp.setClass(h,oa.NO_DISPLAY,!1);alp.aEL(h,"click",function(a){a||(a=window.event);alp.stopEvent(a);c()});alp.setClass(f,oa.NO_DISPLAY,!0);e=alp.gEBTN("a",b)[0];var k=alp.gEBTN("span",b)[0];alp.aEL(e,"click",function(a){a||(a=window.event);alp.stopEvent(a);return!1});alp.setClass(k,oa.NO_DISPLAY,!0);var m=alp.cE("input",e,{"class":"oax_new_list_title"});m.focus();alp.aEL(m,"keyup",function(a){13==a.which&&d();27==a.which&&c()})}function e(b,
c){function e(a,c){b.ovCont=a;b.ovWrap=c;c=alp.gEBTN("li",a);alp.aEL(c,"click",alp.bindF(g,null,b,c));alp.aEL(alp.gEBCN("oax-basketlist-add-action-newlist",a),"click",alp.bindF(d,null,b,null,!1,a))}function f(){b._creating=!1;w.setNow(l,[])}b._creating=!1;var l=b.m.selectedIds,h=alp.arr2oSimple(l.get());c=alp.filter(c.split(","),"v && !(v in this)",h);c.length&&w.setNow(l,l.get().concat(c));w.to(a(b,b.basketAddDialogTmpl),function(a){a=r(a,b.basketid);b._mowi=v.open({html:a,onOpenNow:e,onCloseLater:f,
extraClass:"oax_addToList_dialog"})})}function d(a,b,c,d){function e(a){a||(a=window.event);a.keyCode===t&&f(a)}function f(a){(r||(r=alp.nowF(g)))(a)}function g(b){function c(b){null!=d&&alp.rEL(d);alp.m(a,"stopWait");a._adding=!1;if(200!==b.status){var c="Basket: adding failed ("+b.status+")";console.error(c,b);a.showNotification("default-error","danger");throw Error(c,b);}m(a);a.showNotification("created-and-added","success",b.responseJson.id,b.responseJson.title)}p.emitCustomClick(oa.LIST,"add-entry-to-new-list");
b=h.value;if(0===b.length)a.showNotification("missing-basket-title","warning");else{alp.sA([h,k],"disabled","disabled");w.to(q.basketCreate({proj:a.proj,userid:a.userid,title:b},{throwError:!1}),function(b){if(200!==b.status||!b.responseJson.id){var e="Basket: creation failed ("+b.status+")";console.error(e,b);a.showNotification("default-error","danger");throw Error(e,b);}a._creating=!1;b=b.responseJson.id;a._adding?console.error("Basket: already adding... Simply ignoring the user click, because the backend answer should come soon anyway."):
(a._adding=!0,alp.m(a,"startWait"),d=alp.dom.windowExitIntercept(alp.opt(n,"upload_abort_situation")),b={proj:a.proj,userid:a.userid,basketid:b,ooiid:a.m.selectedIds.get().join(",")},w.to(q.basketAdd(b,{throwError:!1}),c))});var d}}var l=alp.gEBCN("oax-basketlist-add-action-newlist",d)[0],h=alp.gEBCN("oax-basketlist-add-action-newlist-title",d)[0];alp.setClass(l,oa.NO_DISPLAY,!0);h.focus();if(!a._creating){a._creating=!0;alp.gEBCN("oax-basketlist-add-action-newlist-wrapper",d);b=alp.gEBCN("oax-basketlist-add-action-newlist-cancel",
d)[0];var k=alp.gEBCN("oax-basketlist-add-action-newlist-save",d)[0];alp.aEL(b,"click",function(a){alp.setClass(l,oa.NO_DISPLAY,!1)});alp.aEL(k,"click",f);alp.aEL(h,"keyup",e)}var r}function b(b,c,d,e){function f(a){a=r(a,b.basketid);b._mowi=v.open({html:a,onOpenNow:g,onCloseLater:l})}function g(a,c){b.ovCont=a;b.ovWrap=c;n=alp.gEBCN("oax-basketlist-add-action-newlist-title",a)[0];p=alp.gEBCN("oax-basketlist-add-action-newlist-save",a)[0];setTimeout(function(){n.focus()},1E3);b._creating=!0;alp.aEL(p,
"click",k);alp.aEL(n,"keyup",h)}function l(){b._creating=!1}function h(a){a||(a=window.event);a.keyCode===t&&k(a)}function k(a){(u||(u=alp.nowF(m)))(a)}function m(a){if(0===n.value.length)b.showNotification("missing-basket-title","warning");else{alp.sA([n,p],"disabled","disabled");var c=alp.gEBCN("oax-redirect-tmpl",b.ovCont)[0].value;w.to(q.basketCreate({proj:b.proj,userid:b.userid,title:n.value},{throwError:!1}),function(a){if(200!==a.status||!a.responseJson.id){var d="Basket: creation failed ("+
a.status+")";console.error(d,a);b.showNotification("default-error","danger");throw Error(d,a);}b._creating=!1;location.href=alp.tmpl(c,{id:a.responseJson.id})})}}var n,p;alp.now(function(){b._creating=!1;w.to(a(b,b.listCreateDialogTmpl),f)});var u}function c(a){if(a._adding)console.error("Basket: already adding... Simply ignoring the user click, because the backend answer should come soon anyway.");else{var b=a.m.selectedBasket.get();if(b){a._adding=!0;alp.m(a,"startWait");var c=alp.dom.windowExitIntercept(alp.opt(n,
"upload_abort_situation")),d={proj:a.proj,userid:a.userid,basketid:b,ooiid:a.m.selectedIds.get().join(",")};w.to(q.basketAdd(d,{throwError:!1}),function(d){null!=c&&alp.rEL(c);alp.m(a,"stopWait");a._adding=!1;if(200!==d.status){var e="Basket: adding failed ("+d.status+")";console.error(e,d);a.showNotification("default-error","danger");throw Error(e,d);}m(a);a.showNotification("added","success",d.responseJson.id,d.responseJson.title,b)});p.emitCustomClick(oa.LIST,"add-entry-to-list "+b)}else a.showNotification("select-basket",
"warning")}}function a(a,b){function c(a){a=a.answer;if("ok"!==a.status)throw Error("basket got an error status:"+a.status+", code:"+a.code+" while fetching markup from URL: "+e);a=a.html;b&&(a=alp.nodify(b,alp.cE("div",null,null,{innerHTML:a})).innerHTML);d.done(a)}(b||null).substring.call.a;var d=alp.dfrd("OAB:AddDialog",{then:1});if(a=alp.nodify(b))alp.now(d.done,d,a.innerHTML);else{var e=alp.tmpl(oa.BASKET_ADD_DIALOG_MARKUP_JSONP_URL_TMPL,{plugintype:oa.PLUGINTYPE});w.to(alp.jsonp(e,{cache:!1}),
c)}return d}function m(a){alp.m(a._mowi,"close");alp.orphan(a.ovWrap)}function l(b,c,d,e,f){var g=this;w.to(a(g,g.basketNotificationClassPrefix+b),function(a){if(a){var l="oax-humane-list";if(a&&0<a.length){c&&(l=l+" oax-humane-"+c);if(d){if(f&&"default"!=f)a=a.replace("###listId###",d),a=a.replace("###optToBasket###","");else if(f&&"default"==f){var h="alpcms"===g.proj;a=a.replace("###listId###",h?"?page=basket":d);-1!=a.indexOf("###optToBasket###")&&(a=a.replace("###optToBasket###",h?"":"?page=basket/basket/"))}else a=
a.substring(0,a.indexOf("<br"));e&&(a=a.replace("###listTitle###",e))}alp.humane(a,{extraClass:l})}}"default-error"==b&&setTimeout(function(){window.location.reload()},5E3)})}function r(a,b){if(!b||"default"===b)return a;a=alp.cE("div",null,null,{innerHTML:a});(b=alp.gEBCN(oa.ID_PREFIX+b,a))&&b.length&&alp.orphan(b);return a.innerHTML}var n,q=alp.data.api,p=oa.ga_track_anonymous,v=alp.view.modalwin,u=oa.BASKETID_DEFAULT,t=alp.key.ENTER,w=alp.i.state,x={OAB_addToList:e,OAB_cleanList:function(a,b){b||
(b=window.event);alp.stopEvent(b);w.to(q.basketClean({proj:a.proj,userid:a.userid,basketid:a.basketid},{throwError:!1}),function(b){if(200!==b.status){var c="Basket: cleaning failed ("+b.status+")";console.error(c,b);a.showNotification("default-error","danger");throw Error(c,b);}window.location.reload()})},OAB_deleteFromList:function(a,b,c){c||(c=window.event);c=a.m.selectedIds;w.setNow(c,alp.filter(c.get(),'v  &&  v !== "'+b+'"'));w.to(q.basketRemove({proj:a.proj,userid:a.userid,basketid:a.basketid,
ooiid:b},{throwError:!1}),function(b){if(200!==b.status){var c="Basket: removing failed ("+b.status+")";console.error(c,b);a.showNotification("default-error","danger");throw Error(c,b);}window.location.reload()})}};w.to(alp.i18n.fetch("alp.all"),function(a){n=a});alp.sub("oa.i",null,!0).IBasket={proj:null,userid:null,basketid:null,topCont:null,basketNotificationClassPrefix:"oax-bn-",basketAddDialogTmpl:"oax-basketlist-add-tmpl",listCreateDialogTmpl:"oax-list-create-tmpl",basketListClass:"oax-basketlist",
showNotification:l,addEventListener:function(a,b){alp.aEL(b.target,b.type,alp.bindF(b.func,x,a,b.ooiid))},startWait:null,stopWait:null,addToList:function(a){(a||null).substring.call.a;e(this,a)},augmentModel:function(a){a.selectedIds=w.state([]);a.selectedBasket=w.state();a.currentBasket=w.state(this.basketid);a.altDeleteLabel=w.state();var b=alp.gEBCN("oax-basket-alternate-delete-label",this.topCont)[0];b&&a.currentBasket.get()!==u&&w.setNow(a.altDeleteLabel,b.value)},augmentKids:function(a){this.userid.a;
this.basketid&&this.basketid.a},connectModel2View:function(a,c,d,e){oa.util.community.generic_login_barrier_after({type:"PRO:Redirect"},alp.bindF(b,null,a,null,!0,a.topCont))},connectView2Model:function(a,c,d,e){c.push(alp.aEL(alp.gEBCN("oax-create-list",a.topCont),"click",alp.bindF(b,null,a,null,!0,a.topCont)));c.push(alp.aEL(alp.gEBCN(oa.DELETE_LIST,a.topCont),"click",alp.bindF(k,null,a)));c.push(alp.aEL(alp.gEBCN("oax-rename-basket",a.topCont),"click",alp.bindF(f,null,a)))}};oa.i.IBasket.deleteList=
h;oa.i.IBasket.showNotivication=l})();"undefined"!==typeof dojo&&dojo.provide("oax.x.basket");
(function(){alp.declare("oax.x.Basket",alp.x.AbstractController,null,oa.i.IBasket,{proj:null,userid:null,basketid:null,topCont:null,startWait:function(){var k=this.ovCont;(this._waitbox||(this._waitbox=new alp.x.Waitbox)).setTarget(k).startWait()},stopWait:function(){var k=this._waitbox;k&&k.stopWait().setTarget(null)},postProcessSnippet:function(k){var h=this,g=alp.gEBCN(oax.DETAILPANE_MAPLIST_SNIPPET,k)[0],f=g&&alp.opt(g.className.match(oax.ID_RX),1);if(g)if(f){alp.styleform.init({cont:k,oncheck:function(d,
b){alp.nowF(function(){b?alp.m(h.m.selectedIds,"add",f):alp.m(h.m.selectedIds,"remove",f)})(h,f)}});var e=h.m.altDeleteLabel.get();e&&alp.forEach(alp.gEBCN("oax-confirm-delete",k),function(d){d.innerHTML=e});h.addEventListener(h,{target:alp.gEBCN("oax-confirm-delete",k),type:"click",func:"OAB_deleteFromList",ooiid:f});h.addEventListener(h,{target:alp.gEBCN("oax-add-to-list",k),type:"click",func:"OAB_addToList",ooiid:f})}else throw console.error("Basket: cannot get ooiid for domnode",k),Error("Basket: cannot get ooiid for domnode",
k);else h.addEventListener(h,{target:alp.gEBCN("oax-confirm-delete",k),type:"click",func:"OAB_cleanList",ooiid:f});return k}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.ooi_adder_basket2");
(function(){function k(e,d){d&&alp.stopEvent(d);d=e._basket||(e._basket=new oax.x.Basket({proj:e.proj,userid:e.userid,basketid:e.from_list||null,topCont:e.cont}));console.log("xxx b.addToList( that.ooiid )");d.addToList(e.ooiid)}function h(e){if(e._adding)console.error("OoiAdderBasket2: already adding... Simply ignoring the user click, because the backend answer should come soon anyway.");else{e._adding=!0;var d=e.cont;(e._waitbox||(e._waitbox=new alp.x.Waitbox)).setTarget(d).startWait();var b=alp.dom.windowExitIntercept(f.upload_abort_situation);
g.basketAdd({proj:e.proj,userid:e.userid,ooiid:e.ooiid,basketid:e.from_list},{throwError:!1}).then(function(c){null!=b&&alp.rEL(b);e._waitbox.stopWait().setTarget(null);e._adding=!1;if(200!==c.status){var a="OoiAdderBasket2: publishing failed ("+c.status+")";console.error(a,c);throw Error(a,c);}e.showSucc&&oa.i.IBasket.showNotification("added","success",c.responseJson.id,c.responseJson.title,"")})}}var g=alp.data.api,f={};alp.i18n.fetch("alp.all").then(function(e){f=e});alp.declare("oax.x.OoiAdderBasket2",
alp.x.AbstractController,null,{cont:null,proj:null,ooiid:null,userid:null,buttonAddToList:oax.ADD_TO_LIST,from_list:null,showSucc:!1,augmentKids:function(e){this._button=alp.gEBCN(this.buttonAddToList,this.cont)},connectView2Model:function(e,d,b,c){d.push(alp.aEL(e._button,"click",alp.bindF(k,null,e)))}});oax.x.OoiAdderBasket2.add=function(e){e=new oax.x.OoiAdderBasket2(alp.oCreateMix({cont:alp.cE("div")},alp.opt(e,["proj","ooiid","userid","from_list","showSucc"])));e.init();h(e)};oax.x.OoiAdderBasket2.addToList=
function(e){e=new oax.x.OoiAdderBasket2(alp.oCreateMix({cont:alp.cE("div")},alp.opt(e,["proj","ooiid","userid","from_list"])));e.init();k(e)}})();"undefined"!==typeof dojo&&dojo.provide("oax.util.basket_add_or_login");
(function(){var k=alp.sub("oax.util",null,!0),h=oax.community_layout;k.basket_add_or_login=function(f,e){var d=alp.hasClass(f,oax.ADD_BASKET_CONT)?[f]:alp.gEBCN(oax.ADD_BASKET_CONT,f),b=e&&e.from_list;alp.forEach(d,function(c){function a(a){alp.stopEvent(a||window.event);h.open_login_dialog({context:"basket",contentId:l})}var d=alp.dataset(c);if(!d[g]){d[g]=!0;d=e&&e.proj||oax.API_CFG.proj;var l=e&&e.ooiid||oax.ID_FROM_DOMNODE(f);(d||0).substring.call.a;(l||0).substring.call.a;if(h.login_indicator()){var k=
h.get_user_id();(k||0).substring.call.a;new oax.x.OoiAdderBasket2({initNow:!0,cont:c,proj:d,ooiid:l,userid:k,from_list:b||null})}else alp.aEL(c,"click",a)}})};k.setup_many_basket_adders=function(f){function e(d){var b=alp.opt(oax.ID_RX.exec(d.className),1);b&&k.basket_add_or_login(d,{proj:oax.API_CFG.proj,ooiid:b})}f||(f=alp.body());alp.hasClass(f,"oax-id")&&e(f);alp.forEach(alp.gEBCN("oax-id",f),e)};var g="basket_setup_done"})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_share_btn");
(function(){var k=alp.content,h=alp.data,g=alp.view.modalwin,f=oa.ga_track_anonymous;alp.sub("oa.i",null,!0).IShareBtn={proj:null,node:null,track_type:null,do_not_track:!1,openShareDialog:function(e){e=(e=e&&e.answer)&&/^ok$/i.test(e.status)&&e.html;(e||null).substring.call.a;g.open({html:e});k.track({id:this._id,proj:this.proj,aspect:"share"})},augmentModel:function(e){e=this.node;this._id=oa.ID_RX.exec((e instanceof Array||!e.childNodes?e[0]:e).className)[1];alp.forEach(["_id"],"(this[v]  ||  null).substring.call.a",
this)},connectView2Model:function(e,d,b,c){var a=e._id;(a||null).substring.call.a;d.push(alp.aEL(e.node,"click",function(b){function c(b){var c=b&&alp.oGet(b,"data.meta.workflow.state");b=e.track_type||b&&alp.oGet(b,"data.frontendtype");(c||null).substring.call.a;(b||null).substring.call.a;f.emitCustomClick(b,"share-"+("published"===c?"public":"private")+" "+a)}b&&alp.stopEvent(b);alp.m(alp.jsonp(alp.tmpl(oa.SHARE_MARKUP_JSONP_URL,{id:e._id,plugintype:oa.PLUGINTYPE}),{cache:!1}),["to","then"],alp.bindF("openShareDialog",
e));e.do_not_track||(new h.SingleOOI(a,{acceptUnpublished:!0})).load(c)}))}}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.share_btn");(function(){alp.declare("oax.x.ShareBtn",alp.x.AbstractController,null,oa.i.IShareBtn,{})})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_purchase_btn");
(function(){function k(a,b){var c=this;if(!c._isOpen)if(a?(b=a.id,c._nextUrl=a.referrer):((b||(b=window.event))&&alp.stopEvent(b),b="function"===typeof c.contentid?c.contentid(b):c.contentid,e.generic_login_barrier_after({type:"PRO:Redirect"},function(){c._nextUrl=document.referrer})),e.login_indicator())c.m.spinner.startWait(alp.nodify(c.purchaseLoadingIndicatorTarget)),g.to(alp.jsonp(alp.tmpl(oa.PURCHASE_MARKUP_JSONP_URL,{id:b,plugintype:oa.PLUGINTYPE}),{cache:!1}),alp.bindF(h,c,b)),c._isOpen=!0;
else{if(c.useGLB){var f={type:c.purchaseDialogClass+"."+c.proj,context:"purchase",data:{id:b,hash:location.hash}};c._nextUrl&&(f.data.referrer=c._nextUrl)}d.open_login(f)}}function h(a,b){b=(b=b&&b.answer)&&/^ok$/i.test(b.status)&&b.html;var d=this;(b||null).substring.call.a;c.open({html:b,extraClass:d.purchaseDialogClass,onOpenNow:function(b,c,e){b={cont:b,proj:d.proj,userid:d.userid,contentid:a,additionalInfoLinks:d.additionalInfoLinks,initNow:!0};d._nextUrl&&(b.nextUrl=d._nextUrl);e.purchase_dialog=
d.installPurchaseDialog(b);d.m.spinner.stopWait()},onCloseLater:function(){alp.humane.remove();alp.forIn(d.m.components,"v && v.teardown && v.teardown()");d.m.components=null;d._isOpen=!1}})}var g=alp.i.state,f=oa.util,e=f.community,d=f.login,b=f.spinner,c=alp.view.modalwin,a=alp.i18n.fetch("alp.all");alp.sub("oa.i",null,!0).IPurchaseBtn={node:null,proj:null,contentid:null,userid:null,useGLB:!0,additionalInfoLinks:!1,purchasedContent:null,purchaseLoadingIndicatorTarget:"oax-purchase-loading-indicator",
purchaseDialogClass:"oax_purchase_dialog",purchaseCurrentMembershipClass:"oax-your-membership",installPurchaseDialog:null,openDialog:function(a){k.call(this,a)},augmentModel:function(a){alp.forEach(["proj","contentid"],"(this[v]||null).a",this);a.spinner=b.create_spinner({setTimeout:!1});this.userid=e.get_user_id()},connectView2Model:function(b,c,d,f){d=b.purchaseDialogClass+"."+b.proj;c.push(alp.aELtouchup(b.node,alp.bindF(k,b,null)));b.useGLB&&e.generic_login_barrier_after({type:d},function(c){alp.opt(b.purchasedContent,
c.id)?g.to(a,function(a){alp.humane(alp.opt(a,"login.alreadyProMember"),{extraClass:"oax-humane-success"})}):k.call(b,c)})}}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_purchase_dialog");
(function(){function k(a){function b(a,b){function d(a,d){function e(a,b){alp.aC(l,b);u.show_view(l,alp.nodify(c.purchaseCreditForm,c.cont));c.spinner.stopWait()}function g(){alp.orphan(l.children);u.show_view(alp.nodify(c.purchaseCreditForm,c.cont),l);c.spinner.startWait(c.cont)}if(v.handleError(a)){var l=alp.gEBI(c.purchaseThreeDSecure,c.cont);"true"==c.s.is3DSecure?b.verifyCard({amount:c.m.priceValue.get()/100,nonce:d.nonce,addFrame:e,removeFrame:g},f):f(a,d)}}function f(a,b){c.spinner.stopWait();
v.handleError(a)&&("false"==c.s.is3DSecure||b.liabilityShifted?(b.type="credit",e.call(c,b,{currentTarget:l})):v.handleError({type:"CUSTOMER",msgCode:"THREEDS_VERIFICATION_FAILED",message:"3D Secure Verification failed"}))}var g=!1,l=alp.nodify(c.purchaseCreditNext,c.cont);a.on("validityChange",function(a){var b=!0;alp.forIn(a.fields,function(a){b=b&&a.isValid});alp.setClass(l,oa.DISABLED,!(g=b));alp.setClass(alp.nodify("oax-"+a.emittedBy+"-exception",c.cont),"humane-show",!a.fields[a.emittedBy].isPotentiallyValid)});
a.on("inputSubmitRequest",function(){g&&l.click()});a.on("cardTypeChange",function(a){console.log(a)});alp.aELtouchup(l,function(b){alp.stopEvent(b||window.event);c.spinner.startWait(c.cont);a.tokenize(d)},!1)}var c=this,f=c.s.braintreeToken;alp.nodify(c.purchaseCreditClass,c.cont);alp.nodify(c.purchasePaypalClass,c.cont);r.to(v.initBraintree({authorizationToken:f,paypal:!0,credit:!0,threeDSecure:"true"==c.s.is3DSecure}),function(d){c.m.components=d;d.dataCollector&&c.n.purchaseDeviceData.length&&
alp.sA(c.n.purchaseDeviceData,"value",d.dataCollector.deviceData);d.credit&&b(d.credit,d.threeDSecure);d.paypal&&(d=alp.nodify(c.purchasePaypalNext,c.cont),alp.aELtouchup(d,alp.bindF(e,c,{type:"paypal"})));a()});alp.aELtouchup(c.n.purchaseBtn,alp.bindF(d,c));alp.view.tooltip({select:alp.nodify("oax-tooltip"),extract:alp.nodify("oax-tooltip-content"),className:"oax_tooltip_content"})}function h(a){function b(a){alp.stopEvent(a);a=alp.nodify(d.purchaseVoucherForm,d.cont);var b=d.multistep_handler.get_cur_view();
t.submit({form:a,cont:d.cont,errorCont:b},null,r.nowF(c))}function c(a,b,c){c.stopWait();"ok"===b.vCodeCheckStatus?(r.set(a,d.m.voucher,e.value),d.multistep_handler.show_view(d.purchaseVoucherSubmitView)):(r.set(a,d.m.priceValue,b.payPrice),r.set(a,d.m.priceText,b.payPriceText),r.set(a,d.m.voucher,e.value),d.multistep_handler.view_reset())}var d=this;alp.nodify(d.purchaseVoucherClass,d.cont);var e=alp.gEBCN(d.purchaseVoucherInput,d.cont)[0],f=alp.gEBCN(d.purchaseVoucherValidate,d.cont)[0];alp.aELtouchup(f,
b);alp.aEL(e,"input change",function(a){alp.stopEvent(a||window.event);alp.setClass(f,oa.DISABLED,!e.value)});alp.aEL(e,"keypress",function(a){a||(a=window.event);a.keyCode===alp.key.ENTER&&(alp.stopEvent(a),e.value&&b(a))});alp.setClass(f,oa.DISABLED,!e.value);a()}function g(a){var d=this,e=alp.nodify(d.purchaseVoucherSubmitView,d.cont),f=alp.gEBCN(d.purchaseVoucherSubmit,d.cont)[0];alp.aELtouchup(f,function(a){alp.stopEvent(a);if(c(e)){a=alp.nodify(d.purchaseVoucherSubmitForm,d.cont);var f=d.multistep_handler.get_cur_view();
t.submit({form:a,cont:d.cont,errorCont:f},null,alp.bindF(b,d))}});alp.aELtouchup(alp.nodify("oax-multistep-dialog-back",e),function(){r.setNow(d.m.voucher,null)});a()}function f(a){function b(a,b){var c=b.name,d=b.value;if(!b.validity.valid)throw b;"select"===b.tagName.toLowerCase()&&(f._countryNiceName=b.options[b.selectedIndex].innerText);alp.oSet(a,c,d);return a}function c(a){r.to(alp.xhrPut(alp.cfg.url.api_write_user_data_full({proj:f.proj,userid:f.userid,token:a}),{sendData:alp.util.json.stringify(k),
receiveJson:!0}),d)}function d(a){f.spinner.stopWait();200===a.status?(r.setNow(f.m.userData,k),f.multistep_handler.show_view(h.href.split("#")[1])):console.error("Could not save user data")}function e(){var a=alp.reduce(alp.filter(g,'!!v.name && v.name !== "l"'),"v && w.validity.valid",!0);alp.setClass(h,oa.DISABLED,!a)}var f=this,g=alp.nodify(f.purchaseAddressForm,f.cont),h=alp.nodify(f.purchaseAddressSaveBtn,f.cont),k=null;try{k=alp.reduce(alp.filter(g,'!!v.name && v.name !== "l"'),b,{})}catch(I){}finally{r.setNow(f.m.userData,
k)}alp.aEL(g,"change",e);alp.aELtouchup(h,function(a){alp.stopEvent(a);try{k=alp.reduce(alp.filter(g,'!!v.name && v.name !== "l"'),b,{}),f.spinner.startWait(f.cont),r.to(l.token(),c)}catch(L){k=null,f.spinner.stopWait()}});e();a()}function e(a,b){(b=b||window.event)&&b.srcElement&&alp.stopEvent(b);b=(b.currentTarget||b.srcElement).href.split("#")[1];var c=this.m.userData.get();r.setNow(this.m.paymentData,a);"oax-address-form"===b&&c&&c.forename&&c.lastname&&c.address.vhCountryId&&(b="oax-purchase-overview");
this.multistep_handler.show_view(b)}function d(a){function d(a,c){e.spinner.stopWait();v.handleError(a)?(c&&(r.setNow(e.m.paymentNonce,c.nonce),r.setNow(e.m.payBy,c.type)),a=e.multistep_handler.get_cur_view(),t.submit({form:f,cont:e.cont,errorCont:a},null,alp.bindF(b,e))):"CUSTOMER"===a.type&&"PAYPAL_POPUP_CLOSED"===a.code&&(alp.humane.timeout=4E3,alp.humane.forceNew=!0,a=alp.opt(m,"purchase.paypal.cancelled"),alp.humane(a||"Payment cancelled! Please choose another payment method or try again.",{extraClass:"oax-humane-warning"}))}
alp.stopEvent(a||window.event);var e=this;a=e.m.paymentData.get();var f=alp.nodify(e.purchaseForm,e.cont);c(f)&&(e.spinner.startWait(e.cont),a&&"paypal"===a.type?e.m.components.paypal.tokenize({flow:"vault"},d):d(null,a))}function b(a,b){var c=this;b.stopWait();alp.aELtouchup(alp.nodify(this.purchaseFinalReload,this.cont),function(){var b=c.nextUrl||a.redirect;q.generic_login_barrier_before({type:"PRO:Redirect",href:b});location.href=b});alp.setClass(alp.gEBCN("oax_modal_content_wrap",this.cont),
oa.NO_DISPLAY,!0);alp.setClass(alp.nodify(this.purchaseFinal,this.cont),oa.NO_DISPLAY,!1)}function c(b){a(b);var c=alp.gEBCN("oax-required-ckb",b),d=!0;alp.forEach(c,function(a){!a.checked&&d&&(d&=a.checked,a.scrollIntoView(),q.show_exception_msg({msgCode:alp.opt(alp.dataset(a),"exception")},b))});return d}function a(a){alp.humane.remove();a=alp.gEBCN(oa.ERROR,a);a.length&&alp.setClass(a,oa.ERROR,!1)}var m,l=alp.data.api,r=alp.i.state,n=oa.util,q=n.community,p=n.spinner,v=n.braintree,u=n.MultistepDialogHelper,
t=n.asyncForm;r.to(alp.i18n.fetch("alp.all"),function(a){m=a});alp.sub("oa.i",null,!0).IPurchaseDialog={cont:null,proj:null,contentid:null,userid:null,nextUrl:null,additionalInfoLinks:!1,additionalLinkClass:"oax-additional-info-link",paymentType:null,braintreeTokenClass:"oax-braintree-token",is3DSecureClass:"oax-is-3dsecure",purchasePriceValueClass:"oax-price-value",purchasePaymentTypeClass:"oax-payment-type",purchasePaymentInfoDfltClass:"oax-payment-info-default",purchasePaymentMethodDfltClass:"oax-payment-method-default",
purchaseAddressInfoTmplClass:"oax-address-info-tmpl",purchasePaymentInfoTmplClass:"oax-payment-info-tmpl",purchaseVoucherNotifTmplClass:"oax-voucher-redeemed-tmpl",purchasePriceDisplayClass:"oax-price-display",purchaseDeviceDataClass:"oax-device-data",purchasePaymentInfoClass:"oax-payment-info",purchaseDefaultNextClass:"oax-payment-default-next",purchaseFinalPayMethodClass:"oax-finalWords-payMethod",purchaseFinal:"oax-purchase-final",purchaseFinalReload:"oax-purchase-reload",purchaseForm:"oax-payment-form",
purchaseBtnClass:"oax-purchase-btn",purchaseAddressForm:"oax-address-form",purchaseAddressSaveBtn:"oax-purchase-save-address",purchaseAddressInfo:"oax-address-info",purchaseCreditClass:"oax-purchase-credit",purchaseCreditNext:"oax-payment-credit-next",purchaseThreeDSecure:"oax-purchase-threeDSecure",purchasePaypalClass:"oax-purchase-paypal",purchasePaypalNext:"oax-payment-paypal-next",purchaseVoucherClass:"oax-purchase-voucher-validate",purchaseVoucherForm:"oax-voucher-validate-form",purchaseVoucherInput:"oax-voucher-input",
purchaseVoucherValidate:"oax-validate-voucher-btn",purchaseVoucherSubmitView:"oax-purchase-voucher-submit",purchaseVoucherSubmitForm:"oax-voucher-submit-form",purchaseVoucherHidden:"oax-voucher-hidden",purchaseVoucherSubmit:"oax-purchase-voucher-btn",augmentModel:function(a){alp.forEach(["proj","contentid"],"(this[v]||null).a",this);var b=this;this.s={};alp.forEach("braintreeToken is3DSecure purchasePriceValue purchasePaymentInfoDflt purchasePaymentMethodDflt purchasePaymentType".split(" "),"this(v)",
function(a){var c=alp.nodify(b[a+"Class"],b.cont);b.s[a]=c&&c.value;alp.orphan(c)});this.s.purchasePaymentType&&!this.paymentType&&(this.paymentType=this.s.purchasePaymentType);this.paymentType&&(this.paymentType="transaction");this.tmpl={};this.n={};alp.forEach("additionalLink purchasePriceDisplay purchaseDeviceData purchasePaymentInfo purchaseDefaultNext purchaseBtn purchaseFinalPayMethod".split(" "),"this(v)",function(a){var c=alp.gEBCN(b[a+"Class"],b.cont);b.n[a]=c});a.contentId=r.state(this.contentid);
a.priceText=r.state();a.priceValue=r.state(parseInt(b.s.purchasePriceValue)||0);a.voucher=r.stringState();a.paymentNonce=r.state();a.payBy=r.state();a.paymentData=r.state();a.userData=r.state()},augmentKids:function(a){this.multistep_handler=u.init_steps(this.cont);this.spinner=p.create_spinner({setTimeout:!1})},connectView2Model:function(a,b,c,d){alp.aELtouchup(a.n.purchaseDefaultNext,alp.bindF(e,a,null));b=alp.asyncSeq();a.spinner.startWait(a.cont);b.next(alp.bindF(k,a)).next(alp.bindF(h,a)).next(alp.bindF(g,
a)).next(alp.bindF(f,a)).next(function(b){a.spinner.stopWait();b()})},connectModel2View:function(a,b,c,d){function e(b,c){alp.sA(alp.gEBCN(c,a.cont),"value",this.m[b].get()||"")}b.push(r.chenInit(c.paymentData,function(){var b=a.m.paymentData.get();if(b){var c=a.tmpl.paymentInfo||(a.tmpl.paymentInfo=alp.nodify(a.purchasePaymentInfoTmplClass,a.cont).innerHTML);a.n.purchasePaymentInfo[0].innerHTML=alp.tmplJs(c,b);b=b.type}else a.n.purchasePaymentInfo[0].innerHTML=a.s.purchasePaymentInfoDflt,b=-1<a.s.purchasePaymentMethodDflt.toLowerCase().indexOf("paypal")?
"paypal":"credit";a.n.purchaseFinalPayMethod[0].innerHTML=alp.opt(m,"purchase."+b+".finalWords")}));b.push(r.chenInit(c.contentId,alp.bindF(e,a,"contentId","oax-i")));b.push(r.chen(c.priceText,function(){alp.forEach(a.n.purchasePriceDisplay,'v.innerHTML = "'+a.m.priceText.get()+'"')}));b.push(r.chen(c.voucher,alp.bindF(e,a,"voucher",a.purchaseVoucherHidden)));b.push(r.chen(c.voucher,alp.bindF(function(){var b=c.voucher.get(),d=a.n.voucherLinks||(a.n.voucherLinks=alp.qSA('a[href="#'+a.purchaseVoucherClass+
'"]',a.cont)),e=a.tmpl.voucherNotif||(a.tmpl.voucherNotif=alp.nodify(a.purchaseVoucherNotifTmplClass,a.cont).innerHTML),f=a.multistep_handler.get_main_view();alp.setClass(d,oa.NO_DISPLAY,!!b);b?(alp.style(f,{"margin-top":"0"}),b=alp.cE("div",null,null,{innerHTML:e}),alp.place(a.n.voucherNotif||(a.n.voucherNotif=b.firstElementChild),f,"first")):(alp.style(f,{"margin-top":""}),alp.orphan(a.n.voucherNotif))},a)));b.push(r.chen(c.paymentNonce,alp.bindF(e,a,"paymentNonce","oax-payment-nonce")));b.push(r.chen(c.payBy,
alp.bindF(e,a,"payBy","oax-pay-by")));b.push(r.chen(c.userData,function(){var b=a.m.userData.get(),c=a.tmpl.addressInfo||(a.tmpl.addressInfo=alp.nodify(a.purchaseAddressInfoTmplClass,a.cont).innerHTML);if(null!=b){var d=alp.nodify(a.purchaseAddressInfo,a.cont);b.address.countryname=a._countryNiceName;d.innerHTML=alp.tmplJs(c,b)}}))},connectPureView:function(a,b,c,d){a.n.additionalLink.length&&alp.setClass(a.n.additionalLink,oa.NO_DISPLAY,!a.additionalInfoLinks)},setInitVal:function(a,b,c,d,e){alp.humane.timeout=
Infinity;alp.humane.forceNew=!1}}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.purchase_dialog");(function(){alp.declare("oax.x.PurchaseDialog",alp.x.AbstractController,null,oa.i.IPurchaseDialog,{})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.purchase_btn");(function(){alp.declare("oax.x.PurchaseBtn",alp.x.AbstractController,null,oa.i.IPurchaseBtn,{installPurchaseDialog:function(k){return new oax.x.PurchaseDialog(k)}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.embedDialog");
(function(){function k(a,b,c,d){if(a=alp.sessionStorage())a.oax_embedFromDp=location.href}function h(a,b,c,d){n.login_indicator()||q.open_login({type:"oax-embedDialog."+a.id,context:"embed",data:{id:a.id,embed:!0}})}function g(a,b,c,d){a.m.termsChecked.setNow(!!c)}function f(a,b,c,d){a.m.initMap.setNow(!!c)}function e(a,b,c,d){a.m.noBranding.setNow(!!c)}function d(a,b,c,d){a.m.noHeader.setNow(!c)}function b(a,b,c,d){a.m.useMaxWidth.setNow(!!c)}function c(a,b,c,d){a.m.useIframe.setNow(!!c)}function a(a){var b=
alp.gEBCN(a.contClass,a.top)[0];alp.setClass(b,oax.NO_DISPLAY,!a.m.termsChecked.get())}function m(a){var b=alp.gEBCN(a.configJsNodeClass,a.top)[0];alp.setClass(b,oax.NO_DISPLAY,!!a.m.useIframe.get());b=alp.gEBCN(a.configIfrNodeClass,a.top)[0];alp.setClass(b,oax.NO_DISPLAY,!a.m.useIframe.get())}function l(a){alp.forEach([a.previewNodeClass,a.configJsNodeClass,a.configIfrNodeClass],function(b){var c=(""+alp.gEBCN(b+"-tmpl",a.top)[0].value.trim()).replace(/###noHeader###/g,"${noHeader}").replace(/###initMap###/g,
"${initMap}").replace(/###noBranding###/g,"${noBranding}").replace(/###useMaxWidth###/g,"${useMaxWidth}").replace(/###maxWi###/g,"${maxWi}");c=alp.tmpl(c,{noHeader:a.m.noHeader.get(),initMap:a.m.initMap.get(),noBranding:a.m.noBranding.get(),useMaxWidth:a.m.useMaxWidth.get(),maxWi:a.m.useMaxWidth.get()?" max-width: 400px;":""});alp.gEBCN(b,a.top)[0].innerHTML=c;b==a.previewNodeClass&&a.m.noBranding.get()&&(c=alp.gEBI("footerBranding"),alp.setClass(c,oax.NO_DISPLAY,!0));b==a.previewNodeClass&&a.m.useMaxWidth.get()&&
(b=alp.gEBI("widgetWrapper"),alp.style(b,{maxWidth:"400px"}))})}var r=oa.util,n=r.community,q=r.login;alp.declare("oax.x.EmbedDialog",alp.x.AbstractController,null,{top:null,id:null,contClass:"oax-embedDialog-config-cont",termsCheckClass:"oax-embedDialog-confirmterms",previewNodeClass:"oax-embedDialog-preview",configJsNodeClass:"oax-embedDialog-config-js",configIfrNodeClass:"oax-embedDialog-config-ifr",_DEFAULT_WIDTH:620,_DEFAULT_HEIGHT:680,augmentModel:function(a){a.termsChecked=new alp.BoolState;
a.initMap=new alp.BoolState;a.noBranding=new alp.BoolState;a.noHeader=new alp.BoolState;a.useIframe=new alp.BoolState;a.useMaxWidth=new alp.BoolState;a.width=new alp.State({init_value:this._DEFAULT_WIDTH});a.height=new alp.State({init_value:this._DEFAULT_HEIGHT})},augmentKids:function(a){alp.installNode(null,null,this.top);a=alp.gEBCN(this.termsCheckClass,this.top);alp.styleform.init({now:!0,cont:{input:a},oncheck:alp.bindF(g,null,this)});(a=alp.gEBCN("oax-embedDialog-init-map",this.top)[0])&&alp.styleform.init({now:!0,
cont:{input:[a]},oncheck:alp.bindF(f,null,this)});if(a=alp.gEBCN("oax-embedDialog-remove-branding",this.top)[0])alp.styleform.init({now:!0,cont:{input:[a]},oncheck:alp.bindF(e,null,this)}),e.call(null,this,null,a.checked);(a=alp.gEBCN("oax-embedDialog-show-head",this.top)[0])&&alp.styleform.init({now:!0,cont:{input:[a]},oncheck:alp.bindF(d,null,this)});(a=alp.gEBCN("oax-embedDialog-use-maxWidth")[0])&&alp.styleform.init({now:!0,cont:{input:[a]},oncheck:alp.bindF(b,null,this)});(a=alp.gEBCN("oax-embedDialog-use-iframe")[0])&&
alp.styleform.init({now:!0,cont:{input:[a]},oncheck:alp.bindF(c,null,this)})},connectModel2View:function(b,c,d,e){c.push(d.termsChecked.change_cb(alp.bindF(a,null,b)));c.push(d.useIframe.change_cb(alp.bindF(m,null,b)));c.push(d.initMap.change_cb(alp.bindF(l,null,b)));c.push(d.noBranding.change_cb(alp.bindF(l,null,b)));c.push(d.noHeader.change_cb(alp.bindF(l,null,b)));c.push(d.useMaxWidth.change_cb(alp.bindF(l,null,b)));c.push(alp.aEL(alp.gEBCN("oax-proPlus-login"),"click",alp.bindF(h,null,b)));c.push(alp.aEL(alp.gEBCN("oax-embedDialog-domain-link"),
"click",alp.bindF(k,null,b)))},connectView2Model:function(a,b,c,d){l(a,null)}})})();"undefined"!==typeof dojo&&dojo.provide("oa.util.translate");
(function(){var k=alp.sub("oa.util.translate",null,!0),h=oa.util,g;h.to(alp.i18n.fetch("alp.all"),function(f){g=f});k.setup=function(f){function e(d,b,c,a,e){var f=alp.opt(g,"translation.processing")||"processing ...";alp.setText(c,f);a={apikey:"AIzaSyAFP2ng8VqPMXBf0fGbO3bM120cwIHYuk0",text:encodeURIComponent(a),fromLang:e,toLang:alp.i18n.language()};c=alp.tmpl(alp.cfg.url.api_translate_google(),a);a="from: "+a.fromLang+" to: "+a.toLang;alp.m(alp.sub("oa.ga_track_anonymous"),"emitCustomClick","translation",
a);c=alp.xhrGet(c,{receiveJson:!0});h.to(c,function(a){function c(a){a=alp.hasClass(f,"oax_active");alp.setClass(f,{oax_active:!a,oax_no_display:a});alp.setClass(l,{oax_active:a,oax_no_display:!a});alp.setClass(h,oa.NO_DISPLAY,!!a)}a=(a=a&&a.responseJson)&&a.data&&a.data.translations[0].translatedText;alp.orphan(b);if(a){alp.setClass(b,oa.NO_DISPLAY,!0);var e=alp.cE("div",d,{"class":"oax-translated-wrap"}),f=alp.cE("span",e,{"class":"oax_btn oax_btn_light oax_btn_medium oax_btn_minWidth oax_marg_top_10 oax_display_table oax_font_normal oax-translated-hide oax_active"},
{innerHTML:alp.opt(g,"translation.hideTranslation")||"hide"});alp.cE("span",f,{"class":"oax-icon-arrowhead-up"});var l=alp.cE("span",e,{"class":"oax_btn oax_btn_light oax_btn_medium oax_btn_minWidth oax_marg_top_10 oax_display_table oax_font_normal oax-translated-show oax_no_display"},{innerHTML:alp.opt(g,"translation.showTranslation")||"show"});alp.cE("span",l,{"class":"oax-icon-arrowhead-down"});var h=alp.cE("div",e,{"class":"oax-translated"},{innerHTML:a});a=alp.cE("div",h,{"class":"oax-attribution"});
alp.cE("a",a,null,{href:"https://translate.google.com/",rel:"nofollow",target:"_blank"});alp.aELtouchup([f,l],c)}})}f=alp.gEBCN("oax-translated-attribute",f);alp.forEach(f,function(d){var b=alp.dataset(d);if(!b||!b.oax_setup){b.oax_setup="done";var c=d.innerHTML,a=alp.cE("div",null,{"class":"oax-translation"},{innerHTML:c}),f=alp.cE("span",a,{"class":"oax_btn oax_btn_light oax_btn_medium oax_btn_minWidth oax_marg_top_10 oax_display_table oax_font_normal"}),l=alp.opt(g,"translation.showTranslation")||
"translate";l=alp.cE("span",f,null,{innerHTML:l});alp.cE("span",f,{"class":"oax-icon-arrowhead-down"});alp.place(a,d,"after");alp.aELtouchup(f,alp.bindF(e,null,a,f,l,c,b.lang_from))}})}})();"undefined"!==typeof dojo&&dojo.provide("oax.detail_layout");
(function(){function k(){function k(a){var b=D.id,c=alp.map(alp.gEBTN("option",a),".value.match( /^#?(-?\\d*)$/ )[ 1 ]");b=Math.max(0,alp.lastIndexOf(c,b));a.selectedIndex!==b&&(a.selectedIndex=b)}function q(a){return q[a]||(q[a]=alp.gEBCN(a,H)[0])}function u(a){a.style.opacity="";alp.forEach(alp.gEBTN("li",a),'.style.opacity=""');var b;F.push(alp.aEL(a,"click",function(){b||(b=new alp.x.Lightbox({proj:D.proj,init_value:D.id}));b.show()}))}function t(){alp.setClass(alp.gEBCN("oax-show-comments-tab",
H),"oax_active",!0);alp.setClass(alp.gEBCN("oax-show-currentConditions-tab",H),"oax_active",!1);alp.setClass(alp.gEBCN("oax-myComment-container",H),oax.NO_DISPLAY,!1);alp.setClass(alp.gEBCN("oax-myCondition-container",H),oax.NO_DISPLAY,!0)}function w(){alp.setClass(alp.gEBCN("oax-show-comments-tab",H),"oax_active",!1);alp.setClass(alp.gEBCN("oax-show-currentConditions-tab",H),"oax_active",!0);alp.setClass(alp.gEBCN("oax-myComment-container",H),oax.NO_DISPLAY,!0);alp.setClass(alp.gEBCN("oax-myCondition-container",
H),oax.NO_DISPLAY,!1)}function x(){var a=alp.gEBCN("oax-hidden-embed-dialog")[0];f.open({html:a.innerHTML,height:700,width:1050,onOpenNow:function(a){new oax.x.EmbedDialog({top:a,id:J.id,initNow:!0})}})}function y(){alp.setClass(H,"oax_smallDetailView",800>=H.offsetWidth)}function z(a){F.push(alp.aEL(a,"click",alp.nowF(alp.bindF(C,null,a))));E(a)}function A(){var a=P.dpTabName.get();(a=a&&N[a])&&C(a)}function C(a){var b=a.className.match(oax.DETAILPANE_TAB_CLASS_RX)[3];alp.setClass(alp.gEBCN("oax-dp-list-container",
H),oax.NO_DISPLAY,!0);var c=q("oax-list-container-"+b);c?alp.setClass(c,oax.NO_DISPLAY,!1):console.log("Missing Container with class: oax-list-container-"+b);alp.setClass(alp.gEBCN("oax-dp-tab",O),"oax_selected",!1);alp.setClass(a,"oax_selected",!0);E(a)}function E(a){var b=a.className.match(oax.DETAILPANE_TABNAME_CLASS_RX);b&&alp.hasClass(a,"oax_selected")&&P.dpTabName.set(b[3])}function G(){var a=q("oax-desc-toggle"),b=alp.gEBCN("oax-desc-more",a)[0];a=alp.gEBCN("oax-desc-less",a)[0];var c=X.get();
b.style.display=c?"none":"";a.style.display=c?"":"none"}function B(){X.setNow(!X.get());var a=q("oax-text-wrapper");alp.gBCR(a).height+""==K+""?(a.style.maxHeight=2*V+"px",alp.setClass(a,"oax-wrapper-ext",!0)):(a.style.maxHeight=K+"px",alp.setClass(a,"oax-wrapper-ext",!1));U||G()}function I(a,b){alp.setClass(q("oax-not-highlight-pois"),oax.NO_DISPLAY,b)}function L(a,b,c){a=c.originalNode;a.checked=!!alp.gA(a,"checked")}var J=this,P=this.layoutState,H=this.topCont||null,F=this._eh,D={back2flexview:null,
id:null,proj:null};alp.mix(D,alp.opt(this,alp.oKeys(D),!0));D.back2flexview?(alp.setClass(alp.gEBCN(oax.BACK2FLEXVIEW_CONT,H),oax.NO_DISPLAY,!1),F.push(alp.aEL(alp.gEBCN(oax.BACK2FLEXVIEW_LINK,H),"click",alp.nowF(function(a){a||(a=window.event);alp.stopEvent(a);D.back2flexview()}))),q("oax-header-hr")&&alp.setClass(alp.gEBCN("oax-header-hr",H),"oax_block",!0)):alp.setClass(alp.gEBCN(oax.BACK2FLEXVIEW_CONT,H),oax.NO_DISPLAY,!0);D.id&&alp.forEach(alp.gEBCN(oax.DETAIL_SELECT_STAGE,H),k);d.webappHeaderSetup(F,
H,J.frontendtype);r.setTouchSupportClass(H||alp.body());var M=J.frontendtype;r.installLazyLoad_specific({cont:H,where:"detailpage"+(M?"-"+M:""),eh:F,oax_lazy_onload:function(a){alp.m(J,"lazy_snippets_fix_ooi_links",a.node);r.setup_many_basket_adders(a.node)}});d.translate.setup(H);J.flexOpener.firstPage===J.flexOpenerPage&&d.init_from_tab_hash(J);d.init_tab_click_handler(J,F);if(M=a.getNode("oax-what-button-with-dropdown"))l.unscript(M),a.category_toggle_setup(F);l.scrollToNodeInstall({cont:H,eh:F});
l.img_srcset({cont:H,eh:F});this._kids_arr.push.apply(this._kids_arr,alp.x.SlideList.install({cont:H}));oax.selectors.install(F);this._kids_arr.push.apply(this._kids_arr,a.slideshow_setup(H,alp.oCreateMix(alp.opt(this,["proj"]),{withLightbox:!0,isLightboxOpenSt:P.isLightboxOpenSt,interceptOpenCloseClick:function(a){J.flexOpener.setDpOverlay(J.flexOpenerPage,a?"lightbox":null)},eh:this._eh})));D.id&&alp.forEach(alp.gEBCN("oax-with-silbox",H),u);this._kids_arr.push.apply(this._kids_arr,a.webappteaser_setup());
a.lightbox_setup(H,{eh:F});oax.community_layout.login_install({eh:F});alp.forEach(alp.gEBCN(oax.TEASER_MAP_WAIT,H),function(a){var b=new alp.x.Waitbox({targetInit:a});b.startWait();F.push(alp.subDfrd(function(){var b=alp.gEBCN("oax-teaser-map-img",a.parentNode);return alp.and(b,function(a){return!("complete"in a)||a.complete})}).then(alp.bindF("stopWait",b)))});a.click_setup_toggle("oax-more-data-open","oax-more-data-close",{eh:F,"oax-more-data-open":!0,"oax-more-data-close":!1,"oax-more-data-hidden":!1},
H);(M=(M=q("oax-svg-container"))&&alp.gEBTN("svg",M)[0])&&alp.sA(M,"preserveAspectRatio","none");a.installRegionTeaser(H);q("oax-show-comments")&&F.push(alp.aEL(alp.gEBCN("oax-show-comments",H),"click",t));q("oax-show-currentConditions")&&F.push(alp.aEL(alp.gEBCN("oax-show-currentConditions",H),"click",w));q("oax-show-comments-tab")&&F.push(alp.aEL(alp.gEBCN("oax-show-comments-tab",H),"click",t));q("oax-show-currentConditions-tab")&&F.push(alp.aEL(alp.gEBCN("oax-show-currentConditions-tab",H),"click",
w));oax.URL_SEARCH_GET_EDITCOND_ID()&&w();(M=alp.gEBCN("oax-dialog-node",H))&&F.push(alp.aEL(M,"click",function(a){a||(a=window.event);a=a.target||a.srcElement;var b=a.id.split("_"),c=b[1],d=parseFloat(b[2])+80;b=parseFloat(b[3])+40;q("oax-dialog-content-"+c)&&f.open({html:q("oax-dialog-content-"+c).innerHTML,title:a.title,height:d,width:b})}));(M=alp.nodify(oa.SHARE_BTN,H))&&new oax.x.ShareBtn({proj:J.proj,node:M,initNow:!0,track_type:J.frontendtype});(M=alp.nodify(oa.PURCHASE_BTN,H))&&new oax.x.PurchaseBtn({node:M,
proj:J.proj,contentid:J.id});var R=alp.gEBCN("oax-gpx-button",H);if(R&&R.length){var S=alp.gEBCN(oax.GPX_DIALOG)[0],T=alp.gA(R[0],"title"),Q={type:"DIALOG:GPX"};T=h.init({node:R,title:T,template:S,login_indicator:c.login_indicator,login_open_dialog:alp.bindF(b.open_login,null,Q),login_before:alp.bindF(c.generic_login_barrier_before,null,Q),login_after:alp.bindF(c.generic_login_barrier_after,null,Q)});F.push(alp.aEL(R,"click",alp.bindF("openModalwinOrLogin",T)));T.openModalwinAfterLogin()}if(R=alp.gEBCN("oax-kml-button",
H)[0])S=alp.gEBCN(oax.KML_DIALOG)[0],T=alp.gA(R,"title"),Q={type:"DIALOG:KML"},T=g.init({node:R,title:T,template:S,login_indicator:c.login_indicator,login_open_dialog:alp.bindF(b.open_login,null,Q),login_before:alp.bindF(c.generic_login_barrier_before,null,Q),login_after:alp.bindF(c.generic_login_barrier_after,null,Q)}),F.push(alp.aEL(R,"click",alp.bindF("openModalwinOrLogin",T))),T.openModalwinAfterLogin();R=alp.gEBCN("oax-embed-action",H);c.generic_login_barrier_after({type:"oax-embedDialog."+J.id},
x);(T=alp.sessionStorage())&&T.oax_embedFromDp&&(-1<T.oax_embedFromDp.indexOf(J.id)&&x(),delete T.oax_embedFromDp);R&&F.push(alp.aEL(R,"click",x));alp.nodify(oa.PURCHASE_BTN,H);M&&new oax.x.PurchaseBtn({node:M,proj:J.proj,contentid:J.id,initNow:!0});alp.gEBCN("oax_singlePage_flex",H)&&(y(),F.push(alp.aEL(window,"resize",y)));var O=q("oax-dp-active-tabs"),N={};if(O){for(M=O.firstChild;M;)"li"==M.nodeName.toLowerCase()&&(M.className.match(oax.DETAILPANE_TAB_CLASS_RX)&&z(M),(R=M.className.match(oax.DETAILPANE_TABNAME_CLASS_RX))&&
(N[R[3]]=M)),M=M.nextSibling;F.push(P.dpTabName.change_cb_init(A))}q("oax-show-additional-attribute")&&F.push(alp.aEL(q("oax-show-additional-attribute"),"change",function(){var a=q("oax-show-additional-attribute").value;alp.setClass(alp.gEBCN("oax-additional-attribute-list",H),{oax_show_length:!1,oax_show_difficulty:!1});alp.setClass(alp.gEBCN("oax-additional-attribute-list",H),a,!0)}));a.click_setup_toggle("oax-toggle-ep-open","oax-toggle-ep-close",{eh:F,"oax-toggle-ep-open":!0,"oax-toggle-ep-close":!1,
"oax-with-ep":{className:"oax_ep_open",bool:!0}},H);var X=new alp.BoolState;if(q("oax-full-text")&&q("oax-text-wrapper")){var V=alp.gBCR(q("oax-full-text")).height,K=alp.gBCR(q("oax-text-wrapper")).height;if(q("oax-desc-toggle")&&V>K){alp.setClass(q("oax-wrapper-desc-toggle"),oax.NO_DISPLAY,!1);var U=alp.transitionEndName();F.push(alp.aEL(q("oax-desc-toggle"),"click",B));q("oax-show-protectedAreas")&&F.push(alp.aEL(q("oax-show-protectedAreas"),"click",function(a){alp.stopEvent(a||window.event);X.get()||
B()}));U&&F.push(alp.aEL(q("oax-text-wrapper"),U,function(){G()}))}else M=q("oax-text-wrapper"),alp.vStyle(M,{transition:"none",height:"auto"})}(M=(M=q("oax-dp-list-container"))&&alp.gEBCN("oax-only-highlight",M))&&M.length&&alp.styleform.init({cont:{input:M},oncheck:I,oncheck_init:L});m.installTrackClickMany({cont:H,conttype:m.DETAIL},{"area: my condition":"oax-myCondition-container","more description":"oax-desc-more","open PDF dialog":"oax-pdf-login","download gpx":"oax-gpx-button","download kml":"oax-kml-button",
rating:"oax-ooi-rating","more quickfacts":"oax-more-data-open","give first comment":"oax-give-first-comment","give first condition":"oax-give-first-condition","facebook: publish":"oax-facebook-publish","basket: add":"oax-basket-action-add","basket: remove":"oax-basket-action-remove","open picture gallery":"oax-content-slider-cont","tour: plan own tour":"oax-plan-own-tour","tour: find nearby tours":"oax-further-nearby-tours","tour: to overview":"oax-tour-back-to-overview","weather: details":"alp-x-weatherbox-cont",
"avalanche: details":"oax-avalanche"},{eh:F});D.id&&D.proj&&(M={id:D.id,proj:D.proj,cont:H,conttype:m.DETAIL},m.installTrackClickTab(M),e.clickTab(M),n.installTrackClickMany({cont:H,proj:D.proj,id:D.id,nocache:!0},{"oax-purchase-indent":"PurchaseIndent"}));r.setup_many_basket_adders(H)}alp.sub("oax.detail_layout",null,!0);var h=alp.view.dialog.gpx,g=alp.view.dialog.kml,f=alp.view.modalwin,e=oa.content_track,d=oa.util,b=oa.util.login,c=oa.util.community,a=oax.layout,m=oa.ga_track_anonymous,l=alp.dom,
r=oax.util,n=alp.content,q={};alp.declare("oax.DetailLayout",null,alp.nowF(function(a){a&&alp.mixCheck(this,a);alp.forEach(alp.opt(this,["id","proj","frontendtype"]),"(v || null).substring.call.a");this.flexOpener.setDpOverlay.call.a;this.flexOpenerPage.valueOf.call.a;this.layoutState={dpTabName:new alp.StringState,isLightboxOpenSt:new alp.BoolState};this._eh=new alp.Eh;this._kids_arr=[];alp.onDCL(alp.bindF(k,this))}),{id:null,proj:null,frontendtype:null,flexOpener:null,flexOpenerPage:null,topCont:null,
lazy_snippets_fix_ooi_links:null,destroy:function(){this._eh.clear();this.topCont&&alp.empty(this.topCont);alp.forEach(this._kids_arr,'alp.m(v,"disconnect")');for(var a in this)a in q||(this[a]=null);this.destroyed=!0},tabClickEvt:alp.memM("tabClickEvt",'alp.event("OAX:DL:tabClickEvt",{then:1})')})})();"undefined"!==typeof dojo&&dojo.provide("oax.util.event");
(function(){alp.sub("oax.util.event",0,1).install=function(k,h,g){function f(){e.triggerSoon(k.get(),k.getPrevious())}if(k){var e=h[g]();return e&&k.change_cb(f)}}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_action_open_type");
(function(){function k(h,g){g||(g=this._actionOpenType());if("string"===typeof g)return h.test(g);var f={},e;for(e in g)if(!(e in f)&&k.call(this,h,g[e]))return!0;return!1}alp.sub("oa.i",null,!0).IActionOpenType={_actionOpenType:alp.memM("_actionOpenType",function(){var h=this.actionOpenType||"in-page";"string"!==typeof h||/portal|in-page/.test(h)||(h+="|in-page");"string"===typeof h&&(h={"*":h,map:"in-page-iw"});return alp.mapIn(h,"!/\\|in-page$/.test(v)  &&  /(^|\\|)page-load(\\||$)/.test( v )  ?  v + '|in-page'  :  v;")}),
_actionOpenType_for_mode:function(h){(h||0).substring.call.a;var g=this._actionOpenType(),f=g[h]||g["*"];(g=!g[h]&&"listMap"===h&&alp.or(["listmap","maplist","mapList"],"this[v]&&v",g))&&console.error('i_action_open_type: mode "'+h+'" not found in the config. But the config contains "'+g+'" (possibly wrong). Please check the config.');(f||0).substring.call.a;return f},_actionOpenType_has_in_page:alp.memM("_actionOpenType_has_in_page",function(h){return k.call(this,/(^|\|)in-page(\||$)/,h)}),_actionOpenType_has_in_page_or_in_page_iw:alp.memM("_actionOpenType_has_in_page_or_in_page_iw",
function(h){return k.call(this,/(^|\|)in-page(-iw)?(\||$)/,h)})}})();"undefined"!==typeof dojo&&dojo.provide("oa.action._common");(function(){alp.sub("oa.action",null,!0).setup_intercept_F=function(k){return function(h,g,f){function e(d){var b=k(h,g,f);b&&b.doNotStopEvent||alp.stopEvent(d||window.event)}(g.id||0).substring.call.a;alp.aEL(h,"click",alp.Later?e:alp.nowF(e))}}})();"undefined"!==typeof dojo&&dojo.provide("oa.action.open");
(function(){function k(d,b){for(var c=b.type.split("|"),a=c.length,e=0;e<a;e++){var f=c[e];if(f===oa.ACTION_OPEN_NONE)return{type:f};if(f===oa.ACTION_OPEN_PAGE_LOAD_PORTAL)return{type:f,url:oa.PORTAL_OPEN_OOI_URL(d)};if(f===oa.ACTION_OPEN_PAGE_LOAD){var g=b.url;if(g&&(g="string"===typeof g?alp.tmpl(g,d):g(d)))return{type:f,url:g}}else{if(f===oa.ACTION_OPEN_IN_PAGE||f===oa.ACTION_OPEN_IN_PAGE_IW)return{type:f};break}}console.error('oa.action.open could not recognize and/or resolve type "'+b.type+'", at least not in this case.')}
function h(d,b,c){return(d=k(b,c))&&g(b,d,c)}function g(d,b,c){var a=b.type;if(a===oa.ACTION_OPEN_NONE)return{doNotStopEvent:!0};a===oa.ACTION_OPEN_PAGE_LOAD_PORTAL||a===oa.ACTION_OPEN_PAGE_LOAD?(c.back2id&&e.save_back2id(d.id,c),location.href=b.url):a===oa.ACTION_OPEN_IN_PAGE?c.opener.open_inpage(d):a===oa.ACTION_OPEN_IN_PAGE_IW?c.opener.open_inpage_iw?c.opener.open_inpage_iw(d,c.map,c.iw_opt):console.error("oa.action.open: missing cfg.opener.open_inpage_iw"):(void 0).bug}var f=alp.sub("oa.action.open",
null,!0),e=oa.util.sestor;f.apply_decision=g;f.decide=k;f.do_it=h;f.setup=oa.action.setup_intercept_F(h)})();"undefined"!==typeof dojo&&dojo.provide("oax.util.waitpageout");(function(){alp.sub("oax.util",0,1).waitpageout=function(k){var h=alp.cE("div",alp.body(),{style:"position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: 9999"});(new alp.x.Waitbox(alp.mix({targetInit:h,delay_ms:0},k))).startWait()}})();"undefined"!==typeof dojo&&dojo.provide("oax.util.ooi_links");
(function(){var k=alp.sub("oax.util.ooi_links",0,1),h=oa.action.open,g=oa.util.sestor;k.fix_later=function(f,e){function d(a){return alp.filter(alp.map(alp.gEBTN("option",a),".value.match( /^#?(-?\\d*)$/ )[1]"),"")}function b(a){var b=alp.opt(a.className.match(oax.ID_RX),1);if(b)return{node:a,id:b};console.error("oax.util.ooi_links.fix could not determine id from link!");setTimeout(function(){throw Error("oax.util.ooi_links.fix could not determine id from link!");})}function c(b,c,d){alp.forEach(d,
a,b);q.done(r)}function a(a,b){function c(b){function c(b){alp.stopEvent(b||window.event);h.apply_decision(a,f,e)}function d(){g.save_back2id(a.id,e);oax.util.waitpageout()}var f=h.decide(a,{type:x,url:e.openOOIUrl,opener:e.opener});b=b.node;if(f.url){var l=document.createDocumentFragment();alp.forEach(alp.Aps.call(b.childNodes),"this.appendChild(v)",l);b=alp.aC(alp.cE("a",b,{href:f.url,"class":b.className.match(/(^|\s)oax_[\S]+/g,"").join(" ")}),l);e.back2id&&alp.aEL(b,"click",d)}else alp.aEL(b,
"click",alp.nowF(c))}a?a.id!==this[b]?console.error("oax.util.ooi_links.fix_later(): did not receive a VALID response for id "+this[b]):alp.forEach(y[a.id],c):console.error("oax.util.ooi_links.fix_later(): did not receive a backend response for id "+this[b])}function k(){var a=this.options[this.selectedIndex].value.match(/^#?(-?\d+)$/)[1];(new alp.data.SingleOOI(a,{proj:e.proj,acceptUnpublished:!0})).load(l)}function l(a){a=a.data;var b=h.decide(a,{type:x,url:e.openOOIUrl,opener:e.opener});h.apply_decision(a,
b,e)}(e.proj||0).substring.call.a;var r=alp.gEBCN(oax.OOI_LINK,f),n=r.length&&alp.filter(alp.map(r,b),""),q=alp.dfrd("ooi_links",{then:1}),p=n&&0<n.length,v=alp.dfrd("ooi_stage_select_links",{then:1});f=alp.gEBCN(oax.DETAIL_SELECT_STAGE,f);var u=0<f.length,t=alp.gatherDfrd([q,v],{then:1});if(p||u){var w=alp.oCreateMix(oa.i.IActionOpenType,alp.opt(e,["actionOpenType"])),x=w._actionOpenType_for_mode(oax.MODE_OOI_LINK);w._actionOpenType_has_in_page_or_in_page_iw()&&e.opener.valueOf.a}if(p){var y={};
alp.forIn(n,"(this[v.id]  ||  (this[v.id] = [])).push(v)",y);n=alp.oKeys(y);(new alp.data.OOIs({proj:e.proj,idlist:n})).load(alp.bindF(c,null,n))}else q.done(r);u&&(alp.aEL(f,"change",k),n=alp.arr2oSimple(alp.arrChain(alp.map(f,d))),(new alp.data.OOIs({proj:e.proj,idlist:alp.oKeys(n)})).load(alp.f()));v.done(f);return t}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_map_clients");
(function(){function k(){function f(){if(!b){for(b=!0;d&&e.length;)e.shift()(d);b=!1}}var e=[],d,b;return{setMap:function(b){d=b||null;f()},register:function(b){e.push(b);f()}}}alp.sub("oa.i",null,!0).IMapClients={whenMap:function(){this._mapClients().register(alp.bindF.apply(alp,arguments))},_mapClients:alp.nowF(function(){return h?h.get(this)||h.set(this,k()):this[g]||(this[g]=k())})};var h=alp.m(alp,"mapany"),g="_mapClients_instance"})();"undefined"!==typeof dojo&&dojo.provide("oa.x.flex_opener");
(function(){function k(a){G&&G.delNow(a.top)}function h(a,b){n(this,a)&&(a=this.hashCfg.fvArea,t(this,a,a+"="+(b||C)))}function g(a,b){n(this,a)&&(a=this.hashCfg.fvAvalDt,t(this,a,b?a+"="+b:null))}function f(a,b){n(this,a)&&(a=this.hashCfg.fvFullscreen,t(this,a,b?a+"=1":null))}function e(a,b){n(this,a)&&(a=this.hashCfg.fvView,t(this,a,a+"="+(b||"")))}function d(a,b){n(this,a)&&(a=this.hashCfg.fvWhat,t(this,a,a+"="+(b?b.cattitle||b.catid:A)))}function b(a,b){n(this,a)&&(a=b&&b.name,b&&b.isRegion&&
!oax.XXX_WHERE_ALPSTEIN&&(a+="\n"+b.alpstein_id),b=this.hashCfg.fvWhere,t(this,b,a?b+"="+a:null))}function c(a,b){n(this,a)&&(a=this.hashCfg.fvQ,t(this,a,b?a+"="+b:null))}function a(a,b,c,d){if(n(this,a)){var e=this.hashCfg.fvQ;a=this.hashCfg.fvWhere;var f=this.hashCfg.fvArea,g={},l=[];g[e]=!0;c&&l.push(e+"="+c);c=b&&b.name;b&&b.isRegion&&!oax.XXX_WHERE_ALPSTEIN&&(c+="\n"+b.alpstein_id);g[a]=!0;b&&l.push(a+"="+c);g[f]=!0;l.push(f+"="+(d||C));t(this,g,l)}}function m(a,b,c,d){function e(){var a=l.many,
c=z.sorted((g.outWithUrlHash?location.hash:g.m.fakeHash.get()).substring(1));c=alp.map(c.split("&"),'.split("=")');c=alp.or(c,"v[0]===this.s && v[1]",{s:b})||"";c=alp.filter(c.split(","),'v&&!(v.split("-").slice(0,-1).join("-") in this)',a);alp.forIn(a,f,c);c.sort();return c.join(",")}function f(a,b){a&&this.push(b+"-"+(1<a.length?a.join("to"):a[0]))}var g=this,l=alp.sub(J+"."+b,g,!0);"h"in l&&clearTimeout(l.h);alp.sub("many",l,!0)[c]=d;l.h=setTimeout(function(){g.writeOnly(a,b,e)},357)}function l(a,
b,c,d,e){a=d.hist.get();d=d.currentPage.get();1===a.length&&d===b.firstPage&&u(d)&&(b=alp.orIn(a[0].hashSet,"this[k]",b._dpOverlayHash2Name))&&d._showOverlay(b)}function r(a,b){return(a=(b||a.m.currentPage.get()).id)?{id:a}:null}function n(a,b,c){b||null.bug;var d=a[P],e=a[H];!(d&&e)||null.bug;a=e||a.m.currentPage.get();if(b===a&&b!==d)return!0;if(!c)return console.error("flexOpener: wrong page!"),!1}function q(a,b){b=a.m;var c=v(a,a.outWithUrlHash?location.hash:b.fakeHash.get()).within,d=a.hashCfg,
e=b.hist.get(),f=e.length,g=e[f-1],l=p(a,c);if(c!==g.hash||c&&!alp.oEqual(l,g.hashSet)){var h=alp.oDelta(alp.filterIn(l,""),alp.filterIn(g.hashSet,"")),k=h.add;h=h.del;var m=d.dpId,n=d.fv,q=d.fvArea,t=d.fvAvalDt,u=d.fvFullscreen,x=d.fvView,y=d.fvWhat,z=d.fvWhere,G=d.fvQ,E=l[m],B=g.hashSet[m];h=l.type===g.hashSet.type&&l.type===d.dpType&&!(E&&B&&E!==B)&&(k.length||h.length)&&alp.and(k.concat(h),'v==="'+m+'"||v in this',a._dpOverlayHash2Name);m=q&&l[q];q=m!==g.hashSet[q];E=t&&l[t];t=E!==g.hashSet[t];
B=u&&l[u];u=B!==g.hashSet[u];var I=x&&l[x];x=I&&I!==g.hashSet[x];var F=y&&l[y];y=F!==g.hashSet[y];var D=z&&l[z];z=D!==g.hashSet[z];var L=G&&l[G];G=L!==g.hashSet[G];var J=l.type===g.hashSet.type&&l.type===d.fvType&&(!l[n]||l[n]===g.hashSet[n]);h&&(1>=k.length||null.bug);n=g=null;for(--f;0<=--f;){var ia=e[f];if(ia&&(ia.hash===c||alp.oEqual(ia.hashSet,l))){g=f;n=alp.oGet(e,[f,"page"])||null;break}}f=null;if(h)b.currentPage.get()._showOverlay(k[0]&&a._dpOverlayHash2Name[k[0]]);else if(J)q&&b.currentPage.get()._showArea(m===
C?"":m),t&&b.currentPage.get()._showAvalDt(E),u&&b.currentPage.get()._showFullscreen(B),x&&b.currentPage.get()._showView(I),y&&b.currentPage.get()._showWhat(F===A?"":F),z&&b.currentPage.get()._showWhere(D),G&&b.currentPage.get()._showFreeSearch(L);else{f=b.hist.get()[0].hashSet.type===l.type&&a.firstPageOpt;var ea=a.firstPage;k=l.type===d.dpType;d=alp.oCreateMix(f||{},alp.filterIn(alp.arr2o(k?[["id",l[d.dpId]],["dpNode",a.top]]:[["frontendtype",l[d.fv]],["topCont",a.top],["fillMarkup",!0]],0,1),""));
alp.mix(d,alp.opt(ea,["proj","key"]),{withUrlHash:a.outWithUrlHash});alp.empty(a.top);f=a.m.currentPage.get();f===ea&&f.getDataPointList&&(f.initDataPointList=f.getDataPointList());a[P]=f;alp.m(f,"destroyASAP");a[P]=null;(ea=alp.oGet(a,"firstPage.mapTypeId"))&&/flexviewpage/i.test(alp.oGet(a,"firstPage.declaredClass"))&&alp.oGet(a,"firstPage.transmitMapTypeId")&&k&&alp.oSet(d,"cfg.maplayer.basemap.init",ea);if(ea=alp.oGet(a,"firstPage.actionOpenType"))d.actionOpenType=ea;f=n||new oa[k?"DetailPage":
"FlexViewPage"](d);ea=alp.orIn(l,"v && k  &&  this[k]",a._dpOverlayHash2Name);var ma=(d=f[k?"dpNode":"topCont"])&&alp.nodify(d);ma&&ma.childNodes&&alp.m(f,"whenLoaded",function(){alp.dom.scrollToNode(ma)})}d=f||b.currentPage.get();c=null!=g?e.slice(0,g+1):e.concat([{hash:c,hashSet:l,page:d}]);w([[b.hist,c],[b.currentPage,d],[b.inpageDetail,r(a,d)]]);f&&(a[H]=f,alp.m(f,"initASAP"),a[H]=null);ea&&f._showOverlay(ea)}}function p(a,b,c,d){b=alp.oCreateMix(a._hashSetDefault,v(a,z.s2o(b)).within);d=a.hashCfg;
var e=c&&u(c),f=c&&c instanceof oa.FlexViewPage,g=b[d.dpId]||e;f=b[d.fv]||!g&&f;g||f||(u(a.firstPage)?g=!0:f=!0);!!g^!!f||null.bug;b.type=g?d.dpType:d.fvType;c&&(b.type=e?d.dpType:d.fvType,g=e?d.dpId:d.fv,c=e?c.id:c.frontendtype,(c||null).substring.call.a,b[g]=c);b.type===d.dpType&&!b[d.dpId]&&u(a.firstPage)&&(c=b[d.dpId]=a.firstPage.id,(c||null).substring.call.a);b.type===d.fvType&&!b[d.fv]&&a.firstPage instanceof oa.FlexViewPage&&(a=b[d.fv]=a.firstPage.frontendtype,(a||null).substring.call.a);return alp.filterIn(b,
"")}function v(a,b){function c(a){return a.length?"#"+alp.map(a,'v[0]+"="+v[1]').join("&"):""}a=a._hashSetDefault;if("object"===typeof b)return{within:alp.filterIn(b,"w in this",a),outside:alp.filterIn(b,"!(w in this)",a)};b=b.substring(1);/^[\-\+]?\d+$/.test(b)&&(b=E+"="+b);var d=alp.map(alp.filter(b.split("&"),""),'.split("=")');b=alp.filter(d,"v[0] in this",a);a=alp.filter(d,"!(v[0] in this)",a);return{within:c(b),outside:c(a),within_arr:b,outside_arr:a}}function u(a){return a instanceof oa.DetailPage}
function t(a,b,c){b||null.bug;"string"===typeof b&&(b=alp.arr2oSimple([b]));"string"===typeof c&&(c=[c]);c&&alp.forEach(c,function(a,b){a=a.split("=");a[1]&&(a[1]=z.encodeURIComponentExceptComma(a[1]),c[b]=a.join("="))});var d=a.outWithUrlHash,e=a.m.hist.get(),f=e.length,g=v(a,d?location.hash:a.m.fakeHash.get()),l=g.within.substring(1).split("&");b=alp.filter(l,'v&&!(v in this)&&!(v.split("=")[0] in this)',b);c&&(b=b.concat(c));b=b.length?"#"+b.join("&"):"";z.sorted(b||"#")!==z.sorted(location.hash||
"#")&&(l=p(a,b),(e=e[f-2])&&(e.hash===b||alp.oEqual(e.hashSet,l))?a.back(a.m.currentPage.get()):d?(a=z.sorted(g.outside?g.outside+(b?"&"+b.substring(1):""):b),z.sorted(location.hash)!==a&&(location.hash=a)):w(a.m.fakeHash,b))}function w(a){1<arguments.length&&(a=[[a,arguments[1]]]);alp.now(x,null,a)}function x(a,b){var c;alp.Later&&(c=b);alp.forEach(a,function(a){var b=a[0];a=a[1];c?c.set(b,a):b.set(a)})}var y=alp.sub("oa.x",null,!0),z=alp.util.url_hash,A=oa.URL_HASH_ACTIVITY_ALL,C=oa.URL_HASH_AREA_ALL,
E=oa.URL_HASH_INPAGE_DETAIL;y.forgetFlexOpener=k;y.getFlexOpener=function(a){(oa.PREFIX||null).substring.call.a;alp.oCheckScheme(a,["!!v.top.childNodes",'typeof v.inWithUrlHash==="boolean"',"v.firstPage.declaredClass.match(/^"+oa.PREFIX+".(FlexView|Detail)Page$/)"]);var b=a.top,c=G||(G=alp.mapany());return c.get(b)||c.set(b,new y._FlexOpener(a))};var G,B,I=alp.Later?alp.x2.AController:alp.x.AbstractController,L=alp.sub("oax")&&alp.sub("oax")===oa;I||null.bug;alp.declare("oa.x._FlexOpener",I,null,
{top:null,inWithUrlHash:!0,firstPage:null,outWithUrlHash:!0,firstPageOpt:null,initNow:!0,hashCfg:alp.mix({dpId:E,dpOverlay:{map:"dm=1",lightbox:"dmlb=1",weather:"dmwr=1",elprofile:"dmep=1",avalanche:"avaldt=1"},dpType:"detailpage",fv:"fv",fvType:"flexviewpage"},L?{fvArea:oax.URL_HASH_AREA,fvAvalDt:oax.URL_HASH_AVALANCHE_OPEN,fvFullscreen:oax.URL_HASH_FULLSCREEN,fvView:oax.URL_HASH_VIEW,fvWhat:oax.URL_HASH_ACTIVITY,fvWhere:oax.URL_HASH_WHERETEXT,fvQ:oax.URL_HASH_QTEXT}:{}),destroy:function(){this.disconnect;
k(this)},back:function(a){n(this,a)&&(this.outWithUrlHash?history.back():(a=this.m.hist.get().slice(-2,-1)[0])&&w(this.m.fakeHash,a.hash))},backToPreviousPage:function(a){if(n(this,a)){for(var b=this.m.hist.get(),c=b.length,d=b[c-1],e=null,f=c-1;0<f--;){var g=this.hashCfg;var l=d.hashSet,h=b[f].hashSet,k=g.dpId;(k||null).substring.call.a;g=l.type!==h.type||l.type===g.dpType&&l[k]!=h[k];if(g){e=f;break}}if(null!=e)for(f=c-e;--f;)this.back(a);else alp.supportsHistory()&&history.back()}},openDetailpage:function(a,
b){n(this,a)&&b&&b!==(a.id||null)&&t(this,this._hashToRemoveSet,this.hashCfg.dpId+"="+b)},openFlexviewpage:function(a,b){n(this,a)&&t(this,this._hashToRemoveSet,this.hashCfg.fv+"="+b)},setDpOverlay:function(a,b){var c=this.m.currentPage.get();a=c.detailMap===a?c:a;n(this,a)&&/DetailPage/.test(a.declaredClass)&&(b=b?this.hashCfg.dpOverlay[b]:"",b.substring.call.a,t(this,this._dpOverlayHashSet,b))},setFvArea:L&&h,setFvAvalDt:L&&g,setFvFullscreen:L&&f,setFvView:L&&e,setFvWhat:L&&d,setFvWhere:L&&b,setFvQ:L&&
c,setFvWhereQArea:L&&a,writeOnly:function(a,b,c){function d(a,c){var d=e.outWithUrlHash;alp.supportsHistory()&&n(e,a,!0)&&(c=alp.fVal(c),c=z.encodeURIComponentExceptComma(c),a=z.sorted((d?location.hash:e.m.fakeHash.get()).substring(1)),c=alp.filter(alp.map(alp.filter(a.split("&"),""),'.split("=")'),'v[0]!=="'+b+'"').concat(c?[[b,c]]:[]),c=z.sorted(alp.map(c,'.join("=")').join("&")),a!==c&&(a="#"+c,d?history.replaceState(null,"",location.href.split("#")[0]+a):w(e.m.fakeHash,a)))}var e=this;(e.writeOnly[b]||
(e.writeOnly[b]=alp.ratelimitF(357,d)))(a,c)},writeOnlySubPart:L&&m,getActionOpener:function(){var a=this,b=a.m.currentPage;return{open_inpage:function(c){(c.id||null).substring.call.a;a.openDetailpage(b.get(),c.id)}}},augmentModel:function(a){var b;if(b=this.outWithUrlHash=this.inWithUrlHash&&!B&&alp.supportsHistory())B=!0;var c=this.hashCfg;alp.forIn(c.dpOverlay,'this[v.split("=")[0]]=w',this._dpOverlayHash2Name={});var d=this._dpOverlayHashSet=alp.arr2oSimple(alp.oKeys(this._dpOverlayHash2Name)),
e=this._hashSetDefault=alp.mapIn(this._dpOverlayHash2Name,'""');e[c.dpId]="";e[c.fv]="";L&&(e[c.fvArea]="",e[c.fvAvalDt]="",e[c.fvFullscreen]="",e[c.fvView]="",e[c.fvWhat]="",e[c.fvWhere]="",e[c.fvQ]="");this._hashToRemoveSet=alp.oCreateMix(d,alp.arr2oSimple([c.dpId,c.fv]));c=this._firstHash=v(this,b?location.hash:"").within;d=p(this,c,this.firstPage,this.firstPageOpt);d={hash:c,hashSet:d,page:this.firstPage};e=this.firstPage;a.currentPage=alp.Later?alp.state({init:e,neverCopy:!0}):new alp.State({init_value:e});
e=[d];a.hist=alp.Later?alp.state({init:e,neverCopy:!0}):new alp.State({init_value:e});b||(e=c,a.fakeHash=alp.Later?alp.stringState({init:e}):new alp.StringState({init_value:e}));e=r(this);a.inpageDetail=alp.Later?alp.state({init:e}):new alp.ObjectState({init_value:e})},setInitVal:alp.Later?l:alp.bindF(l,null,null),connectView2Model:function(a,b,c,d){d=alp.nowF(alp.bindF(q,null,a));a.outWithUrlHash?b.push(alp.aEL(window,alp.likeIE()?"hashchange":"popstate",d)):b.push(alp.m(c.fakeHash,["chen","change_cb"],
d));c.currentPage.get().whenLoaded(d)}});var J="_hkey_cache_writeonlysubpart",P="_currently_destroying",H="_currently_creating"})();"undefined"!==typeof dojo&&dojo.provide("oa.x.journey_dialog");
(function(){function k(e){e||(e=window.event);var d=this;e=alp.opt(alp.dataset(e.currentTarget),"ooiid");f.to(h.call(d,e||d.ooiid),function(b){(b||null).substring.call.a;g.open({html:b,extraClass:d.dialogExtraClass})})}function h(e){function d(a){a=a.answer;200===a.code?(a=alp.cE("div",null,null,{innerHTML:a.html}),c.done(alp.nodify(b.dialogTmplClass,a).innerHTML)):console.error("Could not fetch planJourney dialog")}var b=this,c=alp.dfrd("journey:dialog:html",{then:1}),a=alp.nodify(b.dialogTmplClass,
b.cont);(a=a&&a.html)?c.done(a):f.to(alp.jsonp(alp.tmpl(b.dialogTmplUrl,{id:e,plugintype:oa.PLUGINTYPE}),{cache:!1}),d);return c}var g=alp.view.modalwin,f=oa.util;alp.sub("oa.x",null,!0).JourneyDialog={install:function(e){var d=alp.mixCheck({cont:null,proj:null,ooiid:null,btnClass:oa.JOURNEY_DIALOG_BTN,dialogTmplClass:"oax-plan-journey-dialog-tmpl",dialogTmplUrl:oa.JOURNEY_DIALOG_JSONP_TMPL,dialogExtraClass:"oax_plan_journey_dialog"},e);(e=alp.gEBCN(d.btnClass,d.cont))&&e.length&&alp.forEach(e,function(b){alp.aELtouchup(b,
alp.bindF(k,d))})}}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.format");
(function(){var k=alp.sub("alp.data",null,!0);k.format_image_or_video_2_api_obj=function(h,g){return alp.opt(h,"youtubeUrl")||alp.opt(h,"isVideo")?k.format_video_file_2_api_obj(h):k.format_image_file_2_api_obj(h,g)};k.format_image_file_2_api_obj=function(h,g){"string"===typeof h&&(h=h.match(/^(data:)?([^;]+);[^,]+,(.+)$/),h={mimeType:h[2],data:h[3]});var f=alp.opt(h,"data mimeType title source author id license primary gallery tracksign topo roadbook logo winterpano summerpano".split(" "),!0);f.title=
f.title||"";"string"===typeof f.license&&(f.license={id:f.license});if(g)for(var e=g.length,d=0;d<e;d++){var b=g[d],c=b[0];b=b[1];if(h.programmatic?h.id&&h.id===b.id:alp.oEqual(f,alp.opt(c,alp.oKeys(f)))){g.splice(d,1);f=alp.oCreateMix(f,{id:b.id});break}}return f};k.format_video_file_2_api_obj=function(h){if(h.programmatic)h=alp.opt(h,"id title description author source gallery primary isVideo altitude geometry video".split(" "));else{var g=alp.oGet(h,"title")||alp.oGet(h,"snippet.title"),f=alp.oGet(h,
"snippet.description"),e=alp.oGet(h,"snippet.channelTitle"),d=alp.oGet(h,"gallery"),b=alp.oGet(h,"primary"),c=alp.oGet(h,"recordingDetails.location.altitude")||null,a=alp.oGet(h,"recordingDetails.location.latitude"),k=alp.oGet(h,"recordingDetails.location.longitude"),l=null;a&&k&&(l=k+","+a);h={title:g,description:f,author:"unknown",source:e,gallery:d,primary:b,isVideo:!0,altitude:c,geometry:l,video:{youtubeId:alp.opt(h,"id",!0),duration:alp.isoDuration2seconds(alp.oGet(h,"contentDetails.duration"))}}}return h}})();
"undefined"!==typeof dojo&&dojo.provide("alp.x.checkbox_group");
(function(){alp.sub("alp.x",null,!0);alp.declare("alp.x.CheckboxGroup",alp.x.AbstractController,null,{objState:null,contNode:null,inputArr:null,extractKey:alp.f(".name"),init_value:null,getNode:function(k){return(this._inputObj||(this._inputObj=alp.arr2o(this._inputArr,alp.bindF("extractKey",this),alp.f())))[k]},augmentModel:function(k){this._inputArr=this.inputArr||alp.filter(alp.gEBTN("input",this.contNode),'alp.gA( v, "type" ) === "checkbox"');k.objState=this.objState||new alp.ObjectState},augmentKids:function(k){var h=
this;h.contNode.childNodes.a;h.m.objState.get();alp.styleform.init({now:!0,cont:{input:h._inputArr},labelCont:h.contNode,oncheck_init:function(g,f,e){g=e.originalNode;e=h.extractKey(g);f=new alp.BoolState({init_value:!(h.init_value?!alp.oGet(h.init_value,e):!f)});g.checked=f.get();k[e]={m:{is:f}};return f}})},setInitVal:function(k,h,g,f){g.objState.set(k.init_value||alp.arr2o(alp.map(k._inputArr,function(e){return[k.extractKey(e),!!e.checked]}),0,1))},connectModel2View:function(k,h,g,f){h.push(g.objState.change_cb_init(function(){var e=
g.objState.get(),d={},b;for(b in f)b in d||f[b].m.is.set(!!e[b])}))},connectView2Model:function(k,h,g,f){alp.forIn(f,function(e,d){h.push(e.m.is.change_cb(function(){g.objState.set_property(d,!!e.m.is.get())}))})}})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.input_file_multiple");
(function(){function k(a,b,c){for(var d=alp.oCreateMix({programmatic:!1},c),e=b.length,f=Array(e),g=0;g<e;g++){var l=b[g];d.programmatic&&(l=alp.oCreateMix(l,alp.opt(d,["programmatic"])));var h=alp.m(a,"checkFile",l);if(h){b=l.name;(a=alp.nodify(h,a.cont))&&alp.humane(a.innerHTML+" ("+b+")");return}a.completeFile&&(l=a.completeFile(l,c));!d.programmatic&&a.newFile_default&&(l=alp.oCreateMix(a.newFile_default,l));f[g]=l}return f}function h(a,b){function c(){if(g>=f)alp.resetFormPart(d);else{var b=
e[g++],l=new FileReader;l.onload=function(d){d||(d=window.event);d=(d.target||d.srcElement).result;var e=d.split(";")[1].split(",")[1];a.addFile(alp.mix({type:b.type,data:e,name:b.name,result:d}));c()};l.readAsDataURL(b)}}b||(b=window.event);var d=b.target||b.srcElement,e=d.files,f=e.length,g=0;c()}function g(a){function b(b,d){c=a.m.files.get();var e=alp.oGetDef(a,r,[]),f=c[d];f&&b<=c.length&&(c.splice(d,1),c.splice(b,0,f),a.m.files.set(c),f=e[d],e.splice(d,1),e.splice(b,0,f))}var c=a.m.files,d=
c.get(),e=c.getPrevious(),g=d.length,l=a.displayNode,h=g>=a.max||a.maxBytes<a.m.totalBytes.getPrevious();alp.setClass(a.inputNodeArr,a.noDisplayClass,h);a.inputBtnNodeArr.length&&alp.setClass(a.inputBtnNodeArr,a.disabledClass,h);if(l){for(;l.childNodes.length>g;)l.removeChild(l.lastChild);for(h=0;h<g;h++){var k=d[h],m=e[h],n=l.childNodes[h];k&&m&&a.isSame(k,m)&&n&&n.parentNode===l||f(a,k,n,h,l)}alp.m(a._dndgroup,"destroyAll");a._dndgroup=null;a.displayOneDnd&&l.firstChild&&(a._dndgroup=alp.x.dnd.group(alp.map(l.childNodes,
'alp.x.dnd( v, { clickable: "'+a.displayOneDnd+'", xy_constrain : alp.x.dnd.XY_CONSTRAIN_V, container : this })',a.filesNode),!1),a._dndgroup.movedEvt().then(b))}}function f(f,g,h,k,m){function n(){return this.displayTmplNode.innerHTML}function p(){var a=G.m.objState.get(),b=alp.oCopy(f.m.files.get());b[k]=alp.mix({},b[k],a);f.m.files.setNow(b);f.cbConstrain&&f.cbConstrain(k,q)}if(f[l])throw Error("IFM:renderDisplayOne loop detected!");f[l]=!0;var q=alp.oGetDef(f,r,[]),v=null,u=f.defaultRender,A;
for(A in f)if(!(A in b)&&/^render/.test(A)){var C=f[A];if(C.can.call(f,g)){u=C.render;v=C.dominit;var E=C.get_template||n;break}}h?alp.empty(h):h=alp.cE("div",m,{"class":f.displayOne});h.innerHTML=E.call(f,g);v&&v.call(f,h,g);alp.forEach(alp.gEBTN("input",h),'alp.sA(v,"name",alp.gA(v,"name")+"-"+'+k+")");alp.gEBCN(f.displayOneCounter,h)[0]&&(alp.gEBCN(f.displayOneCounter,h)[0].src=alp.cssBase()+"alp/gmap/resources/images/ooi_a_1_marker/black_green/img_round_"+alp.sPad(1+k,2)+".png");alp.nodify(f.displayOneContent,
h).innerHTML=u.call(f,g);m=alp.gEBCN(f.displayOneProperty,h);if(m.length){var G=new alp.x.CheckboxGroup({contNode:h,inputArr:m,init_value:g,extractKey:alp.f('v.name.replace("'+f.displayOneProperty+'-","").split("-").slice(0,-1).join("-")'),initNow:!0});G.m.objState.change_cb(p);q[k]=G.m.objState;f.cbConstrain&&f.cbConstrain(k,q)}alp.aEL(alp.gEBCN(f.displayOneDelete,h),"click",alp.bindF(d,null,f,g,h));alp.aEL(alp.gEBCN(f.metaToggle,h),"click",function(){var a=alp.gEBCN(f.metaCont,h);a&&a[0]&&(alp.hasClass(a[0],
f.noDisplayClass)?(alp.setClass(alp.filter(alp.gEBCN(f.metaCont,f.displayNode),function(b){return 0>alp.lastIndexOf(a,b)}),f.noDisplayClass,!0),alp.forEach(f.displayNode.childNodes,function(a){alp.setClass(a,f.displayOneSelected,a===h)})):alp.setClass(h,f.displayOneSelected,!1))});g=alp.gEBCN(f.metaEditStandard,h);alp.forEach(g,function(a){function b(){f._dndgroup.is_dragging_st().get()||f.m.files.set_property([k,c],a.value)}var c=a.className.match(f.metaEditStandard_rx)[1];alp.aEL(a,"change",alp.nowF(b));
setInterval(alp.nowF(function(){document.activeElement===a&&b()}),236)});alp.forEach(g,function(a){function b(){alp.setProp(d,"innerHTML",a.value||f.metaEditStandard_emptyHTML)}var c=a.className.match(f.metaEditStandard_rx)[1],d=alp.gEBCN(f.metaPreviewPrefix+c,h);alp.aEL(a,"change",b);b()});for(A in f)if(!(A in b))if((g=A.match(c))&&"function"===typeof f[A])f[A](h,g[1],f.m.files,k);else(g=A.match(a))&&"string"===typeof f[A]&&(g=g[1],m=alp.gEBCN(f[A],h),v=f["metaAuto_"+g],u=f["metaEditCustom_"+g],
m&&m.length&&alp.aEL(m,"click",e(f,h,g,m,v,u)));f[l]=!1}function e(a,b,c,d,e,f){return function(){var a=alp.hasClass(d[0],"active");alp.setClass(d,"active",!a);if("string"===typeof f){var c=alp.gEBCN(f,b);alp.setClass(c,"active",!a)}}}function d(a,b,c){var d=alp.lastIndexOf(c.parentNode.childNodes,c);alp.orphan(c);c=[].concat(a.m.files.get());a.isSame(c[d],b)||(d=alp.indexOf(c,b));c.splice(d,1);a.m.files.setNow(c)}var b={},c=/^metaEditCustomFun_(.*)$/,a=/^metaSwitchToCustom_(.*)$/;alp.declare("alp.x.InputFileMultiple",
alp.x.AbstractController,null,{cont:null,input:"alp-ifm-input",inputBtn:"alp-ifm-input-btn",display:"alp-ifm-display",displayTmpl:"alp-ifm-template",displayOne:"alp-ifm-one",displayOneContent:"alp-ifm-one-content",displayOneDelete:"alp-ifm-one-delete",displayOneSelected:"alp-ifm-one-selected",displayOneCounter:"alp-ifm-one-counter-X",displayOneDnd:"alp-ifm-one-dnd",displayOneProperty:"alp-ifm-one-cb-property",metaToggle:"alp-ifm-one-meta-toggle",metaCont:"alp-ifm-one-meta-cont",metaEditStandard:"alp-ifm-one-meta-edit",
metaEditStandard_rx:/\balp-ifm-one-meta-edit-(\S+)\b/,metaEditStandard_emptyHTML:"&ndash;",metaPreviewPrefix:"alp-ifm-one-meta-preview-",max:12,maxBytes:48E6,uploadWarningMessage:"alp-ifm-upload-warning",noDisplayClass:oax.NO_DISPLAY,disabledClass:oax.DISABLED,initFiles:null,toggle:"alp-ifm-toggle",files:"alp-ifm-files",checkFile:null,cbConstrain:null,newFile_default:null,addFile:function(a,b){if(a=alp.opt(k(this,[a],b),0))b=[].concat(this.m.files.get()),b.push(a),this.m.files.setNow(b)},addFileArr:function(a,
b){for(var c=a.length,d=0;d<c;d++)this.addFile(a[d],b)},setFileArr:alp.nowF(function(a,b){this.m.files.set(alp.filter(k(this,a,b),""));b&&b.isInit&&(this[m]=this.m.files.get())}),initNow:!0,augmentModel:function(a){var b=this;a.files=new alp.ObjectState({init_value:this.initFiles||[],constrain_all:function(a){if(a.length<=b.max)return a;var c=alp.opt(b.uploadWarningMessageNode,"innerHTML");c&&alp.humane(c);return a.slice(0,b.max)}});a.filesModified=new alp.BoolState;a.totalBytes=new alp.MinMaxState({min:0,
max:Infinity})},setInitVal:function(a,b,c,d){c.filesModified.unset();a.contNode=alp.nodify(a.cont);"undefined"===typeof FileReader?(alp.setClass(a.contNode,a.noDisplayClass,!0),a.notSupported=!0):alp.forEach("input inputBtn display displayTmpl toggle files uploadWarningMessage".split(" "),function(b){var c=a[b+"NodeArr"]=alp.gEBCN(a[b],a.contNode);c[0]&&(a[b+"Node"]=c[0])})},connectModel2Model:function(a,b,c,d){b.push(c.files.change_cb(function(){c.filesModified.set(!alp.oEqual(c.files.get(),a[m]));
c.totalBytes.set(alp.reduce(alp.map(c.files.get(),'Math.max( v && alp.oGet( v, "data.length" ) || 0, v && alp.oGet( v, "result.length" ) || 0 )'),"+"))}));b.push(c.totalBytes.change_cb(function(){a.maxBytes<c.totalBytes.get()&&c.files.set(c.files.get().slice(0,-1))}))},connectModel2View:function(a,b,c,d){a.notSupported||b.push(c.files.change_cb_init(g,null,a))},connectView2Model:function(a,b,c,d){a.notSupported||(b.push(alp.aEL(a.toggleNodeArr,"click",function(){alp.setClass(a.filesNodeArr,a.noDisplayClass,
!alp.hasClass(a.filesNodeArr[0],a.noDisplayClass))})),b.push(alp.aEL(a.inputNodeArr,"change",alp.bindF(h,null,a))))},isSame:function(a,b){return a.programmatic?a.id===b.id:b.type===a.type&&b.data===a.data&&b.name===a.name&&b.result===a.result},defaultRender:function(a){return a.name}});var m="_initArr",l="_within_rendispone",r="_i_2_cb_obj_state"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.input_file_multiple_img");
(function(){function k(b){return null!=b.author?alp.oGet(b,"author"):alp.oGet(b,"meta.author")?"":"unknown"}function h(b){return null!=b.source?alp.oGet(b,"source"):alp.oGet(b,"meta.source.id")?"":"unknown"}function g(b){if(!(b.programmatic||/image.*/.test(b.type)&&/(\.bmp|\.gif|\.jpg|\.jpeg|\.png|\.tiff|\.tif)$/i.test(b.name)))return"alp-ifm-msg-img-empty-or-invalid"}function f(b,c,a,d,f){var g=this,l=[f,b];a=g.m.files.get_property(l);var h="unknown"===a,k=e(this,b,c,f);f=alp.gA(alp.filter(k,'alp.gA(v,"checked")')[0],
"value")||"";alp.forEach(k,'(v.checked = v.value==="'+(a?h?"unknown":"custom":f)+'")  ?  alp.sA( v, "checked", "checked" )  :  alp.rA( v, "checked" )');var m=alp.mapany();f=alp.asyncF(0,function(){var a=alp.filter(k,"v.checked")[0].value;alp.now("set_property",d,l,"custom"===a?t.value:a)});alp.styleform.init({now:!0,cont:{input:k},oncheck_init:function(a,b,c){a=c.originalNode;a.childNodes.a;return m.set(a,new alp.BoolState({init_value:!!alp.gA(a,"checked")}))},oncheck:f});var u="imgCustom"+alp.sCapitalize(b),
t=alp.nodify(this[u],c);u=alp.filter(k,function(a){return alp.isDescendant(t,a.parentNode)||alp.isDescendant(t,a.parentNode.parentNode)})[0];var w=m.get(u);u.childNodes.a;w.setNow.call.a;t&&(t.value=!h&&a||"");alp.aEL(t,"mousedown",function(){w.setNow(!0)});alp.aEL(t,"mousedown",f);alp.aEL(t,"focus",f);alp.aEL(t,"change",f);f();var x=alp.gEBCN("alp-ifm-one-meta-preview-"+b,c);d.change_cb_init(function(){var a=d.get_property(l);a?"unknown"===a?(a=alp.nodify("alp-ifm-one-unknown-"+b,c),alp.setText(x,
a?alp.textContent(a):"")):alp.setText(x,a):(a=alp.nodify("alp-ifm-one-std-"+b,c),alp.setProp(x,"innerHTML",a&&alp.textContent(a)||g.metaEditStandard_emptyHTML))})}function e(b,c,a,d){var e="imgRadio"+alp.sCapitalize(c);c=alp.gEBCN(b[e],a);alp.forEach(c,function(c){var f=b[e]+"-"+d,g=alp.newId(f,a);alp.sA(c,{name:f,id:g});c=alp.gEBTN("label",c.parentNode);1===c.length&&alp.sA(c[0],"for",g)});return c}var d={};alp.declare("alp.x.InputFileMultipleImg",alp.x.InputFileMultiple,null,{checkFile:g,cbConstrain:function(b,
c){if(c[b].get().primary)for(var a in c)if(!(a in d)&&b!=a){var e=c[a],f=e.get();f.primary&&(f=alp.oCopy(f),delete f.primary,e.set(f))}},newFile_default:{gallery:!0},metaAuto_author:"alp-ifm-one-meta-auto-author",metaSwitchToCustom_author:"alp-ifm-one-meta-toggle-author",metaEditCustom_author:"alp-ifm-one-meta-edit-author",imgRadioAuthor:"alp-ifm-one-radio-author",imgCustomAuthor:"alp-ifm-one-custom-author",metaEditCustomFun_author:function(b,c,a,d){f.call(this,"author",b,c,a,d)},metaAuto_source:"alp-ifm-one-meta-auto-source",
metaSwitchToCustom_source:"alp-ifm-one-meta-toggle-source",metaEditCustom_source:"alp-ifm-one-meta-edit-source",imgRadioSource:"alp-ifm-one-radio-source",imgCustomSource:"alp-ifm-one-custom-source",metaEditCustomFun_source:function(b,c,a,d){f.call(this,"source",b,c,a,d)},metaEditCustom_license:"alp-ifm-one-meta-edit-license",radioStyleformLater:"alp-styleform-styled-later",completeFile:function(b,c){return b.programmatic?alp.oCreateMix(b,{imgsrc_url:alp.cfg.url.imgthumb_from_id(b.id),author:k(b),
source:h(b)}):b},renderImg:{can:function(b){return!g(b)},dominit:function(b,c){c.readonly?(alp.orphan(alp.gEBCN(this.displayOneDelete,b)),alp.sA(alp.gEBCN(this.metaEditStandard,b),"readonly","readonly"),alp.sA(alp.gEBCN(this.metaEditCustom_license,b),"disabled","disabled"),alp.orphan(alp.gEBCN(this.metaSwitchToCustom_author,b)),alp.orphan(alp.gEBCN(this.metaSwitchToCustom_source,b))):(alp.setClass(alp.gEBCN(this.metaSwitchToCustom_author,b),"alp-x-clickable",!0),alp.setClass(alp.gEBCN(this.metaSwitchToCustom_source,
b),"alp-x-clickable",!0));var a=alp.oGet(c,"author")||alp.oGet(c,"meta.author")||"",d=alp.oGet(c,"source");d="unknown"!==d&&d||alp.oGet(c,"meta.source.name")||"";var e=alp.oGet(c,"license.id");a&&alp.setText(alp.gEBCN(this.metaAuto_author,b),a);d&&alp.setText(alp.gEBCN(this.metaAuto_source,b),d||"");var f;e&&(f=alp.gEBCN(this.metaEditCustom_license,b)[0])&&(f.value=e);(function(a,b){b=b===alp.gA(a[0],"placeholder")?"":b;alp.setProp(a,"value",b)})(alp.gEBCN(this.metaEditStandard+"-title",b),c.title||
"");var g=alp.oGet(c,"meta.source.id")?0:"unknown"===c.source?1:2;alp.forEach(alp.gEBCN(this.imgRadioSource,b),function(a){var b=alp.gA(a,"value");if(0===g&&!b||1===g&&"unknown"===b||2===g&&"custom"===b)a.checked=!0});alp.nodify(this.imgCustomSource,b).value=2===g&&alp.oGet(c,"source")||""},render:function(b){return['<img class="alp_ifm_img_thumb" src="',b.programmatic?alp.m(new String(b.imgsrc_url),"replace",alp.cfg.url.img2_fit_rx,"/144x112r/"):b.result,'" title="',escape(b.name||""),'"/>'].join("")}}})})();
"undefined"!==typeof dojo&&dojo.provide("alp.x.input_file_multiple_video");
(function(){function k(e,d){alp.stopEvent(d||window.event);d=e.connectUrlNode.value;g(!1,e.cont);d&&(d=oax.YOUTUBE_YOUTUBE_ID_FROM_URL(d),alp.xhrGet(alp.tmpl(oax.YOUTUBE_API_URL_TMPL,{id:d,apiKey:oa.YOUTUBE_API_KEY,part:"snippet,contentDetails,status,recordingDetails",fields:"items(id,snippet(title,description,channelTitle),contentDetails(duration),status(privacyStatus,embeddable),recordingDetails(location))"}),{throwError:!1}).then(alp.bindF(h,null,e)))}function h(e,d){function b(a){g(!0,e.connectUrlNode,
alp.nodify(a,e.cont).innerText)}var c=d.status;200!==c&&0!==c||!alp.opt(d.responseJson.items,"length")?b(e.exceptionUrlInvalid):(d=d.responseJson.items[0],c=alp.opt(d,"id"),"public"!==alp.opt(d.status,"privacyStatus")?b(e.exceptionVideoNotPublic):alp.opt(d.status,"embeddable")?c?(e.connectUrlNode.value="",e.addFile(d)):b(e.exceptionVideoUnknown):b(e.exceptionVideoNotEmbeddable))}function g(e,d,b){alp.humane.forceNew=!1;e?(alp.setClass(d,"oax_error",!0),alp.humane.timeout=Infinity,alp.humane(b,{extraClass:"oax_error_msg",
target:d})):(alp.humane.remove(),(e=alp.nodify("oax_error",d))&&alp.setClass(e,"oax_error",!1))}function f(e){if(!(e.programmatic||e.id&&alp.opt(e.snippet,"title")))return"alp-ifm-msg-video-empty-or-invalid"}alp.declare("alp.x.InputFileMultipleVideo",alp.x.InputFileMultiple,null,{checkFile:f,newFile_default:{gallery:!0},connectUrl:"alp-ifm-connect-url",connectBtn:"alp-ifm-connect-btn",displayUrl:"alp-ifm-display-video-url",metaTitle:"alp-ifm-one-meta-edit-title",exceptionUrlInvalid:"alp-ifm-msg-url-invalid",
exceptionVideoNotPublic:"alp-ifm-msg-video-not-public",exceptionVideoNotEmbeddable:"alp-ifm-msg-video-not-embeddable",exceptionVideoUnknown:"alp-ifm-msg-video-unknown",isSame:function(e,d){return e.programmatic?e.id===d.id:d.id===e.id&&alp.opt(d.snippet,"title")===alp.opt(d.snippet,"title")&&alp.opt(d.snippet,"description")===alp.opt(d.snippet,"description")&&alp.opt(d.snippet,"channelTitle")===alp.opt(d.snippet,"channelTitle")},completeFile:function(e,d){e.thumbUrl=alp.tmpl(oax.YOUTUBE_IMG_URL_TMPL,
e);e.youtubeUrl=alp.tmpl(oax.YOUTUBE_VIDEO_URL_TMPL,e);return e},renderVideoSnippet:{can:function(e){return!f(e)},dominit:function(e,d){d.readonly&&alp.orphan(alp.gEBCN(this.displayOneDelete,e));alp.setClass(alp.nodify(oax.ID,e),oax.ID_PREFIX+d.id,!0);alp.nodify(this.displayUrl,e).innerText=d.programmatic?alp.tmpl(oax.YOUTUBE_VIDEO_URL_TMPL,{id:d.video.youtubeId}):d.youtubeUrl;alp.nodify(this.metaTitle,e).value=d.title||d.snippet.title},render:function(e){return['<img src="',e.programmatic?alp.m(new String(e.imgsrc_url),
"replace",alp.cfg.url.img2_fit_rx,"/144x112r/"):e.thumbUrl,'" title="',e.title||e.snippet.title,'"/><span class="oax-icon-play oax_video_play oax_video_play_medium"></span>'].join("")}},setInitVal:function(e,d,b,c){alp.forEach(["connectUrl","connectBtn"],function(a){var b=e[a+"NodeArr"]=alp.gEBCN(e[a],e.contNode);b[0]&&(e[a+"Node"]=b[0])})},connectView2Model:function(e,d,b,c){alp.aEL(e.connectBtnNodeArr,"click",alp.bindF(k,null,e));alp.aEL(e.connectUrlNode,"keypress",function(a){if(a.keyCode===alp.key.ENTER)return k(e,
a),!1})}})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.input_file_multiple_img_ext");
(function(){function k(e){return h(e)?this.kx.vidx.checkFile.call(this,e):this._alpParentProto.checkFile.call(this,e)}function h(e){return e&&(e.isVideo||"undefined"!==typeof e.youtubeUrl)}function g(e){var d=this,b=this.kx;b.vidx=new alp.x.InputFileMultipleVideo({cont:e,connectUrl:"alp-tpwiz-in-videos-url",connectBtn:"alp-tpwiz-in-videos-connect",initNow:!1});b.vidx.m.files.change_cb_init(function(c){c.length&&(d.addFile(c[0]),b.vidx.setFileArr([]),d.videoDialog.close())})}var f=alp.view.modalwin;
alp.declare("alp.x.InputFileMultipleImgExt",alp.x.InputFileMultipleImg,null,{videoBtnClass:"alp-ifm-add-video",videoDialogTmplClass:"alp-ifm-video-dialog-tmpl",videoSnippetTmplClass:"alp-ifm-template-video",max:15,metaEditCustomFun_author:function(e,d,b,c){var a=b&&b.get()[c];if(a&&!h(a))return this._alpParentProto.metaEditCustomFun_author.apply(this,arguments)},metaEditCustomFun_source:function(e,d,b,c){var a=b&&b.get()[c];if(a&&!h(a))return this._alpParentProto.metaEditCustomFun_source.apply(this,
arguments)},augmentModel:function(e){alp.forEach(["videoBtn","videoDialogTmpl","videoSnippetTmpl"],function(d){var b=this[d+"NodeArr"]=alp.gEBCN(this[d+"Class"],this.cont);b[0]&&(this[d+"Node"]=b[0])},this)},augmentKids:function(e){this.videoDialogTmplNode&&(this.videoDialog=f.create({html:this.videoDialogTmplNode.innerHTML,width:640,height:250,extraClass:"oax_video_connect_dialog",onCreate:alp.nowF(g,this)}))},connectView2Model:function(e,d,b,c){e.videoBtnNode&&e.videoDialog&&d.push(alp.aEL(e.videoBtnNode,
"click",alp.bindF("open",e.videoDialog)))},isSame:function(e,d){return h(e)?this.kx.vidx.isSame.apply(this,arguments):this._alpParentProto.isSame.apply(this,arguments)},checkFile:k,renderImgOrVideo:{can:function(e){return!k.call(this,e)},dominit:function(e,d){return h(d)?this.kx.vidx.renderVideoSnippet.dominit.call(this.kx.vidx,e,d):this.renderImg.dominit.call(this,e,d)},render:function(e){return h(e)?this.kx.vidx.renderVideoSnippet.render.call(this.kx.vidx,e):this.renderImg.render.call(this,e)},
get_template:function(e){return h(e)?this.videoSnippetTmplNode.innerHTML:this.displayTmplNode.innerHTML}}})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.name2title");
(function(){function k(h){return"string"===typeof h.cfg?(h=alp.nodify(h.cfg,alp.nodify(h.cfgCont)))&&alp.oFrom(h.value):h.cfg}alp.declare("alp.x.Name2Title",alp.x.AbstractController,null,{cfg:null,cfgCont:null,defaultTitle:"",augmentModel:function(h){h.name=new alp.State;h.title=new alp.State},setInitVal:function(h,g,f,e){g=k(h);g.name2title.a;g.node&&g.node.substring.a;h._cfg=g;h._outNodeArr=h._cfg.node&&alp.gEBCN(h._cfg.node)},connectModel2Model:function(h,g,f,e){g.push(f.name.change_cb_init(function(d){f.title.set(h._cfg.name2title[d])}))},
connectModel2View:function(h,g,f,e){function d(b){b||(b=h.defaultTitle);for(var c=h._outNodeArr.length;c--;){var a=h._outNodeArr[c];"value"in a?a.value=b:a.innerHTML=b}}h._outNodeArr&&g.push(f.title.change_cb_init(d))}});alp.x.Name2Title.optional=function(h){if(k(h))return new alp.x.Name2Title(h)}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.rating");
(function(){function k(h,g){for(var f=h.length;f--;)if(alp.isDescendant(g,h[f]))return 1+f;return null}alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.Rating",alp.x.AbstractController,null,{cont:null,init_max_value:null,init_max_value_class_rx:/alp-rating-max-(\d+)(\s|$)/,init_value:null,init_value_class_rx:/alp-rating-value-(\d+)(\s|$)/,interactive:!0,highlightOnlyOne:!1,childClass:"alp-rating-child",selectionClass:"alp-rating-active",mouseoverClass:"alp-rating-mouseover",name2title:"alp-name2title",
name2titleSel:"alp-name2title-sel",selectionCopyNode:"alp-rating-hidden-output",onSelection:null,onMouseover:null,augmentModel:function(h){h.max=new alp.MinMaxState({min:0});h.selection=new alp.MinMaxState({min:0});h.mouseover=new alp.MinMaxState({min:0})},augmentKids:function(h){(this.cont.substring||this.cont.childNodes).a;this.name2title&&(h.name2title=alp.x.Name2Title.optional({cfg:this.name2title,cfgCont:this.cont}));this.name2titleSel&&(h.name2titleSel=alp.x.Name2Title.optional({cfg:this.name2titleSel,
cfgCont:this.cont}))},setInitVal:function(h,g,f,e){h.contNode=alp.nodify(h.cont);h.childArr=alp.gEBCN(h.childClass,h.contNode);h._selectionCopyNode="string"!==typeof h.selectionCopyNode?h.selectionCopyNode:alp.nodify(h.selectionCopyNode,h.contNode);g=h.childArr.length;if(!g)for(e=g=(h.init_max_value||h.init_max_value_class_rx.exec(h.contNode.className)[1])|0;e--;)h.childArr.push(alp.cE("span",h.contNode,{"class":h.childClass},{innerHTML:"&#9733;"}));f.max.set(g);g=h.init_value;null==g&&(g=~~alp.opt(h.init_value_class_rx.exec(h.contNode.className),
1));f.selection.set(g||0);f.mouseover.set(null)},connectModel2Model:function(h,g,f,e){g.push(f.max.change_cb_init(function(){f.selection.max=f.mouseover.max=f.max.get();f.selection.set(f.selection.get());f.mouseover.set(f.mouseover.get())}))},connectModel2View:function(h,g,f,e){function d(){for(var b=f.selection.get(),c=f.mouseover.get(),a=0<c,d=h.highlightOnlyOne,g=h.childArr.length,k=0;k<g;k++)alp.setClass(h.childArr[k],alp.arr2o([[h.selectionClass,!a&&(d?k===b-1:k<b)],[h.mouseoverClass,a&&(d?k===
c-1:k<c)]],0,1));e.name2title&&e.name2title.m.name.setNow(a?c:b);e.name2titleSel&&e.name2titleSel.m.name.setNow(b);(c=h._selectionCopyNode)&&(c["value"in c?"value":"innerHTML"]=b+"")}g.push(f.selection.change_cb_init(d));g.push(f.mouseover.change_cb_init(d));h.onSelection&&f.selection.change_cb_init(h.onSelection);h.onMouseover&&f.mouseover.change_cb_init(h.onMouseover)},connectView2Model:function(h,g,f,e){function d(b){b||(b=window.event);alp.stopEvent(b);f.mouseover.setNow(0)}h.interactive&&(g.push(alp.aEL(h.childArr,
"mouseover",function(b){b||(b=window.event);alp.stopEvent(b);b=k(h.childArr,b.target||b.srcElement);null!=b&&f.mouseover.setNow(b)})),g.push(alp.aEL(h.contNode,"mouseout",d)),g.push(alp.aEL(h.contNode,"mouseup",d)),g.push(alp.aEL(h.childArr,"click",function(b){b||(b=window.event);alp.stopEvent(b);b=k(h.childArr,b.target||b.srcElement)||0;f.selection.setNow(f.selection.is(b)?0:b)})))}})})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.image_fix_author_source");
(function(){function k(h){if(!h||h.isVideo||h.youtubeUrl||h.video)return h;if("image"in h)return{image:k(h.image)};if(h instanceof Array)return alp.map(h,k);var g=h.license;return alp.filterIn(alp.mix({},h,{author:h.author||null,source:h.source||"",license:"string"===typeof g?{id:g}:g?g:null}),'w!="token" && w!="proj"')}alp.sub("alp.data.api",null,!0).imageFixAuthorSource=k})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.comment");
(function(){var k=alp.sub("alp.data.api",null,!0);k.commentCreate=function(h,g){h.proj.substring.a;var f=alp.dfrd("ADA:commentCreate",{then:1});alp.m(k.token(),["to","then"],function(e){var d=h;d.ooiid.substring.a;d.proj.substring.a;d.userid.substring.a;d=alp.mix({},d);delete d.proj;d.ooiid&&delete d.ooiid;d.proj&&delete d.proj;d.userid&&delete d.userid;d.images=alp.data.api.imageFixAuthorSource(d.images);d=alp.util.json.stringify(d);e=alp.cfg.url.api_write_comment_create({proj:h.proj,token:e,userid:h.userid,
ooiid:h.ooiid});alp.m(alp.xhrPut(e,alp.oCreateMix(g||{},{sendData:d,receiveJson:!0})),["to","then"],alp.bindF(f.done||f.triggerSoon,f))});return f}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.ooi_adder_comment");
(function(){function k(c){var a=h(c);if(a.comment||a.imagefiles.length||!c._alreadyRated&&0<a.rating)if(c._publishing)console.error("OoiAdderComment: already publishing... Simply ignoring the user click, because the backend answer should come soon anyway.");else{c._publishing=!0;var f=c.cont;(c._waitbox||(c._waitbox=new alp.x.Waitbox({delay_ms:11}))).setTarget(f).startWait();var l=alp.dom.windowExitIntercept(b.upload_abort_situation);e.commentCreate(g(a,c._alreadyRated),{throwError:!1}).then(function(b){null!=
l&&alp.rEL(l);c._waitbox.stopWait().setTarget(null);c._publishing=!1;if(200!==b.status){var e="OoiAdderComment: publishing failed ("+b.status+")";console.error(e,a,b);throw Error(e,a,b);}(new alp.x.Waitbox({targetInit:alp.body(),delay_ms:0})).startWait();b=location.href.replace(/([\?#].*?)?$/,"?"+ +new Date+location.hash);d.generic_login_barrier_before({type:oax.COMMENT_SCROLLTO_SESTOR+"-commentsNconditions",href:b});location.href=b})}else f=alp.nodify(c.msgEmptyComment,c.cont),alp.humane(f&&f.innerHTML||
"Please first write a comment or upload a picture.")}function h(b){var a=alp.gEBTN("form",b.cont)[0].elements,c=b.inputPrefix,d={comment:a[c+"comment"].value,imagefiles:b.kx.images?b.kx.images.m.files.get():[],rating:a[c+"rating"]?a[c+"rating"].value:null,proj:b.proj,userid:b.userid,ooiid:b.ooiid};b.kx.date&&b.kx.date.getDate()&&(d.dayOfInspection=alp.opt(a[c+"dayOfInspection"],"value"));return d}function g(b,a){var c=alp.map(b.imagefiles,f.format_image_or_video_2_api_obj),d={description:b.comment,
dayOfExperience:b.dayOfInspection,proj:b.proj,meta:{system:{createdIn:b.proj}},userid:b.userid,ooiid:b.ooiid};a||(d.assessment=b.rating);0<c.length&&(d.images={image:c});return d}var f=alp.data,e=f.api,d=oa.util.community,b={};alp.i18n.fetch("alp.all").then(function(c){b=c});alp.declare("oax.x.OoiAdderComment",alp.x.AbstractController,null,{cont:null,proj:null,ooiid:null,userid:null,edit:"oax-comment-edit",date:"oax-comment-date-pick",dateIcon:"oax-comment-date-icon",images:"oax-comment-in-images-cont",
rating:"oax-ooi-rating",ratingHidden:"oax-comment-in-rating",alreadyRated:"oax-comment-in-already-rated",imgToggle:"oax-comment-in-images-toggle",imgInput:"oax-comment-in-images-input",imgFiles:"oax-comment-in-images-files",imgDisplay:"oax-comment-in-images-display",preview:"oax-comment-preview",previewPrefix:"oax-comment-preview-",buttonEdit:"oax-comment-action-edit",buttonPreview:"oax-comment-action-preview",buttonPublish:"oax-comment-action-publish",msgEmptyComment:"oax-comment-msg-empty",inputPrefix:"oax-comment-in-",
augmentModel:function(b){b.preview=new alp.BoolState},augmentKids:function(b){this.cont.childNodes.a;var a=new Date;alp.nodify(this.date,this.cont)&&(b.date=new alp.x.Pikaday({field:alp.nodify(this.date,this.cont),clickNode:alp.nodify(this.dateIcon,this.cont),setDefaultDate:!1,defaultDate:a,minDate:new Date("2000-01-01"),maxDate:a,useRelativeDays:!0,top_wrap:"oax"}));if(a=alp.nodify(this.images,this.cont))b.images=new alp.x.InputFileMultipleImgExt({cont:a,input:this.imgInput,display:this.imgDisplay,
toggle:this.imgToggle,files:this.imgFiles,initNow:!1});if(a=alp.nodify(this.rating,this.cont))b.rating=new alp.x.Rating({cont:a,selectionCopyNode:alp.nodify(this.ratingHidden,this.cont)});this._alreadyRated=(b=alp.nodify(this.alreadyRated,this.cont))&&/^true$/i.test(alp.gA(b,"value"))},connectModel2View:function(b,a,d,e){a.push(d.preview.change_cb_init(function(a){var d=alp.gEBCN(b.edit,b.cont),e=alp.gEBCN(b.preview,b.cont);alp.setClass(d,oax.NO_DISPLAY,a);alp.setClass(e,oax.NO_DISPLAY,!a);if(a){var f=
h(b),g=!!f.dayOfInspection,l=g&&alp.str2date(f.dayOfInspection),k=b.previewPrefix;g&&alp.setText(alp.gEBCN(k+"dayOfInspection-value",b.cont),alp.date2str(l,"{DD}.{MM}.{YYYY}"));alp.setClass(alp.gEBCN("oax-comment-preview-dayOfInspection",b.cont),oax.NO_DISPLAY,!g);alp.setText(alp.gEBCN(k+"comment",b.cont),f.comment);alp.setClass(alp.gEBCN(k+"rating-stars",b.cont),alp.arr2o([0,1,2,3,4,5],alp.f('"oax-rating-value-"+'),alp.f("false")));alp.setClass(alp.gEBCN(k+"rating-stars",b.cont),"oax-rating-value-"+
f.rating,!0);g=0<f.rating;alp.setClass(alp.gEBCN(["oax-comment-preview-rating","oax-comment-preview-rating-stars"],b.cont),oax.NO_DISPLAY,!g);if(k=alp.nodify(k+"images-cont",b.cont))for(alp.empty(k),f=f.imagefiles,g=f.length,l=0;l<g;l++){var m=k.childNodes[l]||alp.cE("li",k);m=alp.gEBTN("img",m)[0]||alp.cE("img",m);alp.sA(m,"src",f[l].result)}}c&&alp.m((a?e:d)[0],"scrollIntoView");c=!0}));var c},connectView2Model:function(b,a,e,f){function c(){var a=f.date.getDate();alp.nodify(b.inputPrefix+"dayOfInspection",
b.cont).value=a?alp.date2str(f.date.getDate()):""}for(var g=["click","touchstart"];g.length;){var l=g.pop();a.push(alp.aEL(alp.gEBCN(b.buttonEdit,b.cont),l,function(){e.preview.setNow(!1)}));a.push(alp.aEL(alp.gEBCN(b.buttonPreview,b.cont),l,function(){e.preview.setNow(!0)}));a.push(alp.aEL(alp.gEBCN(b.buttonPublish,b.cont),l,alp.bindF(k,null,b)))}f.date&&(a.push(f.date.selectEvt().then(c)),c());d.generic_login_barrier_after({type:oax.COMMENT_SCROLLTO_SESTOR+"-commentsNconditions"},function(){var a=
alp.gEBI("commentsNconditions");a&&alp.asyncF(333,a.scrollIntoView,a)()})}})})();"undefined"!==typeof dojo&&dojo.provide("alp.util.math.place_rectangle");
(function(){alp.sub("alp.util.math",null,!0).placeRectangle=function(k,h,g,f,e){f||(f=[]);var d=alp.oCreateMix({epsilon:1,grid:16,iter:2,best:4}),b=k/2,c=h/2;e=g.left;var a=g.right,m=g.top,l=g.bottom,r=e+b,n=a-b,q=m+c,p=l-c,v=d.epsilon,u=d.iter,t=d.best;d=d.grid;var w={xmin:g.left,ymin:g.top,xmax:g.right,ymax:g.bottom};g=[w];var x=function(a,d){for(var e=Math.min(a-r,n-a),g=Math.min(d-q,p-d),l=Infinity,h=f.length;h--;){var k=f[h];var m=k.left-b;var t=k.right+b,w=k.top-c;k=k.bottom+c;m=m<a&&a<t&&w<
d&&d<k?Math.min(m-a,a-t,w-d,d-k):Math.min(Math.min(Math.abs(a-m),Math.abs(a-t)),Math.min(Math.abs(d-w),Math.abs(d-k)));m<l&&(l=m)}a=[e,g,l];d=Infinity;l=g=e=0;for(h=a.length;h--;)m=a[h],m>=v?(d=Math.min(m/v,d),e++):(g=m*m,l++);return 1>l?d:-g-1/(1+d)};w.x=(w.xmin+w.xmax)/2;w.y=(w.ymin+w.ymax)/2;for(w.fit=x(w.x,w.y);u--;){w=g.length;for(var y=0;y<w;y++){var z=g[y],A=z.xmin,C=z.ymin,E=(z.xmax-A)/d;z=(z.ymax-C)/d;for(var G=E/2,B=z/2,I=d;I--;A+=E)for(var L=C,J=d;J--;L+=z)g.push({x:A,y:L,xmin:Math.max(e,
A-G),ymin:Math.max(m,L-B),xmax:Math.min(a,A+G),ymax:Math.min(l,L+B),fit:x(A,L)})}g.sort(function(a,b){return a.fit<b.fit?1:-1});g=g.slice(0,t)}k={cx:g[0].x,cy:g[0].y,width:k,height:h};k.left=k.cx-b;k.right=k.cx+b;k.top=k.cy-c;k.bottom=k.cy+c;return k}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.util.place_infonode");
(function(){function k(f,e){for(var d=f,b=e.length;b--;){var c=e[b];c&&("number"===typeof c?d+=c*f:(c=/^(.*)px$/.exec(c),d+=c[1]|0))}return d}var h=alp.sub("alp._gmap2_3.util",null,!0),g=alp._gmap2_3;h.placeInfoNode=function(f,e,d){function b(){var a=alp.gBCR(n);return a.width&&a.height}function c(){return(a.closeTest?a.closeTest():!0)&&!b()}var a=alp.oCreateMix({otherNodesClass:["alp-map-info-other","gmnoprint"],otherNodesCache:null,padding:null,closeTest:null,onClose:null},d),h=f.getCenter(),l=
f.getZoom();d=a.otherNodesCache;var r=f.getDiv(),n="childNodes"in e&&e;e=n?alp.gBCR(n):e;!n||n.childNodes.a;alp.and(["left","top","width","height"],"this[v].toPrecision.a",e);r.childNodes.a;if(!d){d=a.otherNodesCache=[];for(var q=a.otherNodesClass;q--;)d.push.apply(d,alp.gEBCN(a.otherNodesClass[q],r))}r=alp.gBCR(r);d=alp.filter(alp.map(d,"alp.gBCR(v)"),"v.width > 0  &&  v.height > 0");q=a.padding;d=alp.util.math.placeRectangle(k(e.width,[alp.opt(q,"left"),alp.opt(q,"right")]),k(e.height,[alp.opt(q,
"top"),alp.opt(q,"bottom")]),r,d);f.panBy(-(d.left-e.left),-(d.top-e.top));a.onClose&&(n.childNodes.a,alp.subDfrd(b).then(function(){var b=!1;g.event("addListenerOnce")(f,"zoom_changed",function(){l!==f.getZoom()&&(b=!0)});g.event("addListenerOnce")(f,"drag",function(){h&&!h.equals(f.getCenter())&&(b=!0)});alp.subDfrd(c).then(function(){a.onClose({origZoom:l,origCenter:h,mapMoved:b})})}));return a}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.condition");
(function(){function k(f){f=alp.opt(f,g,!0);alp.and(["title","geometry","dayOfInspection"],"this[v].substring.call.a",f);f.tourid||delete f.tourid;f.images=alp.data.api.imageFixAuthorSource(f.images);"activity"in f&&(f.relatedActivity={id:f.activity||""},delete f.activity);return alp.util.json.stringify(f)}var h=alp.sub("alp.data.api",null,!0),g="activity dayOfInspection geometry id images longText riskDescription title weatherDescription relatedOOI".split(" ");h.conditionCreate=function(f,e){f.proj.substring.a;
var d=alp.dfrd("ADA:conditionCreate",{then:1});h.token().then(function(b){var c=k(f);b=alp.cfg.url.api_write_condition_create({proj:f.proj,token:b});alp.xhrPut(b,alp.oCreateMix(e||{},{sendData:c,receiveJson:!0})).then(alp.bindF("triggerSoon",d))});return d};h.conditionDelete=function(f,e){f.proj.substring.a;f.id.substring.a;var d=alp.dfrd("ADA:conditionDelete",{then:1});h.token().then(function(b){b=alp.cfg.url.api_write_condition_delete({proj:f.proj,token:b,id:f.id});alp.xhrDelete(b,alp.oCreateMix(e||
{},{receiveJson:!0})).then(alp.bindF("triggerSoon",d))});return d};h.conditionUpdate=function(f,e){f.proj.substring.a;f.id.substring.a;var d=alp.dfrd("ADA:conditionUpdate",{then:1});h.token().then(function(b){var c=k(f);b=alp.cfg.url.api_write_condition_update({proj:f.proj,token:b,id:f.id});alp.xhrPost(b,alp.oCreateMix(e||{},{sendData:c,receiveJson:!0})).then(alp.bindF("triggerSoon",d))});return d};h.CONDITION_SAVE_JSON_FIELDS=function(){return[].concat(g)}})();"undefined"!==typeof dojo&&dojo.provide("alp.util.placeholder");
alp.mix(alp.sub("alp.util.placeholder",null,!0),function(){function k(a){a.createTextRange?(a=a.createTextRange(),a.move("character",0),a.select()):a.selectionStart&&(a.focus(),a.setSelectionRange(0,0))}function h(){var a;if(this.value===this.getAttribute("placeholder"))if(r.hideOnFocus){if(this.className=this.className.replace(p,""),this.value="",a=this.getAttribute("data-placeholdertype"))this.type=a}else k(this)}function g(){var a;""===this.value&&(this.className=this.className+" "+r.className,
this.value=this.getAttribute("placeholder"),a=this.getAttribute("data-placeholdertype"))&&(this.type="text")}function f(){var a=this.getElementsByTagName("input"),b=this.getElementsByTagName("textarea"),c=a.length,d=c+b.length,e;for(e=0;e<d;e+=1){var f=e<c?a[e]:b[e-c];var g=f.getAttribute("placeholder");f.value===g&&(f.value="")}}function e(a){q=this.value;return!(q===this.getAttribute("placeholder")&&-1<n.indexOf(a.keyCode))}function d(){var a;this.value!==q&&(this.className=this.className.replace(p,
""),this.value=this.value.replace(this.getAttribute("placeholder"),""),a=this.getAttribute("data-placeholdertype"))&&(this.type=a);""===this.value&&(g.call(this),k(this))}function b(a,b,c){if(a.addEventListener)return a.addEventListener(b,c.bind(a),!1);if(a.attachEvent)return a.attachEvent("on"+b,c.bind(a))}function c(a){r.hideOnFocus||(b(a,"keydown",e),b(a,"keyup",d));b(a,"focus",h);b(a,"blur",g)}function a(){var a=document.getElementsByTagName("input"),d=document.getElementsByTagName("textarea"),
e=a.length,g=e+d.length,h;for(h=0;h<g;h+=1){var k=h<e?a[h]:d[h-e];var m=k.getAttribute("placeholder");if(-1<l.indexOf(k.type)&&m){var n=k.getAttribute("data-currentplaceholder");m!==n&&(k.value!==n&&k.value!==m&&k.value||(k.value=m,k.className=k.className+" "+r.className),n||(k.form&&(n=k.form,n.getAttribute("data-placeholdersubmit")||(b(n,"submit",f),n.setAttribute("data-placeholdersubmit","true"))),c(k)),k.setAttribute("data-currentplaceholder",m))}}}function m(a){var d=a.getElementsByTagName("input");
a=a.getElementsByTagName("textarea");var e=d.length,g=e+a.length,h;for(h=0;h<g;h+=1){var k=h<e?d[h]:a[h-e];var m=k.getAttribute("placeholder");if(-1<l.indexOf(k.type)&&m){if("password"===k.type)try{k.type="text",k.setAttribute("data-placeholdertype","password")}catch(A){}k.setAttribute("data-currentplaceholder",m);if(""===k.value||k.value===m)k.className=k.className+" "+r.className,k.value=m;k.form&&(m=k.form,m.getAttribute("data-placeholdersubmit")||(b(m,"submit",f),m.setAttribute("data-placeholdersubmit",
"true")));c(k)}}}var l="text search url tel email password number textarea".split(" "),r={live:!1,hideOnFocus:!0,className:"placeholderspolyfill",textColor:!1,styleImportant:!0,topNode:document},n=[37,38,39,40],q,p=new RegExp("\\b"+r.className+"\\b");return{init:function(b){function c(a){a.value===alp.gA(a,"placeholder")&&(a.value="")}var d=document.createElement("input"),e,f,g;alp.likeIE()&&"undefined"!==typeof document.createElement("textarea").placeholder&&alp.forEach(alp.gEBTN("textarea",b&&b.topNode),
c);if("undefined"===typeof d.placeholder){for(e in b)b.hasOwnProperty(e)&&(r[e]=b[e]);r.textColor&&(b=document.createElement("style"),b.type="text/css",d=document.createTextNode("."+r.className+" { color:"+r.textColor+(r.styleImportant?"!important":"")+"; }"),b.styleSheet?b.styleSheet.cssText=d.nodeValue:b.appendChild(d),document.getElementsByTagName("head")[0].appendChild(b));Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){f=b||0;for(g=this.length;f<g;f+=1)if(this[f]===a)return f;
return-1});Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};d.prototype=this.prototype;e.prototype=new d;return e});m(r.topNode);r.live&&setInterval(a,100);return!0}return!1},refresh:a}}());
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.layer.condition_edit_layer");
alp.gmap3(function(k){function h(a,b){b?this._editCondition_loading===a&&this.createCondition(null,alp.mix(alp.opt(b,["data"]),{editRightAway:!0})):(this._editCondition_loading=a,(new G.SingleOOI(a,{proj:this.proj,cacheBust:(Date.now?Date.now():+new Date)+""+Math.random()})).load(alp.bindF(h,this,a)))}function g(a,b){var c=this.mapSt.get();if(c){this._justCreated=!0;var d=alp.opt(b,"data"),g={};if(d){a=G.ooi_geometry(d);a=C.xy2latlng(a);var l=d.id;l?g.id=l:console.error("ConditionEditLayer: could not extract existing id");
if(l=(l=d.dayOfInspection)&&alp.str2date(l))g.dayOfInspection=l;(d=alp.sub("images.image",d))&&(g.saved_images=alp.map(d,"[,v]"))}d={label_class:this.iwClass,label_text:this._iwHtml||(this._iwHtml=alp.gEBCN(this.iwTmpl,this.contNode)[0].innerHTML),capture_clicks:!1};c=alp.oCreateMix(this.marker_opts,{map:c,position:a,draggable:!0});c=C.marker_labeled_gen(c,d,this.marker_standard_name);a=c._alpLabel||null;C.event("addListener")(c,"click",alp.bindF(f,null,this,c));b=alp.ratelimitF(87,alp.nowF(e),null,
this,c,a,alp.opt(b,["editRightAway","data"]));a.drawEvt().then(alp.bindF(b));this._markerMap.setNow(c,alp.mix({marker:c,label:a,dateOfInspection:new Date,iwStepNodeArrDfrd:alp.dfrd("CEL:iwStepNodeArrDfrd",{then:1})},g));this.modeSt.setNow("tip");this.currentMarkerSt.setNow(c);c._alpLabelDivDfrd&&c._alpLabelDivDfrd.then(b)}else console.error("ConditionEditLayer:createCondition() needs a map! Please use setMap.")}function f(a,b){a.currentMarkerSt.is(b)?d.close(a,b):(a.currentMarkerSt.setNow(b),a.modeSt.setNow("tip"))}
function e(a,b,c,e){function f(a){a||(a=window.event);a=a.target||a.srcElement;document.activeElement!==a&&alp.m(a,"focus")}function g(){var b=c.get("map");if(b){var d=alp.gBCR(h);0<d.width&&0<d.height&&(a._centerIwCfg||(a._centerIwCfg={otherNodesCache:alp.gEBCN(a.placeInfoOtherClass,a.placeInfoOtherCont),padding:{left:0,right:0,top:0,bottom:"50px"}}),a._centerIwCfg.closeTest=function(){return!a.modeSt.is("tip")},a._centerIwCfg.onClose=function(a){a.mapMoved||(b.setZoom(a.origZoom),b.panTo(a.origCenter))},
a._centerIwCfg=E.placeInfoNode(b,h,a._centerIwCfg))}}var l=c.getContDiv(),h=l&&(alp.hasClass(l,a.iwClass)?l:alp.gEBCN(a.iwClass,h)[0]);if(l){null==e||e.hasOwnProperty.a;h.childNodes.a;l=e&&e.data;var k=a._markerMap.get(b);if(!k.interactive){k.interactive=1;var n=alp.gEBCN(a.iwStepClass,h);k.iwDiv=h;k.iwStepNodeArr=n;k.actionName2node={};for(var p in d)p in J||(n=alp.gEBCN(m(a,p),h)[0])&&(k.actionName2node[p]=n);alp.util.placeholder.init({topNode:h});alp.forEach(alp.gEBCN(a.iwActionClass,h),function(c){var e=
c.className.match(a.iwActionRx)[2];alp.aEL(c,"click",alp.nowF(alp.bindF(d,null,a,b,e)))});k.ifm_img=new alp.x.InputFileMultipleImgExt({cont:alp.gEBCN(a.imgCont,h)[0],input:a.imgInput,display:a.imgDisplay,toggle:a.imgToggle,files:a.imgFiles});(n=l&&alp.sub("images.image",l))&&n.length&&(k.ifm_img.max+=n.length,alp.now("addFileArr",k.ifm_img,n,{programmatic:!0}),k.ifm_img.m.filesModified.setNow(!1));var q=(n=l&&l.dayOfInspection)&&alp.str2date(n);n=new Date;q=q||n;k.date_picker=new alp.x.Pikaday({field:alp.nodify(a.datePick,
h),clickNode:alp.nodify(a.dateIcon,h),style:{position:a.datePosition},scrollContainerNode:alp.nodify(a.dateScrollContainer,h),setDefaultDate:!0,defaultDate:q,minDate:new Date("2000-01-01"),maxDate:n,useRelativeDays:!0,onSelect:function(b){alp.nodify(a.inputPrefix+"dayOfInspection",k.actionName2node.edit).value=alp.date2str(b)}});alp.aEL(h,"click",f);alp.aEL(h,"dblclick",f);C.iwDivPreventMapInteraction(h);g();c&&C.event("addListener")(c,"map_changed",g);a.showMapCallback&&alp.aEL(alp.gEBCN(a.showMap,
h),"click",alp.nowF(a.showMapCallback));if(a.iwDetachActionPart)for(p in a.iwDetachActionPart)p in J||(n=k.actionName2node[p],q=alp.fVal(a.iwDetachActionPart[p]),n&&q&&(alp.place(n,q,"first"),C.iwDivPreventMapInteraction(n)));if(l){p=alp.gEBTN("form",k.actionName2node.edit)[0].elements;n=new RegExp("^"+a.inputPrefix+"(.*)$");q={title:function(a){return a.title||""},longText:function(a){return a.longText||""},riskDescription:function(a){return a.riskDescription||""},weatherDescription:function(a){return a.weatherDescription||
""}};for(var r=p.length,v=0;v<r;v++){var t=p[v],w=alp.opt((alp.gA(t,"name")||"").match(n),1),u=t.value;w&&w in q&&(w=q[w](l),u!==w&&(t.value=w))}p=p[a.inputPrefix+"activity"];l=alp.sub("relatedActivity.id",l);p&&null!=l&&(l=alp.lastIndexOf(alp.map(alp.gEBTN("option",p),'alp.gA(v, "value")'),l),-1<l&&(p.selectedIndex=l))}e&&e.editRightAway&&d(a,b,"edit",!1);k.iwStepNodeArrDfrd.done(k.iwStepNodeArr)}}}function d(a,b,c,e){function f(b){if(!b){"close"!==c&&(a._justCreated=!1);for(b=h.length;b--;){var d=
h[b];alp.setClass(d,oax.NO_DISPLAY,!alp.hasClass(d,m(a,c)))}alp.setClass(l,oax.NO_DISPLAY,alp.and(h,"!alp.isDescendant(v, this)  ||  alp.hasClass(v, oax.NO_DISPLAY)",l))}}var g=a._markerMap.get(b),l=g.iwDiv,h=g.iwStepNodeArr;l.childNodes.a;h[0].childNodes.a;!1!==e&&alp.stopEvent(e||window.event);b=d[c](a,b);"object"===typeof b?b.thenSoon(f):f(b)}function b(a,b){a.modeSt.setNow("new");a._justCreated?b.setMap(null):(a=alp.opt(a._markerMap.get(b),"lastPosition"))&&b.setPosition(a)}function c(a,b){a=
a._markerMap.get(b);var c=alp.opt(a,"img_slideshow");c&&(c.stopLoop(),alp.rA(c.container,"style"),delete a.img_slideshow);a.lastPosition=b.getPosition()}function a(a,b){var c=alp.gEBTN("form",b)[0];b=c.elements[a.inputPrefix+"title"];c=c.elements[a.inputPrefix+"longText"];if(!b.value||b.value===alp.gA(b,"placeholder"))return(a=alp.opt(alp.gEBCN(a.emptyTitleMsg,a.contNode)[0],"innerHTML"))&&alp.humane(a),!0;if(!c.value||c.value===alp.gA(c,"placeholder"))return(a=alp.opt(alp.gEBCN(a.emptyLongTextMsg,
a.contNode)[0],"innerHTML"))&&alp.humane(a),!0}function m(a,b){return alp.opt(a.actionName2iwClass,b)||a.iwClass+"-"+b}function l(a){a.modeSt.change_v_cb("new",function(){a.currentMarkerSt.setNow(null)})}function r(a){a.mapSt.change_cb_init(alp.bindF(v,a));a.modeSt.change_cb_init(alp.bindF(u,a));a.currentMarkerSt.change_cb_init(alp.bindF(t,a))}function n(a){alp.aEL(alp.gEBCN("oax-condition-new",a.condNode),"click",function(){if(a.login&&!a.login.indicator())a.login.opener(a.login.opener_cfg);else{a.modeSt.setNow("where");
a._where2new_h&&clearTimeout(a._where2new_h);var b=a._where2new_h=setTimeout(function(){b===a._where2new_h&&(a._where2new_h=null,a.modeSt.is("where")&&a.modeSt.setNow("new"))},a.inaction_where2new_delay_ms)}});alp.aEL(alp.gEBCN("oax-condition-where",a.condNode),"click",alp.bindF(p,null,a));if(a._wherePlaces){var b=alp.sub("m.placeSt",a._wherePlaces);b?b.change_cb(q,null,a):a._wherePlaces.placeChangeCB(q,null,a)}}function q(a,b){var c=alp.sub("geometry.location",b),d=alp.sub("geometry.viewport",b);
if(c){if(b=a.mapSt.get())d?b.fitBounds(d):(d=Math.max(15,b.getZoom()),b.setCenter(c,d),d!==b.getZoom()&&b.setZoom(d));g.call(a,c)}}function p(a){a._where2new_h=null}function v(a,b){this._map_eh.clear();a&&this._map_eh.push(C.event("addListener")(a,"click",alp.bindF(y,null,this)),C.event("removeListener"));alp.m(this._wherePlaces,"setMap",a)}function u(a,b){a&&alp.forEach(this.contNode.childNodes,function(b){"className"in b&&alp.setClass(b,oax.NO_DISPLAY,!alp.hasClass(b,"oax-condition-"+a))});"where"===
a&&this._whereInputNode&&(this._whereInputNode.value="")}function t(a,b){b&&(C.unbind_label_from_marker(b),alp.m(alp.opt(this._markerMap.get(b),"label"),"setMap"),this.mustFinishWorkflow&&b.setOptions({draggable:!1}),this.mousewheelFix&&w(this,b));a&&(b=this._markerMap.get(a).label,b.getMap()||(C.bind_label_to_marker(b,a),b.setMap(a.getMap()),d(this,a,this.mustFinishWorkflow?"startedit":"preview",!1),this.mustFinishWorkflow&&a.setOptions({draggable:!0})),this.mousewheelFix&&x(this,a))}function w(a,
b){if(a.mousewheelFix){var c=a._markerMap.get(b);c.iwStepNodeArrDfrd.then(function(a){null!=c.mousewheel_fix_h&&(alp.rEL(c.mousewheel_fix_h),delete c.mousewheel_fix_h)})}}function x(a,b){if(a.mousewheelFix){var c=a._markerMap.get(b);c.iwStepNodeArrDfrd.then(function(a){c.mousewheel_fix_h=alp.aEL(alp.body(),"mousewheel",function(a){a||(a=window.event);if(alp.isDescendant(a.target||a.srcElement,c.iwStepNodeArr)){var b=alp.body(),d=b.scrollTop,e=b.scrollLeft;setTimeout(function(){b.scrollTop=d;b.scrollLeft=
e},0)}},!0)})}}function y(a,b){var c=a.modeSt.is("tip")&&a.currentMarkerSt.get();c?c.setPosition(b.latLng):a.modeSt.is("where")&&a.createCondition(b.latLng)}function z(a,b,c,d){return A(a,b,c,d)}function A(a,b,c,d,e){var f=!e&&{};var g=alp.gEBTN("form",c)[0].elements;var l=new RegExp("^"+a.inputPrefix+"(.*)$");c=g.length;for(var h=0;h<c;h++){var k=g[h],m=alp.opt((alp.gA(k,"name")||"").match(l),1),n=k.value;(k=alp.gA(k,"placeholder"))&&n===k&&(n="");if(m)if(e){if(k=alp.gEBCN(a.previewPrefix+m,e)[0]){if(n){var p=
["dflt_html",m],q=alp.oGet(d,p);null==q&&(q=alp.oSet(d,p,k.innerHTML));k.innerHTML=q+n}alp.setClass(k,oax.NO_DISPLAY,!n)}"dayOfInspection"===m&&(k=alp.nodify(a.previewDate,e))&&(m=alp.str2date(n),k.innerHTML=alp.date2str(m,"{DD}.{MM}.{YYYY}"))}else f[m]=n}c=alp.opt(d,"ifm_img");l=e&&alp.nodify(a.previewImgCont,e);m=e&&alp.nodify(a.previewImgController,e);n=e&&alp.nodify(a.previewImgPrev,e);k=e&&alp.nodify(a.previewImgNext,e);p=e&&alp.nodify(a.previewImgCur,e);q=e&&alp.nodify(a.previewImgMax,e);var r=
e&&alp.nodify(a.previewImgNcont,e);g=!e&&[].concat(d.saved_images||[]);if(c){var v=c.m.files.get();c=v.length;if(l)for(;l.childNodes.length>c;)l.removeChild(l.lastChild);for(h=0;h<c;h++){var t=v[h];if(e){var w=l.childNodes[h]||alp.cE("li",l);w=alp.gEBTN("img",w)[0]||alp.cE("img",w);alp.sA(w,"src",t.programmatic?t.imgsrc_url:t.result)}else t=G.format_image_or_video_2_api_obj(t,g),(f.images||(f.images={image:[]})).image.push(t)}e&&l&&!alp.hasClass(l,a.previewImgNoSlideshow)&&(alp.m(d.img_slideshow,
"stopLoop"),d.img_slideshow=new alp.x.SlideShow(l,{slideSelector:m,previousButton:n,nextButton:k,current_slide_number_display_q:p,max_slide_number_display_q:q,cont_slide_number_display_q:r,force:!0}))}if(!e){if(d=d.id)f.id=d;f.geometry=b.lng()+","+b.lat();f.proj=a.proj;a.tourid&&(f.relatedOOI=[a.tourid]);f.activity&&(f.relatedActivity={id:f.activity});delete f.activity;delete f["images-input"];return f}}var C=alp._gmap2_3,E=C.util,G=alp.data,B=G.api,I=alp.util.url_hash,L={},J={};alp.i18n.fetch("alp.all").then(function(a){L=
a});alp.declare("alp._gmap2_3.ConditionEditLayer",null,alp.nowF(function(a){function b(){c.mapSt.get()&&!d&&(d=!0,c.editCondition(c.editId))}var c=this;alp.mixCheck(c,a);c.proj.substring.a;c.contNode.childNodes.a;c._map_eh=new alp.Eh;c._modeArr=["new","where","tip"];c.modeSt=new alp.ModeState({init_value:"new",modeSet:alp.arr2o(c._modeArr,alp.f(),alp.f("1"))});c.mapSt=new alp.State({init_value:c.mapInit});c.currentMarkerSt=new alp.State;c._markerMap=alp.mapany();c._whereInputNode=alp.nodify(c.whereInput,
c.contNode);c._whereInputNode&&(c._wherePlaces=new alp._gmap2_3.x.WhereAutocomplete({inputNode:c._whereInputNode,initNow:!0,proj:c.proj}));l(c);r(c);n(c);if(c.editId){var d=!1;c.mapSt.change_cb_init(b)}}),{proj:null,contNode:null,mapInit:null,tourid:null,editId:null,whereInput:"oax-condition-where-input",iwTmpl:"oax-condition-iw-tmpl",iwClass:"oax-condition-iw",actionName2iwClass:null,iwStepClass:"oax-condition-iw-step",iwActionClass:"oax-condition-action",iwActionRx:/(^|\s)oax-condition-action-(\w+)($|\s)/,
iwDetachActionPart:{edit:alp.body},inputPrefix:"oax-condition-in-",emptyTitleMsg:"oax-condition-empty-title-msg",emptyLongTextMsg:"oax-condition-empty-longtext-msg",imgCont:"oax-condition-in-images-cont",imgToggle:"oax-condition-in-images-toggle",imgInput:"oax-condition-in-images-input",imgFiles:"oax-condition-in-images-files",imgDisplay:"oax-condition-in-images-display",datePick:"oax-condition-date-pick",dateIcon:"oax-condition-date-icon",datePosition:"fixed",dateScrollContainer:"oax-condition-edit-form",
previewPrefix:"oax-condition-preview-",previewDate:"oax-condition-preview-date",previewImgCont:"oax-condition-preview-images-cont",previewImgNoSlideshow:"oax-no-slideshow",previewImgController:"oax-condition-preview-images-controller",previewImgPrev:"oax-condition-preview-images-prev",previewImgNext:"oax-condition-preview-images-next",previewImgCur:"oax-condition-preview-images-current",previewImgMax:"oax-condition-preview-images-max",previewImgNcont:"oax-condition-preview-numbers-container",previewWaitboxCont:"oax-condition-preview-waitbox-cont",
inaction_where2new_delay_ms:6E3,marker_opts:null,marker_standard_name:"condition",mustFinishWorkflow:!0,placeInfoOtherClass:["oax-map-info-other"],placeInfoOtherCont:null,showMap:"oax-condition-action-show-map",showMapCallback:null,reloadOnSave:!1,login:null,mousewheelFix:!0,getBounds:function(){var a=new k.LatLngBounds;this._markerMap.forEach(function(b,c){a.extend(c.getPosition())});return a},setMap:function(a){this.mapSt.set(a)},getMap:function(){return this.mapSt.get()},createCondition:g,editCondition:h});
d.close=function(a,c){if(!a.mustFinishWorkflow){a.currentMarkerSt.is(c)&&a.currentMarkerSt.setNow(null);if(a._justCreated)return b(a,c);a.modeSt.setNow("new")}};d["delete"]=b;d.startedit=c;d.edit=c;d.preview=function(b,c){var d=a(b);if(d)return d;var e=b._markerMap.get(c);e.label.getContDiv();d=e.actionName2node.edit;e=b._markerMap.get(c);var f=e.actionName2node.preview;c=c.getPosition();f.childNodes.a;A(b,c,d,e,f)};d.publish=function(b,c){var d=b._markerMap.get(c);d.label.getContDiv();var e=d.actionName2node.edit,
f=a(b,e);if(f)return f;if(b._publishing)console.error("ConditionEditLayer: already publishing... Simply ignoring the user click, because the backend answer should come soon anyway.");else{b._publishing=!0;f=d.actionName2node.preview;d=b._markerMap.get(c);var g=z(b,c.getPosition(),e,d);(c=f&&b.previewWaitboxCont&&alp.nodify(b.previewWaitboxCont,f)||e)?(b._waitbox||(b._waitbox=new alp.x.Waitbox({delay_ms:11}))).setTarget(c).startWait():(b._waitbox||(b._waitbox=new alp.x.Waitbox({delay_ms:11,waiterOpt:{position:"fixed",
top:"50%",left:"50%"}}))).setTarget(alp.body()).startWait();var l=alp.dfrd("CEL:publish"),h=alp.dom.windowExitIntercept(L.upload_abort_situation);B[d.id?"conditionUpdate":"conditionCreate"](g,{throwError:!1}).then(function(a){alp.rEL(h);b._waitbox&&b._waitbox.stopWait().setTarget(null);b.modeSt.setNow("new");if(!0===b.reloadOnSave){l.triggerSoon(!1);var c=I.s2o(location.search,{prefix:"?"});c.cndtnSvd=(+new Date).toString(36)+",stts."+alp.opt(a,"status");location.search=I.o2s(c,{prefix:"?"})}else if(b.reloadOnSave)b.reloadOnSave.substring.call.a,
location.href=b.reloadOnSave;else{b._publishing=!1;if(200!==a.status)throw l.triggerSoon(!0),c="ConditionEditLayer: publishing failed ("+a.status+")",console.error(c,d,g,a),Error(c,d,g,a);a=a.responseJson;c=a.id;c.substring.a;if("id"in d&&c!==d.id)throw l.triggerSoon(!0),Error('ConditionEditLayer: id inconsistency detected after publishing! "'+d.id+'" != "'+c+'"');d.id=c;d.saved_images=alp.zip(alp.sub("images.image",g)||[],alp.sub("images.image",a)||[]);l.triggerSoon(!1)}});return l}}});
"undefined"!==typeof dojo&&dojo.provide("oax.x.ooi_adder_condition");
(function(){function k(d){if(!d._mapVisDfrd){var b=d.m.mapCfg.get();if(b){var c=alp.nodify(d.formularContClass,d.cont);c.childNodes.a;oax.community_layout.login_indicator()&&alp.empty(alp.gEBCN("oax-condition-wrapper",d.cont));d.conditionEditLayer=new f.ConditionEditLayer({contNode:d.condCtrlNode,proj:d.proj,tourid:d.ooiid,login:{indicator:oax.community_layout.login_indicator,opener:oax.community_layout.open_login_dialog},placeInfoOtherClass:oax.IW_PLACE_OTHER,placeInfoOtherCont:d.cont,inaction_where2new_delay_ms:Infinity,
iwDetachActionPart:{edit:c,preview:c},actionName2iwClass:{preview:"oax-condition-snippet-preview"},datePosition:"absolute",dateScrollContainer:null,showMapCallback:function(){d.m.mapVis.set(!0)},reloadOnSave:oax.URL_SEARCH_GET_EDITCOND_BACK()||!0,editId:d.existingCondition_editId,mousewheelFix:!1});d._mapVisDfrd=alp.subDfrd(function(){return!alp.hasEmptyBCR(d.mapNode)});d._mapVisDfrd.then(function(){alp.onDCL(function(){d.tourPoiLayer.whenLoaded(alp.bindF(h,null,d,b))})})}}}function h(d,b){oax.api.maps(function(c,
a){function e(){function a(){var a=alp.gBCR(d.mapNode);if(a.width!==b.width||a.height!==b.height)b=a,e.evt.triggerSoon()}if(!e.evt){e.evt=alp.event("_TAC_nodeRectChangeEvt",{then:1});var b=alp.gBCR(d.mapNode);setInterval(alp.nowF(a),289)}return e.evt}function l(){var a=d.tourPoiLayer.getBounds().union(d.conditionEditLayer.getBounds());f.set_bbox(d._map,a)}var h=d.tourPoiLayer.getZoomCenter(d.mapNode);d._map=new c.Map(d.mapNode,alp.oCreateMix(b,h));d._emptyButton=oax.x.emptybutton({position:a.ControlPosition.TOP_LEFT},
d._map,"width:20px;height:40px;");e().then(function(){f.event("trigger")(d._map,"resize");l()});d.m.mapVis.change_v_cb(!0,l);d.tourPoiLayer.setMap(d._map);d.conditionEditLayer.setMap(d._map);alp.setClass(d.cont,oax.READY,!0);d.rightAway&&!d.existingCondition_editId&&d._map.whenLoaded(alp.bindF(g,null,d));if(d.existingCondition_editId){var k=alp.bindF("scrollIntoView",d.cont);d._map.whenLoaded(function(){k();setTimeout(k,1E3)})}})}function g(d){var b=alp.opt(d.tourPoiLayer.getTourData(),0),c=alp.opt(d.tourPoiLayer.getPoiData(),
0);(b=b?alp.opt(f.util.coord.tour(b),0):c?e.ooi_geometry(c):null)&&alp.asyncF(75,"createCondition",d.conditionEditLayer)(f.xy2latlng(b),{editRightAway:!0})}var f=alp._gmap2_3,e=alp.data;alp.declare("oax.x.OoiAdderCondition",alp.x.AbstractController,function(){this.existingCondition_editId=oax.URL_SEARCH_GET_EDITCOND_ID()},{cont:null,proj:null,ooiid:null,userid:null,mapCfg:null,formularContClass:"oax-condition-wrapper",mapClass:"oax-map-condition",condCtrlClass:"oax-condition-ctrl",rightAway:!0,showMapTargetClass:"oax_condition_map_wrapper",
hideMap:"oax-condition-action-hide-map",augmentModel:function(d){d.mapCfg=this.mapCfg;d.mapVis=new alp.BoolState},setInitVal:function(d,b,c,a){d.cont.childNodes.a;d.proj.substring.a;d.ooiid.substring.a;d.userid.substring.a;d.mapCfg.change_cb_init.a;(d.mapNode=alp.nodify(d.mapClass,d.cont)).childNodes.a;(d.condCtrlNode=alp.nodify(d.condCtrlClass,d.cont)).childNodes.a;b=alp.gBCR(d.condCtrlNode).width;d.tourPoiLayer=new f.TourPoiLayer(d.ooiid,{proj:d.proj,padding:0<b?{left:b+20+"px",top:.1,right:.1,
bottom:.1}:.1});d.tourPoiLayer.whenLoaded(k,null,d)},connectModel2View:function(d,b,c,a){b.push(c.mapCfg.change_cb_init(k,null,d));b.push(c.mapVis.change_cb_init(function(){var a=c.mapVis.get();alp.setClass(alp.gEBCN(d.showMapTargetClass,d.cont),oax.NO_DISPLAY,!a);alp.setClass(alp.gEBCN(d.formularContClass,d.cont),oax.NO_DISPLAY,a)}))},connectView2Model:function(d,b,c,a){b.push(alp.aEL(alp.gEBCN(d.hideMap,d.cont),"click",function(){c.mapVis.setNow(!1)}))}})})();"undefined"!==typeof dojo&&dojo.provide("alp.data.avalanche");
(function(){function k(a){a=alp.oCopy(a);var c=a.report,e=c&&c.metaData,h=c&&c.dangers||[];if(!e)return null;h=alp.filter(h,".dangerLevel in this",l);h.length||(h=alp.filter(c.overviewDangers||[],".dangerLevel in this",l));d(e,"validFrom","validTo");a.valid=b(e.validFrom,e.validTo);a.title||(a.title=a.title||a.name||a.id);a.dangers=g(h);alp.mix(a,f(a.dangers));if(e=a.report.overviewDangers)try{var k=a.overview={dangers:g(e)};alp.mix(k,f(k.dangers))}catch(x){delete a.overview}c.details&&(c.details=
alp.mapIn(c.details,'v  &&  v.length>4 ? v : ""'));a.middleDate||(a.middleDate=a.valid.middleDate);return a}function h(a){return new Date(alp.reduce(a,"+(+w.middleTime)",0)/a.length)}function g(a){function c(a){function b(a){a=alp.oCopy(a);var b="beginElevation"in a,c=b?"beginElevation":"endElevation";a[b?"endElevation":"beginElevation"]=a[c];delete a[c];a[n]=q;e.push(a)}var c=alp.and(a,'"beginElevation" in v  &&  !("endElevation" in v)'),d=alp.and(a,'"endElevation" in v  &&  !("beginElevation" in v)');
(c||d)&&alp.forEach(a,b)}a=alp.filter(alp.map(a,function(a){if(!a.beginTime&&!a.endTime)return null;null!=a.beginElevation&&null!=a.endElevation&&(a=alp.mix({},a),delete a.beginElevation,delete a.endElevation);d(a,"beginTime","endTime");return a}),"");a=alp.reduce(a,function(a,b){var c=alp.str2date(b.endTime),d=alp.str2date(b.beginTime),e=c-d,f=d.getHours();c=c.getHours();if(!(71712E3<e||f<c&&14>f&&12<c))return a.concat([b]);f=(f=b.beginTime.match(m))?f[0]:"";e=new Date(+d+(e>>1));d=alp.oCreateMix(b,
{endTime:alp.date2str(e)+f});b=alp.oCreateMix(b,{beginTime:alp.date2str(e)+f});return a.concat([d,b])},[]);var e=alp.map(a,function(a){var c=b(a.beginTime,a.endTime);return alp.oCreateMix(a,c)}),f=h(e);a=alp.filter(e,".middleDate<"+ +f);f=alp.filter(e,".middleDate>"+ +f);c(a);c(f);return e}function f(a){if(!a||!a.length)return{failure:!0,no_danger:!0};var b=h(a),c=e(a,"<"+ +b);a=e(a,">"+ +b);return{middleDate:b,morningDanger:c,afternoonDanger:a,maxDanger:Math.max(c.uniform||0,c.lowElevationRisk||
0,c.highElevationRisk||0,a.uniform||0,a.lowElevationRisk||0,a.highElevationRisk||0)}}function e(a,b){var c=1<a.length;b=c&&alp.f(b);var d=c?alp.filter(a,"this( v.middleTime )",b):a;a=alp.arr2o(d,"dangerLevel");var e=alp.oKeys(a),f=e.length;c=(a=d.length&&null!=d[0].exposition)?alp.reduce(d,'alp.mix( v, alp.arr2oSimple( alp.filter( (w.exposition  ||  "").split(","), "" ) ) )',{}):null;b=a?alp.oKeys(c).sort():null;if(1===f)var g={uniform:e[0]};else 2<=f?(g=alp.filter(d,".endElevation!=null")[0],d=alp.filter(d,
".beginElevation!=null")[0],e=g.endElevation,e.toPrecision.call.a,g={lowElevationRisk:g.dangerLevel,highElevationRisk:d.dangerLevel,limitElevation:e}):null.bug_or_data_error;g.hasExposition=!!a;a&&(g.expositionSet=c,g.expositionArr=b);return g}function d(a,b,c){if(!a[b]){var d=a[c],e=d.match(m);e=e?e[0]:"";d=alp.str2date(d);d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);a[b]=alp.date2str(d)+e}a[c]||(d=a[b],e=(e=d.match(m))?e[0]:"",d=alp.str2date(d),d.setHours(23),d.setMinutes(59),
d.setSeconds(59),d.setMilliseconds(999),a[c]=alp.date2str(d)+e)}function b(a,b){a=(+alp.str2date(a)+ +alp.str2date(b))/2;(a||null).toPrecision.call.a;return{middleTime:a,middleDate:new Date(a)}}var c=alp.data,a=alp.sub("alp.data.avalanche",null,!0),m=/[\+\-][^\+\-]+$/;a.extract=function(a){if(!a||!a.status||"ok"!==a.status)return console.error('alp.data.avalanche.extract failed: expected { status: "ok", answer: <data> } but received:',a),{failure:a};var b=a.answer;a=alp.oCopy(b);var c=a.regions=alp.filter(alp.map(b.regions,
k),"");if(!c.length)return a=alp.reduce(b.regions,'alp.mix(v,alp.filterIn(alp.oGet(w,"report.history")||{},"v in '+r+'"))',{}),0<alp.oKeys(a).length?{no_data_for_that_day:{merged_history:a}}:{failure:"No data for that day AND no data in the history, for all regions."};alp.mix(a,h(c));b=-Infinity;for(var d=NaN,e=c.length;e--;){var f=c[e];f.maxDanger>=b&&(d=e,b=f.maxDanger)}a.maxDanger=b;a.initRegionIndex=d;return a};a.extractShort=function(a){if(!a||!a.status||"ok"!==a.status)return console.error('alp.data.avalanche.extractShort failed: expected { status: "ok", answer: <data> } but received:',
a),{failure:a};var b=alp.filter(a.answer.dangers||[],"v.dangerLevel in this",l);b.length||(b=alp.filter(a.answer.overviewDangers||[],"v.dangerLevel in this",l));b=g(b);b=f(b);var c=alp.oGet(a,"answer.region.name");a=alp.oGet(a,"answer.region.id");c&&(b.regionTitle=c);a&&(b.regionId=a);return b};a.extractShortFallbackFromDetail=function(a){var c=(a="ok"===(a&&a.status)&&alp.oGet(a,["answer","regions",0]))&&alp.oGet(a,["report","details"]),e=a&&alp.oGet(a,["report","metaData"]);if(!(a&&c&&0<alp.oKeys(c).length&&
e&&(e.validFrom||e.validTo)))return{failure:"no details"};e=alp.oCreate(e);d(e,"validFrom","validTo");return{no_danger:!0,middleDate:b(e.validFrom,e.validTo).middleDate,regionTitle:a.name||"",details:c}};a.loadRegionIdlist=function(a){var b=alp.dfrd("ADAV_loadRegionIdlist");(new c.SingleOOI(a.ooiid,{proj:a.proj})).load(function(a){a=(alp.oGet(a,"data.avalancheRegions")||"").split(",");b.triggerSoon(a)});return b};var l=a.DANGER_OBJ={n:!0,0:!0,1:!0,2:!0,3:!0,4:!0,5:!0},r=a.DANGER_OBJ_STR="{n:true,0:true,1:true,2:true,3:true,4:true,5:true}";
a.DANGER_STR="n012345";var n="dangerLevel",q="n"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.avalanche_util");
(function(){function k(e,d){e.childNodes.a;for((d||null).substring.call.a;e=e.parentNode;)if(alp.hasClass(e,d))return e}var h=alp.sub("alp.x.avalanche",null,!0),g=alp.data.avalanche,f={n:"?"};h.setup_exposition=function(e,d,b){var c=b.expoClassPrefix;b=b.expoBlanko;(c||null).substring.call.a;(b||null).substring.call.a;if(e&&e.hasExposition){var a=document.createDocumentFragment();e&&(alp.cE("div",a,{"class":c+"blanko"}),alp.forEach(e.expositionArr,function(b){alp.cE("div",a,{"class":c+b})}));alp.empty(d);
alp.aC(d,a);alp.style(d,"visibility","")}else alp.style(d,"visibility","hidden")};h.setup_history=function(e,d,b,c,a,h){function l(a){return alp.Aps.call(alp.gEBTN("li",a)).reverse()[0]}function k(a){a=v["day_"+(a-p)];return alp.isFiniteNumber(a)&&0<a?a:null}function m(b,c){C[c]&&u.push(alp.aEL(b,"click",function(){a.setNow(c)}))}b.childNodes.a;if(!c.eh){e.mh_date_to.getDay.call.a;e.mh_history_index.toPrecision.call.a;e.mh_history_index_first_data.toPrecision.call.a;c.eh=new alp.Eh;c.mh_date_to=e.mh_date_to;
c.mh_history_index=e.mh_history_index;c.mh_history_index_first_data=e.mh_history_index_first_data;c.merged_history=e.merged_history;c.level_noli=alp.Aps.call(alp.gEBCN(h.historyOne,b)).reverse();c.n=c.level_noli.length;c.number_noli=alp.map(c.level_noli,l);c.days_cont=alp.nodify(h.historyDays,b);c.days_noli=alp.Aps.call(alp.gEBTN("li",c.days_cont)).reverse();c.from=alp.gEBCN(h.historyFrom,b);c.to=alp.gEBCN(h.historyTo,b);c.n===c.days_noli.length&&c.n===c.number_noli.length||null.bug;var q=c.number2title=
{};alp.forEach(c.number_noli,function(a,b){q[parseInt(alp.textContent(a))]=alp.gA(c.level_noli[b],"title")})}var p=c.mh_history_index,v=c.merged_history;d=c.mh_date_to;var u=c.eh,t=c.level_noli;e=c.number_noli;var w=c.days_noli;q=c.number2title;alp.setText(c.from,alp.date2str(new Date(+d-864E5*(c.n-1)),"{DD}.{MM}."));alp.setText(c.to,alp.date2str(d,"{DD}.{MM}.{YYYY}"));var x=h._i18n_day.weekdays.split(","),y=alp.map(x,".slice( 0, 2 )"),z=d.getDay();for(d=c.days_noli.length;d--;){b=c.days_noli[d];
var A=(z+49-d)%7;b.innerHTML=y[A];alp.sA(b,"title",x[A])}x=h.historyOnePrefix;(x||null).substring.call.a;var C=Array(w.length);for(d=w.length;d--;)b=w[d],y=k(d),z=C[d]=y in g.DANGER_OBJ,alp.setClass(b,h.historyDayNodata,!z),alp.setClass(c.level_noli[d],"alp-x-clickable",z),alp.setClass(c.days_noli[d],"alp-x-clickable",z),b=t[d],alp.setClass(b,[[x+"*",!1]].concat(z?[[x+y,!0]]:[])),alp.setText(e[d],z?""+(y in f?f[y]:y):""),alp.sA(b,"title",q[y]||"");u.clear();u.push(a.change_cb_init(function(){var b=
a.get();alp.setClass(w,h.historyDaySelected,!1);alp.setClass(w[b],h.historyDaySelected,!0);alp.setClass(t,h.historyDaySelected,!1);alp.setClass(t[b],h.historyDaySelected,!0)}));alp.forEach(t,m);alp.forEach(w,m)};h.setup_triangle=function(e,d,b,c,a,g){function l(a,b,c){var d=new RegExp("(^|\\s)"+g.riskPrefixClass+"\\d*(\\s|$)","g");alp.forEach(a,function(a){var b=alp.sTrim(alp.gA(a,"class").replace(d," "))+" "+g.riskPrefixClass+c;alp.sA(a,"class",b)});b&&alp.setText(b,""+(c in f?f[c]:c))}d.childNodes.a;
(c||null).substring.call.a;(a||null).substring.call.a;b.triNode||(d=b.triNode=alp.nodify(c,d),b.limitNoli=alp.gEBCN(a,d),b.topNoli=alp.gEBCN(g.topClass,d),b.bottomNoli=alp.gEBCN(g.bottomClass,d),b.topBotTextNoli=alp.gEBCN(g.topBotTextClass,d),b.middleTextNoli=alp.gEBCN(g.middleTextClass,d),a=g.triWrapClass&&k(d,g.triWrapClass),b.triWrapNoli=a?[a]:[]);a=e?"":"none";alp.style(b.triNode,"display",a);alp.style(b.triWrapNoli,"display",a);e&&(e.uniform?(alp.setClass(b.triNode,c,!1),l(b.topNoli,b.middleTextNoli,
e.uniform),l(b.bottomNoli,null,e.uniform)):(alp.setClass(b.triNode,c,!0),l(b.topNoli,b.topBotTextNoli[0],e.highElevationRisk),l(b.bottomNoli,b.topBotTextNoli[1],e.lowElevationRisk),e=e.limitElevation,e.toPrecision.call.a,alp.setText(b.limitNoli,e+" m")))};h.css_classes={bodyVisClass:"alp-x-avalanche-vis",t1Class:"oax_avalanche_triangle_1",t2Class:"oax_avalanche_triangle_2",leftTriClass:"oax_triangle_height_left",rightTriClass:"oax_triangle_height_right",triWrapClass:"oax-avalanche-triangle-wrapper",
leftLimitClass:"oax_left_text",rightLimitClass:"oax_right_text",topBotTextClass:"oax_topBot_text",middleTextClass:"oax_middle_text",topClass:"oax-svg-top",bottomClass:"oax-svg-bottom",riskPrefixClass:"oax_avalanche_risk_",expoClass:"oax_exposition",expoClassPrefix:"icons-exposition_",expoBlanko:"blanko",historyCont:"oax_avalanche_overview",historyOne:"oax_avalanche_dangerLevel",historyOnePrefix:"oax_avalanche_dangerLevel_",historyDays:"oax_avalanche_days",historyDaySelected:"oax_selected",historyDayNodata:"blank",
historyFrom:"oax-avalanche-overview-from",historyTo:"oax-avalanche-overview-to"}})();"undefined"!==typeof dojo&&(dojo.provide("alp.x.avalanche_short"),dojo.require("alp.data.avalanche"));
(function(){function k(c,a){a=a.shortData.get();var e=a===c.LOADING,g=c[b]||(c[b]={left:{},right:{}});if(e)e=c[d]||(c[d]=new alp.x.Waitbox({delay_ms:100})),e.setTarget(c.cont),e.startWait();else{if(e=c[d])e.stopWait(),e.setTarget();if(c.NONE===a)g=new Date,alp.setText(c._dateNoli,c._i18n_day.weekdays.split(",")[g.getDay()%7]+", "+alp.date2str(g,"{DD}.{MM}.{YYYY}")),alp.setClass(c._hoverNoli,c.hoverClass,!1);else if("object"===typeof a){alp.setText(c._dateNoli,c._i18n_day.weekdays.split(",")[a.middleDate.getDay()%
7]+", "+alp.date2str(a.middleDate,"{DD}.{MM}.{YYYY}"));alp.setText(c._regionTitleNoli,a.regionTitle||"");e=a.morningDanger;var h=a.afternoonDanger,k=alp.oEqual(e,h),q=k?c.t2Class:c.t1Class,p=k?c.t1Class:c.t2Class;alp.setClass(alp.gEBCN(q,c.cont),[[q,!1],[p,!0]]);q=alp.isRTL()?c.rightTriClass:c.leftTriClass;p=alp.isRTL()?c.rightLimitClass:c.leftLimitClass;var v=alp.isRTL()?c.leftTriClass:c.rightTriClass,u=alp.isRTL()?c.leftLimitClass:c.rightLimitClass;f.setup_triangle(e,c.cont,g.left,q,p,c);k||f.setup_triangle(h,
c.cont,g.right,v,u,c);alp.setClass(c._hoverNoli,c.hoverClass,!0);if(g=a.no_danger)e=alp.or(alp.map(["highlights","travelAdvisoryComment","wxSynopsisComment","snowpackStructureComment"],"this[v]",a.details))||"",h=e.substring(0,90),alp.setText(c._textNoli,h.length<e.length?h+"...":e);alp.style(c._textNoli,"display",g?"block":"none")}else null.bug}alp.style(c._nodataNoli,"display",c.NONE===a?"":"none")}var h=alp.data,g=h.avalanche,f=alp.x.avalanche,e=alp.i18n.fetch("alp.all");alp.ensureCss(alp.cssBase()+
"alp/x.css");alp.declare("alp.x.AvalancheShort",alp.x.AbstractController,null,f.css_classes,{ooiid:null,cont:null,proj:alp.sub("oa.API_CFG.proj")||null,key:alp.sub("oa.API_CFG.key")||null,withDetails:!0,interceptOpenCloseClick:null,dateClass:"alp-x-avalanche-date",regionTitleClass:"alp-x-avalanche-region-title",nodataClass:"oax-avalanche-box-overlay",hoverClass:"oax_hoverlink_wrapper",textClass:"oax-avalanche-text-short",LOADING:"loading",NONE:"none",augmentModel:function(b){function a(a){c(a,!/\bproto\b.*?\bavalsimulshort\b/.test(location.search)&&
h.api_avalanche_short({region_idlist:a}))}function c(a,c){function f(){h.api_avalanche_detail({region_idlist:a,day:new Date}).thenSoon(function(a){var c=g.extractShortFallbackFromDetail(a);c.failure?(b.shortData.set(d.NONE),console.error("_AVAS_fallback_on_detail_for_text: failure for backendData:",a)):b.shortData.set(c)})}function l(){var a=alp.dfrd("xxxSimulation");setTimeout(alp.nowF(function(){a.triggerSoon({status:"ok",answer:{providers:[{id:"1010",name:"outdooractive Redaktion"}],dangers:[{dangerLevel:"2",
beginTime:"2014-03-31T12:00:00+0200",endTime:"2014-04-01T07:30:00+0200"},{dangerLevel:"0",beginTime:"2014-03-31T07:30:00+0200",endTime:"2014-03-31T12:00:00+0200",endElevation:2400},{dangerLevel:"0",beginTime:"2014-03-31T07:30:00+0200",endTime:"2014-03-31T12:00:00+0200"},{dangerLevel:"2",beginTime:"2014-03-31T07:30:00+0200",endTime:"2014-03-31T12:00:00+0200",beginElevation:2400}],overviewDangers:[{dangerLevel:"1",beginTime:"2014-03-31T12:00:00+0200",endTime:"2014-04-01T07:30:00+0200",exposition:"NN,NO,OO,SO,SS,SW,WW,NW",
comment:"Kamm-, Passlagen und steile Schattenhaenge; spontane Nassschneelawinen im Tagesverlauf; weiterhin Gleitschneelawinen"},{dangerLevel:"1",beginTime:"2014-03-31T07:30:00+0200",endTime:"2014-03-31T12:00:00+0200",exposition:"NN,NO,NW",comment:"Kamm-, Passlagen und steile Schattenhaenge; spontane Nassschneelawinen im Tagesverlauf; weiterhin Gleitschneelawinen"}]}})}),1567);return a}c||(c=l());alp.gatherDfrd([c,e]).thenSoon(function(a){d._i18n_day=a[1][0];a=g.extractShort(a[0][0]);a.failure?a.no_danger?
f():(b.shortData.set(d.NONE),console.error("avalanche_short: failure: ",a.failure)):b.shortData.set(a)})}var d=this;(d.ooiid||null).substring.call.a;(d.proj||null).substring.call.a;(d.cont||null).childNodes.a;b.shortData=new alp.State({init_value:d.LOADING});d.withDetails&&(b.detailOpen=new alp.BoolState);var f=alp.nodify("alp-avalanche-regions",d.cont);f?(f=f.value,d.region_idlist=f,a(f.split(","))):g.loadRegionIdlist(d).thenSoon(a)},setInitVal:function(b,a,d,e){b._dateNoli=alp.gEBCN(b.dateClass,
b.cont);b._regionTitleNoli=alp.gEBCN(b.regionTitleClass,b.cont);b._nodataNoli=alp.gEBCN(b.nodataClass,b.cont);b._hoverNoli=alp.gEBCN(b.hoverClass,b.cont);b._textNoli=alp.gEBCN(b.textClass,b.cont)},connectModel2View:function(b,a,d,e){function c(){var a=d.detailOpen.get();if(a){var c=d.shortData.get();if(!c||"object"!==typeof c||c===b.NONE||c===b.LOADING)return;b._detail||(b._detail=new alp.x.AvalancheDetail({initNow:!0,ooiid:b.ooiid,region_idlist:b.region_idlist,proj:b.proj,key:b.key,initRegionId:c.regionId||
null,webappLink:alp.gA(b.cont,"data-webappurl"),interceptOpenCloseClick:b.interceptOpenCloseClick}),d.detailOpen.bind_to(b._detail.m.open),b.interceptOpenCloseClick||b._detail.m.open.bind_to(d.detailOpen))}alp.m(alp.oGet(b,"_detail.m.open"),"set",a)}a.push(d.shortData.change_cb_init(k,null,b,d));d.detailOpen&&(a.push(d.detailOpen.change_cb_init(c)),a.push(d.shortData.change_cb_init(c)))},connectView2Model:function(b,a,d,e){function c(){var a=d.shortData.get();a&&"object"===typeof a&&a!==b.NONE&&a!==
b.LOADING&&(b.interceptOpenCloseClick?b.interceptOpenCloseClick(!0):d.detailOpen.set(!0))}b.withDetails&&a.push(alp.aEL(b.cont,"click",alp.nowF(c)))}});var d="_waitbox",b="_nodeCache"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.avalanche_detail");
(function(){function k(a,b){var c=b.data.get();if(c!==a.LOADING&&c!==a.NONE&&"object"===typeof c&&a.initRegionId){var d=b.region_index.get();if(!a._init_region_id_done){a._init_region_id_done=!0;var e=alp.indexOf(alp.map(c.regions,".id"),a.initRegionId);-1<e&&(d=e)}b.region_index.set(Math.max(0,Math.min(c.regions.length-1,d)))}b.loading.set(c===a.LOADING)}function h(b,d){function e(e){function h(){var e=alp.dfrd("_AVAD_load_latest_detail"),g=new Date,l=f(g);(c()?a(k):m.api_avalanche_detail({region_idlist:r,
day:g})).thenSoon(function(a){"ok"!==a.status?(console.error("avalanche_detail error loading details",a),d.data.set(b.NONE)):(a=b[v]=q({date:g,day:l,backendData:a}),a.merged_history=n(a.backendData.answer.regions),e.triggerSoon(a))});return e}function n(a){var b={};alp.forEach(a,function(a){(a=alp.oGet(a,"report.history"))&&alp.forIn(a,function(a,c){b[c]=Math.max(b[c]||0,a)})});return b=alp.mapIn(b,'isNaN(v)?"n":v')}function q(a){var b=a.date;a=alp.oCopy(a.backendData);var c=a.answer.regions;alp.forEach(c,
function(a){a=a.report;if(!a.history){var c=a.metaData,d=c&&c.validFrom,e=c&&c.validTo;c&&(d||e)&&(c=alp.str2date(d||e),c=(b-c)/864E5|0,a.history={},a.history["day_"+c]="n",a.oldDate=[f(new Date(+b-864E5*c))])}});var d=Math.min.apply(Math,alp.map(c,function(a){return Math.min.apply(Math,alp.map(alp.oKeys(alp.filterIn(a.report.history,"v in this",l.DANGER_OBJ)),".match(/\\d+/)|0"))}));alp.isFiniteNumber(d)||(d=0);alp.forEach(c,function(a){a=a.report;if(a.history){var c=alp.arr2oSimple(a.oldDate||[]);
a.history=alp.filterIn(a.history,function(a,e){a=e.match(/\d+/)|0;return a===d?!0:f(new Date(+b-864E5*a))in c})}});return{mh_date_to:b,mh_history_index:0,mh_history_index_first_data:d,backendData:a}}var r=e.join(",");(b[p]||(b[p]=h())).thenSoon(function(b){var e=b.mh_history_index_first_data,l=d.history_index.get();l<e?d.history_index.set(e):l===e?(l=alp.dfrd("latest_detail_backendData_dfrd"),l.triggerSoon(b.backendData),g(l)):(b=f(new Date(+new Date-864E5*l)),g(c()?a(l):m.api_avalanche_history({region_idlist:r,
day:b})))})}function f(a){var b=Math.round(-a.getTimezoneOffset()/60*100);return alp.date2str(a,"{YYYY}-{MM}-{DD}"+(0<b?"+":"")+alp.sPad(Math.abs(b),4,"0"))}function g(b){b||(b=a(k));var c=m.api_bodypart({path:"/plugin/desktop/inc/avalancheReport.jsp"});alp.gatherDfrd([b,q,c]).thenSoon(h)}function h(a){if(n===b[u]){var c=a[2][0];if("ok"!==(c&&alp.oGet(c,"answer.status")))throw Error("Could not download template!");b._i18n_day=a[1][0];b._tmpl=c.answer.html;a=l.extract(a[0][0]);if(!a.failure)if(a.no_data_for_that_day){if(c=
Math.min.apply(Math,alp.map(alp.oKeys(a.no_data_for_that_day.merged_history),function(a){return a.match(/\d+/)|0})),alp.isFiniteNumber(c)&&0<c){d.history_index.set(k+c);return}}else{a=alp.mix({},a,{data_history_index:k});d.data.set(a);return}d.data.set(b.NONE);console.error("avalanche_detail: failure: ",a.failure)}}var k=d.history_index.get(),n=b[u]=1+(b[u]|0);if(b.region_idlist)e(b.region_idlist.split(","));else if(b.ooiid)l.loadRegionIdlist(b).thenSoon(e);else{var r=b.initRegionId;(r||null).substring.call.a;
e([r])}}function g(a,c){function f(f){f&&(a._cont=f);alp.forEach(alp.gEBTN("a",a._cont),l);a._manyWrapper=alp.nodify(a.manyWrapper,a._cont);a._manyCont=alp.nodify(a.manyCont,a._cont);a._manyOneTmpl=alp.nodify(a.manyOneTmpl,a._cont);a._day=alp.gEBCN(a.day,a._cont);a._date=alp.gEBCN(a.date,a._cont);a._regionTitle=alp.gEBCN(a.regionTitle,a._cont);a._providers=alp.gEBCN(a.providers,a._cont);a._reportDate=alp.gEBCN(a.reportDate,a._cont);a._reportDate_tmpl||(a._reportDate_tmpl=a._reportDate&&a._reportDate.length&&
a._reportDate[0].innerHTML.replace(/\$(\w+)/g,"{$1}"));a._detail=alp.arr2o(alp.gEBCN(a.detail,a._cont),g,alp.f());a._detailWrapper=alp.mapIn(a._detail,h);a._sourceLink=alp.gEBCN(a.sourceLink,a._cont);2>k.regions.length?alp.style(a._manyWrapper,"display","none"):(a._manyNoli=alp.map(k.regions,e,a),f=document.createDocumentFragment(),alp.forEach(a._manyNoli,"this.appendChild(v)",f),alp.empty(a._manyCont),alp.aC(a._manyCont,f),alp.forEach(a._manyNoli,d,a),c.region_index.change_cb_init(b,null,a,c),alp.style(a._manyWrapper,
"display",""));b(a,c)}function g(b){return b.className.match(a.detail_rx)[1]}function l(b){function c(b){alp.stopEvent(b||window.event);alp.gEBI(e,a._cont).scrollIntoView()}var d=alp.gA(b,"href")||b.href,e=(d=d&&d.match(/^#(.+)$/))&&d[1];e&&alp.aEL(b,"click",c,!0)}function h(b){for(;b=b.parentNode;)if(alp.hasClass(b,a.detailWrapper))return[b];return[]}var k=c.data.get(),m=k===a.LOADING;a[t]||(a[t]={left:{},right:{}});m||(a.NONE===k?(console.log("avalanche_detail: no data."),c.open.set(!1)):"object"===
typeof k?a._cont?f():n.open({html:a._tmpl,extraClass:a.contClass,onOpenNow:f,onCloseLater:function(){a.interceptOpenCloseClick?a.interceptOpenCloseClick(!1):a.m.open.setNow(!1);a._cont=null;a[x]=null;a[z]=null;a[C]=null},width:1200,height:800}):null.bug)}function f(a,b){if(b.loading.get())b=a[w]||(a[w]=new alp.x.Waitbox({delay_ms:100,background:{w:234,h:123}})),b.setTarget(a._cont),b.startWait();else if(b=a[w])b.stopWait(),b.setTarget()}function e(a){var b=alp.tmplJs(this._manyOneTmpl.innerHTML,a);
b=alp.cE("div",null,{"class":"alp-x-clickable"},{innerHTML:b});alp.setText(alp.gEBCN(this.manyOneTitle,b),a.title||a.name||a.id);return b}function d(a,b){var c=this;alp.aEL(a,"click",function(){c.m.region_index.setNow(b)})}function b(a,b){function c(b,c){var d=alp.oGet(f,["report","details",c])||"";alp.setProp(b,"innerHTML",d);(b=a._detailWrapper[c])&&alp.setClass(b,oa.NO_DISPLAY,!d)}function d(b){alp.setText(alp.gEBCN(a.sourceText,b),this.name)}var e=b.data.get();b=b.region_index.get();a._manyNoli&&
(alp.setClass(a._manyNoli,a.manyOneSelected,!1),alp.setClass(a._manyNoli[b],a.manyOneSelected,!0));if("object"===typeof e){var f=e.regions[b];e=f.middleDate;alp.setProp(a._day,"innerHTML",a._i18n_day.weekdays.split(",")[e.getDay()%7]);alp.setProp(a._date,"innerHTML",e.getDate()+". "+a._i18n_day.months.split(",")[e.getMonth()%12]+" "+e.getFullYear());alp.setProp(a._regionTitle,"innerHTML",f.title||f.name||f.id);e=alp.map(alp.oGet(f,"report.providers")||[],"v.title  ||  v.name").join(", ");alp.setProp(a._providers,
"innerHTML",e);if(e=a._reportDate)(b=(b=alp.oGet(f,"report.metaData.reportDateTime"))&&alp.str2date(b))?(alp.setProp(e,"innerHTML",alp.date2str(b,a._reportDate_tmpl)),alp.style(e,"display","")):alp.style(e,"display","none");alp.forIn(a._detail,c);if(e=a._sourceLink)(b=alp.filter(alp.oGet(f,"report.providers")||[],"v.name  &&  v.webaddress")[0])?(alp.forEach(e,d,b),alp.sA(e,"href",b.webaddress),alp.style(e,"display","")):alp.style(e,"display","none");(e=alp.nodify(a.webappLinkNode,a._cont))&&a.webappLink?
(alp.sA(e,"href",a.webappLink),alp.style(e,"display","")):alp.style(e,"display","none");a[x]||(e=alp.Aps.call(alp.gEBCN(a.t1Class,a._cont),0,2),2===e.length||null.bug,a[x]={cont:e[0],cache:{}},a[y]={cont:e[1],cache:{}});e=a[x];b=a[y];var g=alp.isRTL()?a.rightTriClass:a.leftTriClass,l=alp.isRTL()?a.rightLimitClass:a.leftLimitClass;r.setup_triangle(f.morningDanger,e.cont,e.cache,g,l,a);r.setup_triangle(f.afternoonDanger,b.cont,b.cache,g,l,a);a[z]||(e=alp.Aps.call(alp.gEBCN(a.expoClass,a._cont),0,2),
2===e.length||null.bug,a[z]={cont:e[0]},a[A]={cont:e[1]});e=a[z];b=a[A];r.setup_exposition(f.morningDanger&&f.morningDanger.hasExposition?f.morningDanger:alp.oGet(f,"overview.morningDanger")||null,e.cont,a);r.setup_exposition(f.afternoonDanger&&f.afternoonDanger.hasExposition?f.afternoonDanger:alp.oGet(f,"overview.afternoonDanger")||null,b.cont,a);a[C]||(a[C]={cont:alp.nodify(a.historyCont,a._cont),cache:{}});e=a[C];r.setup_history(a[v],f.middleDate,e.cont,e.cache,a.m.history_index,a)}}function c(){return"__ret"in
c?c.__ret:c.__ret=/\bproto\b.*?\bavalsimuldetail\b/.test(location.search)}function a(b){if(b in a)return a[b];var c=a[b]=alp.dfrd("xxxSimulationDetail");setTimeout(alp.nowF(function(){var a={status:"ok",answer:{regions:[{id:"10512584",name:"AT8R1",report:{providers:[{id:"1010",name:"outdooractive Redaktion"}],metaData:{reportDateTime:"2014-03-31T07:30:00+0200",validFrom:"2014-03-31T07:30:00+0200",validTo:"2014-04-01T07:30:00+0200"},details:{snowpackStructureComment:b+" Die fruehlingshafte Witterung beguenstigte die weitere Setzung und Verfestigung der Altschneedecke. In der klaren Nacht mit guter Abstrahlung konnte sich an Sonnenhaengen  ein meist tragfaehiger Harschdeckel ausbilden. In steilen Schattenhaengen und Bereichen mit wenig Wind und Einstrahlung sind die obersten Schichten teilweise noch pulvrig. Oft ist aber auch Windharsch anzutreffen. In hoehergelegenen Kamm- und Passlagen sind kleinraeumige Triebschneeansammlungen vorhanden. Dort wo beim letzten Schneefall der apere Boden eingeschneit wurde bilden sich Gleitschneerisse in der Schneedecke.",
travelAdvisoryComment:b+" In den Vormittagsstunden besteht meist geringe, oberhalb ca. 2400m maessige Lawinengefahr. Gefahrenstellen fuer trockene Lawinen befinden sich vor allem in Kamm- und Passlagen sowie in steilen Nordhaengen. Ausloesungen von Schneebrettlawinen sind dort insbesondere bei grosser Zusatzbelastung moeglich. In hohen Kammlagen sind kleine, aber teilweise stoeranfaellige Einwehungen zu beachten. Verbreitung und Umfang dieser Gefahrenstellen nehmen mit der Seehoehe zu. Eine vorsichtige Routenwahl wird empfohlen. Mit der Tageserwaermung und der Einstrahlung steigt die Gefahr von Nass- und Gleitschneelawinen an Sonnenhaengen unterhalb etwa 2800m und an Schattenhaengen unterhalb etwa 2000m im Tagesverlauf auf maessig an. Es sind dann kleine, vereinzelt auch mittlere Selbstausloesungen aus sehr steilen Gelaendeabschnitten moeglich. Schitouren und Variantenabfahrten sollten entsprechend fruehzeitig beendet werden.",
comment:"Bei fruehlingshaftem Wetter gibt es vormittags weiterhin guenstige Bedingungen und einen tageszeitlichen Anstieg der Lawinengefahr.   \r\nAndreas Pecl",highlights:b+" vormittags ueberwiegend guenstige Bedingungen; tageszeitlichen Anstieg der Lawinengefahr beachten",wxSynopsisComment:"Durchziehende Wolkenfelder liegen weit ueber den Gipfeln und beeintraechtigen weder die Sicht noch den Sonnenschein massgeblich. Dazu ist es wieder ausgesprochen mild mit einer Nullgradgrenze von knapp 3000m. Temperatur in 2000m: 8 Grad. Hoehenwind: meist nur schwacher Wind aus unterschiedlichen Richtungen."},
dangers:[{dangerLevel:"2",beginTime:"2014-03-31T12:00:00+0200",endTime:"2014-04-01T07:30:00+0200"},{dangerLevel:"1",beginTime:"2014-03-31T07:30:00+0200",endTime:"2014-03-31T12:00:00+0200"}],overviewDangers:[{dangerLevel:"1",beginTime:"2014-03-31T12:00:00+0200",endTime:"2014-04-01T07:30:00+0200",exposition:"NN,NO,OO,SO,SS,SW,WW,NW",comment:"Kamm-, Passlagen und steile Schattenhaenge; spontane Nassschneelawinen im Tagesverlauf; weiterhin Gleitschneelawinen"},{dangerLevel:"1",beginTime:"2014-03-31T07:30:00+0200",
endTime:"2014-03-31T12:00:00+0200",exposition:"NN,NO,NW",comment:"Kamm-, Passlagen und steile Schattenhaenge; spontane Nassschneelawinen im Tagesverlauf; weiterhin Gleitschneelawinen"}],history:{day_0:1,day_1:2,day_2:2,day_3:2,day_4:2}}},{id:"10512586",name:"AT8R3",report:{providers:[{id:"1010",name:"outdooractive Redaktion"}],metaData:{reportDateTime:"2014-03-31T07:30:00+0200",validFrom:"2014-03-31T07:30:00+0200",validTo:"2014-04-01T07:30:00+0200"},details:{snowpackStructureComment:b+" ###1111 Die fruehlingshafte Witterung beguenstigte die weitere Setzung und Verfestigung der Altschneedecke. In der klaren Nacht mit guter Abstrahlung konnte sich an Sonnenhaengen  ein meist tragfaehiger Harschdeckel ausbilden. In steilen Schattenhaengen und Bereichen mit wenig Wind und Einstrahlung sind die obersten Schichten teilweise noch pulvrig. Oft ist aber auch Windharsch anzutreffen. In hoehergelegenen Kamm- und Passlagen sind kleinraeumige Triebschneeansammlungen vorhanden. Dort wo beim letzten Schneefall der apere Boden eingeschneit wurde bilden sich Gleitschneerisse in der Schneedecke.",
travelAdvisoryComment:b+" ####1111 In den Vormittagsstunden besteht meist geringe, oberhalb ca. 2400m maessige Lawinengefahr. Gefahrenstellen fuer trockene Lawinen befinden sich vor allem in Kamm- und Passlagen sowie in steilen Nordhaengen. Ausloesungen von Schneebrettlawinen sind dort insbesondere bei grosser Zusatzbelastung moeglich. In hohen Kammlagen sind kleine, aber teilweise stoeranfaellige Einwehungen zu beachten. Verbreitung und Umfang dieser Gefahrenstellen nehmen mit der Seehoehe zu. Eine vorsichtige Routenwahl wird empfohlen. Mit der Tageserwaermung und der Einstrahlung steigt die Gefahr von Nass- und Gleitschneelawinen an Sonnenhaengen unterhalb etwa 2800m und an Schattenhaengen unterhalb etwa 2000m im Tagesverlauf auf maessig an. Es sind dann kleine, vereinzelt auch mittlere Selbstausloesungen aus sehr steilen Gelaendeabschnitten moeglich. Schitouren und Variantenabfahrten sollten entsprechend fruehzeitig beendet werden.",
comment:"####1111 Bei fruehlingshaftem Wetter gibt es vormittags weiterhin guenstige Bedingungen und einen tageszeitlichen Anstieg der Lawinengefahr.   \r\nAndreas Pecl",highlights:b+" #####1111 vormittags ueberwiegend guenstige Bedingungen; tageszeitlichen Anstieg der Lawinengefahr beachten",wxSynopsisComment:"#####1111 Durchziehende Wolkenfelder liegen weit ueber den Gipfeln und beeintraechtigen weder die Sicht noch den Sonnenschein massgeblich. Dazu ist es wieder ausgesprochen mild mit einer Nullgradgrenze von knapp 3000m. Temperatur in 2000m: 8 Grad. Hoehenwind: meist nur schwacher Wind aus unterschiedlichen Richtungen."},
dangers:[{dangerLevel:"2",beginTime:"2014-03-31T12:00:00+0200",endTime:"2014-04-01T07:30:00+0200"},{dangerLevel:"1",beginTime:"2014-03-31T07:30:00+0200",endTime:"2014-03-31T12:00:00+0200",beginElevation:2400}],overviewDangers:[{dangerLevel:"1",beginTime:"2014-03-31T12:00:00+0200",endTime:"2014-04-01T07:30:00+0200",exposition:"NN,NO,OO,SS,SW,NW",comment:"Kamm-, Passlagen und steile Schattenhaenge; spontane Nassschneelawinen im Tagesverlauf; weiterhin Gleitschneelawinen"}],history:{day_0:3,day_1:1,
day_2:2,day_3:5,day_4:4}}}]}};0===b&&alp.forEach(a.answer.regions,function(a){delete a.report.details;delete a.report.dangers;delete a.report.overviewDangers;delete a.report.metaData;delete a.report.history.day_0});c.triggerSoon(a)}),897);return c}var m=alp.data,l=m.avalanche,r=alp.x.avalanche,n=alp.view.modalwin,q=alp.i18n.fetch("alp.all");alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.AvalancheDetail",alp.x.AbstractController,null,r.css_classes,{proj:alp.sub("oa.API_CFG.proj")||null,
key:alp.sub("oa.API_CFG.key")||null,_cont:null,ooiid:null,region_idlist:null,initRegionId:null,webappLink:null,webappLinkNode:"oax-avalanche-webapp-link",interceptOpenCloseClick:null,contClass:"alp-x-avalanche-detail-cont",closeClass:"alp-x-avalanche-close",manyWrapper:"oax-avalanche-many-wrapper",manyCont:"oax-avalanche-many-cont",manyOneTmpl:"oax-avalanche-many-one-tmpl",manyOneTitle:"oax-avalanche-many-one-title",manyOneSelected:"oax-avalanche-many-one-selected",day:"oax-avalanche-day",date:"oax-avalanche-date",
regionTitle:"oax-avalanche-region-title",providers:"oax-avalanche-providers",reportDate:"oax-avalanche-reportDate",sourceLink:"oax-avalanche-source-link",sourceText:"oax-avalanche-source",detail:"oax-avalanche-detail",detailWrapper:"oax-avalanche-detail-wrapper",detail_rx:/(?:^|\s)oax-avalanche-detail-(\S+?)(?:\s|$)/,LOADING:"loading",NONE:"none",augmentModel:function(a){(this.ooiid||this.initRegionId||null).substring.call.a;(this.proj||null).substring.call.a;a.open=new alp.BoolState;a.data=new alp.State({init_value:this.LOADING});
a.region_index=new alp.NumberState;a.history_index=new alp.NumberState;a.loading=new alp.BoolState},augmentKids:function(a){},setInitVal:function(a,b,c,d){a._latest_detail_dfrd=null},connectModel2Model:function(a,b,c,d){function e(){c.data.set(a.LOADING);h(a,c)}b.push(c.data.change_cb(k,null,a,c));b.push(c.history_index.change_cb(e));k(a,c);e()},connectModel2View:function(a,b,c,d){b.push(c.open.change_cb_init(function(){c.open.get()&&g(a,c)}));b.push(c.data.change_cb_init(g,null,a,c));b.push(c.loading.change_cb_init(f,
null,a,c))}});var p="_latest_detail_dfrd",v="_latest_detail",u="_load_count",t="_nodeCache",w="_waitbox",x="_morning_triangle",y="_afternoon_triangle",z="_morning_exposition",A="_afternoon_exposition",C="_history"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.avalanche");"undefined"!==typeof dojo&&dojo.provide("alp.i18n.format");
(function(){function k(){h();if(!g)alp.onDCL(h);k=alp.f()}function h(){var f=alp.nodify("oax-format-cont");f&&(g=alp.cE("div",0,0,{innerHTML:f.innerHTML}))}alp.sub("alp.i18n.format",null,!0).dateTmpl=function(f){return function(){k();var d;(d=e)||(d=(d=g&&alp.nodify("oax-format-"+f,g))&&d.innerHTML.toUpperCase().replace(/\{[\s\S]*?,([^,]*)\}/,"$1").replace(/\b(\w+)\b/g,"{$1}")||null,d=e=d);return d};var e}("dateTmpl");var g})();"undefined"!==typeof dojo&&dojo.provide("alp.i.i_statistic");
(function(){var k=alp.data,h=alp.i18n.format;alp.sub("alp.i",null,!0).IStatistic={tmpl:"alp-x-statisticsbox-boxTmpl",_check_prepare:function(){(this.proj||null).substring.call.a;(this.ooiid||null).substring.call.a;this.cont.childNodes.a;this._tmplNode=alp.nodify(this.tmpl,this.cont);this._tmplNode.childNodes.a},_load:function(f){var e=this;(new k.SingleOOI(e.ooiid,{proj:e.proj})).load(function(d){alp.m(new k.api_platform_info({project:e.proj,id:e.ooiid}),["to","thenSoon"],function(b){b=alp.oCreateMix(b,
{ranking:d.data.ranking,createdAt:alp.oGet(d,"data.meta.date.created")});f(b)})})},_display:function(f,e){var d=e.data.get();d&&(e=f[g]||(f[g]=f._tmplNode.innerHTML),d=alp.oDeepMix({reaches:{teasersAll:"0",detailsAll:"0",actionsAll:"0",downloadsAll:"0"},ranking:"?",createdAt:"?"},d),"?"!==d.ranking&&(d.ranking|=0),"?"!==d.createdAt&&(d.createdAt=alp.date2str(alp.str2date(d.createdAt),h.dateTmpl()||"{DD}.{MM}.{YYYY}")),alp.forEach(["teasersAll","detailsAll","actionsAll","downloadsAll"],"this[v]=(this[v]|0).toLocaleString(alp.i18n.language())",
d.reaches),f.cont.innerHTML=alp.tmplJs(e,d))}};var g="_tmpl_html"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.statistic");(function(){alp.declare("alp.x.Statistic",alp.x.AbstractController,null,alp.i.IStatistic,{proj:null,ooiid:null,cont:null,augmentModel:function(k){this._check_prepare();k.data=new alp.State;this._load(function(h){k.data.setNow(h)})},connectModel2View:function(k,h,g,f){h.push(g.data.change_cb_init(k._display,null,k,g))}})})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.weather");
(function(){alp.sub("alp.data.api",null,!0).weather=function(h){function g(f){alp.m(k,["triggerSoon","done"],f)}k||(k=alp.dfrd("ADA:weather",{then:1}),alp.m(alp.jsonp(alp.cfg.url.api_weather_xd(h)),["to","then"],g));return k};var k})();"undefined"!==typeof dojo&&dojo.provide("alp.x.weatherbox");
(function(){function k(a,b,c,d){var e=d.scrollerClassPrev,f=d.scrollerClassNext;alp.isRTL()&&(c*=-1,e=d.scrollerClassNext,f=d.scrollerClassPrev);return alp.aEL(alp.gEBCN(b,a)[0],"click",function(){var b=alp.gEBCN("oax-scroll-wrapper",a)[0];b.scrollLeft+=c;alp.setClass(alp.gEBCN(e,a)[0],"oax_no_display",0==b.scrollLeft);alp.setClass(alp.gEBCN(f,a)[0],"oax_no_display",b.scrollLeft+b.offsetWidth==alp.gEBCN("oax-scroll-wrapper-inner",a)[0].offsetWidth);return!1})}function h(a,b){return alp.aEL(alp.gEBCN("oax-forecast-tab"),
"click",function(){"overview"==this.id?alp.setClass(a,"alp-currentTab-details",!1):"details"==this.id&&alp.setClass(a,"alp-currentTab-overview",!1);alp.setClass(a,"alp-currentTab-"+this.id,!0);if("details"==this.id){var c=alp.gEBCN("oax-scroll-wrapper",a)[0];alp.isRTL()?c.scrollLeft=c.scrollWidth:c.scrollLeft=0;alp.setClass(alp.gEBCN(b.scrollerClassPrev,a)[0],"oax_no_display",!0)}return!1})}function g(a,b){return alp.aEL(a,"click",function(a){a=!b.m.open.get();b.interceptOpenCloseClick?b.interceptOpenCloseClick(a):
b.m.open.setNow(a);return!1})}function f(a){function b(b,c,d){a.withDetails&&(alp.setClass(b,"alp-currentTab-overview",!0),h(b,a),k(b,a.scrollerClassPrev,a.scrollerValPrev,a),k(b,a.scrollerClassNext,a.scrollerValNext,a))}function d(){if(!a.overlayContentNode){var b=a.m.data.get();if(!b)return!1;var c=alp.gEBCN(a.overlayTmplClass,a.boxCont)[0];b=alp.tmplJs(c,b.forecast);a.overlayContentNode=alp.cE("script",alp.body(),{type:"text/html"},{innerHTML:b})}return!0}a.m.open.get()&&(d()?c.open({html:a.overlayContentNode.innerHTML,
extraClass:"alp-x-weatherbox-overlay",onOpenNow:b,onCloseLater:alp.bindF(a.hide,a),width:1200,height:800}):alp.asyncF(100,f,null,a)())}function e(a){var b=a.wbox||(a.wbox=new alp.x.Waitbox({targetInit:a.cont}));a.m.loading.get()?b.startWait():b.stopWait()}function d(a){var b=a.m.data.get();if(b){b=b&&b.forecast.days[0];a.boxContentNode&&alp.orphan(a.boxContentNode);a.overlayContentNode&&alp.orphan(a.overlayContentNode);var c=alp.gEBCN(a.boxTmplClass,a.boxCont)[0];b=alp.tmplJs(c,b);b=a.boxContentNode=
alp.cE("div",a.cont,{"class":"oax_pointer oax_weather_box oax_hoverlink_wrapper"},{innerHTML:b});g(b,a)}}alp.sub("alp.x",null,!0);var b=alp.data.api,c=alp.view.modalwin,a=new alp.PoliteSetState;alp.ensureCss(alp.cssBase()+"alp/x.css");var m=alp.sub("alp.x.weatherbox",null,!0);m.renderOverview=function(a){a=a.days;var b="",c=alp.gEBCN("oax-weatherbox-overview-rowTmpl")[0];alp.forEach(a,function(a){a.label&&(b+=alp.tmplJs(c,a))});return b};m.renderDetails=function(a){a=a.days;var b="",c=alp.gEBCN("oax-weatherbox-rowTmpl")[0],
d=!0;alp.forEach(a,function(a){d=!0;var e=a.periods,f=e.length-1;alp.forEach(e,function(e,g){d&&(e.dayDate=a.date,e.colClass="oax_first_column");f==g&&(e.colClass="oax_last_column");b+=alp.tmplJs(c,e);d=!1})});return b};m.renderOverviewPeriods=function(a){a=a.periods;var b="",c=!0,d=alp.gEBCN("oax-weatherbox-overview-period-rowTmpl")[0],e=4-Math.floor(a.length/2);alp.forEach(a,function(a){c&&(a.emptyCellClass="oax_emptycells_"+e);a.label&&(b+=alp.tmplJs(d,a),c=!1)});return b};alp.declare("alp.x.Weatherbox",
alp.x.AbstractController,null,{ooiid:null,proj:null,cont:null,fillBoxMarkup:!0,withDetails:!0,interceptOpenCloseClick:null,overlayVisibleClass:"alp-x-weatherbox-overlay-vis",withDetailsClass:"alp-x-weatherbox-with-details",overlayToggleClass:"alp-x-weatherbox-toggle-overlay",overlayClass:"alp-x-weatherbox-overlay",boxTmplClass:"alp-x-weatherbox-boxTmpl",overlayTmplClass:"alp-x-weatherbox-overlayTmpl",errorTmplClass:"alp-x-weatherbox-errorTmpl",scrollerClassNext:"oax-weatherbox-next",scrollerClassPrev:"oax-weatherbox-prev",
scrollerValNext:145,scrollerValPrev:-145,hide:function(){this.interceptOpenCloseClick?this.interceptOpenCloseClick(!1):this.m.open.setNow(!1)},isOpen:function(){return this.m.open.get()},augmentModel:function(b){b.loading=new alp.BoolState({init_value:!0});b.isReady=new alp.BoolState;b.open=new alp.BoolState;b.data=new alp.ObjectState({init_value:null});a.add(b.open)},augmentKids:function(a){this.cont=alp.nodify(this.cont);this.cont.a},setInitVal:function(a,c,d,e){d.loading.set(!0);b.weather({ooiid:a.ooiid,
proj:a.proj}).then(function(b){var c=b&&b.response;(c=c&&c.status)&&"ok"===c?d.data.setNow(b):(d.loading.setNow(!1),alp.setClass(a.cont,a.withDetailsClass,!1))})},connectModel2Model:function(a,b,c,d){b.push(c.data.change_cb_init(function(){c.data.get()&&c.loading.set(!1)}))},connectView2Model:function(a,b,c,d){d=alp.gEBCN(a.overlayToggleClass,a.cont);b.push(g(d,a));b.push(alp.aEL(alp.body(),"keyup",function(b){b||(b=window.event);b.keyCode===alp.key.ESCAPE&&c.open.get()&&(alp.stopEvent(b),a.hide())}))},
connectModel2View:function(a,b,c,g){b.push(c.loading.change_cb_init(alp.bindF(e,null,a)));b.push(c.data.change_cb_init(alp.bindF(d,null,a)));b.push(c.open.change_cb_init(alp.bindF(f,null,a)))},connectPureView:function(a,b,c,d){a.withDetails&&alp.setClass(a.cont,a.withDetailsClass,!0)}})})();"undefined"!==typeof dojo&&dojo.provide("oa.util.teamactivity_dialog");
(function(){function k(e){alp.dom.anchor.wrap_ooi_snippet(e)}function h(e,d){alp.aEL(e,"click",alp.stopEvent);return alp.aELtouchup(e,d)}var g=alp.sub("oa.util.teamactivity_dialog",null,!0),f=alp.view.modalwin;g.install=function(e){var d=alp.Eh?e&&e.eh||new alp.Eh:e&&e.hg||alp.hg(),b=alp.gEBCN("oax-related-teamactivity"),c=e.id;b&&c&&d.push(h(b,function(a){a||(a=window.event);alp.stopEvent(a);a=alp.tmpl(oa.TEAMACTIVITY_DIALOG_MARKUP_JSONP_URL_TMPL,{id:c});alp.m(alp.jsonp(a,{cache:!1}),["to","then"],
g.open_dialog)}));return d};g.open_dialog=function(e){e=(e=e&&e.answer)&&/^ok$/i.test(e.status)&&e.html;(e||null).substring.call.a;var d=alp.cE("div",null,null,{innerHTML:e});if(alp.gEBCN("oax-teamactivity-dialog-list",d)[0])f.open({html:e,onOpenNow:k});else if(e=alp.gEBCN("oax-plan-own-teamactivity",d)[0])location.href=e.href}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_ooi");
(function(){function k(b){function a(a){oax.layout.lightbox_setup(a);return a}if(b.m.nearbyConditions.get()){var c=alp.nodify("oax-nearby-conditions-cont",b.cont);c&&!b.kx.nearbyConditions&&(b.kx.nearbyConditions=new alp.x.MoreSnippets({contNode:c,proj:b.proj,id:b.id,prefix:"nearbyConditions",postProcess:a,initLength:5,step:3,initNow:!0}),b.kx.nearbyConditions.m.nfull.change_cb(function(a){alp.setClass(alp.gEBCN("alp-moresnippets-nothing",b.cont),oax.NO_DISPLAY,0!==a)}))}}function h(b,a,d){b.flexOpener.setDpOverlay(b.flexOpenerPage,
d?a:null)}var g=oax.community_layout,f=alp.dom.anchor,e=alp.content,d=oa.util.community,b=oa.util.teamactivity_dialog;alp.declare("oax.x.DetailExtraOoi",alp.x.AbstractController,null,{cont:null,proj:null,id:null,flexOpener:null,flexOpenerPage:null,adderCommentCont:oax.ADD_COMMENT_CONT,adderConditionCont:oax.ADD_CONDITION_CONT,adderBasketCont:oax.ADD_BASKET_CONT,avalancheCont:oax.AVALANCHE_CONT,statisticCont:oax.STATISTIC_CONT,weatherBoxCont:oax.WEATHER_BOX_CONT,showOverlay:alp.nowF(function(b){alp.forIn(this._ov_name2b,
function(a,c){a.set(c===b)})}),augmentModel:function(b){b.mapCfg=new alp.State;b.nearbyConditions=new alp.BoolState;this._ov_name2b={}},augmentKids:function(b){function a(){alp.setClass(alp.gEBCN("oax-show-comments-tab",l.cont),"oax_active",!1);alp.setClass(alp.gEBCN("oax-show-currentConditions-tab",l.cont),"oax_active",!0);alp.setClass(alp.gEBCN("oax-myComment-container",l.cont),oax.NO_DISPLAY,!0);alp.setClass(alp.gEBCN("oax-myCondition-container",l.cont),oax.NO_DISPLAY,!1);alp.dom.scrollToNode(p)}
function c(a){f.wrap_ooi_snippet(a,{filterHrefId:!1});var b=alp.gEBCN("oax-purchase-indent",a);alp.aEL(b,"click",function(){var b=oax.ID_FROM_DOMNODE(a);e.track({proj:k,id:b,aspect:"PurchaseIndent"})},!0);return a}var l=this;this.cont.childNodes.a;var k=this.proj,n=this.id,q=alp.nodify(this.adderCommentCont,this.cont),p=alp.nodify(this.adderConditionCont,this.cont),v=alp.nodify(this.adderBasketCont,this.cont),u=alp.nodify(this.weatherBoxCont,this.cont),t=alp.nodify(this.avalancheCont,this.cont),w=
alp.nodify(this.statisticCont,this.cont);k.substring.a;n.substring.a;u&&(b.weather=new alp.x.Weatherbox({proj:k,ooiid:n,cont:u,withDetails:!0,interceptOpenCloseClick:alp.bindF(h,null,l,"weather")}),alp.aEL(alp.gEBCN(oax.WEATHER_BOX_OPENER,this.cont),"click",function(){l.flexOpener.setDpOverlay(l.flexOpenerPage,"weather")}),this._ov_name2b.weather=b.weather.m.open);t&&(b.avalancheShort=new alp.x.AvalancheShort({proj:k,ooiid:n,cont:t,withDetails:!0,interceptOpenCloseClick:alp.bindF(h,null,l,"avalanche")}),
this._ov_name2b.avalanche=b.avalancheShort.m.detailOpen);w&&(b.statistic=new alp.x.Statistic({proj:k,ooiid:n,cont:w}));oa.x.JourneyDialog.install({cont:l.cont,proj:k,ooiid:n});g.login_indicator()&&(u=g.get_user_id(),u.substring.a,t={},q&&(t={type:oax.ADD_COMMENT_CONT},d.generic_login_barrier_after(t,alp.bindF(alp.dom.scrollToNode,null,q)),b.adderComment=new oax.x.OoiAdderComment({proj:k,ooiid:n,userid:u,cont:q})),p&&(t={type:oax.ADD_CONDITION_CONT},d.generic_login_barrier_after(t,a),b.adderCondition=
new oax.x.OoiAdderCondition({proj:k,ooiid:n,userid:u,cont:p,mapCfg:this.m.mapCfg})),v&&(b.adderBasket=new oax.x.OoiAdderBasket2({proj:k,ooiid:n,userid:u,cont:v}),t={type:oax.ADD_BASKET_CONT},d.generic_login_barrier_after(t,alp.bindF(oax.x.OoiAdderBasket2.addToList,null,b.adderBasket))));alp.forEach(alp.gEBCN(oax.SNIPPET_CONTAINER,this.cont),function(a){var d=a.className.match(oax.SNIPPET_CONTAINER_MORE_RX);d=alp.opt(d,1);var e="more_"+d;d&&!b[e]&&(b[e]=new alp.x.MoreSnippets({contNode:a,proj:l.proj,
id:l.id,prefix:d,initLength:6,step:4,postProcess:c}))})},connectView2Model:function(b,a,d,e){function c(){alp.hasClass(g,oax.NO_DISPLAY)?(alp.setClass(f,"oax-nearby-vis",!0),alp.setClass(g,oax.NO_DISPLAY,!1),b.m.nearbyConditions.setNow(!0)):(alp.setClass(f,"oax-nearby-vis",!1),alp.setClass(g,oax.NO_DISPLAY,!0),b.m.nearbyConditions.setNow(!1))}var f=alp.nodify("oax-currentConditions-select-nearby",b.cont),g=alp.nodify("oax-currentConditions-nearby",b.cont);f&&g&&a.push(alp.aEL(f,"click",c))},connectModel2View:function(b,
a,d,e){a.push(d.nearbyConditions.change_cb_init(alp.bindF(k,null,b)))},connectPureView:function(c,a,d,e){function f(){alp.setClass(g,"oax_focus",!0)}b.install(c);if(e.adderComment){var g=alp.gEBCN("oax_myComment_add",c.cont);a.push(alp.aEL(alp.Apc.call(alp.gEBCN("oax-show-comments-tab",c.cont),g),"click",f))}}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_skiresort");(function(){alp.declare("oax.x.DetailExtraSkiresort",oax.x.DetailExtraOoi)})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_story");
(function(){alp.declare("oax.x.DetailExtraStory",oax.x.DetailExtraOoi,null,{videoContClass:"oax-one-video-cont",augmentKids:function(k){k=alp.gEBCN(this.videoContClass,this.cont);alp.forEach(k,function(h){new alp.x.YTPlayer({cont:h,videoid:h.dataset.source,previewUrl:h.dataset.preview,hideControls:!1,allowfullscreen:!0,initNow:!0})})}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_condition");(function(){alp.declare("oax.x.DetailExtraCondition",oax.x.DetailExtraOoi)})();
"undefined"!==typeof dojo&&dojo.provide("alp.util.calorieConsumption");
(alp.util||(alp.util={})).calculateCalorieConsumption=function(k,h,g,f,e){if(3<=h&&10>=h)if("f"==k){h=499;var d=22.5}else h=495,d=22.7;else 11<=h&&18>=h?"f"==k?(h=746,d=12.2):(h=651,d=17.5):19<=h&&30>=h?"f"==k?(h=496,d=14.7):(h=679,d=15.3):31<=h&&60>=h?"f"==k?(h=829,d=8.7):(h=879,d=11.6):61<=h&&99>=h?"f"==k?(h=596,d=10.5):(h=487,d=13.5):"f"==k?(h=829,d=8.7):(h=879,d=11.5);k=5;switch(f){case "nordicwalkingTrail":k=4.2;break;case "running":k=3.4;break;case "trailRunning":k=3.4;break;case "inlineSkating":k=
4.3;break;case "sledging":k=4.7;break;case "skitour":k=4.3;break;case "skifreeride":k=3.2;break;case "skijoering":k=3.8;break;case "skitrailCrosscountry":k=4.3;break;case "mountaineering":k=4;break;case "alpineTour":k=4;break;case "viaferrata":k=4;break;case "hikingTourTrail":k=4.8;break;case "pilgrimTrack":k=4.8;break;case "longDistanceHikingTrail":k=4.8;break;case "winterHiking":k=4.8;break;case "snowshoehiking":k=4.5;break;case "mountainbiking":k=2.9;break;case "transalpMountainbiking":k=2.9;break;
case "racingBike":k=3.2;break;case "cycling":k=5;break;case "longDistanceCyclingTrack":k=5;break;case "cityTrail":k=6.2;break;case "themeTrail":k=6;break;case "horsebackRidingTour":k=5.5}return Math.round((h+g*d)/k*(e/60))};"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_tour");
(function(){var k=alp.view.modalwin;alp.declare("oax.x.DetailExtraTour",oax.x.DetailExtraOoi,null,{calorieConsumptionContClass:"oax-calorieConsumption",calorieConsumptionOpen:"oax-calorieConsumption-action",connectPureView:function(h,g,f,e){g.push(alp.aEL(alp.gEBCN(h.calorieConsumptionOpen,h.cont),"click",function(){function d(a){var b=alp.gEBCN("oax-calorieConsumption-age",a)[0],c=alp.gEBCN("oax-calorieConsumption-weight",a)[0],d=alp.gEBCN("oax-calorieConsumption-gender-male",a)[0],e=alp.gEBCN("oax-calorieConsumption-time",
a)[0],f=alp.gEBCN("oax-calorieConsumption-category",a)[0];b=alp.util.calculateCalorieConsumption(d.checked?"m":"f",b.options[b.selectedIndex].value,c.options[c.selectedIndex].value,f.value,e.value);alp.gEBCN("oax-calorieConsumption-result",a)[0].innerHTML=b}var b=alp.gEBCN("oax-calorieConsumption-action-sbtitle")[0];b=b&&alp.textContent(b);var c=alp.gEBCN("oax-hidden-calorieConsumption-dialog")[0];k.open({html:c.innerHTML,title:b,height:400,width:450,onOpenNow:function(a){alp.aEL(alp.gEBCN("oax-calorieConsumption-submit",
a),"click",alp.bindF(d,null,a))}})}));!alp.supportsSVGInline()&&(g=(h=alp.nodify("oax-svg-container",h.cont))&&alp.gA("data-fallback",h))&&(alp.empty(h),alp.cE("img",h,{src:g}))}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_hut");(function(){alp.declare("oax.x.DetailExtraHut",oax.x.DetailExtraOoi)})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_poi");(function(){alp.declare("oax.x.DetailExtraPoi",oax.x.DetailExtraOoi)})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_literature");
(function(){var k=alp.dom.anchor;alp.declare("oax.x.DetailExtraLiterature",oax.x.DetailExtraOoi,null,{connectPureView:function(){var h=alp.gEBCN("oax-publishedContent-cont")[0];h=alp.gEBCN("oax-mapList-snippet",h);alp.forEach(h,k.wrap_ooi_snippet)}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_lodging");(function(){alp.declare("oax.x.DetailExtraLodging",oax.x.DetailExtraOoi)})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_offer");
(function(){alp.declare("oax.x.DetailExtraOffer",oax.x.DetailExtraOoi)})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_event");(function(){alp.declare("oax.x.DetailExtraEvent",oax.x.DetailExtraOoi)})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailextra_teamactivity");(function(){alp.declare("oax.x.DetailExtraTeamactivity",oax.x.DetailExtraOoi,null,{connectPureView:function(k,h,g,f){oa.x.TeamActivity.install_all(k)}})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.sorthead");
(function(){function k(e,d,b){e.m.active.get()&&(d=d.className.match(e.selectableKeyRx)[1],b=e.m.key2ascendant,e=e.m.selected,e.is(d)?b.set_flex_now(d,!b.get_property(d)):e.setNow(d))}function h(e){for(var d=e.m,b=d.active.get(),c=e[f],a=c.length,g=0;g<a;g++){var l=c[g],h=l.className.match(e.selectableKeyRx)[1],k=d.selected.is(h);h=d.key2ascendant.get_property(h);var q={};q[e.selected]=b&&k;q[e.ascendant]=b&&h;q[e.descendant]=b&&!h;q[e.pointer]=b;alp.setClass(l,q)}}function g(e){return"string"===
typeof e.cont?alp.gEBI(e.cont)||alp.gEBCN(e.cont)[0]:e.cont}alp.declare("alp.x.Sorthead",alp.x.AbstractController,null,{cont:null,selectable:"alp-sorthead-selectable",selectableKeyRx:/\balp-sorthead-key-(\S+)\b/,clickable:"alp-sorthead-clickable",selected:"alp-sorthead-selected",ascendant:"alp-sorthead-ascend",descendant:"alp-sorthead-descend",pointer:"oax_pointer",key2ascendant_init:null,selected_initFromDom:!0,selected_init_value:null,augmentModel:function(e){e.selected=new alp.State;e.key2ascendant=
new alp.ObjectState;e.combined=new alp.State;e.active=new alp.BoolState({init_value:!0})},setInitVal:function(e,d,b,c){e[f]=alp.gEBCN(e.selectable,g(e));b.key2ascendant.set(e.key2ascendant_init);if(e.selected_initFromDom){d=e[f];c=null;for(var a=0,h=d.length;a<h;a++){var l=d[a];if(alp.hasClass(l,e.selected)){c=l.className.match(e.selectableKeyRx)[1];break}}b.selected.set(c)}else b.selected.set(e.selected_init_value)},connectModel2Model:function(e,d,b,c){function a(){var a=b.selected.get()||"",c=a&&
!b.key2ascendant.get_property(a)?" desc":"";b.combined.set(a+c)}d.push(b.selected.change_cb_init(a));d.push(b.key2ascendant.change_cb_init(a))},connectView2Model:function(e,d,b,c){alp.forEach(e[f],function(a){var b=alp.gEBCN(e.clickable,a)[0];d.push(alp.aEL(b||a,"click",alp.bindF(k,null,e,a)))})},connectModel2View:function(e,d,b,c){d.push(b.active.change_cb_init(h,null,e));d.push(b.selected.change_cb_init(h,null,e));d.push(b.key2ascendant.change_cb_init(h,null,e))}});var f="_DOMHEAD_ARR"})();
"undefined"!==typeof dojo&&dojo.provide("alp.x.checkboxtree_model");
(function(){function k(a){a="string"===typeof a?a:this._getId(a);if(a in(alp.oGet(this.m.derived._get_no_clone()||{},"flat")||{}))return a;console.error(this.declaredClass+'.expand: unknown id "'+a+'". Ignoring it.')}function h(a){a&&this.m._vis_anim.set_property([a,"expand"],!0)}function g(a){a&&this.m._vis_anim.set_property([a,"expand"],!1)}function f(a,b){function c(b,d,p){if(b){p||(p=0);for(var r=d?a._getId(d):null,v=b.length,t=0,w=null,u;t<v;t++,w=u){var x=b[t];if(u=a._getId(x))e[u]=x,f[u]=d,
g[u]=alp.map(a._getChildren(x)||[],"this._getId(v)",a),l[u]=r,h[u]=w,m[u]=p,q[u]=n.length,n.push(u),w&&(k[w]=u),c(a._getChildren(x),x,1+p)}}}var d=b.tree._get_no_clone(),e={},f={},g={},l={},h={},k={},m={},n=[],q={};c(d&&a._getChildren(d));d=d?alp.filter(a._getChildren(d),"this._getId(v)",a):[];var p=alp.map(d,".id");b.derived.set({flat:e,parent:f,topchildren:d,topchildrenids:p,childrenids:g,parentid:l,prevsiblingid:h,nextsiblingid:k,depth:m,order:n,orderObj:q})}function e(a,b){var c=b.derived.get();
a=c?alp.arr2oSimple(alp.map(a.moreLess?c.topchildren.slice(0,a.moreLess.n):c.topchildren,"this.getId(v)",a)):{};b.visible.set(a)}function d(a,b,c,d){function e(c,e){e=!!e;var f=b.derived.get_property("parent");if(f){for(var g=c;g.length;){for(var l=[],h=g.length;h--;){var k=g[h];!!d[k]!==e&&(e?d[k]=!0:delete d[k],l.push.apply(l,a.getChildrenIds(k)))}g=l}for(h=c.length;h--;)for(g=c[h];g=f[g],g=g&&a._getId(g);)if((g||null).substring.call.a,e)d[g]=!0;else if(d[g])if(alp.and(a.getChildrenIds(g),"!this[v]",
d))delete d[g];else break}}c=c?alp.filterIn(c,""):{};d=d?alp.filterIn(d,""):{};var f=alp.oDelta(c,d);c=f.add;f=f.del;c.length?e(c,!0):f.length&&e(f,!1);return d}function b(a,b){var d=b._vis_anim.get()||{},e=a[l]||{};a[l]=d;var f=alp.oDelta(d,e);e=f.del;f=f.add;var g=m in a?a[m]:a[m]={},h=e.length;for(;h--;){var k=e[h],n=g[k];if(null!=n)clearInterval(n),delete g[k];else throw Error("bug");}b.derived._get_no_clone();f.sort(function(a,b){return a<b?-1:1});e=f.length;for(h=0;h<e;h++)k=f[h],g[k]=setInterval(alp.bindF(alp.nowF(c),
null,a,k),h+Math.min(a.vis_anim_maxinterval_ms,a.vis_anim_maxdur_ms/Math.max(1,b.derived.get_property(["childrenids",k,"length"]))));f.length&&b._vis_anim.set(d)}function c(a,b){var c=a.m,d=c._vis_anim.get_property(b);if(d){d.valueOf.call.a;var e="#<top>#"===b;!e&&a.m.derived.get_property(["parent",b]);var f=a[r]||(a[r]={}),g=a[n]||(a[n]={});f=e||("expand"in d?f[b]=d.expand:f[b]);var l=!a.moreLess||("more"in d?g[b]=d.more:g[b]);g=[].concat(c.derived.get_property(e?"topchildrenids":["childrenids",
b]));var h=c.visible.get();d=e&&"more"in d?l:f;var k=g.length;a=l?k:e||!a.moreLessTopOnly?a.moreLess.n:k;for(e=d?0:k;d?e<k:e--;d?e++:""){l=g[e];var m=!!(f&&e<a);if(!!h[l]!==m){h[l]=m;c.visible.set(h);return}}}f=c._vis_anim.get();delete f[b];c._vis_anim.set(f)}function a(a,b,c,d){c=alp.filterIn(c||{},"");d=alp.filterIn(d||{},"");if(a=b.derived._get_no_clone())for(b=alp.oDelta(c,d),c=alp.filter(b.add,"!this[ v ].length",a.childrenids),b=alp.filter(b.del,"!this[ v ].length",a.childrenids);c.length||
b.length;){for(var e=c.length;e--;)d[c[e]]=!0;for(e=b.length;e--;)delete d[b[e]];var f={},g=c.concat(b);c=[];b=[];for(e=g.length;e--;){var l=a.parentid[g[e]];!l||l in f||(f[l]=!0,!d[l]&&alp.and(a.childrenids[l],"this[v]",d)?c.push(l):d[l]&&alp.or(a.childrenids[l],"!this[v]",d)&&b.push(l))}}return d}alp.sub("alp.x",null,!0);alp.declare("alp.x.CheckboxtreeModel",alp.x.AbstractController,null,{tree_children:".category",tree_id:".id",tree_dfrd:null,selection_init:null,vis_anim_maxinterval_ms:27,vis_anim_maxdur_ms:250,
moreLess:null,moreLessTopOnly:!0,expand:alp.nowF(alp.chainF(k,h)),expandAll:alp.nowF(function(){var a=this.m.derived._get_no_clone();if(a){var b=a.order;a=a.childrenids;for(var c=b.length,d=0;d<c;d++){var e=b[d];a[e].length&&h.call(this,e)}}}),collapse:alp.nowF(alp.chainF(k,g)),collapseAll:alp.nowF(function(){var a=this.m.derived._get_no_clone();if(a){var b=a.order;a=a.childrenids;for(var c=b.length,d=0;d<c;d++){var e=b[d];a[e].length&&g.call(this,e)}}}),more:alp.nowF(alp.chainF(k,function(a){this.moreLess&&
a&&this.m._vis_anim.set_property([a,"more"],!0)})),less:alp.nowF(alp.chainF(k,function(a){this.moreLess&&a&&this.m._vis_anim.set_property([a,"more"],!1)})),moreTop:alp.nowF(function(){this.moreLess&&this.m._vis_anim.set_property(["#<top>#","more"],!0)}),lessTop:alp.nowF(function(){this.moreLess&&this.m._vis_anim.set_property(["#<top>#","more"],!1)}),setGray:function(a,b){a="string"===typeof a?a:this._getId(a);this.m.gray.set_flex_now(a,!!b)},isSelected:function(a){a="string"===typeof a?a:this._getId(a);
return!!this.m.selection.get_property(a)},setSelected:function(a,b){a="string"===typeof a?a:this._getId(a);a in(alp.oGet(this.m.derived._get_no_clone()||{},"flat")||{})?this.m.selection.set_flex_now(a,!!b):console.error(this.declaredClass+'.setSelected: unknown id "'+a+'". Ignoring it.')},getChildren:function(a){return a?[].concat(this._getChildren(this.getFromId(a))||[]):this.getTopChildren()},getChildrenIds:function(a){a="string"===typeof a?a:this._getId(a);return this.m.derived.get_property(["childrenids",
a])},getFromId:function(a){return"object"===typeof a?a:this.m.derived.get_property(["flat",a])},getId:function(a){return"string"===typeof a?a:this._getId(a)},getParent:function(a){return this.m.derived.get_property(["parent","string"===typeof a?a:this._getId(a)])},getTopChildren:function(){return this.m.derived.get_property("topchildren")||[]},setTree:function(a){this.m.tree.setNow(a);this.selection_init&&this.m.selection.setNow(this.selection_init)},augmentModel:function(b){b.tree=new alp.ObjectState;
b.derived=new alp.ObjectState;b.selection=new alp.ObjectState({constrain_all:alp.bindF(d,null,this,b)});b.lessTop=new alp.BoolState;b._vis_anim=new alp.ObjectState;b.visible=new alp.ObjectState;b.gray=new alp.ObjectState({constrain_all:alp.bindF(a,null,this,b)});b.id2count=new alp.ObjectState},setInitVal:function(a,b,c,d){a._getChildren=alp.g(a.tree_children);a._getId=alp.g(a.tree_id);a.tree_dfrd&&a.tree_dfrd.thenSoon(alp.bindF("setNow",a.m.tree));a.selection_init&&c.selection.set(a.selection_init)},
connectModel2Model:function(a,c,d,g){c.push(d.tree.change_cb_init(f,null,a,d));c.push(d.derived.change_cb_init(e,null,a,d));c.push(d._vis_anim.change_cb_init(b,null,a,d))},_TOPID:"#<top>#"});var m="_va_id2h",l="_va_prev",r="_id_2_lastexpand",n="_id_2_lastmore"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.checkboxtree");
(function(){function k(a,b){b=this.m.derived._get_no_clone();var c=this.m.visible._get_no_clone();if(b)this[alp.or(b.childrenids[a],"this[v]",c)?"collapse":"expand"](a)}function h(a,b){var c=a.m.derived._get_no_clone();return alp.reduce(alp.map(b&&c.childrenids[b]||[],"this.that.m.id2count.get_property( v )  ||  this.getCSC( this.that, v )  ||  0",{that:a,getCSC:h}),"+")||0}function g(a,b,c,d){this.setSelected(a,c);this.clickEvt().triggerSoon(a,this.isSelected(a))}function f(a,b){this.setSelected(a,
b.checked);this.clickEvt().triggerSoon(a,this.isSelected(a))}function e(a,b,c){b.checked=c.get()}function d(a,b,c,d){function e(){var e=a._getCountString(b);e=d+(e?" "+e:e);f!==e&&(f=e,alp.sA(c,"title",e))}c.offsetParent&&c.offsetLeft+c.offsetWidth>c.offsetParent.clientWidth-30&&(e(),a.m.id2count.change_cb(alp.ratelimitF(111,e)));var f}function b(a,b){var c=b.tArr;c=Math.abs(c[0].y-c[1].y);b=b.tArr_start;var d=Math.abs(b[0].y-b[1].y);Math.abs(b[0].x-b[1].x)>d||(c<.9*d?a.collapseAll():d<.9*c&&a.expandAll())}
alp.sub("alp.x",null,!0);alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.Checkboxtree",alp.x.CheckboxtreeModel,null,{cont:null,tree_title:".name",tree_iconurl:".iconUrl",contClass:"alp-x-cbt-cont",subcontClass:"alp-x-cbt-subcont",entryClass:"alp-x-cbt-entry",lastClass:"alp-x-cbt-last",lineClass:"alp-x-cbt-line",kidscontClass:"alp-x-cbt-kidscont",leaflinkClass:"alp-x-cbt-leaflink",leaflinkTopClass:"alp-x-cbt-leaflink-top",leaflinkBottomClass:"alp-x-cbt-leaflink-bottom",expandClass:"alp-x-cbt-expand",
collapseClass:"alp-x-cbt-collapse",checkboxClass:"alp-x-cbt-checkbox",labelClass:"alp-x-cbt-label",iconClass:"alp-x-cbt-icon",titleClass:"alp-x-cbt-title",countClass:"alp-x-cbt-count",grayClass:"alp-x-cbt-gray",use_styleform_checkbox:!0,view_update_maxdur_ms:100,secondLook:!1,secondLookClass:"alp-x-cbt-look2",showIcon:null,moreLess:null,moreLessClass:"alp-x-cbt-more-less",moreClass:"alp-x-cbt-more",lessClass:"alp-x-cbt-less",moreLessTextClass:"alp-x-cbt-more-less-text",clickEvt:alp.memM("clickEvt",
'alp.event("AX:CBT:clickEvt",{then:1})'),setInitVal:function(b,d,e,f){b.cont.childNodes.a;alp.setClass(b.cont,[[b.contClass,!0],[b.secondLookClass,b.secondLook]]);b._subcont=alp.cE("div",b.cont,{"class":b.subcontClass});d=b.showIcon;b._showIcon=null!=d?d:!b.secondLook;b._getTitle=alp.g(b.tree_title);b._getIconUrl=b.tree_iconurl&&alp.g(b.tree_iconurl);b[c]&&alp.forIn(b[c],"alp.orphan(v)");b[c]={};b[a]={};b[m]={};b[l]={};b[r]={};b[n]={};b[q]={};b[p]={}},connectModel2View:function(a,b,c,d){b.push(c.visible.change_cb_init(v,
null,a,c));b.push(c.gray.change_cb(v,null,a,c));b.push(c.id2count.change_cb(v,null,a,c))},connectView2Model:function(a,c,d,e){c.push(alp.touchFollow(2,a.cont,alp.bindF(b,null,a),!0))},_contNodeVisDfrd:alp.memM("_contNodeVisDfrd","alp.subDfrd(function () { var r = alp.gBCR( this.cont ); return r.width && r.height; }, this)"),_getCountString:function(a){a=(a="string"===typeof a?a:a.id)&&(this.m.id2count.get_property(a)||h(this,a));return null!=a?"("+a+")":""}});var c="_id_2_node",a="_id_2_domvis",m=
"_id_2_kidscont",l="_id_2_expandnode",r="_id_2_domgray",n="_id_2_countnode",q="_id_2_morenode",p="_id_2_lessnode",v=alp.nowF(function(b,h){function w(a,c){return function(d){alp.stopEvent(d||window.event);b[a+(c?"":"Top")](c)}}var t=h.visible._get_no_clone(),z=h.derived._get_no_clone(),A=h.selection._get_no_clone(),C=z&&z.order,E=z&&z.parentid,G=z&&z.childrenids,B=z&&z.nextsiblingid,I=z&&z.prevsiblingid;z=z&&z.topchildrenids;if(t&&C&&E&&G&&B&&I&&z)for(var L=b[c],J=b[a],P=b[m],H=b[l],F=b[r],D=b[n],
M=b[q],R=b[p],S=Date.now?Date.now():+new Date,T=C.length,Q=0;Q<T;Q++){var O=C[Q],N;if(t[O]){if(N=L[O]){var X=b._getCountString(O);alp.setText(D[O],X);J[O]||(N.style.display="",J[O]=!0)}else{N=b.getFromId(O);var V=b._getIconUrl(N),K=b._getTitle(N);X=b._getCountString(O);var U=!!E[O],W=0<G[O].length;N=alp.cE("div",null,{"class":b.entryClass+(B[O]?"":" "+b.lastClass)});U&&alp.aC(alp.cE("span",N,{"class":b.leaflinkClass}),alp.cE("span",null,{"class":b.leaflinkTopClass}),alp.cE("span",null,{"class":b.leaflinkBottomClass}));
U=W&&alp.cE("span",N,{"class":b.expandClass});var Y=alp.cE("span",N,{"class":b.lineClass}),aa=alp.newId("alp-x-cbt-"+(u=1+(u|0))),Z=alp.cE("input",Y,{type:"checkbox",id:aa,"class":(b.checkboxClass||"")+(b.use_styleform_checkbox?" alp-styleform-styled":"")});aa=alp.cE("label",Y,{"class":b.labelClass,"for":aa});b._showIcon&&V&&alp.cE("img",aa,{"class":b.iconClass,src:V});V=alp.aC(alp.cE("span",aa,{"class":b.titleClass}),alp.cTxN(K));alp.aC(aa,alp.cTxN(" "));X=alp.aC(alp.cE("span",Y,{"class":b.countClass}),
alp.cTxN(X));alp.or(G[O],"this[v]",t)&&alp.setClass(U,b.collapseClass,!0);A[O]?(alp.sA(Z,"checked","checked"),Z.checked=!0):Z.checked=!1;H[O]=U;P[O]=W?alp.cE("div",N,{"class":b.kidscontClass}):null;D[O]=X;U&&alp.aEL(U,"click",alp.bindF(k,b,O,U));var ba=alp.partState(h.selection,O,{ctor:alp.BoolState});b.use_styleform_checkbox?alp.styleform.init({now:!0,cont:{input:[Z]},labelCont:N,oncheck_init:function(){return ba},oncheck:alp.nowF(alp.bindF(g,b,O))}):(alp.aEL(Z,"click",alp.nowF(alp.bindF(f,b,O,Z))),
ba.change_cb(alp.bindF(e,b,O,Z,ba)));X=I[O];U=E[O];W=X&&L[X];X=!X&&(U?P[U]:b._subcont);(W||X).childNodes.a;W?alp.place(N,W,"after"):alp.aC(X,N);b._contNodeVisDfrd().then(alp.bindF(d,null,b,O,V,K));L[O]=N;J[O]=!0}b.moreLess&&(N=(U=!!E[O])?E[O]:b._TOPID,K=U?G[N]:z,V=U?P[N]:b._subcont,W=b.moreLess.n,W.toPrecision.call.a,!(K.length>W)||b.moreLessTopOnly&&U||(M[N]||(alp.aC(M[N]=alp.cE("div",V,{style:"display: none;","class":b.moreLessClass+" "+b.moreClass}),alp.cE("div",null,{style:"clear: both;"}),alp.cE("span",
null,{"class":"alp-x-cbt-expand"}),alp.cE("span",null,{"class":b.moreLessTextClass},{innerHTML:b.moreLess.more}),alp.cE("div",null,{style:"clear: both;"})),alp.aEL(M[N],"click",w("more",U&&N))),R[N]||(alp.aC(R[N]=alp.cE("div",V,{style:"display: none;","class":b.moreLessClass+" "+b.lessClass}),alp.cE("div",null,{style:"clear: both;"}),alp.cE("span",null,{"class":"alp-x-cbt-expand alp-x-cbt-collapse"}),alp.cE("span",null,{"class":b.moreLessTextClass},{innerHTML:b.moreLess.less}),alp.cE("div",null,{style:"clear: both;"})),
alp.aEL(R[N],"click",w("less",U&&N))),K=t[K[W]],alp.style(M[N],"display",K?"none":""),alp.style(R[N],"display",K?"":"none")))}else(N=L[O])&&J[O]&&(N.style.display="none",J[O]=!1);K=!!h.gray.get_property(O);V=!!F[O];(N=L[O])&&K!==V&&alp.setClass(N,b.grayClass,F[O]=K);if(O=(N=E[O])&&H[N])N=alp.or(G[N],"this[v]",t),N!==alp.hasClass(O,b.collapseClass)&&alp.setClass(O,b.collapseClass,N);if((Date.now?Date.now():+new Date)-S>b.view_update_maxdur_ms){alp.asyncF(b.view_update_maxdur_ms,v)(b,h);break}}else alp.asyncF(b.view_update_maxdur_ms,
v)(b,h)}),u})();"undefined"!==typeof dojo&&dojo.provide("alp.x.map_content_panel");
(function(){function k(c,a,f,g,h){function l(a,b){var c=a.id;b&&c&&((u[b]||(u[b]={}))[c]=1);a=a.category||[];if(a.length)for(var d=a.length;d--;)l(a[d],b||c);else b&&((r[c]||(r[c]=[])).push(b),(t[b]||(t[b]={}))[c]=1)}function k(a,b){function c(a){var b=a.id;b in d&&(d[b]=e);e++;(a=a.category)&&alp.forEach(a,"this(v)",c)}var d=alp.arr2o(b,"id",alp.f("1")),e=0;c(a);return alp.arrSorted(b,function(a,b){return d[b.id]-d[a.id]})}function m(a){function b(a){c[a.id]=!0;a.category&&(a.category=alp.filter(a.category,
"!(v.id in this)",c),alp.forEach(a.category,b))}var c=this;b(a)}if(a===c._treeFetchDfrd){a=alp.filter(alp.map(f.category,'v.id ? v : alp.mix({},v,{id:v.id || ("block#" + i + "#" + v.name)})'),'v.category  &&  v.category.length  ?  true  :  (console.error("MCP:a block must have children - "+v.name),false)');if(c.aCatAppearsOnlyOnce){alp.forEach(k(f,a),m,{});for(g=a.length;g--;)h=a[g],h.category&&h.category.length||(console.error("MapContentPanel: removing empty block (probably because of duplicate cats that were removed, see trac#13418)",
h),a.splice(g,1));a=alp.filter(a,".category.length")}var r={},u={},t={};alp.forEach(a,function(a){l(a)});var w=alp.arr2o(a,"id",function(a,b){return!!c._blockInd_2_initChecked[b]});g=alp.mapIn(r,"false");e(g,w,c.initCheckedIds,r,f);d(g,w,u);var x=c.m;x.blockarr.set(a);x.idleaf2blockidarr.set(r);x.blockid2idset.set(u);x.idblock2checked.set(w);x.idleaf2checked.set(g);alp.empty(c._mcpNode);alp.forEach(c._kx_tree_arr||[],".disconnect()");c._kx_tree_arr=alp.map(a,function(a){function e(){return alp.filterIn(c.m.idleaf2checked._get_no_clone(),
"w in this",t[a.id])}var f,g,l=alp.aC(alp.cE("div",null,{"class":c.mcpSectionClass}),alp.aC(alp.cE("div",null,{"class":c.mcpSectionTitleClass}),alp.aC(alp.cE("label",null),f=alp.cE("input",null,{type:"checkbox"}),alp.cE("span",null,null,{innerHTML:a.name}))),alp.cE("div",null,{"class":"oax_clear"}),g=alp.cE("div"),alp.cE("div",null,{"class":"oax_clear"}));w[a.id]&&alp.sA(f,"checked","checked");var h=alp.partState(c.m.idblock2checked,a.id);alp.styleform.init({now:!0,cont:{input:[f]},oncheck_init:function(){return h},
oncheck:function(c,e,f){e=!!e;c=x.idleaf2checked.get()||{};f=x.idblock2checked._get_no_clone();var g=x.blockid2idset._get_no_clone(),l=g[a.id]||{};if(e)d(c,f,g);else for(var h in l)h in b||(c[h]=e);x.idleaf2checked.setNow(c)}});var k=new alp.x.Checkboxtree({cont:g,initNow:!0,use_styleform_checkbox:!0,selection_init:e(),secondLook:c.cbtreeSecondLook,moreLess:c.cbtreeMoreLess});k.setTree(a);k.clickEvt().then(alp.ratelimitF(97,alp.nowF(function(){var d=k.m.selection._get_no_clone(),e=c.m.idleaf2checked.get(),
f;for(f in t[a.id])f in b||(f in d?e[f]=d[f]:f in e&&delete e[f]);c.m.idleaf2checked.set(e);d=!1;for(f in t[a.id])if(!(f in b)&&e[f]){d=!0;break}h.set(d)})));c.m.idleaf2checked.change_cb(alp.ratelimitF(71,alp.nowF(function(){k.m.selection.mixin(e())})));alp.aC(c._mcpNode,l);c.m.id2viscount.change_cb(alp.ratelimitF(53,alp.nowF(function(){var b=c.m.id2viscount._get_no_clone();b=b&&alp.filterIn(b,"w in this",u[a.id]);k.m.id2count.set(b)})));return k});c.newTreeEvt().triggerSoon(f)}}function h(c){var a=
c.m.idleaf2checked._get_no_clone(),d=c.m.idleaf2blockidarr._get_no_clone(),e=c.m.idblock2checked._get_no_clone(),f={},g;for(g in a)if(!(g in b)&&a[g]){var h=d[g];if(h&&h.length)for(var k=h.length;k--;)if(e[h[k]]){f[g]=!0;break}}c.m.idleaf2selected.set(f)}function g(b,a,d,e){b=alp.oDelta(d||{},e||{});alp.forEach(b.add,"this.cL.setCatSelected(v,this.sel[v])",{cL:a,sel:d});alp.forEach(b.del,"this.setCatSelected(v,false)",a)}function f(b,a){alp.forIn(b.m.idleaf2selected._get_no_clone()||{},"this.setCatSelected(w,v)",
a)}function e(b,a,d,e,f){function c(d,f){var l=d.id;f||(f=g[l]);var h=(d=d.category)&&d.length;if(h)for(l=h;l--;)c(d[l],f);else f&&l&&(b[l]=!0,alp.forEach(e[l],"this[v]=true",a))}if(d){var g=alp.arr2oSimple("string"===typeof d?d.split(","):d);c(f)}}function d(c,a,d){var e=[],f;for(f in a)if(!(f in b)&&a[f]){var g=alp.oKeys(d[f]);alp.or(g,"this[v]",c)||e.push(g)}for(a=e.length;a--;)alp.forEach(e[a],"this[v]=true",c)}var b={};alp.declare("alp.x.MapContentPanel",alp.x.AbstractController,null,{proj:null,
toggle:null,mcpCatList:null,mcpInitList:"",cont:null,toggleSelected:"oax-selected",mlp:null,aCatAppearsOnlyOnce:!0,mcpClass:"oax-mcp",mcpSectionClass:"oax-mcp-section",mcpSectionTitleClass:"oax-mcp-section-title",mcpSectionItemClass:"oax-mcp-section-item",cbtreeSecondLook:!0,cbtreeMoreLess:null,initCheckedIds:null,onNewTreeEvt:null,bindClusterLayer:function(b){var a=this;a.unbindClusterLayer(b);var c=new alp.Eh;c.push(a.m.idleaf2selected.change_cb(g,null,a,b));f(a,b);c.push(b.listen("visibleCatCountChange",
function(b){a.m.id2viscount.set(b)}));a._cL2eh().setNow(b,c)},unbindClusterLayer:function(b){alp.m(this._cL2eh().delNow(b),"clear")},newTreeEvt:alp.memM("newTreeEvt",'alp.event("newTreeEvt",{then:1})'),augmentModel:function(b){this.onNewTreeEvt&&this.newTreeEvt().then(this.onNewTreeEvt);(this.proj||0).substring.call.a;this.toggle.childNodes.a;(this.mcpCatList.substring||this.mcpCatList.splice).call.a;this._mcpCatArr=this.mcpCatList?alp.filter("string"===typeof this.mcpCatList?this.mcpCatList.split(","):
this.mcpCatList,""):[];this._mcpInitChecked=this.mcpInitList?alp.arr2oSimple(alp.filter("string"===typeof this.mcpInitList?this.mcpInitList.split(","):this.mcpInitList,"")):{};for(var a=this._blockInd_2_initChecked={},c=this._mcpCatArr.length;c--;)this._mcpInitChecked[this._mcpCatArr[c]]&&(a[c]=!0);b.blockarr=new alp.State;b.idleaf2blockidarr=new alp.ObjectState;b.blockid2idset=new alp.ObjectState;b.idblock2checked=new alp.ObjectState;b.idleaf2checked=new alp.ObjectState;b.idleaf2selected=new alp.ObjectState;
b.clusterLayer=new alp.State;b.isOpen=new alp.BoolState;b.id2viscount=new alp.ObjectState},augmentKids:function(b){this._mcpNode=alp.cE("div",null,{"class":this.mcpClass});this.cont?(this._mcpNode.style.display="none",alp.aC(this.cont,this._mcpNode)):alp.view.tooltip({select:this.toggle,extract:this._mcpNode,className:"alp-view-tooltip oax-mcp-tooltip-wrapper",top_wrap:"oax",min_width:!1,x_prop:0,dom_event_open:"click",dom_event_close:"click",open_toggle:!0,isOpenState:this.m.isOpen})},setInitVal:function(b,
a,d,e){alp.setProp(this._mcpNode,"innerHTML","");d.blockarr.set()},connectModel2Model:function(b,a,d,e){function c(){d.isOpen.get()&&l.m.isOpen.get()&&l.m.isOpen.setNow(!1)}function f(){l.m.isOpen.get()&&d.isOpen.get()&&d.isOpen.setNow(!1)}var g=alp.ratelimitF(111,alp.nowF(h),null,b);alp.forEach(["idblock2checked","idleaf2checked","idleaf2blockidarr","blockid2idset"],function(b){a.push(d[b].change_cb(g))});var l=b.mlp;l&&(a.push(d.isOpen.change_cb(c)),a.push(l.m.isOpen.change_cb(f)))},connectModel2View:function(b,
a,d,e){function c(){var a=d.isOpen.get();b._mcpNode.style.display=a?"":"none";b.cont&&b.toggleSelected&&alp.setClass(b.toggle,b.toggleSelected,a);(a||b.mcpInitList&&0<b.mcpInitList.length||b.initCheckedIds)&&!b._treeFetchDfrd&&(a=b._mcpCatArr,a=(a.length?"/"+alp.map(a,'+","'):"")+"/pruned",a=b._treeFetchDfrd=alp.data.api_cat_mcp({project:b.proj,extra:a}),a.thenSoon(alp.bindF(k,null,b,a)))}b.cont&&a.push(d.isOpen.change_cb_init(c))},connectView2Model:function(b,a,d,e){function c(){d.isOpen.setNow(!d.isOpen.get())}
b.cont&&a.push(alp.aEL(b.toggle,"click",c))},_cL2eh:alp.memM("_cL2eh","alp.mapany()")})})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.tilebound_arr_of_bound_arr");
(function(){function k(d,b){d=Math.max(0,Math.min(b,d));(isFinite(d)&&d).toPrecision.call.a;return d}var h=alp.sub("alp.maps",null,!0),g=h.project_SM,f=Math.PI,e=2*f;h.tilebound_arr_of_bound_arr=function(d,b,c,a){d.toPrecision.call.a;b.toPrecision.call.a;var h=a&&a.tile_y_downward;null==h&&(h=!0);return alp.map(c,function(a){var c=a[0],l=a[1];a=c[0];var m=c[1];c=l[0];l=l[1];a.toPrecision.call.a;l.toPrecision.call.a;-180<=a&&a<=c&&180>=c&&-90<=m&&m<=l&&90>=l||null.wrong_lat_lng_values;m=g({lng:a,lat:m});
a=(m.x+f)/e;m=(m.y+f)/e;c=g({lng:c,lat:l});l=(c.x+f)/e;var p=(c.y+f)/e;h&&(m=1-m,p=1-p);c=Math.min(a,l);a=Math.max(a,l);l=Math.min(m,p);m=Math.max(m,p);p=[];for(var v=d;v<=b;v++){var u=1<<v,t=u-1,w=Math.floor(l*u),x=Math.ceil(a*u),y=Math.ceil(m*u);p[v]={xmin:k(Math.floor(c*u),t),ymin:k(w,t),xmax:k(x,t),ymax:k(y,t)}}return{tilebbox_of_z:p}})}})();"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.util.maybe_mt_of_mapconfig");
alp.gmap3(function(k){function h(e){var d=e.source,b=e["short"],c=e["long"],a=e.link;if(!d||!a)console.error("maybe_mt_of_mapconfig: missing source/link in attribution",e);else if(!(d in this))return this[d]=!0,{copy_id:d,attrMap:{href:a,target:"_blank",title:c||b},propMap:{innerHTML:b||c}}}var g=alp.gmap3,f=alp.maps.tilebound_arr_of_bound_arr;g.maybe_mt_of_mapconfig=function(e,d,b,c){function a(a,b,c,d){function e(a,b){var c=a.x;a=a.y;b={x:c,y:a,s:0<p&&n.charAt((c+a)%p),z:b};return alp.tmplWithoutDollar(f,
b)}var f=(c.tiles||c.tileUrlTemplates||[])[0];if(f&&"string"===typeof f){var g=c.minZoom||0,k=c.maxZoom||18;b=c.title||c.name||b;var m=c.subtitle||"",n=c.subdomains||"",p=n.length,q=new a.Size(256,256);a=new a.ImageMapType({getTileUrl:e,minZoom:g,maxZoom:k,name:b,alt:m,tileSize:q});c=alp.filter(alp.map(c.attributions||[],h,l),"");a._alp_custom_name=b;a._alp_imtcfg_arr=[{getTileUrl:a.getTileUrl,isPng:!0,minZoom:g,maxZoom:k,name:b,tileSize:q,copy_arr_def:c,vector_mtcfg:d||null}];return a}}if(b._oa_google_mtid)return!1;
c=b.raster.rasterStack;var k=b._enableVector&&b;c||null.bug;var l={};return new g.MixMapType(alp.map(k?c.slice(0,1):c,function(b,c){c={maptype:a(e,d+":"+c,b,k)};var h=b.bounds||null,l=b.minZoom,m=b.maxZoom,n=null;h&&(isFinite(l)&&isFinite(m)?n=f(l,m,[h]):console.error("AG3.maybe_mt_of_mapconfig: for `bounds` you must also provide`minZoom` and `maxZoom`."));h={tilebound_arr:n};b=b.tilelistUrl||null;c.layermask=b?g.layermask(b,"json",h):g.layermask(g.layermask.TRANSPARENT,null,h);return c}),{border_heuristic:!0})}});
"undefined"!==typeof dojo&&dojo.provide("alp.gload_gmap.cfg");(function(){"undefined"===typeof alp&&Object.defineProperty(window,"alp",{value:{},writable:!1});var k=alp.gload_gmap||(alp.gload_gmap={});if(!k.MapTypeId){var h=k.MapTypeId={ROADMAP:"roadmap",SATELLITE:"satellite",HYBRID:"hybrid",TERRAIN:"terrain"},g=k.MapTypeIdValuesArr=[];k=k.MapTypeIdValuesSet={};for(var f in h)if(h.hasOwnProperty(f)){var e=h[f];g.push(e);k[e]=1}}})();
"undefined"!==typeof dojo&&(dojo.provide("oa.cfg.cfg_flexview"),dojo.require("alp.cfg.maptypeid"),dojo.require("alp.gload_gmap.cfg"));
(function(){function k(b){if("object"===typeof b){var a={};alp.forIn(b,function(a,b){this[k(b)]=a},a);return a}/^alpstein_/.test(b)&&(a=b,b=b.replace(/^alpstein_/,"oa_"),console.error('"'+a+'" is deprecated. Please rename it to "'+b+'"'));a=/^satellite$/i.test(b);var c=/^(hybrid|oa_hybrid)$/i.test(b),d=alp.sub("oa.API_CFG");return!a&&!c||!d||d.gmapkey||d.gmapclientid?a=e("skiresort_transp"===b?"skiresort":"avalanche_transp"===b?"slope":b):a?"oa_mb_satellite":"oa_mb_satellite_streets"}function h(b){return alp.filter(b,
function(a){return"string"!==typeof a?a:a in this?"":this[a]=a},{})}function g(b){var a=alp.sub("alp.gload_gmaps.MapTypeId")||{roadmap:1,satellite:1,hybrid:1,terrain:1},c=alp.sub("oax.API_CFG");c&&"mini"!==c.build&&c.leaflet_gshim&&!c.gmapkey&&!c.gmapclientid&&"function"!==typeof alp.sub("google.maps.Map")&&(c=b.maplayer.basemap,c.layer=alp.filter(c.layer,"!(v in this  ||  /^hybrid$/.test(v))",a));return b}var f=alp.sub("oa.cfg",null,!0),e=alp.cfg.maptypeid.get_new_mtid,d=alp.maps.mapconfig;f.BM_CENTER=
"maplayer.basemap.center";f.ovmtids_filter=function(b,a){function c(b){return"string"===typeof b?b:"string"===typeof b.except&&b.except!==a||"object"===typeof b.except&&!b.except[a]||"string"===typeof b.only&&b.only===a||"object"===typeof b.only&&b.only[a]?b.name:!1}return alp.mapIn(b,function(a,b){return alp.filter(alp.map(a,c),"")})};var b=alp.sub("cfg_flexview",f,!0);b.fill_default_and_fix_backward_compatibility=function(c,a){c=b.fix_backward_compatibility(alp.oCreateDeepFill(c,a?oa.cfg.cfg_flexview.gm2DEFAULT(a):
oa.cfg.cfg_flexview.DEFAULT));c=g(c);(a=oa._MAPCONFIG)&&(a=d.mtids(a))&&0<a.length&&(alp.oSet(c,"maplayer.basemap.layer",a),alp.oGet(c,"maplayer.basemap.init")||alp.oSet(c,"maplayer.basemap.init",a[0]));/(?:[\?&]metgis=1(?:&|$))/.test(location.search)&&alp.oSet(c,"maplayer.mapoverlay.layer",alp.oGet(c,"maplayer.mapoverlay.layer").concat(["oa_metgis_weather","metgis_cloudiness","metgis_precipitation","metgis_temperature"]));return c};b.gm2DEFAULT=function(c){return alp.oCopy(b.DEFAULT,!0,function(a,
b){return a&&"string"===typeof a&&/^ControlPosition\./.test(a)?alp.sub(a,c):a})};b.fix_backward_compatibility=function(b){var a=b.maplayer,c=a.basemap;a=a.mapoverlay;c.init=k(c.init);c.layer=h(alp.filter(alp.map(c.layer,k),'!=="earth_plugin"'));a&&a.init&&(a.init=k(a.init));a.layer=h(alp.map(a.layer,k));return g(b)};b.fix_backward_compatibility_maptypeid=k;b.DEFAULT={where:{selected_init:"",area_filtering:!0},maplayer:{basemap:{layer:"oa_map oa_map_winter oa_mb_satellite satellite oa_mb_satellite_streets oa_hybrid oa_topo oa_osm oa_osm_winter".split(" "),
init:"oa_map",center:[12.1,47.8],zoom:9,bbox:null,scrollwheel:!0,disableDoubleClickZoom:!1,mapTypeControl:!1,panControl:!0,panControlOptions:{position:"ControlPosition.RIGHT_TOP"},streetViewControl:!0,streetViewControlOptions:{position:"ControlPosition.RIGHT_TOP"},zoomControl:!0,zoomControlOptions:{position:"ControlPosition.RIGHT_TOP"},scaleControl:!0,scaleControlOptions:{position:"ControlPosition.BOTTOM"},oa:{earth:!0,mapButton3d:!1,mapButton2d:!0,autoResize:!0}},mapoverlay:{layer:"panoramio weather slope skiresort hiking horseback longDistanceHiking cycling longDistanceCycling mountainbiking transalpMountainbiking".split(" "),
init:null},clusterlayer:{base_url:oa.SERVER+"${locale}/",init:{winterHiking:!0,sledging:!0,snowshoeing:!0}}},maplayerpanel:[{type:"geocoder"},{type:"basemap",minimum:3},{type:"mapoverlay",minimum:3,order:["wikipedia","avalanche","skiresort","routing_*"]}]}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.map_layer_panel");
(function(){function k(a,b,c,d,e,f){function g(b){e.thenSoon(function(d){function e(b){for(var c=b;!alp.hasClass(c,a.mlpSectionItemClass);c=c.parentNode);alp.style(c,{display:f[b.value]?"none":""})}d=d[b+"_form"];var f=c[b+"2hide"].get()||{};d&&alp.forEach(d.elements,e)})}a._mlpNodeFull===e&&(b.push(c.basemap.change_cb_init(function(a){d.basemap[a].set(!0)})),b.push(c.basemap2hide.change_cb_init(g,null,"basemap")),b.push(c.mapoverlay2hide.change_cb_init(g,null,"mapoverlay")))}function h(a,b,c,e,f,
g){function h(){c.isOpen.setNow(!c.isOpen.get())}function l(){var b=c.isOpen.get();g.mlpNode.style.display=b?"":"none";a.cont&&a.toggleSelected&&alp.setClass(a.toggle,a.toggleSelected,b)}function k(d,e){e&&(d=e);e={m:{maptypeid:c.basemap,maptypecfg:c.maptypecfg||null,overlayidset:c.mapoverlay,overlaycfg:c.mapoverlaycfg||null},maptypeids:a._cfg_basemap.layer,mapoverlay:{layer:a._cfg_mapoverlay.layer,init:c.mapoverlay.get()}};a[q]&&null.bug;a[q]=new m({mapconfig:d,toggleNode:a.toggle,withoutMapOverlay:a.withoutMapOverlay,
mapboss:e,initNow:!0});b.push(a[q].m.isOpen.bind_to(c.isOpen))}if(a._mlpNodeFull==f){alp.forIn(e.basemap,function(a,d){b.push(a.change_v_cb(!0,function(){c.basemap.set(d)}))});alp.forIn(e.mapoverlay,function(a,d){b.push(a.change_cb(function(a){c.mapoverlay.set_property(d,a)}))});var m=alp.m(a,"newMlpCtorF");m?a[n]||(a[n]=!0,d().then(k)):a.cont?(g.mlpNode.style.display="none",alp.aC(a.cont,g.mlpNode),b.push(alp.aEL(a.toggle,"click",h)),b.push(c.isOpen.change_cb_init(l))):alp.view.tooltip({select:a.toggle,
extract:g.mlpNode,className:"alp-view-tooltip oax-mlp-tooltip-wrapper",top_wrap:"oax",min_width:!1,x_prop:0,dom_event_open:"click",dom_event_close:"click",open_toggle:!0,isOpenState:c.isOpen})}}function g(a,b,c){function d(a){a=a.currentTarget;u[a.value].setNow(a.checked)}function e(b){if(!v[b])throw Error('map layer panel: unknown id "'+b+'". Did you mean "'+alp.oKeyFind(v,b)+'"?');var d=c?c["maplayer_"+b]||c["maplayer_"+b.replace(/_transp\b/,"")]||c[b]:"id:"+b+" (i18n missing)",e=alp.cE("div",p,
{"class":a.mlpSectionItemClass}),f=alp.newId("oax-mlp-ov-"+r++),g=q[b],h=alp.cE("input",e,{id:f,type:"checkbox",name:l,value:b,"class":a.clickableClass},{checked:g});alp.cTxN(" ",e);d.substring.call.a;alp.cE("label",e,{"for":f,"class":a.clickableClass},{innerHTML:d});u[b]=new alp.ObjectState({init_value:g});return h}if(a._mlpNodeFull==b){b=alp.cE("div",null,{"class":a.mlpClass});var f=alp.cE("div",b,{"class":a.mlpSectionClass});alp.cE("div",f,{"class":a.mlpSectionTitleClass},{innerHTML:c&&c.mlp_maptype_title||
"MLP (i18n missing)"});var g=alp.oGet(a._cfg,"maplayer.basemap"),h=alp.cE("form",f),k=a.m.basemap.get(),n=a.kx.basemap||(a.kx.basemap={});f=alp.map(g.layer,function(b){var d="mlp_mt_"+b;!c||d in c||(d="mlp_mt_"+(/^alpstein_/.test(b)?b.replace(/^alpstein_/,"oa_"):/^oa_/.test(b)?b.replace(/^oa_/,"alpstein_"):b));d=c&&c[d]||b+" (i18n missing)";var e=alp.cE("div",h,{"class":a.mlpSectionItemClass}),f=alp.newId("oax-mlp-mt-"+r++),g=b===k,l=alp.cE("input",e,{id:f,type:"radio",name:m,value:b,"class":a.clickableClass},
{checked:g});alp.cTxN(" ",e);d.substring.call.a;alp.cE("label",e,{"for":f,"class":a.clickableClass},{innerHTML:d});n[b]=new alp.BoolState({init_value:g});return l});alp.aEL(f,"change",function(a){a=a.currentTarget;n[a.value].setNow(a.checked)});alp.forEach(f,function(a){var b=n[a.value];b.change_v_cb(!0,function(){a.checked=b.get();alp.forIn(n,'(w !== "'+a.value+'" && v.setNow( false ))')})});if(!a.withoutMapOverlay&&!a.newMlpCtorF){f=alp.cE("div",b,{"class":a.mlpSectionClass});alp.cE("div",f,{"class":a.mlpSectionTitleClass},
{innerHTML:c&&c.mlp_mapoverlay_title||"overlay (i18n missing)"});g=alp.oGet(a._cfg,"maplayer.mapoverlay");var p=alp.cE("form",f),q=a.m.mapoverlay.get(),v=alp.oCreateMix(alp.gmap3.cfg.ImageMapTypeOptions,{panoramio:1,weather:1,oa_metgis_weather:1}),u=a.kx.mapoverlay||(a.kx.mapoverlay={});f=alp.map(g.layer,e);alp.aEL(f,"change",d);alp.forEach(f,function(a){var b=u[a.value];b.change_cb(function(){a.checked=b.get()})})}a._mlpNodeFull.triggerSoon({mlpNode:b,basemap_form:h,mapoverlay_form:p})}}var f=alp._gmap2_3,
e=alp.gmap3,d=alp.data.api.get_mapconfig_paid_dfrd,b=alp.dfrd("mlp i18n",{then:1}),c=oa.cfg.cfg_flexview.DEFAULT;(function(a){alp.i18n.fetch("alp.all").then(function(b){a.triggerSoon(b)})})(b);alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.MapLayerPanel",alp.x.AbstractController,null,{toggle:null,withoutMapOverlay:!1,newMlpCtorF:function(){return alp.sub("oa.x.MapLayerPanel")},newMlpMaybeDfrd:alp.memM("newMlpMaybeDfrd",'alp.m(this, "newMlpCtorF")  &&  alp.subDfrd( "_new_mlp", this )'),
cont:null,toggleSelected:"oax-selected",cfg:null,mlpClass:"oax-mlp",mlpSectionClass:"oax-mlp-section",mlpSectionTitleClass:"oax-mlp-section-title",mlpSectionItemClass:"oax-mlp-section-item",clickableClass:"alp-x-clickable",specialMapTypId_3d:"earth_plugin",autoHidePanoramioWeather:!0,close:function(){function a(a){a.close()}alp.m(this,"newMlpCtorF")?alp.subDfrd(q,this).then(a):this.m.isOpen.setNow(!1)},augmentModel:function(a){function b(b){a.mapoverlay2hide.mixin({panoramio:1,weather:1})}this._cfg=
alp.oCreateDeepFill(this.cfg||{},c);var d=this._cfg_basemap=alp.oGet(this._cfg,"maplayer.basemap"),e=this._cfg_mapoverlay=alp.oGet(this._cfg,"maplayer.mapoverlay");a.basemap=new alp.StringState({init_value:d.init});a.maptypecfg=new alp.ObjectState;a.mapoverlay=new alp.ObjectState({init_value:alp.oCreate(e.init)});a.basemap2hide=new alp.ObjectState;a.mapoverlay2hide=new alp.ObjectState;this.autoHidePanoramioWeather&&alp.gmap3(b);a.isOpen=new alp.BoolState},augmentKids:function(a){var c=this;c._mlpNodeFull=
alp.dfrd("mlpNode full",{then:1});alp.subDfrd("alp.gmap3.cfg").then(function(){b.then(alp.bindF(g,null,c,c._mlpNodeFull))})},connectModel2View:function(a,b,c,d){function e(){alp.subDfrd(q,a).then(function(a){c.isOpen.get()^a.isOpened()&&a.toggle()})}alp.m(a,"newMlpCtorF")?b.push(c.isOpen.change_cb(e)):this._mlpNodeFull.then(alp.bindF(k,null,a,b,c,d,this._mlpNodeFull))},connectView2Model:function(a,b,c,d){this._mlpNodeFull.then(alp.bindF(h,null,a,b,c,d,this._mlpNodeFull))},setMap:function(b){function c(){function a(a){var f;
d&&(f=e.maybe_mt_of_mapconfig(a,c,d));f?b.mapTypes.set(c,n[c]=f):!1!==f&&console.error("alp.x.MLP failed to create maptype",f)}var c=l.m.basemap.get(),d=l.m.maptypecfg.get();if(c&&d){n||(n={});n[c]||alp.gmap3(a);var f=d._oa_google_mtid?c.replace(/^google#/,""):c;b.setMapTypeId(f)}}function d(){l.m.basemap.setNow(b.getMapTypeId())}function g(){var a=l.m.basemap.is(l.specialMapTypId_3d);alp.m(b,"set3d",a)}function h(){var a=l.m.basemap;a.is(l.specialMapTypId_3d)&&a.set(a.getPrevious())}var l=this,k=
l._map_eh||(l._map_eh=new alp.Eh);k.clear();l[a]=null;if(b){l[a]=b;alp.m(l,"newMlpCtorF")?(k.push(l.m.basemap.change_cb_init(c)),k.push(l.m.maptypecfg.change_cb(c)),setTimeout(c,1E3),setTimeout(c,2E3)):(d(),k.push(f.event("addListener")(b,"maptypeid_changed",d),f.event("removeListener")),k.push(l.m.basemap.change_cb(function(a){b.setMapTypeId(a)})));var m=b.stVis3d;m&&(k.push(l.m.basemap.change_cb_init(g)),k.push(m.change_v_cb(!1,h)))}var n},setMapTypeId:function(b,c){function d(a){a._setMaptypeid(b,
c)||e()}function e(){alp.m(f[a],"setMapTypeId",b)}var f=this;alp.m(f,"newMlpCtorF")?alp.subDfrd(q,f).then(d):e()}});var a="_map",m="oax-mlp-maptype",l="oax-mlp-mapoverlay",r=0,n="_new_mlp_created",q="_new_mlp"})();"undefined"!==typeof dojo&&dojo.provide("oa.util.locstor");
(function(){function k(){return{storage:alp.localStorage()||alp.sessionStorage()}}var h=alp.sub("oa.util.locstor",0,1),g=oa.util.sestor;h.last_visited_get=function(){return g.last_visited_get(k())};h.last_visited_push=function(f){return g.last_visited_push(f,k())};h.last_visited_set=function(f){return g.last_visited_set(f,k())}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_map_content_panel");
(function(){function k(b,a,d){function c(a){var b=this.pid,d=a.id;a=a.category;b&&((t[d]||(t[d]=[])).push(b),(w[b]||(w[b]=[])).push(d));a&&alp.forEach(a,c,{pid:d})}function h(a,b){var c=a.id;b&&c&&((y[b]||(y[b]={}))[c]=1);a=a.category||[];if(a.length)for(var d=a.length;d--;)h(a[d],b||c);else b&&((x[c]||(x[c]=[])).push(b),(z[b]||(z[b]={}))[c]=1)}function k(a,b){function c(a){var b=a.id;b in d&&(d[b]=e);e++;(a=a.category)&&alp.forEach(a,"this(v)",c)}var d=alp.arr2o(b,"id",alp.f("1")),e=0;c(a);return alp.arrSorted(b,
function(a,b){return d[b.id]-d[a.id]})}function m(a){function b(a){c[a.id]=!0;a.category&&(a.category=alp.filter(a.category,"!(v.id in this)",c),alp.forEach(a.category,b))}var c=this;b(a)}d.category.length!==a._mcpCatArr.length&&console.error("MCP: received tree.category.length differs from `mcpCatList` length, which you might want to edit (else `mcpInitList` might not always work properly)",d.category,a._mcpCatArr);var p=alp.map(d.category,'v.id ? v : alp.mix({},v,{id:v.id || ("block#" + i + "#" + v.name)})');
if(a.aCatAppearsOnlyOnce){alp.forEach(k(d,p),m,{});var v=p.length;if(1<v)for(;v--;){var u=p[v];u.category&&u.category.length||(console.error("MapContentPanel: removing empty block (probably because of duplicate cats that were removed, see trac#13418)",u),p.splice(v,1))}p=alp.filter(p,"!v.category  ||  v.category.length")}var t={},w={};alp.forEach(p,c,{pid:null});var x={},y={},z={};alp.forEach(p,function(a){h(a)});v=alp.arr2o(p,"id",function(b,c){return!!a._mcpInitBlockIndCheckedSet[c]});u=alp.mapIn(alp.filterIn(t,
".length > 0"),"false");f(u,v,a.mcpInitCheckedIds,x,t,y,d);g(u,v,y);var A=alp.oCopy(u),C=alp.oCopy(v),E=a.m;e.set(b,E.original_tree,d);e.set(b,E.blockarr,p);e.set(b,E.id2parentids,t);e.set(b,E.id2childrenids,w);e.set(b,E.idleaf2blockidarr,x);e.set(b,E.blockid2idset,y);e.set(b,E.idblock2checked,v);e.set(b,E.idkid2checked,u);e.set(b,E.idblock2anychecked,C);e.set(b,E.idkid2anychecked,A);e.trigger(b,a.newTreeEvt(),d)}function h(b,a){var c=b.m.idkid2checked._get_no_clone(),d=b.m.id2childrenids._get_no_clone(),
f={};alp.forEach(alp.oKeys(c),function(a){f[a]=c[a]?d[a]?1:2:0});e.set(a,b.m.idleaf2selected,f)}function g(c,a,d){var e=[],f;for(f in a)if(!(f in b)&&a[f]){var g=alp.oKeys(d[f]);alp.or(g,"this[v]",c)||e.push(g)}for(a=e.length;a--;)alp.forEach(e[a],"this[v]=true",c)}function f(b,a,d,e,f,g,h){function c(d,h){var k=d.id;h||(h=l[k]);(g[k]?a:b)[k]=!0;var m=(d=d.category)&&d.length;if(m)for(k=m;k--;)c(d[k],h);else h&&k&&(alp.forEach(e[k],"this[v]=true",a),alp.forEach(f[k],"!(v in this.a) && this.b[v]=true",
{a:g,b:b}))}if(d){var l=alp.arr2oSimple("string"===typeof d?d.split(","):d);c(h)}}var e=alp.i.state,d=alp.data.api,b={};alp.sub("oa.i",null,!0).IMapContentPanel={_imcp_augmentModel:function(b){(this.proj||null).substring.call.a;(this.mcpCatList.substring||this.mcpCatList.splice).call.a;this.onNewTreeEvt&&this.newTreeEvt().then(this.onNewTreeEvt);this._mcpCatArr=this.mcpCatList?alp.filter("string"===typeof this.mcpCatList?this.mcpCatList.split(","):this.mcpCatList,""):[];b.isOpen=e.boolState();b.original_tree=
e.objectState();var a=this._mcpInitCheckedSet=this.mcpInitList?alp.arr2oSimple(alp.filter("string"===typeof this.mcpInitList?this.mcpInitList.split(","):this.mcpInitList,"")):{},c=this._mcpInitBlockIndCheckedSet={};alp.forEach(this._mcpCatArr,"this.mics[v] && (this.mibis[i] = true)",{mics:a,mibis:c});b.blockarr=e.state();b.id2parentids=e.objectState();b.id2childrenids=e.objectState();b.idleaf2blockidarr=e.objectState();b.blockid2idset=e.objectState();b.idblock2checked=e.objectState();b.idkid2checked=
e.objectState();b.idblock2anychecked=e.objectState();b.idkid2anychecked=e.objectState();b.idleaf2selected=e.objectState();b.out_selcatid=e.stringState();b.isOpen=e.boolState();b.id2viscount=e.objectState();this.m_output&&alp.mixCheck(b,this.m_output)},_imcp_setInitVal:function(b){var a=this,c=a._rct_dfrd=d.requestCategoryTree({proj:a.proj,pruned:!0,type:a._mcpCatArr});e.to(c,function(b){alp.now(function(d){c===a._rct_dfrd&&k(d,a,b)})})},_imcp_connectModel2Model:function(b,a,d,f){function c(){d.isOpen.get()&&
k.m.isOpen.get()&&e.setNow(k.m.isOpen,!1)}function g(){k.m.isOpen.get()&&d.isOpen.get()&&d.isOpen.setNow(!1)}var l=alp.ratelimitF(111,alp.nowF(alp.bindF(h,null,b)));alp.forEach(["idblock2checked","idkid2checked","idleaf2blockidarr","blockid2idset"],function(b){a.push(e.chen(d[b],l))});var k=b.mlp;k&&(a.push(e.chen(d.isOpen,c)),a.push(e.chen(k.m.isOpen,g)));a.push(e.chenInit(d.idleaf2selected,function(a){var b=alp.filter(alp.oKeys(alp.filterIn(d.idleaf2selected._get_no_clone()||{},">1")),"").join(",")||
"<none>";e.set(a,d.out_selcatid,b)}))},_IMCP_SELCATID_NONE:"<none>"}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.map_panel");
(function(){function k(c){var e=c[d],f=c[b],g={},h=oa.NO_DISPLAY;g.open=function(){alp.setClass(e.children,h,!0);alp.setClass(f,h,!1);alp.setClass(e,h,!1);c[a]=g};g.close=function(){c[a]=null;alp.setClass(f,h,!0);alp.setClass(e,h,alp.and(e.children,"alp.hasClass(v,this.NO_DISPLAY)",oa))};return g}var h=alp.sub("oa.util.map_panel",null,!0),g=alp.i.state,f=alp.Later,e=alp.view.modalwin,d=h._TOP_CONT_NODE="_topContNode",b=h._MP_CONT_NODE="_mpContNode",c=h._MOWI_DUCK="_mowi_duck",a=h._OPENED_MOWI="_opened_mowi";
h.notModal_get_mowiDuck=k;h.prepare_open=function(a,b,c){var d=alp.nodify(b);b=a._mp_hg||(a._mp_hg=f?alp.hg():new alp.Eh);d.childNodes.a;b.clear();a=c(a,d);return{contNode:a,html:a.innerHTML,mp_hg:b}};h.setup_open=function(f,h){function l(b,c,d){d===f[a]&&(f[a]=null,p.clear(),w&&w.apply(null,arguments))}var q=h.html,p=h.mp_hg,r=g.nowF(h.onOpenNow),u=function(b,c,d){d&&d.open&&d.close||null.bug;f[a]=d;return r.apply(f,arguments)},t=h.onCloseLater||l,w=h.onCloseLater2||null;h=h.extraClass;if(!(m in
f)){var x=f.mpContNode,y=f[d]=alp.nodify(f.topContNode);x=f[b]=alp.nodify(x);if(y=!(!y||!x))f[c]=k(f),x.innerHTML=q;f[m]=!y}f[m]?e.open({html:q,onOpenNow:u,onCloseLater:t,extraClass:h}):(u(f[b],f[b],f[c]),f[c].open())};h.getUrlSearchParam=function(a){return(a=location.search.match(new RegExp("[?&]"+a+"=([^&])(?:&|$)")))&&a[1]};h.connectModel2View=function(a,b,c,d){b.push(g.chen(c.isOpen,function(){var b=c.isOpen.get(),d=a.toggleNode,e=a.toggleSelected;d&&e&&alp.setClass(d,e,b)}))};h.connectView2Model=
function(a,c,e,f){(f=a.toggleNode)&&("oax"===oa.PREFIX?c.push(alp.aEL(f,"click",alp.bindF("toggle",a))):c.push(alp.aELtouchup(f,alp.bindF("toggle",a))));c.push(alp.aELtouchup(document,function(c){if(a.isOpened()){c=c&&c.target;var e=a.toggleNode,f=a[d],g=a[b];c&&f&&g&&!alp.isDescendant(c,[f,g,e])&&a.isOpened()&&a.toggle()}},!1,{doNotStop:!0}));c.push(setInterval(function(){var b=a.isOpened();b!==e.isOpen.get()&&g.setNow(e.isOpen,b)},123),clearInterval)};h.isOpened=function(){return!!this[a]};h.toggle=
function(){var b=this[a];b?b.close():this.open()};var m="_isModal"})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.lazy_load");
(function(){var k=alp.sub("alp.dom",null,!0);k.installLazyLoad||(k.installLazyLoad=function(h){function g(a,b){var c=b&&b.single;return alp.reduce(a,function(a,b){var d=b.className.match(n)[1];c?(a[d]&&null.bug,a[d]=b):(a[d]||(a[d]=[])).push(b);return a},{})}function f(b,d,e){function f(a){b.innerHTML="string"===typeof a?a:alp.oGet(a,"answer.html");l&&l(k);alp.forEach(alp.gEBTN("script",b),function(a){"text/javascript"===(a.type||alp.gA(a,"type"))&&(alp.place(alp.cE("script",null,{type:"text/javascript"},
{textContent:alp.textContent(a)}),a,"before"),alp.orphan(a))})}d&&alp.rEL(d);d=alp.dataset(b);if(!d||!d.oax_lazy_load){d.oax_lazy_load="done";d=alp.hasClass(b,x);var g=alp.nodify(c,b);if(g){g=g.value;var k=alp.oCreateMix(h,alp.mix({node:b},e));m&&(g=m(g,k));if(d){d=g.split("?");g=d[0];var n=["lazy_force_reload="+ +new Date+Math.random()].concat((d[1]||"").split("&")).join("&");g=[g,n].concat(d.slice(2)).join("?")}e=a(g,e||null);"string"===typeof e?f(e):alp.m(e,["to","then"],f)}else console.error("lazy_load: could not find path node.",
b)}}function e(a){return alp.jsonp(a)}h||(h={});var d=h.cont||alp.body(),b=h.eh||h.hg||(alp.Later?alp.hg():new alp.Eh),c=h.loadPath||"oax-load-path",a=h.loader||e,m=h.loadPathPrepare||null,l=h.onload||null,r=h.onclickLoad||"oax-onclick-load",n=h.onclickNameRx||/(?:^|\s)oax-onclick-name-(\S+)(?:$|\s)/,q=h.onchangeListen||"oax-onchange-listen",p=h.onchangeLoad||"oax-onchange-load",v=h.onscrollLoad||"oax-onscroll-load",u=h.onscrollRef||window,t=h.onscrollRate||234,w=h.onscrollAlsoCheck||null,x=h.forceReload||
"oax-force-reload",y=g(alp.gEBCN(h.onclickListen||"oax-onclick-listen",d)),z=g(alp.gEBCN(r,d),{single:!0});r=alp.gEBCN(q,d);var A=g(alp.gEBCN(p,d),{single:!0});d=alp.gEBCN(v,d);alp.forIn(y,function(a,c){var d=alp.aEL(a,"click",function(){f(z[c],d,{onclick_name:c})},!0);b.push(d)});alp.forIn(r,function(a,c){a=alp.aEL(a,"change",function(a){a=a.srcElement||a.target;(a=a.options[a.selectedIndex].className.match(n))&&f(A[a[1]],null,null)},!0);b.push(a)});alp.forEach(d,function(a){function c(){d&&(k.isVisibleWithinViewport(a)||
alp.fVal(w))&&(f(a,d,null),d=null)}var d=alp.aEL(u,"scroll",alp.ratelimitF(t,c));b.push(d);b.push(setInterval(c,351),clearInterval);c()});return b})})();"undefined"!==typeof dojo&&dojo.provide("oa.util.lazy_load");
(function(){function k(e){return alp.tmpl(oa.LAZY_LOAD_JSONP_URL_TMPL,{file:e})}function h(e){var d=e.node,b;d=d&&1>alp.sTrim(alp.textContent(d)).length?!1:(b=d&&alp.nodify("oax-lazy-load-content-count",d))?0<b.value:null;if(b=alp.opt((e.onclick_name||"").match(/^tab-.*$/)||[],0))e=e.where,(e||null).substring.call.a,f.emitCustomClick(e,"open "+b+" ("+(d?"has content":"empty")+")")}var g=alp.sub("oa.util",null,1),f=oa.ga_track_anonymous;g.installLazyLoad=function(e){e=alp.oCreateMix({loadPathPrepare:k,
onload:h,where:null},e);alp.dom.installLazyLoad(e)};g.installLazyLoad.loadPathPrepare=k;g.installLazyLoad.onload=h})();"undefined"!==typeof dojo&&dojo.provide("oa.x.map_content_panel");
(function(){function k(a){this.mapboss&&alp.m(this.mapboss.mapDfrd(),["isDone, triggered"])||alp.now("done",this.mapboss.mapDfrd(),a)}function h(a,b,c){function d(){m.to(a.mapboss.mapDfrd(),function(b){b.whenLoaded?b.whenLoaded(alp.bindF("open",a)):a.open()})}alp.opt(c,"hash")&&(location.hash=c.hash);var e=alp.opt(c,"id");a&&e&&m.setNow(a.m.selectedTabId,c.id);a?m.to(a._rct_dfrd,alp.bindF(d,null,a,b)):b?(b.mcpIgnoreUrlOpen=!0,alp.now("openMcp",b,e)):null.bug}function g(a,b){if(!a[t]){var c=alp.cE("div",
null,null,{innerHTML:b.innerHTML}),d=alp.nodify(a.tmplContentOne_get,c),e=alp.nodify(a.tmplContentAll_get,c);c=alp.nodify(a.topSection,c);var f=alp.qS("input",c),g=alp.nodify(a.tmplCaption_get,c),h=alp.nodify(a.tmplContent_get,c),l=alp.nodify(a.tmplContentCont_get,h);d&&e&&c&&f&&g&&h&&l||null.bug;a[t]={top:c,all:e,one:d}}b=alp.cE("div",null,null,{innerHTML:b.innerHTML});alp.empty(alp.nodify(a.topSection,b));return b}function f(a,b,c,d,f,g){function h(){alp.forIn(b.idblock2checked._get_no_clone(),
q)}function l(){alp.forIn(b.idkid2checked._get_no_clone(),q)}function k(){function a(a,b){a=null!=c?c[b]:null;alp.setText(G[b]||B[b],null!=a?a:"")}var c=b.id2viscount._get_no_clone();alp.forIn(b.id2parentids._get_no_clone(),a);alp.forIn(b.id2childrenids._get_no_clone(),a)}function n(){alp.forIn(b.idblock2anychecked._get_no_clone(),r)}function p(){alp.forIn(b.idkid2anychecked._get_no_clone(),r)}function q(a,b){if(b=t[b])b.checked=a}function r(a,b){if(b=E[b])b.style.visibility=a?"":"hidden"}function v(a){var b=
a.id;b&&b in I&&(a.checked=I[b])}var t=a[w]={},G=a[x]={},B=a[y]={},E=a[z]={};a[A]={};d=alp.nodify("oax-mcp-icon-mapping");a[C]=alp.oFrom(d&&d.value||"{}");d=alp.nodify(a.topSection,c);alp.empty(d);f=b.blockarr.get();alp.forEach(f,alp.bindF(e,null,a,d,0,f.length));h();l();k();n();p();g.push(m.chen(b.idblock2checked,h));g.push(m.chen(b.idkid2checked,l));g.push(m.chen(b.id2viscount,k));g.push(m.chen(b.idblock2anychecked,n));g.push(m.chen(b.idkid2anychecked,p));alp.forIn(t,function(a,c){g.push(alp.aEL(a,
"change",alp.nowF(function(d){function e(a){var b=v[a]||[];(q[a]?k:l)[a]=h;alp.forEach(b,e)}function f(a){a=r[a]||[];alp.forEach(a,g,this);alp.forEach(a,f,this)}function g(a){var b=this.idblock2c,c=this.idkid2c,d=q[a]?b:c,e=d[a];b=alp[this.methodName](v[a],"this.a[ v ]  ||  this.b[ v ]",{a:b,b:c});e^b&&(d[a]=!!b)}var h=a.checked,l=b.idkid2checked.get(),k=b.idblock2checked.get(),n=b.idkid2anychecked.get(),p=b.idblock2anychecked.get(),q=b.blockid2idset._get_no_clone()||{};b.idleaf2blockidarr._get_no_clone();
var r=b.id2parentids._get_no_clone()||{},v=b.id2childrenids._get_no_clone()||{};e(c);f.call({idblock2c:k,idkid2c:l,methodName:"and"},c);p=alp.oCopy(k);n=alp.oCopy(l);f.call({idblock2c:p,idkid2c:n,methodName:"or"},c);m.set(d,b.idkid2checked,l);m.set(d,b.idblock2checked,k);m.set(d,b.idkid2anychecked,n);m.set(d,b.idblock2anychecked,p)})))});var I=a[u];I&&alp.forEach(alp.qSA('input[type="checkbox"]',c),v)}function e(a,b,c,d,f,g){b.childNodes.a;c.toPrecision.call.a;var h=a[t];h||null.bug;var l=a[w],k=
a[x],m=a[y],n=a[z],p=a[A],q=a[C],r=f.id,v={id:r},u=f.name;f=f.category||[];var G=0===f.length;g=0===c&&d===a._mcpCatArr.length&&a._mcpCatArr[g]||r;g||null.bug;if(p[r]=G){c=h.one.cloneNode(!0);G=alp.gEBTN("input",c)[0];G.name===a.tmplContentOneInput_get||null.bug;var B=alp.tmpl(a.tmplInput_set,{id:g});alp.sA(G,"id",B);alp.sA(G,"name",B);"ol"!==b.nodeName.toLowerCase()&&(d=alp.cE("span",null,{"class":c.className}),alp.aC(d,c.firstElementChild),c=d);B=alp.nodify(a.entryTitle,c);alp.setText(B,u);alp.aC(b,
c);l[r]=G;m[r]=alp.nodify(a.entryCount,c)}else{p=h.top.cloneNode(!0);G=alp.qS("input",p);B=alp.tmpl(a.tmplInput_set,{id:g});alp.sA(G,"id",B);alp.sA(G,"name",B);G=alp.nodify(a.tmplCaption_get,p);var E=alp.gEBTN("label",G)[0];alp.sA(E,"for",B);B=alp.nodify(a.entryTitle,G);alp.setText(B,u);B=alp.nodify(a.entryIcon_get,alp.nodify(a.entryIcon,G));k[r]=alp.nodify(a.entryCount,G);n[r]=alp.nodify(a.entrySel,G);0===c?alp.setClass(B,[[a.entryIcon_get,!1],[alp.tmpl(a.entryIcon_set,{cat:q[g]||g}),!0]]):alp.orphan(B);
n=alp.nodify(a.tmplContent_get,p);k=alp.nodify(a.tmplContentCont_get,n);alp.setClass(n,[[a.tmplContentLevel_get,!1],[alp.tmpl(a.tmplContentLevel_set,{level:1+c}),!0]]);alp.empty(k);h=h.all.cloneNode(!0);n=alp.qS('input[name="'+a.tmplContentAllName_get+'"]',h);v=alp.tmpl(a.tmplContentAllName_set,v);alp.sA(n,"name",v);v=alp.nodify(a.entryTitle,h);alp.setText(v,alp.textContent(v).replace("__title__",u));alp.nodify(a.entryCount,h).style.visibility="hidden";2>f.length&&alp.setClass(h,oa.NO_DISPLAY,!0);
alp.aC(k,h);l[r]=n;m[r]=alp.nodify(a.entryCount,h);for(alp.forEach(f,alp.bindF(e,null,a,k,c+1,d));d=p.firstChild;)alp.aC(b,d)}}function d(a,b){var c=a.m.idleaf2selected,d=alp.filterIn(a[E]||{},">1");a=a[E]=alp.filterIn(c._get_no_clone()||{},">1");d=alp.oDelta(a,d);alp.forEach(d.add,"this.cL.setCatSelected(v,this.sel[v])",{cL:b,sel:a});alp.forEach(d.del,"this.setCatSelected(v,false)",b)}function b(a,b){alp.forIn(a.m.idleaf2selected._get_no_clone()||{},"this.setCatSelected(w,v)",b)}function c(a,b){var c=
alp.oCreate(b);a=a.m;b=a.id2childrenids._get_no_clone();var d=a.id2parentids._get_no_clone();a.idleaf2blockidarr._get_no_clone();alp.forIn(b,function(a,b){a&&0<a.length&&(c[b]=0)});alp.forEach(alp.oKeys(a.idleaf2blockidarr._get_no_clone()),function(a){function b(a){(a=d[a])&&0<a.length&&(alp.forEach(a,"this.i2c[v] = (this.i2c[v]||0) + this.c",{i2c:c,c:e}),alp.forEach(a,b))}var e=c[a];0<e&&b(a)});return c}function a(a,b,c){var d=a["switch"+b];d&&(d.checked=!0);q.login_indicator()||2!==b||((b=window.event)&&
alp.stopEvent(b),b="mcp."+a.proj,m.set(c,a.m.selectedTabId,1),p.open_login({type:b,data:{id:2,hash:location.hash}}))}alp.sub("oa.x",null,!0);var m=alp.i.state,l=alp.data,r=alp.Later,n=oa.util,q=n.community,p=n.login,v=n.map_panel;alp.declare("oa.x.MapContentPanel",r?alp.x2.AController:alp.x.AbstractController,null,oa.i.IMapContentPanel,{proj:null,mcpCatList:null,mcpInitList:"",mcpInitCheckedIds:null,mapboss:null,open_inpage_iw:null,onNewTreeEvt:null,m_output:null,toggleNode:null,toggleSelected:"oax-selected",
topContNode:"oax-map-panel-cont",mpContNode:"oax-mcp-cont",mlp:null,aCatAppearsOnlyOnce:!0,mcpIgnoreUrlOpen:!1,entryIcon:"alp-x-cbt-icon",entryIcon_get:"oax-icon-tour",entryIcon_set:"oax-icon-${cat}",entryTitle:"alp-x-cbt-title",entryCount:"alp-x-cbt-count",entrySel:"alp-x-cbt-sel",resetClass:"oax-mcp-reset",topSection:"oax-mcp-section",tmplInput_get:"toursToggle",tmplInput_set:"toggle-${id}",tmplCaption_get:"oax-mcp-caption",tmplContent_get:"oax-mcp-section-list",tmplContentLevel_get:"oax_toggle_content_l1",
tmplContentLevel_set:"oax_toggle_content_l${level}",tmplContentCont_get:"oax-mcp-content-cont",tmplContentAll_get:"oax-mcp-set-all",tmplContentAllName_get:"allTours",tmplContentAllName_set:"oax-mcp-all-${id}",tmplContentOne_get:"oax-mcp-set-one",tmplContentOneName_get:"mountainToggle",tmplContentOneName_set:"oax-mcp-one-${id}",tmplContentOneInput_get:"mountainTours",myListsReload:"oax-onclick-name-myLists",catSwitchId:"switch1",listSwitchId:"switch2",isOpened:v.isOpened,open:function(b){function c(a){function b(a,
b){var c=[],e=d._id_list||(d._id_list={});alp.forEach(b,"this[v] = (this[v] || 0) + ("+("add"===a)+"? +1 : -1)",e);alp.forIn(e,"v > 0 ? this.push( w ) : null",c);if(d._geom_layer){var f=d._geom_layer;if(c.length)alp.m(f,["userInit","init"],c);else{r?f.setMap(null):alp.m(f,["userInit","init"],null);return}}else a=r?alp.maps.GeomLayer:alp._gmap2_3.TourPoiLayer,b={proj:d.proj,fitPoiBounds:!1,markersActive:!0,defaultIW:!r&&!d.open_inpage_iw,showAllToursOnMap:!0},r&&(b.L=d.mapboss.L),f=d._geom_layer=new a(c,
b),d.open_inpage_iw&&f.listen("markerClick",function(a){m.to(d.mapboss.mapDfrd(),function(b){d.open_inpage_iw(a,b,{})})});m.to(d.mapboss.mapDfrd(),function(a){f.setMap(a)})}a||(a=window.event);var c=a.currentTarget;a=c&&c.name;var e=c&&c.checked;c=d._list_map||(d._list_map={});a?(c[a]=e,(new l.SingleOOI(a,{proj:d.proj,acceptUnpublished:!0})).load(function(a){a=alp.opt(a,"data");(a=alp.opt(a,"sortedIds"))?b(e?"add":"remove",a.split(",")):console.error("empty list")})):console.error("checkbox without id detected")}
var d=this,e=d.m,h=v.prepare_open(d,"oax-mcp-tmpl",g),k=h.mp_hg;b&&m.setNow(e.selectedTabId,b);v.setup_open(d,alp.oCreateMix(h,{onOpenNow:function(b,g,h,l){k.push(m.chenInit(e.blockarr,alp.bindF(f,null,d,e,g,h,l,k)));k.push(alp.aELtouchup(alp.gEBCN(d.resetClass,g),alp.nowF("reset",d)));b=alp.gEBCN(d.myListsReload,g);h=d.m.selectedTabId.get();if(!d.switch1||r)d.switch1=alp.gEBI(d.catSwitchId,g),d.switch2=alp.gEBI(d.listSwitchId,g),m.nowF(a,null,d,h)(),d.switch1&&alp.aEL(d.switch1,"change",alp.nowF(function(a){m.set(a,
d.m.selectedTabId,1)})),d.switch2&&alp.aEL(d.switch2,"change",alp.nowF(function(a){m.set(a,d.m.selectedTabId,2)}));if(q.login_indicator()){var p=n.spinner.create_spinner();n.installLazyLoad({where:"myList"+(this.id?"-"+this.id:""),onload:function(a){if(a=alp.opt(a,"node"))a=alp.gEBCN("oax-list-ckb",a),alp.aEL(a,"change",c),alp.forEach(alp.filter(a,"this[v.name]",d._list_map),"v.checked = true");p.stopWait()},loadPathPrepare:function(a,b){p.startWait(b.node);return alp.tmpl(oa.LAZY_LOAD_JSONP_URL_TMPL,
{file:a})}});2===h&&alp.dom.triggerClick(b[0])}},onCloseLater2:function(a,b,c){var e=d[u]={};alp.forEach(alp.qSA('input[type="checkbox"]',a),function(a){a.id&&(e[a.id]=a.checked)})},extraClass:"oax_mcp_wrapper"}))},reset:function(){alp.now("setInitVal",this)},toggle:v.toggle,setMap:r?null:k,newTreeEvt:alp.memM("newTreeEvt",alp.Later?'alp.event("newTreeEvt",{then:1,passValue:1})':'alp.event("newTreeEvt",{then:1})'),bindClusterLayer:function(a){var e=this;e.unbindClusterLayer(a);var f=new alp.Eh;f.push(m.chen(e.m.idleaf2selected,
d,null,e,a));b(e,a);f.push(a.listen("visibleCatCountChange",function(a){m.setNow(e.m.id2viscount,c(e,a))}));e._cL2eh().setNow(a,f)},unbindClusterLayer:function(a){alp.m(this._cL2eh().delNow(a),"clear")},augmentModel:function(a){(this.proj||null).substring.call.a;var b=v.getUrlSearchParam(oa.URL_SEARCH_MCP_OPEN);a.selectedTabId=m.intState(parseInt(b)||1);this._imcp_augmentModel(a);if(!this.mapboss){var c=alp.dfrd("OA:MCPMapDfrd",{then:1});this.mapboss={mapDfrd:function(){return c}}}},augmentKids:function(a){},
setInitVal:function(a){this._imcp_setInitVal.apply(this,arguments)},connectModel2Model:function(a,b,c,d){this._imcp_connectModel2Model.apply(this,arguments)},connectModel2View:function(b,c,d,e){c.push(m.chenInit(d.selectedTabId,function(){b.isOpened()&&m.nowF(a,null,b,d.selectedTabId.get())()}));v.connectModel2View(b,c,d,e)},connectView2Model:v.connectView2Model,connectPureView:function(a,b,c,d){q.generic_login_barrier_after({type:"mcp."+a.proj},alp.bindF(h,null,a,null));b=(b=v.getUrlSearchParam(oa.URL_SEARCH_MCP_OPEN))&&
parseInt(b);!a.mcpIgnoreUrlOpen&&b&&h(a)},_cL2eh:alp.memM("_cL2eh","alp.mapany()")});oa.x.MapContentPanel._glb_mcp_after=h;var u="_expand_appearance",t="_tmpl_obj",w="_id_2_checkbox",x="_id_2_count",y="_id_2_count_all",z="_id_2_sel",A="_id_2_is_leaf",C="_icon_map",E="_il2s_prev"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.moretext");
(function(){function k(e,d,b,c){e._textWrapper=alp.nodify(e.textWrapper);e._ctrlWrapper=alp.nodify(e.ctrlWrapper);e._fullText=alp.nodify(e.fullText,e._textWrapper);e._ctrlMore=alp.nodify(e.ctrlMore,e._ctrlWrapper);e._ctrlLess=alp.nodify(e.ctrlLess,e._ctrlWrapper);e._shortHeight=e._textWrapper.clientHeight;h(e);e._shortHeight&&e._fullHeight?b.isLong.set(e._fullHeight>e._shortHeight):setTimeout(alp.nowF(function(a){k(e,d,b,c)}),123);e.noTransition&&alp.vStyle(e._textWrapper,{transitionProperty:"none"})}
function h(e){e._fullHeight=e._fullText.clientHeight;e._middleHeight=e._shortHeight+e._fullHeight>>1}function g(e,d){var b=d.isFull.get(),c=d.isLong.get(),a=d.isFullVisible.get();alp.style(e._ctrlWrapper,{display:c?"":"none"});c&&(alp.style(e._ctrlMore,{display:a?"none":""}),alp.style(e._ctrlLess,{display:a?"":"none"}),b=(b?e._fullHeight:e._shortHeight)+"px",c=e._textWrapper.style,b!==c.maxHeight&&(c.maxHeight=b,e=alp.bindF(f,null,e,d),e(),setTimeout(e,1E3),setTimeout(e,3E3),setTimeout(e,5E3)))}function f(e,
d){var b=d.isFull.get();e=0<e._middleHeight&&e._middleHeight<e._textWrapper.clientHeight;b===e&&d.isFullVisible.setNow(e)}alp.declare("alp.x.MoreText",alp.x.AbstractController,null,{textWrapper:null,ctrlWrapper:null,fullText:"oax-full-text",ctrlMore:"oax-desc-more",ctrlLess:"oax-desc-less",noTransition:!1,augmentModel:function(e){e.isFull=new alp.BoolState;e.isLong=new alp.BoolState;e.isFullVisible=new alp.BoolState},setInitVal:k,connectModel2View:function(e,d,b,c){d.push(b.isFull.change_cb(g,null,
e,b));d.push(b.isLong.change_cb(g,null,e,b));d.push(b.isFullVisible.change_cb(g,null,e,b));g(e,b);d.push(alp.aEL(window,"resize",function(){h(e);g(e,b)}))},connectView2Model:function(e,d,b,c){d.push(alp.aELtouchup(e._ctrlWrapper,function(){b.isFull.setNow(!b.isFull.get())}));d.push(alp.aEL(e._textWrapper,alp.transitionEndName(),alp.bindF(f,null,e,b)))}})})();"undefined"!==typeof dojo&&dojo.provide("oa.action.book");
(function(){function k(g,f,e){console.log("xxx action book do_it",g,f,e)}var h=alp.sub("oa.action.book",null,!0);h.do_it=k;h.setup=oa.action.setup_intercept_F(k)})();"undefined"!==typeof dojo&&dojo.provide("oa.action.print");(function(){function k(g,f,e){console.log("xxx action print do_it",g,f,e)}var h=alp.sub("oa.action.print",null,!0);h.do_it=k;h.setup=oa.action.setup_intercept_F(k)})();"undefined"!==typeof dojo&&dojo.provide("oa.action");"undefined"!==typeof dojo&&dojo.provide("oax.snippet");
(function(){function k(b,c){(b||0).substring.call.a;var a="desktop";"snippet"!==c&&"gallery-snippet"!=c&&c||(a="common");return alp.jsonp(alp.tmpl(oax.SNIPPET_TMPL_MARKUP_JSONP_URL,{plugintype:a,frontendtype:b,snippettype:c||"gallery-snippet"}),{cache:!0})}var h=alp.sub("oax.snippet",null,!0),g=oa.action,f=oax.util,e=alp.content,d=alp.dom.anchor;h.getNodeOrDfrd=function(b,c){function a(a){var b=alp.dfrd("oax.snippet:DOM node dfrd",{then:1});a.then(function(a){var c,d;if(!(a&&(c=a.answer)&&/^ok$/i.test(c.status)&&
200===c.code&&(d=c.html)))throw Error("OS_receiveTmpl: failed to load the snippet template!");b.done(h(d))});return b}function h(a){function h(a){a.toPrecision.call.a;E||(E=new alp.x.Lightbox({initNow:!0,init_value:b.id,proj:c.proj,legendTmpl:A}));E.show();alp.subDfrd(E.isReady,E).then(function(){E.kx.view.showOne(a)})}function k(a){return a&&(alp.hasClass(a,"oax-domaw-restrict")?a:k(a.parentNode))}(a||0).substring.call.a;a=alp.tmplJs(a,b);var m=l.classArr.concat([oax.ID,oax.ID_PREFIX+b.id]).join(" "),
n=alp.cE("div",null,{"class":m},{innerHTML:a});m=!1;if(oax.SNIPPET_ACTION_OPEN_ON_TOP&&(a=alp.gEBCN(oax.SNIPPET_ACTION,n),alp.and(a,'alp.hasClass(v,"'+oax.SNIPPET_ACTION+'-open")'))){var r=alp.filter(alp.map(a,'v.tagName.toLowerCase()==="a"  ?  v  :  alp.gEBTN("a",v)[0]'),""),w=alp.gEBTN("a",n);w=alp.map(w,'alp.gA( v, "href" )  ||  v.href');w=alp.oKeys(alp.arr2oSimple(w));0<r.length&&1===w.length&&alp.sIsExternalURL(w[0])&&!alp.or(alp.gEBCN(d.NO_WRAP_OOI_SNIPPET(),n),"alp.isDescendant(this,v)",r[0])&&
(m=r[0],r=a[0],a=1===a.length&&k(r)||n,r="_blank"===m.target||"_blank"===alp.gA(r,"target"),w=alp.filter(m.className.split(/\s+/),"v  &&  !/_/.test(v)  &&  /-/.test(v)").join(" "),m=alp.cE("a",null,alp.mix({href:alp.gA(m,"href")||m.href,"class":oax.SNIPPET_ACTION+" "+oax.SNIPPET_ACTION+"-open"+(w?" "+w:""),style:"display: block;"},r?{target:"_blank"}:{}),{innerHTML:d.remove(a.innerHTML)}),alp.aC(alp.empty(a),m),m=!0)}m||(a=d.wrap_ooi_snippet(n),m=0<(a&&a.length));(a=c&&alp.oGet(c,"action_open.url"))&&
"function"===typeof a&&(a=a(b))&&alp.forEach(alp.qSA('a[href="#'+b.id+'"]',n),'alp.sA(v,"href",this.s_url).href=this.s_url',{s_url:a});m=(a=alp.nodify(oax.SNIPPET_SLIDESHOW,n))&&alp.nodify(oax.SNIPPET_SLIDESHOW_CTRL,n);r=a&&alp.nodify(oax.SNIPPET_SLIDESHOW_PREV,n);w=a&&alp.nodify(oax.SNIPPET_SLIDESHOW_NEXT,n);var x=a&&alp.nodify(oax.SNIPPET_SLIDESHOW_CURRENT,n),y=a&&alp.nodify(oax.SNIPPET_SLIDESHOW_MAX,n);if(a){var z=new alp.x.SlideShow(a,{slideSelector:m,previousButton:r,nextButton:w,current_slide_number_display_q:x,
max_slide_number_display_q:y,withLightbox:!0});alp.subDfrd(function(){return!alp.isDescendant(n,alp.body())}).then(function(){z.stopLoop()})}a=alp.nodify("oax-text-wrapper",n);m=alp.nodify("oax-wrapper-desc-toggle",n);a&&m&&(new alp.x.MoreText({initNow:!0,textWrapper:a,ctrlWrapper:m,noTransition:!0}),alp.setClass(m,oa.NO_DISPLAY,!1));a=alp.nodify("oax-snippet-to-lightbox",n);m=alp.nodify("oax-snippet-to-lightbox-more",n);var A=alp.nodify("oax-snippet-to-lightbox-legend-tmpl",n);if(a||m){var C=a?alp.gEBTN("img",
a):[];alp.forEach(C,function(a,b){alp.aEL(a,"click",function(){h(b)})});alp.aEL(alp.gEBTN("button",a),"click",function(){h(0)});m&&alp.aEL(m,"click",function(){h(C.length)})}alp.forEach(alp.gEBTN("a",n),function(a){a.childNodes.a;if(!/^#/.test(a.href)&&!/^#/.test(alp.gA(a,"href"))){var b=oa.SNIPPET_ACTION+"-open",c=[a];c.push.apply(c,alp.gEBCN(b,a));alp.setClass(c,[[oa.SNIPPET_ACTION,!1],[b,!1]])}});alp.forEach(alp.gEBCN(oax.SNIPPET_ACTION,n),function(a){var c=oax.SNIPPET_ACTION_TYPE(a.className),
d=l["action_"+c];d&&g[c].setup(a,b,d)});f.basket_add_or_login(n,{proj:c.proj,ooiid:b.id});alp.aEL(alp.gEBCN("oax-purchase-indent",n),"click",function(){e.track({proj:c.proj,id:b.id,aspect:b.frontendtype+"PurchaseIndent"})},!0);alp.forEach(alp.gEBTN("a",n),function(a){var b=a.href,c=(b=b&&b.match(/^(https?:)(\/\/([^\/]+)\/.*?)$/i))&&b[2],d=b&&b[3],e=location.protocol;/^http:$/i.test(b&&b[1])&&/^https:$/i.test(e)&&d===location.host&&(a.href=e+c)});return n;var E}var l=alp.oCreateMix({tmpl:null,classArr:[]},
c),r=l.tmpl&&("string"===typeof l.tmpl?l.tmpl:l.tmpl[b.frontendtype]);return r&&"string"===typeof r?h(r):a(l.tmpl||k(b.frontendtype,l.snippettype||null))};h.getSnippetTmplDfrd=k})();"undefined"!==typeof dojo&&dojo.provide("oax.iw");
(function(){var k=alp.sub("oax",null,!0),h=alp._gmap2_3,g=alp.data,f=k.snippet,e;alp.i18n.fetch("alp.all").then(function(d){e=d});k.iwOpen=function(d,b,c,a,e,l){function m(e){e.childNodes.a;c=alp.oCreateMix(c||{},{iwOpenCallback:n});c.iwNodePostProcess&&(e=c.iwNodePostProcess(e,q)||e);alp.cE("div",e,{"class":"oax_clear"});b=p?h.xy2latlng(p):b;var f=q&&q.id;f&&k.api.trackTeaser(f);oa.ACTION_OPEN_NONE===(a&&(alp.oGet(a,"action_open.type")||"").split("|")[0])&&alp.forEach(alp.gEBTN("a",e),'v.href="#"+this.id, alp.sA(v,"href","#"+this.id)',
{id:f});f=h.iwOpen(d,b,e,c);v.done({iw:f,node:e})}function n(a){function b(){var g=alp.gBCR(d.getDiv()),h=alp.gBCR(a.node),l=g.width&&h.width&&h.left-Math.min(g.width/2,g.left+1.7*h.width);g=g.top&&h.top&&h.top-(g.top+64);h=d.getCenter();if(c===l&&e===g&&h&&f&&h.equals(f))(0>l||0>g)&&d.panBy(Math.min(0,l),Math.min(0,g));else if(alp.isFiniteNumber(l)||alp.isFiniteNumber(g))c=l,e=g,f=h,setTimeout(b,145)}var c,e,f;setTimeout(b,345)}var q=e&&e.data||l[0],p=g.ooi_geometry(q);e=f.getNodeOrDfrd(q,alp.fVal(a,
q));var v=alp.dfrd("oax.iwOpen",{then:1});e.childNodes?m(e):e.then(m);return v};k.iwOpenLoadingMessage=function(d,b,c){c=alp.opt(e,"ooi_iw_loading");var a=alp.cE("div",null,{style:"width: 220px; height: 100px;",title:c||""}),f=new alp.x.Spinner;return{iw:h.iwOpen(d,b,a,{iwOpenCallback:function(){f.setTarget(a)}}),node:a}};k.iwOpenOOI=function(d,b,c,a){function e(a){return alp.opt(alp.nodify(k.IW_OOI_TMPL_CLASS_PREFIX+a,u),"innerHTML")||f.getSnippetTmplDfrd(a)}var h=a&&a.latlng,r=a&&a.classArr||[],
n=a&&a.url||k.PORTAL_OPEN_OOI_URL,q=a&&a.actionOpenType||k.ACTION_OPEN_PAGE_LOAD,p=a&&a.actionOpener||null,v=a&&a.snippet_cfg,u=a&&a.tmplCont,t=a&&a.cacheBust,w=d.getCenter(),x=d.getZoom(),y={iwNodePostProcess:a&&a.iwNodePostProcess,iwCloseCallback:function(a){a.mapMoved||a.iw!==a.last_iw||(d.setZoom(x),d.panTo(w))}};h&&k.iwOpenLoadingMessage(d,h);(new g.SingleOOI(b,{proj:c,cacheBust:t||"",acceptUnpublished:!0})).load(alp.bindF("iwOpen",k,d,h,y,function(b){return alp.mix({tmpl:e(b.frontendtype),classArr:r,
action_open:{type:q,url:n,opener:p,back2id:a&&a.back2id,back2title:a&&a.back2title,back2frontendtype:a&&a.back2frontendtype}},v)}))}})();"undefined"!==typeof dojo&&dojo.provide("oax.util.mapbtn");
(function(){alp.sub("oax.util.mapbtn",null,!0).manageWrapper=function(k,h,g,f,e,d){function b(){var b=m.get();alp.setClass(a,g,b);e&&alp.setClass(e,oax.NO_DISPLAY,!b);alp.forEach(f,c)}function c(a){a&&(a.cont?alp.setClass(a.cont,oax.NO_DISPLAY,!a.m.isOpen.get()):console.log("oax.util.mapbtn: missing x.cont (e.g. mlp or mcp)"))}var a=alp.nodify(k,h);if(a){k=alp.filter(f,"");k=alp.map(k,".m.isOpen");new alp.PoliteSetState({init_value:k});var m=alp.orState(k);k=alp.map([m].concat(k),".change_cb( this )",
b);b();d&&m.bind_to(d);return k}}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.mcp");(function(){alp.sub("oa.util.mcp",null,!0).get_mapIcon=function(k){var h={};alp.treeForEach({root:k},"category",function(g,f){g=f[g];!g.id||g.category&&g.category.length||(h[g.id]=g)});return{url:function(g,f){var e;return(e=f&&h[f])&&e.iconUrl||g.img},size:[31,31],scaledSize:[21,21],anchor:[10,10]}}})();"undefined"!==typeof dojo&&dojo.provide("oax.util.mcp");
(function(){function k(d,b){return function(c){if(/[\?&]newccm=0(?:&|$)/.test(location.search)){e||(e=alp.cfg.marker.cluster_3balls());var a=alp.arrRep([{url:e.url,size:e.xy,anchor:e.anchor_xy,noNumberDisplay:!0}],5)}else var g={cssClass:"oax-cluster-marker-inverted",sizeFun:alp.f("20 + v * 6")};d._cL=new h.ClusterLayer({proj:d.proj,initCat:"hideall",clusterIcon:a,clusterStyle:g,defaultIW:!1,view_opts:{lineOptions:{strokeWeight:5,strokeOpacity:.7}},mapIcon:f.get_mapIcon(c)});alp.subDfrd("_mcp",d).then(function(){d._mcp.bindClusterLayer(d._cL)});
d._cL.setMap(b);return d._cL}}var h=alp._gmap2_3,g=alp.sub("oax.util.mcp",null,!0),f=oa.util.mcp;g.delayedClusterLayerSetupF=function(d,b,c){return function(a){function e(){q||!g.get()&&h.get()===d._mcp._IMCP_SELCATID_NONE||(q=!0,alp.chainF(k(d,b),alp.bindF(c,d))(a))}var f=d._mcp.m,g=f.isOpen,h=f.out_selcatid;g.change_cb_init(e);h.change_cb(e);var q}};g.setupClusterLayerF=k;var e})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.view.overlaymaptypecollection");
(function(){function k(b,c){var a=alp.oKeyFindGen(function(){var a={},c=b.get();if(c)for(var d=c.length;d--;)a[c[d].name]=1;return a});return function(b,d){function e(b,d){b=a(d);b===d||c.newMlpMaybeDfrd||console.error('alp._gmap2_3.view.OverlayMapTypeCollection: currently unknown key "'+d+'". Did you mean "'+b+'"?')}var f=b||d||{};alp.now("init_cb",c,function(){alp.forIn(f,e)});return f}}function h(b,c){b.sel_st.setNow(c.get()||{})}function g(b,c){var a=b.getMap(),d=b._last_usel||{},f=function(a,
b){function c(a,c){if(a){var h={skiresort:"winter",avalanche:"slope"}[c]||c,l=alp.oGet(b._mc_network_of_name_of_mapid,[e,h]),k=alp.oGet(b._mc_extraov_of_name_of_mapid,[e,h]),m=l||k,n=m&&m._oa_unique_ov_id;m&&n?(d[n]=m,l?f.modeSet[h]&&f.setNow(h):k?(c=alp.mix({},g.get()),c[h]=a,g.setNow(c)):null.bug):console.error("xxx ovmtcoll: could not uniquize using new mlp",c,h)}}var d={};if(b){var e=b.m.basemap.get(),f=b.m.network,g=b.m.extraov;alp.forIn(a,c)}else alp.forIn(a,"this[ v._oa_unique_ov_id ] = v",
d);return d}(b.sel_st.get(),c);b._last_usel=f;var g=b._uname_2_ov||(b._uname_2_ov={});c=alp.oDelta(f,d);var h=c.add,k=c.del;alp.gmap3(function(c){alp.forEach(k,function(a){var c=g[a],d=c&&b._current_map(c);c&&d?b._remove_overlay(c,d):console.error("ovmtcoll: del_ov: missing ov for uname: ",a)});alp.forEach(h,function(d){if(d in g)var h=g[d];else h=(h=f[d])&&"object"===typeof h?e.maybe_mt_of_mapconfig(c,d,h):void 0,h=g[d]=h;h?b._add_overlay(h,a):console.error("ovmtcoll: add_ov: could not create: ",
d)})})}var f=alp._gmap2_3,e=alp.gmap3,d=["change_cb","changed_cb"];alp.declare("alp._gmap2_3.view.OverlayMapTypeCollection",null,alp.nowF(function(b){function c(b){(b=b.m._out_overlayidset)?b.change_cb_init(alp.bindF(h,null,a,b)):console.error("ovmtcoll could not find _out_overlayidset of new_mlp")}var a=this;a.cfg=b;alp.mixCheck(a,alp.opt(b,["entries_st","sel_st","newMlpMaybeDfrd","map","initNow"]));b=a.cfg.init_entries;var e=[],g=[];if(b&&b.length)for(var r=b.length,n=0;n<r;n++){var q=b[n];"function"===
typeof q.ov?e.push(q):g.push(q)}a.entries_st||(a.entries_st=new alp.ObjectState({init_value:g,do_not_clone:!0}));a.sel_st=a.sel_st||new alp.ObjectState({init_value:a.cfg.init_sel,constrain_all:k(a.entries_st,a)});alp.forEach(e,"v.ov( alp.bindF( this, null, v ) )",function(b,c,d){a.entries_st.setNow((a.entries_st.get()||[]).concat([alp.oCreateMix(b,{ov:d})]))});a.map_st=new alp.State({init_value:a.map});f.overlay._install();alp.m(a.entries_st,d,alp.bindF("_on_entries_change",a));alp.m(a.sel_st,d,alp.bindF("_update",
a));alp.m(a.map_st,d,alp.bindF("_update",a));this._update();this.newMlpMaybeDfrd&&this.newMlpMaybeDfrd.then(c);this.initNow&&this.mark_init_done()}),alp.util.InterfaceWithInit,{entries_st:null,sel_st:null,map_st:null,map:null,initNow:!0,newMlpMaybeDfrd:null,setMap:function(b){this.map_st.setNow(b)},getMap:function(){return this.map_st.get()},_update:function(){this.getMap();this.newMlpMaybeDfrd?this.newMlpMaybeDfrd.then(alp.bindF(g,null,this)):g(this,null)},_on_entries_change:function(b,c){c=c||[];
var a=this,d=alp.map(c,".name");b=alp.map(b,".name");var e={};alp.forEach(b,function(a){e[a]=1});alp.forEach(d,function(b,d){e[b]||(b=c[d].ov,(d=a._current_map(b))&&a._remove_overlay(b,d))});a._update()},_current_map:function(b){return this._ov2map().get(b)},_remove_overlay:function(b,c){function a(){var a;if(a=c.overlayMapTypes)for(var d=a.getLength();d--;)a.getAt(d)===b&&a.removeAt(d);else throw Error("alp._gmap2_3.view.OverlayMapTypeCollection._remove_overlay() could not recognize the map instance.");
}if(b.isOvArr)alp.forEach(b.ovArr,function(a){this._remove_overlay(a,c)},this);else{var d=c._oa_basemapLoadedDfrd;d?d.then(a):a()}this._ov2map().set(b,null)},_add_overlay:function(b,c){function a(){var a;if(a=c.overlayMapTypes){for(var d=a.getLength(),e=!1;d--;)a.getAt(d)===b&&(e=!0);e||a.push(b)}else throw Error("alp._gmap2_3.view.OverlayMapTypeCollection._add_overlay() could not recognize the map instance.");}if(b.isOvArr)alp.forEach(b.ovArr,function(a){this._add_overlay(a,c)},this);else{var d=
c._oa_basemapLoadedDfrd;d?d.then(a):a()}this._ov2map().set(b,c)},_ov2map:alp.memM("_ov2map","alp.mapany()")})})();"undefined"!==typeof dojo&&dojo.provide("alp.cfg.routing_overlay");(function(){alp.sub("alp.cfg.routing_overlay",null,!0).name_arr=alp.memF(function(){return alp.oKeys(alp.arr2oSimple(alp.map(alp.oValues(alp.filterIn(alp.cfg.datatype(),"!/^_/.test(w)")),".default_network"))).sort()})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.util.ovmtcoll");
alp.gmap3(function(k){function h(e,d,b,c){var a=[].concat(e.entries_st.get()||[]);null==c?a.push(b):a.splice(c,0,b);e.entries_st.set(a);b=b.name;alp.oGet(d,["overlay_sel_init",b])&&e.sel_st.set_flex(b,!0)}var g=alp.sub("alp._gmap2_3.util",null,!0),f=alp._gmap2_3;g.createOvmtcoll=function(e){function d(b){g.next(function(c){alp.gmap3.maptype(/^oa_/.test(b)?b:"oa_"+b).then(function(d,f){h(a,e,{name:b,ov:f,title:f.name});c()})})}function b(){g.next(function(b){alp.i18n.fetch("alp.all").then(function(c){h(a,
e,{name:"panoramio",ov:new k.panoramio.PanoramioLayer,title:function(){return c.maplayer_panoramio}},0);b()})})}function c(){g.next(function(b){alp.i18n.fetch("alp.all").then(function(c){h(a,e,{name:"weather",ov:{isOvArr:!0,ovArr:[new k.weather.WeatherLayer,new k.weather.CloudLayer]},title:function(){return c.maplayer_weather}},0);b()})})}e||(e={routing_overlay_name_arr:null,avalanche_overlay:!1,slope_overlay:!1,skiresort_overlay:!1,some_metgis_weather_overlay:!1,overlay_sel_init:null});e.routing_overlay_name_arr||
(e.routing_overlay_name_arr=alp.cfg.routing_overlay.name_arr());var a=new f.view.OverlayMapTypeCollection({init_entries:[],map:e.map,initNow:!1,sel_st:e.sel_st,newMlpMaybeDfrd:e.newMlpMaybeDfrd}),g=alp.asyncSeq();(e.avalanche_overlay||e.slope_overlay)&&d("slope");e.skiresort_overlay&&d("skiresort");e.some_metgis_weather_overlay&&(d("oa_metgis_weather"),d("metgis_cloudiness"),d("metgis_precipitation"),d("metgis_temperature"),d("metgis_temperature_point_demo"));alp.forEach(e.routing_overlay_name_arr,
d);k.panoramio&&b();k.weather&&c();g.next(function(b){alp.now("mark_init_done",a);b()});return a}});"undefined"!==typeof dojo&&dojo.provide("oax.util.ovmtcoll");
alp.gmap3(function(k){alp.sub("oax.util",null,!0).createOvmtcoll=function(h){var g=h.oaxcfg,f=h.map,e=h.mlp;h=g.maplayer.mapoverlay.layer;var d=e&&alp.m(e,"newMlpMaybeDfrd"),b=!d&&e&&e.m.mapoverlay;g=e&&b&&b.get()||g.maplayer.mapoverlay.init;f={map:f,avalanche_overlay:-1<alp.lastIndexOf(h,"avalanche_transp"),slope_overlay:-1<alp.lastIndexOf(h,"slope"),skiresort_overlay:-1<alp.lastIndexOf(h,"skiresort")||-1<alp.lastIndexOf(h,"skiresort_transp"),some_metgis_weather_overlay:alp.or(h,function(b){return/metgis/.test(b)}),
overlay_sel_init:g,sel_st:b,newMlpMaybeDfrd:d};return alp._gmap2_3.util.createOvmtcoll(f)}});"undefined"!==typeof dojo&&dojo.provide("oax.util.streetview");(function(){var k=alp._gmap2_3;alp.sub("oax.util",0,1).streetview=function(h,g){function f(){alp.setClass(g,oax.STREETVIEW_VISIBLE,e.getVisible())}var e=alp.m(h,"getStreetView");g&&e&&(k.event("addListener")(e,"visible_changed",f),f())}})();"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.x.button");
alp.gmap3(function(k){var h="alp.gmap3.x.Button".replace(/\./g,"_");alp.declare("alp.gmap3.x.Button",null,function(g,f){alp.mix(this,g);f&&(this.map=f);this._init()},{div:null,position:k.ControlPosition.TOP_RIGHT,div_click:null,div_style:{padding:"5px"},div_class:h,click:alp.memM("click",'alp.event("AG3 x Button click")'),click_cb:alp.eventCB("click"),_init:function(){var g=this;g.div||(g.div=alp.cE("div",null,{"class":g.div_class}));for(var f in g.div_style)g.div_style.hasOwnProperty(f)&&(g.div.style[f]=
g.div_style[f]);g.div_click||(g.div_click=g.div);k.event.addDomListener(g.div_click,"click",alp.nowF(function(e){alp.stopEvent(e);g.click().triggerSoon()}));g.map.controls[g.position].push(g.div)}})});"undefined"!==typeof dojo&&dojo.provide("oax.x.emptybutton");(function(){alp.sub("oax.x",null,!0).emptybutton=function(k,h,g){return new alp.gmap3.x.Button(alp.oCreateMix(k,{div:alp.cE("div",null,{style:g||"width:20px;height:20px;"},{innerHTML:"&nbsp;"})}),h)}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_flight3d");
(function(){var k=alp.view.modalwin,h=alp.data,g=alp.i.state,f=alp.i18n.unit;alp.sub("oa.i",null,!0).IFlight3d={proj:null,id:null,title:null,show:function(){g.setNow(this.m.isVisible,!0)},hide:function(){g.setNow(this.m.isVisible,!1)},augmentModel:function(d){function b(a){c._title=a.data.title}var c=this;d.isVisible=g.boolState();c._title=c.title||"";c._title||(new h.SingleOOI(c.id,{proj:c.proj,acceptUnpublished:!0})).load(b)},connectModel2View:function(d,b,c,a){function h(){function a(a){console.log("_oa_i_F3D_receiveMessage event:",
a);"dore?"===a.data&&a.source.postMessage("dore?"+location.href,a.origin)}function b(){d[e]=null;g.setNow(l,!1)}function c(a){var b=0,c=a.length,d;if(0===c)return b;for(d=0;d<c;d++){var e=a.charCodeAt(d);b=(b<<5)-b+e;b&=b}return b}var h=f.isMetric()?"unit_system=metric":"unit_system=imperial",m=f._get__quantityMap();m=m?"_quantityMap="+m:"";alp.m(d[e],"close");d[e]=null;if(l.get()){var u=(oa.API_CACHEBUST||"").slice(-6);u=c(u);var t=alp.opt(location.search.match(/[\?&](webglopt=[^&]+)/),1),w=alp.opt(location.search.match(/[\?&](draw_tourpois=[^&]+)/),
1),x=alp.opt(location.search.match(/[\?&](draw_toursummits=[^&]+)/),1),y=alp.opt(location.search.match(/[\?&](show_tourpois_iw=[^&]+)/),1),z=alp.opt(location.search.match(/[\?&](show_progress=[^&]+)/),1),A=alp.opt(location.search.match(/[\?&](show_running_marker=[^&]+)/),1),C=alp.opt(location.search.match(/[\?&](show_running_label=[^&]+)/),1),E=alp.opt(location.search.match(/[\?&](clamp_to_ground=[^&]+)/),1),G=alp.opt(location.search.match(/[\?&](auto_hide_time_ctrl=[^&]+)/),1),B=alp.opt(location.search.match(/[\?&](drag_head=[^&]+)/),
1),I=alp.opt(location.search.match(/[\?&](snapshot=[^&]+)/),1);h=oa.API_SERVER.replace(/(^\/|[^\/]\/)[^\/]+\/?$/,"$1").replace(/^\/[^\/]+\//,"/")+"alpportal/plugin/fly_ooi.jsp?terrain=all&i="+d.id+"&lang="+alp.i18n.language()+"&proj="+(oa.API_CFG.proj||"")+"&key="+(oa.API_CFG.key||"")+"&fcb="+u+(t?"&"+t:"")+(w?"&"+w:"")+(x?"&"+x:"")+(y?"&"+y:"")+(z?"&"+z:"")+(A?"&"+A:"")+(C?"&"+C:"")+(E?"&"+E:"")+(G?"&"+G:"")+(B?"&"+B:"")+(I?"&"+I:"")+(h?"&"+h:"")+(m?"&"+m:"");window.addEventListener("message",a,
!1);d[e]=k.open({html:'<div class="oax_modal_header oax-modal-header"><strong></strong><div class="oax-modal-action-close oax_modal_close_btn oax_pointer"><div class="oax-icon-cross-alt"></div></div></div><div class="oax_modal_body"><iframe src="'+h+'" style="width: 100%; height: 100%; margin: auto;"></iframe></div>',title:d._title||"",extraClass:"oax-flight3d-modal-wrap",onCloseLater:b})}}var l=c.isVisible;b.push(g.chenInit(l,function(){alp.m(f.getDfrd(),["to","then"],h)}))}};var e="_mowi"})();
"undefined"!==typeof dojo&&dojo.provide("oax.x.flight3d");(function(){alp.declare("oax.x.Flight3d",alp.x.AbstractController,null,oa.i.IFlight3d)})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap");
alp.gmap3(function(k){function h(a){function b(){a._mcp&&a._mcp.m.isOpen.set(!1);a._mlp&&a._mlp.m.isOpen.set(!1)}function c(b){function c(a){return a._alpParentProto||a.superclass}var d=alp.event("DM:cL_clickEvt",{then:1});b.listen("markerClick",function(a){d.triggerSoon(a)});r(a,null,d,"oax-snippet-detailmap-cluster","map");this.additional_clusterLayer_setup&&p.call_method_top_down(this,"additional_clusterLayer_setup",[b],c)}function d(b){if(b){var c=!!b.data.winterActivity,d=c&&a._overlayMapTypeIds&&
a._overlayMapTypeIds.oa_map_winter;if(b=alp.oGet(b.data,"category.mapOverlays")){b=alp.filter(b.split(","),"");var e=a._mlp._new_mlp;if(e)for(var f=0,g=b.length;f<g;++f){var h=b[f];e._network_set[h]?e.m.network.set(h):e._extraov_set[h]&&e.m.extraov.set_flex_now(h,!0)}else if(b=alp.arr2oSimple(b)){a._mlp.m.mapoverlay.set_flex_now(b);return}}if(d&&d.length)if(e)for(f=0,g=d.length;f<g;++f)h=d[f],e._extraov_set[h]&&e.m.extraov.set_flex_now(h,!0);else a._mlp.m.mapoverlay.set_flex(alp.arr2o(d,alp.f(),alp.f(c)))}}
var e=a.map;if(!e)return null;var f=e instanceof k.Map;if(!f){var g=oa.cfg.cfg_flexview.fill_default_and_fix_backward_compatibility(a,k),h=g.maplayer.basemap||{};f=h.layer;var l=a.mapTypeId||h.init||f[0];e="string"!==typeof e?e:alp.gEBI(e)||alp.gEBCN(e)[0];var m=a.mapZoom||13,n=q.xy2latlng(a.mapCenter);h=alp.oCreateMix(h,{center:n,zoom:m,mapTypeId:oa.cfg.cfg_flexview.fix_backward_compatibility_maptypeid(l),mapTypeControlOptions:{mapTypeIds:f},streetViewControl:!1});if(f=oa.cfg.ovmtids_filter(alp.sub("oa.overlayMapTypeIds",
h)||alp.sub("alp.overlayMapTypeIds",h),"detailmap"))a._overlayMapTypeIds=alp.filterIn(f,"w !='*'"),h.oa.overlayMapTypeIds=alp.filterIn(f,"w==='*'");f=alp.sub("oa",h,!0);null==f.loadTilesLater&&(f.loadTilesLater=!0);alp.mix(f,{mapButton3d:!1,mapButton2d:!1,earth:!1,kmlurl3d:null,loadTilesLater:!0});e.style.visibility="hidden";f=oax._dpmap=new alp.gmap3.Map(e,h);a._emptyButton=oax.x.emptybutton({position:k.ControlPosition.TOP_RIGHT},f);a.m.mapCfg.set(h);a._mlpContNode=alp.nodify(a.mlpCont,a.top);a._mlpToggleNode=
alp.nodify(a.mlpToggle,a.top);a._mlpCfg={initNow:!0,cont:a._mlpContNode,toggle:a._mlpToggleNode,cfg:g};a._mlp=new alp.x.MapLayerPanel(a._mlpCfg);a._mlp.setMap(f);a._ovmtcoll=v.createOvmtcoll({map:f,oaxcfg:g,mlp:a._mlp});a.m.ooi.change_cb_init(d);a._mcpContNode=alp.nodify(a.mcpCont,a.top);a._mcpToggleNode=alp.nodify(a.mcpToggle,a.top);a._mcpTogglePlaceholderNode="string"===typeof a.mcpTogglePlaceholder?alp.nodify(a.mcpTogglePlaceholder,a.top):a.mcpTogglePlaceholder;a.mcpCatList&&a._mcpToggleNode?(a._mcpCfg=
{initNow:!0,proj:a.proj,cont:a._mcpContNode,toggleNode:a._mcpToggleNode,mcpCatList:a.mcpCatList,mcpInitList:a.mcpInitList,initCheckedIds:a.mcpInitCheckedIds,onNewTreeEvt:x(a,f,c),cbtreeMoreLess:v.cbtreeMoreLess(a.top),mlp:a._mlp},a._mcp=new oa.x.MapContentPanel(a._mcpCfg),a._mcp.setMap(f),a._mcpTogglePlaceholderNode&&alp.setClass(a._mcpTogglePlaceholderNode,oax.NO_DISPLAY,!0)):a._mcpToggleNode&&alp.setClass(a._mcpToggleNode,oax.NO_DISPLAY,!0);v.mapbtn.manageWrapper(a.mapbtnsWrapper,a.top,a.mapbtnsOpenClass,
[a._mlp,a._mcp],alp.nodify(a.mpCont,a.top));a.m.mapVis.change_v_cb(!1,b);v.streetview(f,a.top)}return f}function g(b){function c(c,d){b.m.ooi.set(c);if((c=b.m.map.get())&&b.fitOOIs){var e=c.getZoom();d=q.xy2latlng(d);var f=a(b);b.mapCenter=d;if(f&&!alp.hasEmptyBCR(f)&&(f=(f=f&&alp.gBCR(f))&&f.width/2)){var g=new k.MercatorProjection;d=g.fromLatLngToPoint(d);e=new k.Point(d.x-f/(1<<e),d.y);d=g.fromPointToLatLng(e);b.dpOffset=f}c.setCenter(d)}}var d=b.m.id.get();b.m.ooi.set(null);d&&((new alp.data.SingleOOI(d,
{proj:b.proj,acceptUnpublished:!0})).load(c),w.last_visited_push(d))}function f(a){var b=a.m.map.get().is3d();alp.setClass(a.top,a.threeDBodyClass,b)}function e(b){var c=b.m.dpVis.get();alp.setClass(b.top,alp.mapIn(b.dpTopClass,alp.f("^"+!c)));var d=a(b),f=!d&&alp.nodify(oax.DETAILPANE_LAZYCONT,b.top);if(d||f)if(f)alp.asyncF(234,e)(b);else{var g;(g=d)&&alp.setClass(g,oax.NO_DISPLAY,!c);(g=b._dpToggledNodeArr||(b._dpToggledNodeArr=alp.gEBCN(b.dpSmallClass,b.top)))&&alp.setClass(g,oax.NO_DISPLAY,c);
(g=m(b))&&alp.setClass(g,oax.NO_DISPLAY,c);(g=l(b))&&alp.setClass(g,oax.NO_DISPLAY,!c)}else b.m.dpVis.set(!1),alp.setClass(b.top,alp.mapIn(b.dpTopClass,alp.f("^true"))),alp.setClass(b._dpToggledNodeArr||(b._dpToggledNodeArr=alp.gEBCN(b.dpSmallClass,b.top)),oax.NO_DISPLAY,!1),alp.setClass(m(b),oax.NO_DISPLAY,!0),alp.setClass(l(b),oax.NO_DISPLAY,!0);if(d=b.m.map.get())f=alp.isRTL()?-1:1,c=c?f*b.dpOffset:f*-b.dpOffset,b=new k.MercatorProjection,f=b.fromLatLngToPoint(d.getCenter()),c=new k.Point(f.x-
c/(1<<d.getZoom()),f.y),b=b.fromPointToLatLng(c),d.setCenter(b)}function d(a){var b=a.m.mapVis.get(),c=a.m.map.get(),d=alp.m(c,"getDiv");(a=a.mapVisBodyClass)&&alp.setClass(alp.body(),a,b);d&&alp.style(d,{visibility:b?"visible":"hidden",marginLeft:b?"":"-99999px",marginTop:b?"":"-99999px"});c&&q.event("trigger")(c,"resize")}function b(a,b,c){c||(c=window.event);c&&alp.stopEvent(c);alp.m(a.kx.flight3d,b?"show":"hide");b||a.flexOpener.setDpOverlay(a,"map");b&&u.emitCustomClick(u.DETAIL,"show 3d map")}
function c(a,b){b||(b=window.event);b.keyCode===alp.key.ESCAPE&&a.m.mapVis.get()&&(alp.stopEvent(b),a.flexOpener.setDpOverlay(a,null))}function a(a){return alp.gEBCN(a.dpWrapperClass,a.top)[0]}function m(a){return a._dpOpenNodeArr||(a._dpOpenNodeArr=alp.gEBCN(a.dpOpen,a.top))}function l(a){return a._dpCloseNodeArr||(a._dpCloseNodeArr=alp.gEBCN(a.dpClose,a.top))}function r(a,b,c,d,e){function f(b){var c={type:g,opener:a._actionOpener,url:a.openOOIUrl,map:a.m.map.get()};b=alp.oCreateMix(b.data,{className:d});
t.do_it(null,b,c)}e||(e="map");var g=a._actionOpenType_for_mode&&a._actionOpenType_for_mode(e)||a.actionOpenType;c=c.thenSoon(function(b){b="string"===typeof b?b:b.id;(b||0).substring.call.a;(new alp.data.SingleOOI(b,{proj:a.proj,acceptUnpublished:!0})).load(f)});b&&b.push(c)}function n(a,b){var c=a.m.map.get();if(c){var d=b.className,e=q.xy2latlng(alp.data.ooi_geometry(b)),f=a.m.ooi.get();d={latlng:e,classArr:alp.filter(["oax-snippet-detailmap-ooi",d],""),tmplCont:a.top,url:a.openOOIUrl,actionOpenType:a._actionOpenType_for_mode("map_iw"),
actionOpener:a._actionOpener,back2id:f.id,back2title:f.title,back2frontendtype:f.frontendtype};oax.iwOpenOOI(c,b.id,a.proj,d)}}var q=alp._gmap2_3,p=alp.util.proto,v=oax.util,u=oa.ga_track_anonymous,t=oa.action.open,w=oa.util.locstor,x=v.mcp.delayedClusterLayerSetupF;alp.declare("oax.x.DetailMap",alp.x.AbstractController,null,oa.i.IActionOpenType,{map:null,proj:null,key:null,frontendtype:null,id:null,mapCenter:[11,46],mapZoom:12,mapTypeId:null,alp_earth:!1,alp_kmlurl3d:null,maplayer:null,top:null,
dpWrapperClass:"oax-detailpane-wrapper",dpSmallClass:"oax-dp-toggled",dpHideClass:"oax-hide-detailpane",actionOpenType:oax.DETAILMAP_OOI_CLICK_ACTION_OPEN_TYPE,flexOpener:null,flexOpenerPage:null,openOOIUrl:oax.PORTAL_OPEN_OOI_URL,dpOpen:"oax-toggle-dp-open",dpClose:"oax-toggle-dp-close",dpTopClass:{"oax-dpvis-true":!0,"oax-dpvis-false":!1},dpOffset:0,singleViewMapControlsClass:"oax-singleview-map-controls",btnshow2d:"oax-btn-show2d",btnshow3d:"oax-btn-show3d",layoutState:null,dpData:null,threeDBodyClass:"oax-detailmap-3d",
btnhide:"oax-detailmap-hide",mapVisBodyClass:oax.DETAILMAP_VISIBLE,mapbtnsWrapper:"oax-mapbtns-wrapper",mapbtnsOpenClass:"oax-mapbtns-open",mpCont:oax.MP_CONT,mlpCont:oax.MLP_CONT,mlpToggle:oax.MLP_TOGGLE,mcpCont:oax.MCP_CONT,mcpToggle:oax.MCP_TOGGLE,mcpTogglePlaceholder:"oax-toggle-placeholder",mcpCatList:"",mcpInitList:"",mcpInitCheckedIds:"",additional_clusterLayer_setup:null,connectToExtra:function(a){this.m.mapCfg.bind_to(a.m.mapCfg)},showOverlay:alp.nowF(function(a){alp.forIn(this._ov_name2b,
function(b,c){b.set(c===a)})}),augmentModel:function(a){a.proj=new alp.State({init_value:this.proj});a.id=new alp.State({init_value:this.id});a.dpVis=new alp.BoolState({init_value:!0});a.mapVis=new alp.BoolState;a.ooi=new alp.State;a.mapCfg=new alp.State;a.map=new alp.State({init_value:alp.nowF(h)(this)});this._ov_name2b={lightbox:this.layoutState.isLightboxOpenSt,map:a.mapVis}},augmentKids:function(a){this._actionOpener=alp.mix({open_inpage_iw:alp.bindF(n,null,this)},this.flexOpener.getActionOpener());
alp.nodify(this.btnshow3d,this.top)&&(a.flight3d=new oax.x.Flight3d(alp.opt(this,["proj","id"])))},connectModel2Model:function(a,b,c,d){b.push(c.id.change_cb_init(alp.bindF(g,null,a)))},connectModel2View:function(a,b,c,g){b.push(c.mapVis.change_cb_init(alp.bindF(d,null,a)));(g=c.map.get())&&g.stVis3d&&b.push(g.stVis3d.change_cb(alp.bindF(f,null,a)));b.push(c.dpVis.change_cb_init(alp.bindF(e,null,a)));b.push(c.mapVis.change_v_cb(!1,function(){alp.m(c.map.get(),"set3d",!1)}))},connectView2Model:function(d,
e,f,g){function h(){var b=a(d),c=!b&&alp.nodify(oax.DETAILPANE_LAZYCONT,d.top);b?(e.push(alp.aEL(m(d),"click",function(){f.dpVis.setNow(!0)})),e.push(alp.aEL(l(d),"click",function(){f.dpVis.setNow(!1)}))):c&&alp.asyncF(231,h)()}alp.forEach(alp.gEBCN(d.btnshow2d),function(a){var c=a.className.match(oax.DETAILPANE_TABNAME_CLASS_RX),f=c&&c[3],g=alp.opt(d.layoutState,"dpTabName");e.push(alp.aEL(a,"click",alp.nowF(function(){f&&g&&g.setNow(f);b(d,!1);u.emitCustomClick(u.DETAIL,"full map view")})))});e.push(alp.aEL(alp.gEBCN(d.btnshow3d),
"click",alp.bindF(b,null,d,!0)));e.push(alp.aEL(alp.gEBCN(d.btnhide),"click",function(){d.flexOpener.setDpOverlay(d,null)}));h();e.push(alp.aEL(alp.body(),"keyup",alp.bindF(c,null,d)))}});oax.x.DetailMap._getDetailPaneWrapper=a;oax.x.DetailMap._connectPoiClickToOpen=r});"undefined"!==typeof dojo&&dojo.provide("oax.x.gallery");
(function(){function k(a,c,f,h){if(!g(a))return alp.onDCL(alp.bindF(k,null,a,c,f,h));c.push(f.is_loading.change_cb_init(function(){var b=f.is_loading.get();alp.setClass(a._topContNode,a.topLoadingClass,b);var c=alp.gEBCN(a.loadingIndicator,a._topContNode);alp.forEach(c,alp.f('.style.display="'+(b?"":"none")+'"'));a.loadingWaitbox&&!a[n]&&(a[n]=alp.map(c,"new alp.x.Waitbox( { targetInit : v, delay_ms : 0 } )"));alp.forEach(a[n],b?".startWait()":".stopWait()")}));c.push(f.ids_0.change_cb(function(){e(a)}));
c.push(f.ids_f.change_cb(function(){e(a)}));c.push(f.is_loading.change_cb(function(){e(a)}));c.push(f.datas.change_cb(function(){e(a);var b=a.m,c=b.ids_f.get();b=b.n_to_show.get();c=c.slice(b,a.galleryAll?c.length:Math.min(c.length,b+a.galleryStep));c.length&&(c=a.ooiLoader(c),alp.asyncF(234,"load",c)(alp.f()))}));c.push(f.are_all_shown.change_cb_init(d,null,a));c.push(f.highlightId.change_cb_init(alp.ratelimitF(100,b,null,a)));c.push(f.ids_to_show.change_cb_init(function(a){a.length&&oax.api.trackTeaser(a)}))}
function h(b,d,e,f){function l(){e.n_to_show.setNow(e.n_to_show.get()+b.galleryStep)}function k(){if(e.ids_f.get().length>e.n_to_show.get()){var a=b._topContNode,c=a.parentNode,d=b._snippetContNode.lastChild;d&&c.scrollTop+c.offsetHeight>a.offsetHeight-d.clientHeight&&l()}}function n(c,d){d||(d=window.event);var f=d.target||d.srcElement,g=a(b,f),h=g&&m(b,g);g&&c&&b.clickEvt().triggerSoon(g);if(c){for(var l;!(l=f&&/^a$/i.test(f.nodeName))&&f&&f!==h;)f=f.parentNode;if(l)return}c&&h&&0===alp.gEBCN(oax.SNIPPET_ACTION,
h).length||alp.stopEvent(d);e.highlightId.setNow(g||null);return g}if(g(b)){b.galleryAll||(b.infiScroll?(f=alp.ratelimitF(241,k),d.push(setInterval(f,357),clearInterval)):d.push(alp.aEL(b._moreBtnDom,"click",l)));var p=b._snippetContNode;d.push(alp.aEL(p,"mouseover",alp.nowF(function(a){var c=e.highlightId.get();a=n(!1,a);c&&c!==a&&b.mouseoutEvt().triggerSoon(c);a&&b.mouseoverEvt().triggerSoon(a)})));d.push(alp.aEL(p,"click",alp.nowF(alp.bindF(n,null,!0))));d.push(alp.aEL(p,"mouseout",alp.nowF(function(a){a||
(a=window.event);var c=alp.gBCR(p);if(a.clientX<c.left||a.clientX>c.right||a.clientY<c.top||a.clientY>c.bottom)a=e.highlightId.get(),e.highlightId.setNow(null),a&&b.mouseoutEvt().triggerSoon(a)})));f=alp.bindF(c,null,b);d.push(b.viewUpdateEvt().thenSoon(f));d.push(alp.aEL(window,"resize",f));d.push(setInterval(f,357),clearInterval)}else alp.onDCL(alp.bindF(h,null,b,d,e,f))}function g(a){return alp.and([a._topContNode,a._snippetContNode,a.galleryAll||!a.moreBtn||a._moreBtnDom])}function f(a,b){function c(a){d[q]===
f&&e.datas.setNow(a)}var d=this,e=d.m,f=[].concat(e.datas.get());a=e.ids_to_show.get().length;var g=d._id2index;f.length>a&&(f.length=a);for(var h=b.length;h--;){var l=b[h],k=l&&l.id,m=k?g[k]:-1;a>m&&-1<m&&k!==alp.opt(f[m],"id")&&(f[m]=l)}d[q]=f;(b=d.datas_modifier)?b(f).then(c):c(f)}function e(b){function c(){var a=d();alp.forEach(alp.gEBCN(b.emptyIndicator,b._topContNode),alp.f('.style.display="'+(a?"none":"")+'"'))}function d(){return null==b.m.ids_0.get()||b.m.ids_f.get().length||b.m.is_loading.get()}
if(!g(b))return alp.onDCL(alp.bindF(e,null,b));var f=Math.max(b.m.ids_f.get().length,b.m.datas.get().length);b._nTotalDisplayDom&&alp.setText(b._nTotalDisplayDom,b.m.is_loading.get()&&!f?"-":f);alp.setClass(b._topContNode,b.topEmptyClass,!f);c();b._h_hei&&(clearTimeout(b._h_hei),b._h_hei=null);d()?c():b._h_hei=setTimeout(c,1234);f=b._snippetContNode;for(var h=b.m.datas.get(),l=h.length,k=0;k<l;k++){var n=h[k],p=alp.opt(n,"id"),q=f.childNodes[k],r=a(b,q);p!==r&&(q&&f.removeChild(q),n=m(b,p,n),alp.place(n,
f,k))}for(;f.childNodes.length>l;)f.removeChild(f.lastChild);if(b.m.are_all_shown.get())for(k=12;k--;)alp.cE("div",f,{"class":b.snippetClassArr.join(" ")});(b._trigger_viewUpdateEvt||(b._trigger_viewUpdateEvt=alp.ratelimitF(131,alp.nowF("triggerSoon",b.viewUpdateEvt()))))()}function d(a){if(!g(a))return alp.onDCL(alp.bindF(d,null,a));var b=a.m.are_all_shown.get();b=a.infiScroll||b?"none":"";(a=a._moreBtnDom)&&alp.style(a,{display:b})}function b(a,b){var c=a[p];b!=c&&((c=c&&m(a,c))&&alp.setClass(c,
a.highlightClass,!1),(c=b&&m(a,b))&&alp.setClass(c,a.highlightClass,!0),a[p]=b)}function c(a){var b=a._snippetContNode.childNodes,c=b.length;if(c){b=alp.map(b,".offsetLeft");var d=Math.max.apply(Math,b);--c;if(b[c]<d){var e=alp.indexOf(b,d);b=alp.lastIndexOf(b,d);b=e+1-(c-b);0<b&&a.m.n_to_show.setNow(a.m.n_to_show.get()+b)}}}function a(b,c){if(c&&c!==b._snippetContNode){var d=c.className&&c.className.match(oax.ID_RX);return d?d[1]:a(b,c.parentNode)}}function m(a,b,c){function d(c){c.childNodes;a.deactivateOutLinks&&
alp.forEach(alp.gEBTN("a",c),'v.href="#"+this.id, alp.sA(v,"href","#"+this.id)',{id:b});r.anchor.wrap_ooi_snippet(c);var d=e[b];d&&d.parentNode&&a._snippetContNode.replaceChild(c,d);e[b]=c}var e=a._id2nodeCache||(a._id2nodeCache={});if(!b)return alp.cE("div",null,null,{innerHTML:"&nbsp;"});b in e||!c||(e[b]=alp.cE("div",null,{"data-placeholder":"true"}),c=oax.snippet.getNodeOrDfrd(c,l(a,c.frontendtype)),c.childNodes?d(c):c.then(d));return b&&e[b]}function l(a,b){return alp.oCreateMix(a.snippetCfg,
{tmpl:a._snippetTmplHtml||oax.snippet.getSnippetTmplDfrd(b,a.snippettype),classArr:a.snippetClassArr||[],proj:a.proj})}var r=alp.dom;alp.declare("oax.x.Gallery",alp.x.AbstractController,function(){this.proj.substring.a;this.frontendtype.substring.a},{proj:null,frontendtype:null,topCont:"oax-part-gallery",snippetCont:"oax-gallery-snippet-cont",snippetTmpl:"oax-gallery-snippet-tmpl",snippetCfg:null,snippetClassArr:["oax-gallery-snippet"],snippettype:"gallery-snippet",highlightClass:oax.HIGHLIGHT,moreBtn:"oax-gallery-further-btn",
nTotalDisplay:"oax-list-n-total",galleryAll:!1,galleryInit:16,galleryStep:16,deactivateOutLinks:!1,loadingState:null,datas_modifier:null,loadingIndicator:"oax-gallery-loading-indicator",emptyIndicator:"oax-gallery-empty-indicator",topLoadingClass:"oax-gallery-loading",topEmptyClass:"oax-gallery-empty",loadingWaitbox:!0,infiScroll:!1,ooiLoader:function(a){return new alp.data.OOIs({proj:this.proj,lightweightApp:this.frontendtype,idlist:a})},setIds:function(a,b){var c=alp.m(this.m.ids_0,["_get_no_clone",
"get"]),d=this.m.highlightId.get();!b&&c&&a&&c.length===a.length+1&&0>alp.lastIndexOf(a,d)||this.m.ids_0.setNow(a)},forceViewUpdate:function(){alp.now(e,null,this)},getSnippetTmplHtml:function(){return this._snippetTmplHtml},setAllIdsSet:function(a){this.m.all_ids_set.setNow(a)},clickEvt:alp.memM("clickEvt",'alp.event("gallery click",{then:1})'),mouseoutEvt:alp.memM("mouseoutEvt",'alp.event("gallery mouseout",{then:1})'),mouseoverEvt:alp.memM("mouseoverEvt",'alp.event("gallery mouseover",{then:1})'),
viewUpdateEvt:alp.memM("viewUpdateEvt",'alp.event("gallery view update",{then:1})'),setInitVal:function(){this._topContNode="string"===typeof this.topCont?alp.gEBCN(this.topCont)[0]:this.topCont;this._snippetContNode="string"===typeof this.snippetCont?alp.gEBCN(this.snippetCont,this._topContNode)[0]:this.snippetCont;var a="string"===typeof this.snippetTmpl?alp.gEBCN(this.snippetTmpl,this._topContNode)[0]:this.snippetTmpl;a&&(this._snippetTmplHtml=a&&a.innerHTML);a=this._moreBtnDom=this.moreBtn&&"string"===
typeof this.moreBtn?alp.gEBCN(this.moreBtn,this._topContNode):this.moreBtn;this.galleryAll?alp.style(a,{display:"none"}):(a&&0<a.length?a&&a.childNodes&&(this._moreBtnDom=[a]):this._moreBtnDom=null,this.infiScroll&&this._moreBtnDom&&alp.style(this._moreBtnDom,{display:"none"}));this._nTotalDisplayDom="string"===typeof this.nTotalDisplay?alp.gEBCN(this.nTotalDisplay):this.nTotalDisplay;if(!g(this)){if(this._already_tried_onDCL)throw console.log("oax.x.Gallery: ",this._topContNode,",",this._snippetContNode,
",",this._snippetTmplHtml,",",this.galleryAll||this._moreBtnDom),Error("oax.x.Gallery could not find all necessary DOM nodes, even after DOMContentLoaded");this._already_tried_onDCL=1;alp.onDCL(alp.bindF("setInitVal",this))}},augmentModel:function(a){a.ids_0=new alp.SortedArrayState({init_value:null});a.all_ids_set=new alp.State;a.ids_f=new alp.SortedArrayState({init_value:[]});a.n_to_show=new alp.MinMaxState({min:this.galleryAll?Infinity:this.galleryInit});a.ids_to_show=new alp.SortedArrayState({init_value:[]});
a.datas=new alp.SortedArrayState({init_value:[]});a.are_all_shown=new alp.BoolState;a.is_loading=new alp.BoolState;a.highlightId=new alp.State},connectModel2Model:alp.nowF(function(a,b,c,d){function e(){var a=c.all_ids_set.get(),b=c.ids_0.get()||[];a=a?alp.filter(b,"v in this",a):b;c.ids_f.set(a)}function g(){function a(){l.get()?k=setTimeout(g,1345):(c.is_loading.setNow(!1),k=null)}null!=k&&(clearTimeout(k),k=null);l.get()?c.is_loading.set(!0):k=setTimeout(a,1234)}function h(){c.ids_to_show.set(c.ids_f.get().slice(0,
c.n_to_show.get()))}b.push(c.ids_0.change_cb_init(e));b.push(c.all_ids_set.change_cb(e));var l=a.loadingState;l&&b.push(l.change_cb_init(g));var k;b.push(c.ids_f.change_cb(function(){a._id2index={};c.n_to_show.setToMin();h()}));b.push(c.n_to_show.change_cb(h));var m=alp.ratelimitF(300,function(){if(a._topContNode&&a._topContNode.offsetParent){for(var b=c.ids_to_show.get(),d=c.datas.get(),e=a._id2index,g=[],h=b.length,l=0;l<h;l++){var k=b[l],n=d[l];e[k]=l;n&&k===n.id||g.push(k)}a.loadingState||c.is_loading.setNow(0<
g.length);a.ooiLoader(g).load(alp.bindF(f,a))}else a.loadingState||c.is_loading.setNow(!1),setTimeout(m,250)});b.push(c.ids_to_show.change_cb(m));b.push(c.datas.change_cb_init(function(){c.are_all_shown.set(c.ids_to_show.get().length===c.ids_f.get().length);a.loadingState||c.is_loading.set(!1)}))}),connectModel2View:alp.nowF(k),connectView2Model:alp.nowF(h)});var n="_loading_waitbox",q="_last_new_data_arr",p="_highnodeid"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.snippet_list");
(function(){alp.declare("oax.x.SnippetList",oax.x.Gallery,null,{proj:null,topCont:"oax-part-list",snippetCont:"oax-list-snippet-cont",snippetTmpl:"oax-list-snippet-tmpl",moreBtn:"oax-list-further-btn",galleryInit:20,nTotalDisplay:"oax-list-n-total",snippetClassArr:["oax-list-snippet"],snippettype:"list-snippet",loadingIndicator:"oax-list-loading-indicator",emptyIndicator:"oax-list-empty-indicator",topLoadingClass:"oax-list-loading",topEmptyClass:"oax-list-empty"})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap_skiresort");
alp.gmap3(function(k){function h(a,c,d){d&&alp.m(a[b],"iwOpen",d,c)}function g(a){var d=a[b];d&&(d.setMap(null),d.eh.clear(),a[c].clear());a[b]=null;a[c]=null;if(d=a.m.ooi.get()){var g=alp.gEBCN(a.lift_iw_tmpl_dom_class)[0];g=g&&g.innerHTML;var h=alp.gEBCN(a.track_iw_tmpl_dom_class)[0];d=a[b]=new alp.ski.SkiresortLayer({what:d,lift_iw_tmpl:g,track_iw_tmpl:h&&h.innerHTML});g=a[c]=new alp.Eh;f(a);a.kx.lift_list&&(g.push(a.kx.lift_list.m.highlightId.bind_to(d.m.highlightSt)),g.push(d.m.highlightSt.bind_to(a.kx.lift_list.m.highlightId)),
e(a,"lift"),g.push(a.m.filsort_ids_lift.bind_to(d.m.restrictLiftIdsSt)));a.kx.track_list&&(g.push(a.kx.track_list.m.highlightId.bind_to(d.m.highlightSt)),g.push(d.m.highlightSt.bind_to(a.kx.track_list.m.highlightId)),e(a,"track"),g.push(a.m.filsort_ids_track.bind_to(d.m.restrictTrackIdsSt)))}}function f(a){alp.m(a[b],"setMap",a.m.map.get())}function e(a,c){var d=a.m,e=d["filsort_ids_"+c],f=e&&a[b],g=f&&f.m[c+"sDefSt"].get(),h=g&&alp.arr2o(g.tracks_arr);f=f&&f.m[c+"_idlist_st"].get();if(h&&f){g=d[c+
"_onlyOpened"].get();var k=d["sort_"+c+"_selected"].get();d=d["sort_"+c+"_key2ascendant"].get()||{};var m=a[c+"_filter_key2model"];a=a[c+"_sort_key2model"];f=[].concat(f);if(g){var t=m.onlyOpened;f=alp.filter(f,function(a){return alp.sub(t,h[a])})}t=a[k];var w=d[k]?-1:1,x=-w;f.sort(function(a,b){a=t&&alp.sub(t,h[a])||0;b=t&&alp.sub(t,h[b])||0;return a>b?x:w});e.set(f)}else e.set([])}function d(a,c,d){function e(a){a({},[])}function f(a){a({},alp.map(d,function(a){return g[a]}))}var g=(c=(a=a[b])&&
a.m[c+"sDefSt"].get())&&alp.arr2o(c.tracks_arr);return{load:g?f:e}}alp.declare("oax.x.DetailMapSkiresort",oax.x.DetailMap,null,{mapTypeId:"alpstein_map_winter",alp_kmlurl3d:function(a){if(a&&!(new k.LatLngBounds(new k.LatLng(47.23794206671351,9.65688368981422),new k.LatLng(47.76592233751612,10.856148068843051))).contains(a)){var b=["http://s2.outdooractive.com/kml_superoverlay/AlpsteinWinter/0/0/0.kmz"];(new k.LatLngBounds(new k.LatLng(45.578483912834606,5.543975830078125),new k.LatLng(47.99359789867388,
10.880584716796875))).contains(a)&&b.push("http://s2.outdooractive.com/kml_superoverlay/AlpsteinCHEWinter/0/0/0.kmz");return b}return"http://s2.outdooractive.com/kml_superoverlay/tilecache_winter_gesamt_._/0/0/0.kmz"},lift_iw_tmpl_dom_class:"oax-iw-ooi-tmpl-lift",track_iw_tmpl_dom_class:"oax-iw-ooi-tmpl-skirun",lift_count:"oax-lift-count",track_count:"oax-skirun-count",dp_lift_list_cont:"oax-list-container-1",dp_track_list_cont:"oax-list-container-2",dp_sorthead:"oax-part-sorthead",lift_filter_key2model:{onlyOpened:"opened"},
lift_sort_key2model:{type:"category.id",title:"title",open:"opened",length:"length"},track_filter_key2model:{onlyOpened:"opened"},track_sort_key2model:{title:"title",open:"opened"},augmentModel:function(a){var b=new alp.BoolState;a.lift_onlyOpened=b;a.track_onlyOpened=b;a.sort_lift_selected=new alp.State;a.sort_lift_key2ascendant=new alp.ObjectState;a.sort_track_selected=new alp.State;a.sort_track_key2ascendant=new alp.ObjectState;a.filsort_ids_lift=new alp.SortedArrayState;a.filsort_ids_track=new alp.SortedArrayState},
augmentKids:function(a){function b(a,b,c){a=e.m.lift_onlyOpened;c.originalNode.checked=a.get();return a}function c(a,b,c){a=e.m.track_onlyOpened;c.originalNode.checked=a.get();return a}var e=this,f=alp.gEBCN(this.dp_lift_list_cont,this.top)[0];f=f&&alp.gEBCN(this.dp_sorthead,f)[0];var g=alp.gEBCN(this.dp_track_list_cont,this.top)[0];g=g&&alp.gEBCN(this.dp_sorthead,g)[0];f&&(a.lift_sorthead=new alp.x.Sorthead({cont:f}),alp.styleform.init({cont:f,oncheck_init:b}),a.lift_list=new oax.x.SnippetList({proj:this.proj,
frontendtype:this.frontendtype,topCont:this.dp_lift_list_cont,galleryAll:!0,ooiLoader:alp.bindF(d,null,e,"lift"),nTotalDisplay:alp.gEBCN(this.lift_count,this.top)}));g&&(a.track_sorthead=new alp.x.Sorthead({cont:g}),alp.styleform.init({cont:g,oncheck_init:c}),a.track_list=new oax.x.SnippetList({proj:this.proj,frontendtype:this.frontendtype,topCont:this.dp_track_list_cont,galleryAll:!0,ooiLoader:alp.bindF(d,null,e,"track"),nTotalDisplay:alp.gEBCN(this.track_count,this.top)}))},connectModel2Model:function(a,
b,c,d){d.lift_list&&(b.push(c.lift_onlyOpened.change_cb_init(e,null,a,"lift")),b.push(c.sort_lift_selected.change_cb_init(e,null,a,"lift")),b.push(c.sort_lift_key2ascendant.change_cb_init(e,null,a,"lift")));d.track_list&&(b.push(c.track_onlyOpened.change_cb_init(e,null,a,"track")),b.push(c.sort_track_selected.change_cb_init(e,null,a,"track")),b.push(c.sort_track_key2ascendant.change_cb_init(e,null,a,"track")))},connectModel2View:function(a,b,c,d){b.push(c.ooi.change_cb_init(g,null,a),alp.bindF("drop_cb",
c.ooi));b.push(c.map.change_cb_init(f,null,a),alp.bindF("drop_cb",c.map));d.lift_list&&(b.push(c.filsort_ids_lift.change_cb_init("setIds",d.lift_list)),b.push(d.lift_list.clickEvt().then(alp.bindF(h,null,a,"lift"))));d.track_list&&(b.push(c.filsort_ids_track.change_cb_init("setIds",d.track_list)),b.push(d.track_list.clickEvt().then(alp.bindF(h,null,a,"track"))))},connectView2Model:function(a,b,c,d){d.lift_list&&(b.push(d.lift_sorthead.m.selected.bind_to(c.sort_lift_selected)),b.push(d.lift_sorthead.m.key2ascendant.bind_to(c.sort_lift_key2ascendant)));
d.track_list&&(b.push(d.track_sorthead.m.selected.bind_to(c.sort_track_selected)),b.push(d.track_sorthead.m.key2ascendant.bind_to(c.sort_track_key2ascendant)))}});var b="_layer",c="_layer_eh"});"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmapabstract_tour_poi_layer");
alp.gmap3(function(k){alp.declare("oax.x.DetailMapAbstractTourPoiLayer",oax.x.DetailMap,function(){this.tourPoiLayer=new alp._gmap2_3.TourPoiLayer(this.id,{proj:this.proj,tourDirectionArrowType:"black",markersActive:!0,poiMarkerOpt:{zIndex:5E9},autostartFlight3d:!0,tourWaypointAsPoi:!0,preferVector:!0})},{additional_clusterLayer_setup:function(h){function g(){alp.forEach(f.getPoiData(),"this.removeDataPoint(v.id)",h)}var f=this.tourPoiLayer;f&&f.whenLoaded(g)},connectModel2View:function(h,g,f,e){g.push(f.map.change_cb_init(function(d){var b=
oax.x.DetailMap._getDetailPaneWrapper(h)||alp.nodify(oax.DETAILPANE_LAZYCONT,h.top);if(b&&!alp.hasEmptyBCR(b)&&h.m.dpVis.get())if(b=alp.gBCR(b),alp.isRTL()){var c=alp.gViewportSize();c=c.width-b.left+Math.max(10,c.width-b.right)}else c=b.right+Math.max(10,b.left);null==c?delete h.tourPoiLayer.padding:alp.isRTL()?h.tourPoiLayer.padding={left:.1,right:c+"px",top:.1,bottom:.1}:h.tourPoiLayer.padding={left:c+"px",right:.1,top:.1,bottom:.1};h.tourPoiLayer.setMap(d);h.tourPoiLayer.init(h.id)}))}})});
"undefined"!==typeof dojo&&dojo.provide("alp.dom.scroll");
(function(){var k=alp.sub("alp.dom",null,!0);k.scroll=alp.nowF(function(g,f){function e(){if(l.hasTarget()){var a=Math.round(k.absTopBegin+(k.absTopEnd-k.absTopBegin)*l.st.getProp());d?window.scroll(0,a):g.scrollTop=a}}var d=g===alp.body()||g===document.documentElement||g===window,b=d?alp.gWindowScroll().top:g.scrollTop,c=null!=f.absoluteTop?f.absoluteTop:b+f.relativeTop,a=f.duration_ms;if(0<a){var k=h.get(g),l=k&&k.anim;k||(l=new alp.Anim,k=alp.oCreateMix(f,{anim:l}),h.setNow(g,k),l.st.change_cb(e));
k.absTopBegin=b;k.absTopEnd=c;l.cancel();l.st.setNow(l.st.min);l.speed=1E3/a;l.nextTargetMax()}else d?window.scroll(0,c):g.scrollTop=c});k.scrollIntoViewStrict=function(g,f){var e=g.offsetParent,d=e.scrollTop,b=g.offsetTop,c=b+g.clientHeight-e.clientHeight;g=Math.min(b,c);b=Math.max(b,c);(d<g||d>b)&&alp.dom.scroll(e,alp.oCreateMix(f||{},{absoluteTop:g+b>>1}))};var h=alp.mapany()})();"undefined"!==typeof dojo&&dojo.provide("oax.x.static_list");
(function(){function k(a){function b(a){return alp.opt(a.className.match(oax.ID_RX),1)}function c(){var b=alp.fVal(e.top);b&&0<alp.gEBCN(e.snippetClass,b).length&&(clearInterval(e[d]),k.call(e,a),e.init())}var e=this;e.proj.substring.a;e._top=alp.fVal(e.top);if(e._top){e._top.childNodes.a;(e.snippetClass.substring||e.snippetClass[0].substring).a;e._snippetArr=alp.gEBCN(e.snippetClass,e._top);e._idArr=alp.map(e._snippetArr,b);for(var f=e._idArr.length;f--;)e._idArr[f]||(e._idArr.splice(f,1),e._snippetArr.splice(f,
1));var g=e._id2snippetArr={};for(f=e._snippetArr.length;f--;){var h=e._idArr[f];(g[h]||(g[h]=[])).push(e._snippetArr[f])}}e._top&&e._snippetArr||null!=e[d]||(e[d]=setInterval(c,789))}function h(a,b){function d(a){a&&(alp.m(m,"showTour",a),alp.m(m,"setDataPointUnmergeable",a,!0),alp.m(m,"setSingleMarkerOptions",a,{animation:e.Animation.BOUNCE}))}function f(a){a&&(alp.m(m,"showTour"),alp.m(m,"setDataPointUnmergeable",a,!1),alp.m(m,"setSingleMarkerOptions",a,{animation:!1}))}function g(a){(a=a&&a.id)&&
b.highlightId.set(a)}function h(a){(a=a&&a.id)&&b.highlightId.is(a)&&b.highlightId.setNow()}function l(b){(b=b&&b.id)&&a.layerClickEvt().triggerSoon(b)}var k=a[c]||(a[c]=new alp.Eh);k.clear();var m=b.clusterLayer.get();m&&(k.push(a.listMouseoutEvt().then(f)),k.push(a.listMouseoverEvt().then(d)),k.push(m.listen("markerMouseover",g),"drop",m),k.push(m.listen("markerMouseout",h),"drop",m),k.push(m.listen("markerClick",l),"drop",m))}function g(b,c){function d(){var a=c.highlightId.get();l.highlightOOI(a)}
function e(a){(a=a&&a.id)&&c.highlightId.set(a)}function f(a){(a=a&&a.id)&&c.highlightId.is(a)&&c.highlightId.setNow()}function g(a){(a=a&&a.id)&&b.layerClickEvt().triggerSoon(a)}var h=b[a]||(b[a]=new alp.Eh);h.clear();var l=c.ooiLayer.get();l&&(h.push(c.highlightId.change_cb_init(d)),h.push(l.listen("markerMouseover",e),"drop",l),h.push(l.listen("markerMouseout",f),"drop",l),h.push(l.listen("markerClick",g),"drop",l))}function f(a,b){function c(a){a&&(alp.m(l,"triggerMouseoutFromId",a),alp.m(l,"setHighlight",
null))}function d(a){a&&(alp.m(l,"triggerMouseoverFromId",a),alp.m(l,"setHighlight",a))}function e(c){if((c=c&&c.id)&&!b.highlightId.is(c)&&(b.highlightId.setNow(c),c=a._id2snippetArr[c]))for(var d=c.length;d--;){var e=c[d];e.offsetParent&&alp.dom.scrollIntoViewStrict(e,{duration_ms:357})}}function f(a){(a=a&&a.id)&&b.highlightId.is(a)&&b.highlightId.setNow()}function g(b){(b=b&&b.id)&&a.layerClickEvt().triggerSoon(b)}var h=a[m]||(a[m]=new alp.Eh);h.clear();var l=b.tourPoiLayer.get();l&&(h.push(a.listMouseoutEvt().then(c)),
h.push(a.listMouseoverEvt().then(d)),h.push(l.listen("poiMouseover",e),"drop",l),h.push(l.listen("poiMouseout",f),"drop",l),h.push(l.listen("poiClick",g),"drop",l),h.push(l.listen("stageMouseover",e),"drop",l),h.push(l.listen("stageMouseout",f),"drop",l),h.push(l.listen("stageClick",g),"drop",l))}var e;alp.gmap3(function(a){e=a});alp.declare("oax.x.StaticList",alp.x.AbstractController,null,{proj:null,top:null,snippetClass:null,ignoreMouseover:!1,ignoreMouseout:!1,ignoreClick:!1,clickEvt:alp.memM("clickEvt",
'alp.event("oax:SL:clickEvt",{then:1})'),layerClickEvt:alp.memM("layerClickEvt",'alp.event("oax:SL:layerClickEvt",{then:1})'),getIds:function(){return[].concat(this._idArr)},getSnippets:function(){return this._snippetArr.slice()},setLayer:function(a){if(a){var b=alp.sub("alp._gmap2_3.ClusterLayer"),c=alp.sub("alp._gmap2_3.TourPoiLayer"),d=alp.sub("alp._gmap2_3.OOILayer");if(b&&a instanceof b)this.setClusterLayer(a);else if(c&&a instanceof c)this.setTourPoiLayer(a);else if(d&&a instanceof d)this.setOOILayer(a);
else throw Error("StaticList could not resolve "+a.declaredClass);}else this.setClusterLayer(),this.setTourPoiLayer(),this.setOOILayer()},setClusterLayer:function(a){this.m.clusterLayer.setNow(a)},setOOILayer:function(a){this.m.ooiLayer.setNow(a)},setTourPoiLayer:function(a){this.m.tourPoiLayer.setNow(a)},listMouseoverEvt:alp.memM("listMouseoverEvt",'alp.event("oax:SL:listMouseoverEvt",{then:1})'),listMouseoutEvt:alp.memM("listMouseoutEvt",'alp.event("oax:SL:listMouseoutEvt",{then:1})'),augmentModel:function(a){a.highlightId=
new alp.State;a.clusterLayer=new alp.State;a.ooiLayer=new alp.State;a.tourPoiLayer=new alp.State},augmentKids:k,connectModel2View:function(a,b,c,d){a._top&&a._id2snippetArr&&(b.push(c.highlightId.change_cb_init(function(){a._highlighted_snippet_arr&&(alp.setClass(a._highlighted_snippet_arr,oax.HIGHLIGHT,!1),a._highlighted_snippet_arr=null);var b=c.highlightId.get();if(b=b&&alp.oGet(a,["_id2snippetArr",b]))alp.setClass(b,oax.HIGHLIGHT,!0),a._highlighted_snippet_arr=b})),b.push(c.clusterLayer.change_cb_init(h,
null,a,c)),b.push(c.ooiLayer.change_cb_init(g,null,a,c)),b.push(c.tourPoiLayer.change_cb_init(f,null,a,c)))},connectView2Model:function(a,c,d,e){function f(d,e){c.push(alp.aEL(d,"mouseover",alp.nowF(function(){a[b]=e;h(e)})))}function g(c){c||(c=window.event);var e=d.highlightId.get();if(e&&e===a[b]){e=e&&a._id2snippetArr[e];for(var f=!0,g=e.length;g--;){var l=e[g];l=l&&alp.gBCR(l);var k=c.clientX,m=c.clientY;if(l&&k>=l.left&&k<=l.right&&m>l.top&&m<l.bottom){f=!1;break}}f&&(a[b]=null,h())}}function h(b){var c=
d.highlightId.get();c!==b&&(d.highlightId.setNow(b),c&&a.listMouseoutEvt().triggerSoon(c),b&&a.listMouseoverEvt().triggerSoon(b))}function l(b,d){c.push(alp.aEL(b,"click",alp.nowF(function(){a.clickEvt().triggerSoon(d)})))}a.ignoreMouseover||alp.forIn(a._id2snippetArr,f);!a.ignoreMouseout&&a._top&&(c.push(alp.aEL(a._top,"mousemove",alp.nowF(g))),c.push(alp.aEL(a._top,"mouseout",alp.nowF(g))));a.ignoreClick||alp.forIn(a._id2snippetArr,l)}});var d="_h_lazy",b="_list_mouseover_id",c="_clusterLayer_eh",
a="_ooiLayer_eh",m="_tourPoiLayer_eh"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap_tour");
alp.gmap3(function(k){var h=alp._gmap2_3;alp.declare("oax.x.DetailMapTour",oax.x.DetailMapAbstractTourPoiLayer,null,{augmentKids:function(g){var f=this;g.staticList=new oax.x.StaticList({proj:this.proj,top:alp.bindF(oax.x.DetailMap._getDetailPaneWrapper,null,this),snippetClass:oax.DETAILPANE_TOURMAP_POI_SNIPPET});g.elproView=new h.x.ElproView({proj:this.proj,top:this.top,mapPadding:function(){var e=oax.x.DetailMap._getDetailPaneWrapper(f);e=(e=e&&alp.gBCR(e))&&e.right&&e.left+e.right;return{left:e?
e+"px":.1,right:.1,top:.1,bottom:.1}}})},setInitVal:function(g,f,e,d){d.staticList.setTourPoiLayer(g.tourPoiLayer);d.elproView.setTourPoiLayer(g.tourPoiLayer)},connectView2Model:function(g,f,e,d){oax.x.DetailMap._connectPoiClickToOpen(g,f,d.staticList.clickEvt(),"oax-snippet-detailmap-tour","listMap");oax.x.DetailMap._connectPoiClickToOpen(g,f,d.staticList.layerClickEvt(),"oax-snippet-detailmap-tour","map")}})});"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap_story");
alp.gmap3(function(k){alp.declare("oax.x.DetailMapStory",oax.x.DetailMap,function(){var h=this;(new alp.data.SingleOOI(this.id,{proj:this.proj,acceptUnpublished:!0})).load(function(f){var e=alp.sub("data.geometries.ooi",f),d=[];if(e)for(var b=e.length;b--;){f=e[b];var c=alp.oGet(f,"meta.workflow.state");if(c&&(c=c.toLowerCase(),"deleted"===c||"waste"===c))continue;d.push(f.id)}h._idList=d});if(this._idList&&0<this._idList.length){this.layer=new alp._gmap2_3.ClusterLayer({proj:this.proj,initDataPointList:this._idList,
defaultIW:!1});var g=this;this.layer.listen("clusterMetaChange",function(f){f=alp.opt(oax.x.DetailMap._getDetailPaneWrapper(g),"clientWidth");g.layer.fitOOI(g._idList,{padding:{left:0<f?f+"px":.1,top:.1,bottom:.1,right:.1}})})}else this.layer=new alp._gmap2_3.TourPoiLayer(this.id,{proj:this.proj})},{_idList:[],augmentKids:function(h){h.staticList=new oax.x.StaticList({proj:this.proj,top:alp.bindF(oax.x.DetailMap._getDetailPaneWrapper,null,this),snippetClass:oax.DETAILPANE_TOURMAP_POI_SNIPPET})},setInitVal:function(h,
g,f,e){e.staticList.setLayer(h.layer)},connectModel2View:function(h,g,f,e){g.push(f.map.change_cb_init(function(d){var b=oax.x.DetailMap._getDetailPaneWrapper(h);if(b&&!alp.hasEmptyBCR(b)&&h.m.dpVis.get())if(b=alp.gBCR(b),alp.isRTL()){var c=alp.gViewportSize();c=c.width-b.left+Math.max(10,c.width-b.right)}else c=b.right+b.left;null==c?delete h.layer.padding:alp.isRTL()?h.layer.padding={left:.1,right:c+"px",top:.1,bottom:.1}:h.layer.padding={left:c+"px",right:.1,top:.1,bottom:.1};h.layer.setMap(d)}))},
connectPureView:function(h,g,f,e){oax.x.DetailMap._connectPoiClickToOpen(h,g,e.staticList.layerClickEvt(),"oax-snippet-detailmap-story","map")}})});"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap_condition");alp.gmap3(function(k){alp.declare("oax.x.DetailMapCondition",oax.x.DetailMapAbstractTourPoiLayer)});"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmapsimpleooi");
alp.gmap3(function(k){function h(f,e){f.getDataPoint(e).then(function(d){e!==alp.sub("dataPoint.id",d)?alp.asyncF(100,h)(f,e):(d=d.dataPoint,f.setDataPointUnmergeable(d,!0),f.setSingleMarkerOptions(d,{zIndex:9E9}))})}var g={};alp.declare("oax.x.DetailMapSimpleOoi",oax.x.DetailMap,null,{snippetClass:"oax-snippet-detailmap-poi",showMainOOI:!0,fitOOIs:!0,augmentKids:function(f){f.staticList=new oax.x.StaticList({proj:this.proj,top:alp.bindF(oax.x.DetailMap._getDetailPaneWrapper,null,this),snippetClass:oax.DETAILPANE_MAPLIST_SNIPPET});
var e=this.m.map.get(),d=this.dpData;if(e&&d){d=alp.arrChain(alp.map(alp.oValues(d),'alp.map(v,".id")'));var b=oax.x.DetailMap._getDetailPaneWrapper(this);if(b&&!alp.hasEmptyBCR(b)&&this.m.dpVis.get()){var c=alp.gBCR(b);alp.isRTL()?(b=alp.gViewportSize(),c=b.width-c.left+Math.max(10,b.width-c.right)):c=c.right+c.left}c=null==c?.1:alp.isRTL()?{left:.1,right:c+"px",top:.1,bottom:.1}:{left:c+"px",right:.1,top:.1,bottom:.1};var a=this.id;d=alp.filter((this.showMainOOI?[a]:[]).concat(d),"v in this  ?  false  :  ((this[v]=1),v)",
{});f.layer=new alp._gmap2_3.ClusterLayer({proj:this.proj,initDataPointList:d,defaultIW:!1});f.layer.setMap(e);this.showMainOOI&&(h(f.layer,a),f.layer.whenLoaded(function(){f.layer.setDataPointUnmergeable(a,!0);f.layer.setSingleMarkerOptions(a,{zIndex:9E9})}));this.fitOOIs&&d.length&&e.fitOOI(d,{proj:this.proj,padding:c});f.staticList.setLayer(f.layer)}},connectView2Model:function(f,e,d,b){e.push(b.staticList.m.highlightId.change_cb_init(function(){var c=f.dpData,a=alp.opt(f.layoutState,"dpTabName"),
d=b.staticList.m.highlightId.get();if(c&&a&&d){var e=a.get();if(!e||!alp.or(c[e],'.id==="'+d+'"')){for(var h in c)if(!(h in g)&&alp.or(c[h],'.id==="'+d+'"')){e=h;break}e&&a.set(e)}}}));oax.x.DetailMap._connectPoiClickToOpen(f,e,b.staticList.clickEvt(),f.snippetClass,"listMap");oax.x.DetailMap._connectPoiClickToOpen(f,e,b.staticList.layerClickEvt(),f.snippetClass,"map")}})});"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap_hut");
alp.gmap3(function(k){alp.declare("oax.x.DetailMapHut",oax.x.DetailMapSimpleOoi,null,{snippetClass:"oax-snippet-detailmap-hut"})});"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap_poi");alp.gmap3(function(k){alp.declare("oax.x.DetailMapPoi",oax.x.DetailMapSimpleOoi,null,{snippetClass:"oax-snippet-detailmap-poi"})});"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap_lodging");alp.gmap3(function(k){alp.declare("oax.x.DetailMapLodging",oax.x.DetailMapSimpleOoi,null,{snippetClass:"oax-snippet-detailmap-lodging"})});
"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap_offer");alp.gmap3(function(k){alp.declare("oax.x.DetailMapOffer",oax.x.DetailMapSimpleOoi,null,{snippetClass:"oax-snippet-detailmap-poi"})});"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap_event");alp.gmap3(function(k){alp.declare("oax.x.DetailMapEvent",oax.x.DetailMapSimpleOoi,null,{snippetClass:"oax-snippet-detailmap-poi"})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.util.set_view");
(function(){alp.sub("alp._gmap2_3",null,!0).setView=function(k,h,g){k.setCenter(h,g);k.__alp_lf__||k.setZoom(g)}})();"undefined"!==typeof dojo&&dojo.provide("alp.cfg.region");(function(){var k=alp.sub("alp.cfg",null,!0).region={strokeColor:"#dc2017",strokeWeight:10,strokeOpacity:.4,fillColor:"#ffffff",fillOpacity:.4};k.highlight=alp.oCreateMix(k,{fillColor:"#fff",fillOpacity:.4});k.clear=alp.oCreateMix(k,{strokeWeight:4,strokeOpacity:.85})})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.util.polyline_multi_unwrap");
(function(){var k=alp.sub("alp.maps",0,1),h=alp.util.math;k.polyline_multi_unwrap=function(g){g=alp.arrSorted(alp.map(g,'{n:v.length, p:v, i:i, lng_m:this.angleWmean(alp.map(v,"v[0]"))}',h),"w.n-v.n");for(var f=g.length,e=1;e<f;e++){var d=g[e],b=360*Math.round((d.lng_m-g[e-1].lng_m)/360);b&&(alp.forEach(d.p,"v[0]-="+b),d.lng_m-=b)}return alp.map(alp.arrSorted(g,"v.i-w.i"),".p")}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.region_polygon");
alp.gmap3(function(k){var h=alp.sub("alp._gmap2_3",0,1),g=alp.maps,f=alp.cfg.region;h.region_polygon=function(e,d,b){if(!alp.likeIE8minus_backslash_v()){var c=b&&b.nofill,a=b&&b.noworld;b=alp.oCreateMix(f,alp.opt(b||{},["fillColor","fillOpacity","strokeColor","strokeOpacity","strokeWeight"],!0));var m=alp.likeIE()?1500:4E3;if(d){d="string"===typeof d?d.split(";"):d;d.concat.call.a;d=g.polyline_multi_unwrap(alp.map(d,function(a){"string"===typeof a&&/^\s*(\{.*\}|\[.*\])\s*$/.test(a)&&(a=alp.oFrom(a));
"string"===typeof a&&(a={points:a,levels:alp.sRepli(String.fromCharCode(63),a.length)});"length"in a||(a=h.decodePolyline(a).xy);a.length>m&&(a=alp.simplifyGeom(a,m));return a}));var l=alp.map(d,function(a){return alp.map(a,"new this.LatLng(v[1],v[0],/*noWrap:*/true)",k)}),r=g.qt7bit.ORIG_NW(),n=g.qt7bit.ORIG_SE();r=Math.round(r.lat);n=Math.round(n.lat);n=[[-180,r],[0,r],[180,r],[180,n],[0,n],[-180,n]];n.reverse();c||a||l.push(h.xy2latlng(n));a={paths:l,strokeWeight:0,fillColor:b.fillColor,fillOpacity:b.fillOpacity};
c?alp.mix(a,{strokeColor:b.strokeColor,strokeWeight:b.strokeWeight,strokeOpacity:b.strokeOpacity,fillOpacity:0}):alp.mix(a,{strokeColor:b.strokeColor,strokeWeight:b.strokeWeight,strokeOpacity:b.strokeOpacity,fillColor:b.fillColor,fillOpacity:b.fillOpacity});c=new k.Polygon(a);c.setMap(e);c._alp_cfg=a;c._alp_xy_arr_arr=d;c._alp_latlng_arr_arr=l;c._alp_wens=function(a){return alp.reduce(a.slice(1),function(a,b){return g.bounds_from_xy(b,a)},g.bounds_from_xy(a[0]))}(d);return c}}}});
"undefined"!==typeof dojo&&dojo.provide("oax.util.region_polygon");(function(){alp.gmap3(function(g){});var k=alp.sub("oax.util",0,1),h=alp._gmap2_3;k.region_polygon=function(g,f,e){function d(b){h.event("trigger")(g,"click",b)}var b=h.region_polygon.apply(h,arguments);g&&b&&h.event("addListener")(b,"click",d);return b}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap_literature");
alp.gmap3(function(k){var h=alp.data,g=alp._gmap2_3;alp.declare("oax.x.DetailMapLiterature",oax.x.DetailMapSimpleOoi,null,{snippetClass:"oax-snippet-detailmap-literature",showMainOOI:!1,fitOOIs:!1,mapZoom:9,connectPureView:function(f,e,d,b){function c(b){h.api_show_geometry({idlist:l,catid:b.data.category.id,proj:f.proj}).then(a)}function a(a){var b=a&&a[l].coordinates,c=alp.cfg.color.highlight();c={strokeColor:a[l].lineOptions.strokeColor,strokeWeight:c.strokeWeight,strokeOpacity:c.strokeOpacity,
nofill:!0};if(a[l].type&&"multipolygon"===a[l].type.toLowerCase())for(;b.length&&"number"!==typeof b[0][0][0];)b=alp.arrChain(b);a=oax.util.region_polygon(m,b,c);a=new k.LatLngBounds(new k.LatLng(a._alp_wens[1],a._alp_wens[0]),new k.LatLng(a._alp_wens[3],a._alp_wens[2]));a=g.bounds2zoomcenter(a,{width:f.map.clientWidth,height:f.map.clientHeight});f.mapCenter=a.center;f.mapZoom=a.zoom;g.setView(m,a.center,a.zoom)}var m=f.m.map.get(),l=f.id;m&&(new h.SingleOOI(l,{proj:f.proj,acceptUnpublished:!0})).load(c)}})});
"undefined"!==typeof dojo&&dojo.provide("oax.x.detailmap_teamactivity");alp.gmap3(function(k){alp.declare("oax.x.DetailMapTeamactivity",oax.x.DetailMapSimpleOoi,null,{snippetClass:"oax-snippet-detailmap-poi"})});"undefined"!==typeof dojo&&dojo.provide("alp.util.reload_jsonp");
(function(){function k(){var g=this.url+"&reload_cnt="+this.reload_cnt++ +"_"+Math.random()+ +new Date;this.requestType&&(g+="&requestType="+this.requestType);this.pid&&(g+="&pid="+this.pid);alp.jsonp(g).then(alp.nowF(h,this))}function h(g){"abort"===alp.sub("info.status",g)?(console.error('alp.util.reloadJsonp: failed, server sent status "'+g.info.status+'"'),console.error("alp.util.reloadJsonp: full server answer:",g),this.dfrd.triggerSoon(!1,alp.sub("info.msg",g))):g.url?(g=g.url.replace(/^https?:\/\//,
"//"),this.dfrd.triggerSoon(g)):(this.requestType=g.requestType,this.pid=g.pid,alp.asyncF(this.delay_ms,k,this)())}alp.sub("alp.util",null,!0).reloadJsonp=function(g,f){var e=alp.dfrd("reloadJsonp",{then:!0});g=g.replace(/^https?:\/\//,"//");k.call({dfrd:e,reload_cnt:0,url:g,delay_ms:alp.opt(f,"delay_ms")||250});return e}})();"undefined"!==typeof dojo&&dojo.provide("alp.util.url");
(function(){var k=alp.sub("alp.util.url",null,!0);k.fix_slashes=function(h){for(var g="";h!==g;)g=h,h=h.replace(/\/\//g,"/").replace(/(^[a-zA-Z]+:\/(?!\/))/,"$1/");return h};k.replace_one=function(h,g,f,e){e||(e="?");return(h||e).replace(new RegExp("([\\"+e+"&])("+g+"=[^&]*|$)|$"),alp.f('(w||"&")+"'+g+"="+f+'"'))}})();"undefined"!==typeof dojo&&dojo.provide("alp.view.dialog.print");
(function(){function k(a,b){function c(){var b=0,c,e="",f=[];alp.forEach(alp.gEBCN("alp-pdf-layout-radio",a),function(a){a.checked&&(c=a.value)});"stagesTour"==c&&(e="-stage");var g=alp.gEBCN("alp-pdf-block-check"+e+"-pics",a)[0]&&alp.gEBCN("alp-pdf-block-check"+e+"-pics",a)[0].checked,k=alp.gEBCN("alp-pdf-block-check"+e+"-detail",a)[0];alp.forEach(alp.gEBCN("alp-pdf-block-check"+e,a),function(a){a.checked&&f.push(a.name)});"stagesTour"==c?alp.forIn(d.get(),function(c,d){"all"!==d&&c&&(b+=h(l.getNode(d),
f,e,a,g))}):alp.forEach(alp.gEBCN("alp-pdf-tour",a),function(c){c.checked&&(b+=h(c,f,e,a,g))});var m=Math.ceil(b);k&&(alp.setText(alp.gEBCN("alp-pdf-numberOfPages",a)[0],"~"+m),alp.setClass(alp.gEBCN("alp-pdf-numberOfPages-cont",a),"oax_no_display",0==m))}var d=new alp.ObjectState({init_value:{},constrain_all:function(a,b){b||(b={});if(a.all!==b.all){var c=a.all;alp.forIn(a,function(b,d){"all"!=d&&(a[d]=c)})}else c=!0,alp.forIn(a,function(a,b){"all"!==b&&(c=c&&a)}),a.all=c;return a}});g(a);var e=
alp.nodify("oax-hiddenDownloadUrlBase",a),f=alp.gA(e,"value");alp.sA(e,"value",alp.tmpl(f,b||{}));alp.forEach(alp.gEBCN(["alp-pdf-block-check","alp-pdf-block-check-stage"],a),function(a){alp.hasClass(a,"alp-pdf-select-scale")||alp.setClass(a.parentNode,"alp-bold",a.checked)});alp.styleform.init({now:!0,cont:{input:alp.gEBCN(["alp-pdf-block-check","alp-pdf-block-check-stage"],a)},labelCont:a,oncheck:function(a,b,d){alp.setClass(d.originalNode.parentNode,"alp-bold",b);c()}});alp.gEBCN("alp-pdf-select-scale",
a)[0]&&alp.aEL(alp.gEBCN("alp-pdf-select-scale",a),"change",function(){c()});var l=new alp.x.CheckboxGroup({contNode:a,inputArr:alp.gEBCN(["alp-pdf-block-check-stage-all","alp-pdf-stage"],a),objState:d,initNow:!0});alp.now(function(){d.change_cb(c)});alp.styleform.init({now:!0,cont:{input:alp.gEBCN("alp-pdf-layout-radio",a)},oncheck:function(b,d,e){var f=e.originalNode;b=alp.gEBCN("alp-layout-block",a);d=alp.filter(b,function(a){return alp.isDescendant(f,a)})[0];alp.setClass(b,"oax_layout_block_selected",
!1);alp.setClass(d,"oax_layout_block_selected",!0);alp.setClass(alp.gEBCN("alp-pdf-layout",a),"oax_no_display",!0);alp.setClass(alp.gEBCN("alp-pdf-layout-"+f.value,a),"oax_no_display",!1);"pocketTour"===f.value?alp.setClass(alp.gEBCN("oax_pages_count",a),"oax_no_display",!0):alp.setClass(alp.gEBCN("oax_pages_count",a),"oax_no_display",!1);c()}});c();alp.styleform.init({now:!0,cont:{input:alp.gEBCN("alp-pdf-foldingInstruction-check",a)},labelCont:a,oncheck:function(a,b,c){alp.setClass(c.originalNode.parentNode,
"alp-bold",b)}})}function h(a,b,c,d,e){var f=0,g=(new Function("return "+a.value))();alp.forEach(b,function(a){if("mapDetail"==a){var b=alp.gEBCN("alp-pdf-select-scale alp-pdf-block-check"+c,d)[0].options[alp.gEBCN("alp-pdf-select-scale alp-pdf-block-check"+c,d)[0].selectedIndex].value.split(",")[0];f+=parseFloat(g[a+b])}else f+=parseFloat(g[a][0]),e&&(f+=parseFloat(g[a][1]))});return f}function g(a){return alp.gEBTN("form",a)[0]}function f(a){return alp.gEBCN("oax-agbPdfOKButton",a)[0]&&alp.and([],
function(b){return a.elements[b]})}function e(b){function c(a,c){if(a){c=alp.gEBCN("oax-wait-dialog",e);var d=alp.gEBCN("oax-ready-dialog",e);alp.forEach(d,function(b){alp.sA(alp.gEBCN("oax-pdf-ready-link",b),"href",a)});alp.setClass(c,"oax_no_display",!0);alp.setClass(d,"oax_no_display",!1);alp.cE("iframe",alp.body(),{src:a,style:"display:none"})}else m.close(b._mowi),c&&alp.humane(c)}var e=b._mowi.ovCont,f;g(e)&&(f=d(e));alp.forEach(alp.gEBCN("alp-pdf-layout-radio",e),function(a){});(function(d){var f=
d||g(e).elements["oax-hiddenDownloadUrl"];a.token().then(function(a){f+=a?"&token="+a:"";console.log("xxx _AVDP_pdfLoad",e,f);alp.setClass(alp.gEBCN("oax-pdfDownload",e),"oax_no_display",!0);a=alp.gEBCN("oax-wait-dialog",e);var d=alp.gEBCN("oax-ready-dialog",e);alp.setClass(a,"oax_no_display",!1);b.googleAdsPrepare(d[0]);a=alp.gEBCN("oax-waitbox-pdf",e)[0];(new alp.x.Waitbox({targetInit:a})).startWait();alp.util.reloadJsonp(f).then(c)})})(f)}function d(a){var b=alp.gEBCN("oax-hiddenDownloadUrlBase",
a)[0].value,c="",d="",e="",f="";alp.forEach(alp.gEBCN("alp-pdf-layout-radio",a),function(a){a.checked&&(c=a.value)});if("stagesTour"==c){var g="";alp.forEach(alp.gEBCN("alp-pdf-stage",a),function(a){a.checked&&(a=(new Function("return "+a.value))(),g+=a.id+",")});b=b.replace("&ids=","&idMaintour=");""!=g&&(b=b+"&ids="+g.slice(0,-1));e="-stage";c="tour"}""!=c&&(b=b+"&layout="+c);alp.gEBCN("alp-pdf-select-scale alp-pdf-block-check"+e,a)[0]&&(d=alp.gEBCN("alp-pdf-select-scale alp-pdf-block-check"+e,
a)[0].options[alp.gEBCN("alp-pdf-select-scale alp-pdf-block-check"+e,a)[0].selectedIndex].value.split(",")[0],""!=d&&(b=b+"&scale="+d));"pocketTour"==c?(f="pocket",alp.gEBCN("alp-pdf-foldingInstruction-check",a)[0].checked&&(f+=",foldingInstruction"),b=b+"&blocks="+f):(alp.forEach(alp.gEBCN("alp-pdf-block-check"+e,a),function(a){a.checked&&(f=f+a.name+",")}),""!=f&&(b=b+"&blocks="+f.slice(0,-1)));var h="";alp.forEach(alp.gEBCN("alp-pdf-debug-check",a),function(a){a.checked&&(h=h+a.name+",")});""!=
h&&(b=b+"&debug="+h.slice(0,-1));var l="";alp.forEach(alp.gEBCN("alp-pdf-config-check",a),function(a){a.checked&&(l=l+a.name+",")});""!=l&&(b=b+"&config="+l.slice(0,-1));return alp.util.url.fix_slashes(b)}var b=alp.sub("alp.view.dialog.print",null,!0),c=alp.view.dialog,a=alp.data.api,m=alp.view.modalwin;c.InterfacePrintExport={width:null,height:null,openModalwin:function(a){a||(a=window.event);a&&alp.stopEvent(a);var b=this;this.template=alp.nodify(this.template);this._mowi=m.open({html:this.template.innerHTML,
title:this.title,height:this.height,width:this.width,onOpenNow:alp.bindF("setupInteractivity",this),onCloseLater:function(){b._mowi=null}})},setupInteractivity:function(a,b,c){alp.installNode(null,null,a);k(a,this);a=g(a);f(a)?(a=a&&alp.gEBCN("oax-agbPdfOKButton",a))&&alp.aEL(a,"click",alp.bindF(e,null,this)):e(this)}};b.init=function(a){var b=alp.mix({},c.InterfaceCommonExport,c.InterfacePrintExport);alp.mixCheck(b,a);b.node.a;return b}})();"undefined"!==typeof dojo&&dojo.provide("oax.pdf");
(function(){function k(e,d){var b;alp.asyncSeq().next(function(c){(b=alp.nodify(h.PDF_DIALOG+e))?c():(new alp.data.SingleOOI(e,{acceptUnpublished:!0})).load(function(a,f){a=a.data;var g=alp.tmpl(h.PDF_DIALOG_MARKUP_JSONP_URL_TMPL,{id:a.id,frontendtype:a.frontendtype,plugintype:h.PLUGINTYPE,withWaitingReadyDialog:!!alp.gEBCN("oax-hidden-pdf-wait-dialog")[0]});alp.jsonp(g,{cache:!0}).then(function(a){a=a.answer;if("ok"!==a.status)throw Error("pdf dialog got an error status:"+a.status+", code:"+a.code+
" while fetching markup from URL: "+g);b=alp.cE("div",alp.body(),{"class":h.PDF_DIALOG+e+" "+h.NO_DISPLAY,style:"display: none"},{innerHTML:a.html});d.template=b;c()})})}).next(function(c){var a=alp.gEBCN("oax-hidden-pdf-wait-dialog")[0];a&&!alp.gEBCN("oax-wait-dialog",b)[0]&&(a=alp.cE("div",null,null,{innerHTML:a.innerHTML}),alp.aC(b,alp.nodify("oax-wait-dialog",a)));(a=alp.gEBCN("oax-hidden-pdf-ready-dialog")[0])&&!alp.gEBCN("oax-ready-dialog",b)[0]&&(a=alp.cE("div",null,null,{innerHTML:a.innerHTML}),
alp.aC(b,alp.nodify("oax-ready-dialog",a)));c()}).next(function(b){d.openModalwinOrLogin();b()})}var h=alp.sub("oax",null,!0),g=oa.util.login,f=oa.util.community;h.pdfDialog=function(e,d,b){function c(){var c=a[0]||a;c&&!b.title&&(h.title=alp.gA(c,"title"));k(e,h)}b=b||{};var a="string"===typeof d?alp.gEBCN(d):d,h=alp.view.dialog.print.init({node:a,title:b.title,height:b.height||480,width:b.width||850,login_indicator:f.login_indicator,login_open_dialog:alp.bindF(g.open_login,null,b),login_before:alp.bindF(f.generic_login_barrier_before,
null,b),login_after:alp.bindF(f.generic_login_barrier_after,null,b)});alp.aEL(a,"click",c);h.openModalwinAfterLogin(function(){c()})};h.openPdfDialog=k})();"undefined"!==typeof dojo&&dojo.provide("oax.detailpage");
(function(){function k(b,c){var a=b._;oax.util.ooi_links.fix_later(c,{actionOpenType:a.resolved_actionOpenType,proj:b.proj,openOOIUrl:alp.oGet(b,"cfg.openOOIUrl"),opener:a.actionOpener,back2id:b.id,back2title:a.ooiData.data.title,back2frontendtype:a.ooiData.data.frontendtype}).then(function(){alp.forEach(alp.gEBCN(oax.CONT_EACH_WRAP_ANCHOR,a.top),alp.dom.anchor.wrap_ooi_snippet)})}var h=oax.community_layout,g=oax.util.event,f=oa.ga_track_anonymous,e=alp.content;alp.declare("oax.DetailPage",null,alp.nowF(function(b){this._opt=
b;alp.mixCheck(this,b);this.actionOpenType&&alp.oSet(this,"cfg.actionOpenType",this.actionOpenType);this.openOOIUrl&&alp.oSet(this,"cfg.openOOIUrl",this.openOOIUrl)}),alp.util.InterfaceWithInit,oa.i.IMapClients,{proj:null,key:null,id:null,cfg:null,actionOpenType:null,mcpCatList:null,mcpInitList:null,mcpInitCheckedIds:"",dpNode:"oax-top-cont",markupTop:"oax-part-singleviewpage",mapNode:oa.MAP_DETAIL,mapType:null,back2flexview:null,back2detailid:null,back2detailtitle:null,openOOIUrl:null,withUrlHash:!0,
onFullscreenChange:null,onInpageOpen:null,onOverlayChange:null,initASAP:alp.nowF(function(){var b=this,c=b.flexOpener,a=b._||(b._={}),m=a.initSeq||(a.initSeq=alp.asyncSeq());a.isDestroyed=!1;m.next(function(c){(new alp.data.SingleOOI(b.id,{proj:b.proj,acceptUnpublished:!0})).load(function(b,d){a.ooiData=b;a.ooiGeom=d;c()})}).next(function(c){oa.api.maps(function(d,e){d=a.frontendtype=a.ooiData.data.frontendtype;e=d.charAt(0).toUpperCase()+d.slice(1);var f="oax.x.DetailMap"+e,g=alp.sub(f);if(!g)throw Error('could not find detail map constructor with name "'+
f+'" for frontendtype "'+d+'"');a.detailMapCtor=g;a.resolved_actionOpenType=alp.oGet(b,"cfg.actionOpenType")||a.detailMapCtor.prototype.actionOpenType;a.detailExtraCtor=alp.sub("oax.x.DetailExtra"+e);c()})}).next(function(c){function e(){a.map=a.top&&alp.nodify(b.mapNode,a.top)||null;c()}a.dp="string"===typeof b.dpNode?alp.gEBI(b.dpNode)||alp.gEBCN(b.dpNode)[0]:b.dpNode;a.top="string"===typeof b.markupTop?alp.nodify(b.markupTop,a.dp):b.markupTop;alp.setClass(a.dp||alp.body(),"oax",!0);var f=b[d]||
(b[d]=new alp.x.Waitbox({delay_ms:33})),g=a.dp.parentNode;alp.style(g,{minWidth:"100px",minHeight:"100px"});f.setTarget(g);f.startWait();if(a.top&&0<a.top.childNodes.length)e();else{var h=alp.tmpl(oax.DETAILPAGE_MARKUP_JSONP_URL_TMPL,{id:b.id,frontendtype:a.frontendtype,plugintype:oax.PLUGINTYPE});alp.jsonp(h,{cache:!0}).then(function(c){c=c.answer;if("ok"!==c.status)throw Error("detailpage got an error status:"+c.status+", code:"+c.code+" while fetching markup from URL: "+h);c=alp.cE("div",null,
null,{innerHTML:c.html});a.top=alp.gEBCN(b.markupTop,c)[0];if(!a.top)throw Error("detailpage could not find top node in the received HTML.");a.dp.appendChild(a.top);e()})}}).next(function(c){a.flexOpener=b.flexOpener||oa.x.getFlexOpener({top:a.dp,firstPage:b,firstPageOpt:b._opt,inWithUrlHash:b.withUrlHash});a.actionOpener=a.flexOpener.getActionOpener();c()}).next(function(c){function d(a){alp.stopEvent(a||window.event);b._.flexOpener.backToPreviousPage(b)}function e(c){var d=alp.gEBCN(c,a.top),e=
{type:c,contentId:b.id};c==oax.ADD_COMMENT_CONT?(e.context="comment",e.hash=!0):c==oax.ADD_CONDITION_CONT?e.context="condition":c==oax.ADD_BASKET_CONT&&(e.context="basket",d=alp.filter(d,'alp.hasClass(v.parentElement, "oax_head_bar")'));alp.aEL(d,"click",alp.bindF(g,null,e));alp.aEL(d,"touchstart",alp.bindF(g,null,e))}function g(a,b){alp.stopEvent(b||window.event);h.open_login_dialog(a)}function l(a){alp.stopEvent(a||window.event);b.back2detailidClickEvt().triggerSoon(b._back2detailid)}alp.setClass(a.top,
oax.OAX_CLASS,!0);b.trackFirstInit&&oax.api.trackDetail(b.id);var m=alp.bindF(k,null,b);b._layout=new oax.DetailLayout(alp.mix({topCont:a.dp},alp.opt(b,["id","proj"]),alp.opt(a,["frontendtype","flexOpener"]),{flexOpenerPage:b,lazy_snippets_fix_ooi_links:m}));b._layout.tabClickEvt().bindEvent(b.tabClickEvt());h.login_indicator()||alp.forEach([oax.ADD_COMMENT_CONT,oax.ADD_CONDITION_CONT,oax.ADD_BASKET_CONT],e);b._back2detailid=b.back2detailid;b._back2detailtitle=b.back2detailtitle;if(!b._back2detailid){var u=
(m=(m=alp.sessionStorage())&&alp.opt(alp.oFrom(m[oax.BACK2DETAILPAGE_SESTOR]),b.id))&&m.id&&(alp.m(b,"cfg.openOOIUrl",m)||alp.m(alp.sub("cfg.actionOpener.dp",b),"openOOIUrl",m));u&&(b._back2detailid=b._back2detailid_sestor=m.id,b._back2detailtitle=m.title,b._back2detailurl=u)}if(b._back2detailid){b._back2detailid.substring.call.a;m=alp.gEBCN(oax.BACK2DETAILPAGE_CONT,a.top);u=alp.gEBCN(oax.BACK2DETAILPAGE_LINK,a.top);var t=alp.gEBCN(oax.BACK2DETAILPAGE_TITLE,a.top);b._back2detailid_sestor?alp.aEL(alp.sA(u,
"href",b._back2detailurl),"click",function(){oax.util.waitpageout()}):alp.aEL(m,"click",alp.nowF(l));alp.setText(t,b._back2detailtitle||"");alp.setClass(m,oax.NO_DISPLAY,!1);alp.gEBCN("oax-header-hr",a.top)&&alp.setClass(alp.gEBCN("oax-header-hr",a.top),"oax_block",!0)}else alp.setClass(alp.gEBCN(oax.BACK2DETAILPAGE_CONT,a.top),oax.NO_DISPLAY,!0);m=alp.gEBCN(oax.BACK_NATIVE,a.top);m.length&&(b===a.flexOpener.firstPage?alp.supportsHistory()&&1<history.length&&document.referrer:1<a.flexOpener.m.hist.get().length)&&
(alp.aEL(m,"click",d,!0),alp.setClass(m,oax.NO_DISPLAY,!1));m=alp.gEBCN("oax-print-wide-button",a.dp);u={type:"PDF:LOGIN:"+b.id,context:"pdf",dynamicRedirect:!0,onClose:function(){f.emitCustomClick(f.DETAIL,"login barrier break")}};m&&m.length&&oax.pdfDialog(b.id,m,u);(m=alp.gEBCN("oax-print-button",a.dp))&&m.length&&(u.height=410,u.width=550,oax.pdfDialog(b.id,m,u));c()}).next(function(c){k(b,a.top);c()}).next(function(c){var d=alp.nodify(oax.DETAILPANE_DATA,a.top);d=(d=alp.opt(d,"value"))&&(new Function("return "+
d))();var e=b.cfg||{},f=alp.oGet(e,"maplayer.basemap.init")||alp.oGet(e,["maplayer","basemap","layer",0])||"oa_map";"oa_map"===f&&alp.oGet(a.ooiData,"data.winterActivity")&&(f="oa_map_winter",alp.oSet(e,"maplayer.basemap.init",f));a.detailMapCfg=alp.oCreateMix(alp.opt(b,["proj","id","mcpCatList","mcpInitList","mcpInitCheckedIds"]),alp.mix({frontendtype:a.frontendtype,map:a.map||null,mapCenter:a.ooiGeom,top:a.top,mapTypeId:f,layoutState:b._layout.layoutState,dpData:d,flexOpener:a.flexOpener},b.cfg));
a.detailExtraCfg=alp.oCreateMix(alp.opt(b,["proj","id"]),{cont:a.top,flexOpener:a.flexOpener,flexOpenerPage:b});c()}).next(function(a){alp.m(b[d],"stopWait");a()}).next(function(c){oax.api.maps(function(d,e){var f=b.detailMap=new a.detailMapCtor(a.detailMapCfg);b.detailMap.init();a.detailExtraCtor&&(b.detailExtra=new a.detailExtraCtor(a.detailExtraCfg),b.detailExtra.init(),b.detailMap.connectToExtra(b.detailExtra));var g=b.detailMap.m.map.change_cb_init(function(){f!==b.detailMap?alp.rEL(g):b._mapClients().setMap(f.m.map.get())});
c()})}).next(function(a){var c=b.detailMap,d=b.detailExtra||null;c=alp.filterIn({map:c.m.mapVis,lightbox:c.layoutState.isLightboxOpenSt,weather:d&&alp.oGet(d,"kx.weather.m.open"),avalanche:d&&alp.oGet(d,"kx.avalancheShort.m.detailOpen")},"");b._overlayMode=new alp.x.Mode({name2bool:c,initNow:!0});a()}).next(function(a){var c=b._.flexOpener;g.install(b.detailMap.m.mapVis,b,"fullscreenChangeEvt");g.install(b._overlayMode.m.name,b,"overlayChangeEvt");b!==c.firstPage||b._fO_inpageOpenEvt||(b._fO_inpageOpenEvt=
!0,g.install(c.m.inpageDetail,b,"inpageOpenEvt"));b.overlayChangeEvt().then(function(a,c){a&&e.track({proj:b.proj,id:b.id,aspect:"openOverlay",nocache:!0});!a&&c&&oax.api.trackDetail(b.id,{nocache:!0})});a()}).next(function(a){alp.rA(alp.gEBCN(oa.START_HIDDEN),"style","");b.mark_init_done(b);a()});b.onFullscreenChange&&this.fullscreenChangeEvt().then(this.onFullscreenChange);!b.onInpageOpen||c||b._oio_second_time||(b._oio_second_time=!0,this.inpageOpenEvt().then(this.onInpageOpen))}),destroyASAP:function(){var b=
this,c=b._;c.isDestroyed=!0;c.initSeq.next(function(a){alp.m(b._layout,"destroy");b._layout=null;b.detailMap&&(b.detailMap.disconnect(),b.detailMap=null);b.detailExtra&&(b.detailExtra.disconnect(),b.detailExtra=null);alp.isDescendant(c.top,c.dp)&&alp.empty(c.dp);b._mapClients().setMap();a()})},isDestroyed:alp.memM("isDestroyed",'!!alp.oGet(this,"_.isDestroyed")'),fullscreenChangeEvt:alp.memM("fullscreenChangeEvt",'alp.event("OAX:DP:fullscreenChangeEvt",{then:1})'),inpageOpenEvt:alp.memM("inpageOpenEvt",
'alp.event("OAX:DP:inpageOpenEvt",{then:1})'),overlayChangeEvt:alp.memM("overlayChangeEvt",'alp.event("OAX:DP:overlayChangeEvt",{then:1})'),back2detailidClickEvt:alp.memM("back2detailidClickEvt",'alp.event("OAX:DP:back2detailidClickEvt",{then:1})'),trackFirstInit:!0,tabClickEvt:alp.memM("tabClickEvt",'alp.event("OAX:DP:tabClickEvt",{then:1})'),_showOverlay:function(b){var c=this;c.whenLoaded(function(){c.detailMap.showOverlay(b);c.detailExtra.showOverlay(b)})}});var d="_dp_waitbox"})();
"undefined"!==typeof dojo&&dojo.provide("alp.cfg.country");(function(){alp.sub("alp.cfg",null,!0).countryShortCode=function(h){h=h.toUpperCase();return h in k?k[h]:h[0]};var k={SLO:"SL",LIE:"LI",DEU:"D",AUT:"A",CH:"CH",ITA:"I"}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.fvp");
(function(){var k=alp.sub("oa.util",null,!0),h=alp.data,g=h.api,f=alp.i.state,e=alp.maps,d=oa.cfg,b=e.mapconfig.SEP(),c=d.BM_CENTER;k.fvp_cfg_map_init=function(a,c){function d(a){return e+b+a}if(c){var e=c.basemap,f=c.style,g=c.network;c=c.overlay;b||null.bug;var h=oa._MAPCONFIG;h&&(h=alp.arrChain(alp.map(h.maps,function(a){return alp.map(a.styles,function(c){return a.name+b+c.name})})),alp.oSet(a,"maplayer.basemap.layer",h));if(f&&!e!==!f)console.error("mapInit: please give either both `basemap` and `style`, or none of them.");
else{var k=f&&d(f)||(k=alp.oGet(a,"maplayer.basemap.layer"))&&k[0];k&&alp.oSet(a,"maplayer.basemap.init",k)}if(g||c)f=alp.sub("maplayer.mapoverlay",a,!0),a=f.layer||(f.layer=[]),f=f.init||(f.init={}),g=alp.mapfilter([g].concat("string"===typeof c?[c]:c.split(",")),"v  &&  this( v )","",d),a.push.apply(a,g),alp.forEach(g,"this[v]=true",f)}};k.fvp_determine_frontendtype=function(a){var b=a.frontendtype;a.initDataPointList&&(b="any");b||(b="tour");"any"===b&&(b="toptipps",a.initDataPointList||(a.initDataPointList=
[]));a.frontendtype=b};k.fvp_determine_poi=function(a){var b=a.poi;if(null==b){var d=alp.oGet(a._flexviewCfg,c);d&&"string"===typeof d&&(b=d)}a._flexviewCfg.poiSt=f.stringState(b)};k.fvp_setup_dataPointListSt=function(a,b){function d(a){return a?alp.filter(a,"v in this  ?  false  :  (this[v] = true)",{}):a}function e(b){var d=m?alp.arr2oSimple([k],"{}"):k;d.proj=a.proj;var e=d.searchNearby;if(e){if(!e.location){var l=alp.f("v  &&  { lng: v[0], lat: v[1] }");l=l(alp.oGet(a._flexviewCfg,c))||a.getCenter()||
l(alp.oGet(oa.cfg.cfg_flexview.DEFAULT,c));e.location=l}e.radius||(e.radius=2E4)}alp.m(g.requestIds(d),["to","then"],function(c){(c=c&&c.success&&alp.oGet(c,"data.ids"))&&0<c.length&&f.setNow(w,c);c=e&&e.drawCircle;h(a,c&&{latlng:e.location,radius:e.radius,circle_opt:c},b)})}function h(a,b,c){a||null.bug;alp.m(alp.subDfrd("flexview",a),["to","then"],function(a){alp.m(a,"_setNearbyCircle",b)});alp.fVal(c)}var k=b?b.dpl:a.initDataPointList,m="string"===typeof k,v=k&&(m||!(k instanceof Array)),u=v?[]:
k,t=alp.Later?{constrain:d}:{constrain_def:d},w=alp.mix(a.dataPointListSt||(a.dataPointListSt=f.state(u)),t);f.setNow(w,u);u=v?e:alp.fVal;v||h(a);if(b&&b.now)u();else return u};k.fvp_solve_center_from_ids=function(a,b){function d(d,f){d=alp.map(f,"alp.data.ooi_geometry(v)");d=e.bounds_from_xy(d).center;alp.oSet(a._flexviewCfg,c,[d.lng,d.lat]);b()}var f=alp.oGet(a._flexviewCfg,c);f&&"string"===typeof f?(new h.OOIs({proj:a.proj,idlist:f,minimal:!0})).load(d):b()}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.init_geo_ip");
(function(){var k=alp.sub("oa.util",null,!0),h=alp.data;k.init_geo_ip=function(g,f){k.to(h.api_ip_location(),function(e){var d=e&&e.lat;e=e&&e.lng;alp.isFiniteNumber(d)&&alp.isFiniteNumber(e)?(g.center=[e,d],g.zoom=10):console.error("Could not determine IP location. Moving on.");f()})}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.link_webapp_fix_highlight");
(function(){alp.sub("oa.util",null,!0).link_webapp_fix_highlight=function(){function h(a){for(;(a=a.parentNode)&&!(1<alp.gEBTN("a",a).length););return a}function g(a){return alp.sEditDistanceLevenshtein(a.href,e)}function f(a,b){alp.setClass(a,oa.ACTIVE,b===c)}if(!k){k=!0;var e=location.href,d='a[href*="'+location.pathname+'"]',b=alp.qS(d+'[class~="'+oa.ACTIVE+'"]');if(b=b&&h(b))if(d=alp.qSA(d,b),1<d.length){var c=alp.arrMinIndex(d,g);alp.forEach(d,f)}}};var k})();"undefined"!==typeof dojo&&dojo.provide("oa.util.map_user_cfg");
(function(){alp.sub("oa.util",null,!0).user_gave_extent=function(k,h){h||(h=k.cfg);return k.center||null!=k.zoom||k.bbox||h&&(alp.oGet(h,"maplayer.basemap.center")||null!=alp.oGet(h,"maplayer.basemap.zoom")||alp.oGet(h,"maplayer.basemap.bbox"))}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.mapconfig");
(function(){var k=alp.sub("oa.util.mapconfig",null,!0),h=alp.data.api,g=oa.util;k.bbox_maybe_ensure_loading_mapconfig=function(e){e[f]=g.user_gave_extent(e)?!1:h.get_mapconfig_dfrd()};k.bbox_maybe_use_mapconfig=function(e,d,b){function c(a){var c=a.bounds;c&&alp.oSet(d,"maplayer.basemap.bbox",c[0].concat(c[1]).join(","));if(a=a.center)c=a.zoom,alp.oSet(d,"maplayer.basemap.center",a.point),alp.oSet(d,"maplayer.basemap.zoom",c);b()}e=e[f];null!=e||null.bug;!1===e?b():e.to||e.then?alp.m(e,["to","then"],
c):null.bug};var f="_bbox_mapconfig_maybe_dfrd"})();"undefined"!==typeof dojo&&dojo.provide("oa.x.travelGuide_map_btn");
(function(){function k(d,b,c){d._poly||(d._poly={});var a={};alp.forEach(c,function(c,e){e={strokeColor:0===e?"#f00":"#6f6f6f",nofill:!0};var f=c.bbox,g=f[0];f=f[1];g=[[g,[g[0],f[1]],f,[f[0],g[1]],g]];d._poly[c.id]?(a[c.id]=d._poly[c.id],a[c.id].setOptions(e),delete d._poly[c.id]):a[c.id]=d.drawOnePoly(b,g,e)});alp.forIn(d._poly,function(a){a.setMap(null)});d._poly=a}var h=alp.i.state,g=alp.Later,f=oa.API_SERVER+alp.i18n.language()+"/toGuide.json?activity=${catid}&territory=${area}",e=oa.API_SERVER+
"api/v2/project/outdooractive/geosearch/regions?key=alpregiodev&lang=en&bbox=${bbox}&count=${count}";alp.declare("oa.x.TravelGuideMapBtn",g?alp.x2.AController:alp.x.AbstractController,null,oa.i.IMapLayerPanel,{changeEvt:null,whatWhereInit:null,wrapperNode:null,detailPaneVisSt:null,viewModeSt:null,viewFullSt:null,mapMaybeDfrd:null,bindMapEvts:null,isWhereSet:!1,drawOnePoly:null,updateView:h.nowF(function(d,b){if(this.wrapperNode){var c=alp.gBCR(this.wrapperNode);c=Math.round(c.width/2);h.set(d,this.m.isVisible,
b);h.set(d,this.m.offset,c)}}),augmentModel:function(d){d.area=h.stringState(this.whatWhereInit&&this.whatWhereInit.area);d.catId=h.stringState(this.whatWhereInit&&this.whatWhereInit.catid);d.guide=h.state();d.isVisible=h.boolState(!1);d.offset=h.intState();d.viewMode=this.viewModeSt||alp.state(oa.MODE_MAP);d.dpVis=this.detailPaneVisSt||alp.boolState(!1);d.isFull=this.viewFullSt||alp.boolState(!0);this.isWhereSet=this.whatWhereInit&&!!this.whatWhereInit.area},connectModel2View:function(d,b,c,a){function e(){if(d.wrapperNode){var a=
c.viewMode.get()===oa.MODE_LISTMAP&&c.dpVis.get(),b=c.offset.get(),e=c.isFull.get()?114:174;a&&(b=Math.min(e,b));alp.style(d.wrapperNode,{left:"calc(50% - "+b+"px)"})}}b.push(h.chenInit(c.guide,function(){var a=d.m.guide.get();if(a){var b=a.title,c=a.href,e=a.color;if(!d.wrapperNode){var f=alp.nodify("oax-map-container");d.wrapperNode=alp.cE("div",f,{"class":"oax_where_what_teaser"},{innerHTML:'<a href="#" target="_blank" class="oax_ellipsis oax_btn oax_btn_dark oax_btn_large"><span class="oax-icon-book"></span> <span class="oax-where-teaser-text"></span></a>'})}if(b&&
c){var g=alp.gEBTN("a",d.wrapperNode)[0];alp.sA(g,"href",(alp.Later?"/mobile":"")+c);alp.gEBCN("oax-where-teaser-text",d.wrapperNode)[0].innerHTML=b}g.style=e?"background-color:"+e+";":""}d.updateView(!!a)}));b.push(h.chenInit(c.isVisible,function(){if(d.wrapperNode){var a=d.m.isVisible.get();alp.style(d.wrapperNode,{visibility:a?"visible":"hidden"})}}));b.push(h.chenInit(c.offset,e));d.detailPaneVisSt&&b.push(h.chen(c.dpVis,e));d.viewModeSt&&b.push(h.chen(c.viewMode,e));d.viewFullSt&&b.push(h.chen(c.isFull,
e))},connectModel2Model:function(d,b,c,a){function m(a){a=alp.tmpl(f,{area:d.m.area.get(),catid:d.m.catId.get()});h.to(alp.jsonp(a),h.nowF(function(a,b){b&&b.href&&b.title?h.set(a,d.m.guide,b):h.set(a,d.m.guide,null)}))}function l(a){if(!d.isWhereSet){var b=/[\?&]drawPolys=(\d+)(?:&|$)/,f=!g&&b.test(location.search)&&d.drawOnePoly;b=f?location.search.match(b)[1]:1;var l=a.getBounds(),m=l.getNorthEast();l=l.getSouthWest();m=(g?l.lng:l.lng()).toFixed(2)+","+(g?l.lat:l.lat()).toFixed(2)+","+(g?m.lng:
m.lng()).toFixed(2)+","+(g?m.lat:m.lat()).toFixed(2);b=alp.tmpl(e,{bbox:m,count:b});h.to(alp.jsonp(b),h.nowF(function(b,e){var g=(e=alp.oGet(e,"answer.contents"))&&e[0].id;d.isWhereSet||(h.set(b,c.area,g||null),f&&k(d,a,e))}))}}b.push(d.changeEvt().then(h.nowF(function(a,b){d.isWhereSet=!!b.area;b&&b.area&&(!b.area&&d.mapMaybeDfrd?g?d.mapMaybeDfrd.to(l):l(d.mapMaybeDfrd):b.area&&h.set(a,d.m.area,b.area));h.set(a,d.m.catId,b&&b.catid||null)})));b.push(h.chenInit(c.area,h.nowF(m,d)));b.push(h.chenInit(c.catId,
h.nowF(m,d)));d.bindMapEvts&&(d.bindMapEvts(alp.ratelimitF(123,l)),d.mapMaybeDfrd&&(g?d.mapMaybeDfrd.to(l):l(d.mapMaybeDfrd)))}});oa.x.TravelGuideMapBtn.install=function(d){d=alp.mix(d||{},{initNow:!0});return new oa.x.TravelGuideMapBtn(d)}})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.unscript");
(function(){alp.sub("alp.dom",0,1).unscript=function(k){alp.Aps.call(alp.gEBTN("script",k)).forEach(function(h){if(/^text\/html$/i.test(alp.gA(h,"type"))&&!alp.hasClass(h,"oax-no-unscript")){var g=alp.cE("div",null,{"class":"alp-dom-unscripted"},{innerHTML:h.innerHTML});alp.installNode(null,null,g);alp.place(alp.Aps.call(alp.children(g)),h,"before");alp.orphan(h)}});return alp.setClass(k,"alp-dom-unscripted",!0)}})();"undefined"!==typeof dojo&&dojo.provide("oax.flexview_layout");
(function(){function k(a){function b(){var b=!!a._dataPointListSt.get(),c=a._getNode("oax-flexView");c&&alp.setClass(c,"oax_no_filter_selectors_wrapper",b)}function c(){g(a);var b=a._getNode("oax-flexView").offsetWidth;a._setClassIfNode("oax-flexView","oax_smallFlexView",1019>b);a._setClassIfNode("oax-flexView","oax_mediumFlexView",1018<b&&1500>b)}d.slideshow_setup(a.topNode);a._eh.push(a._filterOpen.change_cb_init(function(b){var c=a._getNode("oax-filter");c&&(alp.setClass(alp.filter([a._getNode("oax-filter-open")],
""),oax.NO_DISPLAY,b),alp.setClass(alp.filter([a._getNode("oax-filter-close")],""),oax.NO_DISPLAY,!b),alp.setClass(alp.filter([c,a._getNode("oax-filter-container")],""),oax.NO_DISPLAY,!b),alp.setClass(alp.filter([a._getNode("oax-flexView-container")],""),"oax_open_filter",b),f(a))}));a._dataPointListSt&&a._eh.push(a._dataPointListSt.change_cb_init(b));a._getNode("oax-filter-open-click")&&a._eh.push(alp.aEL(a._getNode("oax-filter-open-click"),"click",function(){a._filterOpen.setNow(!0)}));a._getNode("oax-filter-close-click")&&
a._eh.push(alp.aEL(a._getNode("oax-filter-close-click"),"click",function(){a._filterOpen.setNow(!1)}));null!=a._getNode("oax-show-additional-attribute")&&a._eh.push(alp.aEL(a._getNode("oax-show-additional-attribute"),"change",function(b){b||(b=window.event);b=(b.target||b.srcElement).value;alp.setClass(a._getNode("oax-list"),[["oax_show_*",!1],[b,!0]])}));null!=a._getNode("oax-show-additional-attribute-small")&&a._eh.push(alp.aEL(a._getNode("oax-show-additional-attribute-small"),"change",function(b){b||
(b=window.event);b=(b.target||b.srcElement).value;alp.setClass(a._getNode("oax-list"),[["oax_showSmallView_*",!1],[b,!0]])}));var e=a.mode2btn={},k=2>a._modes.length,q,p;k&&((q=a._getNode("oax_view_controls"))&&alp.setClass(q,oax.NO_DISPLAY,k),(p=a._getNode("oax-map-container"))&&alp.setClass(p,"oax_no_view_controls",!0));alp.forEach(a._modes,function(b){var c=a._getNode("oax-show-"+b);c&&(alp.setClass(c,oax.NO_DISPLAY,k),a._eh.push(alp.aEL(c,"click",function(){a.flexOpener.setFvView(a.flexOpenerPage,
b)})),e[b]=c)});a._eh.push(a._showed.change_cb_init(function(){var b=a._showed.get(),c=a._showed.getPrevious(),d=oax.MODESET_FLEXVIEW_MODE_W_MAP[b],e={"oax-gallery-container":b===oax.MODE_GALLERY,"oax-list-container":b===oax.MODE_LIST,"oax-magazine-container":b===oax.MODE_MAGAZINE,"oax-map-container":d,"oax-mapList-wrapper":b===oax.MODE_LISTMAP,"oax-mapList-toggled":!1};c&&alp.setClass(a._getNode("oax-part-flexviewpage"),oax.FLEXVIEW_MODE_CLASS+c,!1);alp.setClass(a._getNode("oax-part-flexviewpage"),
oax.FLEXVIEW_MODE_CLASS+b,!0);alp.forIn(e,function(b,c){alp.setClass(a._getNodeArr(c),oax.NO_DISPLAY,!b)});a._getNode("oax-flexView-container")&&alp.setClass(a._getNode("oax-flexView-container"),{oax_show_gradient:b===oax.MODE_GALLERY||b===oax.MODE_MAGAZINE,oax_show_block:b===oax.MODE_LIST});a._getNodeArr("oax-view-control")&&alp.setClass(a._getNodeArr("oax-view-control"),"oax_selected",!1);a._getNodeArr("oax-show-"+b)&&alp.setClass(a._getNodeArr("oax-show-"+b),"oax_selected",!0);g(a);alp.m(a.isMapVis,
"setNow",d);alp.m(a.stVis3d,"setNow",b===oax.MODE_3D)}));alp.onDCL(function(){a._setClassIfNode("oax-flexView","oax_smallFlexView",!1);a._setClassIfNode("oax-flexView","oax_mediumFlexView",!1);a._setClassIfNode("oax-flexView","oax_largeFlexView",!1);a._setClassIfNode("oax-flexView","oax_fixed_height",!1);if(a._getNode("oax-flexView")){var b=a._getNode("oax-flexView").parentNode.style.height;""!=b&&"auto"!=b&&a._setClassIfNode("oax-flexView","oax_fixed_height",!0);null==a._getNode("oax-breadcrumb")?
a._setClassIfNode("oax-flexView","oax_no_breadcrumb",!0):a._setClassIfNode("oax-flexView","oax_no_breadcrumb",alp.hasClass(a._getNode("oax-breadcrumb"),oax.NO_DISPLAY));b=a._getNode("oax-flexView").offsetWidth;switch(!0){case 1019>b:a._setClassIfNode("oax-flexView","oax_smallFlexView",!0);break;case 1500>b:a._setClassIfNode("oax-flexView","oax_mediumFlexView",!0);break;default:a._setClassIfNode("oax-flexView","oax_largeFlexView",!0)}}h(a);a._getNode("oax-view-controls-box")&&(a._getNode("oax-view-controls-box").style.width=
a._getNode("oax-view-controls-container").offsetWidth+"px");null!=a._getNode("oax-list-table-head-box")&&(a._getNode("oax-list-table-head-box").style.width=a._getNode("oax-list-table-head-container").offsetWidth+"px");g(a);f(a);a._eh.push(alp.aEL(window,"resize",c))})}function h(a){var b=a._getNode("oax-filter-selectors");b&&(a=a._getNode("oax-flexView").offsetWidth,alp.style(b,{width:a+"px"}))}function g(a){function b(b,c){b=a._getNode(b);if(b.currentStyle)var d=b.currentStyle[c];else window.getComputedStyle&&
(d=document.defaultView.getComputedStyle(b,null).getPropertyValue(c));return parseInt(d)}var c,d=a._getNode("oax-view-controls-box"),e=a._getNode("oax-list");(c=a._getNode("oax-show-gallery"))&&alp.hasClass(c,"oax_selected")&&a.isFull&&a.isFull.get()?d.style.width=a._getNode("oax-gallery").offsetWidth+b("oax-gallery","margin-left")+b("oax-gallery-container","margin-left")+"px":(c=a._getNode("oax-show-magazine"))&&alp.hasClass(c,"oax_selected")&&a.isFull&&a.isFull.get()?d.style.width=a._getNode("oax-magazine").offsetWidth+
b("oax-magazine","margin-left")+b("oax-magazine-container","margin-left")+"px":(c=a._getNode("oax-show-list"))&&alp.hasClass(c,"oax_selected")?d.style.width=e.offsetWidth+"px":d&&(d.style.width=a._getNode("oax-view-controls-container").offsetWidth+"px");e&&null!=a._getNode("oax-list-table-head-box")&&(a._getNode("oax-list-table-head-box").style.width=e.offsetWidth+"px");h(a)}function f(a){var b=a._getNode("oax-filter");!b||a.isFull&&a.isFull.get()||alp.hasClass(b,oax.NO_DISPLAY)||(b.style.width=a._getNode("oax-filter-container").offsetWidth+
"px")}alp.sub("oax.flexview_layout",null,!0);var e=oa.util,d=oax.layout,b={};alp.declare("oax.FlexViewLayout",null,alp.nowF(function(a){alp.mixCheck(this,a);this.topNode.childNodes.a;this.is_tourplanner||(this.flexOpener.setDpOverlay.call.a,this.flexOpenerPage.valueOf.call.a);this._cacheInfo={topCont:this.topNode,nodeCache:{}};this._eh=new alp.Eh;this._initMode=e.init_from_url_hash(oax.URL_HASH_VIEW)||this.initMode;a=this._modes=this.modes||oax.MODEARR_FLEXVIEW;a=alp.arr2o(a,alp.f(),alp.f("1"));this._showed=
new alp.ModeState({modeSet:a,init_value:this._initMode||oax.MODE_MAP});this._isMapPanelOpenSt=this.isMapPanelOpenSt||null;this._dataPointListSt=this.dataPointListSt||null;a=this._filterOpen=new alp.BoolState({init_value:this.initFilterOpen||!1});this.layoutState={showed:alp.oCreateMix(this._showed,{set:null,setNow:null}),filterOpen:a};e.setTouchSupportClass(this.topNode);if(a=d.getNode("oax-what-button-with-dropdown"))alp.dom.unscript(a),d.category_toggle_setup(this._eh);k(this)}),{topNode:null,flexOpener:null,
flexOpenerPage:null,is_tourplanner:!1,initMode:null,initFilterOpen:null,modes:null,isMapPanelOpenSt:null,dataPointListSt:null,withUrlHash:!0,install_isFull_isMapVis_stVis3d_isDpVis:alp.nowF(function(a,b,c,d){function e(){var a=m.get(),b=l._showed.is(oax.MODE_LISTMAP),c;(c=l._getNode("oax-mapList-wrapper"))&&alp.setClass(c,oax.NO_DISPLAY,!(a&&b));(c=l._getNode("oax-mapList-toggled"))&&alp.setClass(c,oax.NO_DISPLAY,!(!a&&b));alp.setClass(l._getNode("oax-part-flexviewpage"),"oax-mapList-opened",a);alp.setClass(l._getNode("oax-part-flexviewpage"),
"oax-mapList-closed",!a)}function h(a){a||(k.get(),a=l._showed.get(),(a=l._getNode("oax-show-"+a))&&alp.hasEmptyBCR(a)&&l.flexOpener.setFvView(l.flexOpenerPage,oax.MODE_MAP));f(l);g(l)}var l=this,k=l.isFull=a;l._eh.push(k.change_cb(h));h(!0);l.isMapVis=b;a=l.stVis3d=c;var m=l.isDpVis=d;a&&(a.setNow(l._showed.is(oax.MODE_3D)),l._eh.push(a.change_cb(function(a){a||l.flexOpener.setFvView(l.flexOpenerPage,oax.MODE_MAP)})));var r;(r=l._getNode("oax-toggle-dp-close"))&&l._eh.push(alp.aEL(r,"click",function(){m.setNow(!1)}));
(r=l._getNode("oax-toggle-dp-open"))&&l._eh.push(alp.aEL(r,"click",function(){m.setNow(!0)}));l._eh.push(m.change_cb_init(e));l._eh.push(l._showed.change_cb_init(e))}),aEL_on_map_show:function(a){if(this._getNode("oax-show-map")){var b=alp.aEL(this._getNode("oax-show-map"),"click",alp.bindF.apply(alp,arguments));this._eh.push(b);return b}},getSelectorsInstallArgs:function(){return[this._eh,this._cacheInfo,this.withUrlHash]},listResize:function(){g(this)},destroy:function(){this._eh.clear();alp.empty(this.topNode);
for(var a in this)a in b||(this[a]=null)},_showView:function(a){this._showed.setNow(a)},_getNode:function(a){this[c]||(this[c]=alp.arr2oSimple(alp.filter(this.topNode.className.split(/\s+/),"")));return this[c][a]?this.topNode:d.getNode(a,this._cacheInfo)},_getNodeArr:function(a){return d.getNodeArr(a,this._cacheInfo)},_setClassIfNode:function(){return d.setClassIfNodeCached.apply(d,[this._cacheInfo].concat(alp.Aps.call(arguments)))}});var c="_topClassSet"})();"undefined"!==typeof dojo&&dojo.provide("oax.util.cfg_from_url_hash");
(function(){var k=alp.sub("oax.util",null,!0),h=oa.util;k.checkbox_init_from_url_hash=function(g,f){return h.init_from_url_hash_filter(g,f)||null};k.flexview_init_from_url_hash=function(g){return h.init_from_url_hash(oax.URL_HASH_FULLSCREEN,g)||null};k.overwrite_map_cfg_from_url_hash=function(g,f){f||(f={fallback_url_search:!0,bbox:!1});var e=h.init_from_url_hash(new RegExp(oax.URL_HASH_ZOOMCENTER_RX),f);if(e&&4===e.length){var d=e[1]|0;var b=[parseFloat(e[2]),parseFloat(e[3])]}null!=d&&null!=b&&
(alp.oSet(g,"maplayer.basemap.zoom",d),alp.oSet(g,"maplayer.basemap.center",b));(e=h.init_from_url_hash(oax.URL_HASH_BASEMAP,f))&&alp.oSet(g,"maplayer.basemap.init",e);f.bbox&&(e=h.init_from_url_hash(oax.URL_HASH_INIT_BBOX,f))&&alp.oSet(g,"maplayer.basemap.bbox",alp.map(e.split(","),"parseFloat(v)"));(f=alp.filter((h.init_from_url_hash(oax.URL_HASH_MAPOVERLAY,f)||"").split(","),""))&&f.length&&alp.oSet(g,"maplayer.mapoverlay.init",alp.arr2oSimple(f));return g};k.overwrite_what_cfg_from_url_hash=function(g,
f){f||(f={fallback_url_search:!0});(f=h.init_from_url_hash(oax.URL_HASH_ACTIVITY,f))&&alp.oSet(g,"what.selected_init",f);return g};k.pikaday_init_from_url_hash=function(g,f){return h.init_from_url_hash_filter(g,f)||null};k.selectbtn_init_from_url_hash=function(g,f){return h.init_from_url_hash_filter(g,f)||null};k.slider_vInit_from_url_hash=function(g,f){return h.init_from_url_hash_filter(g,f)||null}})();"undefined"!==typeof dojo&&dojo.provide("alp.data.autocompletegooglegeocode");
(function(){alp.declare("alp.data.AutoCompleteGoogleGeocode",alp.data.AutoCompleteAbstract,null,{extra:[],to_description:alp.f(".address"),to_display:alp.f(".address"),SOURCE:{v2:"google.maps.ClientGeocoder",v3:"google.maps.Geocoder"},fetch:function(k,h){if(k){var g=this,f=[""].concat(g.extra),e=function(){if(g.query_st.is(k)&&f.length){var d=f.shift();g._fetch_one(k+d,k,h);alp.asyncF(g.delay_ms,e)()}};e()}},_fetch_one:function(k,h,g){var f=this,e=function(d){(f._cache[k]=d)&&d.length&&f.receive(h,
d)};f._cache=f._cache||{};f._cache[k]?e(f._cache[k]):(f._geocode||f._init_geocode(),f._geocode?f._geocode(k,e,g):console.error("alp.data.AutoCompleteGoogleGeocode._fetch_one(): did not find any geocoder."))},_init_geocode:function(){if(!this._geocode){var k=this.SOURCE.v3;var h=alp.sub(k);if("function"===typeof h){var g=new h;this._geocode=function(f,e){g.geocode({address:f,language:alp.i18n.language(),region:"de"},function(d,b){if(b===google.maps.GeocoderStatus.OK){var c=[];alp.forEach(d,function(a){var b=
a&&a.address_components;b=b&&alp.map(b,alp.f(".long_name")).join(", ");a=a&&a.geometry&&a.geometry.location;b&&a&&c.push({address:b,x:a.lng(),y:a.lat(),source:k,q:f,is_geocoded:!0})});0<c.length&&e(c)}})}}}}})})();"undefined"!==typeof dojo&&dojo.provide("alp.data.autocompletealpsteingeocode");
(function(){alp.declare("alp.data.AutoCompleteAlpsteinGeocode",alp.data.AutoCompleteAbstract,null,{to_description:alp.f(".address"),to_display:function(k){var h=k.address;k.title&&(h+=" ("+k.title+")");return h},project:null,type:null,fetch:alp.nowF(function(k){var h=this;k&&alp.data.api_geocode(alp.filterIn({q:k,project:h.project,type:h.type},"")).thenSoon(function(g){(g=g&&g.status&&"ok"===g.status.toLowerCase()&&g.result)&&g.length&&h.receive(k,g)})})})})();"undefined"!==typeof dojo&&dojo.provide("alp.data.autocomplete");
"undefined"!==typeof dojo&&dojo.provide("alp.data.autocomplete_where_fromtext");(function(){alp.declare("alp.data.AutoCompleteWhereFromtext",alp.data.AutoCompleteAbstract,null,{fromtextfun:null,to_display:alp.f(".title"),to_description:alp.f(".title"),fetch:alp.asyncF(0,function(k){function h(e){g.receive(k,e?[e]:[])}var g=this,f=k&&g.fromtextfun(k);"function"===typeof f?f(h):h(f)})})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.view.i_mouseover_marker");
alp.gmap3(function(k){var h=alp._gmap2_3;h.view.InterfaceMouseoverMarker={gmap:function(){throw Error("alp._gmap2_3.view.InterfaceMouseoverMarker.gmap(): You need to implement this method !");},clear_mouseover_marker:function(){this._set_mouseover_marker()},has_mouseover_marker:function(){return!!this._mouseover_marker},set_mouseover_marker:function(g,f){this._set_mouseover_marker.apply(this,arguments)},_set_mouseover_marker:function(g,f){var e=this.gmap();e&&(null==g||null==f?this._mouseover_marker&&
(this._mouseover_marker.setMap(null),this._mouseover_marker=null):(g=parseFloat(g),f=parseFloat(f),this._mouseover_marker=h.marker_gen({position:new k.LatLng(f,g),icon:h.markerImage_gen.apply(h,alp.cfg.marker_image.geocode_location()),shadow:h.markerImage_gen.apply(h,alp.cfg.marker_image.geocode_location_shadow())}),this._mouseover_marker.setMap(e)))}}});"undefined"!==typeof dojo&&dojo.provide("alp.maps.proj4js_dfrd");
(function(){function k(){var f=h.proj4js_dfrd();alp.m(f,["to","then"],alp.bindF.apply(alp,arguments))}var h=alp.sub("alp.maps",null,!0);h.proj4js_dfrd=alp.memF(function(){alp.sub("Proj4js")||g||(g=alp.cE("script",alp.head(),{type:"text/javascript",src:alp.urlCachebust(alp.cssBase()+"proj4js/lib/proj4js-combined.js")}));return alp.subDfrd("Proj4js")});h.proj4js_cb=k;h.proj4js_utmstr_2_xy_dfrd=alp.nowF(function(f){function e(b){var e="EPSG:32"+(g?"7":"6")+c;b.defs[e]="+title=UTM zone "+c+a+" +proj=utm +zone="+
c+(g?" +south":"")+" +ellps=WGS84 +datum=WGS84 +units=m +no_defs";e=new b.Proj(e);var f=new b.Point(h,r),l=new b.Proj("EPSG:4326");b=b.transform(e,l,f);d.done(alp.opt(b,["x","y"]))}f=alp.sTrim(f).split(/\s+/);var d=alp.dfrd("proj4js:utmstr2xy",{then:1}),b=!1;if(3===f.length){var c=alp.opt(f[0].match(/\d+/),0),a=alp.opt(f[0].match(/\d+([a-z])/i),1),g=a&&"n">a.toLowerCase(),h=parseFloat(f[1]),r=parseFloat(f[2]);c&&a&&alp.isFiniteNumber(h)&&alp.isFiniteNumber(r)&&(b=!0,k(e))}b||d.done(null);return d});
var g})();"undefined"!==typeof dojo&&dojo.provide("alp.view.textinput");
(function(){alp.declare("alp.view.TextInput",null,function(k){alp.mix(this,k);this.active=new alp.BoolState({init_value:!0});this.sleepy=new alp.BoolState({init_value:!1});this.input_active=new alp.BoolState({init_value:k.input_active||!1});this.input=new alp.State({init_value:k.input||""});this.text=new alp.State({init_value:""});this.reinit()},{inputNode:null,input_active_class:"input_active",input_empty_class:"input_empty",container:"",mouseover_part:null,template:"js-tmpl-text-input",sub_input:"js-ti-input",
sub_text:"js-ti-text",clearOnFocus:!1,selectOnFocus:!1,text_inactive:"Enter text here",active:null,sleepy:null,input_active:null,input:null,text:null,systematic:!0,reinit:alp.nowF(function(){var k=this;(k._eh||(k._eh=new alp.Eh)).clear();k.dom={};var h,g;if(k.inputNode)k.dom.sub_input=[h=/^input$/i.test(k.inputNode.tagName)?k.inputNode:alp.gEBTN("input",k.inputNode)[0]],k.dom.sub_text=[],k.dom.top=[g=k.inputNode];else{k.dom.container="string"===typeof k.container?alp.gEBI(k.container)||alp.gEBCN(k.container)[0]:
k.container;k.dom.template=k.template&&(alp.gEBI(k.template)||alp.gEBCN(k.template)[0]);g=k.dom.container;var f=k.dom.template;g&&f?(alp.empty(g),f=alp.cE(f.tagName,null,{"class":f.className||""},{innerHTML:f.innerHTML}),f.id="",f.style.display="",f.style.visibility="",g.appendChild(f),k.dom.top=[f]):g&&(k.dom.top=[g]);if(1>g.childNodes.length){f=alp.cE("div");var e=alp.cE("input",null,{"class":k.sub_input});f.appendChild(e);g.appendChild(f)}k.dom.top&&(alp.forEach(["sub_input","sub_text"],function(d){k.dom[d]=
[alp.nodify(k[d],k.dom.top[0])]},k),h=k.dom.sub_input[0])}h?(k.mouseover_part?(alp.aEL(alp.gEBCN(k.mouseover_part,g),"mouseover",alp.bindF("_mouseover",k)),alp.aEL(alp.gEBCN(k.mouseover_part,g),"mouseout",alp.bindF("_mouseout",k))):(alp.aEL(g,"mouseover",alp.bindF("_mouseover",k)),alp.aEL(g,"mouseout",alp.bindF("_mouseout",k))),alp.forEach("change keypress keyup blur focus click".split(" "),function(d){k._eh.push(alp.aEL(h,d,alp.nowF("on"+d,k)))},k),k.active.change_cb("update",k),k.input_active.change_cb("update",
k),k.input.change_cb("update",k),k.text.change_cb("update",k),(g=k.dom.sub_text[0])&&k.text.set(g.innerHTML),this.update(),this.reinitEvt().triggerSoon()):console.error("alp.view.TextInput.constructor(): could not find all mandatory nodes",k.template,g,h,k)}),get_dom_in:function(){return this.dom&&this.dom.sub_input&&this.dom.sub_input[0]},focus:function(){if(this.active.get()){this.input_active.set(!0);try{this.dom.sub_input[0].blur(),this.dom.sub_input[0].focus()}catch(k){}}},update:function(){var k=
this.active.get()&&!this.sleepy.get()&&this.input_active.get(),h=this.dom.sub_input[0];try{k?h.focus():h.blur()}catch(e){}var g=this.input.get(),f=k||g;alp.setClass(this.dom.top,this.input_active_class,f);alp.setClass(this.dom.top,this.input_empty_class,!f);k=k||g?g:"function"===typeof this.text_inactive?this.text_inactive():this.text_inactive;null!=k||(k="");h.value!==k&&(h.value=k);(h=this.dom.sub_text[0])&&!this.text.is(h.innerHTML)&&(h.innerHTML=this.text.get())},onchange:function(k){k||(k=window.event);
var h=this;k=alp.nowF(function(){h.sleepy.get()||h.input.set(h.dom.sub_input[0].value)});k();alp.asyncF(100,k)();alp.asyncF(250,k)();alp.asyncF(500,k)();alp.asyncF(750,k)();alp.asyncF(1E3,k)()},onkeypress:function(k){k||(k=window.event);k.keyCode===alp.key.ENTER&&alp.stopEvent(k)},onkeyup:function(k){k||(k=window.event);this.sleepy.set(!1);this.onchange(k);switch(k.keyCode){case alp.key.ENTER:this._enter_pressed();break;case alp.key.TAB:this._tab_pressed();break;case alp.key.DOWN_ARROW:this._down_arrow_pressed();
break;case alp.key.UP_ARROW:this._up_arrow_pressed()}this._key_pressed(k.keyCode)},onclick:function(k){this.active.get()&&(this.input_active.get()&&this.dom.sub_input[0]!==document.activeElement?(this.dom.sub_input[0].blur(),this.dom.sub_input[0].focus()):(this.dom.sub_input[0].focus(),this.sleepy.set(!1),this.input_active.set(!0)))},onfocus:function(k){this.active.get()&&(this.input_active.set(!0),this.clearOnFocus?(this._old_input=this.input.get(),this.input.set("")):this.selectOnFocus&&alp.asyncF(0,
"select",this.dom.sub_input[0])())},onblur:function(k){this.active.get()&&(this.input_active.set(!1),this.clearOnFocus&&!this.input.get()&&this.input.set(this._old_input||""))},down_arrow_pressedEvt:alp.memM("down_arrow_pressedEvt",'alp.event("down_arrow_pressedEvt",{then:1})'),enter_pressedEvt:alp.memM("enter_pressedEvt",'alp.event("enter_pressedEvt",{then:1})'),tab_pressedEvt:alp.memM("tab_pressedEvt",'alp.event("tab_pressedEvt",{then:1})'),key_pressedEvt:alp.memM("key_pressedEvt",'alp.event("key_pressedEvt",{then:1})'),
up_arrow_pressedEvt:alp.memM("up_arrow_pressedEvt",'alp.event("up_arrow_pressedEvt",{then:1})'),mouseoverEvt:alp.memM("mouseoverEvt",'alp.event("mouseoverEvt",{then:1})'),mouseoutEvt:alp.memM("mouseoutEvt",'alp.event("mouseoutEvt",{then:1})'),reinitEvt:alp.memM("reinitEvt",'alp.event("reinitEvt",{then:1})'),down_arrow_pressed:alp.nowF(function(){this.down_arrow_pressedEvt().triggerSoon()}),enter_pressed:alp.nowF(function(){this.enter_pressedEvt().triggerSoon()}),tab_pressed:alp.nowF(function(){this.tab_pressedEvt().triggerSoon()}),
key_pressed:alp.nowF(function(k){this.key_pressedEvt().triggerSoon(k)}),up_arrow_pressed:alp.nowF(function(){this.up_arrow_pressedEvt().triggerSoon()}),mouseover:alp.nowF(function(){this.mouseoverEvt().triggerSoon()}),mouseout:alp.nowF(function(){this.mouseoutEvt().triggerSoon()}),_down_arrow_pressed:alp.asyncF(0,"down_arrow_pressed"),_enter_pressed:alp.asyncF(0,"enter_pressed"),_tab_pressed:alp.asyncF(0,"tab_pressed"),_key_pressed:alp.asyncF(0,"key_pressed"),_up_arrow_pressed:alp.asyncF(0,"up_arrow_pressed"),
_mouseover:alp.asyncF(0,"mouseover"),_mouseout:alp.asyncF(0,"mouseout")})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.geocoder");
alp.gmap3(function(k){function h(a){if(a)if(null!=a.x&&null!=a.y)var b={location:{lng:a.x,lat:a.y,x:a.x,y:a.y}};else a.geometry&&a.geometry.split&&(a=a.geometry.split(","),a=alp.map(a,'(v=v.split(" ")),{ lng : parseFloat( v[ 0 ] ), lat : parseFloat( v[ 1 ] ) }'),1===a.length?(a=a[0],b={location:{x:a.lng,y:a.lat}}):(b=d.bounds(a),b={latlng_arr:a,bounds:b,location:{x:b.center.lng,y:b.center.lat}}));b&&alp.oCheckScheme(b.location,"alp.and([v.x,v.y],alp.isFiniteNumber)");return b}function g(a){if(a&&
a.displayResultSnippets)return!0;if(a=a&&a.source_arr)return alp.or(a,g)}function f(a,b,c){(b||null).substring.call.a;c[0].toPrecision.call.a;c[1].toPrecision.call.a;a._receive(b,[{geometry:{location:e.xy2latlng(c)},formatted_address:b}],k.GeocoderStatus.OK)}var e=alp._gmap2_3,d=alp.maps,b=alp.util,c=b.math,a={},m=alp.i18n.fetch("alp.all");m.then(function(b){a=b});alp.declare("alp._gmap2_3.x.Geocoder",null,function(b,d,e){var f=this;"string"===typeof d&&(d=alp.nodify(d));d.childNodes.a;b=f.cfg=alp.mix({},
alp.fVal(f.cfg_default),b);f.node=d;f._map=e;f.info=new alp.ObjectState({init_value:{geo_xy:alp.mix(null,b.xy),address:b.address||""}});f.active_st=new alp.BoolState({init_value:!0});f.is_startpoint=new alp.BoolState({init_value:b.is_startpoint_init_value||!1});if((e=b.new_geocoder_node_template&&alp.nodify(b.new_geocoder_node_template))&&!(0<alp.gEBTN("form",e).length)){var h=document.createDocumentFragment(),l=[].slice.call(e.childNodes);alp.forEach(l,"alp.aC(this,v)",h);alp.aC(alp.cE("form",e,
{onsubmit:"return false;"}),h)}f.view=new alp.view.TextInput({container:d,clearOnFocus:f.cfg.clearOnFocus,selectOnFocus:f.cfg.selectOnFocus,mouseover_part:b.new_geocoder_mouseover_part,template:b.new_geocoder_node_template,sub_input:b.new_geocoder_node_template_address||alp.view.TextInput.prototype.sub_input,sub_text:b.new_geocoder_node_template_label||alp.view.TextInput.prototype.sub_text,text_inactive:function(){var d=f.info.get_property("geo_xy",!0);return d&&"number"===typeof d.x&&"number"===
typeof d.y?c.degrees_xy_2_strdec(d):alp.fVal(b.new_geocoder_prompt||a.geocoderPrompt,f.is_startpoint.get())}});f.label=f.view.text;f.input=f.view.input;f.input_active=f.view.input_active;(d=f.cfg.new_geocoder_autocomplete_mix)&&d.length&&(e=f.cfg.withautocomplete_fromtextfun,f.cfg.withautocomplete=!0,f.cfg.datasource=new alp.data.AutoCompleteMixGeocode({order_arr:alp.data.orderFromMapCenter,source_arr:(e?[new alp.data.AutoCompleteWhereFromtext(alp.oCreateMix(f.cfg.new_geocoder_autocomplete_opts||
{},{fromtextfun:e}))]:[]).concat(alp.filter(alp.map(d,function(a){if("string"===typeof a){var b=alp.sub(a);b||console.error("alp._gmap2_3.x.Geocoder could not find constructor for "+a);return b&&new b(f.cfg.new_geocoder_autocomplete_opts)}return a}),"")),map:f.gmap()}));f.cfg.withautocomplete&&(d={close_click_excluded_divs:function(){var a=f.gmap();return(a=a&&(a.getContainer&&a.getContainer()||a.getDiv&&a.getDiv()))&&[a]||[]},output_min_width:!1,output_width:!0},f.cfg.datasource&&(d.datasource=f.cfg.datasource),
e=f.css_class_autocomplete,h=d.datasource,null==e&&h&&(e=g(h)?["oax_where_out","oax_where_out_tp"]:["oax","oax-autocomplete"]),e&&(d.outputNodeClass=e),d.alwaysPointGeometry=f.cfg.new_geocoder_alwaysPointGeometry,f._autocomplete=new alp.x.AutoComplete(f.view,d));f.cfg.initNow&&f.init()},b.InterfaceWithInit,e.view.InterfaceMouseoverMarker,{cfg:null,cfg_default:{clearOnFocus:!1,selectOnFocus:!0,country:"de",map_setCenter:!0,map_setCenter_minZoom:10,map_show_IW:!0,withautocomplete:!1,withautocomplete_fromtextfun:function(a){function b(b){return{q:a,
title:c.degrees_xy_2_strdec(b),geometry:b.x+" "+b.y}}var e=c.degrees_is_strdec(a)?c.degrees_strdec_2_xy(a):c.degrees_is_minsec(a)?c.degrees_minsec_2_xy(a):null;if(e)return b(e);var f=alp.dfrd("AGX:geo:proj4",{then:1});alp.m(d.proj4js_utmstr_2_xy_dfrd(a),["to","then"],function(a){f.done(a&&b(a))});return alp.bindF(f.to?"to":"then",f)}},node:null,map:null,initNow:!1,info:null,input:null,css_class_wait:"js-geocoder-waiting",css_class_searching:"js-geocoder-searching",css_class_autocomplete:null,active_st:null,
_autocomplete:null,gmap:function(){var a=this._map;return a&&a.gmap?a.gmap:a},initImpl:function(){alp.m(this.info,"setUpdateActive","alp._gmap2_3.x.Geocoder.init()",!0,!0);this._connect_controller();this.mark_init_done()},_connect_controller:function(){function a(a){var c=b.input.get(),d=b.cfg.withautocomplete&&!alp.m(b._autocomplete,"is_selecting")&&alp.m(alp.oGet(b,"_autocomplete.output.array_st"),"get");c&&d&&d.length?b._on_autocomplete_selected(d[0]):b.cfg.withautocomplete&&b._autocomplete&&b._autocomplete.is_selecting()||
(b._focus_after_geocode=a&&document.activeElement,b._geocode())}var b=this;alp.m(b.info,["change_cb","entered_cb"],alp.bindF(function(a,c){b.input.setNow(a&&a.address||"");b.view.update();var d=a&&a.geo_xy;d&&"number"===typeof d.x&&"number"===typeof d.y&&new k.LatLng(d.y,d.x);b.gmap();a&&a.address&&alp.opt(c,"address")},b));b.view.mouseoverEvt().then(alp.bindF("_mouseover",b));b.view.mouseoutEvt().then(alp.bindF("_mouseout",b));m.then(function(){b.view.update()});b.view.enter_pressedEvt().then(a);
b.view.tab_pressedEvt().then(alp.bindF(a,null,!0));b.cfg.withautocomplete&&(b._autocomplete.overEvt().then(alp.bindF("_on_autocomplete_over",b)),b._autocomplete.selectEvt().then(alp.bindF("_on_autocomplete_selected",b)),b.active_st.bind_to(b._autocomplete.active_st,{loose:!0}),alp.m(b._autocomplete.output_vis_st,["change_v_cb","changed_v_cb"],!1,alp.bindF("clear_mouseover_marker",b)))},remove:function(){var a=this.node,b=a&&a.parentNode;b&&b.removeChild(a)},focus:function(){},submit:function(){this._geocode()},
mouseoverEvt:alp.memM("mouseoverEvt",'alp.event("AGX:geocoder:mouseoverEvt",{then:1})'),mouseoutEvt:alp.memM("mouseoutEvt",'alp.event("AGX:geocoder:mouseoutEvt",{then:1})'),mouseover:alp.nowF(function(){this.mouseoverEvt().triggerSoon()}),mouseout:alp.nowF(function(){this.mouseoutEvt().triggerSoon()}),_geocode:function(){function a(c,e){m.receiveEvt().drop(a);c=c===d.input.get()&&e[0];d._on_autocomplete_selected(c);b(!0)}function b(a){d.css_class_wait&&alp.forEach(alp.gEBCN(d.css_class_wait),function(a){a.display=
""});d.css_class_searching&&alp.setClass(d.node,d.css_class_searching,!a)}var d=this,g=d.input.get();if(g){var h=c.degrees_is_minsec(g)&&c.degrees_minsec_2_xy(g)||c.degrees_is_strdec(g)&&c.degrees_strdec_2_xy(g);if(h)f(d,g,h);else{var m=alp.oGet(d,"_autocomplete.datasource");h=d._clientgeocoder=alp.m(m,"gclientgeocoder")||d._clientgeocoder||e.V3()&&k.Geocoder&&new k.Geocoder;var u=d.gmap(),t=alp.m(u,"getBounds");u=!1;if(h&&e.V3()){var w={address:g};w.region=d.cfg.country;t&&(w.bounds=t);h.geocode(w,
alp.bindF("_receive",d,g))}else if(h&&h.getBaseCountryCode)h.reset(),d.cfg.country&&h.getBaseCountryCode()!==d.cfg.country&&h.setBaseCountryCode(d.cfg.country),t&&(h.reset(),h.setViewport(t)),h.getLocations(g,alp.bindF("_receive",d,g));else if(h=m&&m.query_st&&m.result_st)m.query_st.is(g)?((h=alp.opt(m.result_st.get(),0))&&d._on_autocomplete_selected(h),u=!0):(m.receiveEvt().then(a),m.query_st.set(g));else throw Error("alp._gmap2_3.x.Geocoder: could not recognize the geocoder for some reason!");b(u)}}},
_receive:function(b,c,d){this.css_class_wait&&alp.forEach(alp.gEBCN(this.css_class_wait),function(a){a.display=""});this.css_class_searching&&alp.setClass(this.node,this.css_class_searching,!1);var e=d||alp.oGet(c,"Status.code"),f;if((f=alp.oGet(c,[0,"geometry","location"]))&&null!=d){var g=d===k.GeocoderStatus.OK;var h=f.lng();var l=f.lat();e=alp.oGet(c,[0,"address_components"]);var m=alp.oGet(c,[0,"formatted_address"])||e&&alp.map(e,alp.f(".long_name")).join(", ")}else if(c=alp.oGet(c,["Placemark",
0])){g=e===k.GEO_SUCCESS;if(e=alp.oGet(c,"Point.coordinates"))h=e[0],l=e[1];m=c.address}m||(m=b);if(g&&null!=h&&null!=l){if(this._geo_success(m,{x:h,y:l}),this._focus_after_geocode){var n=this._focus_after_geocode;alp.m(n,"focus");setTimeout(function(){alp.m(n,"focus")},171)}}else alert(alp.fVal(this.cfg.new_geocoder_error||a.geocoderError))},_geo_success:alp.nowF(function(a,b){if(a&&b){this.view.input_active.setNow(!1);this._autocomplete&&this._autocomplete.close();this.info.set_property("address",
a);this.info.set_property("geo_xy",b);var c=b.x;b=b.y;c=null!=c&&null!=b&&e.xy2latlng([c,b]);b=this.gmap();if(this.cfg.map_show_IW&&b&&c&&a&&"string"===typeof a){if(this.cfg.map_setCenter&&b&&b.setCenter&&c){var d=Math.max(b.getZoom()||0,this.cfg.map_setCenter_minZoom);e.setView(b,c,d)}e.iwCloseAll(b);alp.asyncF(280,"iwOpen",e)(b,c,'<span class="alp-tpwiz-geocode-iw-wrapper">'+a+"</span>")}}}),_on_autocomplete_over:function(a){function b(b){if(c._mouseover_fetch_geom_last_data===a){var d=b&&b.location;
d&&d.lat&&d.lng&&(b=d.lng(),d=d.lat(),c.clear_mouseover_marker(),c.set_mouseover_marker(b,d))}}var c=this,d=this.gmap(),e=h(a),f=e&&alp.oGet(e,"location.x");e=e&&alp.oGet(e,"location.y");var g="number"===typeof f&&"number"===typeof e;d&&(c.clear_mouseover_marker(),g?c.set_mouseover_marker(f,e):a&&a.alpFetchGeometry&&(c._mouseover_fetch_geom_last_data=a,a.alpFetchGeometry(b)))},_on_autocomplete_selected:function(a){function b(a){function b(a){(a=a.location)&&a.lat&&a.lng&&c._geo_success(d,{x:a.lng(),
y:a.lat()})}var e=h(a);e?c._geo_success(d,e.location):a&&a.geo_xy&&null!=a.geo_xy.x&&null!=a.geo_xy.y?c._geo_success(d,a.geo_xy):a.alpFetchGeometry&&a.alpFetchGeometry(b)}var c=this;if(a){console.log("xxx _on_autocomplete_selected _______________ ",a);var d=a.address?a.address+(a.title?" ("+a.title+")":""):a.alpDisplay||a.title;d&&b(a)}},_mouseover:alp.asyncF(0,"mouseover"),_mouseout:alp.asyncF(0,"mouseout")})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.layer.condition_edit_layer2_model");
(function(){function k(){function a(a){b.m.waiting.setNow(!1);l&&alp.rEL(l);a=a&&200===a.status;if(!0===a){var f=d["_iname#"];c.inameArr.set(alp.filter(c.inameArr.get(),'!=="'+f+'"'));c.iname2cond.set_property(f,null);c.inameOpen.set()}e.done(a)}var b=this,c=b.m,d=c.edit.get(),e=alp.dfrd("CEL2:deleteCurrent",{then:1});if(d&&g(b)){var f=d.id,l=null;f?(b._i18n_dfrd().then(function(a){l=alp.dom.windowExitIntercept(a.upload_abort_situation)}),b.m.waiting.setNow(!0),h(b.timeout,m.conditionDelete({proj:b.proj,
id:f,tourid:b.tourid})).then(a)):a({status:200})}else e.done(!1);return e}function h(a,b){setTimeout(a,function(){b.triggered()||b.done(!1)});return b}function g(a){return a.login&&!a.login.indicator()?(a.login.opener(a.login.opener_cfg),!1):!0}function f(a,b){function c(a){alp.humane(a.please_close_first)}(b||0).substring.call.a;a.m.inameOpen.get()?a._i18n_dfrd().then(c):a.m.inameOpen.set(b)}function e(a){return a?c.xy2latlng(alp.map(a.split(","),parseFloat)):null}function d(a){return a?c.latlng2xy(a).join(","):
null}function b(a){var b=new Date;b.setHours(0);b.setMinutes(0);b.setSeconds(0);return{dayOfInspection:alp.date2str(b),geometry:null,activity:"",longText:"",proj:a.proj,riskDescription:"",title:"",weatherDescription:""}}var c=alp._gmap2_3,a=alp.data,m=a.api,l;alp.gmap3(function(a){l=a});alp.declare("alp._gmap2_3.ConditionEditLayer2Model",alp.x.AbstractController,function(){this._i18n_dfrd();this.editId&&this.editCondition(this.editId)},{proj:null,tourid:null,login:null,editId:null,timeout:3E4,augmentModel:function(a){a.map=
new alp.State;a.inameArr=new alp.SortedArrayState({init_value:[]});a.iname2cond=new alp.ObjectState;a.inameOpen=new alp.StringState;a.edit=new alp.ObjectState;a.tip=alp.modeStateFromArr(["new","where","tip"]);a.waiting=new alp.BoolState},connectModel2Model:function(a,b,c,d){b.push(c.inameOpen.change_cb_init(function(){var a=c.inameOpen.get();a=a&&c.iname2cond.get_property(a);c.edit.set(a)}));b.push(c.edit.change_cb_init(function(){var a=c.edit._get_no_clone();c.tip.set(a?a.geometry?"tip":"where":
"new")}))},getBounds:function(){return alp.reduce(alp.oValues(this.m.iname2cond._get_no_clone()),function(a,b){(b=e(b.geometry))&&a.extend(b);return a},new l.LatLngBounds)},hasCurrentGeom:function(){var a=this.m.edit.get();return a?a.geometry?!0:!1:null},hasCurrentChanged:function(){var a=this.m.iname2cond.get_property(this.m.inameOpen.get()),b=this.m.edit.get();return a&&!alp.oEqual(a,b)},hasCurrentLongText:function(){var a=this.m.edit.get();return a?a.longText?!0:!1:null},setMap:function(a){this.m.map.setNow(a)},
getMap:function(){return this.m.map.get()},createCondition:alp.nowF(function(a){if(g(this)){a=alp.mix(b(this),{geometry:d(a)});var c=a["_iname#"]="#"+r++;this.m.iname2cond.set_property(c,a);this.m.inameArr.add(c);f(this,c)}}),editCondition:alp.nowF(function(c){function d(a){null==a.title&&(a.title="");null==a.source&&(a.source=alp.oGet(a,"meta.source.id")?"":"unknown");"meta"in a&&delete a.meta}var e=this;g(e)&&(e._editCondition_loading=c,e.m.waiting.setNow(!0),(new a.SingleOOI(c,{proj:e.proj,cacheBust:+new Date+
""+Math.random()})).load(alp.nowF(function(a){if(e._editCondition_loading===c){e.m.waiting.setNow(!1);if(a.data.id!==c)throw Error("inconsistency");a=a.data;var g=alp.mix(b(e),alp.opt(a,m.CONDITION_SAVE_JSON_FIELDS(),!0)),h=alp.oValues(alp.filterIn(e.m.iname2cond._get_no_clone(),'v&&v.id==="'+c+'"'))[0];h=g["_iname#"]=h?h["_iname#"]:"#"+r++;var l=alp.oGet(a,"relatedActivity.id");null!=l&&(g.activity=l);l=alp.sub("images.image",a);l||(l=[],alp.oSet(a,"images.image",l),alp.oSet(g,"images.image",l));
l&&(alp.forEach(l,d),g.saved_images=alp.map(l,"[,v]"));e.m.iname2cond.set_property(h,g);e.m.inameArr.add(h);f(e,h)}})))}),saveCurrent:alp.nowF(function(){function a(a){b.m.waiting.setNow(!1);null!=e&&alp.rEL(e);console.log("xxx CEL2_saveCurrent_impl result",a);var f=a&&200===a.status;if(!0===f)try{var g=a.responseJson.id;(g||0).substring.call.a;c.id?f=c.id===g:(f=!0,c.id=g)}catch(y){f=!1}b.m.iname2cond.set_property(c["_iname#"],c);b.m.inameOpen.set();d.done(f)}var b=this,c=b.m.edit.get(),d=alp.dfrd("CEL2:saveCurrent",
{then:1});if(c&&g(b)){var e=null;b._i18n_dfrd().then(function(a){e=alp.dom.windowExitIntercept(a.upload_abort_situation)});b.m.waiting.setNow(!0);h(b.timeout,m[c.id?"conditionUpdate":"conditionCreate"](alp.filterIn(c,'w!=="_iname#"'),{throwError:!1})).then(a)}else d.done(!1);return d}),cancelCurrent:alp.nowF(function(){var a=this.m.edit.get(),b=alp.dfrd("CEL2:cancelCurrent",{then:1});if(a&&g(this))if(a.id)this.m.edit.set(),this.m.inameOpen.set(),b.done(!0);else return k.call(this);else b.done(!1);
return b}),deleteCurrent:alp.nowF(k),GEOMETRY:"geometry",LONGTEXT:"longText",INAME:"_iname#",SAVED_IMAGES:"saved_images",TITLE:"title",_i18n_dfrd:alp.memM("_i18n_dfrd",'alp.i18n.fetch("alp.all")'),_latlng_2_geometry:d,_geometry_2_latlng:e});var r=0})();"undefined"!==typeof dojo&&(dojo.provide("alp._gmap2_3.layer.condition_edit_layer2"),dojo.require("alp._gmap2_3.layer.condition_edit_layer2_model"));
(function(){function k(b){var c=b.m.edit.get(),d=!(!c||!c.id);a(b);b[z]=c&&alp.dom.windowExitIntercept(t(b,"QCancel"));alp.setClass(b._editContNode,b.existingClass,d);var e;(e=b._btnDeleteNode)&&alp.setClass(e,b.noDisplayClass,!d);(e=b._btnPublishNode)&&alp.setClass(e,b.noDisplayClass,d);(e=b._btnSaveNode)&&alp.setClass(e,b.noDisplayClass,!d);if(e=alp.nodify(b.dateScrollContainer,b._editContNode))e.scrollTop=0;alp.setClass(b._editContNode,b.noDisplayClass,!c);alp.setClass(b.topContNode,b.openClass,
!!c);if(c=b.m.edit._get_no_clone()){(d=(d=c.dayOfInspection)&&alp.str2date(d))&&alp.m(b.kx.datePick,"setDate",d);d=alp.gEBTN("form",b._editContNode)[0].elements;e=new RegExp("^"+b.inputPrefix+"(.*)$");for(var f=d.length,g=0;g<f;g++){var h=d[g],l=alp.opt((alp.gA(h,"name")||"").match(e),1);l in c&&(h.value=c[l]||"")}c=c&&alp.oGet(c,"images.image")||[];b=b.kx.img;b.max=alp.x.InputFileMultipleImg.prototype.max+c.length;alp.now("setFileArr",b,c,{programmatic:!0});b.m.filesModified.setNow(!1)}}function h(a){var b=
a._tipContNode&&a._tipContNode.childNodes;if(b&&b.length){var c=a.tipPrefix+a.m.tip.get();alp.forEach(b,function(b){alp.setClass(b,a.noDisplayClass,!alp.hasClass(b,c))})}}function g(a){function b(b){b=b&&b.latLng;var d=a.m.edit.get();b&&d&&!d.gemetry&&(n(a,b),c.clear())}var c=a[A]||(a[A]=new alp.Eh);c.clear();var d=a.m.edit.get(),e=a.m.map.get();d&&!d.geometry&&e&&c.push(w.event("addListener")(e,"click",b),w.event("removeListener"))}function f(){function b(b){u(c,"Deleted"+(b?"":"Failure"));b&&a(c)}
var c=this;c.m.waiting.is()||(m(c),window.confirm(t(c,"QDelete"))&&c.deleteCurrent().then(b))}function e(){var b=this;b.m.waiting.is()||(m(b),b.hasCurrentChanged()&&!window.confirm(t(b,"QCancel")))||(a(b),b.cancelCurrent().then(function(){u(b,"Cancel")}))}function d(){var b=this;if(!this.m.waiting.is())if(m(this),!1===this.hasCurrentGeom())u(b,"GeometryRequired");else if(!1===this.hasCurrentLongText())u(b,"LongTextRequired");else if(this.m.edit.get_property(this.TITLE))if(this.hasCurrentChanged()){var c=
this.m.edit.get_property(this.INAME);this.saveCurrent().then(function(d){u(b,"PublishedNew"+(d?"":"Failure"));d&&(a(b),v(b,{iname:c}))})}else this.cancelCurrent().then(function(){u(b,"NoModif")});else u(b,"TitleRequired")}function b(){var b=this;if(!this.m.waiting.is())if(m(this),this.hasCurrentChanged()){var c=this.m.edit.get_property(this.INAME);this.saveCurrent().then(function(d){u(b,"SavedModif"+(d?"":"Failure"));d&&(a(b),v(b,{iname:c}))})}else this.cancelCurrent().then(function(){u(b,"NoModif")})}
function c(a,b){var c=alp.sub("geometry.location",b);b=alp.sub("geometry.viewport",b);if(c){var d=a.m.map.get();if(d){a=a._editContNode.clientWidth;a={left:a?a+"px":.1,right:.1,top:.1,bottom:.1};var e,f,g=y.bounds2zoomcenter(b||[e=c.lng(),f=c.lat(),e,f],d.getDiv(),{padding:a});alp.gmap3(function(a){var b=g.center;w.setView(d,new a.LatLng(b.lat,b.lng),g.zoom)})}}}function a(a){var b=a[z];b&&alp.rEL(b);a[z]=null}function m(a){var b=a.m.edit.get();a.m.edit.setNow(alp.mix({},b,l(a,b)))}function l(a,b){for(var c=
{},d=[].concat(b[a.SAVED_IMAGES]||[]),e=alp.gEBTN("form",a._editContNode)[0].elements,f=new RegExp("^"+a.inputPrefix+"(.*)$"),g=e.length,h=0;h<g;h++){var l=e[h],k=alp.opt((alp.gA(l,"name")||"").match(f),1),m=l.value;(l=alp.gA(l,"placeholder"))&&m===l&&(m="");k&&(c[k]=m)}c.images={image:[]};if(a.kx.img)for(e=a.kx.img.m.files.get(),g=e.length,h=0;h<g;h++)f=x.format_image_or_video_2_api_obj(e[h],d),(c.images||(c.images={image:[]})).image.push(f);if(b=b.id)c.id=b;c.proj=a.proj;a.tourid&&(c.relatedOOI=
[a.tourid]);delete c["images-input"];return c}function r(a){return alp.gEBTN("form",a._editContNode)[0].elements[a.inputPrefix+"geometry"].value||""}function n(a,b){b="string"===typeof b?b:a._latlng_2_geometry(b);alp.gEBTN("form",a._editContNode)[0].elements[a.inputPrefix+"geometry"].value=b;q(a)}function q(a){alp.gmap3(function(b){var c=a.m.iname2cond._get_no_clone(),d=a.m.map.get(),e=a[C]||(a[C]={}),f=a[E]||(a[E]={}),g=(b=a.m.edit._get_no_clone())&&b[a.INAME];alp.forIn(e,function(b,d){var h=d===
g,l=a["marker_standard_name_"+(h?"current":"others")];b&&b.getMap()&&(c[d]&&c[d].geometry&&l===f[d]?g&&!h&&b.setMap():(b.setMap(),e[d]=null,f[d]=null))});alp.forIn(c,function(b,c){function f(){if(c===a.m.edit.get_property(a.INAME))n(a,k.getPosition());else throw Error("bug detected");}function h(){if(!a.m.inameOpen.is(c)){if(a.m.inameOpen.get()||!a.m.iname2cond.get_property(c))throw Error("CEL2 open click bug");a.m.inameOpen.setNow(c)}}var l=c===g;l&&(b=a.m.edit.get());var k=e[c];b=b&&a._geometry_2_latlng(r(a)||
b.geometry);var m=a["marker_standard_name_"+(l?"current":"others")],p=b?(g?l:!0)&&d:null;k?(p!==k.getMap()&&k.setMap(p),m=k.getPosition(),!b||m&&b.equals(m)||k.setPosition(b),l!==!!k.getDraggable()&&k.setDraggable(l)):p&&(k=e[c]=w.marker_gen(alp.oCreateMix(a.marker_opts,{map:p,position:b,draggable:l}),m),w.event("addListener")(k,"dragend",alp.nowF(f)),w.event("addListener")(k,"click",alp.nowF(h)))})})}function p(a){a.m.waiting.get()?(a._waitbox||(a._waitbox=new alp.x.Waitbox)).setTarget(a._editContNode).startWait():
a._waitbox&&a._waitbox.stopWait().setTarget(null)}function v(a,b){var c=b.id||b.iname&&a.m.iname2cond.get_property([b.iname,"id"]);(c||0).substring.call.a;alp.now(function(){a.saveSuccessEvt().triggerSoon({id:c})})}function u(a,b){alp.humane(t(a,b))}function t(a,b){return a["_i18nMsg"+b+"HTML"]||b}var w=alp._gmap2_3,x=alp.data,y=alp.maps;alp.declare("alp._gmap2_3.ConditionEditLayer2",w.ConditionEditLayer2Model,null,{topContNode:null,editCont:"oax-condition-edit-container",tipCont:"oax-condition-ctrl",
createNode:null,openClass:"oax-edit-condition-open",existingClass:"oax-condition-existing",noDisplayClass:"oax_no_display",tipPrefix:"oax-condition-",btnDelete:"oax-condition-action-delete",btnCancel:"oax-condition-action-cancel",btnPublish:"oax-condition-action-publish",btnSave:"oax-condition-action-save",inputPrefix:"oax-condition-in-",imgCont:"oax-condition-in-images-cont",imgToggle:"oax-condition-in-images-toggle",imgInput:"oax-condition-in-images-input",imgFiles:"oax-condition-in-images-files",
imgDisplay:"oax-condition-in-images-display",datePickCont:"oax-condition-date-pick",dateIcon:"oax-condition-date-icon",datePosition:"fixed",dateScrollContainer:"oax-condition-edit-form",marker_opts:null,marker_standard_name_current:"condition",marker_standard_name_others:"other_condition",i18nMsgCancel:"oax-condition-i18n-msg-cancel",i18nMsgTitleRequired:"oax-condition-i18n-msg-title-required",i18nMsgGeometryRequired:"oax-condition-i18n-msg-geometry-required",i18nMsgLongTextRequired:"oax-condition-i18n-msg-longtext-required",
i18nMsgPublishedNew:"oax-condition-i18n-msg-pub-new",i18nMsgPublishedNewFailure:"oax-condition-i18n-msg-pub-new-failure",i18nMsgSavedModif:"oax-condition-i18n-msg-saved-modif",i18nMsgSavedModifFailure:"oax-condition-i18n-msg-saved-modif-failure",i18nMsgDeleted:"oax-condition-i18n-msg-deleted",i18nMsgDeletedFailure:"oax-condition-i18n-msg-deleted-failure",i18nMsgNoModif:"oax-condition-i18n-msg-no-modif",i18nMsgQCancel:"oax-condition-i18n-msg-q-cancel",i18nMsgQDelete:"oax-condition-i18n-msg-q-delete",
augmentKids:function(a){var b=this;b._editContNode=alp.nodify(b.editCont,b.topContNode);b._editContNode.childNodes.a;b._tipContNode=alp.nodify(b.tipCont,b.topContNode);alp.forEach(["btnDelete","btnCancel","btnPublish","btnSave"],'this[ "_" + v + "Node" ] = alp.nodify( this[ v ], this._editContNode );',b);b._tipNewNode=b._tipContNode&&alp.nodify(b.tipPrefix+"new",b._tipContNode);b._tipWhereInputNode=b._tipContNode&&alp.nodify(b.tipPrefix+"where",b._tipContNode);b._tipTipNode=b._tipContNode&&alp.nodify(b.tipPrefix+
"tip",b._tipContNode);b._imgContNode=alp.nodify(b.imgCont,b._editContNode);b._datePickContNode=alp.nodify(b.datePickCont,b._editContNode);alp.forIn(b,function(a,c){/^i18nMsg/.test(c)&&(b["_"+c+"HTML"]=alp.opt(alp.nodify(a,b._editContNode),"innerHTML"))});b._tipWhereInputNode&&(a.wherePlaces=new w.x.WhereAutocomplete({inputNode:b._tipWhereInputNode,initNow:!0,proj:b.proj}));b._imgContNode&&(a.img=new alp.x.InputFileMultipleImgExt({cont:b._imgContNode,input:b.imgInput,display:b.imgDisplay,toggle:b.imgToggle,
files:b.imgFiles,initNow:!1}));if(b._datePickContNode){var c=new Date;a.datePick=new alp.x.Pikaday({field:b._datePickContNode,clickNode:alp.nodify(b.dateIcon,b._editContNode),style:{position:b.datePosition},scrollContainerNode:alp.nodify(b.dateScrollContainer,b._editContNode),setDefaultDate:!0,defaultDate:c,minDate:new Date("2000-01-01"),maxDate:c,useRelativeDays:!0,onSelect:function(a){alp.nodify(b.inputPrefix+"dayOfInspection",b._editContNode).value=alp.date2str(a)}})}},connectModel2View:function(a,
b,c,d){b.push(c.edit.change_cb_init(k,null,a));b.push(c.tip.change_cb_init(h,null,a));g(a);b.push(c.map.change_cb(g,null,a));b.push(c.edit.change_cb(g,null,a));q(a);d=alp.ratelimitF(123,q,null,a);b.push(c.map.change_cb(d));b.push(c.iname2cond.change_cb(d));b.push(c.edit.change_cb(d));b.push(c.waiting.change_cb_init(p,null,a))},connectView2Model:function(a,g,h,l){var k,m;(m=alp.filter([a._tipNewNode,a.createNode],"")).length&&g.push(alp.aEL(m,"click",function(){a.createCondition()}));(k=a._btnDeleteNode)&&
g.push(alp.aEL(k,"click",alp.nowF(f,a)));(k=a._btnCancelNode)&&g.push(alp.aEL(k,"click",alp.nowF(e,a)));(k=a._btnPublishNode)&&g.push(alp.aEL(k,"click",alp.nowF(d,a)));(k=a._btnSaveNode)&&g.push(alp.aEL(k,"click",alp.nowF(b,a)));l.wherePlaces&&((h=alp.sub("m.placeSt",l.wherePlaces))?g.push(h.change_cb(c,null,a)):g.push(l.wherePlaces.placeChangeCB(c,null,a)))},saveSuccessEvt:alp.memM("saveSuccessEvt",'alp.event("CEL2:saveSuccessEvt",{then:1})')});var z="_edit_winexit_intercept_release",A="_map_eh",
C="_iname_2_marker",E="_iname_2_marker_name"})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.fullscreen");
(function(){function k(a){this.interceptSetFullscreen&&this.interceptSetFullscreen(a);this.m.isFull.setNow(a)}function h(a,b){function c(){e.event("trigger")(g,"resize");h&&!alp.m(g.getCenter(),"equals",h)&&g.setCenter(h)}var d=b.isFull.get(),f=b.isActive.get();b=b.isMapVis.get();var g=f&&b&&a.map,h;b={};if(g){var l=g.getDiv();l=alp.gBCR(l);l.width&&l.height&&(h=g.getCenter())}b[a.body_class_smallscreen]=f&&!d;b[a.body_class_fullscreen]=f&&d;alp.setClass(alp.body(),b);g&&(alp.m(g,"setFullScreen",
d),c(),setTimeout(c))}function g(e){a||"true"===alp.cookie(e.instruction_cookie_nomore)||(a=!0,d.then(function(a){var d=alp.outerHTML(alp.nodify(e.q_smallscreen));a=alp.tmpl(e.instruction_body_tmpl,alp.oCreateMix(a,{fullscreen_smallscreen_symbol:d}));c=!0;b.open({html:a,width:e.instruction_width,height:e.instruction_height,onOpenNow:function(a){var b=alp.nodify("alp-fullscreen-instruction-nomore",a);alp.styleform.init({now:!0,cont:{input:[b]},oncheck:function(a,b){alp.cookie(e.instruction_cookie_nomore,
""+b,{path:"/",expires:365})}});alp.subDfrd(function(){var b;return!alp.isDescendant(a,alp.body())||!(b=alp.gBCR(a)).width||!b.height}).then(alp.asyncF(500,function(){c=!1}))}})}))}function f(a,b){c||(b||(b=window.event),b.keyCode===alp.key.ESCAPE&&k.call(a,!1))}var e=alp._gmap2_3,d=alp.i18n.fetch("alp.all"),b=alp.view.modalwin;alp.declare("alp._gmap2_3.x.Fullscreen",alp.x.AbstractController,null,{map:null,q_smallscreen:"smallscreen_link",q_fullscreen:"fullscreen_link",body_class_smallscreen:"agMapSmallScreen",
body_class_fullscreen:"agMapFullScreen",init_value:!1,init_active:!0,init_mapvis:!0,instruction_alert:!1,instruction_cookie_nomore:"alp-fullscreen-instruction-nomore",instruction_body_tmpl:'<div class="oax_modal_header oax-modal-header"><strong class="alp-fullscreen-instruction-title">${fullscreen_instruction_title}</strong> <div class="oax-modal-action-close oax_modal_close_btn oax_pointer"><div class="oax-icon-cross-alt"></div></div></div> <div class="oax_modal_content_wrap oax_marg_left_15"><div class="alp-fullscreen-instruction oax"><div class="oax_marg_bottom_25"><div class="oax_fl">${fullscreen_instruction_how}&nbsp;</div><div class="alp-smallscreen-symbol oax_fl">${fullscreen_smallscreen_symbol}</div><div class="oax_clear"></div></div><div><input type="checkbox" id="alp-fullscreen-instruction-nomore" class="alp-styleform-styled">&nbsp;<label for="alp-fullscreen-instruction-nomore">${fullscreen_instruction_nomore}</label></div></div></div>',
instruction_width:440,instruction_height:165,interceptSetFullscreen:null,augmentModel:function(a){a.isFull=new alp.BoolState({init_value:this.init_value});a.isActive=new alp.BoolState({init_value:this.init_active});a.isMapVis=new alp.BoolState({init_value:this.init_mapvis})},connectModel2View:function(a,b,c,d){b.push(c.isFull.change_cb_init(h,null,a,c));b.push(c.isActive.change_cb_init(h,null,a,c));b.push(c.isMapVis.change_cb_init(h,null,a,c));(!0===a.instruction_alert||null==a.instruction_alert&&
alp.notIframe())&&b.push(c.isFull.change_v_cb(!0,g,null,a))},connectView2Model:function(a,b,c,d){b.push(alp.aEL(alp.gEBI(a.q_smallscreen)||alp.gEBCN(a.q_smallscreen),"click",alp.bindF(k,a,!1)));b.push(alp.aEL(alp.gEBI(a.q_fullscreen)||alp.gEBCN(a.q_fullscreen),"click",alp.bindF(k,a,!0)));b.push(alp.aEL(alp.body(),"keyup",alp.bindF(f,null,a)))}});var c,a})();"undefined"!==typeof dojo&&dojo.provide("oa.util.flexview_snippet");
(function(){oa.flexview_getSnippetCfg=function(k,h,g,f){h.substring.call.a;(g||0).substring.call.a;var e=k.flexOpener?k.flexOpener.getActionOpener():k;h={type:k._actionOpenType_for_mode(h),url:k.openOOIUrl,opener:k._actionOpenType_has_in_page_or_in_page_iw()&&e};return alp.mix({tmpl:k.frontendtype===g&&k[oa.SNIPPET_TMPL_HTML],classArr:k.snippetClassArr||[],action_open:h,proj:k.proj},f)}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.map_marker");
(function(){alp.sub("oa.util",null,!0).passive_map_poi_icon_cfg=function(k,h){var g=k&&k.category&&k.category.color||"#861914";k=k.html||'<div class="oax-pmp-cont"  style="background-color: '+g+';"><img class="oax-pmp-img" src="'+k.category.iconTransparentUrl+'"/></div>';return h&&h.L?{html:k,iconAnchor:[24,24],iconSize:[48,48],className:"oax-passive-map-poi"}:h&&h.gm?{html:k,width:48,height:48,anchor_x:24,anchor_y:24,zIndex:-9E9,interactive:!0}:null.unsupported}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_map_layer_panel");
(function(){function k(a,b){var c;a&&a.payFeature&&(c=b.id_2_payFeature[a.payFeature]);a&&a.proFeature&&(c=b.id_2_proFeature[a.proFeature]);return!c||c.purchased}var h=alp.i.state,g=alp.maps.mapconfig,f=g.get_polished_mapconfig,e=g.optional_init_from_mapboss,d=g.MAYBE_VECTOR_MAPTYPEID_SPLIT,b=g.SEP(),c={},a={};alp.forIn({mtb:"mountainbiking",winter_alpine:"skiresort",horse:"horseback"},"this[v]=w",c);alp.sub("oa.i",null,!0).IMapLayerPanel={_imlp_augmentModel:function(a){function d(a,b){(b||null).substring.call.a;
b=c[b]||b;b in T?a&&(Q=b):b in N&&(X[b]=a)}var g=this,q=[];g.id_2_payFeature=alp.arr2o(g.mapconfig.payFeatures||[]);g.id_2_proFeature=alp.arr2o(g.mapconfig.proFeatures||[],"proLevel");var t=f(g.mapconfig,g.proj);t=g._mapconfig=e(g.mapboss,t);0<t.maps.length||q.push(0);var w=g._mc_map_of_id={},x=g._mc_styleset_of_mapid={},y=g._mc_styledflt_of_mapid={},z=g._mc_networkset_of_mapid={},A=g._mc_extraovset_of_mapid={},C=g._mc_style_of_name_of_mapid={},E=g._mc_network_of_name_of_mapid={},G=g._mc_extraov_of_name_of_mapid=
{},B=g[m]={},I=g[l]={},L=g[r]={},J=g[n]={},P=g._NONE,H=[],F,D=[],M={},R,S=[],T={},Q=P,O=[],N={},X={};alp.forEach(t.maps,function(a){var c=a.id,e=a.isPreselected,f=a.styles||a.mapStyles||[],h=a.overlays||[];(c||null).substring.call.a;w[c]=a;e&&(F=c);H.push(c);E[c]={};G[c]={};alp.forEach(f,function(a){var d=a.name;(d||null).substring.call.a;y[c]||(y[c]=d);alp.oSet(C,[c,d],a);d in M||(M[d]=1,D.push(d));e&&(a.isPreselected?R=d:R||(R=d));alp.oSet(x,[c,d],!0);L[c]=!0;J[g._mc_has_styles_of_mapid[c]?c+b+
d:c]=a});alp.forEach(h,function(a){function f(a){l?alp.oGet(B,[c,a])?console.error("MLP: issue in the mapConfig: only one active style per map is supported, not more.",c,a,B):alp.oSet(B,[c,a],h):alp.oSet(I,[c,a,h],!0)}var h=a.name;(h||null).substring.call.a;a._oa_unique_ov_id=g._mc_has_styles_of_mapid[c]?c+b+h:c;if(!1!==a.isChangeable){var l=a.isActivity;l?(alp.oSet(E,[c,h],a),h in T||(T[h]=1,S.push(h)),alp.oSet(z,[c,h],!0)):(alp.oSet(G,[c,h],a),h in N||(N[h]=1,O.push(h)),alp.oSet(A,[c,h],!0));alp.forEach(a.active||
[],f)}e&&a.isPreselected&&d(!0,h)});J[c]=a});S.push(P);0<H.length||q.push(1);0<D.length||q.push(2);0<S.length||q.push(3);(t=alp.oGet(g,"mapboss.mapoverlay.init"))&&alp.forIn(t,d);a.basemap=h.modeState(H,F,function(a){var b=a;k(g._mc_map_of_id[a],g)||(b="osm");return b});a.style=h.modeState(D,R,function(b){var c=b,d=a.basemap.get();k(alp.oGet(g._mc_style_of_name_of_mapid,[d,b]),g)||(c=g._mc_styledflt_of_mapid[d]);return c});a.network=h.modeState(S,Q,function(b){var c=b,d=a.basemap.get();k(alp.oGet(g._mc_network_of_name_of_mapid,
[d,b]),g)||(c=g._NONE);return c});a.extraov=h.objectState(X,function(b){var c=a.basemap.get(),d;for(d in b)b.hasOwnProperty(d)&&b[d]&&!k(alp.oGet(g._mc_extraov_of_name_of_mapid,[c,d]),g)&&(b[d]=!1);return b});a.isOpen=h.boolState();a._out_maptype=h.objectState();a._out_overlayidset=h.objectState();a.out_map_source_set=h.objectState({});g._basemap_arr=H;g._style_arr=D;g._network_arr=S;g._network_set=alp.arr2oSimple(g._network_arr);g._extraov_arr=O;g._extraov_set=alp.arr2oSimple(g._extraov_arr);q.length&&
console.error("_imlp_augmentModel: failure(s): "+q.join(","))},_imlp_connectModel2Model:function(c,d,e,f){function g(a){var d=e.basemap.get(),f=e.style.get();(d=c._mc_has_styles_of_mapid[d]?d+b+f:d)&&(f=alp.oGet(c,["_mc_mtcfg_of_mtid",d])||null)&&h.set(a,e._out_maptype,{id:d,cfg:f})}function l(a){var b=e.basemap.get(),d=e.network.get(),f=e.extraov.get()||{};d=alp.filterIn(alp.mapIn(alp.oCreateMix(alp.filterIn(f,""),d===c._NONE?{}:alp.arr2oSimple([d])),'this( "_mc_extraov_of_name_of_mapid", w )||  this( "_mc_network_of_name_of_mapid", w )||  (console.error("iMLP could not find network/extraov: ",w ), false)',
function(a,d){return alp.oGet(c[a],[b,d])}),"");h.set(a,e._out_overlayidset,d)}function k(b){function d(b){if(b&&"object"===typeof b){var c=b.attributions;c&&c instanceof Array&&alp.forEach(c,"(v=v.source)  &&  (!/^[\\+\\-]?\\d+$/.test( v )) &&  (this.source_set[this.translate[v] || v]=true)",{source_set:l,translate:{swiss_topo:"swisstopo"}});for(var e in b)e in a||d(b[e])}}var f={maptype:e._out_maptype.get(),overlayidset:e._out_overlayidset.get()},g=e.basemap.get();g&&alp.oGet(c,["_mc_map_of_id",
g,"sources"]);var l={};d(f);h.set(b,e.out_map_source_set,l)}d.push(h.chenInit(e.basemap,alp.bindF("_imlp_on_basemap_change_m2m",c)));d.push(h.chenInit(e.style,alp.bindF("_imlp_on_style_change_m2m",c)));d.push(h.chenInit(e.basemap,g));d.push(h.chen(e.style,g));d.push(h.chenInit(e.basemap,l));d.push(h.chen(e.network,l));d.push(h.chen(e.extraov,l));d.push(h.chenInit(e._out_maptype,k));d.push(h.chen(e._out_overlayidset,k))},_imlp_on_basemap_change_m2m:function(a){var b=this.m,c=b.basemap.get(),d=this._previous_mapid;
this._previous_mapid=c;var e=b.style.get(),f=b.network.get(),g=b.extraov.get();d&&(alp.oSet(this,["_settings_memory","basemap",d,"style"],e),alp.oSet(this,["_settings_memory","basemap",d,"network"],f),alp.oSet(this,["_settings_memory","basemap",d,"extraov"],g));var l=alp.oGet(this,["_settings_memory","basemap",c]);if(!l){l={};d=b.style.get();l.style=alp.oGet(this._mc_styleset_of_mapid,[c,d])?d:this._mc_styledflt_of_mapid[c];var k=b.network.get();l.network=alp.oGet(this._mc_networkset_of_mapid,[c,
k])?k:this._NONE;l.extraov=alp.filterIn(b.extraov.get(),"w in this",this._mc_extraovset_of_mapid[c]);alp.oSet(this,["_settings_memory","basemap",c],l)}d=alp.oGet(this._mc_styleset_of_mapid,[c,e])?e:l.style;k=alp.oGet(this._mc_styleset_of_mapid,[c,f])?f:l.network;c=alp.filterIn(g,"w in this",this._mc_extraovset_of_mapid[c])||l.extraov;(k||null).substring.call.a;c instanceof Object||null.bug;d&&h.set(a,b.style,d);h.set(a,b.network,k);h.set(a,b.extraov,c)},_imlp_on_style_change_m2m:function(a){var c=
this.m,d=c.basemap.get();var e=c.style.get();e=this._mc_has_styles_of_mapid[d]?d+b+e:d;var f=this._previous_mapid_style;this._previous_mapid_style=e;f&&(alp.oSet(this,["_settings_memory","basemap_style",f,"network"],c.network.get()),alp.oSet(this,["_settings_memory","basemap_style",f,"extraov"],c.extraov.get()));f=alp.oGet(this,["_settings_memory","basemap_style",e]);if(!f){f={};var g=c.network.get();f.network=alp.oGet(this._mc_networkset_of_mapid,[d,g])?g:this._NONE;f.extraov=alp.filterIn(c.extraov.get(),
"w in this",this._mc_extraovset_of_mapid[d]);g=c.basemap.get();var k=c.style.get();d=alp.oGet(this,[m,g,k]);g=alp.oGet(this,[l,g,k]);d&&(f.network=d);g&&alp.mix(f.extraov,g);alp.oSet(this,["_settings_memory","basemap_style",e],f)}g=f.network;e=f.extraov;(g||null).substring.call.a;e instanceof Object||null.bug;h.set(a,c.network,g);h.set(a,c.extraov,e)},_NONE:"<none>",_setMaptypeid:function(a,b){function c(a){m&&h.set(a,e.basemap,m);n&&h.set(a,e.style,n);p&&h.set(a,e.network,p||l);q&&h.set(a,e.extraov,
q)}var e=this.m,f=!1,l=this._NONE;if(!f){if((b=null!=b&&alp.arr2oSimple(alp.filter(b.split(","),""))||null)&&a){var k=d(a);(k=k&&k.basename)&&alp.oSet(this,["_settings_memory","basemap",k],null);alp.oSet(this,["_settings_memory","basemap_style",a],null)}if(a=g.selection_of_maptypeid(this.mapconfig,a,{init:b})){var m=a.basemap,n=a.style,p=a.network||this._NONE,q=a.extraov;alp.now(c);f=!0}}return f}};var m="_mc_active_network_of_mapid_and_style",l="_mc_active_extraovset_of_mapid_and_style",r="_mc_has_styles_of_mapid",
n="_mc_mtcfg_of_mtid"})();"undefined"!==typeof dojo&&dojo.provide("oa.x.map_layer_panel");
(function(){function k(a,b){function c(b,c,d,e,f,g){f||null.bug;f=f[g];e=alp.cE("div",null,null,{innerHTML:e.innerHTML});var l=alp.qS('input[type="radio"]',e),k=alp.qS('input[type="checkbox"]',e);null!=l^null!=k||null.bug;alp.sA(l||k,"name",b);alp.sA(l||k,"value",g);"network"===b&&g===a._NONE&&alp.sA(e,"style","display: none");l&&(c.substring.call.a,g===c?alp.sA(l,"checked","checked"):alp.rA(l,"checked"));k&&("object"===typeof c||null.bug,c[g]?alp.sA(k,"checked","checked"):alp.rA(k,"checked"));c=
alp.nodify(a.entryTitle,e);alp.setText(c,f&&f.title||g);if(c=alp.nodify(a.entryImg,e))(l=f&&f.iconUrl||"")?alp.sA(c,"src",l):alp.style(c,"display","none");if(c=alp.nodify(a.entryIcon,e))(l=f&&f.iconClass||"")?alp.setClass(c,l,!0):alp.style(c,"display","none");(c=alp.nodify(a.entryDescr,e))&&alp.setText(c,f&&f.subtitle||"");c=alp.nodify(a.linkPro,e);(l=alp.nodify(a.linkPay,e))&&h(a,[r,b,g],e,l,f&&f.payFeature,a.id_2_payFeature);c&&h(a,[n,b,g],e,c,f&&f.proFeature,a.id_2_proFeature);alp.aC(alp.nodify(a.entryList,
d),e)}b=alp.cE("div",null,null,{innerHTML:b.innerHTML});var d=alp.nodify(a.sectionBasemap,b),e=alp.nodify(a.sectionStyle,b),f=alp.nodify(a.sectionNetwork,b),g=alp.nodify(a.sectionExtraov,b),l=a.m.basemap.get(),k=a.m.style.get(),m=a.m.network.get(),p=a.m.extraov.get(),q=alp.nodify(a.entryTmpl,d);alp.orphan(q);alp.forEach(a._basemap_arr,alp.bindF(c,null,"basemap",l,d,q,a._mc_map_of_id));d=alp.nodify(a.entryTmpl,e);alp.orphan(d);alp.forEach(a._style_arr,alp.bindF(c,null,"style",k,e,d,a._mc_style_of_name_of_mapid[l]));
(a.withoutMapOverlay||2>a._network_arr.length)&&alp.sA(f,"class",alp.gA(f,"class")+" "+oa.NO_DISPLAY);e=alp.nodify(a.entryTmpl,f);alp.orphan(e);alp.forEach(a._network_arr,alp.bindF(c,null,"network",m,f,e,a._mc_network_of_name_of_mapid[l]));(a.withoutMapOverlay||1>a._extraov_arr.length)&&alp.sA(g,"class",alp.gA(g,"class")+" "+oa.NO_DISPLAY);f=alp.nodify(a.entryTmpl,g);alp.orphan(f);alp.forEach(a._extraov_arr,alp.bindF(c,null,"extraov",p,g,f,a._mc_extraov_of_name_of_mapid[l]));return b}function h(a,
b,c,d,e,f){if(f=e&&f[e])f.purchased||(alp.setProp(d,"innerHTML",f.priceText||f.title),alp.setClass(c,a.payProNodeClass,!0)),alp.oSet(a,b,f),a=alp.nodify(a.entryPayIcon,c),alp.setClass(a,{oax_no_display:!1,"oax-icon-pro":!f.subscription,"oax-icon-lock":f.subscription&&!f.purchased,"oax-icon-unlock":f.subscription&&f.purchased});d&&(alp.setClass(d,oa.NO_DISPLAY,!(e&&!alp.opt(f,"purchased"))),alp.sA(d,"name",b[1]),alp.sA(d,"data-value",b[2]),b=alp.opt(f,"link"),e=alp.opt(f,"page"),b?alp.sA(d,"href",
b):e?alp.sA(d,"href",oa.URL_SHORT_FROM_ID("?page="+encodeURIComponent(e))):alp.setClass(d,{oax_hoverlink_colored:!1,oax_no_pointer_events:!0}))}function g(a,c,d,e,f,g,h){function l(){alp.forEach(alp.qSA('input[name="'+c+'"]',f),"v.checked = v.value===this.old_value",{old_value:g})}h=h&&h.isCheckbox;f.childNodes.a;h?"boolean"===typeof g||"object"===typeof g||null.bug:g.substring.call.a;h=alp.oGet(a,[r,c,d]);d=alp.oGet(a,[n,c,d]);var k=!1,m=null;h&&!h.purchased?m=h:d&&!d.purchased&&(m=d);m&&(k=!0,m.link&&
b.login_indicator()?(b.generic_login_barrier_before({type:"PRO:Redirect",href:m.link}),location.href=m.link):a._purchaseBtn.openDialog({id:m.id}));k&&(alp.stopEvent(e),setTimeout(l,0));return k}alp.sub("oa.x",null,!0);var f=alp.i.state,e=alp.Later,d=oa.util,b=d.community,c=d.map_panel;alp.declare("oa.x.MapLayerPanel",e?alp.x2.AController:alp.x.AbstractController,null,oa.i.IMapLayerPanel,{mapconfig:null,mapboss:null,proj:null,toggleNode:null,toggleSelected:"oax-selected",topContNode:"oax-map-panel-cont",
mpContNode:"oax-mlp-cont",withoutMapOverlay:!1,sectionBasemap:"oax-mlp-section-map",sectionStyle:"oax-mlp-section-style",sectionNetwork:"oax-mlp-section-tracks",sectionExtraov:"oax-mlp-section-additionalLayers",entryList:"oax-mlp-section-list",entryTmpl:"oax-mlp-section-snippet-tmpl",entryTitle:"oax-mlp-section-title",entryImg:"oax-mlp-section-img",entryIcon:"oax-mlp-section-icon",entryDescr:"oax-mlp-section-text",linkPro:"oax-mlp-section-link-pro",linkPay:"oax-mlp-section-link-price",purchaseHandler:"oax-mlp-section-handler-purchase",
entryPayIcon:"oax-mlp-section-pay-icon",networkNone:"oax-mlp-no-track-selected",payProNodeClass:"oax_mlp_pay_pro_node",isOpened:c.isOpened,open:function(){var b=this,d=b.m,h=c.prepare_open(b,"oax-mlp-tmpl",k),n=h.mp_hg,r=alp.nodify(b.networkNone,h.contNode);b[m]=alp.subDfrd(function(){return r&&alp.textContent(r)});c.setup_open(b,alp.oCreateMix(h,{onOpenNow:function(c,h,k,p){function q(){function a(a,d){(a=a&&alp.nodify(b.entryList,a))&&alp.forEach(a.children,c,d)}function c(a){var c=alp.opt(alp.qS("input",
a),"value");if(c=c&&this[c]){var d=c.title,e=alp.nodify(b.entryTitle,a);d&&e&&alp.setText(e,d);if(d=alp.nodify(b.entryImg,a))(e=c.iconUrl)?alp.sA(d,"src",e):alp.style(d,"display","none");if(d=alp.nodify(b.entryIcon,a))(e=c.iconClass)?alp.setClass(d,e,!0):alp.style(d,"display","none");(a=alp.nodify(b.entryDescr,a))&&alp.setText(a,c.subtitle||"")}}var e=d.basemap.get(),f=d.style.get(),g=d.network.get(),k=d.extraov.get(),m=b[l];b[l]=e;if(m!==e){m=alp.nodify(b.sectionBasemap,h);var n=alp.nodify(b.sectionStyle,
h),p=alp.nodify(b.sectionNetwork,h),q=alp.nodify(b.sectionExtraov,h);alp.setProp(alp.qS('input[type=radio][value="'+e+'"]',m),"checked",!0);a(m,e);a(n,b._mc_style_of_name_of_mapid[e]);a(p,b._mc_network_of_name_of_mapid[e]);a(q,b._mc_extraov_of_name_of_mapid[e])}f&&(n=alp.nodify(b.sectionStyle,h),n.childNodes.a,alp.setProp(alp.qS('input[type=radio][value="'+f+'"]',n),"checked",!0));g&&(p=alp.nodify(b.sectionNetwork,h),p.childNodes.a,alp.setProp(alp.qS('input[type=radio][value="'+g+'"]',p),"checked",
!0));q=alp.nodify(b.sectionExtraov,h);q.childNodes.a;alp.forEach(alp.qSA("input[type=radio]",q),'alp.setProp(v, "checked", !!this[v.name])',k);alp.forEach(["style","network","extraov"],function(a){var c=alp.nodify(b["section"+alp.sCamel(a)]);c.childNodes.a;var d=alp.nodify(b.entryList,c);d.childNodes.a;var f=0,g=!0;alp.forEach(d.childNodes,function(c){var d=alp.qS('input[type="radio"]',c),h=alp.qS('input[type="checkbox"]',c);null!=d^null!=h||null.bug;h=d||h;alp.gA(h,"name")===a||null.bug;h=alp.gA(h,
"value");(h||null).substring.call.a;h=h===b._NONE||!!alp.oGet(b,["_mc_"+a+"set_of_mapid",e,h]);alp.setClass(c,oa.NO_DISPLAY,!h);h&&f++;d||(g=!1)});alp.setClass(c,oa.NO_DISPLAY,g&&2>f||1>f)})}n.push(f.chenInit(d.basemap,q));n.push(f.chen(d.style,q));f.to(b[m],function(a){var c=b._NONE;c.substring.call.a;a=alp.sTrim(a);alp.forEach(alp.gEBCN(b.entryTitle,h),function(b){alp.sTrim(alp.textContent(b))===c&&alp.setText(b,a)})});n.push(alp.aEL(alp.qSA("label",h),"click",function(c){var e=alp.qS('input[type="radio"]',
this);if(e){var l=alp.gA(e,"name");e=alp.gA(e,"value");"network"===l&&e===b[a]?((r&&alp.qS('input[type="radio"][name="network"][value="'+b._NONE+'"]',r)).checked=!0,f.setNow(d[l],b._NONE)):g(b,l,e,c,h,d[l].get())||f.setNow(d[l],e)}}));var r=alp.nodify(b.sectionNetwork,h);r.childNodes.a;c=alp.gEBTN("label",r);0<c.length||null.bug;alp.forEach(c,function(c){function e(c){alp.stopEvent(c);b[a]=d[h].get();d[h].get()===l&&((r&&alp.qS('input[type="radio"][name="network"][value="'+b._NONE+'"]',r)).checked=
!0,f.setNow(d[h],b._NONE))}var g=alp.qS('input[type="radio"][name="network"]',c);g.childNodes.a;var h=alp.gA(g,"name"),l=alp.gA(g,"value");"network"===h||null.bug;(l||null).substring.call.a;l!==b._NONE&&n.push(alp.aEL(c,"mousedown",e))});n.push(alp.aEL(alp.qSA('input[type="checkbox"]',h),"change",function(a){var c=alp.gA(this,"name"),e=alp.gA(this,"value"),l=this.checked;g(b,c,e,a,h,alp.opt(d[c].get(),e)||!1,{isCheckbox:!0,checked:l})?this.checked=!1:(a=alp.mix({},d[c].get()),a[e]=l,f.setNow(d[c],
a))}));c=e?oam.x.PurchaseBtn:oax.x.PurchaseBtn;k=alp.gEBCN(b.purchaseHandler,h);p={};k.length&&!b._purchaseBtn&&(alp.forIn(b.id_2_payFeature,"this[v.id] = !!v.purchased",p),alp.forIn(b.id_2_proFeature,"this[v.id] = !!v.purchased",p),b._purchaseBtn=new c({node:k,proj:b.proj||"outdooractive",contentid:"<none>",useGLB:!1,additionalInfoLinks:!0,purchasedContent:p,purchaseLoadingIndicatorTarget:alp.nodify(b.sectionBasemap,h),initNow:!0}))},extraClass:"oax_mlp_wrapper"}))},toggle:c.toggle,augmentModel:function(a){this._imlp_augmentModel(a)},
augmentKids:function(a){alp.setClass(alp.gEBCN("oax-map-panel-cont"),"oax-new-panel",!0)},connectModel2Model:function(a,b,c,d){this._imlp_connectModel2Model.apply(this,arguments)},connectModel2View:function(a,b,d,e){function g(a){var b=d._out_maptype.get(),c=b&&b.id;c&&(h.m.maptypecfg&&f.set(a,h.m.maptypecfg,b&&b.cfg),f.set(a,h.m.maptypeid,c))}var h=a.mapboss;if(h){b.push(f.chenInit(d._out_maptype,g));b.push(f.bindTo(d._out_overlayidset,h.m.overlayidset));var l=h.m.overlaycfg;l&&b.push(f.bindTo(d._out_overlayidset,
l))}c.connectModel2View(a,b,d,e)},connectView2Model:c.connectView2Model,connectPureView:function(a,b,d,e){c.getUrlSearchParam(oa.URL_SEARCH_MLP_OPEN)&&(f.setNow(d.isOpen,!0),a.open())}});var a="_network_value_before_touch",m="_network_none_text_dfrd",l="_bm_change_last_id",r="_rn_2_id_2_payFeature",n="_rn_2_id_2_proFeature"})();"undefined"!==typeof dojo&&dojo.provide("oax.util.url_hash_write_only");
(function(){function k(f,e,d,b){(e||null).substring.call.a;return h(alp.oCreateMix(f,{listen:function(b){return[f.gm.event.addListener(f.map,e,b),"removeListener",f.gm.event]}}),d,alp.bindF(b,null,f.map))}function h(f,e,d){var b=f.flexOpener,c=f.flexOpenerPage,a=f.eh||new alp.Eh,g=f.delay_ms||456;(e||null).substring.call.a;f=f.listen(alp.ratelimitF(g,function(){clearTimeout(h);h=setTimeout(function(){var a=d();b.writeOnly(c,e,a)},789)}));f instanceof Array||null.bug;a.push.apply(a,f);return a;var h}
var g=alp.sub("oax.util.url_hash_write_only",null,!0);g.m_mapoverlay=function(f){return h(alp.oCreateMix(f,{listen:function(e){return[f.m_mapoverlay.change_cb(e)]}}),f.hkey||oax.URL_HASH_MAPOVERLAY,function(){return alp.oKeys(alp.filterIn(f.m_mapoverlay.get()||{},"")).sort().join(",")})};g.map_zoom_center=function(f){return k(f,"bounds_changed",f.hkey||oax.URL_HASH_ZOOMCENTER,function(e){var d=e.getZoom();e=e.getCenter();return[d,e.lng().toFixed(5).replace(/0+$/,""),e.lat().toFixed(5).replace(/0+$/,
"")].join()})};g.map_maptypeid=function(f){return k(f,"maptypeid_changed",f.hkey||oax.URL_HASH_BASEMAP,function(e){return e.getMapTypeId()})}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.mapList");
(function(){alp.declare("oax.x.MapList",oax.x.Gallery,null,{proj:null,topCont:"oax-part-mapList",snippetCont:"oax-mapList-snippet-cont",snippetTmpl:"oax-mapList-snippet-tmpl",moreBtn:"",nTotalDisplay:"oax-mapList-n-total",snippetClassArr:["oax-mapList-snippet"],snippettype:"snippet",loadingIndicator:"oax-mapList-loading-indicator",emptyIndicator:"oax-mapList-empty-indicator",topLoadingClass:"oax-mapList-loading",topEmptyClass:"oax-mapList-empty",infiScroll:!0})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.magazine");
(function(){alp.declare("oax.x.Magazine",oax.x.Gallery,null,{proj:null,topCont:"oax-part-magazine",snippetCont:"oax-magazine-snippet-cont",snippetTmpl:"oax-magazine-snippet-tmpl",moreBtn:"oax-magazine-further-btn",nTotalDisplay:"oax-list-n-total",snippetClassArr:["oax-magazine-snippet"],snippettype:"magazine-snippet",loadingIndicator:"oax-magazine-loading-indicator",emptyIndicator:"oax-magazine-empty-indicator",topLoadingClass:"oax-magazine-loading",topEmptyClass:"oax-magazine-empty"})})();
"undefined"!==typeof dojo&&dojo.provide("oa.util.what");(function(){alp.sub("oa.util",null,!0).what_maybe_selCatSettings=function(k,h,g){(k||null).substring.call.a;(g||null).substring.call.a;(k=alp.nodify(k,h))&&alp.orphan(k);if(k=alp.opt(k,"value")){if((k=alp.oFrom(k))&&k.id===g)return k;console.error("whatsimplecluster: wrong/unreadable cat_settings for catid "+g+": ",k)}}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.whatsimplecluster");
(function(){function k(a){a.clusterI=alp.oDuck(a.clusterDuck,["getCatTree","setAllCatsSelected","setCatSelected"]);a._whatCatClass2Catid_rx=new RegExp(a.whatCatClass2Catid_rx_str);a._whatCatClass2Catname_rx=new RegExp(a.whatCatClass2Catname_rx_str);a._whatCatClass2Cattitle_rx=new RegExp(a.whatCatClass2Cattitle_rx_str);a._topContNode="string"===typeof a.topCont?alp.nodify(a.topCont):a.topCont;a._topContNode.childNodes.a;alp.dom.unscript(a._topContNode);a._whatCatCont="string"===typeof a.whatCatCont?
alp.nodify(a.whatCatCont,a._topContNode):a.whatCatCont;a._whatCatCont&&a._whatCatCont.childNodes.a;a._catNodeArr=alp.gEBCN(a.whatCat,a._whatCatCont);a._catArr=a._catNodeArr.length?alp.map(a._catNodeArr,function(b){return h(a,b)}):[];a._resetNodeArr=alp.gEBCN(a.reset,a._topContNode);a._catSet=alp.arr2o(a._catArr,"catid");a._id2cat={};a._name2cat={};a._title2cat={};for(var b=a._catArr.length;b--;){var c=a._catArr[b];c.catid?(a._id2cat[c.catid]=c,c.catname&&(a._name2cat[c.catname]=c),c.cattitle&&(a._title2cat[c.cattitle]=
c)):(console.error("WhatSimpleCluster: please provide the mandatory catid through a CSS class oax-catid-<id>"),a._catid_missing=!0)}a._titleFindCat=alp.oKeyFindGen(a._title2cat,{returnValue:!0});a._findCat=g}function h(a,b){var c=b.className||"";c={catid:alp.opt(c.match(a._whatCatClass2Catid_rx),1)||"",catname:alp.opt(c.match(a._whatCatClass2Catname_rx),1)||"",cattitle:alp.opt(c.match(a._whatCatClass2Cattitle_rx),1)||""};if(a=r.what_maybe_selCatSettings(a.catSettings,b,c.catid))c.settings=a,c.mapOverlays=
a.mapOverlays;return c}function g(a,b){if(!a)return!1;if(!this._catReady)return"string"===typeof a?{catid:a,catname:a,cattitle:a}:a;if("string"!==typeof a)return this._findCat(a.catid,b)||this._findCat(a.catname,b)||this._findCat(a.cattitle,b);a.substring.call.a;return this._id2cat[a]||this._name2cat[a]||this._title2cat[a]||!b&&this._titleFindCat(a)||a&&/^-?\d+$/.test(a)&&{catid:a}}function f(a,b){var c=[],d;for(d in b)if(!(d in l)){var e=b[d],g=a._id2cat[d];!g&&a._catid_missing&&(g=a._id2cat[d]=
{});if(g||e)g||(g={}),g.catid=d,g.catname=g.catname||e.name,g.cattitle=g.cattitle||e.title,g.isWinter=!(!g.isWinter&&!e.isWinter),g.catid in a._catSet&&(a._id2cat[g.catid]=g,a._name2cat[g.catname]=g,a._title2cat[g.cattitle]=g);(e=e.children)&&c.push(e)}for(b=c.length;b--;)f(a,c[b])}function e(a){var b=a.m.selected_st.get();b=b&&a._findCat(b);a.m.isWinter_st.set(!!alp.opt(b,"isWinter"));a.m.mapOverlays_st.set(alp.opt(b,"mapOverlays")||null)}function d(a){var b=a.m.selected_st.get();"string"===typeof b&&
(b={catid:b,catname:b,cattitle:b});alp.setClass(a._topContNode,a.topSelClass,!!b);alp.setClass(a._resetNodeArr,oax.NO_DISPLAY,!b);var c=Infinity;if(b)for(var d=a._catNodeArr.length;d--;){var e=a._catNodeArr[d],f=h(a,e),g=f.catid,l=f.catname;f=f.cattitle;if(g&&g===b.catid||l&&l===b.catname){var k=e;break}g=alp.sEditDistanceLevenshtein(f||"",b.cattitle||"");3>g&&g<c&&(k=e,c=g)}alp.setClass(alp.gEBCN(a.whatCatGroup),a.selectedClass,!1);for(d=a._catNodeArr.length;d--;)if(e=a._catNodeArr[d],e===k)for(c=
e;c;){if(-1<c.className.indexOf(a.whatCatGroup)){alp.setClass(c,a.selectedClass,!0);break}c=c.parentNode}d=alp.gEBCN(a.activitySpan,a._topContNode);d.length&&(a._default_activity_text||(a._default_activity_text=alp.textContent(d[0])),alp.setText(d,k&&alp.textContent(k.lastElementChild)||a._default_activity_text));k?alp.qS('input[type="radio"]',k).checked=!0:b||alp.forEach(a._catNodeArr,"v  &&  (v = alp.qS( 'input[type=\"radio\"]', v ))  &&  (v.checked = false)");a=alp.gEBCN("oax_input_toggle");alp.setProp(a,
"checked",!1);alp.view.tooltip.close()}function b(b,c,d){if("string"===typeof d)a(c,d,d,d);else if(c._catReady)if(!1===d)b.setAllCatsSelected(!0);else{if(c=alp.opt(d,"catid"))b.setAllCatsSelected(!1),b.setCatSelected(c,!0)}else a(c,d.catid,d.catname,d.cattitle)}function c(b,c,d){d||(d=window.event);alp.stopEvent(d);d=h(b,c);if(d.catid||d.catname||d.cattitle)if(b.twoButtonToggle)a:{b.twoButtonToggle&&2!==b._catNodeArr.length&&console.error("WhatSimple expected self._catNodeArr.length === 2 because  self.twoButtonToggle:"+
b.twoButtonToggle+", got instead self._catNodeArr.length:"+b._catNodeArr.length+" - continuing nevertheless...");for(d=b._catNodeArr.length;d--;){var e=b._catNodeArr[d];if(e!==c){c=h(b,e);a(b,c.catid,c.catname,c.cattitle);break a}}console.error("WhatSimple could not find another button to toggle away from: ",c)}else a(b,d.catid,d.catname,d.cattitle);else console.error("whatsimple could not find catid or catname or cattitle",c);b.catClickEvt().triggerSoon()}function a(a,b,c,d){a._catReadyDfrd.then(alp.bindF(m,
null,a,b,c,d))}function m(a,b,c,d){return(b=a._findCat({catid:b,catname:c,cattitle:d}))?(a.interceptUserSelect?a.interceptUserSelect(b):a.m.selected_st.set(b),!0):!1}var l={},r=oa.util;alp.declare("oax.x.WhatSimpleCluster",alp.x.AbstractController,null,{proj:null,clusterDuck:null,topCont:"oax-part-what",activitySpan:"oax-activity",whatCatCont:"oax-what-dropdown",whatCat:"oax-what-cat",whatCatGroup:"oax-cat-group",topSelClass:"oax-what-has-selection",selectedClass:"oax-what-selected",whatCatClass2Catid_rx_str:"\\boax-catid-(\\S*)",
whatCatClass2Catname_rx_str:"\\boax-catname-(\\S*)",whatCatClass2Cattitle_rx_str:"\\boax-cattitle-(\\S*)",catSettings:oa.CAT_SETTINGS,reset:"oax-what-selection-reset",twoButtonToggle:!1,selected_init:!1,selectorsInstallArgs:null,interceptUserSelect:null,select:function(a){a?this.m.selected_st.setNow(a):this.unselect()},unselect:function(){this.m.selected_st.setNow(!1)},catClickEvt:alp.memM("catClickEvt",'alp.event("OAX:WSC:catClickEvt",{then:1})'),augmentModel:function(a){var b=this;k(b);if(null==
b.selected_init){var c=h(b,b._catNodeArr[0]);b._selected_init=c.id||c.name||c.title}else b._selected_init=b.selected_init||!1;a.selected_st=new alp.ObjectState({init_value:b._selected_init,constrain_all:function(a,c){return a?b._findCat(a):a}});a.selected_st_valid=new alp.ObjectState;a.isWinter_st=new alp.BoolState;a.mapOverlays_st=new alp.StringState;b._catReadyDfrd=alp.dfrd("WS:catReadyDfrd",{then:1});alp.subDfrd(alp.bindF("getCatTree",b.clusterI)).then(function(a){f(b,a);b._catReady=!0;b.m.selected_st.setNow(b._selected_init);
b.m.selected_st.constrain();e(b);b._catReadyDfrd.done()})},connectModel2Model:function(a,b,c,d){function f(){if(a._catReady){var b=a.m.selected_st.get();b=b&&a._findCat(b,!0);a.m.selected_st_valid.set(b||null)}}b.push(c.selected_st.change_cb_init(e,null,a));b.push(c.selected_st.change_cb_init(f));b.push(a._catReadyDfrd.then(f))},connectModel2View:alp.nowF(function(a,c,e,f){function g(){h===a[n]&&(c.push(e.selected_st.change_cb_init(d,null,a)),c.push(e.selected_st.change_cb_init(b,null,a.clusterI,
a)))}var h=a[n]=1+(a[n]|0);a._catNodeArr.length?g():a._catReadyDfrd.then(g)}),connectView2Model:function(a,b,d,e){a._catNodeArr.length&&(alp.forEach(a._catNodeArr,function(d){b.push(alp.aEL(d,"click",alp.bindF(alp.nowF(c),null,a,d)))}),alp.aEL(a._resetNodeArr,"click",function(){a.interceptUserSelect?a.interceptUserSelect():a.unselect()}),oax.selectors.install.apply(null,a.selectorsInstallArgs||[]))}});var n="_cm2v_count"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.whereoutdooractive");
(function(){function k(){var a=this.m.placeSt.get();this.placeChangeEvt().triggerSoon(a||null)}function h(){var a=this.m.qSt.get();this.qChangeEvt().triggerSoon(a||null)}function g(a){var b=this.getInputNode();if(a.keyCode===alp.key.BACKSPACE){a=Infinity;if("selectionStart"in b)a=b.selectionStart;else if(document.selection){b.focus();a=document.selection.createRange();var c=document.selection.createRange().text.length;a.moveStart("character",-b.value.length);a=a.text.length-c}0===a&&this.m.showBadgeSt.get()&&
this.clearWhere()}}function f(){var a=this.m.showBadgeSt.get(),b=this.m.placeSt.get();alp.setClass(this.placeBadge,oax.NO_DISPLAY,!a);a&&(this.placeBadgeText.innerHTML=b.name,this.placeBadgeIcon.className=alp.cfg.getIconByType(b.type));b=alp.gBCR(this.placeBadge);a=a?b.width:0;alp.style(this.getInputNode(),{"padding-left":16+a+"px"})}function e(a){var b=[];a.length&&!a[0].notfound?(b.push(alp.filter(a,"v.freeSearch")),b.push(alp.filter(a,"!v.freeSearch"))):b.push(a);return b}function d(b,c){return 0===
b&&c.freeSearch?alp.opt(a,"where.searchResults"):c.notfound?"":alp.opt(a,"where.searchLocation")}function b(a){return(a=a.match(/^"?([^"]*)"?/))&&a[1]||""}var c=alp._gmap2_3,a,m=oa.util;alp.i18n.fetch("alp.all").then(function(b){a=b});alp.declare("oax.x.WhereOutdooractive",oax.x.AbstractWhere,null,{node:null,proj:null,getInputNode:function(){var a=/^input$/i.test(this.node.tagName)?this.node:alp.gEBTN("input",this.node)[0];a.value;return a},key:null,useGooglePlaces:!1,usePhoton:!0,subset:null,clearClass:oax.WHERE_CLEAR,
interceptUserSelect:null,initText:null,whereInit:null,closeOnMouseDown:!0,includeFreeSearch:!0,displayResultSnippets:!0,setQIfNotArea:!0,defaultSelectFirstOnEnter:function(a){a&&a.freeSearch&&this.kx.whereautocomplete.m.qSt.set(a)},frontendtype:"tour",placeBadgeClass:"oax-where-place-badge",placeBadgeIconClass:"oax-badge-icon",placeBadgeTextClass:"oax-badge-text",placeBadgeDeleteClass:"oax-badge-delete",outputNodeClass:"oax_where_out",clearWhere:alp.nowF(function(){this.m.showBadgeSt.set(!1);this.kx.whereautocomplete.m.placeSt.set();
var a=this.m.qSt.get();a&&a.doNotShow&&this.kx.whereautocomplete.m.qSt.set(null)}),clearSearch:alp.nowF(function(){this.kx.whereautocomplete.m.qSt.set(null);var a={q:null},b=this.m.kxResult._get_no_clone();b&&(a.place=b.place);this.m.kxResult.set(a)}),getInputTextSt:function(){return this.kx.whereautocomplete.getInputTextSt()},getMap:function(){return this.m.mapSt.get()},setMap:function(a){this.m.mapSt.set(a)},placeChangeEvt:alp.memM("placeChangeEvt",'alp.event("placeChangeEvt",{then:1})'),placeChangeCB:alp.eventCB("placeChangeEvt"),
placeChangeDropCB:alp.eventDropCB("placeChangeEvt"),qChangeEvt:alp.memM("qChangeEvt",'alp.event("qChangeEvt",{then:1})'),qChangeCB:alp.eventCB("qChangeEvt"),qChangeDropCB:alp.eventDropCB("qChangeEvt"),augmentModel:function(a){a.mapSt=new alp.State;a.placeSt=new alp.State;a.qSt=new alp.State;a.showBadgeSt=new alp.BoolState;a.kxResult=new alp.ObjectState;this.placeBadge=alp.nodify(this.placeBadgeClass,/^input$/i.test(this.node.tagName)?this.node.parentNode:this.node);this.placeBadgeIcon=alp.nodify(this.placeBadgeIconClass,
this.placeBadge);this.placeBadgeText=alp.nodify(this.placeBadgeTextClass,this.placeBadge);this.placeBadgeDelete=alp.nodify(this.placeBadgeDeleteClass,this.placeBadge);this.initText&&(this.initText=b(this.initText))},augmentKids:function(a){var b=this.initText&&(!this.whereInit||0>this.whereInit.name.indexOf(this.initText))?this.initText:null;b={inputNode:this._inputNode=this.getInputNode(),proj:this.proj,key:this.key,mapSt:this.m.mapSt,stateNode:this.node,clearNode:alp.gEBCN(this.clearClass,this.node),
top_wrap:"oax",initText:b,includeFreeSearch:this.includeFreeSearch,displayResultSnippets:this.displayResultSnippets,closeOnMouseDown:this.closeOnMouseDown,defaultSelectFirstOnEnter:alp.bindF("defaultSelectFirstOnEnter",this),inputPlaceOnly:!1,outputNodeClass:this.outputNodeClass,prepareMultiBlockArray:e,getSubheadingN:d,get_special_marker_cfg:alp.bindF("passive_map_poi_icon_cfg",m)};var f=alp.fVal(c.x.WhereAutocomplete.prototype.sourceArr,alp.opt(this,["subset","displayResultSnippets"],!0));this.useGooglePlaces||
(f=alp.filter(f,"!/places/i.test( v.declaredClass )"));this.usePhoton||(f=alp.filter(f,"!/photon/i.test( v.declaredClass )"));b.sourceArr=f;a.whereautocomplete=new c.x.WhereAutocomplete(b);this._ti=a.whereautocomplete.kx.autocomplete.ti},connectModel2View:function(a,b,c,d){b.push(c.mapSt.bind_to(d.whereautocomplete.m.mapSt));b.push(c.placeSt.change_cb_init(alp.nowF(k,a)));b.push(c.placeSt.change_cb_init(alp.nowF(function(){var b=c.placeSt.get(),e=alp.sub("geometry.viewport",b);a._location_rect&&alp.m(a._location_rect,
"setMap",null);e&&!b.isRegion&&alp.gmap3(function(b){var c=alp.opt(alp.cfg.color.highlight(),["strokeWeight","strokeColor","strokeOpacity"]),f=d.whereautocomplete.prepareViewportRectangle(b,e);a._location_rect=new b.Rectangle(alp.mix(c,{bounds:f}));alp.m(a._location_rect,"setMap",a.getMap())})},a)));b.push(c.qSt.change_cb_init(alp.nowF(h,a)));b.push(alp.aEL(a._inputNode,"keydown",alp.bindF(g,a)));b.push(c.kxResult.change_cb(alp.nowF(function(){var b=c.kxResult._get_no_clone(),d=alp.opt(b,"place");
b=alp.opt(b,"q");a.interceptUserSelect?a.interceptUserSelect(d,b):(c.placeSt.set(d),c.qSt.set(b))})))},connectView2Model:function(a,b,c,d){function e(b){var e=d.whereautocomplete.m.placeSt.get(),f=null,g=null;e&&e.name&&(alp.sub("geometry.location",e)||alp.sub("geometry.viewport",e))&&(g=e);e=a.getInputTextSt().get();a.setQIfNotArea&&b&&g&&!g.isRegion?f={q:g.title,doNotShow:!0,freeSearch:!0}:e&&(f=d.whereautocomplete.m.qSt.get());a.kx.whereautocomplete.kx.autocomplete.close();c.showBadgeSt.set(!!g&&
!!g.name);c.kxResult.set({place:g,q:f})}b.push(d.whereautocomplete.m.placeSt.change_cb(alp.bindF(e,null,!0)));b.push(d.whereautocomplete.m.qSt.change_cb(alp.bindF(e,null,!1)));b.push(c.placeSt.change_cb_init(f,a));a.placeBadgeDelete&&b.push(alp.aEL(a.placeBadgeDelete,"click",alp.bindF("clearWhere",a)))},setInitVal:function(a,b,c,d){a.whereInit&&(a.m.showBadgeSt.set(!0),a.m.placeSt.set(a.whereInit));a.initText&&this.m.qSt.set({q:a.initText,freeSearch:!0,doNotShow:a.whereInit&&-1<a.whereInit.name.indexOf(a.initText)})},
_showWhere:function(a,b){if(a){var c=alp.opt(this.m.kxResult._get_no_clone(),"place");c?this.m.showBadgeSt.set(!!c.name):(c={name:a,alpsteinid:b,isRegion:!!b},this.m.showBadgeSt.set(!0));this.m.placeSt.set(c)}else this.m.showBadgeSt.set(!1),this.m.placeSt.set(null)},_showFreeSearch:function(a){if(a){var c=alp.opt(this.m.kxResult._get_no_clone(),"q");!c||a!==c.qExt&&a!==c.q?(this.m.qSt.set({q:a,freeSearch:!0}),this.getInputTextSt().set(b(a))):(this.m.qSt.set(c),c.doNotShow||this.getInputTextSt().set(c.q))}else this.m.qSt.set(null)}})})();
"undefined"!==typeof dojo&&dojo.provide("oax.x.whereplaces");
(function(){function k(){var e=this[f];e&&g.event("removeListener")(e);this[f]=null;(e=this.m.mapSt.get())&&(this[f]=this.kx.autocomplete.bindTo("bounds",e))}function h(){var e=this.m.placeSt.get();e&&this.placeChangeEvt().triggerSoon(e)}var g=alp._gmap2_3;alp.declare("oax.x.WherePlaces",oax.x.AbstractWhere,null,{node:null,getInputNode:function(){var e=/^input$/i.test(this.node.tagName)?this.node:alp.gEBTN("input",this.node)[0];e.value;return e},proj:null,key:null,getInputTextSt:function(){this._inputTextSt||
(this._inputTextSt=new alp.State({init_value:this.getInputNode().value||"",constrain_all:alp.f('v==null?"":v')}));return this._inputTextSt},getMap:function(){return this.m.mapSt.get()},setMap:function(e){this.m.mapSt.set(e)},placeChangeEvt:alp.memM("placeChangeEvt",'alp.event("placeChangeEvt",{then:1})'),placeChangeCB:alp.eventCB("placeChangeEvt"),placeChangeDropCB:alp.eventDropCB("placeChangeEvt"),augmentModel:function(e){e.mapSt=new alp.State;e.placeSt=new alp.State},augmentKids:function(e){var d=
this;alp.whenPlaces(function(){e.autocomplete=new google.maps.places.Autocomplete(d.inputNode=d.getInputNode())})},connectModel2View:function(e,d,b,c){d.push(b.mapSt.change_cb_init(function(){alp.whenPlaces(k,e)}));d.push(b.placeSt.change_cb_init(alp.nowF(h,e)));d.push(e.getInputTextSt().change_cb_init(function(){e.getInputNode().value=e.getInputTextSt().get()}))},connectView2Model:function(e,d,b,c){function a(){var a=c.autocomplete.getPlace();a&&a.name&&(alp.sub("geometry.location",a)||alp.sub("geometry.viewport",
a))?b.placeSt.setNow(a):b.placeSt.setNow(null)}d.push(setInterval(function(){alp.whenPlaces(a)},178),clearInterval);d.push(setInterval(function(){e.getInputTextSt().setNow(e.getInputNode().value)},257),clearInterval)}});var f="_mapbounds2autocomplete_h"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset");
(function(){function k(b,a){a=alp.oCreateMix({fieldname:"tags"},a);var c=a.fieldname;return function(a,d,e){d="string"===typeof b?b:this.filterView.getInputValue(b.valueFromInput);e=(e[c]||"").split(",");var f=alp.lastIndexOf(e,d);a?0>f&&e.push(d):-1<f&&(e=alp.filter(e,alp.f('!="'+d+'"')));a={};e=alp.filter(e,alp.f());e.sort();a[c]=e.join(",");return a}}function h(b,a,d,e,f,g,h){f=(a=b["from_"+a+"_"+d+"_"+e])&&a.call(b,f.get(),f,alp.oCreate(g()));h(alp.oCreateMix(b.defaultSet||{},f))}function g(c,
a,f){a=alp.oCreateMix(c.defaultSet||{},a());var g=c[e],h=g.m.o_is_specific.get(),k=g.m.o_activity.get();g=g.m.o_difficulty.get();h?(a.activity||a.difficulty||(c[b]=alp.filterIn(a,"w in this",d)),c=g.scale_id,h=g.from,g=g.to,(c&&h&&g||null).substring.call.a,alp.mix(a,d),a.activity=k,a.difficulty="("+c+":"+h+","+g+")"):(alp.mix(a,c[b]),a.activity="",a.difficulty="");f(a)}alp.sub("oax.x.fclset",null,!0);var f=oax.x;f.cbM=function(b,a){a=alp.oCreateMix({revert:!1},a);return function(c,d){d={};d[b]=a.revert?
!c:!!c;return d}};f.checkM=function(b,a){return k(b,alp.oCreateMix(a||{},{fieldname:"checks"}))};f.dateM=function(b,a){var c=alp.oCreateMix({datetmpl:"{YYYY}-{MM}-{DD}"},a);return function(a,d){d={};d[b]=a?alp.date2str(a,c.datetmpl):"";return d}};f.ignoreM=function(){return function(){}};f.sliderLowM=function(b,a){var c=alp.opt(a,"prep");return function(a,d){var e={};e[b]=a>d.min?c?c(a):a:"";return e}};f.sliderHighM=function(b,a){var c=alp.opt(a,"prep");return function(a,d){var e={};e[b]=a<d.max?
c?c(a):a:"";return e}};f.tagM=k;f.vM=function(b){return function(a,c){c={};c[b]=a;return c}};alp.declare("oax.x.Fclset",alp.x.AbstractController,null,{filterView:null,sortheadView:null,getFclFilter:null,setFclFilter:null,setFclAllCatsSelected:null,setFclCatSelected:null,onFclAllCatSelChange:null,defaultSet:null,interceptSetArea:null,setArea:function(b,a){b=b||null;!this.interceptSetArea||a&&a.direct?this.m._area.setNow(b):this.interceptSetArea(b)},setFreeSearch:alp.nowF(function(b,a){b=b||null;var c=
this.sortheadView&&this.sortheadView.m.combined;c&&c.set("");!this.interceptSetFreeSearch||a&&a.direct?this.m._q.set(b):this.interceptSetFreeSearch(b)}),augmentModel:function(b){b._area=new alp.StringState;b.area=alp.oCreateMix(b._area,{set:null,setNow:null});b._q=new alp.StringState;b.q=alp.oCreateMix(b._q,{set:null,setNow:null})},setInitVal:function(b,a,d,e){d._area.set(""+(alp.oGet(this.getFclFilter()||{},"area")||""));d._q.set(""+(alp.oGet(this.getFclFilter()||{},"q")||""))},connectModel2Model:function(b,
a,d,e){a.push(d._area.change_cb_init(h,null,b,"filter","area","id",d._area,b.getFclFilter,b.setFclFilter));a.push(d._q.change_cb_init(h,null,b,"filter","q","name",d._q,b.getFclFilter,b.setFclFilter))},connectModel2View:function(b,a,d,e){b.onFclAllCatSelChange(a,function(a){b.filterView.setCatSel(a)})},connectView2Model:function(b,a,d,f){d={};var c=b.filterView.m.tag;a.push(c.change_cb_init(function(){var a={};alp.forIn(c.get(),function(c,d){var e=b.filterView.getFieldnameFromTagValue(d);(e||null).substring.call.a;
e=a[e]||(a[e]=[]);c&&e.push(d)});var d=alp.mapIn(a,'.join(",")');b.setFclFilter(d)}));a.push(b.filterView.catSelCheckEvt().then(function(a,c){b.setFclCatSelected(a,c)}));for(var l in b.filterView.kx)if(!(l in d)){f=b.filterView.kx[l].m;for(var k in f)if(!(k in d||/^_/.test(k))){var m=f[k];a.push(m.change_cb_init(h,null,b,"filter",l,k,m,b.getFclFilter,b.setFclFilter))}}(l=b[e]=b.filterView._difficultySpecific)&&a.push(l.m.output.change_cb_init(g,null,b,b.getFclFilter,b.setFclFilter));(l=b.sortheadView&&
b.sortheadView.m.combined)&&a.push(l.change_cb_init(h,null,b,"sort","sortedBy","combined",l,b.getFclFilter,b.setFclFilter))},from_sort_sortedBy_combined:function(b,a){return{sortedBy:b||""}},from_filter_area_id:function(b,a){return{area:b||""}},from_filter_q_name:function(b,a){return{q:b||""}},_showArea:function(b){this.m._area.setNow(b||null)}});var e="_filterView_difficultySpecific",d={dif_e:!1,dif_m:!1,dif_d:!1},b="_lagefise"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_tour");
(function(){alp.declare("oax.x.FclsetTour",oax.x.Fclset,null,{defaultSet:{request:"tours"},from_filter_ascent_low:oax.x.sliderLowM("asc_s",{prep:alp.f("Math.round(v / alp.i18n.unit.meterValue(1))")}),from_filter_ascent_high:oax.x.sliderHighM("asc_e",{prep:alp.f("Math.round(v / alp.i18n.unit.meterValue(1))")}),from_filter_length_low:oax.x.sliderLowM("len_s",{prep:alp.f("Math.round(v / alp.i18n.unit.kmValue(1))")}),from_filter_length_high:oax.x.sliderHighM("len_e",{prep:alp.f("Math.round(v / alp.i18n.unit.kmValue(1))")}),
from_filter_time_low:oax.x.sliderLowM("tim_s",{prep:alp.f("*60")}),from_filter_time_high:oax.x.sliderHighM("tim_e",{prep:alp.f("*60")}),from_filter_loopTour_is:oax.x.tagM("lo"),from_filter_scenic_is:oax.x.tagM("sc"),from_filter_suitableforfamilies_is:oax.x.tagM("su"),from_filter_dining_is:oax.x.tagM("di"),from_filter_wheelchairSuitable_is:oax.x.tagM("wcs"),from_filter_publicTransportFriendlyTour_is:oax.x.checkM("pt"),from_filter_stagesTour_is:oax.x.checkM("st"),from_filter_onlyTopTours_is:oax.x.cbM("onlyTop"),
from_filter_easy_is:oax.x.cbM("dif_e"),from_filter_medium_is:oax.x.cbM("dif_m"),from_filter_difficult_is:oax.x.cbM("dif_d"),from_filter_onlyOpened_is:oax.x.cbM("opened")})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.pikaday_fromto");
(function(){function k(d,b,c){({btnAllfuture:function(){b.from.setRelativeDay(0);b.to.setDate(null)},btnToday:function(){b.from.setRelativeDay(0);b.to.setRelativeDay(0)},btnTomorrow:function(){b.from.setRelativeDay(1);b.to.setRelativeDay(1)},btnWeekend:function(){var a=alp.getWeekend();b.from.setDate(a.saturdayDate);b.to.setDate(a.sundayDate)},btnNext14days:function(){b.from.setRelativeDay(0);b.to.setRelativeDay(14)}})[c]();d.linkClickEvt().triggerSoon()}function h(d,b,c,a){var e=b.from.getDate(),
f=b.to.getDate();b=alp.getDayDate(new Date);e=e?alp.getDayDate(e):null;f=f?alp.getDayDate(f):null;var g=e&&alp.getRelativeDay(e,b),h=f&&alp.getRelativeDay(f,b);c={btnAllfuture:function(){return(!e||0===g)&&!f},btnToday:function(){return 0===g&&0===h},btnTomorrow:function(){return 1===g&&1===h},btnWeekend:function(){var a=alp.getWeekend();return a.saturdayRelDay===g&&a.sundayRelDay===h},btnNext14days:function(){return 0===g&&14===h}}[c]();alp.setClass(a,d.selectedBtnClass,c)}var g=["btnAllfuture",
"btnToday","btnTomorrow","btnWeekend","btnNext14days"],f=new Date,e=new Date;f.setHours(0,0,0,0);f.setFullYear(f.getFullYear()-10);e.setHours(0,0,0,0);e.setFullYear(e.getFullYear()+10);alp.declare("alp.x.PikadayFromTo",alp.x.AbstractController,function(){var d=this,b=d.m,c=alp.ratelimitF(100,alp.nowF(function(){d.selectEvt().triggerSoon({from:b.from.get(),to:b.to.get()})}));b.from.change_cb(c);b.to.change_cb(c)},{cont:null,from:"alp-x-pikadayfromto-from",to:"alp-x-pikadayfromto-to",iconFrom:"alp-x-pikadayfromto-icon-from",
iconTo:"alp-x-pikadayfromto-icon-to",firstDay:1,minDate:f,maxDate:e,yearRange:10,useRelativeDays:!1,setDefaultDate:!1,defaultDateFrom:new Date,defaultDateTo:new Date,top_wrap:null,btnAllfuture:"alp-x-pikadayfromto-btn-allfuture",btnToday:"alp-x-pikadayfromto-btn-today",btnTomorrow:"alp-x-pikadayfromto-btn-tomorrow",btnWeekend:"alp-x-pikadayfromto-btn-weekend",btnNext14days:"alp-x-pikadayfromto-btn-next14days",selectedBtnClass:"oax_bold",hideClass:"oax_no_display",showfrom:null,showto:null,showat:null,
dispfromto:null,dispfrom:null,dispto:null,dispat:null,initNow:!0,augmentModel:function(d){this._commonOpt=alp.opt(this,"firstDay minDate maxDate yearRange useRelativeDays setDefaultDate top_wrap".split(" "));this._defaultDateFrom=this._commonOpt.setDefaultDate&&this.defaultDateFrom;this._defaultDateTo=this._commonOpt.setDefaultDate&&this.defaultDateTo;!this._defaultDateFrom||this._defaultDateFrom.setDate.call.a;!this._defaultDateTo||this._defaultDateTo.setDate.call.a;d.from=new alp.DateState({init_value:this._defaultDateFrom});
d.to=new alp.DateState({init_value:this._defaultDateTo})},augmentKids:function(d){var b=this;b.contNode=b.cont;alp.forEach(["from","to","iconFrom","iconTo"].concat(g),function(c){var a=b[c];a="string"!==typeof a?a:alp.nodify(a,b.contNode);b[c+"Node"]=a});alp.and(["contNode","fromNode","toNode"],"this[ v ].parentNode.a",b);alp.and(["iconFromNode","iconToNode"],"!this[ v ]  ||  this[ v ].parentNode.a",b);d.from=new alp.x.Pikaday(alp.oCreateMix(b._commonOpt,{field:b.fromNode,defaultDate:b.defaultDateFrom,
clickNode:b.iconFromNode}));d.to=new alp.x.Pikaday(alp.oCreateMix(b._commonOpt,{field:b.toNode,defaultDate:b.defaultDateTo,clickNode:b.iconToNode}))},connectModel2Model:function(d,b,c,a){b.push(c.from.change_cb_init(function(){var a=c.from.get(),b=c.to.get();a&&b&&b<a&&c.to.set(a)}));b.push(c.to.change_cb_init(function(){var a=c.from.get(),b=c.to.get();a&&b&&b<a&&c.from.set(b)}))},connectModel2View:function(d,b,c,a){function e(){var b=c.from.get(),e=c.to.get(),g=b&&e&&0===alp.getRelativeDay(alp.getDayDate(b),
alp.getDayDate(e));a.from.setDate(b||null);d.showfrom&&f(d.showfrom,b);a.to.setDate(e||null);d.showto&&f(d.showto,e);d.showat&&g&&f(d.showat,b);var h=d.hideClass;d.dispfromto&&d.dispfrom&&d.dispto&&d.dispat?(alp.setClass(d.dispfromto,h,g||!(b&&e)),alp.setClass(d.dispfrom,h,g||!(b&&!e)),alp.setClass(d.dispto,h,g||!(!b&&e)),alp.setClass(d.dispat,h,!g)):(d.dispfrom&&alp.setClass(d.dispfrom,h,!b&&e),d.dispto&&alp.setClass(d.dispto,h,!e&&b))}function f(a,b){var c=/^en$/i.test(alp.i18n.language())?"{M}/{D}/{YYYY}":
"{D}.{M}.{YYYY}";a&&alp.setText(a,b?alp.date2str(b,c):"...")}b.push(c.from.change_cb_init(e));b.push(c.to.change_cb_init(e));alp.forEach(g,function(e){var f=d[e+"Node"];f&&(e=alp.bindF(h,null,d,a,e,f),b.push(c.from.change_cb_init(e)),b.push(c.to.change_cb_init(e)))})},connectView2Model:function(d,b,c,a){b.push(a.from.selectEvt().thenSoon(function(a){c.from.set(a)}));b.push(a.to.selectEvt().thenSoon(function(a){c.to.set(a)}));alp.forEach(g,function(c){var e=d[c+"Node"];e&&b.push(alp.aEL(e,"click",
alp.nowF(alp.bindF(k,null,d,a,c))))})},destroy:function(){this._from.destroy();this._to.destroy();this._to=this._from=null},getDateFrom:function(){return this.m.from.get()},getDateTo:function(){return this.m.to.get()},linkClickEvt:alp.memM("linkClickEvt",'alp.event("pikadayfromto:linkClick",{then:1})'),selectEvt:alp.memM("selectEvt",'alp.event("pikadayfromto:select",{then:1})')})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.selectbtn");
(function(){function k(e){for(var d=e[f],b=e.m.active.get(),c=0,a=d.length;c<a;c++){var g=d[c],h=g.className.match(e.btnValClassRx)[1];alp.setClass(g,e.activeClass,h==b)}}function h(e,d){d||(d=window.event);d=(d.target||d.srcElement).className.match(e.btnValClassRx)[1];var b=e.m.active;e.permitNoneSelected?b.setNow(b.is(d)?null:d):b.setNow(d)}function g(e){return"string"===typeof e.cont?alp.gEBI(e.cont)||alp.gEBCN(e.cont)[0]:e.cont}alp.declare("alp.x.Selectbtn",alp.x.AbstractController,null,{cont:null,
permitNoneSelected:!0,initFromDom:!0,init_value:null,btnClass:"alp-selectbtn",activeClass:"alp-selectbtn-active",btnValClassRx:/\balp-selectbtn-(\S+)\b/,augmentModel:function(e){e.active=new alp.State({init_value:this.init_value||0})},setInitVal:function(e,d,b,c){e[f]=alp.gEBCN(e.btnClass,g(e));if(e.initFromDom){b.active.set();d=e[f];c=0;for(var a=d.length;c<a;c++){var h=d[c];if(alp.hasClass(h,e.activeClass)){b.active.set(h.className.match(e.btnValClassRx)[1]);break}}}e.permitNoneSelected||b.active.set(e[f][0].className.match(e.btnValClassRx)[1])},
connectModel2View:function(e,d,b,c){d.push(b.active.change_cb_init(alp.bindF(k,null,e)))},connectView2Model:function(e,d,b,c){d.push(alp.aEL(e[f],"click",alp.bindF(h,null,e)))}});var f="_BTN_ARR"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.difficulty_specific");
(function(){function k(d,b){function c(c){a===b.single_catid.get()&&(c=c&&alp.oGet(c,["property",0]),b._scale_info.setNow({catid:a,info:c||null}))}var a=b.single_catid.get();a?e.api_catdiff({catid:a}).thenSoon(c):b._scale_info.set(null)}function h(d,b){var c=b.single_catid.get(),a=b._scale_info.get(),e=(a=c&&a&&c===alp.oGet(a,"catid")&&alp.oGet(a,"info"))&&a.id,f=null;a&&((e||null).substring.call.a,f=d._catid_2_output,f=f[c]||(f[c]={is_specific:!0,activity:c,difficulty:{scale_id:e}}),c=f.difficulty,
a=a.property,null==c.from&&(c.from=a[0].id),null==c.to&&(c.to=a[a.length-1].id),(c.from||null).substring.call.a,(c.to||null).substring.call.a);b.output.set(f)}function g(d,b,c){var a=b.o_activity.get();a&&(b=f(d,b,c,a))&&(b=b.cont,alp.isDescendant(b,d.diffSpec)||alp.aC(alp.empty(d.diffSpec),b))}function f(d,b,c,a){function e(a){a=p[a].text;(a||null).substring.call.a;return a}function f(a){a.change_cb_init(g)}function g(){var c=b.output.get();if(c&&c.activity===a){var e=t.m.low.get(),f=t.m.high.get();
e=p[e].id;f=p[f].id;(e&&f||null).substring.call.a;c=alp.oCopy(c);alp.oSet(c,"difficulty.from",e);alp.oSet(c,"difficulty.to",f);b.output.set(d._catid_2_output[a]=c)}}(a||null).substring.call.a;c=alp.sub("_catid_2_slider_info",d,!0);if(!(a in c)){var h=b._scale_info.get(),k=b.output.get();if(a===h.catid&&a===k.activity){k=alp.cE("div",null,null,{innerHTML:d._diffSpec_html});var p=h.info.property,v=p.length,u=h.info.text;v.toPrecision.call.a;(u||"").substring.call.a;u&&alp.setText(alp.gEBCN("oax-difficulty-specific-title",
k),u);v={initNow:!0,cont:alp.nodify("oax-slider-difficulty-specific",k),range:!0,drag:!0,vMin:0,vMax:v-1,discreteStep:1,lowDisplay:alp.nodify("oax-slider-difficulty-specific-s-vis",k),highDisplay:alp.nodify("oax-slider-difficulty-specific-e-vis",k),htmlDisplay:e};var t=new alp.x.Slider(v);alp.forEach([t.m.low,t.m.high],f);c[a]={cfg:v,slider:t,cont:k,scale_info:h}}}return c[a]}var e=alp.data;alp.declare("oax.x.DifficultySpecific",alp.x.AbstractController,null,{diffGen:null,diffSpec:null,m_input:null,
resetAllRanges:alp.nowF(function(){alp.forIn(this._catid_2_slider_info||{},function(d){if(d=d&&d.slider)d.m.low.setToMin(),d.m.high.setToMax()})}),augmentModel:function(d){alp.and([this.diffGen,this.diffSpec],".childNodes.a");d.single_catid=new alp.StringState;this.m_input&&alp.mixCheck(d,this.m_input);d._scale_info=new alp.State;this._catid_2_output={};d.output=new alp.State;d.o_is_specific=alp.partState(d.output,"is_specific");d.o_activity=alp.partState(d.output,"activity");d.o_difficulty=alp.partState(d.output,
"difficulty");d.o_diff_from=alp.partState(d.o_difficulty,"from");d.o_diff_to=alp.partState(d.o_difficulty,"to")},augmentKids:function(d){this._diffSpec_html=this.diffSpec.innerHTML},connectModel2Model:function(d,b,c,a){b.push(c.single_catid.change_cb_init(k,null,d,c));b.push(c._scale_info.change_cb_init(h,null,d,c))},connectModel2View:function(d,b,c,a){b.push(c.o_is_specific.change_cb_init(function(){var a=c.o_is_specific.get();alp.setClass(d.diffGen,oa.NO_DISPLAY,a);alp.setClass(d.diffSpec,oa.NO_DISPLAY,
!a)}));b.push(c.o_activity.change_cb_init(g,null,d,c,a))}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter");
(function(){function k(a,b,d,e){var f=e.originalNode;d=alp.opt(b.match(a.sfNameRx),1);e=oax.URL_HASH_FILTER_TYPE_CHECKBOX_STANDARD+"-"+d;var g=!1;if(!a.no_check_init){g=!!a["check_init_"+d];var h=r.checkbox_init_from_url_hash(e);h&&1===h[0]&&(g=!0)}f.checked=g;if(d in a._sf_input){var k='oax.filter: Non-unique filter checkbox found "'+b+'". Filter checkboxes must have unique names.';console.error(k);setTimeout(function(){throw Error(k);})}a._sf_input[d]=f;b=new alp.BoolState({init_value:!!f.checked});
f=alp.opt(alp.dataset(f),a.cbDataset_invert)?alp.notState(b):b;a.kx[d]={m:{is:f}};a=alp.bindF(c,a,b,e,g);b.change_cb_init(a);return b}function h(b,d,e,f){e=f.originalNode;d=a(b,d);f=oax.URL_HASH_FILTER_TYPE_CHECKBOX_CATSEL+"-"+d;var g=!!b.m.catsel.get_property(d),h=r.checkbox_init_from_url_hash(f);h&&1===h[0]&&(g=!0);e.checked=g;b._catsel_input[d]=e;h=new alp.BoolState({init_value:!!e.checked});e=alp.opt(alp.dataset(e),b.cbDataset_invert)?alp.notState(h):h;b.kx._catsel[d]={m:{is:e}};b=alp.bindF(c,
b,h,f,g);h.change_cb_init(b);return h}function g(b,c,d){c=a(b,c);b.catSelCheckEvt().triggerSoon(c,d)}function f(a,b,d,e){d=e.originalNode;b=alp.opt(b.match(a.sfName2TagRx),1);e=oax.URL_HASH_FILTER_TYPE_CHECKBOX_TAG+"-"+b;var f=!!a.m.tag.get_property(b),g=r.checkbox_init_from_url_hash(e);g&&1===g[0]&&(f=!0);d.checked=f;a._tag_input[b]=d;g=alp.opt(d.className.match(a.sfClass2TagfieldnameRx),1)||p;alp.oSet(a,[q,b],g);g=new alp.BoolState({init_value:!!d.checked});d=alp.opt(alp.dataset(d),a.cbDataset_invert)?
alp.notState(g):g;d[v]=d.get();a.kx._tag[b]={m:{is:d}};a=alp.bindF(c,a,g,e,f);g.change_cb_init(a);return g}function e(a,b,c,d){function e(){var b=alp.arr2o([a.tagGroupContAllClass,a.tagGroupContSomeClass,a.tagGroupContNoneClass],alp.f(),alp.f(!1));var c=f();c=alp.and(c)?a.tagGroupContAllClass:alp.or(c)?a.tagGroupContSomeClass:a.tagGroupContNoneClass;b[c]=!0;alp.setClass(g,b)}function f(){return alp.oValues(alp.mapIn(h,".m.is.get()"))}c=d.originalNode;b=alp.opt(b.match(a.sfName2TaggroupRx),1);for(var g=
a._taggroup_input[b]=c;g&&!a.tagGroupContClassRx.test(g.className);)g=g.parentNode;g.childNodes.a;var h=alp.filterIn(a.kx._tag,function(b,c){return alp.isDescendant(a._tag_input[c],g)});c.checked=!!alp.or(f());e();var k=new alp.BoolState({init_value:!!c.checked});a.kx._taggroup[b]={m:{is:k},kx:h};alp.forIn(h,function(a,b){a.m.is.change_cb(function(){k.set(!!alp.or(f()));e()})});k.change_cb(function(){var a=k.get();a!==!!alp.or(f())&&alp.forIn(h,".m.is.set("+a+")")});return k}function d(a,b,c){a._sf_select[b]=
c}function b(a,b,c){a["onchoose_"+b](b,c)}function c(a,b,c){a=a.get()?[1]:c?[0]:null;this.flexOpener.writeOnlySubPart(this.flexOpenerPage,oax.URL_HASH_FILTER,b,a||null)}function a(a,b){return alp.opt(b.match(a.sfName2CatidRx),1)}function m(a,b,c){a={};for(var d in b)if(!(d in n)){var e=b[d].m,f=a[d]={},g;for(g in e)if(!(g in n||/^_/.test(g))){var h=e[g];f[g]=c?h:h.get()}}return a}function l(a){var b=a[u],c=m(a,a.kx,!1);b=b&&!alp.oEqual(b,c);alp.setClass(a._outsideChangedResetNodeArr,oax.NO_DISPLAY,
!b);alp.m(a,"view_layout_update")}var r=oax.util,n={};alp.declare("oax.x.Filter",alp.x.AbstractController,null,{cont:null,cont2:null,tag_init:null,no_check_init:!1,outsideChangedReset:"oax-filter-changed-reset",outsideChangedResetCont:null,resetClass:"oax-filter-reset",m_input:null,view_layout_update:null,cbDataset_invert:"oaFilterCbInvert",flexOpener:null,flexOpenerPage:null,sfClass2TagfieldnameRx:/(?:^|\s)oax-filtertagfieldname-(\S*?)(?:\s|$)/,sfNameRx:/^oax-filter-(.*)$/,sfName2TagRx:/^oax-filter(?:tag|check)-(.*)$/,
sfName2TaggroupRx:/^oax-filter(?:tag|check)group-(.*)$/,tagGroupContClassRx:/\boax-filter(?:tag|check)group-cont\b/,tagGroupContNoneClass:"oax-none-selected",tagGroupContSomeClass:"oax-some-selected",tagGroupContAllClass:"oax-all-selected",sfName2CatidRx:/^oax-filtercat-(.*)$/,diffGen:"oax-difficulty-generic",diffSpec:"oax-difficulty-specific",augmentModel:function(a){a.difficulty_single_catid=new alp.StringState;this.m_input&&alp.mixCheck(a,this.m_input);a.catsel=new alp.ObjectState;a.tag=new alp.ObjectState({init_value:this.tag_init})},
augmentKids:function(c){function l(a){a=alp.gA(a,"name");return!!alp.opt(a.match(m.sfNameRx),1)}var m=this,n=alp.gEBTN("input",m.cont),p=alp.gEBTN("select",m.cont);m._sf_input={};m._sf_select={};alp.styleform.init({now:!0,cont:{input:alp.filter(n,l),select:alp.filter(p,l)},oncheck_init:alp.bindF(k,null,m),oncheck:null,onchoose_init:alp.bindF(d,null,m),onchoose:alp.bindF(b,null,m)});m._catsel_input={};c._catsel={};alp.styleform.init({now:!0,cont:{input:alp.filter(n,function(b){return!!a(m,alp.gA(b,
"name"))})},oncheck_init:alp.bindF(h,null,m),oncheck:alp.bindF(alp.nowF(g),null,m)});m._tag_input={};c._tag={};alp.styleform.init({now:!0,cont:{input:alp.filter(n,function(a){a=alp.gA(a,"name");return!!alp.opt(a.match(m.sfName2TagRx),1)})},oncheck_init:alp.bindF(f,null,m)});m._taggroup_input=[];c._taggroup={};alp.styleform.init({now:!0,cont:{input:alp.filter(n,function(a){a=alp.gA(a,"name");return!!alp.opt(a.match(m.sfName2TaggroupRx),1)})},oncheck_init:alp.bindF(e,null,m)});c=alp.nodify(m.diffGen,
m.cont);if(n=alp.nodify(m.diffSpec,m.cont))m._difficultySpecific=new oax.x.DifficultySpecific({initNow:!0,diffGen:c,diffSpec:n,m_input:{single_catid:m.m.difficulty_single_catid}})},setInitVal:function(a,b,c,d){if(b=a[u]){for(var e in b)if(!(e in n)){var f=b[e],g=d[e].m,h;for(h in f)h in n||alp.m(g[h],"set",f[h])}alp.forIn(d._catsel,".m.is.set( true )")}c.catsel.set(alp.mapIn(d._catsel,".m.is.get()"));a._outsideChangedResetNodeArr="string"===typeof a.outsideChangedReset?alp.gEBCN(a.outsideChangedReset,
a.outsideChangedResetCont):a.outsideChangedReset},connectModel2Model:function(a,b,c,d){a[u]||(a[u]=m(a,d,!1));alp.forIn(d._tag,function(a,d){var e=a.m.is;b.push(e.change_cb_init(function(){c.tag.set_property(d,e.get())}))})},connectModel2View:function(a,b,c,d){var e=m(a,d,!0),f;for(f in e)if(!(f in n)){var g=e[f],h;for(h in g)h in n||b.push(g[h].change_cb(alp.bindF(l,null,a)))}b.push(c.catsel.change_cb_init(function(){var a=c.catsel.get(),b;for(b in a)if(!(b in n)){var e=d._catsel[b];e&&e.m.is.set(!!a[b])}}));
l(a)},connectView2Model:function(a,b,c,d){c=alp.Apc.call(a._outsideChangedResetNodeArr,alp.gEBCN(a.resetClass,a.cont));b.push(alp.aEL(c,"click",alp.nowF(function(b){alp.stopEvent(b||window.event);a.init();alp.m(a._difficultySpecific,"resetAllRanges");alp.forIn(a.kx._tag,function(a){a=a.m.is;v in a&&a.set(a[v])})})))},getFieldnameFromTagValue:function(a){return alp.oGet(this,[q,a])||p},setCatSel:function(a){this.m.catsel.mixin(a)},catSelCheckEvt:alp.memM("catSelCheckEvt",'alp.event("OXF:catselCheckEvt",{then:1})'),
getInputValue:function(a){(a||0).substring.call.a;return this._sf_input[a].value},getNode:function(a){return alp.gEBCN(a,this.cont)[0]||this.cont2&&alp.gEBCN(a,this.cont2)[0]},getSliderCfg:function(a){return alp.filterIn({vInit:this[a+"_slider_vInit"],vMin:this[a+"_slider_vMin"],vMax:this[a+"_slider_vMax"],range:this[a+"_slider_range"],discreteStep:this[a+"_slider_discreteStep"],discreteValues:this[a+"_slider_discreteValues"],singleSel:this[a+"_slider_singleSel"],lowDisplay:this[a+"_slider_lowDisplay"]||
"oax-slider-"+a+"-s-vis",highDisplay:this[a+"_slider_highDisplay"]||"oax-slider-"+a+"-e-vis",htmlDisplay:this[a+"_slider_htmlDisplay"],highDisplayPlus:!0},"!=null")},createDateFromTo:function(a,b){function c(b){if(h)return(b=alp.gEBCN(a.replace(/-wrapper$/,"-"+b),h))&&b===h&&null.bug,b}function d(){var a=(a=u.getDateFrom())&&[alp.date2str(a,"{YYYY}_{MM}_{DD}")],b=(b=u.getDateTo())&&[alp.date2str(b,"{YYYY}_{MM}_{DD}")];e.flexOpener.writeOnlySubPart(e.flexOpenerPage,oax.URL_HASH_FILTER,q,a||null);e.flexOpener.writeOnlySubPart(e.flexOpenerPage,
oax.URL_HASH_FILTER,w,b||null)}var e=this,f=a.replace(/-wrapper$/,"-pick"),g=f!==a;if(g){var h=e.getNode(a);var k=c("toggle");f=h&&alp.nodify(f,h);var l=alp.arr2o("showfrom showto showat dispfromto dispfrom dispto dispat".split(" "),alp.f(),c)}else h=null,f=e.getNode(a);if(g){var m=new alp.BoolState;m.change_cb_init(function(){alp.setClass(h,"oax-filter-date-toggle-open",m.get())});alp.aEL(k,"click",function(){m.setNow(!m.get())});alp.aEL(alp.body(),"click",function(a){a||(a=window.event);alp.isDescendant(a.target||
a.srcElement,h)||m.setNow(!1)})}k=new Date;var n=new Date(k);n.setMonth(1+n.getMonth());var p=oax.URL_HASH_FILTER_TYPE_PIKADAYFROMTO,q=p+"-from",w=p+"-to",t=r.pikaday_init_from_url_hash(q),v=r.pikaday_init_from_url_hash(w);if(p=t||v)t&&3===t.length?(k.setYear(t[0]),k.setMonth(t[1]-1),k.setDate(t[2])):k=null,v&&3===v.length?(n.setYear(v[0]),n.setMonth(v[1]-1),n.setDate(v[2])):n=null;t=new Date;t.setHours(0,0,0,0);var u=new alp.x.PikadayFromTo(alp.mix({cont:f,setDefaultDate:p,defaultDateFrom:k,defaultDateTo:n,
top_wrap:"oax",minDate:t},l,b));g&&u.linkClickEvt().thenSoon(function(){m.set(!1)});u.selectEvt().thenSoon(d);d();return u},createSlider:function(a,b){function c(){var a=h.isMin()&&k.isMax()?null:g.range?[h.get(),k.get()]:[h.get()];d.flexOpener.writeOnlySubPart(d.flexOpenerPage,oax.URL_HASH_FILTER,e,a||null)}var d=this,e=oax.URL_HASH_FILTER_TYPE_SLIDER+"-"+a,f=r.slider_vInit_from_url_hash(e);a=alp.oCreateMix(alp.oCreateMix(this.getSliderCfg(a),b),{cont:this.getNode(this["slider_"+a])});f&&(a.vInit=
f);var g=new alp.x.Slider(a),h=g.m.low,k=g.m.high;h.change_cb(c);k.change_cb(c);c();return g},createSelectbtn:function(a,b){var c=this,d=oax.URL_HASH_FILTER_TYPE_SELECTBTN+"-"+a,e=r.selectbtn_init_from_url_hash(d);e&&1===e.length&&(b=e[0]);var f=new alp.x.Selectbtn({cont:c.getNode(c["selectbtn_"+a]),initFromDom:!1,init_value:b||0});f.m.active.change_cb_init(function(){var a=(a=f.m.active.get(),0<a?[a]:null);c.flexOpener.writeOnlySubPart(c.flexOpenerPage,oax.URL_HASH_FILTER,d,a||null)});return f}});
var q="_tag2fieldname",p="tags",v="_oax_filter_first_value",u="_first_init_vals"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_tour");
(function(){alp.declare("oax.x.FilterTour",oax.x.Filter,null,{slider_ascent:"oax-slider-ascent",slider_length:"oax-slider-length",slider_time:"oax-slider-time",ascent_slider_vMin:0,ascent_slider_vMax:2E3,ascent_slider_range:!0,ascent_slider_discreteStep:100,length_slider_vMin:0,length_slider_vMax:50,length_slider_range:!0,length_slider_discreteStep:10,time_slider_vMin:0,time_slider_vMax:10,time_slider_range:!0,time_slider_discreteStep:1,augmentModel:function(k){this.ascent_slider_vMax=Math.round(alp.i18n.unit.meterValue(this.ascent_slider_vMax,
{round:500}));this.length_slider_vMax=Math.round(alp.i18n.unit.kmValue(1E3*this.length_slider_vMax,{round:10}))},augmentKids:function(k){k.ascent=this.createSlider("ascent");k.length=this.createSlider("length");k.time=this.createSlider("time")}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_tour");(function(){alp.declare("oax.x.SortheadTour",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_skiresort");
(function(){alp.declare("oax.x.FclsetSkiresort",oax.x.Fclset,null,{defaultSet:{request:"skiresorts"},from_filter_snowheight_low:oax.x.sliderLowM("sft_s",{prep:alp.f("Math.round(v / alp.i18n.unit.cmValue(1) * 100)")}),from_filter_snowheight_high:oax.x.sliderHighM("sft_e",{prep:alp.f("Math.round(v / alp.i18n.unit.cmValue(1) * 100)")}),from_filter_slopesKm_low:oax.x.sliderLowM("len_s",{prep:alp.f("Math.round(v / alp.i18n.unit.kmValue(1000))")}),from_filter_slopesKm_high:oax.x.sliderHighM("len_e",{prep:alp.f("Math.round(v / alp.i18n.unit.kmValue(1000))")}),
from_filter_lastSnowfall_active:oax.x.vM("lsfd"),from_filter_onlyOpened_is:oax.x.cbM("opened"),from_filter_easy_is:oax.x.cbM("dif_e"),from_filter_medium_is:oax.x.cbM("dif_m"),from_filter_difficult_is:oax.x.cbM("dif_d")})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_skiresort");
(function(){alp.declare("oax.x.FilterSkiresort",oax.x.Filter,null,{slider_snowheight:"oax-slider-snowheight",slider_slopesKm:"oax-slider-slopesKm",snowheight_slider_vMin:0,snowheight_slider_vMax:400,snowheight_slider_range:!0,snowheight_slider_discreteStep:20,slopesKm_slider_vMin:0,slopesKm_slider_vMax:100,slopesKm_slider_range:!0,slopesKm_slider_discreteStep:10,selectbtn_lastSnowfall:"oax-selectbtncont-lastSnowfall",augmentModel:function(k){this.snowheight_slider_vMax=Math.round(alp.i18n.unit.cmValue(this.snowheight_slider_vMax/
100,{round:100}));this.slopesKm_slider_vMax=Math.round(alp.i18n.unit.kmValue(1E3*this.slopesKm_slider_vMax,{round:10}))},augmentKids:function(k){k.snowheight=this.createSlider("snowheight");k.slopesKm=this.createSlider("slopesKm");k.lastSnowfall=this.createSelectbtn("lastSnowfall")}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_skiresort");(function(){alp.declare("oax.x.SortheadSkiresort",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();
"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_condition");(function(){alp.declare("oax.x.FclsetCondition",oax.x.Fclset,null,{defaultSet:{request:"conditions"},from_filter_condition_low:oax.x.ignoreM(),from_filter_condition_lowDval:oax.x.vM("days_ago_s"),from_filter_condition_high:oax.x.ignoreM(),from_filter_condition_highDval:oax.x.ignoreM()})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_condition");
(function(){alp.declare("oax.x.FilterCondition",oax.x.Filter,null,{slider_condition:"oax-slider-condition",condition_slider_discreteValues:[0,1,2,3,4,5,7,14,30,90,365],condition_slider_singleSel:"left",augmentKids:function(k){var h=this.condition_slider_vInit;null==h&&(h=oax.CONDITION_SLIDER_INIT);k.condition=this.createSlider("condition",{vInit:h})}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_condition");
(function(){alp.declare("oax.x.SortheadCondition",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_poi");(function(){alp.declare("oax.x.FclsetPoi",oax.x.Fclset,null,{defaultSet:{request:"pois"},from_filter_destination_is:oax.x.checkM("ds"),from_filter_badweathertips_is:oax.x.tagM("bw"),from_filter_suitableForTheDisabled_is:oax.x.tagM("sd"),from_filter_Families_is:oax.x.tagM("fa")})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_poi");
(function(){alp.declare("oax.x.FilterPoi",oax.x.Filter,null,{check_init_destination:!1})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_poi");(function(){alp.declare("oax.x.SortheadPoi",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_offer");
(function(){alp.declare("oax.x.FclsetOffer",oax.x.Fclset,null,{defaultSet:{request:"offers"},from_filter_price_low:oax.x.sliderLowM("price_s"),from_filter_price_high:oax.x.sliderHighM("price_e"),from_filter_datefromto_from:oax.x.dateM("period_s"),from_filter_datefromto_to:oax.x.dateM("period_e")})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_offer");
(function(){alp.declare("oax.x.FilterOffer",oax.x.Filter,null,{slider_price:"oax-slider-price",price_slider_vMin:0,price_slider_vMax:2E3,price_slider_range:!0,price_slider_discreteStep:50,augmentKids:function(k){k.price=this.createSlider("price");k.datefromto=this.createDateFromTo("oax-offer-datefromto-pick")}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_offer");(function(){alp.declare("oax.x.SortheadOffer",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();
"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_story");(function(){alp.declare("oax.x.FclsetStory",oax.x.Fclset,null,{defaultSet:{request:"stories"},from_filter_topstory_is:oax.x.tagM("ts"),from_filter_excursion_is:oax.x.tagM("ex"),from_filter_family_is:oax.x.tagM("fa"),from_filter_photo_is:oax.x.tagM("ph"),from_filter_video_is:oax.x.tagM("vi"),from_filter_summer_is:oax.x.tagM("su"),from_filter_winter_is:oax.x.tagM("wi")})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_story");
(function(){alp.declare("oax.x.FilterStory",oax.x.Filter,null,{check_init_topstory:!1,augmentKids:function(k){}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_story");(function(){alp.declare("oax.x.SortheadStory",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_hut");
(function(){alp.declare("oax.x.FclsetHut",oax.x.Fclset,null,{defaultSet:{request:"huts"},from_filter_altitude_low:oax.x.sliderLowM("alt_s",{prep:alp.f("Math.round(v / alp.i18n.unit.meterValue(1))")}),from_filter_altitude_high:oax.x.sliderHighM("alt_e",{prep:alp.f("Math.round(v / alp.i18n.unit.meterValue(1))")}),from_filter_datefromto_from:oax.x.dateM("openFrom"),from_filter_datefromto_to:oax.x.dateM("openTo"),from_filter_accessibleByCar_is:oax.x.tagM("aca"),from_filter_accessibleByCableway_is:oax.x.tagM("acw"),
from_filter_ShowerAndWC_is:oax.x.tagM("sw"),from_filter_Families_is:oax.x.tagM("fa"),from_filter_luggageTransport_is:oax.x.tagM("lt"),from_filter_PetsAllowed_is:oax.x.tagM("pa"),from_filter_wirelessCoverage_is:oax.x.tagM("wi"),from_filter_wLan3gup_is:oax.x.tagM("3g"),from_filter_climbingWall_is:oax.x.tagM("cw"),from_filter_mitKindernAufHuetten_is:oax.x.tagM("p0"),from_filter_soSchmeckenDieBerge_is:oax.x.tagM("p1"),from_filter_ecoLabel_is:oax.x.tagM("p2"),from_filter_isOfficialAvMountainHut_is:oax.x.checkM("av"),
from_filter_isWithAccommodation_is:oax.x.checkM("ac"),from_filter_isSeminarSuitable_is:oax.x.checkM("se"),from_filter_isAlpineClubHut_is:oax.x.cbM("alpineClub"),from_filter_onlyOpened_is:oax.x.cbM("opened")})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_hut");
(function(){alp.declare("oax.x.FilterHut",oax.x.Filter,null,{slider_altitude:"oax-slider-altitude",altitude_slider_vMin:0,altitude_slider_vMax:2500,altitude_slider_range:!0,altitude_slider_discreteStep:100,augmentModel:function(k){this.altitude_slider_vMax=Math.round(alp.i18n.unit.meterValue(this.altitude_slider_vMax,{round:500}))},augmentKids:function(k){k.altitude=this.createSlider("altitude");k.datefromto=this.createDateFromTo("oax-hut-datefromto-pick")}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_hut");
(function(){alp.declare("oax.x.SortheadHut",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_lodging");
(function(){alp.declare("oax.x.FclsetLodging",oax.x.Fclset,null,{defaultSet:{request:"lodgings"},from_filter_classification_low:oax.x.sliderLowM("cat_s"),from_filter_classification_high:oax.x.sliderHighM("cat_e"),from_filter_price_low:oax.x.sliderLowM("price_s"),from_filter_price_high:oax.x.sliderHighM("price_e"),from_filter_Parking_is:oax.x.tagM("pl"),from_filter_InLodgingInternetOrWLANPayed_is:oax.x.tagM("wl"),from_filter_AirConditioning_is:oax.x.tagM("ac"),from_filter_TransferService_is:oax.x.tagM("ts"),
from_filter_Sat_Cable_TV_is:oax.x.tagM("tv"),from_filter_RoomService_is:oax.x.tagM("rs"),from_filter_Spa_is:oax.x.tagM("spa"),from_filter_ChildAndBabySitting_is:oax.x.tagM("bc"),from_filter_suitableForTheDisabled_is:oax.x.tagM("sd"),from_filter_PetsAllowed_is:oax.x.tagM("pa"),from_filter_hikingfriendly_is:oax.x.tagM("hf"),from_filter_cyclingfriendly_is:oax.x.tagM("cf")})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_lodging");
(function(){alp.declare("oax.x.FilterLodging",oax.x.Filter,null,{slider_classification:"oax-slider-classification",slider_price:"oax-slider-price",classification_slider_vMin:0,classification_slider_vMax:5,classification_slider_range:!0,classification_slider_discreteStep:1,price_slider_vMin:0,price_slider_vMax:150,price_slider_range:!0,price_slider_discreteStep:5,augmentKids:function(k){k.classification=this.createSlider("classification");k.price=this.createSlider("price")}})})();
"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_lodging");(function(){alp.declare("oax.x.SortheadLodging",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_toptipps");(function(){alp.declare("oax.x.FclsetToptipps",oax.x.Fclset,null,{defaultSet:{request:"toptipps"}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_toptipps");(function(){alp.declare("oax.x.FilterToptipps",oax.x.Filter,null,{augmentKids:function(k){}})})();
"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_toptipps");(function(){alp.declare("oax.x.SortheadToptipps",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_literature");(function(){alp.declare("oax.x.FclsetLiterature",oax.x.Fclset,null,{defaultSet:{request:"literature"},from_filter_price_low:oax.x.sliderLowM("price_s"),from_filter_price_high:oax.x.sliderHighM("price_e"),from_filter_premium_is:oax.x.checkM("premium")})})();
"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_literature");(function(){alp.declare("oax.x.FilterLiterature",oax.x.Filter,null,{slider_price:"oax-slider-price",price_slider_vMin:0,price_slider_vMax:50,price_slider_range:!0,price_slider_discreteStep:5,augmentKids:function(k){k.price=this.createSlider("price")}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_literature");(function(){alp.declare("oax.x.SortheadLiterature",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();
"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_avalanche");(function(){alp.declare("oax.x.FclsetAvalanche",oax.x.Fclset,null,{defaultSet:{request:"avalanches"}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_avalanche");(function(){alp.declare("oax.x.FilterAvalanche",oax.x.Filter,null,{augmentKids:function(k){}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_avalanche");(function(){alp.declare("oax.x.SortheadAvalanche",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();
"undefined"!==typeof dojo&&dojo.provide("alp.util.math.angle_within");(function(){var k=alp.sub("alp.util.math",null,!0),h=2*Math.PI;k.angleWithin=function(g,f,e,d){d=d?h:360;g%=d;f%=d;for(e%=d;e<g;)e+=d;for(;f<g;)f+=d;return f<e+1E-10}})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.i.i_avalanche");
(function(){function k(){return"__ret"in k?k.__ret:k.__ret=/\bproto\b.*?\bavalsimuldetail\b/.test(location.search)}function h(a){var b=alp.dfrd("AMI_IAV_fetch_svg_dfrd",{then:1});alp.m(c.api_bodypart({path:c.api_bodypart["PATH_AVALANCHE_SVG_"+a.toUpperCase()],project:this.proj}),m,function(c){var d=c&&"ok"===alp.oGet(c,"answer.status")&&c.answer.html;d?(d=d.replace(/<%--[\s\S]+--%>/g,"").replace("${pos}",""),"one"===a.toLowerCase()&&(d=d.replace(/(oax_avalanche_risk_)/g,"$1${i}").replace(/(oax_middle_text.*?>)/,
"$1${i}")),b.done(d)):console.error("i_avalanche: could not retrieve SVG",c)});return b}function g(a){var b=alp.dfrd("_xAMI_IAV_async_prepare_toshow_dfrd",{then:1});alp.m(a._i_fetch_svg_both_dfrd(),m,function(c){(c.one||null).substring.call.a;(c.two||null).substring.call.a;var d=a.m,e=a[u]||{},g=a[u]=alp.m(d.toshow,l)||{};e=alp.oDelta(g,e);b.done({map:alp.m(d.map,l),sort2svgtmpl:c,toshow:g,delta:e,id2svg:function(a){return f(c,g[a])}})});return b}function f(a,b){var c=b.dangerOverview;b=c.allday;
var d=c.morning,e=c.afternoon,f=c.low;c=c.high;if(f&&c&&"string"===typeof f&&"string"===typeof c)return alp.tmpl(a.two,{low:f,high:c});f=b;if("string"!==typeof f||"?"===f)f=alp.filter([b,d,e,alp.opt(b,"low"),alp.opt(b,"high"),alp.opt(d,"low"),alp.opt(d,"high"),alp.opt(e,"low"),alp.opt(e,"high")],'"string" === typeof v  &&  v').sort(function(a,b){return"?"===a?-1:"?"===b?1:a<b?-1:1}).slice(-1)[0];(f||null).substring.call.a;return alp.tmpl(a.one,{i:f})}function e(a){return{id:"123000"+a,latlng:d(a),
title:"xxx simul Region #"+a,dangerOverview:b(a)}}function d(a){return a in d?d[a]:d[a]={lat:45.54289364344342+2.261024051717513*Math.random(),lng:6.495593955078107+6.8499755859375*Math.random()}}function b(a){function c(){function a(){return"?01234".charAt(Math.max(0,Math.min(5,Math.round(-.5+6*Math.random()))))}return.4>Math.random()?a():{low:a(),high:a(),limit:100*(7+Math.round(15*Math.random()))}}if(a in b)return b[a];if(.3>Math.random())return a=c(),a.low&&"string"===typeof a.low&&a.high&&"string"===
typeof a.high?a:{allday:a};var d={allday:c(),morning:c(),afternoon:c()};return b[a]=d}var c=alp.data,a=alp.util.math,m=["to","then"],l=["_get_no_clone","get"],r=alp.i18n.fetch("alp.all");alp.sub("alp.maps.i",0,1).IAvalanche={i_tri_one_max_wh:[50,50],i_tri_two_max_wh:[93,50],i_tri_icon_class:"oax-avalanche-svg-cont",i_show_geometry_on_mouseover:!0,markerClickEvt:alp.memM("markerClickEvt",'alp.event("AMI_IAV_markerClickEvt",{then:1})'),markerMouseoverEvt:alp.memM("markerMouseoverEvt",'alp.event("AMI_IAV_markerMouseoverEvt",{then:1})'),
markerMouseoutEvt:alp.memM("markerMouseoutEvt",'alp.event("AMI_IAV_markerMouseoutEvt",{then:1})'),_i_fetch_all:alp.memM("_i_fetch_all",function(){function a(a){alp.m(r,m,function(d){var e=a.regions;(e||null).splice.call.a;b.done(alp.map(e,function(a){a=a.latlng?a:alp.oCreateMix(a,{latlng:alp.opt(c.ooi_geometry(a),["lat","lng"])});if(!a.title){var b=a.name,e=alp.oGet(a,"dangerOverview.date");(e=e&&alp.str2date(e))&&(b=d.weekdays.split(",")[e.getDay()%7]+", "+alp.date2str(e,"{DD}.{MM}.{YYYY}")+" \u2022 "+
b);a.title=b}return a}))})}var b=alp.dfrd("AMI_IAV_fetch_all",{then:1});k()?b.done(alp.map(alp.loop2arr(0,100),e)):alp.m(c.api_avalanche_all_regions({project:this.proj}),m,a);return b}),_i_toshow:function(){var b=this.m,c=alp.m(b.mapExtent,l);b=alp.m(b.all,l);var d={};if(c&&b&&b.length){var e=c.s,f=c.w,g=c.n;c=c.e;for(var h=b.length;h--;){var k=b[h],m=k.latlng,n=m.lng;a.angleWithin(e,m.lat,g)&&a.angleWithin(f,n,c)&&(d[k.id]=k)}}return d},_i_fetch_svg_one_dfrd:alp.memM("_i_fetch_svg_one_dfrd",alp.bindF(h,
0,"one")),_i_fetch_svg_two_dfrd:alp.memM("_i_fetch_svg_two_dfrd",alp.bindF(h,0,"two")),_i_fetch_svg_both_dfrd:alp.memM("_i_fetch_svg_both_dfrd",function(){var a=alp.dfrd("AMI:IAV:fetch_svg_both",{then:1});alp.m(alp.gatherDfrd([this._i_fetch_svg_one_dfrd(),this._i_fetch_svg_two_dfrd()],{then:1}),m,function(b){var c=b[0][0];b=b[1][0];b=alp.cE("div",null,null,{innerHTML:b});var d=alp.gEBTN("svg",b)[0];alp.sA(d,"class",alp.gA(d,"class")+" oax_triangle_height_left");d=alp.gEBCN("oax_avalanche_risk_",b);
if(d.length){var e=d[0];alp.sA(e,"class",alp.gA(e,"class").replace("oax_avalanche_risk_","oax_avalanche_risk_${high}"));d=d[1];alp.sA(d,"class",alp.gA(d,"class").replace("oax_avalanche_risk_","oax_avalanche_risk_${low}"))}alp.orphan(alp.gEBCN("oax_middle_text",b));d=alp.gEBTN("text",b);alp.setText(d[0],"${high}");alp.setText(d[1],"${low}");b=b.innerHTML;a.done({one:c,two:b})});return a}),_i_update_view:function(){function a(a){function b(a){d[v]===f&&(a=alp.arrChain(a.encPolyline),d._show_region_geom(f,
e,a))}var f=a.id;a=alp.oGet(a,"category.id");f&&a&&(d[v]=f,alp.m(c.api_region_geometry({areaid:f}),m,b))}function b(a){if(a=a.id)e[a]&&d._hide_region_geom(a,e),d[v]=null}var d=this,e=d[q]||(d[q]={});alp.m(g(d),m,function(c){var e=c.delta,f=e.add;e=e.del;var g=d[n]||(d[n]={});alp.forEach(e,alp.bindF("_remove_one",d,c,g));alp.forEach(f,alp.bindF("_add_one",d,c,g));d.i_show_geometry_on_mouseover&&f.length&&!d[p]&&(d[p]=!0,alp.m(d.markerMouseoverEvt(),m,a),alp.m(d.markerMouseoutEvt(),m,b))})},_i_trigger_event:function(a,
b,c){if("markerClickEvt"!==a||!alp.oEqual(c.dangerOverview,{allday:"?"})){a=this[a]();var d=alp.oCreateMix(c,{map:b,frontendtype:"avalanche"});b=alp.mix({},d,{load:function(){alp.bindF.apply(alp,arguments)({avalanche:[d]},[d])}});alp.Later?alp.now.trigger(a,b):alp.now("triggerSoon",a,b)}}};var n="_i_id2m",q="_i_id2poly",p="_i_mov_geom_listen",v="_i_mov_geom_id",u="_pts"})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.x.avalanche_google");
(function(){function k(e){e=e.m;var d=e.map.get(),b;if(d&&(b=d.getBounds())){var c=d.getZoom();var a=h(d.getCenter());var f=h(b.getSouthWest());var g=h(b.getNorthEast());var k=f.lat;var n=f.lng;var q=g.lat;var p=g.lng}e.mapExtent.set(alp.and([c,a&&a.lat,a&&a.lng],"alp.isFiniteNumber(v)")?{z:c,c:a,sw:f,ne:g,s:k,w:n,n:q,e:p}:null)}function h(e){return{lat:e.lat(),lng:e.lng()}}var g=alp._gmap2_3;alp.declare("alp.maps.x.AvalancheGoogle",alp.x.AbstractController,null,alp.maps.i.IAvalanche,{gm:null,proj:null,
getMap:function(){return this.m.map.get()},setMap:function(e){this.m.map.setNow(e)},augmentModel:function(e){e.map=new alp.State;e.mapExtent=new alp.State;e.all=new alp.State;e.toshow=new alp.State;this._i_fetch_all().then(alp.bindF("set",e.all))},connectModel2Model:function(e,d,b,c){function a(){b.toshow.set(e._i_toshow())}d.push(b.mapExtent.change_cb_init(a));d.push(b.all.change_cb(a))},connectModel2View:function(e,d,b,c){d.push(b.toshow.change_cb_init("_i_update_view",e))},connectView2Model:function(e,
d,b,c){d.push(b.map.change_cb_init(function(){function a(){alp.forEach(h,"this.removeListener(v)",d)}alp.m(e,f);e[f]=null;var c=b.map.get(),d=e.gm.event;if(c){var g=alp.nowF(alp.bindF(k,null,e)),h=[d.addListener(c,"bounds_changed",g)];e[f]=a;g()}}))},_remove_one:function(e,d,b){d[b].setMap()},_add_one:function(e,d,b){function c(){var a=[p.getDivMouse(),p.getDiv()];return alp.and(a)&&a}function a(a){var b;alp.aEL(a,"mousedown",function(a){b=a||window.event});alp.forEach(["click","mouseover","mouseout"],
function(c){var d="marker"+alp.sCapitalize(c)+"Evt";alp.aEL(a,c,function(a){a||(a=window.event);if("click"!==c||!b||b.screenX===a.screenX&&b.screenY===a.screenY)alp.stopEvent(a),f._i_trigger_event(d,p.getMap(),n)},!0)})}var f=this;if(!(b in d)){var h=e.toshow,k=e.id2svg(b),n=h[b];h=f.i_tri_one_max_wh;var q=alp.map(h,">>1"),p=d[b]=new g.CustomMarker({position:new f.gm.LatLng(n.latlng.lat,n.latlng.lng),prop:{"class":f.i_tri_icon_class},attr:{title:n.title||n.name},width:h[0],height:h[1],anchor_x:q[0],
anchor_y:q[1],html:k});alp.subDfrd(c).then(a)}d[b].setMap(e.map)},_show_region_geom:function(e,d,b){var c=d[e],a=this.m.map.get();c?c.setMap(a):d[e]=g.region_polygon(a,b,{nofill:!0})},_hide_region_geom:function(e,d){d[e].setMap()}});var f="_map_zc_disconnect"})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.layer.avalanche_wrapper_layer");
(function(){function k(g,f){"markerClick"===g&&this.openDetailOnClick?(g=f.id,(g||null).substring.call.a,this.interceptUserSelect?this.interceptUserSelect(g):this._detailOpenSt.setNow(g)):this.triggerEvent(g,f)}var h=alp.sub("alp._gmap2_3",null,!0);alp.declare("alp._gmap2_3.AvalancheWrapperLayer",h.AbstractIWMarkerLayer,function(){function g(){var d=alp.oKeys(f._x.m.toshow.get());f.triggerEvent("visibleIdsChange",d,e);f.triggerEvent("sortedVisibleIdsChange",d,e);e=d}var f=this;f._detailOpenSt=new alp.StringState({init_value:f.init_areaid||
null});f.addEvent("allCatSelChange");f.addEvent("sortedVisibleIdsChange");alp.gmap3(function(d){f._x=new alp.maps.x.AvalancheGoogle(alp.mix(alp.opt(f,["proj"]),{initNow:!0,gm:d}));f._x.markerClickEvt().thenSoon(alp.bindF(k,f,"markerClick"));f._x.markerMouseoverEvt().thenSoon(alp.bindF(k,f,"markerMouseover"));f._x.markerMouseoutEvt().thenSoon(alp.bindF(k,f,"markerMouseout"));alp.oSet(f,"_alp.map",f._x.m.map);f._x.m.toshow.change_cb_init(alp.ratelimitF(357,g))});f._detailOpenSt.change_cb_init(function(){var d=
f._detailOpenSt.get(),b=f._last_aval_detail;b&&(b.m.open.setNow(!1),b.disconnect(),f._last_aval_detail=null);if(d){var c=f._last_aval_detail=new alp.x.AvalancheDetail({initNow:!0,ooiid:null,proj:f.proj,key:f.key||"",initRegionId:d,interceptOpenCloseClick:f.interceptUserSelect&&function(){f.interceptUserSelect()}});c.m.open.setNow(!0);c.m.open.change_cb(function(){f._last_aval_detail!==c||c.m.open.get()||f._detailOpenSt.set()})}});var e},alp.util.InterfaceWithInit,{proj:null,openDetailOnClick:!0,onAllCatSelChange:null,
onSortedVisibleIdsChange:null,interceptUserSelect:null,init_areaid:null,getMap:function(){return this._x.getMap()},setMap:function(g){return this._x.setMap(g)},getCatTree:function(){},setAllCatsSelected:function(){},setCatSelected:function(){},getFilter:function(){},setFilter:function(){},showTour:function(g){},setDataPointUnmergeable:function(g,f){},setSingleMarkerOptions:function(g,f){},setDataPointList:function(g){console.error("AG:AWL:setDataPointList not supported.")}})})();
"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_event");(function(){alp.declare("oax.x.FclsetEvent",oax.x.Fclset,null,{defaultSet:{request:"events"},from_filter_noRegistrationRequired_is:oax.x.checkM("nr"),from_filter_badweathertips_is:oax.x.tagM("bw"),from_filter_suitableforfamilies_is:oax.x.tagM("su"),from_filter_datefromto_from:oax.x.dateM("period_s"),from_filter_datefromto_to:oax.x.dateM("period_e")})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_event");
(function(){alp.declare("oax.x.FilterEvent",oax.x.Filter,null,{augmentKids:function(k){k.datefromto=this.createDateFromTo("oax-event-datefromto-wrapper",{setDefaultDate:!0,defaultDateFrom:new Date,defaultDateTo:null})}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_event");(function(){alp.declare("oax.x.SortheadEvent",alp.x.Sorthead,null,{cont:null,selected_initFromDom:!1,selected_init_value:"date",key2ascendant_init:{date:!0,title:!0}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.fclset_teamactivity");
(function(){alp.declare("oax.x.FclsetTeamactivity",oax.x.Fclset,null,{defaultSet:{request:"teamactivities"},from_filter_duration_low:oax.x.sliderLowM("duration_s"),from_filter_duration_high:oax.x.sliderHighM("duration_e"),from_filter_datefromto_from:oax.x.dateM("period_s"),from_filter_datefromto_to:oax.x.dateM("period_e")})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.filter_teamactivity");
(function(){alp.declare("oax.x.FilterTeamactivity",oax.x.Filter,null,{slider_duration:"oax-slider-duration",duration_slider_discreteValues:[.5,1,2,3,4,5,6,7,8],duration_slider_range:!0,augmentKids:function(k){k.duration=this.createSlider("duration");k.datefromto=this.createDateFromTo("oax-teamactivity-datefromto-wrapper",{setDefaultDate:!0,defaultDateFrom:new Date,defaultDateTo:null})}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.sorthead_teamactivity");
(function(){alp.declare("oax.x.SortheadTeamactivity",alp.x.Sorthead,null,{cont:null,key2ascendant_init:{title:!0}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.flexview");
alp.gmap3(function(k){function h(a){var b=a?alp.arr2o(a,alp.f('"string"===typeof v  ?  v  :  v.id'),alp.f("1")):null;alp.forIn(this.kx,function(a){a instanceof oax.x.Gallery&&alp.m(a,"setAllIdsSet",b)});this.kx.clusterLayer.setDataPointList(a)}function g(a,b){return function(c,d){function e(c){alp.stopEvent(c||window.event);a.kx.condition.editCondition(b)}if("condition"===a.frontendtype&&a.frontendtype===d.frontendtype&&(d=alp.oGet(d,"meta.authorFull.id"))&&oax.community_layout.login_indicator()&&
oax.community_layout.get_user_id()===d){d=alp.opt(alp.nodify(a.i18nMsgConditionEditLink,a.flexviewNode),"innerHTML")||"i18nMsgConditionEditLink";var f=alp.nodify(a.conditionEditLinkIwContainerClass,c);f?c=alp.cE("div",f,{"class":a.conditionEditLinkIwClass},{innerHTML:d}):(alp.cE("div",c,{"class":"oax_clear"}),c=alp.cE("div",c,{"class":a.conditionEditLinkIwClass},{innerHTML:d}));alp.aEL(c,"click",e,!0)}}}function f(a){if(a){var b=a.geometry,c=b.location;b=b.viewport;(a=a.isRegion&&alp.oGet(this,"_cfg.where.area_filtering")&&
a&&b&&a.alpstein_id||"")&&this.kx.fclset?this.kx.fclset.setArea(a):(d(this,{maxZoom:oax.PLACES_MAX_ZOOM,viewport:b,location:c}),this.kx.fclset.setArea())}}function e(b){function c(b,c){var d=e[S];d||(d=e[S]=new alp.x.Waitbox({targetInit:alp.nodify(oax.FLEXVIEW_MAP_CONT,e.flexviewNode),background:{w:109,h:73}}));0<c.length&&(d&&d.startWait(),b=a(e),e.fitOOI(c,{padding:b}).then(function(){d&&d.stopWait()}))}function d(a,b){if(0===b.length)e.kx.where.clearSearch();else if(0===R[a])e.kx.where.clearSearch();
else if(!R[a]&&e.kx.clusterLayer.hasEvent("visibleIdsUpdate"))var c=e.kx.clusterLayer.listen("visibleIdsUpdate",function(b){R[a]=b.length;0===b.length&&e.kx.where.clearSearch();e.kx.clusterLayer.drop(c)})}var e=this,f=b&&(b.qExt||b.q),g=e.kx.where.m.placeSt.get();b&&!g?e.kx.where._callback=c:f&&b.doNotShow&&(e.kx.where._callback=d);e.kx.fclset.setFreeSearch(f)}function d(a,c){a.mapCB(function(d){var e=b(a,c),f=e.center,g=e.zoom;B.setView(d,e.center,g);a._isMapVis.get()||(a[O]=f);setTimeout(function(){B.setView(d,
f,g)})})}function b(b,c){var d=c.maxZoom||oax.PLACES_MAX_ZOOM,e=c.viewport;c=c.location;var f=a(b);b=b._mapDiv;e?(d=I.bounds2zoomcenter(e,b,{maxZoom:d,padding:f}),d.center=E(k,d.center)):d=B.zoomcenter({center:c,zoom:d,wh:b,padding:f});return d}function c(a,b){this._gmDfrd().then(function(c){var d=b.geo_xy;a&&d&&B.setView(a,new c.LatLng(d.y,d.x),12)})}function a(a){var b=alp.nodify(a.detailpane,a.flexviewNode);b=b&&alp.gBCR(b);a=a.flexviewNode&&alp.gBCR(a.flexviewNode);a=b&&a&&b.width+b.left-a.left;
return{left:0<a?a+"px":.1,right:.1,top:.1,bottom:.1}}function m(a){var b=this.map,c=b.getCenter(),d=b.getZoom();oax.iwOpenLoadingMessage(b,a.latlng);a.load(l,this,b,a.latlng,{iwCloseCallback:function(a){a.mapMoved||(b.setZoom(d),b.panTo(c))}})}function l(a,b,c,d,e){var f=this,h=(e||alp.oValues(d))[0],k=oa.flexview_getSnippetCfg(f,oax.MODE_MAP_IW,h.frontendtype,{ooiid:h.id});"condition"!==f.frontendtype||f.frontendtype!==h.frontendtype||c.iwNodePostProcess||(c=alp.oCreateMix(c,{iwNodePostProcess:g(f,
h.id)}));c=alp.oCreateMix(c,{iwClickCallback:function(){f.iwClickEvt().triggerSoon(h)}});return oax.iwOpen(a,b,c,k,d,e)}function r(a,b,c){var d={},e=a.i_open_inpage_class;c&&(d[e]=!1,d[e+"-"+c]=!1);b&&(d[e]=!0,d[e+"-"+b]=!0);alp.setClass(a.flexviewNode,d)}function n(a){var b=a[S],c=a.m.loadingClusterOrSettingFilter.get(),d=a.kx.clusterLayer._alp.mapSt.get();c&&d?(c=alp.nodify(oax.FLEXVIEW_MAP_CONT,a.flexviewNode),b||(b=a[S]=new alp.x.Waitbox({targetInit:c,background:{w:109,h:73}})),b.startWait()):
b&&(d?alp.asyncF(678,"stopWait",b)():b.stopWait())}function q(a){var b=alp.m(a.map,"getDiv");a=[b,a.galleryNode,a.listNode];for(var c,d,e=a.length;e--;){var f=a[e],g=f&&alp.gBCR(f);if(g&&0<g.width&&0<g.height){c=f;d=g;break}}d&&(a=16+d.bottom-document.documentElement.clientHeight,d=52-d.top,e=0<a,f=0<d,g=alp.body(),(e||f)&&alp.dom.scroll(g,{relativeTop:c===b?e&&f?(d+a)/2:e?a:-d:e&&f?d:e?Math.min(-d,a):-d,duration_ms:250}))}function p(a){if(!a[T]){var b=a[T]=oa.cfg.cfg_flexview.fill_default_and_fix_backward_compatibility(a),
c=alp.oGet(a.initFilterNoGui||{},"area");a.whereClearRegionNode?c&&alp.oSet(b,"where.area_filtering",c):alp.oSet(b,"where.area_filtering",!1)}return a[T]}function v(a){oax.api.maps(function(b,c){function d(){a.kx.mlp&&a.kx.mlp.m.isOpen.set(!1);a.kx.mcp&&a.kx.mcp.m.isOpen.set(!1)}function e(b){a.flexOpener.setFvFullscreen(a.flexOpenerPage,!!b)}function f(b,c,d){var e=a.map,f=e&&e.getMapTypeId();c=!c.get();d=d.get();b.get()?f&&(b=c?f.replace(/winter$/,"summer"):f.replace(/summer$/,"winter"),c=a._prev_mapOverlays,
f!==b||c!==d)&&(a._prev_mapOverlays=d,(a.kx.mlp||e).setMapTypeId(b,d||"")):f&&(a.kx.mlp||e).setMapTypeId(f,d||"")}function g(b){b.listen("markerClick",m,a)}var h=a[Q]||(a[Q]=oa.cfg.cfg_flexview.fill_default_and_fix_backward_compatibility(a,c)),k=a._mapDiv;h=h.maplayer.basemap;var l=h.layer,n=h.zoom,p=B.xy2latlng(h.center),r=h.bbox&&("string"!==typeof h.bbox?h.bbox:alp.map(h.bbox.split(","),"parseFloat(v)"));r&&4===r.length&&(p=I.bounds2zoomcenter(r,k),n=p.zoom,p=E(c,p.center));if(r=a._fitDataBounds_map_init_zc)n=
r.zoom,p=r.center;p={zoom:alp.isFiniteNumber(n)?n:12,center:p||{x:11,y:47}};n=h.init||"oa_map";l=alp.oCreateMix(h||{},{center:p.center instanceof c.LatLng?p.center:B.xy2latlng(p.center),zoom:p.zoom,mapTypeId:n,mapTypeControlOptions:{mapTypeIds:l},streetViewControl:!1});n=alp.sub("oa",l,!0);null==n.loadTilesLater&&(n.loadTilesLater=!0);if(n=oa.cfg.ovmtids_filter(alp.sub("oa.overlayMapTypeIds",l)||alp.sub("alp.overlayMapTypeIds",l),"flexview"))a._overlayMapTypeIds=n,delete l.oa.overlayMapTypeIds;a.map=
new b.Map(k,l);a._emptyButton=oax.x.emptybutton({position:c.ControlPosition.TOP_RIGHT},a.map);a.hasFullscreenToggle?(a.initFullscreen=J.flexview_init_from_url_hash()||!1,a.fullscreen=new alp._gmap2_3.x.Fullscreen({map:a.map,initNow:!0,instruction_alert:!1,init_value:a.initFullscreen,interceptSetFullscreen:e}),a.fullscreen.m.isFull.change_cb(d)):alp.setClass(a.flexviewNode,oax.NO_FULLSCREEN,!0);b=a.hasFullscreenToggle?a.fullscreen.m.isFull:new alp.BoolState({init_value:!0});k=a.hasFullscreenToggle?
a.fullscreen.m.isMapVis:new alp.BoolState({init_value:!0});l=a.m.isDpVis;a._isMapVis=k;a._layout.install_isFull_isMapVis_stVis3d_isDpVis(b,k,a.map.stVis3d,l);k.change_cb_init(u,null,a);b.change_cb_init(t,null,a);alp.setClass(a.flexviewNode,oax.READY,!0);a.kx.what&&(b=a.kx.what&&a.kx.filter&&a.kx.what.m.selected_st_valid||a.kx.what.m.selected_st,b||null.bug,k=a.kx.what.m.isWinter_st,l=alp.asyncF(0,f,null,b,k,a.kx.what.m.mapOverlays_st),b.change_cb(l),h.init&&k.get()==k.getPrevious()||l());B.event("addListener")(a.map,
"maptypeid_changed",alp.nowF(function(){function b(a,b){b=b===c;d.m.mapoverlay.set_flex(alp.arr2o(a,alp.f(),alp.f(b)))}var c=a.map.getMapTypeId(),d=a.kx.mlp,e=a._overlayMapTypeIds;c&&d&&e&&alp.forIn(e,b)}));a.mcpToggleNode&&(a._mcpContNode=a.mcpContNode,a._mcpToggleNode=a.mcpToggleNode,a._mcpTogglePlaceholderNode="string"===typeof a.mcpTogglePlaceholder?alp.nodify(a.mcpTogglePlaceholder,a.flexviewNode):a.mcpTogglePlaceholder,a.mcpCatList&&a._mcpToggleNode?(h=a.mcpCatList,h="string"===typeof h?h.split(","):
h,h=alp.filter(h,'!=="'+a.frontendtype+'"'),a._mcpCfg={initNow:!0,proj:a.proj,mpContNode:a._mcpContNode,mcpCatList:h,mcpInitList:a.mcpInitList,mcpInitCheckedIds:a.mcpInitCheckedIds,onNewTreeEvt:P(a,a.map,g)},a._mcpCfg.toggleNode=a._mcpToggleNode,a._mcp=new oa.x.MapContentPanel(a._mcpCfg),a._mcp.setMap(a.map),alp.setClass(a._mcpToggleNode,oax.NO_DISPLAY,!1),a._mcpTogglePlaceholderNode&&alp.setClass(a._mcpTogglePlaceholderNode,oax.NO_DISPLAY,!0)):a._mcpToggleNode&&alp.setClass(a._mcpToggleNode,oax.NO_DISPLAY,
!0));J.mapbtn.manageWrapper(a.mapbtnsWrapper,null,a.mapbtnsOpenClass,[a.kx.mlp,a._mcp],a.mpContNode,a.m.isMapPanelOpenSt);J.streetview(a.map,a.flexviewNode);alp.forIn(a.kx,function(b){alp.m(b,"setMap",a.map)});a._gmDfrd().triggerSoon(c);a.mapDfrd().triggerSoon(a.map);a.initScrollToMap&&alp.asyncF(2345,q)(a);h={flexOpener:a.flexOpener,flexOpenerPage:a.flexOpenerPage,map:a.map,gm:c};H.map_zoom_center(h);H.map_maptypeid(h);alp.m(a.poiSt,"change_cb_init",function(){function b(b,e){function f(b){var d=
G.ooi_geometry(b);b=alp.mix(L.passive_map_poi_icon_cfg(b,{gm:!0}),{map:a.map,position:new c.LatLng(d[1],d[0]),attr:{title:b.title||b.category.name||""},style:{cursor:null}});return new B.CustomMarker(b)}d===w&&(alp.forEach(v||[],".setMap()"),v=alp.map(alp.filter(e||[],""),f))}var d=w=a.poiSt.get()||"";d?(new G.OOIs({proj:a.proj,idlist:d})).load(b):b()});var w,v})}function u(a){var b=a._isMapVis.get(),c;if(b&&!a[O]||!b)a[O]=a.map.getCenter();else if(c=b&&a[O])a.map.setCenter(c),setTimeout(function(){a.map.setCenter(c)})}
function t(a){var b=a.hasFullscreenToggle?a.fullscreen.m.isFull.get():!0;a.m.overlayName.set(b?"map":null)}function w(a){function b(b){c.get()===d&&a.m.areaGeom.set({areaid:d,geom:b})}var c=a.kx.fclset.m.area,d=c.get()||null;a.m.areaGeom.set(null);d&&G.api_region_geometry({areaid:d}).thenSoon(b)}function x(a,b,c){a=alp.oGet(b.get()||{},"catid")||null;c.m.difficulty_single_catid.set(a)}function y(a){function b(b){a._gmDfrd().then(function(c){c=a.m.areaGeom.get();if(e===(c&&c.areaid)){var g=f[e];g?
g.setMap(b):g=f[e]=L.region_polygon(b,alp.arrChain(c.geom.encPolyline),{nofill:!0});c=g._alp_wens||B.bounds_fromPath(g);d(a,{maxZoom:oax.PLACES_MAX_ZOOM,viewport:c});a[N]=e}})}var c=a.m.areaGeom.get(),e=c&&c.areaid;c=a[N];var f=a[X]||(a[X]={});e!==c&&(c&&f[c].setMap(null),e?a.mapCB(b):a[N]=null)}function z(a,b){a.kx.ovmtcoll=J.createOvmtcoll({oaxcfg:p(a),map:b,mlp:a.kx.mlp})}function A(a){function b(b){function g(a,c){var f=a.eventId,g=d[f],h=e[a.eventId];(g&&h).toPrecision.call.a;f===g.id||null.bug;
a=alp.oCreateMix(g,alp.oCreateMix(a,{id:a.eventId+"."+c,originalIndex:h}));h=alp.str2date(a.date);f=a.timeFrom&&alp.str2date(a.timeFrom);g=a.timeTo&&alp.str2date(a.timeTo);c=0==alp.getDayDate(f)-alp.getDayDate(g);var k=(new Date).getYear();k=h.getYear()===k&&(!f||f.getYear()===k)&&(!g||g.getYear()===k);var l=b[k?"date2str_D_M":"date2str_D_M_Y"],m=b.date2str_hh_mm,n=b.date2str_hh_mm_verbose;alp.forEach([l,m,n],"(v||null).substring.call.a");var p=!(f&&g&&0===f.getHours()&&0===f.getMinutes()&&23===g.getHours()&&
59===g.getMinutes())||"";h=alp.date2str(h,l);k=f&&alp.date2str(f,l);l=g&&alp.date2str(g,l);var q=p&&f&&alp.date2str(f,m);p&&g&&alp.date2str(g,m);m=p&&f&&alp.date2str(f,n);n=p&&g&&alp.date2str(g,n);p=b.weekdays.split(",");f=c?p[f.getDay()]:p[f.getDay()]+"&ndash;"+p[g.getDay()];a.eventTextDay=f||"";a.eventTextDate=(c?k||h:k&&l&&k!==l?k+"-"+l:h)||"";a.eventTextTime=(c?q&&n?q+" &ndash; "+n:"":m&&n?k+", "+m+" &ndash; "+l+", "+n:"")||"";return a}function h(a,b){var c=a.date;a=a.originalIndex;var d=b.date;
b=b.originalIndex;(c||null).substring.call.a;a.toPrecision.call.a;(d||null).substring.call.a;b.toPrecision.call.a;return c<d?-1:c>d?1:a-b}var k=c.kx.clusterLayer.getFilter(),l=alp.map(a,".id").join(",");G.api_event_datelist({eventidlist:l,datefrom:k&&k.period_s||"",dateto:k&&k.period_e||""}).thenSoon(function(a){a=alp.map(a.eventDate,g).sort(h);f.done(a)})}var c=this,d=alp.arr2o(a),e=alp.arr2o(a,"id",function(a,b){return b}),f=alp.dfrd("FV:event:magazine:modifier",{then:1});a.length?D.then(b):f.done([]);
return f}function C(a,b,c){b=a[K]||(a[K]=alp.asyncSeq());var d=a[U]||(a[U]=[]),e=a.markerStyleSt.get()||{};alp.oDelta(e,a[V]||{});var f=c.clusterLayer;a[V]=e;alp.forIn(e,'!(("s"+w) in this) && (this.push( w ),(this[ "s"+w ] = 1))',d);a[U]=d;b.next(function(a){function b(b){for(var d=b.length;d--;){var g=c[d];if(b[d]){var h=e[g],k=h.icon,l=h.options;f.setDataPointUnmergeable(g,!!h.always);k?f.setDataPointIcon(g,k):f.unsetDataPointIcon(g);f.setSingleMarkerOptions(g,l||null)}}a()}var c=d.slice();0<c.length&&
f.getDataPointArray(c).then(b)})}function E(a,b){return new a.LatLng(b.lat,b.lng)}var G=alp.data,B=alp._gmap2_3,I=alp.maps,L=oa.util,J=oax.util,P=J.mcp.delayedClusterLayerSetupF,H=J.url_hash_write_only,F=oa.ga_track_anonymous,D=alp.i18n.fetch("alp.all");alp.declare("oax.x.FlexView",alp.x.AbstractController,function(){alp.setClass(this.flexviewNode,"oax_"+this.frontendtype,!0);/(?:#|&)istm=1/.test(location.hash)&&(this.initScrollToMap=!0);this._mapDiv="string"===typeof this.mapNode?alp.f(this.mapNode)(this.flexviewNode):
this.mapNode;if(this.fitDataBounds){var a=this.m.metadata,c=this.m.dataPointListSt.get(),d=(a=a.get())&&a.bbox;!a||c&&a.n!==c.length||!d||(c=b(this,{viewport:d}))&&(this._fitDataBounds_map_init_zc=c)}v(this)},oa.i.IActionOpenType,{proj:null,key:null,flexviewNode:null,modeSet:null,frontendtype:"tour",mapNode:'alp.gEBCN("oax-map-canvas",v)[0]',mapIwFromSnippetTmpl:"same_as_gallery",withMapOverlay:!0,snippetClassArr:["oax-snippet-flexview"],actionOpenType:oax.ACTION_OPEN_IN_PAGE,flexOpener:null,flexOpenerPage:null,
openOOIUrl:null,withUrlHash:!0,hasFullscreenToggle:!0,outsideChangedResetCont:null,mpContNode:null,mlpContNode:null,mlpToggleNode:null,mcpContNode:null,mcpToggleNode:null,mcpTogglePlaceholder:"oax-toggle-placeholder",mcpCatList:"",mcpInitList:"",mcpInitCheckedIds:"",initFullscreen:!1,conditionContNode:null,conditionCreateNode:null,conditionEditContNode:null,conditionEditLinkIwContainerClass:"oax-condition-edit-link-iw-cont",conditionEditLinkIwClass:"oax-condition-edit-link-iw",i18nMsgConditionEditLink:"oax-condition-i18n-msg-edit-link",
mapbtnsWrapper:"oax-mapbtns-wrapper",mapbtnsOpenClass:"oax-mapbtns-open",whatNode:null,whatType:"simple",whereNode:null,whereType:"outdooractive",whereClearRegionNode:null,galleryNode:null,galleryType:"standard",listNode:null,listType:"standard",mapListNode:null,mapListType:"standard",magazineNode:null,magazineType:"standard",filterNode:null,filterSelectorNode:null,filterType:null,sortheadNode:null,sortheadType:null,fclsetType:null,detailpane:"oax_detailpane",initFilterNoGui:null,isMapPanelOpenSt:null,
dataPointListSt:null,markerStyleSt:null,fitDataBounds:!1,initScrollToMap:!1,poiSt:null,maplayer:null,maplayerpanel:null,what:null,where:null,filter:null,sort:null,layout:null,augmentModel:function(a){var b=this;!b.maplayer&&b.mapcontent&&alp.or(["basemap","mapoverlay","clusterlayer"],"that[v]",b.mapcontent)&&(b.maplayer=b.mapcontent,console.error('flexview: passing "basemap", "mapoverlay" or "clusterlayer" through "mapcontent" is deprecated: use instead "maplayer.basemap" etc.'));a.loadingDetailInPage=
new alp.State;a.isDpVis=new alp.BoolState({init_value:!0});a.isMapPanelOpenSt=b.isMapPanelOpenSt||new alp.BoolState;a.dataPointListSt=b.dataPointListSt||new alp.State;a.loadingCluster=new alp.BoolState({init_value:!a.dataPointListSt.get()});a.loadingClusterOrSettingFilter=new alp.BoolState({init_value:a.loadingCluster.get()});a.metadata=new alp.State;a.areaGeom=new alp.State;a.overlayName=new alp.State;alp.forEach("gallery iw list magazine mapList mapMarker".split(" "),function(a){b[a+"ClickEvt"]().then(function(c){b.ooiClickEvt().triggerSoon(c,
a)})});a.area=new alp.State;a.catid=new alp.State;a.areaCatid=new alp.State;a.area.change_cb("triggerSoon",b.areaChangeEvt());a.catid.change_cb("triggerSoon",b.catidChangeEvt());a.areaCatid.change_cb("triggerSoon",b.areaCatidChangeEvt())},augmentKids:function(a){function b(a){m.flexOpener.setFvAvalDt(m.flexOpenerPage,a)}function c(a,b,c){var e=d(a,b),f="event"===m.frontendtype&&c===oax.MODE_MAGAZINE?alp.bindF(A,m):null,g=b.prototype.galleryAll;g=f?!0:g;var h=new b(alp.oCreateMix(v,{topCont:a,snippetCfg:oa.flexview_getSnippetCfg(m,
c,m.frontendtype),snippetTmpl:e,loadingState:m.m.loadingClusterOrSettingFilter,datas_modifier:f,galleryAll:g,deactivateOutLinks:oa.ACTION_OPEN_NONE===m._actionOpenType_for_mode("list").split("|")[0]}));h.clickEvt().then(function(a){(a||null).substring.call.a;h.ooiLoader([a]).load(function(a){a=alp.orIn(a)[0];m[("listMap"===c?"mapList":c)+"ClickEvt"]().triggerSoon(a)})});return h}function d(a,b){a.childNodes.a;if((a=alp.gEBCN(b.prototype.snippetTmpl,a)[0])&&alp.sTrim(a.innerHTML||""))return a}function e(a){m.flexOpener.setFvWhat(m.flexOpenerPage,
a)}function f(b){function c(b,d,e){var f=m.m.metadata.get().inputMeta.q,g=a.where.m.qSt.get();g=g&&(g.qExt||g.q);0>e||f!==g?10>e&&(x=setTimeout(alp.bindF(c,null,b,d,e+1),222)):(x=null,e=(e=location.search.match(/[?&]fitQCount=(\d+)(?:&|$)/))&&parseInt(e[1]),b=b.slice(0,e||oax.WHERE_FIT_COUNT),d(g,b))}var d=m.kx.where._callback;m.kx.where._callback=null;x&&clearTimeout(x);"function"===typeof d&&c(b,d,-1)}function g(a,b){b=b?b.qExt||b.q:"";var c=alp.opt(a,"isRegion")&&alp.opt(a,"alpstein_id");m.flexOpener.setFvWhereQArea(m.flexOpenerPage,
a,b,c)}function h(a){m.flexOpener.setFvArea(m.flexOpenerPage,a||null)}function k(a){var b=alp.sub(a);if(!b)throw Error('oax.x.FlexView could not find constructor with name "'+a+'"');return b}this._layout=this.layout||new oax.FlexViewLayout({topNode:this.flexviewNode,flexOpener:this.flexOpener,flexOpenerPage:this.flexOpenerPage});var l=this.getFclsetTypeCamel();l=k("oax.x.Fclset"+l);var m=this,n=p(m),r=alp.oCreateMix(n.maplayer.clusterlayer||{},{proj:n.proj,defaultIW:!m.mapIwFromSnippetTmpl,lightweightApp:n.frontendtype,
onClusterLoadStart:function(){m.m.loadingCluster.setNow(!m.m.dataPointListSt.get())},onClusterLoadEnd:function(){m.m.loadingCluster.setNow(!1)},onClusterMetaChange:function(){m.m.metadata.setNow(a.clusterLayer.getMetaData())},type:n.frontendtype||"",initFilter:m.initFilterNoGui,base_url:(/\b(localhost)\b/.test(location.hostname)?oax.API_HOST+"alpportal/":oax.SERVER)+alp.i18n.language()+"/",initDataPointList:m.dataPointListSt.get(),fitDataBounds:m.fitDataBounds});m._cfg=n;var w=l&&alp.oGet(l,"prototype.defaultSet");
w&&alp.mix(alp.sub("cc_opts.model_opts",r,!0),w);if(w="avalanche"===this.frontendtype)r.interceptUserSelect=b,r.init_areaid=L.init_from_url_hash(oax.URL_HASH_AVALANCHE_OPEN);a.clusterLayer=new B[w?"AvalancheWrapperLayer":"FilterClusterLayer"](r);a.clusterLayer.listen("markerClick",function(a){a.load(function(a){a=alp.orIn(a)[0];m.mapMarkerClickEvt().triggerSoon(a)})});var v={proj:n.proj,frontendtype:n.frontendtype};m.galleryNode&&(a.gallery=c(m.galleryNode,oax.x.Gallery,oax.MODE_GALLERY));m.listNode&&
m.modeSet.list&&(a.list=c(m.listNode,oax.x.SnippetList,oax.MODE_LIST));m.mapListNode&&m.modeSet.listMap&&(a.mapList=c(m.mapListNode,oax.x.MapList,oax.MODE_LISTMAP));m.magazineNode&&m.modeSet.magazine&&(a.magazine=c(m.magazineNode,oax.x.Magazine,oax.MODE_MAGAZINE));if(m.whatNode){r=alp.oCreateMix(n.what||{},{topCont:m.whatNode,proj:n.proj,clusterDuck:a.clusterLayer,selectorsInstallArgs:m._layout.getSelectorsInstallArgs(),interceptUserSelect:e});if(w=L.init_from_url_hash(oax.URL_HASH_ACTIVITY,{fallback_url_search:!0}))r.selected_init=
w===oax.URL_HASH_ACTIVITY_ALL?"":w;"simple"===m.whatType?a.what=new oax.x.WhatSimpleCluster(r):"none"!==m.whatType&&console.error('FlexView does not know whatType "'+m.whatType+'" -> no what selector created')}else"none"===m.whatType&&alp.oGet(n,"what.selected_init")&&console.error('Contradiction: whatType=="none", and cfg.what.selected_init set! Please remove one of them.');if(m.whereNode){var t;r=oax.XXX_WHERE_ALPSTEIN?m._whereType||(m._whereType="outdooractive"===m.whereType?"alpstein":m.whereType):
m._whereType||(m._whereType="alpstein"===m.whereType?"outdooractive":m.whereType);if("simple"===r)a.where=new B.x.Geocoder({withautocomplete:!0,new_geocoder_autocomplete_mix:["alp.data.AutoCompleteGoogleGeocode"]},m.whereNode),a.where.init(),a.where.info.change_cb(function(){a.where.info.get()}),a.where.setMap=function(){};else if(r&&(t=oax.x["Where"+alp.sCamel(r)])){w=L.init_from_url_hash(oax.URL_HASH_WHERETEXT,{fallback_url_search:!0})||"";r=L.init_from_url_hash(oax.URL_HASH_QTEXT,{fallback_url_search:!0})||
"";var u=L.init_from_url_hash(oax.URL_HASH_AREA,{fallback_url_search:!0});w=w?{name:w&&w.split("\n")[0],isRegion:u&&u!=oax.URL_HASH_AREA_ALL,type:u&&u!=oax.URL_HASH_AREA_ALL?"region":"location"}:null;a.where=new t({node:m.whereNode,proj:m.proj,key:m.key,interceptUserSelect:g,whereInit:w,initText:r,frontendtype:m.frontendtype});m.mapCB(function(b){a.where.setMap(b)});a.clusterLayer.hasEvent("sortedIdsChange")&&a.clusterLayer.listen("sortedIdsChange",f)}else"none"!==r&&console.error('FlexView does not know whereType "'+
r+'" -> no where selector created')}var x;if(m.conditionContNode&&(a.condition=new B.ConditionEditLayer2({contNode:m.conditionContNode,createNode:m.conditionCreateNode,topContNode:m.flexviewNode,editCont:m.conditionEditContNode,proj:m.proj,login:{indicator:oax.community_layout.login_indicator,opener:oax.community_layout.open_login_dialog,opener_cfg:{dynamicRedirect:"true",type:oax.ADD_CONDITION_CONT}},placeInfoOtherClass:oax.IW_PLACE_OTHER,placeInfoOtherCont:alp.nodify(oax.FLEXVIEW_MAP_CONT,m.flexviewNode),
reloadOnSave:oax.URL_SEARCH_GET_EDITCOND_BACK()||!1,editId:oax.URL_SEARCH_GET_EDITCOND_ID()}),oax.community_layout.login_indicator()))alp.onDCL(alp.asyncF(2345,alp.bindF(q,null,m)));m.filterNode&&(t=this.getFilterTypeCamel(),t=k("oax.x.Filter"+t),r=alp.oCreateMix(n.filter||{},{cont:m.filterNode,cont2:m.filterSelectorNode||null,outsideChangedResetCont:m.outsideChangedResetCont,no_check_init:!!m.m.dataPointListSt.get(),flexOpener:m.flexOpener,flexOpenerPage:m.flexOpenerPage}),a.filter=new t(r,{noCheck:!0}));
m.mlpToggleNode&&(a.mlp=new alp.x.MapLayerPanel({cont:m.mlpContNode,toggle:m.mlpToggleNode,cfg:m._cfg,withoutMapOverlay:!m.withMapOverlay}),H.m_mapoverlay({flexOpener:m.flexOpener,flexOpenerPage:m.flexOpenerPage,m_mapoverlay:a.mlp.m.mapoverlay}));t=this.getSortheadTypeCamel();t=k("oax.x.Sorthead"+t);n=alp.oCreateMix(n.sort||{},{cont:m.sortheadNode});a.sorthead=new t(n);a.filter&&(a.fclset=new l({filterView:a.filter,sortheadView:a.sorthead,getFclFilter:alp.bindF("getFilter",a.clusterLayer),setFclFilter:alp.bindF("setFilter",
a.clusterLayer),setFclAllCatsSelected:alp.bindF("setAllCatsSelected",a.clusterLayer),setFclCatSelected:alp.bindF("setCatSelected",a.clusterLayer),onFclAllCatSelChange:function(b){b.push(a.clusterLayer.listen("allCatSelChange",alp.bindF.apply(alp,alp.Aps.call(arguments,1))),"drop",a.clusterLayer)},interceptSetArea:h}));m.withMapOverlay&&m.mapCB(z,null,m)},connectModel2Model:function(a,b,c,d){function e(){c.areaCatid.set({area:c.area.get()||null,catid:c.catid.get()||null})}b.push(c.dataPointListSt.change_cb(function(){h.call(a,
c.dataPointListSt.get())}));d.fclset&&b.push(d.fclset.m.area.change_cb_init(w,null,a));var f=d.what&&d.filter&&d.what.m.selected_st_valid;f&&b.push(f.change_cb_init(x,null,a,f,d.filter));b.push(c.area.change_cb_init(e));b.push(c.catid.change_cb(e));(f=alp.oGet(d,"what.m.selected_st"))&&b.push(f.bind_to(c.catid,{loose:!0,transform:".catid"}));(f=alp.oGet(d,"fclset.m.area"))&&b.push(f.bind_to(c.area,{loose:!0}));b.push(alp.orState(alp.filter([c.loadingCluster,d.clusterLayer.outSettingFilterState],"")).bind_to(c.loadingClusterOrSettingFilter))},
connectModel2View:function(a,b,c,d){function e(a){function c(b,c){if(!!d.sorthead===b){b=a._fv_prev_filter;var e=a._fv_prev_filter=d.clusterLayer.getFilter();b=!alp.oEqual(e,b);a.setIds(c,b)}}a&&(b.push(d.clusterLayer.listen("sortedVisibleIdsChange",c,null,!0)),b.push(d.clusterLayer.listen("visibleIdsChange",c,null,!1)))}function f(){var a=h.get();alp.m("listMap"!==a?d[a]:d.mapList,"forceViewUpdate")}a.mapIwFromSnippetTmpl&&(a[oax.SNIPPET_TMPL_HTML]="same_as_gallery"===a.mapIwFromSnippetTmpl&&d.gallery?
d.gallery.getSnippetTmplHtml():"string"===typeof a.mapIwFromSnippetTmpl?a.mapIwFromSnippetTmpl:a.mapIwFromSnippetTmpl.innerHTML,b.push(d.clusterLayer.listen("markerClick",m,a)));e(d.gallery);e(d.list);e(d.mapList);e(d.magazine);b.push(c.loadingDetailInPage.change_cb_init(r,null,a));b.push(c.loadingClusterOrSettingFilter.change_cb_init(n,null,a));b.push(d.clusterLayer._alp.mapSt.change_cb(n,null,a));b.push(c.areaGeom.change_cb_init(y,null,a));var g=a._layout,h=g&&alp.oGet(g,"layoutState.showed");h&&
b.push(h.change_cb(f));b.push(c.dataPointListSt.change_cb_init(function(){d.sorthead.m.active.set(!c.dataPointListSt.get())}));g=alp.ratelimitF(336,alp.bindF(C,null,a,c,d));b.push(a.markerStyleSt.change_cb(g));a=d.clusterLayer;a.hasEvent("clusterMetaChange")&&b.push(a.listen("clusterMetaChange",g),"drop",a);g()},connectView2Model:function(a,b,d,g){function h(){r.get()||g.fclset.setArea()}function k(){"new"===g.condition.modeSt.getPrevious()&&d.isDpVis.set(!1)}function l(){a.map&&g.condition.m.map.is(a.map)&&
g.clusterLayer.setMap(g.condition.m.edit.get()?null:a.map)}function m(){var b=a._layout,c=t.get();(b=b&&alp.oGet(b,"layoutState.showed"))&&c&&(b.is(oax.MODE_MAP)||b.is(oax.MODE_LISTMAP)||a.flexOpener.setFvView(a.flexOpenerPage,oax.MODE_MAP))}function n(){new Date>u&&F.emitCustomClick(F.FLEXVIEW,"MLP: basemap: "+g.mlp.m.basemap.get())}function p(){if(new Date>u){var a=g.mlp.m.mapoverlay,b=alp.filterIn(a.getPrevious(),"");a=alp.filterIn(a.get(),"");(b=alp.oDelta(a,b).add[0])&&F.emitCustomClick(F.FLEXVIEW,
"MLP: mapoverlay: "+b)}}function q(){alp.oGet(g,"fclset.setArea")&&g.fclset.setArea("");var a=alp.m(g.where,"getInputTextSt");a&&a.set("")}if(g.where){g.where.info&&b.push(g.where.info.changed_cb(function(b){c(a.map,b)}));g.where.placeChangeCB&&b.push(g.where.placeChangeCB(f,a));g.where.qChangeCB&&b.push(g.where.qChangeCB(e,a));var r=alp.m(g.where,"getInputTextSt"),w=a.whereClearRegionNode,v=alp.oGet(g,"fclset.setArea");r&&w&&v&&oax.XXX_WHERE_ALPSTEIN&&b.push(r,r.change_cb(h))}if(g.condition){(w=
g.condition.modeSt)&&b.push(w.change_cb(k));(w=alp.oGet(g.condition,"m.map")&&alp.oGet(g.condition,"m.edit"))&&b.push(w.change_cb(l));var t=g.condition.m.inameOpen;t&&b.push(t.change_cb(m))}if(g.mlp){var u=1E3+ +new Date;b.push(g.mlp.m.basemap.change_cb(n));b.push(g.mlp.m.mapoverlay.change_cb(p))}(w=a.whereClearRegionNode)&&oax.XXX_WHERE_ALPSTEIN&&b.push(alp.aEL(w,"click",alp.nowF(q)))},connectPureView:function(a,b,c,d){function e(){var a=d.mapList.m.highlightId,b=a.getPrevious();a=a.get();b&&b!==
a&&f(!1,b);a=d.mapList.m.highlightId.get();d.clusterLayer.showTour(a)}function f(b,c){var e=b+"."+c;m!==e&&(m=e,d.clusterLayer.setDataPointUnmergeable(c,b),a._gmDfrd().then(function(a){d.clusterLayer.setSingleMarkerOptions(c,{animation:b&&a.Animation.BOUNCE})}))}function h(){var b=a._layout;b.layoutState&&b.layoutState.showed.is(oax.MODE_LIST)&&b.listResize()}function k(b){(b=b&&b.id)&&oax.iwOpenOOI(a.map,b,a.proj,{cacheBust:+new Date,iwNodePostProcess:g(a,b)})}function l(){function a(a){var c=(a=
a.dataPoint)&&a.id;c&&c===b&&d.clusterLayer.removeDataPoint(a)}var b=d.condition.m.edit.get_property("id");b&&d.clusterLayer.getDataPoint(b).then(a)}d.mapList&&(b.push(d.mapList.m.highlightId.change_cb_init(e)),b.push(d.mapList.mouseoverEvt().then(alp.bindF(f,null,!0))),b.push(d.mapList.mouseoutEvt().then(alp.bindF(f,null,!1))));d.list&&b.push(d.list.viewUpdateEvt().then(h));d.condition&&(b.push(d.condition.saveSuccessEvt().then(k)),d.condition.m.edit&&b.push(d.condition.m.edit.change_cb_init(l)),
a.conditionCreateNode&&oax.community_layout.login_indicator()&&b.push(alp.aEL(a.conditionCreateNode,"click",alp.bindF(q,null,a))));var m},setInitVal:function(a,b,c,d){function e(b){if(b=b&&alp.oGet(b,["items",0])){var c=b.categoryTitle;a.flexOpener.setFvWhere(a.flexOpenerPage,{name:b.title+(c?" ("+c+")":"")})}else console.error('flexview: where init failed from "'+h+'": not found.')}b=alp.oGet(a._cfg,"where.selected_init");c=b===oax.URL_HASH_AREA_ALL?"":b;var f=L.init_from_url_hash(oax.URL_HASH_AREA,
{fallback_url_search:!0}),g=f===oax.URL_HASH_AREA_ALL?"":f;if(f)d.fclset.setArea(g,{direct:!0}),d.fclset.setFclFilter({area:g});else if(b){d.fclset.setArea(c,{direct:!0});d.fclset.setFclFilter({area:c});var h=c;h&&G.api_autocomplete(alp.filterIn({q:c,proj:a.proj,subset:"region"},"")).thenSoon(e)}(b=L.init_from_url_hash(oax.URL_HASH_QTEXT,{fallback_url_search:!0})||"")&&d.fclset.setFreeSearch(b)},mapCB:alp.eventCB("mapDfrd",{then:1}),mapDfrd:alp.memM("mapDfrd",'alp.dfrd("flexview map", {then:1})'),
destroy:function(){alp.m(this._layout,"destroy");this._showFullscreen(!1);this.disconnect()},fitOOI:function(a,b){var c=this.kx.clusterLayer;return c.fitOOI.apply(c,arguments)},getFilterType:function(){return this.filterType||this.frontendtype},getFilterTypeCamel:function(){var a=this.getFilterType();return a.charAt(0).toUpperCase()+a.slice(1)},getSortheadType:function(){return this.sortheadType||this.frontendtype},getSortheadTypeCamel:function(){var a=this.getSortheadType();return a.charAt(0).toUpperCase()+
a.slice(1)},getFclsetType:function(){return this.fclsetType||this.frontendtype},getFclsetTypeCamel:function(){var a=this.getFclsetType();return a.charAt(0).toUpperCase()+a.slice(1)},setDataPointList:function(a){this.m.dataPointListSt.setNow(a)},ooiClickEvt:alp.memM("ooiClickEvt",'alp.event("OAX:FVP:ooiClickEvt",{then:1})'),galleryClickEvt:alp.memM("galleryClickEvt",'alp.event("OAX:FVP:galleryClickEvt",{then:1})'),iwClickEvt:alp.memM("iwClickEvt",'alp.event("OAX:FVP:iwClickEvt",{then:1})'),listClickEvt:alp.memM("listClickEvt",
'alp.event("OAX:FVP:listClickEvt",{then:1})'),magazineClickEvt:alp.memM("magazineClickEvt",'alp.event("OAX:FVP:magazineClickEvt",{then:1})'),mapListClickEvt:alp.memM("mapListClickEvt",'alp.event("OAX:FVP:mapListClickEvt",{then:1})'),mapMarkerClickEvt:alp.memM("mapMarkerClickEvt",'alp.event("OAX:FVP:mapMarkerClickEvt",{then:1})'),areaChangeEvt:alp.memM("areaChangeEvt",'alp.event("OAX:FVP:areaChangeEvt",{then:1})'),catidChangeEvt:alp.memM("catidChangeEvt",'alp.event("OAX:FVP:catidChangeEvt",{then:1})'),
areaCatidChangeEvt:alp.memM("areaCatidChangeEvt",'alp.event("OAX:FVP:areaCatidChangeEvt",{then:1})'),i_open_inpage_class:"oax-opening-detailpage",setLoadingDetailInPage:function(a){this.m.loadingDetailInPage.setNow(a)},open_inpage_iw:function(a,b){var c=this;b||(b=c.map);l.call(c,b,null,{iwOpenCallback:alp.asyncF(234,function(a){a=alp.mix({},alp.gBCR(a.node));var d=240-a.height;0<d&&(a.top-=d,a.height+=d);c._placeInfoCfg=B.util.placeInfoNode(b,a,c._placeInfoCfg||{otherNodesCache:alp.gEBCN(oax.IW_PLACE_OTHER,
c.flexviewNode),padding:{bottom:"100px"}})}),iwCloseCallback:function(a){a&&!a.mapMoved&&(b.panTo(a.origCenter),b.setZoom(a.origZoom))}},null,[a])},_gmDfrd:alp.memM("_gmDfrd",'alp.dfrd("oax:FV:_gmDfrd",{then:1})'),_setNearbyCircle:function(a){var b=this;alp.m(b[M],"setMap");b[M]=null;a&&oa.api.maps(function(c,d){b.mapCB(function(c){var e=a.latlng,f=a.radius,g=a.circle_opt;c=alp.mix({clickable:!1,strokeColor:alp.dflt(g.color,"#FF9900"),strokeOpacity:alp.dflt(g.opacity,1),strokeWeight:alp.dflt(g.weight,
4),fillColor:"#FF0000",fillOpacity:.25,radius:f,map:c,center:new d.LatLng(e.lat,e.lng)},g);b[M]=new d.Circle(c)})})},_showArea:function(a){alp.m(this.kx.fclset,"_showArea",a)},_showAvalDt:function(a){alp.m(alp.oGet(this,"kx.clusterLayer._detailOpenSt"),"setNow",a)},_showFullscreen:function(a){alp.m(alp.oGet(this,"fullscreen.m.isFull"),"setNow",a)},_showWhat:function(a){alp.m(this.kx.what,"select",a)},_showWhere:function(a){a=a&&a.split("\n");alp.m(this.kx.where,"_showWhere",a&&a[0],a&&a[1])},_showFreeSearch:function(a){alp.m(this.kx.where,
"_showFreeSearch",a)}});var M="_last_nearby_circle",R={},S="_loadingClusterOrSettingFilterWaitbox",T="_filled_cfg",Q="_filled_cfg_gm",O="_mapvis_last_center",N="_area_id_current",X="_area_id_2_poly",V="_markerstyle_prev_obj",K="_markerstyle_async_seq",U="_markerstyle_all_ids"});"undefined"!==typeof dojo&&dojo.provide("alp.data.api.user");
(function(){alp.sub("alp.data.api",null,!0).georegionFavUnfav=function(k,h,g){var f=h.proj,e=h.userid,d=h.contentid;alp.forEach([f,e,d],"(v||null).substring.call.a");var b=alp.dfrd("ADA:contentFav",{then:1});alp.m(alp.data.api.token(),["to","then"],function(c){c=alp.cfg.url.api_write_region_fav_unfav({do_fav:k,proj:f,token:c,userid:e,contentid:d});alp.m(alp.xhrPut(c,alp.oCreateMix(g||{},{receiveJson:!0})),["to","then"],alp.bindF("done",b))});return b}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_fav_btn");
(function(){var k=alp.data.api,h=oa.ga_track_anonymous,g=oa.util.community,f=oa.util.login;alp.sub("oa.i",null,!0).IFavBtn={node:null,proj:null,contentid:null,frontendType:"list",favCnt:oa.FAV_CNT,favIs:oa.FAV_IS,favNot:oa.FAV_NOT,toggle:alp.nowF(function(d){var b=this.m,c=b.faved;b=b.count;var a=!c.get(),e=b.get()+(a?1:-1),f=g.get_user_id(),h=alp.opt(this,["proj"]);(f||null).substring.call.a;h.userid=f;h[("list"===this.frontendType?"basket":"content")+"id"]=this.contentid;alp.Later?(d.set(c,a),d.set(b,
e)):(c.set(a),b.set(e));k[("list"===this.frontendType?"basket":this.frontendType)+"FavUnfav"](a,h)}),addNode:function(d){this.node.length||(this.node=[this.node]);this.node.push(d)},augmentModel:function(d){alp.forEach(["proj","contentid"],"(this[v]||null).substring.call.a",this);d.faved=alp.Later?alp.boolState():new alp.BoolState;d.count=alp.Later?alp.intState():new alp.NumberState},setInitVal:function(){var d=arguments,b={that:null,eh_or_hg:null,m:null,kx:null,maybe_later:null},c=4===arguments.length?
0:1;b=alp.mapIn(b,function(){return d[c++%5]});var a=b.that.node,f=a.childNodes?a:a[0];a=b.that[e]=alp.reduce(alp.map(a===f?[a]:a,'alp.gEBCN("'+b.that.favCnt+'",v)'),"v.push.apply(v,w),v",[]);f.childNodes.a;a[0].childNodes.a;f=alp.hasClass(f,this.favIs);a=alp.textContent(a[0])|0;alp.Later?b.maybe_later.set(b.m.faved,f):b.m.faved.set(f);alp.Later?b.maybe_later.set(b.m.count,a):b.m.count.set(a)},connectModel2View:function(d,b,c,a){var f=c.faved,g=c.count;b.push(alp.m(f,["chenInit","change_cb_init"],
function(){var a=f.get();alp.setClass(d.node,[[d.favIs,a],[d.favNot,!a]])}));b.push(alp.m(g,["chenInit","change_cb_init"],function(){var a=g.get();alp.setText(d[e],alp.i18n.thousandSep(a))}))},connectView2Model:function(d,b,c,a){function e(a,b){a&&alp.stopEvent(a);g.login_indicator()?b||(h.emitCustomClick(d.frontendType,(c.faved.get()?"unlike ":"like ")+d.contentid),d.toggle()):(a={type:k},g.generic_login_barrier_before(a),f.open_login(a))}a=d.node;(d.contentid||null).substring.call.a;var k=d.declaredClass+
"."+d.contentid;b.push(alp.aEL(a,"click",function(a){e(a,!1)}));g.generic_login_barrier_after({type:k},alp.bindF(e,null,null,c.faved.get()))}};oa.i.IFavBtn.installLazy=function(d,b,c){var a=alp.oCreateMix({where:null,onload:function(a){var e=alp.nodify(oa.FAV_BTN,a.node);a=oa.ID_FROM_DOMNODE(a.node);e&&(b["favbtn"+a]?(b["favbtn"+a].addNode(e),b["favbtn"+a].init()):b["favbtn"+a]=new d({proj:c.proj||"outdooractive",node:e,contentid:a,initNow:!0}))},onscrollLoad:"oax-load-list-fav-btn"},c);b&&"object"===
typeof b||(b={});oa.util.installLazyLoad(a)};var e="_fav_cnt_noli"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.fav_btn");(function(){alp.declare("oax.x.FavBtn",alp.x.AbstractController,null,oa.i.IFavBtn,{})})();"undefined"!==typeof dojo&&dojo.provide("alp.x.more_snippets_search");
(function(){alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.MoreSnippetsSearch",alp.x.AbstractMoreSnippets,null,{q:null,cat:null,assertParam:function(){this.q.substring.call.a},xhrUrl:function(k,h){return alp.cfg.url.api_search_more_snippets(this.cat,this.proj,this.q,k,h)}})})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_dynamic_search");
(function(){var k=alp.i.state;alp.sub("oa.i",null,!0).IDynamicSearch={proj:null,cat:null,input:null,output:null,emptyFlexClass:"",ms_creator:null,contnode:null,infonode:null,closer:null,magnifier:null,notfound:null,initLength:16,step:16,postProcessNode:alp.f(),augmentModel:function(g){g.q=k.stringState()},connectModel2View:function(g,f,e,d){var b=e.q;f.push(k.chenInit(b,function(){function c(){p===g[h]&&0===p.m.nfull.get()&&(alp.m(g,"stopWait",f),q&&alp.setClass(q,oa.NO_DISPLAY,!1))}alp.m(g[h],"disconnect");
g[h]=null;var a=g.ms_creator?g.ms_creator:alp.Later?alp.x2.MoreSnippets:alp.x.MoreSnippetsSearch,d=a.prototype.snippetCont,e=a.prototype.moreButton,f=g._sniCont=alp.nodify(d,g.output)||alp.cE("div",g.output,{"class":d});d=g._moreBtn=alp.nodify(e,g.output)||alp.cE("div",g.output,{"class":e});alp.empty(f);alp.setClass(d,oa.NO_DISPLAY,!0);e=(d=b.get())&&2<d.length;var n=g.infonode,q=g.notfound;n&&alp.setClass(n,oa.NO_DISPLAY,!!d);if(e){q&&alp.setClass(q,oa.NO_DISPLAY,!0);alp.m(g,"startWait",f);var p=
g[h]=new a({initNow:!0,contNode:g.output,proj:g.proj,q:d,cat:g.cat,initLength:g.initLength,step:g.step,postProcess:function(a){alp.m(g,"stopWait");q&&alp.setClass(q,oa.NO_DISPLAY,!0);a=g.postProcessNode(a);alp.dom.anchor.wrap_ooi_snippet(a);return a}});if((a=f.firstElementChild)&&0<g.emptyFlexClass.length)for(d=3;d--;)alp.cE("div",a,{"class":g.emptyFlexClass});k.chenInit(p.m.nfull,c)}else alp.m(g,"stopWait",f),q&&alp.setClass(q,oa.NO_DISPLAY,!0)}))},connectView2Model:function(g,f,e,d){function b(){k.setNow(e.q,
c.value="")}var c=g.input;f.push(alp.aEL(c,"keyup",function(a){a.keyCode===alp.key.ENTER&&(k.setNow(e.q,c.value),c.blur());a.keyCode===alp.key.ESCAPE&&k.setNow(e.q,c.value="")},230),clearInterval);(g=this.closer)&&f.push(alp.aELtouchup(g,b,!1,{doNotStop:!0}))},connectPureView:function(g,f,e,d){function b(){a.value?k.setNow(e.q,a.value):a.focus()}function c(){var b=!a.value;alp.setClass(h,[["oax-empty",b],["oax-not-empty",!b]])}var a=g.input;(g=this.magnifier)&&f.push(alp.aELtouchup(g,alp.asyncF(alp.Later?
888:357,b),!1,{doNotStop:!0}));var h=this.contnode;h&&(f.push(alp.aEL(a,"keyup",c)),c())}};var h="_snippet_view"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.dynamic_search");
(function(){var k=alp.dom;alp.declare("oax.x.DynamicSearch",alp.x.AbstractController,null,oa.i.IDynamicSearch,{tabnode:null,startWait:function(g){this.stopWait();g||null.bug;(this[h]=new alp.x.Waitbox({targetInit:g})).startWait()},stopWait:function(){var g=this[h];g&&(this[h]=null,g.setTarget(),g.stopWait())},connectModel2View:function(g,f,e,d){function b(b){b.keyCode===alp.key.ENTER&&k.triggerClick(a)}function c(){if(e.q.get()){var b=document.activeElement===g.input;k.triggerClick(a);b&&g.input.focus()}}
alp.m(oa.i.IDynamicSearch,"connectModel2View",g,f,e,d);var a=g.tabnode;a&&(f.push(e.q.change_cb_init(c)),f.push(alp.aEL(g.input,"keyup",b)))}});var h="_waitbox"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.listsview");
(function(){var k=alp.dom.anchor;alp.declare("oax.x.ListsView",alp.x.AbstractController,null,{proj:null,cat:null,cont:null,favBtnClass:oa.FAV_BTN,searchInputNode:null,searchOutputNode:null,emptyFlexClass:"alp-moresnippets-snippet oax_no_v_marg",searchContNode:null,searchCrossNode:null,searchInfoNode:null,searchInputTabNode:null,searchMagnifierNode:null,searchNotFoundNode:null,augmentKids:function(h){var g=this.cont,f=this.proj;g.childNodes.a;alp.forEach(alp.gEBCN(oa.ID,g),k.wrap_ooi_snippet);oa.i.IFavBtn.installLazy(oax.x.FavBtn,
h,{cont:g,where:"listview",proj:f});g=this.searchInputNode;var e=this.searchOutputNode,d=this.emptyFlexClass,b=this.searchContNode,c=this.searchCrossNode,a=this.searchInfoNode,m=this.searchInputTabNode,l=this.searchMagnifierNode,r=this.searchNotFoundNode;g&&(h.dynamicSearch=new oax.x.DynamicSearch({proj:this.proj,cat:this.cat,input:g,output:e,emptyFlexClass:d,ms_creator:alp.x.MoreSnippetsListSearch,contnode:b,closer:c,infonode:a,magnifier:l,notfound:r,tabnode:m,postProcessNode:function(a){oa.i.IFavBtn.installLazy(oax.x.FavBtn,
h,{cont:a,where:"listview",proj:f});return a}}))}})})();"undefined"!==typeof dojo&&dojo.provide("oax.flexviewpage");
(function(){function k(a){a.flexviewNode=oa.LIST===a.frontendtype?a.flexviewpageNode:d(a.flexviewCont,a.flexviewpageNode);a.flexviewNode.childNodes;a.whatNode=d(a.whatCont,a.flexviewpageNode);a.whereNode=d(a.whereCont,a.flexviewpageNode);a.searchContNode=alp.nodify(a.searchCont,a.flexviewpageNode);a.searchCrossNode=alp.nodify(a.searchCross,a.flexviewpageNode);a.searchInfoNode=alp.nodify(a.searchInfo,a.flexviewpageNode);a.searchInputTabNode=alp.nodify(a.searchInputTab,a.flexviewpageNode);a.searchInputNode=
alp.nodify(a.searchInput,a.flexviewpageNode);a.searchMagnifierNode=alp.nodify(a.searchMagnifier,a.flexviewpageNode);a.searchNotFoundNode=alp.nodify(a.searchNotFound,a.flexviewpageNode);a.searchOutputNode=alp.nodify(a.searchOutput,a.flexviewpageNode);a.whatHide&&("none"===a.whatType&&console.error('Contradiction: you want whatHide==true and whatType=="none" at the same time! Please remove one of them.'),a.whatNode&&alp.setClass(a.whatNode,oa.NO_DISPLAY,!0));a.whereHide&&a.whereNode&&alp.setClass(a.whereNode,
oa.NO_DISPLAY,!0);(a.whatHide||a.whereHide)&&alp.setClass(alp.gEBCN("oax_selector_text",a.flexviewpageNode),oa.NO_DISPLAY,!0);a.whatHide&&a.whereHide&&alp.setClass(alp.gEBCN("oax-selectors",a.flexviewpageNode),oa.NO_DISPLAY,!0);a.galleryNode=d(a.galleryCont,a.flexviewpageNode);a.listNode=d(a.listCont,a.flexviewpageNode);a.mapListNode=d(a.mapListCont,a.flexviewpageNode);a.magazineNode=d(a.magazineCont,a.flexviewpageNode);a.filterNode=d(a.filterCont,a.flexviewpageNode);a.filterSelectorNode=d(a.filterSelectorCont,
a.flexviewpageNode);a.sortheadNode=d(a.sortheadCont,a.flexviewpageNode);alp.forEach(p,function(b){a[b+"Type"]||(a[b+"Type"]=alp.opt((alp.opt(a[b+"Node"],"className")||"").match(x),1))})}function h(a,b){var c=alp.cE("div",null,null,{innerHTML:b.answer.html});alp.forEach(p,function(b){if(b!==q){var d=b+"Node";a._fillMarkup&&(a[d]=null);if(d=a[d])for(d=d.childNodes,b=alp.gEBCN(w+b,c)[0],b.childNodes,b=d.length;b--;){var e=(d[b].className||"").match(/\b\S+\b/g);if(e)for(var f=e.length;f--;){var g=e[f];
/^oax-/.test(g)&&alp.orphan(alp.gEBCN(g,c))}}}});a._custom_dom_src=c}function g(a){var b=a._custom_dom_src;alp.forEach(p,function(c){var d=a[c+"Node"];if(d){c=alp.gEBCN(w+c,b)[0];for(var e=document.createDocumentFragment(),f;f=c.firstChild;)e.appendChild(f);d.firstChild?d.insertBefore(e,d.firstChild):d.appendChild(e)}})}function f(a){a=e(a);return f[a]||(f[a]=alp.jsonp(a))}function e(a){a.plugintype=oax.PLUGINTYPE;return alp.tmpl(n,a)}function d(a,b){return"string"===typeof a?alp.gEBCN(a,b)[0]:a}
var b=alp._gmap2_3,c=oa.util,a=c.mapconfig,m=oax.util,l=m.event,r=oa.cfg,n=oax.FLEXVIEW_MARKUP_JSONP_URL_TMPL,q=oax.FLEXVIEWPAGE,p=[q].concat("what where gallery list mapList magazine filter sorthead".split(" ")),v=["flexviewNode","frontendtype","proj","actionOpenType"],u="openOOIUrl withUrlHash hasFullscreenToggle mcpCatList mcpInitList mcpInitCheckedIds fitDataBounds filterSelectorNode initFilterNoGui".split(" "),t="searchContNode searchCrossNode searchInfoNode searchInputTabNode searchInputNode searchMagnifierNode searchNotFoundNode searchOutputNode".split(" "),
w=oax.PART_CSS_CLASS,x=oax.TYPE_CSS_CLASS_RX,y="ooiClick galleryClick iwClick listClick mapListClick mapMarkerClick magazineClick".split(" "),z=r.BM_CENTER;alp.declare("oax.FlexViewPage",null,alp.nowF(function(b){function e(a){return a&&a.replace(/^calendar$/i,"magazine")}var g=this;alp.mixCheck(g,b);g.actionOpenType!==oax.ACTION_OPEN_IN_PAGE||g.withUrlHash||console.error('OAX flexview: "in-page" actionOpenType requires withUrlHash:true');c.fvp_determine_frontendtype(g);"event"===g.frontendtype&&
(g.modes||(g.modes=[oa.MODE_LISTMAP,oa.MODE_MAP,oa.MODE_GALLERY,oa.MODE_MAGAZINE]),g.initMode||(g.initMode=g.modes[0]),g.initMode=e(g.initMode),g.modes=alp.map(g.modes,e));b=g.top=d(g.topCont);g.fillMarkup&&(d(g.flexviewpageCont,g.top)||alp.cE("div",b,{"class":g.flexviewpageCont}),f(g));a.bbox_maybe_ensure_loading_mapconfig(g);alp.forEach(["fullscreenChange","modeChange","inpageOpen","overlayChange"].concat(y),function(a){var b="on"+a.charAt(0).toUpperCase()+a.substring(1);(b=g[b])&&g[a+"Evt"]().then(b)})}),
alp.util.InterfaceWithInit,oa.i.IMapClients,{fillMarkup:!0,proj:null,key:null,initMode:null,modes:null,initFilterOpen:null,initFullscreen:!1,initGeoIP:!1,actionOpenType:oax.ACTION_OPEN_IN_PAGE,flexOpener:null,openOOIUrl:null,frontendtype:null,whatType:"simple",whatHide:!1,whereType:"alpstein",whereHide:!1,withUrlHash:!0,hasFullscreenToggle:!0,mapInit:null,cfg:null,mapTypeIds:null,mapTypeId:null,center:null,zoom:null,bbox:null,transmitMapTypeId:!1,poi:null,mcpCatList:null,mcpInitList:null,mcpInitCheckedIds:"",
initDataPointList:null,initFilterNoGui:null,fitDataBounds:!1,initMarkerStyle:null,onFullscreenChange:null,onModeChange:null,onInpageOpen:null,onOverlayChange:null,onOoiClick:null,onGalleryClick:null,onIwClick:null,onListClick:null,onMagazineClick:null,onMapListClick:null,onMapMarkerClick:null,topCont:"oax-top-cont",flexviewpageCont:w+"flexviewpage",flexviewCont:w+"flexview",whatCont:w+"what",whereCont:w+"where",galleryCont:w+"gallery",listCont:w+"list",mapListCont:w+"mapList",magazineCont:w+"magazine",
filterCont:w+"filter",filterSelectorCont:"oax-filter-selectors-wrapper",sortheadCont:w+"sorthead",whereClearRegion:"oax-where-clear-region",mpCont:oax.MP_CONT,mlpCont:oax.MLP_CONT,mcpCont:oax.MCP_CONT,mlpToggle:oax.MLP_TOGGLE,mcpToggle:oax.MCP_TOGGLE,conditionCont:"oax-condition-ctrl",conditionCreate:"oax-condition-create",conditionEditCont:"oax-condition-edit-container",searchCont:oa.SEARCH_CONT,searchCross:oa.SEARCH_CROSS,searchInfo:oa.SEARCH_INFO,searchInputTab:"oax-search-tab",searchInput:oa.SEARCH_INPUT,
searchMagnifier:oa.SEARCH_MAGNIFIER,searchNotFound:oa.SEARCH_NOTFOUND,searchOutput:oa.SEARCH_OUTPUT,initASAP:alp.nowF(function(){function n(a){function b(b){if("ok"!==alp.oGet(b,"answer.status"))throw console.error("flexviewpage: could not load markup. Received: ",b),Error("flexviewpage: could not load markup.");var c=D[A]||(D[A]=new alp.x.Waitbox({delay_ms:33})),d=D.flexviewpageNode;alp.style(d,{minWidth:"100px",minHeight:"100px"});c.setTarget(d);c.startWait();h(D,b);g(D);a()}D._fillMarkup?f[e(D)].then(b):
a()}function q(a){k(D);a()}function r(a){D.initGeoIP?c.init_geo_ip(D,a):a()}function w(b){function e(b){var e=alp.map(p,alp.f('+"Node"')).concat(alp.map(p,alp.f('+"Type"'))).concat(v).concat(u).concat(oa.LIST===D.frontendtype?t:[]);e=alp.filter(e,alp.f("!/flexviewpage/.test(v)"));D._flexviewCfg=alp.oCreateMix(alp.opt(D,e),b);D.mapTypeIds&&alp.oSet(D._flexviewCfg,"maplayer.basemap.layer",D.mapTypeIds);D.mapTypeId&&alp.oSet(D._flexviewCfg,"maplayer.basemap.init",D.mapTypeId);D.center&&alp.oSet(D._flexviewCfg,
z,D.center);null!=D.zoom&&alp.oSet(D._flexviewCfg,"maplayer.basemap.zoom",D.zoom);D.bbox&&alp.oSet(D._flexviewCfg,"maplayer.basemap.bbox",D.bbox);D._flexviewCfg.mpContNode=d(D.mpCont,D.top);D._flexviewCfg.mlpContNode=d(D.mlpCont,D.top);D._flexviewCfg.mcpContNode=d(D.mcpCont,D.top);D._flexviewCfg.mlpToggleNode=d(D.mlpToggle,D.top);D._flexviewCfg.mcpToggleNode=d(D.mcpToggle,D.top);D._flexviewCfg.conditionContNode=d(D.conditionCont,D.top);D._flexviewCfg.conditionCreateNode=d(D.conditionCreate,D.top);
D._flexviewCfg.conditionEditContNode=d(D.conditionEditCont,D.top);D._flexviewCfg.outsideChangedResetCont=D.top;D._flexviewCfg.isMapPanelOpenSt=D.isMapPanelOpenSt;D._flexviewCfg.dataPointListSt=D.dataPointListSt;D._flexviewCfg.markerStyleSt=D.markerStyleSt;if(b=D.whereClearRegion)D._flexviewCfg.whereClearRegionNode=d(b,D.flexviewpageNode);D._flexviewCfg.initFullscreen=D.initFullscreen;c.fvp_determine_poi(D);c.fvp_cfg_map_init(D._flexviewCfg,D.mapInit);a.bbox_maybe_use_mapconfig(D,D._flexviewCfg,f)}
function f(){m.overwrite_map_cfg_from_url_hash(D._flexviewCfg,{bbox:!0});m.overwrite_what_cfg_from_url_hash(D._flexviewCfg);b()}var g="string"===typeof D.cfg&&D.cfg;g?alp.jsonp(g).then(e):e(D.cfg)}function x(a){D._flexviewCfg.flexOpener=D.flexOpener=D.flexOpener||oax.x.getFlexOpener({top:D.top,firstPage:D,firstPageOpt:D._opt,inWithUrlHash:D.withUrlHash});D._flexviewCfg.flexOpenerPage=D;a()}function L(a){D===D._flexviewCfg.flexOpener.firstPage&&c.link_webapp_fix_highlight();a()}function J(a){var b=
D.initMode,c=D.initFilterOpen,d=D.modes;"avalanche"===D.frontendtype&&(d=[b=oax.MODE_MAP]);var e=location.hash.match(/[#&]filter=([^&]+)/);e&&e[1]!=="s-condition-"+oax.CONDITION_SLIDER_INIT&&(D.filterSelectorNode&&e[1]?(c=alp.map(alp.map(e[1].split(","),'v.split("-")'),'!!alp.nodify("oax-filter-" + v[0] + "-" + v[1], this)',D.filterSelectorNode),c=!alp.and(c)):c=!0);alp.setClass(D.top,"oax",!0);D._layout=oa.LIST===D.frontendtype?new oax.DetailLayout({id:oa.ID_NONE,proj:D.proj,frontendtype:D.frontendtype,
flexOpener:D.flexOpener,flexOpenerPage:D,topCont:D.top}):new oax.FlexViewLayout({topNode:D.top,initMode:b,initFilterOpen:c,modes:d,isMapPanelOpenSt:D.isMapPanelOpenSt,dataPointListSt:D.dataPointListSt,withUrlHash:D.withUrlHash,flexOpener:D.flexOpener,flexOpenerPage:D});D._flexviewCfg.layout=D._layout;D._flexviewCfg.modeSet=D._layout.mode2btn;a()}function P(a){function c(){oa.api.maps(d)}function d(){if(oa.LIST===D.frontendtype){var b=D._flexviewCfg;D._flexviewCfg=alp.mix(alp.opt(b,"proj searchContNode searchCrossNode searchInfoNode searchInputTabNode searchInputNode searchMagnifierNode searchNotFoundNode searchOutputNode".split(" ")),
{cat:b.frontendtype,cont:D.flexviewNode});D.flexview=new oax.x.ListsView(D._flexviewCfg)}else D.flexview=new oax.x.FlexView(D._flexviewCfg);alp.forEach(y,f);D.flexview.init();a();alp.m(D.flexview,"mapCB",e)}function e(a){D._layout.aEL_on_map_show(b.event("trigger"),null,a,"resize")}function f(a){a+="Evt";a in D.flexview&&D.flexview[a]().bindEvent(D[a]())}alp.onDCL(oa.LIST===D.frontendtype?d:c)}function H(a){l.install(D._layout.layoutState.showed,D,"modeChangeEvt");var b=D.flexOpener;D===b.firstPage&&
l.install(b.m.inpageDetail,D,"inpageOpenEvt");alp.m(D.flexview,"mapCB",function(){D.hasFullscreenToggle&&l.install(D.flexview.fullscreen.m.isFull,D,"fullscreenChangeEvt")});l.install(D.flexview.m.overlayName,D,"overlayChangeEvt");a()}function F(a){var b=D.flexview;alp.m(b,"mapCB",function(c){b===D.flexview&&D._mapClients().setMap(c);a()})}var D=this,M=D._||(D._={}),R=M.initSeq||(M.initSeq=alp.asyncSeq());M.isDestroyed=!1;(function(){D.top.childNodes.a;D._fillMarkup=D.fillMarkup||!d(D.flexviewpageCont,
D.top);D._fillMarkup&&(alp.empty(D.top),alp.cE("div",D.top,{"class":D.flexviewpageCont}),f(D));D.flexviewpageNode=d(D.flexviewpageCont,D.top);if(!D.flexviewpageNode)throw Error("Could not find top-level flexviewpage container node: "+D.flexviewpageCont);D.isMapPanelOpenSt=new alp.BoolState;var a=c.fvp_setup_dataPointListSt(D);D.markerStyleSt=new alp.ObjectState({init_value:D.initMarkerStyle});alp.setClass(D.flexviewpageNode,oax.OAX_CLASS,!0);R.next(n).next(q).next(r).next(w).nextBind(c.fvp_solve_center_from_ids,
null,D).next(a).next(x).next(L).next(J).next(P).next(function(a){alp.m(D[A],"stopWait");a()}).next(H).next(function(a){function b(){D.mark_init_done(D);a()}var c=D.flexview.kx.clusterLayer;c?c.whenLoaded(b):b()}).next(F)})()}),destroyASAP:function(){var a=this,b=a._;b.isDestroyed=!0;b.initSeq.next(function(b){alp.m(a._layout,"destroy");alp.m(a.flexview,"destroy");alp.m(a.flexview,"disconnect");a.flexview=null;var c=a.top;alp.isDescendant(a.flexviewpageNode,c)&&alp.empty(c);a._mapClients().setMap();
b()})},isDestroyed:alp.memM("isDestroyed",'!!alp.oGet(this,"_.isDestroyed")'),fullscreenChangeEvt:alp.memM("fullscreenChangeEvt",'alp.event("OAX:FVP:fullscreenChangeEvt",{then:1})'),modeChangeEvt:alp.memM("modeChangeEvt",'alp.event("OAX:FVP:modeChangeEvt",{then:1})'),inpageOpenEvt:alp.memM("inpageOpenEvt",'alp.event("OAX:FVP:inpageOpenEvt",{then:1})'),overlayChangeEvt:alp.memM("overlayChangeEvt",'alp.event("OAX:FVP:overlayChangeEvt",{then:1})'),ooiClickEvt:alp.memM("ooiClickEvt",'alp.event("OAX:FVP:ooiClickEvt",{then:1})'),
galleryClickEvt:alp.memM("galleryClickEvt",'alp.event("OAX:FVP:galleryClickEvt",{then:1})'),iwClickEvt:alp.memM("iwClickEvt",'alp.event("OAX:FVP:iwClickEvt",{then:1})'),listClickEvt:alp.memM("listClickEvt",'alp.event("OAX:FVP:listClickEvt",{then:1})'),magazineClickEvt:alp.memM("magazineClickEvt",'alp.event("OAX:FVP:magazineClickEvt",{then:1})'),mapListClickEvt:alp.memM("mapListClickEvt",'alp.event("OAX:FVP:mapListClickEvt",{then:1})'),mapMarkerClickEvt:alp.memM("mapMarkerClickEvt",'alp.event("OAX:FVP:mapMarkerClickEvt",{then:1})'),
destroy:function(){this.destroyASAP();alp.m(this.flexOpener,"destroy")},fitOOI:function(a,b){function c(){d.flexview.fitOOI.apply(d.flexview,e).thenSoon(function(){f.triggerSoon()})}var d=this,e=arguments,f=alp.dfrd("oax:FVP:fitOOI",{then:!0});d.whenLoaded(function(){d.flexview.mapCB(c)});return f},getCenter:function(){var a=alp.m(alp.oGet(this,"flexview.map"),"getCenter");return a&&{lat:a.lat(),lng:a.lng()}},getDataPointList:function(){return this.dataPointListSt.get()},setDataPointList:function(a){c.fvp_setup_dataPointListSt(this,
{dpl:a,now:!0})},getMetaData:function(){return this.flexview.m.metadata.get()},clearAllMarkerStyle:function(){this.markerStyleSt.setNow()},setMarkerStyle:function(a,b){this.markerStyleSt.set_flex_now(a,b)},unsetMarkerStyle:function(a){a=this.markerStyleSt.get()||{};delete a.id;this.markerStyleSt.setNow(a)},_showArea:function(a){this.flexview._showArea(a)},_showAvalDt:function(a){this.flexview._showAvalDt(a)},_showFullscreen:function(a){this.flexview._showFullscreen(a)},_showView:function(a){alp.subDfrd("_layout",
this).then(function(b){b._showView(a)})},_showWhat:function(a){this.flexview._showWhat(a)},_showWhere:function(a){this.flexview._showWhere(a)},_showFreeSearch:function(a){this.flexview._showFreeSearch(a)}});var A="_fvp_waitbox"})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.visible");
(function(){function k(f,e,d,b,c){e=d<e(c.first)?c.first:g.funSoftIndex(e,d,c).ind0;f=b>f(c.last)?c.last:g.funSoftIndex(f,b,c).ind1;return{first:e,last:f}}var h=alp.sub("alp.dom",null,!0),g=alp.util;h.checkVisibleSameParent=function(f){function e(a){a=Math.round(a);return a in e?e[a]:e[a]=t+c(a)}function d(b){b=Math.round(b);return b in d?d[b]:d[b]=e(b)+a(b)}function b(d){d=Math.round(d);return d in b?b[d]:b[d]=c(d)+a(d)}function c(a){a=Math.round(a);return a in c?c[a]:c[a]=f[a].offsetTop}function a(b){b=
Math.round(b);return b in a?a[b]:a[b]=f[b].offsetHeight}var g=f[0],h=g&&g.parentNode,r=h&&h.offsetHeight,n=h&&h.scrollTop;h=h&&h.scrollHeight;var q=g&&g.offsetParent,p=q&&q.offsetHeight,v=q&&q.scrollTop,u=q&&q.scrollHeight;if(alp.and([g&&g.offsetHeight,r,p,u],">0")&&(g=alp.gBCR(q),0<g.width&&0<g.height)){var t=g.top,w={first:0,last:f.length-1};g=document.documentElement.clientHeight;if(!(g<e(w.first)||0>d(w.last))){q=k(e,d,0,g,w);g=q.first;q=q.last;if(0!==n||h!==r)v=n,u=r;0===v&&u===p?(r=g,n=q):(n=
k(c,b,v,v+u,w),r=n.first,n=n.last);return{firstWin:g,lastWin:q,first:r,last:n}}}}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.infi_snippets_model");
(function(){function k(b,c){function a(a){f===b._initDataLoading&&c.initData.setNow(a.responseJson)}var d=c.initData.get();c.idList.set(alp.map(d||[],"v.id  ||  v"));if(d)c.id2html.set(alp.arr2o(alp.filter(d,".id"),"id","html")),c.nfull.set(d.length),c.visibleRange.set({min:0,max:0});else{c.nfull.set();c.id2html.set();c.snippets.set();c.visibleRange.set();d={type:b.prefix,nObject:b.tmplHTML?0:b._isb};b.id&&(d.id=b.id);b.proj&&(d.proj=b.proj);var e=c.sortBy.get();e&&(d.sortBy=e);d=alp.cfg.url.api_snippet_list_init(d);
var f=b._initDataLoading=alp.xhrGet(d,{receiveJson:!0});f.then(a)}}function h(b,c){var a=c.visibleRange.get();if(a){var d=c.nfull.get()-1;c.desiredRange.set({min:Math.max(0,Math.min(d,a.min-b._sb)),max:Math.min(d,Math.max(a.max,a.min+b._isb))})}else c.desiredRange.set()}function g(b,c){var a=c.idList.get(),d=c.desiredRange.get();a&&d&&d.min<=d.max&&(c=c.id2html.get()||{},d=alp.filter(a.slice(d.min,1+d.max),"!(v in this)",c),d.length&&f(b,a,d))}function f(b,c,a){function e(a,c){var d=b.tmplHTML;a=
alp.arr2o(c,"id",function(a){return alp.tmplJs(d,a)});k.triggerSoon(a)}function f(a){k.triggerSoon(alp.arr2o(a.responseJson,"id","html"))}var g=[b.proj,b.prefix,b.id].join("#");g=d[g]||(d[g]={});var h=alp.filter(a,"!(v in this)",g),k=alp.dfrd("infisnippets:load missing snippets");if(b.tmplHTML)(new alp.data.OOIs({idlist:h,proj:b.proj})).load(e);else if(h.length){var p={type:b.prefix,snippetIds:h.join(",")};b.id&&(p.id=b.id);b.proj&&(p.proj=b.proj);alp.xhrGet(alp.cfg.url.api_snippet_list_fetch(p),
{receiveJson:!0}).then(f)}for(p=h.length;p--;)g[h[p]]=k;alp.gatherDfrd(alp.map(a,"this[v]",g)).thenSoon(function(d){if(b.m.idList.is(c)){if(d.length!==a.length)throw Error("bug");for(var e={},f=a.length;f--;){var g=a[f],h=alp.oGet(d,[f,0]);h&&g in h?((h=h[g])||(h="No html for "+g+". Unfinished index maybe?"),(h||0).substring.call.a,e[g]=h):console.error("InfiSnippets bug. "+g)}b.m.id2html.mixin(e)}})}function e(b,c){var a=c.idList.get(),d=c.id2html.get(),e=c.desiredRange.get();if(a&&e&&e.min<=e.max){var f=
!1,g=[].concat(c.snippets.get()||[]),h=Math.min(a.length,e.max+b.nPlaceholder);for(e=e.min;e<=h;e++){var k=a[e];if(!k)break;k=d[k]||b.loadingHTML;g[e]!==k&&(g[e]=k,f=!0)}f&&c.snippets.set(g)}else c.snippets.set([])}alp.declare("alp.x.InfiSnippetsModel",alp.x.AbstractController,null,{contNode:null,proj:null,prefix:null,loading:"alp-infisnippets-loading",id:null,sortSelect:"alp-infisnippets-sortsel",tmpl:"alp-infisnippets-tmpl",initLength:20,step:10,buffer:1,nPlaceholder:500,getIdList:function(){return this.m.idList.get()},
reloadData:function(){this.m.initData.set(null)},idListChangeEvt:alp.memM("idListChangeEvt",'alp.event("InfiSnippetsModel:idListChangeEvt",{then:1})'),augmentModel:function(b){b.sortBy=new alp.StringState;b.initData=new alp.State;b.nfull=new alp.State;b.visibleRange=new alp.ObjectState;b.desiredRange=new alp.ObjectState;b.idList=new alp.SortedArrayState;b.id2html=new alp.ObjectState;b.snippets=new alp.ObjectState},setInitVal:function(b,c,a,d){b.contNode.childNodes.a;alp.forEach(["loading","sortSelect",
"separatorTmp","numberDisplay","tmpl"],function(a){(a=b[a+"Node"]=alp.nodify(b[a],b.contNode))&&a.childNodes.a});b.loadingHTML=alp.outerHTML(alp.setClass(b.loadingNode.cloneNode(!0),"oax_no_display",!1));b.tmplNode&&(b.tmplHTML=b.tmplNode.innerHTML);(c=b.sortSelectNode&&alp.gA(b.sortSelectNode.options[b.sortSelectNode.selectedIndex],"value"))&&a.sortBy.set(c);b._sb=b.step*b.buffer;b._isb=b.initLength+b._sb},connectModel2Model:function(b,c,a,d){c.push(a.sortBy.change_cb_init("reloadData",b));c.push(a.initData.change_cb_init(k,
null,b,a));c.push(a.visibleRange.change_cb_init(h,null,b,a));c.push(a.nfull.change_cb_init(h,null,b,a));c.push(a.desiredRange.change_cb_init(g,null,b,a));b=alp.ratelimitF(300,alp.nowF(e),null,b,a);c.push(a.id2html.change_cb(b));c.push(a.idList.change_cb(b));b()},connectModel2View:function(b,c,a,d){c.push(a.idList.change_cb_init(function(){b.idListChangeEvt().triggerSoon()}))}});var d={}})();"undefined"!==typeof dojo&&dojo.provide("alp.x.infi_snippets");
(function(){function k(d){var b=alp.gA(d.sortSelectNode.options[d.sortSelectNode.selectedIndex],"value");null!=b&&d.m.sortBy.setNow(b)}function h(){function d(b,c,d){var e={html:c};b&&a._separatorTmplHTML&&alp.aC(d,e.sepNode=alp.cE("div",null,{"class":a.separatorClass},{innerHTML:a._separatorTmplHTML}));alp.aC(d,e.snippetNode=(a.postProcess||alp.f())(alp.cE("div",null,{"class":a.snippetClass},{innerHTML:c}),a));q.push(e)}function b(b,c){if(q[b].html!==c)if(q[b].html=c,a.postProcess){var d=q[b].snippetNode;
b=q[b].snippetNode=a.postProcess(alp.cE("div",null,{"class":a.snippetClass},{innerHTML:c}),a);a.snippetContNode.insertBefore(b,d);a.snippetContNode.removeChild(d)}else q[b].snippetNode.innerHTML=c}function c(){var b=q.pop();a.snippetContNode.removeChild(b.snippetNode);b.sepNode&&a.snippetContNode.removeChild(b.sepNode)}var a=this,f=a.m,g=f.snippets.get(),h=g||[],k=h.length,q=a[e]||(a[e]=[]),p=Date.now?Date.now():+new Date,v=!0,u=a._spinner,t=f.initData.get();t&&(0===t.length||g)&&u&&(alp.orphan(u.target),
u.setTarget(null),u.stop(),a._spinner=null);if(t&&0===t.length)!a.zeroMsgNode||a._zeroMsg&&alp.isDescendant(a._zeroMsg,a.contNode)||alp.place(a._zeroMsg||(a._zeroMsg=alp.cE("div",null,null,{innerHTML:a.zeroMsgNode.innerHTML})),a.contNode,"first");else a:for(a._zeroMsg&&a._zeroMsg.parentNode&&alp.orphan(a._zeroMsg);;){g=Math.min(q.length,k);for(u=0;u<g;u++)if(b(u,h[u]),(Date.now?Date.now():+new Date)-p>a.max_duration_ms)break a;if(g<k){t=document.createDocumentFragment();for(u=g;u<k&&!(d(u,h[u],t),
(Date.now?Date.now():+new Date)-p>a.max_duration_ms);u++);alp.aC(a.snippetContNode,t);if(u<k)break a}for(;q.length>h.length;)if(c(),(Date.now?Date.now():+new Date)-p>a.max_duration_ms)break a;v=!1;break}f.ndisplayed.set(q.length);v&&alp.asyncF(a.max_duration_ms,"_updateView",a)()}function g(){var d=alp.map(this[e]||[],".snippetNode");2>d.length||(d=f.checkVisibleSameParent(d))&&this.m.visibleRange.set({min:d.first,max:d.last})}var f=alp.dom;alp.declare("alp.x.InfiSnippets",alp.x.InfiSnippetsModel,
null,{snippetCont:"alp-infisnippets-snippetcont",separatorTmpl:"alp-infisnippets-separator-tmpl",numberDisplay:"alp-infisnippets-number",zeroMsg:"alp-infisnippets-zero-msg",postProcess:null,snippetClass:"alp-infisnippets-snippet",separatorClass:"alp-infisnippets-separator",max_duration_ms:123,augmentModel:function(d){d.ndisplayed=new alp.NumberState},setInitVal:function(d,b,c,a){(d.snippetContNode=alp.nodify(d.snippetCont,d.contNode)).childNodes.a;if(b=d._spinner)b.setTarget(null),b.stop();b=alp.cE("div",
d.snippetContNode,{style:"height: 40px; width: 80px; margin: auto; padding: 24px;"});b=d._spinner=new alp.x.Spinner({targetInit:b});b.start();alp.forEach(["separatorTmpl","loadingTmpl","numberDisplay","zeroMsg"],function(a){(a=d[a+"Node"]=alp.nodify(d[a],d.contNode))&&a.childNodes.a});d.separatorTmplNode&&(d._separatorTmplHTML=d.separatorTmplNode.innerHTML);d.loadingTmplNode&&(d._loadingTmplHTML=d.loadingTmplNode.innerHTML);d._updateView=alp.ratelimitF(d.max_duration_ms,alp.nowF(h));d._viewCheckScroll=
alp.ratelimitF(2*d.max_duration_ms,alp.nowF(g,d))},connectModel2View:function(d,b,c,a){b.push(c.initData.change_cb("_updateView",this));b.push(c.snippets.change_cb_init("_updateView",this))},connectView2Model:function(d,b,c,a){d.sortSelectNode&&(c=alp.asyncF(10,k,null,d),b.push(alp.aEL(d.sortSelectNode,"click",c)));var e=alp.bindF("_viewCheckScroll",d);b.push(alp.aEL(window,"mousewheel",e));b.push(alp.aEL(d.snippetContNode,"mousewheel",e));b.push(setInterval(function(){var a=alp.gWindowScroll().top,
b=d.snippetContNode.scrollTop;if(a!==f||b!==g)f=a,g=b,e()},5*d.max_duration_ms),clearInterval);var f,g}});var e="_dom"})();"undefined"!==typeof dojo&&dojo.provide("alp.i.i_last_visited");
(function(){function k(c){var a=c.locstor_get()||[],d=c.m.arr_backend.get()||[],e={arr_storage:a,arr_backend:d};if(!alp.oEqual(e,c[b]))return c[b]=e,c=a.concat(alp.filter(d,"!(v in that)",alp.arr2oSimple(a))),alp.oCreateMix(e,{arr:c})}var h=alp.sub("alp.i",null,!0),g=alp.data;h.ILastVisited={arr_m2m:null,cont:"oax-recentlyViewed-wrapper",item:"oax-recentlyViewed-items",tmpl:"oax-recentlyViewed-tmpl",first:5,api_proj:null,api_userid:null,locstor_get:null,locstor_set:null,no_display:"oax_no_display",
_i_arr_m2m_connect:function(b,a){function c(a){b.arr_m2m(k(b,a)||null)}c();a.push(setInterval(alp.nowF(c),789),clearInterval)},_i_arr_m2v:function(){function b(b,c){alp.arrEqual(n,(k.get()||[]).slice(0,r))&&(v.innerHTML=alp.map(c,"alp.tmplJs(this.tmpl,v)",{tmpl:u}).join("\n"),a(!1))}function a(a){var b=h.no_display;b&&alp.setClass(p,b,a);alp.style(p,{display:a?"none":""})}var h=this,k=h.m.arr,r=h.first,n=(k.get()||[]).slice(0,r),q=h.api_proj,p=h[f]||(h[f]=alp.nodify(h.cont)),v=h[e]||(h[e]=alp.nodify(h.item,
p)),u=h[d]||(h[d]=alp.opt(alp.nodify(h.tmpl,p),"innerHTML")||'<div><a href="__location.host__/__alp.i18n.language()__/r/__data.id__"><img src="__data.category.iconUrl__"/><span>__data.title__</span></a></div>');(q&&u||null).substring.call.a;n&&n.length?(new g.OOIs({proj:q,idlist:n,acceptUnpublished:!0})).load(b):(alp.empty(v),a(!0))}};var f="_i_cont",e="_i_item",d="_i_tmpl",b="_last_arr_m2m_o"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.last_visited");
(function(){var k=alp.sub("alp.x",null,!0);alp.declare("alp.x.LastVisited",k.AbstractController,null,alp.i.ILastVisited,{augmentModel:function(h){h.arr_storage=new alp.SortedArrayState;h.arr_backend=new alp.SortedArrayState;h.arr=new alp.SortedArrayState},setInitVal:function(h,g,f,e){h._cont=alp.nodify(h.cont)},connectModel2Model:function(h,g,f,e){this._i_arr_m2m_connect(h,g)},connectModel2View:function(h,g,f,e){g.push(f.arr.change_cb_init(h._i_arr_m2v,h))},arr_m2m:function(h){if(h){var g=this.m;
g.arr_storage.set(h.arr_storage);g.arr.set(h.arr)}}})})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_invite_user");
(function(){function k(a,b){function c(a){if(200===a.status)e.done(a.responseJson);else throw Error(a.status+": "+a.statusText);}var d=b.q,e=alp.dfrd("autosuggest:user",{then:1});l.to(a.token(),function(b){b=p.url.api_search_user({proj:a.proj,q:encodeURIComponent(d),token:b});l.to(alp.xhrGet(b,{receiveJson:!0}),c)});return e}function h(a){var b=a.m,d=b.inputSt.get(),e=[],f=l.nowF(function(a,c){d===b.inputSt.get()&&l.set(a,b._loaded,{q:d,matches:e.concat(c.user||[])})});c(a,"email")&&d&&v.test(d)&&
e.push({email:d});c(a,"user")?l.to(k(a,{proj:a.proj,q:d.toLowerCase(),subset:a.subset}),f):f({})}function g(b,c){function d(d){var e="";if(!d.id&&d.email){var f=d.email;var g=b.m.emails.get();if(b.alreadyInvited[f]||g[f])e=f;else{g[f]=!0;l.set(c,b.m.emails,g);var h=f}}else f=d.forename+" "+d.lastname,g=b.m.userIds.get(),b.alreadyInvited[d.id]||g[d.id]?e=f:(g[d.id]=f,l.set(c,b.m.userIds,g),d.imgSrc=d.profileImage?p.url.imgthumb_from_id(d.profileImage.id,32,32):b.dfltImgUrl,h=alp.tmplJs('<a class="oax_pointer oax_font_dark" href="__oa.URL_SHORT_FROM_ID(data.id)__" target="_blank"><span class="oax_pad_right_10"><img class="oax_round" width="32px" height="32px" src="__data.imgSrc__" /></span><span>__data.forename__&nbsp;__data.lastname__</span></a>',
d));e&&l.to(a,function(a){q.show_exception_msg({message:alp.tmpl(alp.opt(a,"inviteUser.alreadyExists"),{name:e}),invalidField:b.exception},b.cont)});g=null;h&&(g=alp.cE("span",null,{"class":b.resultClass+" "+oa.ID+(d.id?" "+oa.ID_PREFIX+d.id:"")}),alp.cE("div",g,{"class":b.valueClass+" oax_fl"},{innerHTML:h}),alp.cE("span",g,{"class":b.closeIconClass}));return g}var f=b.m._selected.get();f&&(f.length||(f=[f]),alp.aC(b.results,alp.reduce(alp.map(f,d),"( w && v.appendChild( w ), v)",document.createDocumentFragment())),
b.clearAfterSelect&&e(b),l.setNow(b.m._selected,null))}function f(a,b,d){function e(b){b.id?(b.forename||(b.forename=b.email||""),b.lastname||(b.lastname=""),b.imgSrc=b.profileImage?p.url.imgthumb_from_id(b.profileImage.id,32,32):a.dfltImgUrl,b=alp.tmplJs('<div class="oax_fr oax_pad_right_10"><img class="oax_round" width="32px" height="32px" src="__data.imgSrc__" /></div><div class="oax_fl oax_title"><span>__data.forename__&nbsp;__data.lastname__</span></div><div class="oax_clear"></div>',b)):b=alp.tmplJs('<div class="oax_fr oax_pad_right_10 oax_icon_email"><span class="oax-icon-plus-alt"></span></div><div class="oax_fl oax_title">__data.email__</div><div class="oax_clear"></div>',
b);return b}function f(a){var b=g.length,c=a&&a.substring(0,b);return g&&a&&c&&g.toLowerCase()===c.toLowerCase()?"<strong>"+c+"</strong>"+a.substring(b):a}var g=a.m.inputSt.get(),h=a.m._loaded.get().matches||[],k=0===h.length;b=document.createDocumentFragment();var l=a.m.inputFocusSt.get();k?(a[u]=[],g&&c(a,"user")&&((h=0<g.indexOf("@"))||alp.cE("div",b,{"class":"oax_center oax_h2_deprecated"},{innerHTML:p.i18n_msg.autocomplete_cannot_find(d,g)}),alp.setClass(a.cont,a.showSuggestionsClass,!h&&l))):
(alp.forEach(a[u]=alp.map(a[t]=h,alp.chainF(e,f,'alp.cE( "div", null, { "class": "alp-x-clickable '+a.suggestionClass+'"}, { innerHTML : v })')),"this.appendChild(v)",b),alp.setClass(a.cont,a.showSuggestionsClass,l));alp.aC(alp.empty(a.output),b)}function e(a){l.setNow(a.m.inputSt,"");a.input.value="";a.input.blur()}function d(a,b){b||(b=window.event);if(a[u]&&a[u].length){var c=b.target||b.srcElement;b=alp.filter(a[t]||[],function(b,d){return alp.isDescendant(c,a[u][d])})[0];l.setNow(a.m._selected,
b||null)}}function b(a,b){b||(b=window.event);var c=b.target||b.srcElement;b=c;var d;if(alp.hasClass(c,a.closeIconClass)){for(;!alp.hasClass(b,oa.ID)&&(b=b.parentElement););(d=oa.ID_FROM_DOMNODE(b))?(c=a.m.userIds,a=d):(c=a.m.emails,a=alp.nodify(a.valueClass,b).innerText);d=c.get();delete d[a];l.setNow(c,d);alp.orphan(b)}}function c(a,b){return-1<a.subset.indexOf(b)}var a=alp.i18n.fetch("alp.all"),m=alp.data.api,l=alp.i.state,r=oa.util,n=r.spinner,q=r.community,p=alp.cfg,v=/^[a-zA-Z0-9.!#$%&*+\/=^?_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
alp.sub("oa.i",null,!0).IInviteUser={proj:null,input:null,token:alp.memM("token",function(){var a=alp.dfrd("user:token",{then:1});l.to(m.token(),function(b){a.done(b)});return a}),clearAfterSelect:!0,allowMultiple:!0,alreadyInvited:{},subset:"email,user",seperator:/[\s;,]/,contClass:"oax-iu-cont",inputClass:"oax-iu-input",outputClass:"oax-iu-suggestions",resultsClass:"oax-iu-results",exceptionClass:"oax-iu-exception",alreadyInvClass:"oax-iu-already-inv",alreadyInvTitleClass:"oax-iu-already-inv-title",
alreadyInvContClass:"oax-iu-already-inv-cont",suggestionClass:"oax-iu-suggestion",resultClass:"oax-iu-result",valueClass:"oax-value",closeIconClass:"oax-icon-cross-circular",showSuggestionsClass:"oax-iu-show-suggestions",hasResultsClass:"oax-iu-has-results",dfltImgUrl:"",inviteSelected:function(){function a(a,c){b.spinner.stopWait();if(200!==c.status)throw a="Inviting users failed ("+c.status+")",console.error(a,c),Error(a,c);var d=alp.opt(c,"responseJson");c=alp.opt(d,"msg");d="success"===alp.opt(d,
"status")?"oax-humane-success":"oax-humane-warning";e(b);l.set(a,b.m.emails,{});l.set(a,b.m.userIds,{});alp.empty(b.results);c&&alp.humane(c,{extraClass:d})}var b=this,d=b.m.emails.get(),f=b.m.userIds.get(),g=[];!alp.oIsEmpty(d)&&c(b,"email")?g.push(encodeURIComponent(alp.oKeys(d).join(","))):!c(b,"user")&&v.test(b.input.value)&&g.push(encodeURIComponent(b.input.value));!alp.oIsEmpty(f)&&c(b,"user")&&g.push(encodeURIComponent(alp.oKeys(f).join(",")));l.to(b.token(),function(c){c=alp.cfg.url.api_invite_user({token:c,
emails:g.join(",")});g.length&&(b.spinner.startWait(b.cont),l.to(alp.xhrGet(c),l.nowF(a)))})},getSelected:function(){var a={},b=this.m.emails.get(),d=this.m.userIds.get();!alp.oIsEmpty(d)&&c(this,"user")&&(a=alp.mix(a,d));!alp.oIsEmpty(b)&&c(this,"email")&&(a=alp.mix(a,b));return a},augmentModel:function(a){this.proj.substring.call.a;this.input.childNodes.length;this.spinner=n.create_spinner({setTimeout:!1});a.inputSt=l.stringState();a.inputFocusSt=l.boolState(!1);a._loaded=l.objectState();a._enter_later=
l.objectState();a._selected=l.state();a.userIds=l.objectState({});a.emails=l.objectState({});this.token()},augmentKids:function(a){function b(a,b,c,d,e,f){c.childNodes.a;d||(d="div");var g=a[b+"Class"];g.substring.call.a;a[b]||(a[b]=alp.gEBCN(g,c)[0]||alp.cE(d,c,alp.oCreateMix({"class":g},e),f))}/input$/i.test(this.input.tagName)?(alp.hasClass(this.input.parentNode,this.contClass)?this.cont=this.input.parentNode:(this.cont=alp.cE("div",null,{"class":this.contClass}),alp.place(this.cont,this.input,
"before"),alp.aC(this.cont,this.input)),b(this,"exception",this.cont,"div",{"class":this.exceptionClass+" oax_error_msg humane humane-inplace"}),alp.oIsEmpty(this.alreadyInvited)||(b(this,"alreadyInv",this.cont,"div"),b(this,"alreadyInvTitle",this.alreadyInv,"span",null,{innerHTML:"Bereits eingeladen: "}),b(this,"alreadyInvCont",this.alreadyInv,"span",null,{innerText:alp.o2arr(this.alreadyInvited,'typeof o[k] === "string" ? o[k] : k').join(", ")})),b(this,"results",this.cont),b(this,"output",this.cont)):
console.error("The given node is not an input field")},connectModel2Model:function(a,b,d,e){function f(){var b=d._loaded.get(),e=b.q;b=(b.matches||[])[0];if(e&&e===d.inputSt.get()&&e===d._enter_later.get()){var f;l.setNow(d._enter_later,null);c(a,"email")&&e&&a.seperator.test(e)&&(f=alp.filter(e.split(a.seperator),alp.chainF("v.trim()",alp.bindF("test",v))));f&&f.length?l.setNow(a.m._selected,alp.map(f,"{ email: v }")):b&&l.setNow(a.m._selected,b)}}b.push(l.chenInit(d.inputSt,l.nowF(function(a){d.inputSt.get()||
l.set(a,d._loaded,{q:"",matches:[]})})));b.push(l.chenInit(d.inputSt,alp.ratelimitF(231,alp.bindF(h,null,a))));b.push(l.chenInit(d.inputFocusSt,function(){var b=!d._loaded.get().q&&!(a[u]&&0<a[u].length);alp.setClass(a.cont,a.showSuggestionsClass,d.inputFocusSt.get()&&!b)}));b.push(l.chenInit(d._loaded,f));b.push(l.chen(d._enter_later,f));b.push(l.chen(d._selected,l.nowF(g,null,a)))},connectModel2View:function(b,c,d,e){b=alp.ratelimitF(211,alp.bindF("to",r,a,l.nowF(f,null,b)));c.push(l.chenInit(d._loaded,
b))},connectView2Model:function(a,c,f,g){var h=a.input;c.push(alp.aEL(a.input,"keyup input",function(b){alp.humane.remove();b||(b=window.event);var c=b.keyCode;c===alp.key.ESCAPE?e(a):(l.setNow(f.inputSt,h.value),c!==alp.key.ENTER&&","!==b.key||l.setNow(f._enter_later,f.inputSt.get()))}));c.push(alp.aEL(a.input,"focus blur",function(a){a||(a=window.event);alp.stopEvent(a);setTimeout(function(){l.setNow(f.inputFocusSt,"focus"===a.type)},200)}));c.push(alp.aELtouchup(a.output,alp.bindF(d,null,a)));
c.push(alp.aELtouchup(a.results,alp.bindF(b,null,a)))}};var u="_out_noli",t="_out_itli"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.invite_user");(function(){alp.declare("oax.x.InviteUser",alp.x.AbstractController,null,oa.i.IInviteUser,{})})();"undefined"!==typeof dojo&&dojo.provide("oa.util.link_target");
(function(){alp.sub("oa.util",null,!0).linkTargetChange=function(k,h){function g(f){var e=f.href||alp.gA(f,"href");e&&!/^#/.test(e)&&alp.sA(f,"target",h)}/^a$/i.test(k.tagName)?g(k):alp.forEach(alp.gEBTN("a",k),g)}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.list_map");
(function(){function k(a){return alp.filter(a.m.idlist.get().split(","),"")}function h(a){var b=a.mapNode;return((a=a.viewMapToggleNode)&&"radio"===a.type?a.checked:!0)&&0<b.clientHeight&&0<b.clientWidth}function g(a){function c(c,d){if(d&&d.length){var e=a.mapNode,f=a.isScrollwheelActive;c=b.bounds_from_xy(alp.map(d,'(v=v.geometry.split(",")),[parseFloat(v[0]),parseFloat(v[1])]'));var g=b.bounds2zoomcenter(c,e);oax.api.maps(function(b,c){var d=g.center,h=g.zoom,k=oa.cfg.cfg_flexview.fill_default_and_fix_backward_compatibility(a,
c);c={zoom:h,center:new c.LatLng(d.lat,d.lng),mapTypeId:alp.oGet(k,"maplayer.basemap.init"),mapTypeControlOptions:{mapTypeIds:alp.oGet(k,"maplayer.basemap.layer")},mapTypeControl:!1,scrollwheel:f};b=new b.Map(e,c);(new alp.x.MapLayerPanel({cfg:k,initNow:!0})).setMap(b);a[m].done(b)})}}if(!a[m]){a[m]=alp.dfrd("CE:map",{then:1});var d=k(a);(new f.OOIs({proj:a.proj,idlist:d,minimal:!0,acceptUnpublished:a.acceptUnpublished})).load(c)}return a[m]}var f=alp.data,e=alp.content,d=alp._gmap2_3,b=alp.maps,
c=oa.util,a={};alp.declare("oax.x.ListMap",alp.x.AbstractController,null,{proj:null,id:null,mapNode:null,m_input:null,viewMapToggleNode:null,acceptUnpublished:!0,linkTarget:null,isScrollwheelActive:!0,augmentModel:function(b){b.idlist=new alp.StringState({constrain_def:function(b,c){b=(""+b).split(",");var d=c.split(","),e;for(e in b)e in a||0>c.indexOf(b[e])&&d.push(b[e]);return d.join(",")}});this.m_input&&alp.mixCheck(this.m,this.m_input)},augmentKids:function(a){this.mapNode&&(a.clusterLayer=
new d.ClusterLayer({proj:this.proj,initDataPointList:k(this),fitDataBounds:!0,defaultIW:!1,acceptUnpublished:this.acceptUnpublished}))},connectModel2View:function(a,b,c,d){function e(){d.clusterLayer.setDataPointList(k(a))}d.clusterLayer&&b.push(c.idlist.change_cb_init(e))},connectPureView:function(a,b,d,f){function k(){function b(b){function c(){var c=alp.dom.isVisibleWithinViewport(b.getDiv());c&&!d&&e.track({proj:a.proj,id:a.id,aspect:"openOverlay",nocache:!0});!c&&d&&oax.api.trackDetail(a.id,
{nocache:!0});d=c}b!==alp.oGet(a,"_fullscreen.map")&&(alp.m(a._fullscreen,"disconnect"),a._fullscreen=new alp._gmap2_3.x.Fullscreen({map:b,initNow:!0,instruction_alert:!1}),a.eh.push(setInterval(c,324),clearInterval));var d}d.idlist.get()&&h(a)?(g(a).then(b),g(a).then(function(b){f.clusterLayer.setMap(h(a)?b:null)})):f.clusterLayer.setMap(null)}function l(b){function d(b){var d=a.linkTarget;d&&c.linkTargetChange(b,d)}var e=f.clusterLayer.getMap();e&&oax.iwOpenOOI(e,b.id,a.proj,{iwNodePostProcess:d})}
var m=a.viewMapToggleNode;a.mapNode&&(b.push(setInterval(k,456),clearInterval),b.push(d.idlist.change_cb(k)),m&&b.push(alp.aEL(m,"click",k)),k(),b.push(f.clusterLayer.listen("markerClick",l)))}});var m="_map_dfrd"})();"undefined"!==typeof dojo&&dojo.provide("oax.x.my");
(function(){function k(b,c){var d=c.id,e=oax.ID_FROM_DOMNODE(b);e&&((d||0).substring.call.a,new oax.x.OoiAdderBasket2({initNow:!0,cont:b,proj:c.proj,ooiid:e,userid:d}));return a.toursPostProcess(b,c)}function h(a,b){alp.setText(a,alp.isFiniteNumber(b)?b:"")}function g(a){this.m.idlist.setNow(a.join(","))}var f={},e=oax.util,d=oax.layout,b=oa.util,c=b.locstor,a=b.my,m=b.sestor;alp.i18n.fetch("alp.all").then(function(a){});alp.declare("oax.x.My",alp.x.AbstractController,null,{id:null,proj:null,myToursCtor:null,
myToursContNode:null,myToursExtraDisplayClass:"oax-myTours-number",myToursPostProcess:k,myToursMapClass:"oax-myTours-listmap-view",myCmsToursCtor:null,myCmsToursContNode:null,myCmsToursExtraDisplayClass:"oax-myTours-number",myCmsToursPostProcess:k,myCmsToursMapClass:"oax-myTours-listmap-view",purchasesCtor:null,purchasesContNode:null,purchasesExtraDisplayClass:"oax-purchases-number",purchasesPostProcess:k,purchasesMapClass:"oax-purchases-listmap-view",myCommentCtor:null,myCommentContNode:null,myCommentExtraDisplayClass:"oax-myComment-number",
myCommentPostProcess:function(a){oax.layout.lightbox_setup(a);return a},myConditionsCtor:null,myConditionsContNode:null,myConditionsExtraDisplayClass:"oax-myConditions-number",myConditionsPostProcess:function(b){b=a.addDeleteConfirm(b);var c=encodeURIComponent(location.href);alp.forEach(alp.arrChain(alp.map(alp.gEBCN(oax.URL_EDITCOND_CONT,b),"alp.Aps.call( alp.gEBTN( 'a', v ) )")),function(a){var b=alp.gA(a,"href");oax.URL_EDITCONDBACK_RX.test(b)||alp.sA(a,"href",b.replace(/(\?|$)/,"?condeditback="+
c+"&"))});oax.layout.lightbox_setup(b);return b},myConditionsMapClass:"oax-myConditions-listmap-view",userFavouriteSportsCtor:null,userFavouriteSportsContNode:null,myTourCommentCtor:null,myTourCommentContNode:null,myTourCommentExtraDisplayClass:"oax-myTourComment-number",myTourCommentPostProcess:function(a){oax.layout.lightbox_setup(a);return a},myBasketCtor:null,myBasketContNode:null,myBasketExtraDisplayClass:"oax-myBasket-number",myBasketPostProcess:function(a,b){alp.dom.anchor.wrap_ooi_snippet(a);
return b.kx.basket.postProcessSnippet(a)},myBasketGetId:function(a){return(a=alp.gEBCN("oax-myBasket-id",a)[0])&&a.value},viewMapToggleClass:"oax-view-map",userChroniclesContNode:null,userChroniclesInitLength:10,userChroniclesStep:10,slideListContClass:"oax-slide-list-cont",inviteUserInput:"oax-iu-input",inviteUserSubmit:"oax-iu-submit",snippetConfirmDelete:"oax-confirm-delete","alp.x.InfiSnippets:initLength":20,"alp.x.InfiSnippets:step":10,"alp.x.MoreSnippets:initLength":3,"alp.x.MoreSnippets:step":3,
augmentModel:function(a){},augmentKids:function(a){function b(b){var c=alp.nodify(h[b+"MapClass"]),d=c&&alp.nodify(oax.MAP_DETAIL,c),e=null;c&&d&&(e=a[b+"Map"]=new oax.x.ListMap({proj:h.proj,id:w+"_"+b,mapNode:d,viewMapToggleNode:alp.nodify(h.viewMapToggleClass,c),initNow:!0}));return e}if(!this.id)throw Error("oax.x.My requires an id. Got instead: "+this.id);if(!this.proj)throw Error("oax.x.My requires a proj. Got instead: "+this.proj);var d=alp.nodify(alp.x.LastVisited.prototype.cont),h=this;d&&
(a.lastVisited=new alp.x.LastVisited({cont:d,api_userid:this.id,api_proj:this.proj,locstor_get:c.last_visited_get,locstor_set:c.last_visited_set}));d=alp.nodify(h.inviteUserInput);var k=alp.nodify(h.inviteUserSubmit);d&&k&&(a.inviteUser=new oax.x.InviteUser({input:d,proj:h.proj,subset:"email",initNow:!0}),alp.aEL(k,"click",alp.bindF("inviteSelected",a.inviteUser)));m.profile_saved_alert_apply();e.installLazyLoad_specific({cont:alp.body(),where:"authorpage"+(this.id?"-"+this.id:""),oax_lazy_onload:function(a){alp.forEach(a.snippets,
function(a){var c=null,d=b(a.prefix);a.m.idList?c=a.m.idList:a.m.data&&(c=a.m.data);c&&d&&c.change_cb_init(alp.nowF(g,d))})}});if(d=alp.nodify(this.slideListContClass))a.slideList=new alp.x.SlideList({cont:d,invisibleClass:"oax_inactive"});for(var l in this)if(!(l in f)&&(k=l.match(/^(.*)ContNode$/))&&(d=this[l])&&(k=k[1],!a[k])){var u=this[k+"GetId"],t=this.id,w=this.id;u&&(t=u(d));u=alp.x.MoreSnippets;var x=alp.x.InfiSnippets;u=this[k+"Ctor"]||(alp.nodify(u.prototype.snippetCont,d)?u:x);x=u.prototype.declaredClass;
a[k]=new u({contNode:d,proj:this.proj,id:t,prefix:k,initLength:this[k+"InitLength"]||this[x+":initLength"],step:this[k+"Step"]||this[x+":step"],postProcess:this[k+"PostProcess"]});b(k);"myBasket"===k&&(d={proj:this.proj,userid:w,basketid:alp.gEBCN("oax-myBasket-name")[0].value,topCont:alp.nodify("oax-basket-cont")},a[k].kx.basket=new oax.x.Basket(d))}},setInitVal:function(a,b,c,e){b=a._extraDisplay={};for(var g in e)g in f||(e=(e=a[g+"ExtraDisplayClass"])&&alp.gEBCN(e)||[],b[g]=e);d.delayedImages()},
connectModel2View:function(a,b,c,d){for(var e in d)if(!(e in f)){c=d[e];var k=a._extraDisplay[e],l=d[e+"Map"];c&&k.length&&b.push(c.m.nfull.change_cb_init(alp.bindF(h,null,k)));c&&l&&(k=null,c.m.idList?k=c.m.idList:c.m.data&&(k=c.m.data),k&&b.push(k.change_cb_init(alp.nowF(g,l))))}}})})();"undefined"!==typeof dojo&&dojo.provide("oax.mypage");
(function(){alp.declare("oax.MyPage",null,alp.nowF(function(k){alp.mixCheck(this,k)}),{id:null,proj:null,myToursCont:"oax-myTours-cont",myCmsToursCont:"oax-myCmsTours-cont",purchasesCont:"oax-purchases-cont",myCommentCont:"oax-myComment-cont",myConditionsCont:"oax-myConditions-cont",userFavouriteSportsCont:"oax-userFavouriteSports-cont",myTourCommentCont:"oax-myTourComment-cont",myBasketCont:"oax-myBasket-cont",userChroniclesCont:"oax-userChronicles-cont",initASAP:function(){var k=this;alp.onDCL(function(){k.my=
new oax.x.My({id:k.id,proj:k.proj,myToursContNode:alp.nodify(k.myToursCont),myCmsToursContNode:alp.nodify(k.myCmsToursCont),purchasesContNode:alp.nodify(k.purchasesCont),myCommentContNode:alp.nodify(k.myCommentCont),myConditionsContNode:alp.nodify(k.myConditionsCont),userFavouriteSportsContNode:alp.nodify(k.userFavouriteSportsCont),myTourCommentContNode:alp.nodify(k.myTourCommentCont),myBasketContNode:alp.nodify(k.myBasketCont),userChroniclesContNode:alp.nodify(k.userChroniclesCont),initNow:!0})})}})})();
"undefined"!==typeof dojo&&dojo.provide("oax.x.list");
(function(){var k=oax.community_layout,h=oa.util,g=oax.util,f=oa.util.community,e=alp.view.modalwin;alp.declare("oax.x.List",alp.x.AbstractController,null,{id:null,proj:null,cont:null,linkTarget:null,isScrollwheelActive:!0,viewMapToggleNode:null,mapNode:null,deleteNode:null,favBtnNode:null,shareBtnNode:null,embedDialogOpen:"oax-embed-action",snippetShareBtnClass:null,augmentModel:function(a){var e=this[d]=this.cont.children,f=this[b]=alp.map(e,"v.className.match(oa.ID_RX)[1]");this[c]=alp.arr2oSimple(f,
"this[i]",e);a.idlist=new alp.StringState({init_value:f.join(",")})},augmentKids:function(a){function b(a){return a&&(a instanceof Array||!a.childNodes)&&0===a.length?null:a}var d=this,e=d.mapNode,f=d.linkTarget,k=d.isScrollwheelActive;e&&(a.collmap=new oax.x.ListMap({proj:d.proj,id:d.id,mapNode:e,viewMapToggleNode:d.viewMapToggleNode,m_input:{idlist:d.m.idlist},linkTarget:f,isScrollwheelActive:k}));f&&h.linkTargetChange(d.cont,f);alp.forIn(d[c],function(b,c){g.basket_add_or_login(b,{proj:d.proj,
ooiid:c,from_list:d.id});var e=d.snippetShareBtnClass;(b=e&&alp.nodify(e,b))&&(a["snippet_"+c+"_sharebtn"]=new oax.x.ShareBtn({proj:d.proj,node:b}))});b(d.favBtnNode)&&(a.favbtn=new oax.x.FavBtn({proj:d.proj,node:d.favBtnNode,contentid:d.id}));if(e=b(d.shareBtnNode))a.sharebtn=new oax.x.ShareBtn({proj:d.proj,node:e,track_type:oa.LIST})},connectView2Model:function(a,b,c,d){function g(b){alp.stopEvent(b);b=a.id;var c=k.get_user_id();b&&c&&oa.i.IBasket.deleteList({proj:a.proj,listid:b,basketid:b,userid:c})}
function h(){var b=alp.gEBCN("oax-hidden-embed-dialog")[0];e.open({html:b.innerHTML,onOpenNow:function(b){new oax.x.EmbedDialog({top:b,id:a.id,initNow:!0})},width:1050,height:850})}(c=a.deleteNode)&&b.push(alp.aEL(c,"click",g));f.generic_login_barrier_after({type:"oax-embedDialog."+a.id},h);oax.community_layout.login_install({eh:b});b.push(alp.aEL(alp.gEBCN(a.embedDialogOpen),"click",h))}});var d="_snilist",b="_idarr",c="_id2sni"})();"undefined"!==typeof dojo&&dojo.provide("alp.i.i_snippets");
(function(){alp.sub("alp.i",null,!0).ISnippets={install:function(h,g,f){g.childNodes.a;h.length&&h[0].call.a;var e=[];alp.forEach(h,function(d){var b=d.prototype.snippetCont;(b||null).substring.call.a;alp.forEach(alp.gEBCN(b,g),function(b){var a=alp.dataset(b);a[k]||(a[k]=!0,b=b.parentNode,a=alp.filterIn(alp.oFrom(alp.opt(alp.nodify("alp-x-snippet-cfg",b),"value"))||{},""),b=alp.oCreateMix(f,alp.filterIn(alp.mix({contNode:b,initNow:!0},a),"w in this",d.prototype)),b=new d(b),e.push(b))})});return e}};
var k="alp_x_snippet_x_done"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.snippets");(function(){alp.sub("alp.x",null,!0).install_snippet_x=function(h,g){return alp.i.ISnippets.install(k,h,g)};var k=[alp.x.MoreSnippets,alp.x.InfiSnippets]})();"undefined"!==typeof dojo&&dojo.provide("oax.util.lazy_load_specific");
(function(){function k(b,a){var c=alp.cE("div",a.node,{style:"height: 40px; width: 80px; margin: auto; padding: 24px;"});a.sp=new alp.x.Spinner({targetInit:c});a.sp.start();return e.installLazyLoad.loadPathPrepare(b,a)}function h(c){function a(a){b.lightbox_setup(a);g.wrap_ooi_snippet(a);var c=alp.gEBCN("oax-purchase-indent",a);alp.aEL(c,"click",function(){var b=oax.ID_FROM_DOMNODE(a);d.track({proj:oa.API_CFG.proj,id:b,aspect:"PurchaseIndent"})},!0);return a}c.sp.setTarget(null);c.sp.stop();e.installLazyLoad.onload(c);
e.translate.setup(c);g.wrap_ooi_snippet(c.node,{filterHrefId:!1});b.webappteaser_setup(c.node);alp.x.SlideList.install({cont:c.node,postProcess:a});b.installRegionTeaser(c.node);b.lightbox_setup(c.node);c.snippets=alp.x.install_snippet_x(c.node,{proj:oa.API_CFG.proj,postProcess:a});alp.m(this,"oax_lazy_onload",c)}var g=alp.dom.anchor,f=alp.sub("oax.util",null,!0),e=oa.util,d=alp.content,b=oax.layout;f.installLazyLoad_specific=function(b){b||(b={});b.loadPathPrepare=k;b.onload=alp.bindF(h,b);e.installLazyLoad(b)}})();
"undefined"!==typeof dojo&&dojo.provide("oax.list_page");
(function(){var k=oax.util,h=alp.dom,g=h.anchor,f=oa.util;alp.declare("oax.ListPage",null,alp.nowF(function(e){alp.mixCheck(this,e);alp.oCheckScheme(this,'alp.and(["id","proj"],"v&&\'string\'===typeof v")')}),{id:null,proj:null,idlistClass:"oax-list-idlist",linkTarget:null,isScrollwheelActive:!0,titleClass:"oax-list-title",descriptionClass:"oax-list-description",primaryImageContClass:"oax-community-header-bg-container",favBtnClass:oa.FAV_BTN,shareBtnClass:oa.SHARE_BTN,privateSelectClass:"oax-list-private-select",
publishClass:"oax-list-publish",deleteClass:oa.DELETE_LIST,viewMapToggleClass:oa.TOGGLE_MAP,mapClass:"map_canvas",snippetOrderClass:"oax-snippet-order",snippetViewContClass:oa.VIEW_LIST_CONT,ContClass:"oax-referenceItems-container",TmplClass:"oax-list--tmpl",initASAP:function(){function e(){return!!alp.qS(".oax-load-path-towaitfor",a)}function d(){if(!m){var a=alp.nodify(c.mapClass);return a&&h.isVisibleWithinViewport(a)}}function b(b){m||(b=alp.nodify("oax-referenceItems-container",a))&&!e()&&(m=
!0,g.wrap_ooi_snippet(a),c.coll=new oax.x.List({id:c.id,proj:c.proj,cont:b,linkTarget:c.linkTarget,isScrollwheelActive:c.isScrollwheelActive,viewMapToggleNode:alp.nodify(c.viewMapToggleClass),mapNode:alp.nodify(c.mapClass),deleteNode:alp.nodify(c.deleteClass),favBtnNode:alp.gEBCN(c.favBtnClass),shareBtnNode:alp.gEBCN(c.shareBtnClass),snippetShareBtnClass:c.shareBtnClass,initNow:!0}),(b=c.linkTarget)&&f.linkTargetChange(a,b))}var c=this,a=alp.body();alp.onDCL(function(){e()?k.installLazyLoad_specific({cont:a,
where:"listpage",oax_lazy_onload:b,onscrollAlsoCheck:d}):b({node:alp.nodify("oax-referenceItems-container",a)})});var m}})})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.link_to_leave_page");(function(){alp.sub("alp.dom",null,!0).gLinkToLeavePage=function(k){var h=/^[^#]+/;return alp.filter(alp.gEBTN("a",k),function(g){return h.test(g.href)&&h.test(g.getAttribute("href"))&&"_blank"!==alp.gA(g,"target")})}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_list_edit");
(function(){function k(a){return(a=a.titleNode)&&a.value||""}function h(a){return(a=a.descriptionNode)&&a.value||""}function g(a){var b=a.privateSelectNode,c=b&&b.value;a=a.publishNode;return b&&a?null.bug:a?!1:b?"public"===c?!0:"private"===c?!1:null.bug:!1}function f(b,d,e){function f(c){if(200!=c.status&&!/^ok$/i.test(c.statusText)){var e="list_edit: Failed to get! Received: "+c.status+' "'+c.statusText+'"';setTimeout(function(){throw Error(e);});a(b,e)}else if(g===d._saved_snippetorder.get()){var f=
c.responseJson||alp.oFrom(c.responseText);alp.now(function(a){r.set(a,d.ordered_idlist,alp.filter((f.sortedIds||"").split(","),""))})}}var g=d._saved_snippetorder.get(),h="manually"===g&&d._saved_idlistmanual.get();h?r.set(e,d.ordered_idlist,h):r.to(c(b),f)}function e(a,b,c){var d={};alp.forIn(b,function(a,c){var e=v.exec(c);e&&(c=e[1],a=a.get(),e=b["_saved_"+e[1]].get(),a!==e&&(d[c]=1))});r.set(c,b.differenceSet,d)}function d(c,d,e){function f(b){b=m(b);"sortedIds"in b&&delete b.sortedIds;var e,
f,g,k,n,p=d._current_title.get();!p&&c.template&&(p=c.template);b.title=e=p;b.description=f=d._current_description.get();b.item=alp.map(alp.filter((g=d._current_idlistmanual.get()).split(","),""),"{id:v}");b.sortBy=k=d._current_snippetorder.get();alp.oSet(b,"meta.workflow.state",(n=d._current_is_public.get())?"published":"new");b=l.basketUpdate(alp.oCreateMix(b,alp.sub({proj:"proj",userid:"userid",basketid:"id"},c)));r.to(b,function(b){alp.now(function(l){if(200==b.status||/^ok$/i.test(b.statusText))h.title&&
r.set(l,d._saved_title,e),h.description&&r.set(l,d._saved_description,f),h.idlistmanual&&r.set(l,d._saved_idlistmanual,g),h.snippetorder&&r.set(l,d._saved_snippetorder,k),h.is_public&&r.set(l,d._saved_is_public,n);else{var m="list_edit: Failed to save! Received: "+b.status+' "'+b.statusText+'"';setTimeout(function(){throw Error(m);});a(c,m)}r.set(l,d.savingSet,alp.filterIn(d.savingSet.get(),"!(w in this)",h));alp.m(c,"displayChangeSavedMsg");l=c.changeSavedEvt();alp.Later?alp.now.trigger(l):l.triggerSoon()})})}
var g=alp.oDelta(d.differenceSet.get(),d.savingSet.get()).add;if(g.length){var h=alp.mix({},d.savingSet.get(),alp.arr2oSimple(g));r.set(e,d.savingSet,h);r.to(b(c),f)}}function b(a){return a._backend_last_get||(a._backend_last_get=l.basketGet(alp.mix(alp.opt(a,["proj","userid"]),{basketid:a.id})))}function c(a){return l.basketGet(alp.mix(alp.opt(a,["proj","userid"]),{basketid:a.id,sortBy:a.m._saved_snippetorder.get()}))}function a(a,b){a[t]||(a[t]=!0,alert(b))}function m(a){return alp.oCopy(a.responseJson)||
alp.oFrom(a.responseText)}var l=alp.data.api,r=alp.i.state,n=oa.util.community,q=oa.ga_track_anonymous,p=alp.view.modalwin;alp.sub("oa.i",null,!0).IListEdit={SESTO_JUST_PUBLISHED:"_just_published",editContNode:null,editTmplNode:null,titleNode:null,descriptionNode:null,privateSelectNode:null,publishNode:null,snippetOrderNode:null,displayChangeSavedMsg:null,changeSavedEvt:alp.memM("changeSavedEvt",'alp.event("ILE:changeSavedEvt",{then:1})'),augmentModel:function(a){alp.and(["userid","id","proj"],"(this[v]||null).substring.call.a",
this);alp.and(["editContNode","editTmplNode"],"(this[v]||null).childNodes.a",this);if(this.userid!==n.get_user_id())throw Error('list_edit: userid mismatch: "'+this.userid+'" != "'+n.get_user_id()+'"');a._saved_title=r.stringState(k(this));a._saved_description=r.stringState(h(this));a._saved_is_public=r.boolState(g(this));a._saved_idlistmanual=r.stringState(null);var b=this.snippetOrderNode,c=b?b.value:"manually";b=b?alp.map(alp.gEBTN("option",b),'alp.gA(v,"value")'):[c];a._saved_snippetorder=r.modeState(b,
c);a._current_title=r.stringState(a._saved_title.get());a._current_description=r.stringState(a._saved_description.get());a._current_is_public=r.boolState(a._saved_is_public.get());a._current_idlistmanual=r.stringState(a._saved_idlistmanual.get());a._current_snippetorder=r.modeState(b,c);a.ordered_idlist=r.stringState();a.differenceSet=r.objectState({init_value:{}});a.savingSet=r.objectState({});a.leavingToUrl=r.stringState()},setInitVal:function(b){var d=this,f=d.m;e(d,f,b);r.to(c(d),function(b){function c(a){if(e){r.set(a,
f[y],e);r.set(a,f[z],e);var b=d.snippetOrderNode;b&&(b.value=e)}g&&(r.set(a,f[w],g),r.set(a,f[x],g))}if(200==b.status||/^ok$/i.test(b.statusText)){b=b.responseJson||alp.oFrom(b.responseText);var e=b.sortBy||"manually",g=(b=b.item)&&alp.map(b,".id").join(",");(e||g)&&alp.now(c)}else{var h="list_edit: Failed to get! Received: "+b.status+' "'+b.statusText+'"';setTimeout(function(){throw Error(h);});a(d,h)}})},connectModel2Model:function(a,b,c,g){alp.forIn(c,function(d,f){(v.test(f)||u.test(f))&&b.push(r.chen(d,
alp.bindF(e,null,a,c)))});g=alp.bindF(d,null,a,c);b.push(r.chen(c.differenceSet,g));b.push(r.chen(c.savingSet,g));alp.now(g);g=alp.bindF(f,null,a,c);b.push(r.chen(c._saved_idlistmanual,g));b.push(r.chen(c._saved_snippetorder,g))},connectPureView:function(a,c,d,e){function f(a){a=a.responseJson||alp.oFrom(a.responseText);r.to(alp.jsonp(alp.tmpl(oa.SHARE_AFTER_PUBLISH_MARKUP_JSONP_URL,{id:a.id,plugintype:oa.PLUGINTYPE}),{cache:!1}),function(a){a=(a=a&&a.answer)&&/^ok$/i.test(a.status)&&a.html;(a||null).substring.call.a;
p.open({html:a})})}c=alp.sessionStorage()||{};c._just_published&&(delete c._just_published,d._current_is_public.get()&&(r.to(b(a),f),q.emitCustomClick(q.DETAIL,"opened share dialog after publishing list")))},_leaving_to_url:function(a,b){function c(){location.href=A}if(A=b.leavingToUrl.get()||A)a._should_not_leave_yet()?C||(C=alp.m(a,"startWait"),setTimeout(c,6789)):location.href=A},_get_dataPointList:function(){return alp.filter((this.m._current_idlistmanual.get()||"").split(","),"")},_should_not_leave_yet:function(){var a=
this.m,b=this.kx.pic;return!alp.oEqual({},a.differenceSet._get_no_clone())||!alp.oEqual({},a.savingSet._get_no_clone())||b&&b.m.saving.get()},_read_title_from_DOM:k,_read_description_from_DOM:h,_read_is_public_from_DOM:g,_update_publish_button:function(){var a=alp.gEBCN("oax-state-info",this.editContNode),b=!1;a&&(b=alp.reduce(alp.map(a,'v.dataset.state === "published"'),"v || w",!1));this.publishNode&&alp.setClass(this.publishNode,oa.NO_DISPLAY,!a.length||!b)},startWait:null};var v=/^_current_(.+)$/,
u=/^_saved_(.+)$/,t="_showed_alert",w="_saved_idlistmanual",x="_current_idlistmanual",y="_saved_snippetorder",z="_current_snippetorder",A,C})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_content_search");
(function(){function k(a){function b(b,c){c=c.responseJson;var e=c.nitems||0,f=alp.nodify(a.searchResInfo,a.ovCont),h=alp.nodify(a.searchResCont,a.ovCont),k=alp.nodify(a.searchResNoCont,a.ovCont);alp.setClass(f,"oax_no_display",!0);alp.setClass(h,"oax_no_display",!e);alp.setClass(k,"oax_no_display",!!e);if(e){if(f=c.first,h=c.ids,e&&null!=f){k=h.length;for(var l=0<f?[].concat(a.m.resData.get()):[],m=0;m<k;m++)l[f+m]=h[m];d.set(b,a.m.resData,l);d.set(b,a.m.nfull,e);0===a.m.nindex.get()&&(a.m.cats.get()===
a.catsPreset?d.set(b,a.m.resCats,c.cats):g(a,c.cats[0]))}}else alp.nodify("oax-query-string",k).innerText=a.m.q.get(),d.set(b,a.m.resData,[]),d.set(b,a.m.resCats,[]),d.set(b,a.m.nfull,0),a._spinner.stopWait()}var c=a.m.nindex.get(),e=0===c?a.initLength:c+a.step;c=alp.cfg.url.api_search_more_snippets(a.m.cats.get(),a.proj,a.m.q.get(),c,e,!0,!0);a.ovCont&&(a._spinner.startWait(alp.nodify("oax_search_results",this.ovCont)),d.to(alp.xhrGet(c,{receiveJson:!0}),d.nowF(b)))}function h(a){var b=alp.nodify(a.searchResTabsClass,
a.ovCont),c=1<a.m.resCats.get().length?["all"]:[],e=alp.cE("div"),f=JSON.parse(alp.nodify("oax-tabTitles-hidden",a.ovCont).value);alp.empty(b);c.length&&(c=c.concat(a.m.resCats.get()),alp.forEach(c,function(c){var g=alp.tmplJs('<h2 class="oax_search_tab" data-cats="__data.cats__"><label>__data.title__</label></h2>',{title:f[c],cats:c});e.innerHTML=g;alp.aEL(e.firstChild,"click",alp.nowF(function(b){d.set(b,a.m.cats,"all"===c?a.catsPreset:c);d.set(b,a.m.nindex,0)}));alp.aC(b,e.firstChild)}),g(a,c[0]))}
function g(a,b){a=alp.nodify(a.searchResTabsClass,a.ovCont);a=alp.filter(alp.gEBCN("oax_search_tab",a),function(a){alp.setClass(a,"oax_active",!1);return a.dataset.cats===b});alp.setClass(a,"oax_active",!0)}function f(a){function b(a){var b=alp.tmplJs(g,a);b=alp.cE("div",f,null,{innerHTML:b});alp.aEL(b,"click",alp.bindF(d,null,a))}function d(b,d){alp.stopEvent(d||window.event);a.onContentSelected(d.currentTarget,b);c.close(a.mowi)}var e=a.m.resData.get(),f=alp.nodify(a.searchResDataClass,a.ovCont),
g=alp.nodify(a.searchSnippetTmpl,a.searchContainer).innerHTML;0===a.m.nindex.get()&&alp.empty(f);e=e.slice(a.m.nindex.get(),e.length);(new alp.data.OOIs({proj:this.proj,idlist:e})).load(function(c,d){a._data=d;alp.forEach(d,b);a._spinner.stopWait()})}function e(a){alp.setClass(alp.gEBCN(a.searchResMoreClass,a.ovCont),"oax_no_display",!(a.m.nfull.get()>a.m.resData.get().length))}var d=alp.i.state,b=oa.util.MultistepDialogHelper,c=alp.view.modalwin;d.to(alp.i18n.fetch("alp.all"),function(a){});alp.sub("oa.i",
null,!0).IContentSearch={proj:null,onContentSelected:null,dialogTitle:"",catsPreset:"",initLength:14,step:3,searchContainerClass:"oax-content-search-container",searchBtnClass:"oax-content-search-btn",searchCatsClass:"oax-content-search-cats",searchResTabsClass:"oax-search-result-tabs",searchResDataClass:"oax-search-result-data",searchResMoreClass:"oax-search-result-more",searchResInfo:"oax-search-info",searchResCont:"oax-search-cont",searchResNoCont:"oax-search-no-cont",searchDialogTmpl:"oax-content-search-tmpl",
searchSnippetTmpl:"oax-content-search-snippet-tmpl",additionalAutosuggest:!1,additionalAutosuggestClass:"oax-additional-autosuggest",initAdditionalAutosuggest:null,augmentModel:function(a){this.proj.substring.call.a;this.onContentSelected.call.a;this.searchContainer=alp.nodify(this.searchContainerClass);this.catsPreset=alp.nodify(this.searchCatsClass,this.searchContainer).value||"all";this._spinner=oa.util.spinner.create_spinner();a.q=d.stringState();a.cats=d.stringState(this.catsPreset);a.nindex=
d.intState(0);a.resCats=d.state([]);a.resData=d.state([]);a.nfull=d.intState(0)},connectModel2View:function(a,b,c,g){b.push(d.chen(c.q,k,null,a));b.push(d.chen(c.cats,k,null,a));b.push(d.chen(c.nindex,k,null,a));b.push(d.chen(c.resCats,h,null,a));b.push(d.chen(c.resData,f,null,a));b.push(d.chen(c.nfull,e,null,a))},connectView2Model:function(a,e,f,g){function h(a){function e(b,c,e){c=alp.nodify(a.searchResMoreClass,b);var g=alp.nodify("oax-searchform",b),k=alp.nodify("oax_searchbox",g);g.childNodes.length;
a.ovCont=b;alp.aEL(g,"submit",alp.bindF(alp.nowF(h),null,a));k&&k.focus();c&&alp.aEL(c,"click",alp.nowF(function(b){var c=a.m.nindex.get(),e=(0===c?a.initLength:a.step)+1;d.set(b,a.m.nindex,Math.min(a.m.nfull.get(),c+e));c>=a.m.nfull.get()&&alp.setClass(alp.gEBCN(a.searchResMoreClass,a.ovCont),"oax_no_display",!0)}));a.additionalAutosuggest&&f(e,b)}function f(c,d){d=alp.nodify(a.additionalAutosuggestClass,d);var e=alp.gEBTN("input",d)[0];e={proj:a.proj,node:e,storeValue:!1,onSelect:function(b){a.onContentSelected(null,
b);alp.view.modalwin.close(c)},initNow:!0};alp.setClass(d,oa.NO_DISPLAY,!1);a.initAdditionalAutosuggest(e);b.init_steps(d)}function g(b){a.ovCont=null;d.set(b,a.m.q,"")}function h(){var a=3===arguments.length,b=a?arguments[0]:null,c=a?arguments[1]:arguments[0],e=c.m;a=a?arguments[2]:arguments[1];alp.stopEvent(a||window.event);a.currentTarget.q.blur();d.set(b,e.q,a.currentTarget.q.value);d.set(b,e.cats,c.catsPreset);d.set(b,e.nindex,0)}var k=alp.nodify(a.searchDialogTmpl);if(k=k&&k.innerHTML)a.mowi=
c.open({html:k,title:a.dialogTitle,extraClass:"oax_content_search_dialog",onOpenNow:e,onCloseLater:alp.nowF(g)});else throw Error("dialog not found");}if(f=alp.nodify(a.searchBtnClass,a.searchContainer))a.dialogTitle=f.title,e.push(alp.aEL(f,"click",alp.bindF(h,null,a)))}}})();"undefined"!==typeof dojo&&dojo.provide("oax.where_ext");
(function(){function k(){this.kx.where.clear()}function h(a,b){var c=alp.sub("geometry.location",b),d=alp.sub("geometry.viewport",b);a.m.areaid.set(b?b.alpstein_id:"");c&&a.updateMap(c,d);a.clearOnSelect&&setTimeout(function(){a.kx.where.clear()},123)}function g(a,b){var c=alp.opt(b,"alpstein_id");if(c)a.m.areaid.set(c);else if(c=alp.opt(b,"geometry")){var d=c.location;c=alp.m(d,"lat");d=alp.m(d,"lng");a.m.areaid.set("POINT("+d+" "+c+")")}else a.m.areaid.set("");if("function"===typeof a.onSelect)a.onSelect(b);
a.clearOnSelect&&setTimeout(function(){a.kx.where.clear()},123)}var f=alp.i.state,e=alp.maps,d=alp._gmap2_3,b=alp.data,c={mapClass:"oax-where-map",getMapCont:alp.memM("getMapCont",function(){return this.mapClass?alp.nodify(this.mapClass,this.node):null}),initMap:function(){this.m.map=f.state()},bindMap:function(a){this.eh.push(this.m.map.bind_to(a))},buildMap:function(){var a=this;oax.api.maps(function(b,c){var d=a.getMapCont();c={center:new c.LatLng(48,12),zoom:8,mapTypeId:"oa_map",mapTypeControl:!1,
zoomControl:!1,scrollwheel:!1,disableDoubleClickZoom:!0,keyboardShortcuts:!1};d&&a.m.map.set(new b.Map(d,c))})},updateMap:function(a,b){var c=this,f=c.m.map.get();if(f){var g,h,k=e.bounds2zoomcenter(b||[g=a.lng(),h=a.lat(),g,h],f.getDiv());oa.api.maps(function(a,b){var e=k.center;a=Math.min(k.zoom,9);b=new b.LatLng(e.lat,e.lng);d.setView(f,b,a);c.m.marker?c.m.marker.setPosition(b):c.m.marker=d.marker_gen({map:f,position:b,clickable:!1})})}}},a={areaid:null,initLocation:!1,initAreaId:function(){this.m.areaid=
f.stringState(this.areaid)},fetchInitArea:function(){var a=alp.dfrd("IWAI_fetch_init_area",{then:1}),c=this.m.areaid.get();c?(new b.SingleOOI(c,{proj:this.proj})).load(alp.bindF("done",a)):a.done();return a},receiveInitArea:function(a){if(a){console.log("xxx _WOM_receive_area",a.data);this.m.areaid.set(a.data.id);this.kx.where.getInputTextSt().set(a.data.title+(a.data.category&&a.data.category.name?" ("+a.data.category.name+")":""));var b=(alp.opt(a.data,"bbox")||"").split(",");b=4==b.length?d.getViewportLocationFromString(b[0]+
" "+b[1]+","+b[2]+" "+b[3]):a.data.geometry;this.kx.where.m.placeSt.set({title:a.data.title,id:a.data.id,alpstein_id:a.data.id,categoryTitle:a.data.category.name,geometry:b})}else if(this.initLocation){a=alp.opt(this.input,"value");var c=alp.opt(this.inputHidden,"value");b=c&&c.match(/POINT \((.*)\)/)[1];a&&b&&(this.m.areaid.set(c),this.kx.where.m.placeSt.set({title:a,geometry:b}))}}};alp.declare("oax.WhereOnMap",alp.x.AbstractController,null,c,a,{node:null,proj:null,usePhoton:!0,subset:"poi,hut,lodging,skiresort,region",
clearOnSelect:!1,inptClass:"oax-where-input",clearClass:"oax-where-clear",stateClass:"oax-where-cont",clear:k,augmentModel:function(a){this.node.childNodes.length;this.proj.substring.call.a;this.initAreaId();this.initMap();this.buildMap()},augmentKids:function(a){var b=alp.opt(this,["node","proj","clearClass","usePhoton","subset"],!0);alp.hasClass(this.node,this.stateClass)||(b.node=alp.nodify(this.stateClass,this.node));a.where=new oax.x.WhereAlpstein(b);this.fetchInitArea&&this.fetchInitArea().then(alp.bindF("receiveInitArea",
this))},connectModel2Model:function(a,b,c,d){a.bindMap(d.where.m.mapSt)},connectModel2View:function(a,b,c,d){b.push(d.where.placeChangeCB(h,null,a))}});alp.declare("oax.WhereContent",alp.x.AbstractController,null,{storeValue:!0,contClass:"oax-where-cont oax_full",inputWrapperClass:"oax_input_with_icon oax_full",inputClass:"oax-where-input oax_input oax_input_large oax_input_full",inputHiddenClass:"oax-where-input-hidden",searchIconClass:"oax-where-search oax-icon-magnifier oax_input_icon oax_no_pointer_events",
clearIconClass:"oax-where-clear oax-icon-cross-circular oax_input_icon oax_input_icon_hover oax_pointer",buildDom:function(){function a(a,c,d,e,f,g){c.childNodes.a;e||(e="div");var h=b[a+"Class"].split(" ")[0];h.substring.call.a;if(!b[a]){var k=d?c.parentElement:c;alp.hasClass(k,h)?b[a]=k:b[a]=alp.gEBCN(h,k)[0]}b[a]||(b[a]=alp.cE(e,d?null:c,alp.oCreateMix({"class":b[a+"Class"]},f),g),d&&alp.place(b[a],c,d))}var b=this;/^input$/i.test(b.node.tagName)?(a("cont",b.node,"before"),a("inputWrapper",b.cont),
alp.aC(b.inputWrapper,b.node)):b.cont=alp.setClass(b.node,b.contClass,!0);b.storeValue&&a("inputHidden",b.cont,null,"input");a("input",b.inputWrapper,null,"input");a("searchIcon",b.inputWrapper);a("clearIcon",b.inputWrapper);b.input.required=b.input.required||b.inputHidden&&b.inputHidden.required},saveAreaIdInDom:function(){var a=this;a.storeValue&&a.eh.push(a.m.areaid.change_cb(function(){a.inputHidden.value=a.m.areaid.get()}))}},a,{node:null,proj:null,onSelect:null,usePhoton:!0,subset:"location",
clearClass:"oax-where-clear",clearOnSelect:!1,clear:k,augmentModel:function(a){this.node.childNodes.length;this.proj.substring.call.a;this.initAreaId()},augmentKids:function(a){var b=this;this.buildDom();var c=alp.opt(this,["node","proj","clearClass","usePhoton","subset"],!0);c.node=this.cont;c.getInputNode=function(){return b.input};c.initText=this.input.value;a.where=new oax.x.WhereAlpstein(c);this.fetchInitArea().then(alp.bindF("receiveInitArea",this))},connectModel2View:function(a,b,c,d){b.push(d.where.placeChangeCB(g,
null,a))},connectView2Model:function(a,b,c,d){a.saveAreaIdInDom()}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.content_search");(function(){alp.declare("oax.x.ContentSearch",alp.x.AbstractController,null,oa.i.IContentSearch,{initAdditionalAutosuggest:function(k){this.kx.autosuggest=new oax.WhereContent(k)}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.list_edit_snippets");
(function(){function k(d,g){function h(a){function b(a,b){function c(a,b){p.push(w.change_cb_init(function(){x||(x=!0,a.setNow(w.get()),x=!1)}));p.push(a.change_cb(k))}function k(){var a=alp.mapIn(q,".get()");if(!x){x=!0;var b=alp.orIn(a);w.setNow(b);x=!1}g.checkselect.setNow(a)}function n(a,b){var c=a&&a.id;if(c){(c||null).substring.call.a;var e=q[c]=new alp.BoolState;b=alp.tmplJs(u,a).replace("idPlaceholder",c);b=alp.cE("div",null,{"class":d.editIdPrefix+a.id},{innerHTML:b});var g=alp.nodify(d.editSnippetClass,
b);r[c]=b;alp.aEL(alp.gEBCN(d.snippetDeleteClass,b),"click",alp.bindF(alp.nowF(f),null,d,c));alp.aEL(alp.gEBCN("oax-action-select",b),"click",function(a){this.select()});var k=alp.nodify(d.snippetDraggerClass,b);k&&t.push(m.dnd(b,{clickable:k,xy_constrain:m.dnd.XY_CONSTRAIN_V,container:d.dndContainer}));(k=alp.nodify(d.snippetShareBtnClass,b))&&new oax.x.ShareBtn({proj:d.proj,node:k,initNow:!0,track_type:a.frontendtype});alp.styleform.init({cont:{input:alp.gEBTN("input",b)},oncheck_init:function(){return e}});
new oax.x.OoiAdderBasket2({proj:d.proj,ooiid:c,userid:d.userid,cont:b,initNow:!0});l.getNodeOrDfrd(a,{proj:d.proj,snippettype:"snippet"}).then(function(a){alp.aC(g,a)});alp.aC(v,b)}else alp.cE("div",v,null,{innerHTML:'Invalid id "'+h.split(",")[b]+'"'})}if(alp.arrEqual(h,g.ordered_idlist.get())){0<b.length&&(alp.setClass(alp.gEBCN("oax-snippet-cont-header"),oax.NO_DISPLAY,!1),a=alp.gEBCN("oax-empty-text"),alp.setClass(a,oax.NO_DISPLAY,!0),a.length&&alp.sA(a[0].parentNode,"class","oax_centered"));
alp.m(d._sni_eh,"clear");alp.m(d._sni_dndgrp,"destroyAll");var p=d._sni_eh=new alp.Eh,q=d._sni_check={},r=d._sni_node={},t=d._sni_dndgrp=m.dnd.group(),v=document.createDocumentFragment(),u=d.editTmplNode.innerHTML;alp.forEach(b,n);alp.aC(alp.empty(d.editContNode),v);var w=d.m.checkall_bs;w.setNow(!1);alp.forIn(q,c);t.movedEvt().then(alp.bindF(e,null,d,g));d.userChangeEvt().triggerSoon()}var x}var h=g.ordered_idlist.get();h&&(new c.OOIs({proj:d.proj,idlist:h,token:a,acceptUnpublished:!0})).load(b)}
g.ordered_idlist.get()!==b(d)&&a.token().thenSoon(h)}function h(a,b,c){alp.stopEvent(c||window.event);b=b.checkselect.get();alp.orIn(b)&&(a=new oax.x.Basket({proj:a.proj,userid:a.userid,basketid:oax.BASKETID_DEFAULT,topCont:a.cont}),b=alp.oKeys(alp.filterIn(b,"")).join(","),a.addToList(b))}function g(a,b,c){alp.stopEvent(c||window.event);b=b.checkselect.get();alp.orIn(b)&&(b=alp.oKeys(alp.filterIn(b,"")),b.length&&f(a,b.join(",")));a.m.checkall_bs.setNow();a.m.checkselect.setNow({})}function f(a,
b){a.m.checkall_bs.setNow();a.m.checkselect.setNow({});alp.forEach(b.split(","),function(b){b=a._sni_node[b];b.childNodes.a;alp.orphan(b)});a.userChangeEvt().triggerSoon();a.userDeleteEvt().triggerSoon(b)}function e(a,c){var d=b(a);c.ordered_idlist.setNow(d);a.userDraggedEvt().triggerSoon(d)}function d(a,b){a=a[q]||[];b.ordered_idlist.get()&&alp.orIn(b.checkselect._get_no_clone())?alp.rA(a,"disabled"):alp.sA(a,"disabled","disabled")}function b(a){return alp.map(a.editContNode.children,function(b){return alp.opt(b.className.match(a.editIdPrefixRx),
1)||""}).join(",")}var c=alp.data,a=c.api,m=alp.x,l=oax.snippet;alp.declare("oax.x.ListEditSnippets",alp.x.AbstractController,null,{proj:null,userid:null,editContNode:null,editTmplNode:null,id:null,m_input:null,editSnippetClass:"oax-list-item",editIdPrefix:"oax-list-itemid-",editIdPrefixRx:/(?:^|\s)oax-list-itemid-(\S+)(?:\s|$)/,snippetDeleteClass:"oax-confirm-delete",snippetShareBtnClass:oax.SHARE_BTN,snippetDraggerClass:"oax-list-snippet-dnd",snippetViewContNode:null,snippetViewCheckAll:"oax-list-check-all",
snippetViewSelToList:"oax-list-selection-to-list",snippetViewSelDelete:"oax-list-selection-delete",dndContainer:null,userChangeEvt:alp.memM("userChangeEvt",'alp.event("LES:userChangeEvt",{then:1})'),userDeleteEvt:alp.memM("userDeleteEvt",'alp.event("LES:userDeleteEvt",{then:1})'),userDraggedEvt:alp.memM("userDraggedEvt",'alp.event("LES:userDraggedEvt",{then:1})'),userAddedEvt:alp.memM("userAddedEvt",'alp.event("LES:userAddedEvt",{then:1})'),augmentModel:function(a){(this.proj||null).substring.call.a;
alp.and(["editContNode","editTmplNode"],"(this[v]||null).childNodes.a",this);a.ordered_idlist=new alp.StringState;this.m_input&&alp.mixCheck(a,this.m_input);a.checkall_bs=new alp.BoolState;a.checkselect=new alp.ObjectState},augmentKids:function(a){var b=this,c=this.snippetViewContNode,d=c&&alp.nodify(this.snippetViewCheckAll,c),e=alp.gEBCN("oax-content-search-container");if(d){var f=this.m.checkall_bs;alp.oSet(a,"call.m.is",f);alp.styleform.init({cont:{input:alp.gEBTN("input",d)},oncheck_init:function(){return f}})}c&&
(d=this[r]=alp.gEBCN(this.snippetViewSelToList,c),c=this[n]=alp.gEBCN(this.snippetViewSelDelete,c),this[q]=alp.Apc.call([],d,c));e.length&&(a.addContent=new oax.x.ContentSearch({proj:this.proj,onContentSelected:alp.nowF(function(a){a=oax.ID_FROM_DOMNODE(a);var c=b.m.ordered_idlist.get();c?0>c.indexOf(a)&&(c=c+","+a):c=a;b.m.ordered_idlist.set(c);b.userDraggedEvt().triggerSoon(c)})}))},connectModel2Model:function(a,b,c,d){b.push(c.ordered_idlist.change_cb(function(){c.checkall_bs.set()}))},connectModel2View:function(a,
b,c,e){b.push(c.ordered_idlist.change_cb_init(k,null,a,c));a=alp.bindF(d,null,a,c);b.push(c.checkselect.change_cb_init(a));b.push(c.ordered_idlist.change_cb(a))},connectView2Model:function(a,b,c,d){(d=a[r])&&b.push(alp.aEL(d,"click",alp.bindF(alp.nowF(h),null,a,c)));(d=a[n])&&b.push(alp.aEL(d,"click",alp.bindF(alp.nowF(g),null,a,c)))}});var r="_sv_sel_to_list",n="_sv_sel_delete",q="_sv_sel_buttons"})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.community_profile");
(function(){var k=alp.sub("alp.data.api.community_profile",null,!0),h=alp.data.api;k.upload_image_background=function(g){(g.proj||null).substring.call.a;(g.token||null).substring.call.a;(g.userid||null).substring.call.a;(g.images.image||null).splice.call.a;return alp.xhrPut(alp.cfg.url.api_write_community_image_background(g),{sendData:alp.util.json.stringify(h.imageFixAuthorSource(g.images)),receiveJson:!0})};k.upload_image_list_primary=function(g){(g.proj||null).substring.call.a;(g.token||null).substring.call.a;
(g.userid||null).substring.call.a;(g.primaryid||null).substring.call.a;(g.images.image||null).splice.call.a;return alp.xhrPut(alp.cfg.url.api_write_basket_image_primary(g),{sendData:alp.util.json.stringify(h.imageFixAuthorSource(g.images)),receiveJson:!0})};k.upload_image_meta=function(g){(g.token||null).substring.call.a;(g.id||null).substring.call.a;return alp.xhrPut(alp.cfg.url.api_write_image_meta(g),{sendData:alp.util.json.stringify(h.imageFixAuthorSource(g)),receiveJson:!0})};k.upload_image_profile=
function(g){(g.proj||null).substring.call.a;(g.token||null).substring.call.a;(g.userid||null).substring.call.a;(g.images.image||null).splice.call.a;return alp.xhrPut(alp.cfg.url.api_write_community_image_photo(g),{sendData:alp.util.json.stringify(h.imageFixAuthorSource(g.images)),receiveJson:!0})}})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.form");
(function(){alp.sub("alp.dom",null,!0).formSavePropToAttr=function(k){alp.forEach(alp.qSA("input,option",k),function(h){var g;(g="value")in h&&alp.sA(h,g,h[g]);if((g="checked")in h||(g="selected")in h)h[g]?alp.sA(h,g,g):alp.rA(h,g)});return k}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_my_image");
(function(){function k(a,e,f){function h(b,e,f){function h(c){var e=alp.nodify(a.metaFormClass,b),g=alp.filter(e.elements[a.metaAuthorRadio],"v.checked")[0].value,h=e.elements[a.metaAuthorCustom].value,k=alp.filter(e.elements[a.metaSourceRadio],"v.checked")[0].value;e=e.elements[a.metaSourceCustom].value;var l=alp.nodify(a.metaLicense,b).value;d.set(c,f.image_meta,{author:"custom"===g?h:"unknown",source:"custom"===k?e:"unknown",license:{id:l}})}function k(b){d.set(b,a.m.image_id,"<new>");d.set(b,
a.m.image,null);d.set(b,a.m.image_meta,null);d.set(b,a.m.saving,!0);f.close()}function l(b){var c=f.image_id.get();"<new>"===c&&(d.set(b,a.m.image_id,c),d.set(b,a.m.image,f.image.get()));d.set(b,a.m.image_meta,f.image_meta.get());d.set(b,a.m.saving,!0);f.close()}function m(a){d.setNow(f.image_meta,a)}f.image=d.state(a.m.exists.get()?a.m.image.get():null);f.image_id=d.state(a.m.exists.get()?a.m.image_id.get():null);f.image_meta=d.state(a.m.exists.get()?a.m.image_meta.get():null);d.chenInit(f.image,
function(){var c=f.image.get(),d=b,e=alp.nodify(a.imgPreviewCont,d);if(c){for(;(d=d.parentElement)&&!alp.hasClass(d,a.imgDialogClass););alp.setClass(d,a.existsClass,!!c);alp.empty(e);alp.cE("img",e,{src:c})}alp.m(a,"stopWait")});d.chenInit(f.image_meta,function(){function c(c,d){c||(c="");var e=a["meta"+d+"Radio"];d=a["meta"+d+"Custom"];alp.rA(alp.gEBCN(e,b),"checked");d=alp.nodify(d,b);c&&"unknown"!==c?(c=c&&c===alp.gA(d,"placeholder")?"":c,alp.sA(alp.qS("."+e+'[value="custom"]',b),"checked","checked")):
(c="",alp.sA(alp.qS("."+e+'[value="unknown"]',b),"checked","checked"));alp.sA(d,"value",c)}function d(a){var b=this.value;b&&b===alp.gA(a,"value")?alp.sA(a,"selected","selected"):alp.rA(a,"selected")}function e(a){alp.stopEvent(a);a.target.previousElementSibling.checked=!0}var g=f.image_meta.get();if(g){var h=g.author,k=g.source;g=alp.oGet(g,"license.id")||null;alp.forIn({Author:h,Source:k},c);(h=alp.nodify(a.metaLicense,b))&&alp.forEach(alp.gEBTN("option",h),d,{value:g||null});alp.aEL(alp.gEBCN(["oax-imageMeta-custom-author",
"oax-imageMeta-custom-source"],b),"focus",e)}"function"===typeof n&&(n(b),n=null)});c.init_steps(b);e=a._input_file_node=alp.gEBI(a.imgFileInput);alp.aEL(e,"change",function(){if("undefined"===typeof FileReader)alp.humane("Please use another browser for this action.");else{var b=a._input_file_node.files,c=b[0],e=new FileReader,g=c?c.name:" ";b.length&&(alp.nodify(a.imgNamePreview).innerHTML=g,e.onload=d.nowF(function(a,b){b||(b=window.event);d.set(a,f.image,(b.target||b.srcElement).result);d.set(a,
f.image_id,"<new>");d.set(a,f.image_meta,null)}),alp.m(a,"startWait",alp.nodify(a.imgPreviewCont)),e.readAsDataURL(c))}});(e=alp.nodify(a.imgMetaSaveBtn,b))&&alp.aELtouchup(e,alp.nowF(h));(e=alp.nodify(a.imgDeleteBtn,b))&&alp.aELtouchup(e,alp.nowF(k));(e=alp.nodify(a.imgDialogSaveBtn,b))&&alp.aELtouchup(e,alp.nowF(l));if(a.m.exists.get()&&!f.image_meta.get()&&"<new>"!==f.image_id.get()){var n=alp.opt(a,"initForm");d.to(g.api_image_meta({proj:a.proj,id:a.m.image_id.get()},!0),m)}else alp.m(a,"initForm",
b);a.m.exists.get()||a._input_file_node.click()}d.to(function(){var b=alp.dfrd("myim:dialog:html",{then:1}),c=alp.nodify(a.imgDialogTmpl);(c=c&&c.innerHTML)?b.done(c):b=alp.jsonp(oa.IMAGE_UPLOAD_DIALOG_JSONP_URL,{cache:!1});return b}(),function(c){if("object"===typeof c)if(c=c.answer,200===c.code)c=c.html,c=alp.cE("div",alp.body(),null,{innerHTML:c}),c=alp.nodify(a.imgDialogTmpl,c).innerHTML;else{console.error("Could not fetch imageUpload dialog");return}c&&b.open({html:c,onOpenNow:h,title:a._dialogTitle,
extraClass:a.imgDialogClass+(a.m.exists.get()?" "+a.existsClass:"")+("profile"===a.type?" "+a.roundPrevClass:"")})})}function h(){function a(a){var b=k.m.image.get()?g.format_image_file_2_api_obj(k.m.image.get()):null;a={proj:k.proj,token:a,userid:k.userid,images:{image:[b]}};b=k.listid;var f=k.type;b&&(a.primaryid=b,f="list_"+f);d.to(e["upload_image_"+f](a),d.nowF(c))}function b(a){var b=k.m.image_meta.get();d.to(e.upload_image_meta({id:k.m.image_id.get(),proj:k.proj,token:a,author:b.author,source:b.source,
license:b.license.id}),h)}function c(a,c){c=c.responseJson[k.type+"Image"];d.set(a,k.m.image_id,c?c.id:null);k.m.image_meta.get()?d.to(q,b):h()}function h(){alp.m(k,"stopWait");d.setNow(k.m.saving,!1)}var k=this;if(k.m.saving.get()){alp.m(k,"startWait",k.cont);var q=f.token();"<new>"===k.m.image_id.get()?d.to(q,a):k.m.image_meta.get()&&d.to(q,b)}}var g=alp.data,f=g.api,e=f.community_profile,d=alp.i.state,b=alp.view.modalwin,c=oa.util.MultistepDialogHelper;alp.sub("oa.i",null,!0).IMyImage={cont:null,
type:null,proj:null,userid:null,btnUpload:"oax-image-upload",btnChange:"oax-image-change",imgContainer:"oax-img-cont",imgDialogTmpl:"oax-image-upload-dialog-tmpl",existsClass:"oax-image-exists",roundPrevClass:"oax-image-round",imgDialogClass:"oax_image_upload_dialog",imgFileInput:"oax-image-upload-input",imgMetaSaveBtn:"oax-imageMeta-save",imgDeleteBtn:"oax-image-delete",imgDialogSaveBtn:"oax-image-done",imgNamePreview:"oax-image-name-input",imgPreviewCont:"oax-image-preview",metaFormClass:"oax-imageMeta-form",
metaAuthorRadio:"oax-imageMeta-radio-author",metaAuthorCustom:"oax-imageMeta-custom-author",metaSourceRadio:"oax-imageMeta-radio-source",metaSourceCustom:"oax-imageMeta-custom-source",metaLicense:"oax-imageMeta-edit-license",inExists:"oax-image-exists-state",inId:"oax-image-id-state",inDfltBg:"oax-image-default-url",inDTitle:"oax-image-dialog-title",startWait:null,stopWait:null,initForm:null,saveForm:null,getImage:function(){var a=this.m.image.get(),b=this.m.image_id.get(),c=this.m.image_meta.get(),
d=null;"<new>"===b?a&&(d=g.format_image_file_2_api_obj(a)):b&&(d={id:b});d&&c&&(d.author=c.author,d.source=c.source,d.license=c.license);return f.imageFixAuthorSource(d)},augmentModel:function(a){a.exists=d.boolState();a.image=d.state();a.image_id=d.stringState();a.image_meta=d.objectState();a.saving=d.boolState()},setInitVal:function(a){var b=this.m;this.cont.childNodes.a;(this.type||0).substring.call.a;(this.proj||0).substring.call.a;alp.forEach(["btnUpload","btnChange"],'this["_" + v]=alp.nodify(this[v], this.cont)',
this);var c=alp.nodify(this.inDfltBg,this.cont);this._inDfltBg=c?c.value:null;this._dialogTitle=(c=alp.nodify(this.inDTitle,this.cont))?c.value:null;c=this._inExists=alp.nodify(this.inExists,this.cont).value;this._inId=alp.nodify(this.inId,this.cont).value;var e=alp.gEBTN("img",this.cont)[0];this._inImg=e&&e.src;c=/^true$/i.test(c);d.set(a,b.exists,c);d.set(a,b.image_id,c?this._inId:null);d.set(a,b.image,c?this._inImg:null)},connectModel2Model:function(a,b,c,e){function f(a){d.set(a,c.exists,!(!c.image_id.get()||
!c.image.get()))}b.push(d.chen(c.image_id,alp.nowF(f)));b.push(d.chen(c.image,alp.nowF(f)));b.push(d.chen(c.image,alp.nowF(function(){var b=a.m.image.get(),c=alp.gEBTN("img",a.cont)[0];c?b?c.src=b:a._inDfltBg?c.src=a._inDfltBg:alp.orphan(c):(c=alp.nodify(a.imgContainer,a.cont),alp.cE("img",c,{src:b}))})));a.listid&&b.push(d.chen(c.saving,alp.nowF(h,a)))},connectModel2View:function(a,b,c,e){b.push(d.chenInit(c.exists,function(){var b=c.exists.get();alp.setClass(a.cont,a.existsClass,b)}))},connectView2Model:function(a,
b,c,e){a._btnUpload&&b.push(alp.aELtouchup(a._btnUpload,d.nowF(k,null,a)));a._btnChange&&b.push(alp.aELtouchup(a._btnChange,d.nowF(k,null,a)))}}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.my_image");
(function(){function k(h){return h._waitbox||(h._waitbox=new alp.x.Waitbox({targetInit:h.cont}))}alp.declare("oax.x.MyImage",alp.x.AbstractController,null,oa.i.IMyImage,{startWait:function(h){var g=k(this);g.setTarget(h);g.startWait()},stopWait:function(){var h=k(this);h.stopWait();h.setTarget()},initForm:function(h){alp.styleform.init({now:!0,cont:h})},saveForm:function(h){return alp.styleform.remove_from_html(alp.dom.formSavePropToAttr(h).innerHTML)}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.list_edit");
(function(){function k(d,b){var c=document.activeElement,a=d.titleNode,e=d.descriptionNode,f=d.privateSelectNode;a&&c!==a&&b._current_title.set(d._read_title_from_DOM(d));e&&c!==e&&b._current_description.set(d._read_description_from_DOM(d));f&&b._current_is_public.set(d._read_is_public_from_DOM(d))}function h(d,b,c,a){(c=c.href||alp.gA(c,"href"))&&d._should_not_leave_yet()&&(alp.stopEvent(a||window.event),b.leavingToUrl.set(c))}function g(d,b,c){if(d._should_not_leave_yet())return c||(c=window.event),
c&&(c.returnValue="   "),"   "}var f=alp.dom;alp.declare("oax.x.ListEdit",alp.x.AbstractController,null,oa.i.IListEdit,{userid:null,id:null,proj:null,template:null,primaryImageContNode:null,deleteNode:null,viewMapToggleNode:null,mapNode:null,snippetViewContNode:null,snippetViewPrefix:"oax-view-mode-",dndContainer:null,changeSavedMsg:"oax-change-saved",changeSavedMsgClass:"oax-humane-list oax-humane-success",displayChangeSavedMsg:function(){var d=this[e];d&&alp.humane(d,{extraClass:this.changeSavedMsgClass})},
augmentKids:function(d){d.snippets=new oax.x.ListEditSnippets(alp.mix(alp.opt(this,"proj userid editContNode editTmplNode snippetViewContNode id dndContainer".split(" ")),{m_input:alp.opt(this.m,["ordered_idlist"])}));var b=this.primaryImageContNode;b&&(d.pic=new oax.x.MyImage({cont:b,type:"primary",proj:this.proj,userid:this.userid,listid:this.id}));if(b=this.mapNode)d.collmap=new oax.x.ListMap({proj:this.proj,mapNode:b,viewMapToggleNode:this.viewMapToggleNode,m_input:{idlist:this.m._current_idlistmanual}});
d=alp.nodify(this.changeSavedMsg);this[e]=alp.opt(d,"innerHTML")},connectModel2View:function(d,b,c,a){function e(){h.setDataPointList(d._get_dataPointList())}function f(){var a=c._current_snippetorder.get(),b=v?[[p+v,!1]]:[];v=a;b.push([p+a,!0]);alp.setClass(k,b)}var g=alp.bindF(d._leaving_to_url,null,d,c);b.push(c.differenceSet.change_cb(g));b.push(c.savingSet.change_cb(g));b.push(c.leavingToUrl.change_cb(g));g();var h=a.clusterLayer;h&&b.push(c._current_idlistmanual.change_cb_init(e));var k=d.snippetViewContNode,
p=d.snippetViewPrefix;k&&p&&b.push(c._current_snippetorder.change_cb_init(f));var v},connectView2Model:function(d,b,c,a){function e(){c._current_snippetorder.set(p.value)}function l(){(alp.sessionStorage()||{})[d.SESTO_JUST_PUBLISHED]=!0;c._current_is_public.set(!0);c.leavingToUrl.set(location.href)}function r(a){alp.stopEvent(a||window.event);oa.i.IBasket.deleteList(alp.sub({proj:"proj",listid:"id",basketid:"id",userid:"userid"},d))}var n=alp.ratelimitF(63,alp.bindF(alp.nowF(k),null,d,c));b.push(setInterval(n,
867),clearInterval);var q=d.privateSelectNode;q&&b.push(alp.aEL(q,"click",n));alp.forEach([d.titleNode,d.descriptionNode],function(a){a&&alp.aEL(a,"blur",n)});b.push(a.snippets.userChangeEvt().thenSoon(alp.bindF("_update_publish_button",d)));b.push(a.snippets.userDeleteEvt().thenSoon(function(a){a=alp.arr2oSimple(a.split(","));c._current_idlistmanual.set(alp.filter(c._current_idlistmanual.get().split(","),"!(v in this)",a).join(","))}));b.push(a.snippets.userDraggedEvt().thenSoon(function(a){c._current_idlistmanual.set(a)}));
b.push(a.snippets.userAddedEvt().thenSoon(function(a){c._current_idlistmanual.set(a)}));var p=d.snippetOrderNode;p&&(a=alp.nowF(e),b.push(alp.aEL(p,"change",a)),b.push(alp.aEL(p,"click",a)));(a=d.publishNode)&&b.push(alp.aEL(a,"click",alp.nowF(l)));(a=d.deleteNode)&&b.push(alp.aEL(a,"click",r));alp.forEach(f.gLinkToLeavePage(),function(a){b.push(alp.aEL(a,"click",alp.bindF(alp.nowF(h),null,d,c,a)))});b.push(alp.aEL(window,"beforeunload",alp.bindF(g,null,d,c)))},startWait:function(){(new alp.x.Waitbox({targetInit:alp.body(),
delay_ms:123})).startWait();return!0}});var e="_change_saved_msg"})();"undefined"!==typeof dojo&&dojo.provide("oax.list_edit_page");
(function(){alp.declare("oax.ListEditPage",null,alp.nowF(function(k){alp.mixCheck(this,k);alp.oCheckScheme(this,'alp.and(["userid","id","proj"],"v&&\'string\'===typeof v")')}),{userid:null,id:null,proj:null,template:null,titleClass:"oax-list-title",descriptionClass:"oax-list-description",primaryImageContClass:"oax-community-header-bg-container",privateSelectClass:"oax-list-private-select",publishClass:"oax-list-publish",deleteClass:oax.DELETE_LIST,viewMapToggleClass:"oax-view-map",mapClass:"map_canvas",
snippetOrderClass:"oax-snippet-order",snippetViewContClass:"oax-view-list-cont",editContClass:"oax-referenceItems-container",editTmplClass:"oax-list-edit-tmpl",dndContainerClass:null,initASAP:function(){var k=this;alp.onDCL(function(){k.colledit=new oax.x.ListEdit({userid:k.userid,id:k.id,proj:k.proj,template:k.template,titleNode:alp.nodify(k.titleClass),descriptionNode:alp.nodify(k.descriptionClass),primaryImageContNode:alp.nodify(k.primaryImageContClass),privateSelectNode:alp.nodify(k.privateSelectClass),
publishNode:alp.nodify(k.publishClass),deleteNode:alp.nodify(k.deleteClass),viewMapToggleNode:alp.nodify(k.viewMapToggleClass),mapNode:alp.nodify(k.mapClass),snippetOrderNode:alp.nodify(k.snippetOrderClass),snippetViewContNode:alp.nodify(k.snippetViewContClass),editContNode:alp.nodify(k.editContClass),editTmplNode:alp.nodify(k.editTmplClass),dndContainer:alp.nodify(k.dndContainerClass),initNow:!0})})}})})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_author_edit");
(function(){function k(b,d){function e(){var a=b.authorEditForm;if(a){var c=alp.opt(a.nextURL,"value");c||(c=alp.opt(a.lastURL,"value"),c||(c=location.href))}location.href=c}function f(){var a=b.authorEditForm,c=b.kx,d=c.myProfileImage.getImage();c=c.myBackgroundImage.getImage();var e=b._get_birthday();a=alp.reduce(alp.filter(a,'!!v.name && v.type !== "checkbox"'),function(a,b){var c=b.name;b=b.value;-1<c.indexOf("[")&&(c=c.replace("[]",""),b=b.split(","));alp.oSet(a,c,b);return a},{});a.profileImage=
d||{id:null};a.backgroundImage=c||{id:null};a.birthday=e;alp.forEach(["l","i","lastURL","nextURL"],"delete this[v]",a);return a}alp.stopEvent(d);alp.forEach(["oax-favorite-activities","oax-favorite-regions","oax-outdoor-qualifications"],h);alp.m(b,"startWait");a.to(c.token(),function(c){c={proj:b.proj,token:c,userid:b.id};b.m.spinner.startWait(alp.body());a.to(alp.xhrPut(alp.cfg.url.api_write_user_data_full(c),{sendData:alp.util.json.stringify(f()),receiveJson:!0}),e)})}function h(a){var b="",c=alp.filter(alp.gEBCN(a),
"v.checked");a=alp.nodify(a+"-values");alp.forEach(c,function(a){b=0<b.length?b+","+a.value:a.value});a&&(a.value=b)}function g(a,b,c){if(b=b&&b.innerHTML)a.mowi=m.open({html:b,width:400,extraClass:"oax_user_form",onOpenNow:alp.Later?alp.bindF(c,null,a):alp.nowF(alp.bindF(c,null,a))});else throw Error("dialog not found");}function f(a,b,c,e){a.ovCont=b;var f=alp.nodify(a.activitiesSelCls,b);alp.aEL(f,"change",alp.bindF(function(a){var b=f.value,c=f.options[f.selectedIndex].text,g=alp.nodify(a.favoriteActivitiesNode),
h=alp.nodify(a.activitiesTmplNode);d(b,c,g,h,a.activitiesPrefCls);e.close()},null,a))}function e(a,b,c,e){a.ovCont=b;c=alp.gEBCN(a.qualificationsSelCls,b);alp.aEL(c,"change",alp.bindF(function(a){var b=this.value,c=this.options[this.selectedIndex].text,f=alp.nodify(a.outdoorQualificationsNode),g=alp.nodify(a.qualificationsTmplNode);d(b,c,f,g,a.qualificationsPrefCls);e.close()},null,a));var f=alp.nodify(a.countrySelCls,b);alp.aEL(f,"change",alp.bindF(function(a){if(a=f.value)alp.setClass(alp.gEBCN("oax-outdoor-qualifications-select"),
oa.NO_DISPLAY,!0),alp.setClass(alp.gEBCN("oax-outdoor-qualifications-"+a),oa.NO_DISPLAY,!1)},null,a))}function d(a,b,c,d,e){a&&((e=alp.gEBI(e+a))?e.checked=!0:(d=alp.tmplJs(d.innerHTML,{labelid:a,labeltxt:b}),a=alp.cE("div",null,null,{innerHTML:d}),alp.place(a,c.firstChild,"before"),c=alp.gEBTN("label",a)[0],c.offsetWidth,alp.setClass(c,"oax_label_new",!1)))}var b=alp.data,c=b.api,a=oa.util,m=alp.view.modalwin;alp.sub("oa.i",null,!0).IAuthorEdit={id:null,proj:null,activitiesSelCls:null,activitiesPrefCls:null,
countrySelCls:null,qualificationsSelCls:null,qualificationsPrefCls:null,authorEditForm:null,profileImageContNode:null,backgroundImageContNode:null,pika:null,whereNode:null,areaIdNode:null,clearNode:null,activitiesTmplNode:null,activitiesContTmplNode:null,favoriteActivitiesNode:null,favoriteActivitiesAddNode:null,qualificationsTmplNode:null,qualificationsContTmplNode:null,outdoorQualificationsNode:null,outdoorQualificationsAddNode:null,userFormNode:null,autosuggestSubset:"region",augmentModel:function(b){b.spinner=
a.spinner.create_spinner({setTimeout:!1})},connectView2Model:function(a,b,c,d){a.favoriteActivitiesAddNode&&b.push(alp.aEL(a.favoriteActivitiesAddNode,"click",alp.bindF(g,null,a,a.activitiesContTmplNode,f)));a.outdoorQualificationsAddNode&&b.push(alp.aEL(a.outdoorQualificationsAddNode,"click",alp.bindF(g,null,a,a.qualificationsContTmplNode,e)));b.push(alp.aEL(a.userFormNode,"submit",alp.bindF(k,null,a)))},_fetch_init_area:function(){var a=alp.dfrd("_oax_fetch_init_area",{then:1});(new b.SingleOOI(this.areaIdNode.value,
{proj:this.proj})).load(alp.bindF("done",a));return a},_on_place_change:function(a,b){b&&(a=a?"areaid":"alpstein_id",this.areaIdNode.value=b[a]?b[a]:"")},_where_clear:function(){this.areaIdNode.value=""},_dialog:g,_add_label:d,_get_birthday:null}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.author_edit");
(function(){function k(h,g,f,e){function d(b){var a=b?b.alpstein_id:"";b=b?b.name:"";var c=alp.nodify(h.favoriteRegionsNode),d=alp.nodify(h.regionsTmplNode);h._add_label(a,b,c,d,h.regionsPrefCls);e.close()}h.ovCont=g;f=alp.nodify(h.regionsContCls,g);var b=alp.nodify(h.regionsProjCls,g);alp.nodify(h.regionsInputCls,g);g=alp.nodify(h.regionsClearCls,g);f&&b&&(new oax.x.WhereAlpstein({node:f,proj:b.value,clearClass:g,usePhoton:!1,subset:h.autosuggestSubset,initNow:!0})).placeChangeCB(d,null)}alp.declare("oax.x.AuthorEdit",
alp.x.AbstractController,null,oa.i.IAuthorEdit,{id:null,proj:null,activitiesSelCls:null,activitiesPrefCls:null,regionsContCls:null,regionsProjCls:null,regionsInputCls:null,regionsClearCls:null,regionsPrefCls:null,countrySelCls:null,qualificationsSelCls:null,qualificationsPrefCls:null,profileImageContNode:null,backgroundImageContNode:null,pika:null,whereNode:null,areaIdNode:null,clearNode:null,activitiesTmplNode:null,activitiesContTmplNode:null,favoriteActivitiesNode:null,favoriteActivitiesAddNode:null,
regionsTmplNode:null,regionsContTmplNode:null,favoriteRegionsNode:null,favoriteRegionsAddNode:null,qualificationsTmplNode:null,qualificationsContTmplNode:null,outdoorQualificationsNode:null,outdoorQualificationsAddNode:null,userFormNode:null,augmentKids:function(h){function g(a){console.log("xxx _WOM_receive_area",a.data);f.where.getInputTextSt().set(a.data.title)}var f=this;this.profileImageContNode&&(h.myProfileImage=new oax.x.MyImage({cont:this.profileImageContNode,type:"profile",proj:this.proj,
userid:this.id}));this.backgroundImageContNode&&(h.myBackgroundImage=new oax.x.MyImage({cont:this.backgroundImageContNode,type:"background",proj:this.proj,userid:this.id}));if(this.pika){var e=this.pika.value?alp.str2date(this.pika.value,"{YYYY}-{MM}-{DD}"):"";h.birthday=new alp.x.Pikaday({field:this.pika,yearRange:[1900,2020],top_wrap:"oax",setDefaultDate:!0,defaultDate:e})}this.whereNode&&this.areaIdNode&&(this.where=new oax.x.WhereAlpstein({node:this.whereNode,proj:this.proj,usePhoton:!1,subset:f.autosuggestSubset,
closeOnMouseDown:!1,initNow:!0}),this.where.placeChangeCB(alp.bindF("_on_place_change",this,null),null),0<this.areaIdNode.value.length&&this._fetch_init_area().then(g),this.clearNode&&alp.aEL(this.clearNode,"click",alp.bindF("_where_clear",this)));var d=alp.sessionStorage();if(d&&d.oax_embedFromDp){h=alp.gEBCN("oax-next-url");e=alp.gEBCN("oax-cancel-lnk");var b=alp.gEBCN("oax-webAdress-node"),c=alp.gEBCN("oax-webaddress");d=d.oax_embedFromDp;h&&(h[0].value=d);e&&alp.sA(e,"href",d);if(b)alp.onDCL(function(){alp.dom.scrollToNode(b[0],
{onfinish:function(){c[0].focus()}})})}},connectModel2View:function(h,g,f,e){h.favoriteRegionsAddNode&&g.push(alp.aEL(h.favoriteRegionsAddNode,"click",alp.bindF("_dialog",this,h,h.regionsContTmplNode,k)))},_get_birthday:function(){var h=this.kx.birthday.getDate();h=alp.date2str(h,"{YYYY}-{MM}-{DD}");return"--"==h?"":h}})})();"undefined"!==typeof dojo&&dojo.provide("oax.author_edit_page");
(function(){alp.declare("oax.AuthorEditPage",null,alp.nowF(function(k){alp.mixCheck(this,k);alp.oCheckScheme(this,'alp.and(["id","proj"],"v&&\'string\'===typeof v")')}),{id:null,proj:null,authorEditFormClass:"oax-author-edit-form",profileImageCont:"oax-profileimage-container",backgroundImageCont:"oax-community-header-bg-container",pikaId:"oax-birthday",whereClass:"oax-where-cont",areaIdClass:"oax-where-areaid",clearClass:"oax-where-clear",activitiesSel:"oax-activities-sel",activitiesPref:"oax-activity-",
activitiesTmpl:"oax-favorite-activities-tmpl",activitiesContTmpl:"oax-favorite-activities-cont-tmpl",favoriteActivities:"oax-favorite-activities-cont",favoriteActivitiesAdd:"oax-favorite-activities-add",regionsCont:"oax-regions-free-cont",regionsProj:"oax-regions-proj",regionsInput:"oax-regions-free-input",regionsClear:"oax-regions-free-clear",regionsPref:"oax-region-",regionsTmpl:"oax-favorite-regions-tmpl",regionsContTmpl:"oax-favorite-regions-cont-tmpl",favoriteRegions:"oax-favorite-regions-cont",
favoriteRegionsAdd:"oax-favorite-regions-add",countrySel:"oax-country-sel",qualificationsSel:"oax-qualifications-sel",qualificationsPref:"oax-qualification-",qualificationsTmpl:"oax-outdoor-qualifications-tmpl",qualificationsContTmpl:"oax-outdoor-qualifications-cont-tmpl",outdoorQualifications:"oax-outdoor-qualifications-cont",outdoorQualificationsAdd:"oax-outdoor-qualifications-add",userForm:"oax_user_form",initASAP:function(){var k=this;alp.onDCL(function(){k.authoredit=new oax.x.AuthorEdit({id:k.id,
proj:k.proj,authorEditForm:alp.nodify(k.authorEditFormClass),profileImageContNode:alp.nodify(k.profileImageCont),backgroundImageContNode:alp.nodify(k.backgroundImageCont),pika:alp.gEBI(k.pikaId),whereNode:alp.nodify(k.whereClass),areaIdNode:alp.nodify(k.areaIdClass),clearNode:alp.nodify(k.clearClass),activitiesSelCls:k.activitiesSel,activitiesPrefCls:k.activitiesPref,activitiesTmplNode:alp.nodify(k.activitiesTmpl),activitiesContTmplNode:alp.nodify(k.activitiesContTmpl),favoriteActivitiesNode:alp.nodify(k.favoriteActivities),
favoriteActivitiesAddNode:alp.nodify(k.favoriteActivitiesAdd),regionsContCls:k.regionsCont,regionsProjCls:k.regionsProj,regionsInputCls:k.regionsInput,regionsClearCls:k.regionsClear,regionsPrefCls:k.regionsPref,regionsTmplNode:alp.nodify(k.regionsTmpl),regionsContTmplNode:alp.nodify(k.regionsContTmpl),favoriteRegionsNode:alp.nodify(k.favoriteRegions),favoriteRegionsAddNode:alp.nodify(k.favoriteRegionsAdd),countrySelCls:k.countrySel,qualificationsSelCls:k.qualificationsSel,qualificationsPrefCls:k.qualificationsPref,
qualificationsTmplNode:alp.nodify(k.qualificationsTmpl),qualificationsContTmplNode:alp.nodify(k.qualificationsContTmpl),outdoorQualificationsNode:alp.nodify(k.outdoorQualifications),outdoorQualificationsAddNode:alp.nodify(k.outdoorQualificationsAdd),userFormNode:alp.nodify(k.userForm),initNow:!0})})}})})();"undefined"!==typeof dojo&&dojo.provide("alp.view.timepicker");
(function(){alp.sub("alp.view.timepicker",null,!0).install=function(k){function h(b,a){b=alp.str2date(b.value,k.dataFormat);isNaN(b)||(a.value=alp.date2str(b,k.dispFormat))}function g(b,a){if(a.checkValidity()){var c=a.value;c&&3>c.length&&(c+=":00");c=alp.str2date(c,k.dispFormat);isNaN(c)||(b.value=alp.date2str(c,k.dataFormat),h(b,a))}}function f(b,a){var c="",d;for(d=0;24>d/60;d+=a)c+='<option value="'+alp.sTime("%H:%M",d)+'" />';b.innerHTML=c}var e=alp.nodify("oax-time-data",k.node),d=alp.nodify("oax-time-input",
k.node),b=alp.nodify("oax-time-list",k.node);k.dataFormat||(k.dataFormat="T{hh}:{mm}:{ss}");k.dispFormat||(k.dispFormat="{hh}:{mm}");"options"in document.createElement("datalist")?f(b,k.intervall||30):alp.sA(d,{type:"time",value:""});h(e,d);alp.aEL(d,"change",alp.bindF(k.storeValue||g,null,e,d))}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_team_activity_edit");
(function(){function k(b){b=alp.filter(b.participationStateNodes,'v.id === "public"');return b.length&&b[0].checked}function h(b){var c=b.formNode;c?e.submit(c,!0,function(a,c){c.stopWait();"ok"===a.status&&(c=b.facebookShareCkb&&b.facebookShareCkb.checked&&!alp.hasClass(b.facebookShareCont,oa.NO_DISPLAY)?"TA_NOTIF_SUCCESS_FACEBOOK":"TA_NOTIF_SUCCESS",f.generic_login_barrier_before({type:c,href:b.id,referrer:location.href}),location.href=a.redirect)}):handleError({message:"No data available!"})}var g=
alp.i.state,f=oa.util.community,e=oa.util.asyncForm,d=alp.view.modalwin;alp.sub("oa.i",null,!0).ITeamActivityEdit={proj:null,id:null,formNode:null,saveNode:null,participationStateNodes:null,whatsappGroupInfoNode:null,whatsappGroupInfoTmplNode:null,linkNode:null,geometryNode:null,targetTextNode:null,targetContentNode:null,targetContentSelectNode:null,targetContentTitleNode:null,targetContentContainerClass:"oax-target-content-container",targetContentSelectClass:"oax-target-content-select",dateTimeContNodes:null,
dateInputClass:"oax-date-input",timeInputClass:"oax-time-input",hiddenDateTimeInputClass:"oax-date-time-input-hidden",inviteUserNode:null,inviteUserTmplNode:null,inviteUserInputNode:null,inviteUserDispNode:null,inviteUserTextNode:null,alreadyInvitedInput:null,inviteUserDialogClass:"oax_invite_user_dialog",inviteUserInputClass:"oax-iu-input",inviteUserDoneClass:"oax-invite-done",dfltUserImgClass:"oax-default-profile-img-url",difficultyBtns:null,durationNode:null,activityNode:null,placeOfStartActivityNode:null,
facebookShareCont:null,facebookShareCkb:null,nameOfTourInput:null,isCommonApproachCkb:null,placeOfMeetingInput:null,dateOfMeetingInput:null,timeOfMeetingInput:null,showOptionalCkb:null,showOptionalCont:null,_installTargetContentSelect:function(b){var c=this;return new b({proj:c.proj,additionalAutosuggest:!0,searchContainerClass:c.targetContentContainerClass,searchBtnClass:c.targetContentSelectClass,onContentSelected:function(a,b){var d="",e="";if("tour"===alp.opt(b,"frontendtype")){var f=alp.oGet(b,
"rating.difficulty"),g=b.time,h=alp.oGet(b,"category.name"),k=alp.oGet(b,"startingPointDescr"),m=alp.oGet(b,"title");if(f){var t=c.difficultyBtns;t[f-1].checked=!0}g&&(t=0,f=c.durationNode,g=g.min,300>=g?t=0:660>=g&&(t=1),f.selectedIndex=t);if(h)for(f=c.activityNode,g=0;g<f.options.length;g++)if(f.options[g].innerText===h){f.options[g].selected=!0;break}k&&(c.placeOfStartActivityNode.value=k);m&&(c.nameOfTourInput.value=m)}a?(d=b.id,b=b.title):(e=b.geometry.location,a=alp.m(e,"lat")||e.lat,e="POINT("+
(alp.m(e,"lng")||e.lng)+" "+a+")",b=b.name||b.title+" ("+b.categoryTitle+")");c.targetContentNode.value=d;c.targetContentTitleNode.value=b;c.targetTextNode.value=e?b:"";c.geometryNode.value=e;alp.setClass(c.targetContentSelectNode,"oax-hide-empty-input",!1);c.targetContentSelectNode.dataset.valid="true";c.linkNode&&""!=d?(b=alp.gA(c.linkNode,"data-urlbase"),alp.sA(c.linkNode,"href",b+d),alp.setClass(c.linkNode,oa.NO_DISPLAY,!1)):(alp.sA(c.linkNode,"href",""),alp.setClass(c.linkNode,oa.NO_DISPLAY,
!0))}})},_installTimePicker:function(b,c){alp.view.timepicker.install({node:b,dataFormat:"{YYYY}-{MM}-{DD} {hh}:{mm}:{ss}",storeValue:function(a,b){b.checkValidity()&&((a=b.value)&&3>a.length&&(a+=":00"),a=alp.str2date(a,"{hh}:{mm}"),isNaN(a)||(b=alp.str2date(c.value,"{YYYY}-{MM}-{DD} {hh}:{mm}:{ss}"),b.setHours(a.getHours(),a.getMinutes(),a.getSeconds()),c.value=alp.date2str(b,"{YYYY}-{MM}-{DD} {hh}:{mm}:{ss}")))}})},augmentModel:function(b){this._alreadyInvited=JSON.parse(this.alreadyInvitedInput.value||
"{}");b._spinner=oa.util.spinner.create_spinner();b.isCommonApproach=g.boolState();b.isPublic=g.boolState(k(this));b.hasParticipants=g.boolState(!alp.oIsEmpty(this._alreadyInvited))},setInitVal:function(){var b=5===arguments.length?arguments[1]:arguments[0];g.set(5===arguments.length?arguments[0]:null,b.m.isCommonApproach,b.isCommonApproachCkb.checked)},connectModel2View:function(b,c,a,d){function e(){b.inviteUserNode.dataset.valid=a.isPublic.get()||a.hasParticipants.get()}function f(){alp.setClass(b.facebookShareCont,
oa.NO_DISPLAY,!a.isPublic.get())}g.chenInit(a.isCommonApproach,function(){alp.forEach(["dateOfMeetingInput","timeOfMeetingInput"],'this.m.isCommonApproach.get() ? alp.sA(this[v], "required", true) : alp.rA(this[v], "required")',b);alp.setClass(d.placeOfMeeting.cont,"oax-required",a.isCommonApproach.get())});g.chenInit(a.isPublic,e);b.facebookShareCont&&g.chenInit(a.isPublic,f);g.chenInit(a.hasParticipants,e);g.chenInit(a.hasParticipants,function(){alp.setClass(b.inviteUserTextNode,oa.NO_DISPLAY,!a.hasParticipants.get())})},
connectView2ModelP:function(b,c,a,d){c.push(alp.aEL(b.saveNode,"click",alp.bindF(h,null,b)));c.push(alp.aEL(b.isCommonApproachCkb,"change",g.nowF(function(c){g.set(c,a.isCommonApproach,b.isCommonApproachCkb.checked)})));c.push(alp.aEL(b.participationStateNodes,"change",g.nowF(function(b){g.set(b,a.isPublic,!a.isPublic.get())})))},connectPureView:function(b,c,a,d){b.durationNode.selectedIndex=1}};oa.i.ITeamActivityEdit.invite_user_install=function(b,c){function a(a,d,e){if(e._inviteUser)e._inviteUser.input.focus();
else{d=alp.nodify(c.inviteUserInputClass,a);a=alp.nodify(c.inviteUserDoneClass,a);var f=alp.nodify(c.dfltUserImgClass);e._inviteUser=new b({input:d,proj:c.proj,subset:"user,email",alreadyInvited:c._alreadyInvited,dfltImgUrl:f?f.value:"",initNow:!0});alp.aELtouchup(a,alp.bindF("close",e))}"undefined"!==typeof oam&&window.scrollTo(0,0)}function e(a,b,d){b=d._inviteUser.getSelected();a=!alp.oIsEmpty(c._alreadyInvited);alp.oIsEmpty(b)?(c.inviteUserInputNode.value="",c.inviteUserDispNode.innerText="",
b=!1):(c.inviteUserInputNode.value=alp.oKeys(b).join(","),c.inviteUserDispNode.innerText=(a?", ":"")+alp.o2arr(b,'typeof o[k] === "string" ? o[k] : k').join(", "),b=!0);g.setNow(c.m.hasParticipants,b||a)}c.inviteUserNode&&c.inviteUserTmplNode&&alp.aELtouchup(c.inviteUserNode,function(){c._inviteMowi?c._inviteMowi.open():c._inviteMowi=d.open({html:c.inviteUserTmplNode.innerHTML,extraClass:c.inviteUserDialogClass,onOpenNow:a,onCloseLater:e})})};oa.i.ITeamActivityEdit.install_approach_autosuggest=function(b,
c){var a=new b({proj:c.proj,node:c.placeOfMeetingInput,onSelect:function(b){var c=alp.opt(a,"cont");c&&(alp.dataset(c).valid=null!==b)},clearDropDownOnSelect:!0,setInputOnSelect:!0,initLocation:!0,initNow:!0});return a};oa.i.ITeamActivityEdit.submit=h})();"undefined"!==typeof dojo&&(dojo.provide("oax.x.team_activity_edit"),dojo.provide("oax.x.content_search"));
(function(){alp.declare("oax.x.TeamActivityEdit",alp.x.AbstractController,null,oa.i.ITeamActivityEdit,{proj:null,id:null,augmentKids:function(k){var h=this;k.targetContent=h._installTargetContentSelect(oax.x.ContentSearch);k.placeOfMeeting=oa.i.ITeamActivityEdit.install_approach_autosuggest(oax.WhereContent,h);alp.forEach(this.dateTimeContNodes,function(g){var f=alp.nodify(h.hiddenDateTimeInputClass,g),e=alp.nodify(h.dateInputClass,g);g=alp.nodify(h.timeInputClass,g);var d=f.value?alp.str2date(f.value,
"{YYYY}-{MM}-{DD} {hh}:{mm}:{ss}"):"",b=new Date;b.setHours(0,0,0,0);(k[f.id]=new alp.x.Pikaday({field:e,setDefaultDate:!0,useRelativeDays:!0,minDate:b,defaultDate:d,firstDay:"en"===alp.i18n.language()?0:1,initNow:!0})).selectEvt().then(function(b){var a=alp.str2date(f.value,"{YYYY}-{MM}-{DD} {hh}:{mm}:{ss}");b&&(a.setFullYear(b.getFullYear()),a.setMonth(b.getMonth()),a.setDate(b.getDate()));f.value=alp.date2str(a,"{YYYY}-{MM}-{DD} {hh}:{mm}:{ss}");b=f.id;-1<b.indexOf("StartActivity")&&(b=b.replace("StartActivity",
"Meeting"),k[b]&&!k[b].getDate()&&k[b].setDate(k[f.id].getDate()))});h._installTimePicker(g.parentNode,f)})},connectView2Model:function(k,h,g,f){k.connectView2ModelP(k,h,g,f);k.invite_user_install(oax.x.InviteUser,k)}})})();"undefined"!==typeof dojo&&dojo.provide("oax.team_activity_edit_page");
(function(){alp.declare("oax.TeamActivityEditPage",null,alp.nowF(function(k){alp.mixCheck(this,k);alp.oCheckScheme(this,'alp.and(["proj","userid","teamActivityId"],"v&&\'string\'===typeof v")')}),{proj:null,id:null,formClass:"oax-teamactivity-edit-form",saveClass:"oax-save-team-activity",participationStateClass:"oax-participation-state",whatsappGroupInfoClass:"oax-whatsappGroup-howTo",whatsappGroupInfoTmplClass:"oax-whatsappGroup-howTo-tmpl",linkClass:"oax-where-link",geometryClass:"oax-where-geometry",
targetTextClass:"oax-where-text",targetContentClass:"oax-where-areaid",targetContentSelectClass:"oax-target-content-select",targetContentTitleClass:"oax-area-title",dateTimeContClass:"oax-date-time-input",inviteUserClass:"oax-invite-user-btn",inviteUserTmplClass:"oax-invite-user-dialog-tmpl",inviteUserInputClass:"oax-invite-user-input",inviteUserDispClass:"oax-invite-user-display",inviteUserTextClass:"oax-invite-user-text",alreadyInvitedClass:"oax-already-invited-user",nameOfTourClass:"oax-ta-name-of-tour",
difficultyClass:"oax-teamactivity-difficulty",durationClass:"oax-teamactivity-duration",activityClass:"oax-teamactivity-activity",placeOfStartActivityClass:"oax-ta-place-of-start-activity",isCommonApproachClass:"oax-ta-is-common-approach",placeOfMeetingClass:"oax-ta-place-of-meeting",dateOfMeetingClass:"oax-ta-date-of-meeting",timeOfMeetingClass:"oax-ta-time-of-meeting",showOptionalCkbClass:"oax-ta-show-optional-fields-ckb",showOptionalContClass:"oax-ta-show-optional-fields-cont",facebookShareContClass:"oax-ta-facebook-share-cont",
facebookShareClass:"oax-ta-facebook-share-ckb",initASAP:function(){var k=this;alp.onDCL(function(){k.taedit=new oax.x.TeamActivityEdit({proj:k.proj,id:k.id,formNode:alp.nodify(k.formClass),saveNode:alp.nodify(k.saveClass),participationStateNodes:alp.gEBCN(k.participationStateClass),whatsappGroupInfoNode:alp.nodify(k.whatsappGroupInfoClass),whatsappGroupInfoTmplNode:alp.nodify(k.whatsappGroupInfoTmplClass),linkNode:alp.nodify(k.linkClass),geometryNode:alp.nodify(k.geometryClass),targetTextNode:alp.nodify(k.targetTextClass),
targetContentNode:alp.nodify(k.targetContentClass),targetContentSelectNode:alp.nodify(k.targetContentSelectClass),targetContentTitleNode:alp.nodify(k.targetContentTitleClass),dateTimeContNodes:alp.gEBCN(k.dateTimeContClass),inviteUserNode:alp.nodify(k.inviteUserClass),inviteUserTmplNode:alp.nodify(k.inviteUserTmplClass),inviteUserInputNode:alp.nodify(k.inviteUserInputClass),inviteUserTextNode:alp.nodify(k.inviteUserTextClass),inviteUserDispNode:alp.nodify(k.inviteUserDispClass),alreadyInvitedInput:alp.nodify(k.alreadyInvitedClass),
difficultyBtns:alp.gEBCN(k.difficultyClass),durationNode:alp.nodify(k.durationClass),activityNode:alp.nodify(k.activityClass),placeOfStartActivityNode:alp.nodify(k.placeOfStartActivityClass),nameOfTourInput:alp.nodify(k.nameOfTourClass),isCommonApproachCkb:alp.nodify(k.isCommonApproachClass),placeOfMeetingInput:alp.nodify(k.placeOfMeetingClass),dateOfMeetingInput:alp.nodify(k.dateOfMeetingClass),timeOfMeetingInput:alp.nodify(k.timeOfMeetingClass),showOptionalCkb:alp.nodify(k.showOptionalCkbClass),
showOptionalCont:alp.nodify(k.showOptionalContClass),facebookShareCont:alp.nodify(k.facebookShareContClass),facebookShareCkb:alp.nodify(k.facebookShareClass),initNow:!0})})}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.community");
(function(){function k(e,d){alp.setText(e,alp.isFiniteNumber(d)?d:"")}var h=alp.dom.anchor,g=oax.util,f={};alp.declare("oax.x.Community",alp.x.AbstractController,null,{id:null,proj:null,newestToursContNode:null,newestToursCount:400,publicTeamActivitiesContNode:null,commentContNode:null,newMemberContNode:null,mostActiveTourAuthorsContNode:null,activeMembersContNode:null,publicChroniclesCont:null,publicChroniclesInitLength:10,publicChroniclesStep:10,channelChroniclesCont:null,channelChroniclesInitLength:10,
channelChroniclesStep:10,initLength:3,step:4,infinite:!1,augmentKids:function(e){function d(a){h.wrap_ooi_snippet(a);g.basket_add_or_login(a);return a}if(!this.proj)throw Error("oax.x.Community requires a proj. Got instead: "+this.proj);var b=alp.x.MoreSnippets,c=alp.x.InfiSnippets,a;for(a in this)if(!(a in f)){var k=a.match(/^(.*)ContNode$/);if(k){var l=this[a];if(l){k=k[1];var r=this[k+"Ctor"]||(alp.nodify(b.prototype.snippetCont,l)?b:c);e[k]=new r({contNode:l,proj:this.proj,id:this[k+"Value"]||
"100",prefix:k,initLength:this[k+"InitLength"]||this.initLength,step:this[k+"Step"]||this.step,postProcess:d})}}}},setInitVal:function(e,d,b,c){d=e._extraDisplay={};for(var a in c)a in f||(c=(c=e[a+"ExtraDisplayClass"])&&alp.gEBCN(c)||[],d[a]=c)},connectModel2View:function(e,d,b,c){for(var a in c)if(!(a in f)){b=c[a];var g=e._extraDisplay[a];b&&g.length&&d.push(b.m.nfull.change_cb_init(alp.bindF(k,null,g)))}}})})();"undefined"!==typeof dojo&&dojo.provide("oax.communitypage");
(function(){var k=oax.util;alp.declare("oax.CommunityPage",null,alp.nowF(function(h){alp.mixCheck(this,h)}),{proj:null,newestToursCont:"oax-newestTours-cont",publicTeamActivitiesCont:"oax-newestTeamactivities-cont",commentCont:"oax-comment-cont",newMemberCont:"oax-newMember-cont",mostActiveTourAuthorsCont:"oax-mostActiveTourAuthors-cont",activeMembersCont:"oax-activeMembers-cont",publicChroniclesCont:"oax-publicChronicles-cont",channelChroniclesCont:"oax-channelChronicles-cont",infinite:!1,initASAP:function(){var h=
this;alp.onDCL(function(){h.com=new oax.x.Community({proj:h.proj,newestToursContNode:alp.nodify(h.newestToursCont),publicTeamActivitiesContNode:alp.nodify(h.publicTeamActivitiesCont),commentContNode:alp.nodify(h.commentCont),newMemberContNode:alp.nodify(h.newMemberCont),mostActiveTourAuthorsContNode:alp.nodify(h.mostActiveTourAuthorsCont),activeMembersContNode:alp.nodify(h.activeMembersCont),publicChroniclesContNode:alp.nodify(h.publicChroniclesCont),channelChroniclesContNode:alp.nodify(h.channelChroniclesCont),
channelChroniclesValue:h.proj,infinite:h.infinite,initNow:!0});var g=alp.gEBCN("oax-community-exception")[0];(g=g&&g.innerHTML)&&alp.humane(g);k.setup_many_basket_adders()})}})})();"undefined"!==typeof dojo&&dojo.provide("oa.util.detail_tabs");
(function(){alp.sub("oa.util",null,!0).initDetailTabsHighlight=function(k){function h(){var e=alp.qS("h2.oax_active");e&&(e=alp.gA(e.firstElementChild,"for"),e=alp.gEBI(e),e.checked||(e.checked=!0))}function g(e){e=e.currentTarget;alp.setClass(f,"oax_active",!1);alp.setClass(e,"oax_active",!0)}if(k=alp.gEBCN(k?k:"oax-detail-tabs")){var f=alp.gEBTN("h2",k[0]);alp.aEL(f,"click",g);setInterval(h,200)}}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.author");
(function(){var k=oax.x.My;alp.declare("oax.x.Author",k,null,{authorCommentsContNode:null,authorCommentsExtraDisplayClass:"oax-comments-number",authorCommentsPostProcess:k.prototype.myCommentPostProcess,authorConditionsContNode:null,authorConditionsExtraDisplayClass:"oax-conditions-number",authorConditionsPostProcess:k.prototype.myCommentPostProcess,authorConditionsMapClass:"oax-conditions-listmap-view",authorToursContNode:null,authorToursExtraDisplayClass:"oax-tours-number",authorToursPostProcess:k.prototype.myCmsToursPostProcess,
authorToursMapClass:"oax-tours-listmap-view",publicUserChroniclesContNode:null,publicUserChroniclesInitLength:15,publicUserChroniclesStep:15,partnerChroniclesContNode:null,partnerChroniclesInitLength:15,partnerChroniclesStep:15,initLength:3,step:3})})();"undefined"!==typeof dojo&&dojo.provide("oax.authorpage");
(function(){var k=oa.util;alp.declare("oax.AuthorPage",null,alp.nowF(function(h){alp.mixCheck(this,h)}),{id:null,proj:null,userChroniclesCont:"oax-userChronicles-cont",toursCont:"oax-tours-cont",commentsCont:"oax-comments-cont",conditionsCont:"oax-conditions-cont",partnerChroniclesCont:"oax-partnerChronicles-cont",initASAP:function(){var h=this;alp.onDCL(function(){k.initDetailTabsHighlight("oax-detail-tabs");h.my=new oax.x.Author({id:h.id,proj:h.proj,publicUserChroniclesContNode:alp.nodify(h.userChroniclesCont),
authorToursContNode:alp.nodify(h.toursCont),authorCommentsContNode:alp.nodify(h.commentsCont),authorConditionsContNode:alp.nodify(h.conditionsCont),partnerChroniclesContNode:alp.nodify(h.partnerChroniclesCont),initNow:!0})})}})})();"undefined"!==typeof dojo&&dojo.provide("oax.x.source");
(function(){alp.declare("oax.x.Source",oax.x.My,null,{sourceConditionsContNode:null,sourceConditionsExtraDisplayClass:"oax-conditions-number",sourceToursContNode:null,sourceToursExtraDisplayClass:"oax-tours-number",sourceStoriesContNode:null,sourceStoriesExtraDisplayClass:"oax-stories-number",sourceRelatedPartnersContNode:null,sourceRelatedPartnersExtraDisplayClass:"oax-relatedPartners-number",sourceAuthorsContNode:null,sourceAuthorsExtraDisplayClass:"oax-authors-number",initLength:3,step:3})})();
"undefined"!==typeof dojo&&dojo.provide("oax.sourcepage");
(function(){alp.declare("oax.SourcePage",null,alp.nowF(function(k){alp.mixCheck(this,k)}),{id:null,proj:null,toursCont:"oax-tours-cont",conditionsCont:"oax-conditions-cont",storiesCont:"oax-stories-cont",relatedPartnersCont:"oax-relatedPartners-cont",authorsCont:"oax-authors-cont",initASAP:function(){var k=this;alp.onDCL(function(){k.my=new oax.x.Source({id:k.id,proj:k.proj,sourceToursContNode:alp.nodify(k.toursCont),sourceConditionsContNode:alp.nodify(k.conditionsCont),sourceStoriesContNode:alp.nodify(k.storiesCont),
sourceRelatedPartnersContNode:alp.nodify(k.relatedPartnersCont),sourceAuthorsContNode:alp.nodify(k.authorsCont),initNow:!0})})}})})();"undefined"!==typeof dojo&&dojo.provide("oax.webpageItems");
(function(){oax.webpageItems=function(){alp.onDCL(function(){var k=alp.gEBCN("oax-top-cont");alp.x.SlideList.install({cont:k[0]});alp.forEach(alp.gEBCN(oa.CONT_EACH_WRAP_ANCHOR,k[0]),alp.dom.anchor.wrap_ooi_snippet);alp.dom.scrollToNodeInstall({cont:k[0]});(function(){var h=alp.gEBCN("oax-one-video-cont",k[0]);alp.forEach(h,function(g){new alp.x.YTPlayer({cont:g,videoid:g.dataset.source,previewUrl:g.dataset.preview,hideControls:!1,allowfullscreen:!0,initNow:!0})})})()})}})();
"undefined"!==typeof dojo&&dojo.provide("oax.x.search");
(function(){function k(f,e){alp.setText(f,alp.isFiniteNumber(e)?e:"")}var h={},g=oax.util;alp.declare("oax.x.Search",alp.x.AbstractController,null,{proj:null,searchContClass:null,searchExtraDisplayClassTmpl:"oax-search-number-",initLength:3,step:10,augmentKids:function(f){if(!this.proj)throw Error("oax.x.Search requires a proj. Got instead: "+this.proj);f=alp.gEBCN(this.searchContClass);var e=this;alp.forEach(f,function(d){var b=alp.gEBCN("cat-name",d);(b=b&&b[0]&&b[0].value)&&(e.kx[b]=new alp.x.MoreSnippetsSearch({contNode:d,
proj:e.proj,q:e.q,cat:b,initLength:e.initLength,step:e.step,postProcess:function(b){var a=oax.ID_FROM_DOMNODE(b);oa.i.IFavBtn.installLazy(oax.x.FavBtn,null,{cont:b,where:"search",proj:e.proj});alp.dom.anchor.wrap_ooi_snippet(b);g.basket_add_or_login(b,{ooiid:a});return b}}))},e)},setInitVal:function(f,e,d,b){e=f._extraDisplay={};for(var c in b)c in h||(b=(b=f[c+"ExtraDisplayClass"])&&alp.gEBCN(b+c)||[],e[c]=b)},connectModel2View:function(f,e,d,b){for(var c in b)if(!(c in h)){d=b[c];var a=f._extraDisplay[c];
d&&a.length&&e.push(d.m.nfull.change_cb_init(alp.bindF(k,null,a)))}}})})();"undefined"!==typeof dojo&&dojo.provide("oax.search");(function(){alp.declare("oax.Search",null,alp.nowF(function(k){alp.mixCheck(this,k)}),{q:null,proj:null,searchContClass:"cat-scroller-cont",initASAP:function(){var k=this;alp.onDCL(function(){k.s=new oax.x.Search({q:k.q,proj:k.proj,searchContClass:k.searchContClass,initLength:k.initLength,initNow:!0})})}})})();"undefined"!==typeof dojo&&dojo.provide("oax.home_layout");
(function(){var k=alp.sub("oax.home_layout",null,!0),h=oa.util,g=oax.util,f=oax.layout;k.install=function(e){alp.onDCL(function(){var d=alp.nodify(oax.TOP_CONT)||alp.body();f.getNode("oax-content-slider-images")?f.slideshow_setup(d,{withLightbox:!0}):f.slideshow_setup();oax.selectors.install();oax.community_layout.login_install({dynamicRedirect:"false"});var b=e&&e.lazyloadpage;b&&g.installLazyLoad_specific({cont:d,where:b});h.setTouchSupportClass(d);if(b=f.getNode("oax-what-button-with-dropdown"))alp.dom.unscript(b),
f.category_toggle_setup();f.webappteaser_setup();alp.forEach(alp.gEBCN(oax.CONT_EACH_WRAP_ANCHOR,d),alp.dom.anchor.wrap_ooi_snippet);g.setup_many_basket_adders(d)})}})();"undefined"!==typeof dojo&&dojo.provide("oax.portal_layout");
(function(){function k(){var g=alp.gEBCN("oax-one-video-cont");alp.forEach(g,function(f){new alp.x.YTPlayer({cont:f,videoid:f.dataset.source,previewUrl:f.dataset.preview,hideControls:!1,allowfullscreen:!0,initNow:!0})})}var h=alp.sub("oax.portal_layout",null,!0);h.install=function(){oax.layout.slideshow_setup();oax.community_layout.login_install();k()};h.errorpage_install=function(){alp.onDCL(function(){var g=alp.gEBCN("oax-error-login-dialog");g&&alp.aEL(g,"click",function(f){alp.stopEvent(f);oax.community_layout.open_login_dialog({dynamicRedirect:"true"})})})}})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.regionchild");
(function(){var k=alp._gmap2_3,h=alp.maps,g=alp.cfg.region;alp.declare("alp._gmap2_3.x.RegionChild",alp.x.AbstractController,null,{id:null,node:null,poly:null,gm:null,map:null,idselected:null,highlightClass:null,getMap:function(){return this.m.map.get()},setMap:function(d){this.m.map.setNow(d)},augmentModel:function(d){d.idselected=this.idselected||new alp.StringState;d.map=new alp.State({init_value:this.map||null});d._is_highlighted=new alp.BoolState;d.idselected.bind_to(d._is_highlighted,{loose:!0,
transform:'==="'+this.id+'"'})},setInitVal:function(d,b,c,a){d[f]=d.highlightClass||alp.sub("oax.HIGHLIGHT")||"oax-highlight"},connectModel2View:function(d,b,c,a){function h(){alp.m(d[e],"setMap");d[e]=null}var k=d.poly,r=d.node;c._is_highlighted.change_cb_init(function(){var a=c._is_highlighted.get();a!==!!n&&(n=a,alp.setClass(r,d[f],a),d.poly.setOptions(alp.oCreateMix(k._alp_cfg,a?alp.opt(g.highlight,["fillColor","fillOpacity"]):{})),a||h())});c.map.change_cb_init(function(){var a=c.map.get()||
null;k.setMap(a);a||h()});var n},connectView2Model:function(d,b,c,a){function f(){function a(a,b){a=h.project_SM({lat:a,lng:b});return alp.mapIn(a,"*"+(256<<m)/(2*Math.PI))}g();var b=q._alp_wens,c=b.center,f=alp.gEBTN("a",n)[0],l=f&&alp.nodify("oax-region-title",f);f=l&&l.innerHTML||f&&alp.gA(f,"title")||n.innerHTML;l=q.getMap();var m=l.getZoom(),p=l.getBounds(),r=p.getSouthWest(),u=p.getNorthEast(),B=b.south,I=c.lng;p=new v.LatLng(B,I);B=a(B,I);var L=a(r.lat(),I),J=62;I=-10;100>B.y-L.y&&(B=b.north,
I=c.lng,p=new v.LatLng(B,I),B=a(B,I),a(u.lat(),I),I=75);b=B.x-J;c=b+125;B=B.y-I;L=B+100;var P=a(r.lat(),r.lng());r=P.x;P=P.y;var H=a(u.lat(),u.lng());u=H.x;H=H.y;var F;0<(F=r-b)?J-=F:0<(F=c-u)&&(J+=F);0<(F=B-H)?I-=F:0<(F=P-L)&&(I+=F);alp.m(d[e],"setMap");(d[e]=new k.CustomMarker({html:f,position:p,anchor_y:I,anchor_x:J,width:125,style:{backgroundColor:"#fafefa",opacity:"0.9",textAlign:"center",padding:"6px 12px 6px 12px",height:""},className:"oax-regionchild-tooltip"})).setMap(l)}function g(){u.setNow(p)}
function r(){u.is(p)&&u.setNow()}var n=d.node,q=d.poly,p=d.id,v=d.gm,u=c.idselected;b.push(alp.aEL(n,"mouseover",g));b.push(alp.aEL(n,"mouseout",r));b.push(v.event.addListener(q,"mouseover",f),"removeListener",v.event);b.push(v.event.addListener(q,"mousemove",f),"removeListener",v.event);b.push(v.event.addListener(q,"mouseout",r),"removeListener",v.event);b.push(k.event("addListener")(q,"singleclick",function(){var a=/^a$/i.test(n.tagName)?n:alp.gEBTN("a",n)[0];if(a&&"undefined"!==typeof MouseEvent){var b=
new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});a.dispatchEvent(b)}else b=q._alp_wens.center,a=q.getMap(),k.iwCloseAll(a),b=new v.InfoWindow({content:alp.aC(alp.cE("div",null,{"class":"oax",style:"padding: 8px"}),n.cloneNode(!0)),position:new v.LatLng(b.lat,b.lng)}),b.open(a),b._alp_id=p}),k.event("removeListener"));b.push(k.event("addListener")(q,"dblclick",function(a){a=q.getMap();alp.m(a,"setZoom",1+a.getZoom())}),k.event("removeListener"))}});var f="_highlightClass",e="_tooltip"})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.regionchildrenmap");
(function(){var k=alp.sub("alp._gmap2_3.x",null,!0),h=alp._gmap2_3,g=alp.dom,f=alp.data,e=alp.maps,d=alp.cfg.region;k.regionChildrenMapInstall=function(b){var c=b.gm||null,a=alp.dfrd("AGX:regionChildrenMapInstall",{then:1});alp.asyncSeq().next(function(a){b.waitForVisibility?alp.subDfrd(alp.bindF("isVisibleWithinViewport",g,b.map)).then(a):a()}).next(function(a){c?a():alp.gmap3(function(b){c=b;a()})}).next(function(d){d=alp.mix({},b,{gm:c,initNow:!0});delete d.waitForVisibility;d=new k.RegionChildrenMap(d);
a.done(d)});return a};alp.declare("alp._gmap2_3.x.RegionChildrenMap",alp.x.AbstractController,null,{cont:null,map:null,gm:null,mapTypeIds:null,mapDfltWidth:"100%",mapDfltHeight:"600px",idclass:"oax-id",idrx:null,augmentModel:function(b){b.idset=new alp.ObjectState({init_value:{}});b.childrenready=new alp.BoolState},augmentKids:function(b){this._mapTypeIds=this.mapTypeIds||["oa_map","oa_hybrid",this.gm.MapTypeId.SATELLITE,this.gm.MapTypeId.TERRAIN];this._children_noli=alp.gEBCN(this.idclass,this.cont);
this._idrx=this.idrx||alp.sub("oa.ID_RX")||/\boax-id-(\S+)\b/},setInitVal:function(b,c,a,e){c=b.map;c.clientWidth||(c.style.width=b.mapDfltWidth||"");c.clientHeight||(c.style.height=b.mapDfltHeight||"");alp.m(b._wb,"stopWait");alp.forIn(b._id2info||{},".poly.setMap()");b._wb=new alp.x.Waitbox({targetInit:c,delay_ms:127,background:{w:340,h:170}});b._wb.startWait();b._id2node={};b._id2info={};b._childrendfrd=null;c=alp.arr2o(b._children_noli,function(a){var c=a.className.match(b._idrx)[1];b._id2node[c]=
a;return c},alp.f("1"));a.idset.set(c);a.childrenready.set(!1);var g=b._childrendfrd=alp.gatherDfrd(alp.map(alp.oKeys(c),function(a){var c=alp.dfrd("_RCM_id_2_poly");f.api_region_geometry({areaid:a}).then(function(e){var f=e&&e.encPolyline,g=b._id2node[a];f?c.done({id:a,node:g,poly:h.region_polygon(null,alp.arrChain(f),{noworld:!0,strokeWeight:d.clear.strokeWeight,strokeOpacity:d.clear.strokeOpacity,fillOpacity:.05})}):(console.error("RegionChildrenMap could not extract the geometry for region "+
a+': "'+alp.textContent(g)+'"',e),c.done(!1))});return c}));g.thenSoon(function(c){g===b._childrendfrd&&(alp.forEach(c,function(a){a=a[0];(a.id||null).substring.call.a;b._id2info[a.id]=a}),a.childrenready.set(!0))})},connectModel2View:function(b,c,a,d){c.push(a.childrenready.change_cb_init(function(){function c(){var a=alp.oValues(b._id2info),c=b.gm;if(a.length){var d=alp.reduce(alp.map(a,".poly._alp_wens"),e.bounds_union),f=b.map,g=e.bounds2zoomcenter(d,f,{padding:.01});d=g.zoom;g=g.center;var h=
new alp.gmap3.Map(f,{center:new c.LatLng(g.lat,g.lng),zoom:d,maxZoom:d+2,mapTypeId:b._mapTypeIds[0],mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:b._mapTypeIds},scrollwheel:!1});alp.forEach(a,".poly.setMap(this)",h);c=new alp.StringState;alp.forEach(a,function(a){(a.id||null).substring.call.a;a.x=new k.RegionChild(alp.oCreateMix(a,{idselected:this,map:h,gm:b.gm,initNow:!0}))},c);b._wb.stopWait()}else console.error("RegionChildrenMap: no regionchild!"),setTimeout(function(){throw Error("RegionChildrenMap: no regionchild!");
},0),alp.orphan(b.cont),alp.orphan(b.map)}a.childrenready.get()&&(alp.sub("oax.api.maps")?oax.api.maps(c):c())}))}})})();"undefined"!==typeof dojo&&dojo.provide("alp.util.math.invert_polygon");
(function(){function k(f){function e(a){for(;-180>a;)a+=360;for(;180<a;)a-=360;return a}for(var d=0,b=f[0],c=f.length,a=c;a--;){var g=f[(a+1)%c],h=f[(a+2)%c],k=[e(g[0]-b[0]),g[1]-b[1]];g=[e(h[0]-g[0]),h[1]-g[1]];d+=k[0]*g[1]-k[1]*g[0]}return 0>d}var h=alp.sub("alp.util.math",null,!0),g=alp._gmap2_3;h.invert_polygon=function(f,e){var d=alp.oCreateMix({maxlat:85.0511287798066,multiHole:!0},e);e=d.maxlat;if(d.multiHole)return d=g.qt7bit.ORIG_NW(),e=g.qt7bit.ORIG_SE(),d=Math.round(d.lat),e=Math.round(e.lat),
e=[[-180,d],[0,d],[180,d],[180,e],[0,e],[-180,e]],k(f)&&(e=alp.loop(e.length,"v--","ret.push(that[v])",{that:e,retInit:"[]",step:" "})),[e,f];d=Infinity;for(var b=-Infinity,c=f.length;c--;){var a=f[c][0];d=Math.min(d,a);b=Math.max(b,a)}for(var h;360<b-d;)b-=360;for(;0>(h=b-d);)b+=360;if(180<h)throw Error("Sorry, I cannot deal with xspan > 180");b=(b+d)/2;d=[];var l=0;a=f[l];var r=f.length;for(c=1;c<r;c++){var n=f[c];n[1]>a[1]&&(l=c,a=n)}l&&(f=f.slice(l).concat(f.slice(0,l)));l=f[0];r=f.length;for(c=
1;c<r;c++)n=f[c],n[1]<l[1]&&(l=n);c=f[0];r=f[f.length-1];1E-10>Math.max(Math.abs(r[0]-c[0],r[1]-c[1]))&&f.push(r);r=Math.min(179.99,10*h);c=r/2;h=[b+c,e];b=[a,[a[0],e],[b-c,e],[b-c,-e],[b+c,-e],h,[a[0],e],a];if(k(f))f=f.concat(b);else for(c=b.length;c--;)f.push(b[c]);d.push(f);f=h[0];c=360-Math.abs(r);r=3;b=c/r;for(c=0;c<r;c++)a=f,h=f+=b,d.push([[a,e],[h,e],[h,-e],[a,-e],[a,e]]);return d};h.is_clockwise=k})();"undefined"!==typeof dojo&&dojo.provide("oax.guide_layout");
(function(){function k(a,b){return{top:alp.body(),actionOpenType:b&&b.actionOpenType||oax.ACTION_OPEN_IN_PAGE_IW,_actionOpener:{open_inpage_iw:function(a,c){return oax.iwOpenOOI(c,a.id,b.proj,{actionOpenType:oax.ACTION_OPEN_PAGE_LOAD_PORTAL})}},openOOIUrl:b&&b.openOOIUrl||oax.openOOIUrl,proj:b.proj,m:{map:{get:function(){return a}}}}}function h(a,b,c){c&&c.coverflowCont||oax.x.DetailMap._connectPoiClickToOpen(a,null,b.layerClickEvt(),"oax-snippet-regionmap-best-tour","map")}var g=alp.sub("oax.guide_layout",
null,!0),f=oax.layout,e=oa.util,d=oax.util,b=alp.data,c=alp.dom,a=alp.maps,m=alp._gmap2_3.x;g.install=alp.nowF(function(g){function l(a){return l[a]||(l[a]=alp.gEBCN(a,t)[0])}function n(a,b){a=alp.gEBCN("oax-toptipps-list-slide")[0];G=new alp._gmap2_3.OOILayer({proj:g.proj,highlightcolor:"outdooractive",autoExtentPadding:{left:.1,right:.1,top:.1,bottom:"165px"},noMouseover:!!a,defaultIW:!1});G.setMap(E);G.setSize("round");G.setSymbol("1");G.setColor("black_green");G.listen("markerClick",function(a){a=
a.id;var b=B.getIds();a=alp.lastIndexOf(b,a);(b=-1<a&&I[a])&&L&&L(alp.nodify("oax-toptipps-num-"+a,b))})}function q(a,b){a=l("oax-region-poly");d.region_polygon(C,a&&a.value)}function p(a){alp.m(p,"register_map_opener",a.node);alp.forEach(alp.gEBCN(oax.CONT_EACH_WRAP_ANCHOR,a.node),c.anchor.wrap_ooi_snippet);alp.forEach(alp.gEBCN("oax-mapList-snippet oax-id",a.node),v)}function v(a){var b=oax.ID_RX.exec(a.className);(b=b&&b[1])&&d.basket_add_or_login(a,{proj:oax.API_CFG.proj,ooiid:b})}var u=alp.mix({top:null,
id:null,mapbtnsWrapper:"oax-mapbtns-wrapper",mapbtnsOpenClass:"oax-mapbtns-open",mpCont:oax.MP_CONT,mlpCont:oax.MLP_CONT,mlpToggle:oax.MLP_TOGGLE,mcpCont:oax.MCP_CONT,mcpToggle:oax.MCP_TOGGLE,mcpTogglePlaceholder:"oax-toggle-placeholder",mcpCatList:"",mcpInitList:"",mcpInitCheckedIds:""},g),t=g&&g.top,w=g&&!1!==g.regionId?g.regionId||g.id:null,x=g&&g.isWinter||!1,y=alp.nodify("oax-travelguide-tabs",t),z=alp.gEBCN("oax-tab-cb",y);z.length?z[0].checked=!0:y&&alp.orphan(y);alp.nodify("oax-top-cont-flexview",
y)&&(y=alp.gEBI("oax-tab2",y),y.checked?window.installFlexView():alp.aEL(y,"change",function(){window.installFlexView()}));e.login.install();alp.forEach(alp.gEBCN("oax-mapList-snippet oax-id",t),v);d.installLazyLoad_specific({cont:t,where:"regionpage",oax_lazy_onload:p});c.scrollToNodeInstall({cont:t});c.img_srcset({cont:t});e.translate.setup(t);alp.forEach(alp.gEBCN(oax.CONT_EACH_WRAP_ANCHOR,t),c.anchor.wrap_ooi_snippet);oax.priv.where({regions:!0});alp.x.SlideList.install({cont:t});f.slideshow_setup(g&&
g.top,{withLightbox:!0});f.webappteaser_setup();y=alp.nodify(oax.WEATHER_BOX_CONT,t);var A=(z=l("oax-weather-ooi"))&&new alp.x.Weatherbox({proj:g.proj,ooiid:z.value,cont:y,withDetails:!0,initNow:!0});A&&alp.aEL(alp.gEBCN(oax.WEATHER_BOX_OPENER,t),"click",function(){A.m.open.setNow(!0)});alp.forEach(alp.gEBCN("oax-region-webapps"),function(a){var b=alp.gBCR(alp.gEBCN("oax-region-webapps-full",a)[0]).height,c=alp.gBCR(a).height,d=a.parentNode;if(alp.gEBCN("oax-region-webapps-toggle",d)[0]&&b>c){alp.setClass(alp.gEBCN("oax-region-webapps-toggle",
d)[0],oax.NO_DISPLAY,!1);alp.setClass(a,"oax_overflowing",!0);var e=alp.transitionEndName();alp.aEL(alp.gEBCN("oax-region-webapps-toggle",d)[0],"click",function(){var d=alp.gBCR(a).height;console.log(d+" "+c);a.style.height=d+""==c+""?b+"px":c+"px"});e&&alp.aEL(a,e,function(){})}else alp.setClass(a,"oax_not_overflowing",!0)});var C,E;oax.api.maps(function(a,b){var c=l("oax-small-map-container");if(c=c&&l("oax-map-canvas",c)){var d=["oa_map","oa_hybrid",b.MapTypeId.SATELLITE,b.MapTypeId.TERRAIN];E=
new a.Map(c,{center:new b.LatLng(47.8,12.1),zoom:9,mapTypeId:x?"oa_map_winter":"oa_map",mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:d}})}});alp.onDCL(function(){var a=alp.gEBCN("oax-one-video-cont",t);alp.forEach(a,function(a){new alp.x.YTPlayer({cont:a,videoid:a.dataset.source,previewUrl:a.dataset.preview,hideControls:!1,allowfullscreen:!0,initNow:!0})})});var G;alp.onDCL(function(){oa.api.maps(n)});var B,I,L;alp.onDCL(function(){function a(){m=m<d.length-1?m+1:0;B.m.highlightId.setNow(d[m])}
function b(b,c){return-1===b.parentNode.className.indexOf(oax.HIGHLIGHT)?(c&&c.preventDefault(),b=b.className,c=b.indexOf("oax-toptipps-num-"),-1!=c?(m=parseInt(b.substr(c+17)),n&&window.clearInterval(n),n=window.setInterval(function(){a()},4E3),console.log("new loop"),B.m.highlightId.setNow(d[m]),console.log("new ind: "+m)):console.error("id not found"),!1):!0}var c=alp.gEBCN("oax-toptipps-list-slide")[0];B=c?new oax.x.StaticList({proj:g.proj,top:alp.body(),snippetClass:"oax-top10-snippet",initNow:!0,
ignoreMouseover:!0,ignoreMouseout:!0,ignoreClick:!0}):new oax.x.StaticList({proj:g.proj,top:alp.body(),snippetClass:"oax-top10-snippet",initNow:!0});var d=B.getIds();alp.subDfrd(function(){return G}).then(function(){G.setOOI(d);B.setOOILayer(G)});if(c){for(var e=Math.floor(d.length/2),f=0;f<e;++f){var l=alp.gEBCN("oax-id-"+d[f])[0];2<e&&(1==f&&(l.style.marginLeft="-60px"),2==f&&(l.style.marginLeft="-40px"));l.style.zIndex=f+6E3;l.style.transform="scale("+(10-e+f)/10+")";l.style.webkitTransform="scale("+
(10-e+f)/10+")"}for(f=d.length-1;f>=e;--f)l=alp.gEBCN("oax-id-"+d[f])[0],2<e&&(f==d.length-1&&(l.style.marginLeft="-60px"),f==d.length-2&&(l.style.marginLeft="-40px")),f!=e&&(l.style.transform="scale("+(10+e-f)/10+")",l.style.webkitTransform="scale("+(10+e-f)/10+")"),l.style.zIndex=d.length-1-f+6E3;var m=0;var n=window.setInterval(function(){a()},5500);B.m.highlightId.setNow(d[m]);L=b;I=alp.gEBCN("oax-top10-snippet");alp.aEL(I,"click",function(a){a||(a=window.event);L(a.target||a.srcElement,a)})}else I=
alp.gEBCN("oax-top10-snippet");var p=k(C,g);oa.api.maps(function(){h(p,B,{coverflowCont:c})})});alp.onDCL(function(){oa.api.maps(q)});alp.onDCL(function(){function e(a){a=alp.gEBCN(["oax-teaser-map","oax-btn-show2d"],a);alp.aEL(a,"click",f)}function f(){q||(q=alp.dom.unscript(l("oax-detail-map-cont")),alp.aEL(alp.gEBCN("oax-detailmap-hide",q),"click",m),alp.orphan(alp.gEBCN(["oax-show-3d","oax-btn-show3d"],q)),r=new alp.x.Waitbox({targetInit:q,delay_ms:0}),r.startWait(),oax.api.maps(n));alp.setClass(q,
oa.NO_DISPLAY,!1);alp.setClass(alp.body(),oax.DETAILMAP_VISIBLE,!0)}function m(){alp.setClass(q,oa.NO_DISPLAY,!0);alp.setClass(alp.body(),oax.DETAILMAP_VISIBLE,!1)}function n(e,f){function m(a){alp.setClass(t,oax.NO_DISPLAY,!a);alp.setClass(v,oax.NO_DISPLAY,a)}function n(c){function m(b){var c;b&&((b=b&&b.encPolyline)?c=d.region_polygon(null,alp.arrChain(b),{noworld:!0,nofill:!0}):console.error("region_layout could not extract the REGION geometry for region "+w));c&&(b=c._alp_wens,n=a.bounds([{lat:b.south,
lng:b.west},{lat:b.north,lng:b.east}]));if(!n)throw Error("region_layout could not determine the initial map bounds. Need either data, or geometry, or both.");b=alp.nodify(oa.MAP_DETAIL,q);var m=a.bounds2zoomcenter(n,b,{padding:{left:t?2*t.offsetLeft+t.offsetWidth+"px":.1,right:.1,top:.1,bottom:.1}});b=u._map=new e.Map(b,{center:new f.LatLng(m.center.lat,m.center.lng),zoom:m.zoom,mapTypeControl:!1,mapTypeId:x?"oa_map_winter":"oa_map",zoomControl:!0,zoomControlOptions:{position:f.ControlPosition.RIGHT_TOP}});
m=oa.cfg.cfg_flexview.fill_default_and_fix_backward_compatibility(u,f);alp.nodify("oax-mlp-tmpl",u.top);u._mlpContNode=alp.nodify(u.mlpCont,u.top);u._mlpToggleNode=alp.nodify(u.mlpToggle,u.top);u._mlpCfg={initNow:!0,cont:u._mlpContNode,toggle:u._mlpToggleNode,cfg:m};u._mlp=new alp.x.MapLayerPanel(u._mlpCfg);u._mlp.setMap(u._map);u._mcpContNode=alp.nodify(u.mcpCont,u.top);u._mcpToggleNode=alp.nodify(u.mcpToggle,u.top);u._mcpTogglePlaceholderNode="string"===typeof u.mcpTogglePlaceholder?alp.nodify(u.mcpTogglePlaceholder,
u.top):u.mcpTogglePlaceholder;u._mcpContNode&&alp.orphan(u._mcpContNode);u._mcpToggleNode&&alp.orphan(u._mcpToggleNode);u._mcpTogglePlaceholderNode&&alp.orphan(u._mcpTogglePlaceholderNode);u._ovmtcoll=d.createOvmtcoll({map:u._map,oaxcfg:m,mlp:u._mlp});c?c.setMap(b):(c=(c=l("oax-region-poly"))&&c.value)&&d.region_polygon(b,c);A&&A.length?(c=new e.ClusterLayer({initDataPointList:A,defaultIW:!0}),c.setMap(b),y.setLayer(c),c.whenLoaded("stopWait",r),c=k(b,g),h(c,y)):r.stopWait()}if(c){c=b.allMaintype(c);
c=alp.map(c,b.ooi_geometry);var n=a.bounds(c)}w?b.api_region_geometry({areaid:w}).then(m):m()}var p=l(oax.SNIPPET_CONTAINER),t=alp.nodify("oax-detailpane-wrapper",q),v=alp.nodify("oax-dp-toggled",q),z=["oax-id","oax-dp-snippet"];t&&!alp.sTrim(alp.textContent(t))&&(t.innerHTML=p.innerHTML);t&&v&&(alp.aEL(alp.gEBCN("oax-toggle-dp-close",t),"click",alp.bindF(m,null,!1)),alp.aEL(alp.gEBCN("oax-toggle-dp-open",v),"click",alp.bindF(m,null,!0)));if(t){alp.setClass(alp.children(t),z,!0);var y=new oax.x.StaticList({proj:g.proj,
top:t,snippetClass:z,initNow:!0}),A=y.getIds();(A.length||null).toPrecision.call.a;alp.forEach(y.getSnippets(),c.anchor.wrap_ooi_snippet);b.api_oois_minimal({project:g&&g.proj||alp.sub("oa.API_CFG.proj"),idlist:A}).then(n)}else n()}var q,r;p.register_map_opener=e;e()});alp.onDCL(function(){var a=l("oax-region-children");if(a){var b=a&&alp.gEBTN("li",a),c=l("oax-regionchild-map-container"),d=c&&alp.nodify("oax-map-canvas",c);d&&b&&0<b.length?m.regionChildrenMapInstall({cont:a,map:d,mapTypeIds:x?["oa_map_winter"]:
["oa_map"],waitForVisibility:!0}):(b=alp.gEBI("oax-regions-map"),null===b.previousElementSibling?(a=b.parentElement,alp.orphan(alp.gEBI("oax-tab3",a.parentElement)),alp.orphan(a.previousElementSibling),alp.orphan(a)):(alp.orphan(b),alp.orphan(a),alp.orphan(c)))}});(y=alp.nodify(oa.SHARE_BTN,t))&&new oax.x.ShareBtn({proj:g.proj,node:y,initNow:!0,do_not_track:!0});y=alp.gEBCN(oa.FAV_BTN,t);y.length&&("georegion"===g.frontendtype&&new oax.x.FavBtn({proj:g.proj,node:y,contentid:g.id,frontendType:g.frontendtype,
initNow:!0}),alp.setClass(y,oa.NO_DISPLAY,"georegion"!==g.frontendtype))})})();"undefined"!==typeof dojo&&dojo.provide("oa.tmpl");
(function(){var k=alp.sub("oa.tmpl",null,!0),h,g=oa.util;k.hut_bedCount=function(f,e,d,b,c){var a="";0<f.mountainHut.bedCount?(1==c&&(a=a+d+": "),a+=f.mountainHut.bedCount):0==f.mountainHut.bedCount?a=1==c?a+d+": "+b:a+"-":1==f.mountainHut.isWithAccommodation&&(1==c&&(a=a+d+": "),a+=e);return a};k.hut_accessibility=function(f,e){f=alp.sub("mountainHut.properties.property",f)||[];f=alp.map(f,".tag");var d=alp.arr2oSimple(f);return alp.map(["accessibleByCar","accessibleByCableway"],function(b){return'<span class="oax_centered '+
e+b+'">'+(b in d?'<span class="oax-icon-checkmark"></span>':'<span class="oax_block oax_centered oax_dark">&ndash;</span>')+"</span>"}).join(" ")};k.primary_image=function(f,e){function d(b){return alp.tmpl('<img alt="${title}" title="${title}"'+(b.width&&b.height?' width="'+b.width+'" height="'+b.height+'"':"")+(b.cssClass?' class="'+b.cssClass+'"':"")+" src=${src} >",b)}var b=f.primaryImage||null;e=alp.mixCheck({path:"",suffix:"img2/${id}/${width}x${height}r/thumb.jpg",width:420,height:237,cssClass:"",
dflt_path:"",dflt_suffix:"v3/default/snippet.png",dflt_title:"Default"},e);return b?d(alp.oCreateMix(b,{src:e.path+alp.tmpl(e.suffix,alp.oCreateMix(b,e)),title:f.title})):e.dflt_path?d({title:e.dflt_title,src:e.dflt_path+e.dflt_suffix}):""};k.tour_difficulty=function(f,e,d,b,c){e='<span class="oax_abstractDifficulty '+e+'">';f=alp.oGet(f,"difficulties.difficulty");var a="";if(f){for(var g=f.length,h=0;h<g;h++){var k=f[h];if("defaultDifficultyScale"==k.name){if(!c){0!=h&&(a+=", ");k=parseInt(k.value);
for(var n=0;n<k;n++)a+='<span class="oax-icon-dot oax_dots '+d+'"></span>';for(n=b;n>k;n--)a+='<span class="oax-icon-dot oax_dots"></span>'}}else a=0==h?e:a+", ",a+=k.value,h+1==g&&(a+="</span>")}0<a.length&&(a+="</span>");return a}return c?"":'<span class="oax_font_gray">&ndash;</span>'};k.region_title=function(f,e){e=e||{};f=alp.oGet(f,"regions.region");var d="";if(f)for(var b=0;b<f.length;b++){var c=f[b].name;if("undefined"!=typeof c){d=(e.prefix||"")+c+(e.suffix||"");break}}return 0==d.length&&
e.fallback?e.fallback:d};k.location_text=function(f){var e=f.location.address.town;e=(f=f.location.details)?f:e;return"undefined"!=typeof e?alp.htmlCut(e,100):""};k.rating=function(f,e,d,b,c,a,g,h){var k=alp.oGet(f,"rating.communityRating");if((f=alp.oGet(f,"rating.communityRatingCount"))&&0<f){h='<span class="oax_bg_stars oax_fl">';for(var l=Math.round(k-.25),m=0;m<l;m++)h=h+'<span class="'+e+" "+d+" "+b+'" ></span>';.25<k-l&&(h=h+'<span class="'+c+'"> <span class="'+a+" "+d+" "+b+'"></span> <span class="'+
g+" "+d+'"></span> </span>',l++);if(5>l)for(m=0;m<5-l;m++)h=h+'<span class="'+e+" "+d+'" ></span>';return h+'</span><span class="oax_short_ratingCount oax_line_height_18 oax_font_small oax_fl oax_bold">('+f+")</span>"}return h?'<span class="oax_line_height_18 oax_font_small oax_fl oax_bold">(0)</span>':""};k.state=function(f,e,d,b){f=f.opened;return"undefined"!=typeof f?f?'<span class="oax_green_bar oax_square"></span>'+e:'<span class="oax_red_bar oax_square"></span>'+d:b};k.workflow=function(f,e,
d){var b=alp.oGet(f,"meta.workflow.state");if("undefined"!=typeof b)return"published"===b?(e='<span class="oax_fl oax_marg_right_10"><span class="oax_green_bar oax_square oax_marg_right_10"></span>'+e+"</span>",(f=alp.oGet(f,"meta.date.firstPublish"))&&(e=e+'<span class="oax_fr oax_dark">'+alp.date2str(alp.str2date(f,"{YYYY}-{MM}-{DD}"),"{DD}.{MM}.{YYYY}")+"</span>"),e):'<span class="oax_fl"><span class="oax_red_bar oax_square oax_marg_right_10"></span>'+d+"</span>"};k.literature_scaleOrCategory=
function(f,e,d,b,c){var a=f.scale;if("undefined"!=typeof c){if("undefined"!=typeof a)return'<td class="oax_s2_deprecated oax_pad_left_10 oax_fixed_width">'+e+'</td><td class="oax_text_right oax_pad_right_10">1:'+a+"</td>";e='<td class="oax_s2_deprecated oax_pad_left_10 oax_fixed_width">'+d+"</td>";return e="undefined"!=typeof f.category?e+'<td class="oax_text_right oax_pad_right_10 oax_ellipsis">'+f.category.name+"</td>":e+'<td class="oax_text_right oax_pad_right_10 oax_ellipsis">'+b+"</td>"}return"undefined"!=
typeof a?e+" 1:"+a:"undefined"!=typeof f.category?(b=f.labels,(b&&b.premium?'<span class="oax_premium_label oax_marg_right_5 oax_marg_bottom_6"></span>':"")+f.category.name):""};k.teamactivity_commonApproach=function(f,e){var d=f.commonApproach;f="";if("undefined"!=typeof d){f=d.isCommonApproachByCar?"oax-icon-car":"oax-icon-train";var b=d.place,c=d.timeOfMeeting,a=d="";b&&c&&(d=", ");if(c){var g=alp.date2str(alp.str2date(c,"{YYYY}-{MM}-{DD}"),"{DD}.{MM}.{YYYY}");c=alp.date2str(alp.str2date(c,"{YYYY}-{MM}-{DD}T{hh}:{mm}:{ss}"),
"{hh}:{mm}");g&&c&&(a=", ");c=g+a+c}f=e+'<div class="oax_ellipsis"><span class="oax_marg_right_3 '+f+'"></span>'+b+d+c+"</div>"}return f};k.teamactivity_timeOfStartActivity=function(f,e){f=f.timeOfStartActivity;var d="";if("undefined"!=typeof f){var b=alp.opt(h,"date2str_hh_mm_verbose");d=alp.opt(h,"weekdays");b=e?b:"{hh}:{mm}";e=alp.date2str(alp.str2date(f,"{YYYY}-{MM}-{DD}"),"{DD}.{MM}.{YYYY}");b=alp.date2str(alp.str2date(f,"{YYYY}-{MM}-{DD}T{hh}:{mm}:{ss}"),b);f=alp.str2date(f,"{YYYY}-{MM}-{DD}").getDay();
d=d.split(",")[f]+", "+e+", "+b}return d};k.teamActivity_pluralize_comeAlong=function(f,e,d,b){var c=parseInt(f,10);if(isNaN(c))return"";f='<span class="oax_rounded_label">'+f+"</span> ";return alp.i18n.n2str(c,[["0",e,f],["1",d,f],["true",b,f]])};k.payment_details=function(f){return alp.reduce(f.detail,"v += '<li><span class=\"oax_fl\">' + w[0] + '</span><span class=\"oax_fr\">' + w[1] + '</span><span class=\"oax_clear\"></span></li>'","")};k.lift_type=function(f){f=f.liftType;var e=alp.gEBCN("oax-lift-type-icon-mapping"),
d="";f&&e&&(d=alp.oFrom(e[0]&&e[0].value||"{}")[f]||f);return d};g.to(alp.i18n.fetch("alp.all"),function(f){h=f})})();"undefined"!==typeof dojo&&dojo.provide("oax.util.info");
(function(){var k=alp.sub("oax.util.info",null,!0),h=alp.view.modalwin;k.setup=function(f){f.childNodes.a;alp.forEach(alp.gEBCN("oax-open-info"),function(e){function d(){var b=alp.nodify("oax-open-info-opt",e),a=alp.nodify("oax-open-info-html",e).innerHTML;b=alp.mix({html:a,title:e.title,height:500,width:500},b&&alp.oFrom(b.value));h.open(b)}e.childNodes.a;var b=alp.dataset(e);b[g]||(b[g]=!0,alp.aEL(e,"click",d))})};var g="oax_util_info_installed"})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.activity_from_dom");
(function(){function k(f){function e(a){return a&&"object"===typeof a&&alp.orIn(a,d)}function d(a){return null==a||e(a)}var b=alp.cfg.datatype(),c;alp.forEach(f,function(a){e(a)&&console.error("alp._gmap2_3.digitize.activity_from_dom: found some nulley values in the activity object:",a);var d=a.id,f=a.name,k=a.iconUrl,n=a&&a.routing||{};a=alp.opt(n,h.DATATYPE_CFG_ROUTING_ENTRIES(),!0);(n=n[g]||n.routingEngine)&&(a[g]=n);n=b[f]||(b[f]=alp.oCreate(b[b._default]));c||(c=f);n.id=d;n.name=f;n.iconUrl=
k;alp.mix(n,a)});c&&(b._default=c);return b}var h=alp.sub("alp._gmap2_3.digitize",null,!0),g=h.ROUTING_ENGINE();h.activity_from_dom=function(f){var e={};e._actopt=alp.gEBTN("option",f);e._actarr=alp.map(e._actopt,'alp.mix( alp.oFrom(alp.opt(alp.dataset(v),"jsoninfo")||v.value), { index : i, title : alp.textContent( v ) } )');e._actnamearr=alp.map(e._actarr,".name");e._actobj=alp.mix(alp.arr2o(e._actarr),alp.arr2o(e._actarr,alp.f(".name")));e._actdtcfg=k(e._actarr);return e}})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.interface_simple_change_gui");
(function(){function k(){alp.forEach("string"===typeof e?[e]:e,function(b){alp.ensureCss(b)});k=function(){}}function h(){return alp.gEBI(f)||alp.cE("div",alp.body(),{id:f,style:"display : none;"},{innerHTML:'  <div class="wp">\n    <span class="wp-icon s5 js-tp-node-label wp-draggable js-tp-node-draggable"></span>\n    <input class="wp-value s6 js-tp-node-address" type="text" value=""/>\n    <span class="wp-dnd wp-draggable js-tp-node-draggable" title="Verschieben"><img src="'+alp.cssBase()+'alp/images/mg_dnd_arrow.png" alt="Verschieben" title="Verschieben"></span>\n    <span class="wp-close js-tp-node-close" title="Entfernen"><img src="'+
alp.cssBase()+'alp/images/mg_close_x.png" title="Entfernen" alt="Entfernen"></span>\n  </div>\n  <div class="clear"></div>\n  \n  <div class="wp-nextleg">\n    <div class="wp-dupli-datatype fl"><img src="http://res.oastatic.com/icons/alpstein/hikingTourTrail/green_chili/hikingTourTrail.standard.png" alt="" title="" style="visibility: hidden"></div> \n    <div class="wp-options" style="display: none;"></div>\n  </div>\n  \n  <div class="clear"></div>'})}function g(){return!alp.nodify("wp-nextleg-new",
h())&&alp.nodify("wp-nextleg",h())}var f=alp._gmap2_3.digitize.NEW_GEOCODER_NODE_TEMPLATE(),e=[alp.cssBase()+"alp/_gmap2_3/digitize/resources/digitize.css",alp.cssBase()+"alp/gmap/resources/gmap.css",alp.cssBase()+"alp/_gmap2_3/layer/tour_edit_layer.css"],d=alp.i18n.fetch("alp.all"),b=alp._gmap2_3.digitize._i18n.ctn;alp.ensureCss(alp.cssBase()+"alp/_gmap2_3/digitize/interface_simple_change_gui.css");alp.sub("alp._gmap2_3.digitize",null,!0).InterfaceSimpleChangeGui={_static:{},_imr_change_gui:function(){function c(a){if(!a.firstChild){a=
alp.cE("table",a);a=alp.cE("tbody",a);var b=alp.cE("tr",a);a=alp.cE("td",b);b=alp.cE("td",b);alp.cE("img",a,{src:"http://res.oastatic.com/icons/alpstein/hikingTourTrail/green_chili/hikingTourTrail.standard.png","class":"js-digitize-datatype-icon"});a=alp.cE("select",b,{"class":"js-digitize-datatype-select"});alp.cE("option",a,{value:"hiking"},{innerHTML:"Wandern"})}}function a(){var a=g();0<alp.gEBCN("js-tp-node-legdetails",a).length||(alp.cE("div",a,{"class":"clear"}),alp.cE("div",a,{"class":"js-tp-node-legdetails",
style:"float: right; display: none;"}));alp.cE("div",a,{"class":"clear"});var b=alp.nodify("wp-legdetails",a);b||(b=alp.cE("div",a,{"class":"wp-legdetails"}));b.firstChild||(alp.cE("div",b,{"class":"timeplan"}),alp.cE("div",b,{"class":"clear"}),alp.cE("div",b,{"class":"js-tp-node-legdetails",style:"float: right;"}),alp.cE("div",b,{"class":"clear"}));alp.cE("div",a,{"class":"clear"})}var e=this.config,l=e&&e.extension;e.own_css&&k();if(l){l.segment_suboption_class=l.segment_suboption_class||"tp-segment-suboption";
l.segment_network_mode_table_class=l.segment_network_mode_table_class||"js-tp-segment-network-mode-table";null==l.segment_pt_options&&(l.segment_pt_options=l.public_transport);if(l&&l.datatype)if(0<alp.gEBCN("js-digitize-datatype-global").length)alp.forEach(alp.gEBCN("js-digitize-datatype-global"),c);else if(e=(e=alp.gEBCN("tp-text",alp.gEBI("dp-inner")))&&e[e.length-1]){var r=alp.cE("div",null,{"class":"js-digitize-datatype-global"});c(r);alp.place(r,e,"before")}e=g();if(l&&l.segment_network&&e&&
l.public_transport&&!(0<alp.gEBCN("js-tp-node-public-transport",e).length)){r=alp.nodify("wp-dupli-datatype",e);var n=alp.cE("div",null,{"class":"js-tp-node-public-transport",style:"float: left;",title:"\u00d6PNV"});alp.place(n,r||e,r?"after":"first");alp.sub("alpregio")&&alpregio.Hub&&alp.place(alp.cE("a",null,{href:"#infoTourplannerOepnvDialog","class":"dialoglink dialog-info fl info-tp-pubtrans-dialoglink",rel:"[450,375],nofollow",title:" Info - Verkn\u00fcpfung mit \u00f6ffentlichen Verkehrsmitteln (\u00d6V)"},
{innerHTML:"Info"}),n,"after")}if(l&&l.public_transport&&l.segment_pt_options&&((e=alp.nodify("wp-options",alp.gEBI(f)))||(e=alp.nodify("wp-options",h())),e&&1>alp.gEBCN("js-tp-node-digitize-ptoptions",e).length)){r=alp.cE("div",null,{"class":"js-tp-segment-ptoptions-cont tp-segment-suboption"});n=alp.cE("span",r,{"class":"js-tp-segment-ptoptions-title"});var q=alp.cE("strong",n);n=b({i18n_dfrd:d,i18n_key:"segmentPTOptionsTitle"});q.appendChild(n);alp.cE("div",r,{"class":"clear"});alp.cE("input",
r,{type:"checkbox","class":"js-tp-segment-ptoptions-with-bike-cb"});n=alp.cE("span",null,{"class":"js-tp-segment-ptoptions-with-bike-label js-tp-node-click-label"});n.appendChild(b(" "));n.appendChild(b({i18n_dfrd:d,i18n_key:"segmentPTOptionsWithBike"}));r.appendChild(n);alp.cE("div",r,{"class":"clear"});alp.cE("input",r,{type:"checkbox","class":"js-tp-segment-ptoptions-rail-only-cb"});n=alp.cE("span",null,{"class":"js-tp-segment-ptoptions-rail-only-label js-tp-node-click-label"});n.appendChild(b(" "));
n.appendChild(b({i18n_dfrd:d,i18n_key:"segmentPTOptionsRailOnly"}));r.appendChild(n);e.appendChild(r);alp.cE("div",e,{"class":"clear"})}if(l&&l.segment_datatype){(e=alp.nodify("wp-options",alp.gEBI(f)))||(e=alp.nodify("wp-options",h()));r=alp.gEBCN("js-digitize-datatype-global")[0];if(e&&1>alp.gEBCN("js-tp-node-digitize-datatype",e).length&&r){n=r.cloneNode();n.innerHTML=r.innerHTML;alp.setClass(n,alp.arr2o([["js-digitize-datatype-global",!1],["js-tp-node-digitize-datatype",!0]],0,1));r=alp.cE("div",
null,{"class":"js-tp-segment-activity-cont tp-segment-suboption"});var p=alp.cE("span",r,{"class":"js-tp-segment-activity-title"});q=alp.cE("strong",p);p=b({i18n_dfrd:d,i18n_key:"segmentActivityTitle"});q.appendChild(p);r.appendChild(n);l.segment_datatype_property&&(alp.cE("div",r,{"class":"clear"}),n=alp.cE("div",r,{"class":"js-tp-segment-property-cont"}),alp.cE("div",n,{"class":"js-tp-segment-property-button segment-network"}),alp.cE("div",n,{"class":"clear"}),alp.cE("div",n,{"class":"js-tp-segment-property-button segment-short"}),
alp.cE("div",n,{"class":"js-tp-segment-property-button segment-fast"}),alp.cE("div",n,{"class":"js-tp-segment-property-button segment-flat"}),alp.cE("div",r,{"class":"clear"}));l.segment_datatype_property&&(alp.cE("div",r,{"class":"clear"}),b({i18n_dfrd:d,i18n_key:"segmentPropertySpeedTitle"},alp.cE("span",r,{"class":"js-tp-segment-property-speed-title"})),q=alp.cE("strong",r),b(" ",q),b("5",alp.cE("span",q,{"class":"js-tp-segment-property-speed-number"})),b(" ",q),b("km/h",alp.cE("span",q,{"class":"js-tp-segment-property-speed-kmh"})),
alp.cE("div",r,{"class":"clear",style:"height : 5px;"}),alp.cE("div",r,{"class":"js-tp-segment-property-speed-slider"}),alp.cE("div",r,{"class":"clear"}),n=alp.cE("div",r,{"class":"js-tp-segment-property-speed-slider-legend"}),b({i18n_dfrd:d,i18n_key:"segmentPropertySpeedSlow"},alp.cE("span",n,{"class":"js-tp-segment-property-speed-slow"})),b({i18n_dfrd:d,i18n_key:"segmentPropertySpeedNormal"},alp.cE("span",n,{"class":"js-tp-segment-property-speed-normal"})),b({i18n_dfrd:d,i18n_key:"segmentPropertySpeedFast"},
alp.cE("span",n,{"class":"js-tp-segment-property-speed-fast"})),alp.cE("div",r,{"class":"clear"}));e.appendChild(r);alp.cE("div",e,{"class":"clear"})}l.segment_datatype_hide_gui&&alp.style(alp.gEBCN("js-tp-segment-activity-cont",e),{display:"none"})}if(l)var v=h();e=g();if(l&&l.segment_network&&e){n=alp.cE("span",null,{"class":"js-tp-node-digitize-engine-select"});alp.cE("span",n,{"class":"js-tp-node-digitize-engine-select-title"});p=alp.nodify("wp",v);e=alp.nodify("wp-options",v);n.appendChild(alp.cE("span",
null,null,{innerHTML:"&#9660;"}));r=alp.cE("div",null,{"class":"js-tp-segment-network-cont tp-segment-suboption"});q=alp.cE("span",r,{"class":"js-tp-segment-network-title"});q=alp.cE("strong",q);var u=b({i18n_dfrd:d,i18n_key:"segmentNetworkTitle"});q.appendChild(u);alp.cE("div",r,{"class":"clear"});q=alp.cE("table",r,{"class":l.segment_network_mode_table_class});q=alp.cE("tbody",q);u=alp.cE("tr",q);alp.cE("td",u,{"class":"js-tp-segment-network-routed-button js-tp-segment-network-col0"});alp.cE("td",
u,{"class":"js-tp-segment-network-manual-button js-tp-segment-network-col1"});var t=alp.cE("tr",q);q=alp.cE("td",t,{"class":"js-tp-segment-network-routed-text js-tp-segment-network-col0"});u=b({i18n_dfrd:d,i18n_key:"leg_option_routed"});t=alp.cE("td",t,{"class":"js-tp-segment-network-manual-text js-tp-segment-network-col1"});var w=b({i18n_dfrd:d,i18n_key:"leg_option_manual"});q.appendChild(u);q.appendChild(alp.cE("br"));q.appendChild(n);t.appendChild(w);l&&l.options&&l.segment_network&&!(0<alp.gEBCN("js-tp-node-options",
p).length)?(n=alp.cE("div",null,{"class":"js-tp-node-options",style:"float: right;"}),alp.place(n,e,"before"),alp.place(alp.cE("div",null,{"class":"clear"}),n,"after"),alp.place(r,e,"last"),alp.cE("div",e,{"class":"clear"}),alp.cE("div",e,{"class":"clear"})):alp.place(r,p,"last")}if(e=alp.nodify("wp-options",v))alp.cE("div",e,{"class":"clear"}),alp.cE("div",e,{"class":"js-tp-node-options",style:"float: right;"}),alp.cE("div",e,{"class":"clear"});e=g();l&&l.details&&e&&a()}}}})();
"undefined"!==typeof dojo&&dojo.provide("alp.view.img");
(function(){alp.declare("alp.view.Img",null,function(k){var h=this;alp.mix(h,k);h.name_st||(h.name_st=new alp.ModeState({modeSet:alp.arr2o(k.entries,"name",alp.f("1"))}));h.visible_st||(h.visible_st=new alp.BoolState({init_value:!0}));h._dict={};alp.forEach(h.entries,function(g){h._dict[g.name]=g.img});h._eh=new alp.Eh;h._optim_speed()},alp.util.InterfaceWithInit,{img_q:null,entries:null,img_class:function(k){return"js-img-"+k},name_st:null,visible_st:null,initImpl:function(){function k(g,f){h.visible_st.get()?
alp.forEach(h._noli,alp.show):alp.style(h._noli,{visibility:"hidden"});(g=g||h.name_st.get())&&alp.sA(h._noli,"src",h._dict[g]);alp.forEach(h._noli,function(e){alp.setClass(e,alp.arr2o([[h.img_class(g),!0],[h.img_class(f),!1]],0,1))})}var h=this;h._noli=alp.nodelist(alp.fVal(h.img_q));h._eh.clear().push(alp.m(h.name_st,["change_cb","changed_cb"],k)).push(alp.m(h.visible_st,["change_cb","changed_cb"],function(){k()}));k();h.mark_init_done()},_optim_speed:function(){for(var k=this.entries,h=0,g=Math.min(20,
k.length);h<g;h++)k[h].img?alp.imgPreload(k[h].img):console.error("alp.view.img: invalid img url for ",k[h])}})})();"undefined"!==typeof dojo&&dojo.provide("alp.view.selector");
(function(){alp.declare("alp.view.Selector",null,function(k){var h=this;if(k.from_dom||!k.entries){var g=alp.nodelist(alp.fVal(k.node_q))[0];g=g&&alp.gEBTN("option",g);var f=alp.e(k.from_dom&&"string"===typeof k.from_dom?k.from_dom:".value");k.entries=alp.map(g,"alp.oFrom( "+f+" )")}h.cfg=alp.oCreateMix({disabled_css_class:"js-selector-disabled",enabled_css_class:"js-selector-enabled",sort_by_title:!1,do_not_force_show:!1,from_dom:!1},k);h.name=h.cfg.name||new alp.ModeState({modeSet:alp.arr2o(k.entries,
"name",alp.f("1")),init_value:k.init_value});h.disabled_st=new alp.BoolState({init_value:k.disabled});h._entries_obj={};alp.forEach(k.entries,function(e,d){h._entries_obj[e.name]=alp.oCreateMix(e,{ind:d})})},{entry_title:function(k){return"function"===typeof k.title?k.title(k.name):k.title},entry_name_2_ind:function(k){return this._entries_obj[k].ind},entry_ind_2_name:function(k){return this.cfg.entries[k].name},getEntry:function(k){k||(k=this.name.get());return k&&this._entries_obj[k]},init:function(){function k(){var g=
{},f=h.cfg,e;for(e in f.entries)if(!(e in g)){var d=f.entries[e];if("function"==typeof d.title&&null==d.title())return}return!0}var h=this;h.cfg.from_dom?h._init_impl():alp.subDfrd(k).then(alp.bindF("_init_impl",h))},_init_impl:alp.nowF(function(){var k=this,h=k._eh();h.clear();alp.forEach(alp.nodelist(alp.fVal(k.cfg.node_q)),function(g){k.cfg.sort_by_title&&k.cfg.entries.sort(function(d,b){d=k.entry_title(d);b=k.entry_title(b);return d<b?-1:d>b?1:0});if(!k.cfg.from_dom||!g.firstChild){var f=document.createDocumentFragment();
alp.forEach(k.cfg.entries,function(d){alp.cE("option",f,{value:d.name},{innerHTML:k.entry_title(d)})});alp.empty(g);alp.aC(g,f)}var e=k.name.get();e?g.selectedIndex=k.entry_name_2_ind(e):k.name.set(k.entry_ind_2_name(g.selectedIndex));h.push(alp.aEL(g,"change",function(){k.name.setNow(k.entry_ind_2_name(g.selectedIndex))}));h.push(alp.m(k.name,["change_cb","changed_cb"],function(d){g.selectedIndex=d?k.entry_name_2_ind(d):-1}));k._connect_disable(g);k.cfg.do_not_force_show||k._show(g)})}),_eh:alp.memM("_eh",
"new alp.Eh()"),_connect_disable:function(k){var h=this;h._eh().push(alp.m(h.disabled_st,["change_cb","changed_cb"],function(g){g?k.setAttribute("disabled","disabled"):k.removeAttribute("disabled");alp.setClass(k,alp.arr2o([[h.cfg.disabled_css_class,g],[h.cfg.enabled_css_class,!g]],0,1))}))},_show:function(k){alp.show(k)}})})();"undefined"!==typeof dojo&&dojo.provide("alp.view.selector_with_img");
(function(){var k=alp.declare("alp.view.SelectorWithImg",alp.view.Selector,function(h){alp.forEach(this.cfg.entries,"v.img  ||  (v.img = v.iconUrl);");this._img=new alp.view.Img(alp.oCreateMix(h,{name_st:this.name}))},{init:function(){k.parent.prototype.init.apply(this,arguments);this._img.init()}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.interface_simple_datatype_selector");
alp.sub("alp._gmap2_3.digitize",null,!0).InterfaceSimpleDatatypeSelector={_create_datatype_selector:function(){var k=this.config,h={},g=k.datatype_cfg;h.node_q=function(){return alp.fVal(k.datatype_node_select,alp.nodelist(alp.fVal(k.datatype_node_cont))[0])};h.img_q=function(){return alp.fVal(k.datatype_img_select,alp.nodelist(alp.fVal(k.datatype_node_cont))[0])};h.name=this.state.datatype;h.sort_by_title=k.datatype_sort_by_title;h.do_not_force_show=k.datatype_do_not_force_show;h.from_dom=k.datatype_from_dom;
if(!h.name)throw Error("Call _init_datatype first!");h.from_dom?h.entries=null:(h.entries=[],alp.forIn(h.name.modeSet,function(f,e){e&&"string"===typeof e?((e||null).substring.call.a,(f=g[e])?h.entries.push({name:e,title:f.title,img:f.iconUrl}):console.error('alp._gmap2_3.digitize.simple._create_datatype_selector(): Unknown datatype name "'+e+'". Skipping it.')):console.error("alp._gmap2_3.digitize.simple._create_datatype_selector(): datatype_name must be a non-empty string. Instead, I received an empty/invalid ("+
typeof e+") datatype name: "+e)}));this.datatype_selector=new alp.view.SelectorWithImg(h);return h}};"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.interface_simple_init_original_geojson_cb");
alp.sub("alp._gmap2_3.digitize",null,!0).InterfaceSimpleInitOriginalGeojsonCb={_init_original_geojson_cb:function(){var k=this,h=k.config,g=k._show_original_st=new alp.BoolState({init_value:!(!h||!h.original_geojson_init)});(function(){var f=alp.fVal(h&&h.original_geojson_checkbox);f&&(alp.forEach(f,function(e){e.checked=g.get()}),alp.forEach(f,function(e){alp.aEL(e,"click",alp.nowF(function(d){d||(d=window.event);d=d&&(d.target||d.srcElement);g.set(d&&d.checked)}))}),alp.m(g,["change_cb","changed_cb"],
function(e){alp.setProp(f,"checked",e)}))})();(function(){var f=h&&h.original_geojson_cb_container,e=f&&alp.nodelist(f);e&&(f=function(){var d=!!k._original_st.get();alp.style(e,{display:d?"":"none"})},f(),alp.m(k._original_st,["change_cb","changed_cb"],f))})();(function(){function f(){var a=d.get();e&&(e.setMap(null),e=null);a=a&&k._original_st.get();var f=k.config.original_geojson_polystyle;if(a===b)var g=c;else{var h=a&&a.coordinates,n=a&&a.encPolyline;h?g=alp._gmap2_3.xy2latlng(h):n&&(g=alp._gmap2_3.xy2latlng(alp._gmap2_3.decodePolyline(n).xy));
g&&(b=a,c=g)}g&&(e=new alp._gmap2_3.polylineGen({map:k.map,path:g,strokeColor:f.color,strokeWeight:f.weight,strokeOpacity:f.opacity,clickable:!1}))}var e,d=alp.andState([k._original_st,k._show_original_st]),b,c;f();alp.m(d,["change_cb","changed_cb"],f)})()}};"undefined"!==typeof dojo&&dojo.provide("alp.x.menu");
(function(){function k(g,f){function e(b){b||(b=window.event);g.hide();var c=f.onclick;c&&(c instanceof alp.x.Menu||"object"===typeof c&&"function"===typeof c.show?c.show(b):"function"===typeof c&&alp.now(c,null,f))}if(!f)return alp.cE("hr",null,{"class":g.separator});f.label.substring.a;var d=alp.cE("div",null,{"class":g.entry},{innerHTML:f.label});alp.setClass(d,g.enabled,!f.disabled);alp.setClass(d,g.disabled,f.disabled);alp.setClass(d,g.selected,f.selected);f.disabled||alp.aEL(d,"click",e);return d}
alp.sub("alp.x",null,!0);alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp.x.Menu",null,function(g){alp.mixCheck(this,g);this._contNode=alp.cE("div",null,{"class":this.cont});this._arr=[]},{cont:"alp-x-menu",entry:"alp-x-menu-entry",separator:"alp-x-menu-separator",selected:"alp-x-menu-selected",enabled:"alp-x-menu-enabled",disabled:"alp-x-menu-disabled",add:function(g,f){var e=k(this,g);g={entry:g,domnode:e};"number"===typeof f?(this._arr.splice(f,0,g),this._contNode.insertBefore(e,this._contNode.childNodes[f])):
(this._arr.push(g),alp.aC(this._contNode,e));return this},modify:function(g){"string"===typeof g&&(g=alp.f(g));for(var f=this._arr,e=f.length;e--;){var d=f[e],b=g(d.entry),c="object"===typeof b;if(!1===b||c)f.splice(e,1),alp.orphan(d.domnode);c&&this.add(c,e)}return this},show:function(g){g||(g=window.event);h&&h.hide();h=this;if("parentNode"in g){g=alp.gWindowScroll();var f=alp.gBCR(f);g={left:g.left+f.left,top:g.top+f.top}}else if(!("left"in g&&"top"in g)){alp.stopEvent(g);f=g.clientX;var e=g.clientY;
f.toPrecision.call.a;e.toPrecision.call.a;g=alp.gWindowScroll();g={left:g.left+f,top:g.top+e}}alp.style(this._contNode,{position:"absolute",left:g.left+"px",top:g.top+"px"});alp.aC(alp.body(),this._contNode);this._bodyh=alp.aEL(document,"click",alp.bindF("hide",this));return this},hide:function(){this._bodyh&&(alp.rEL(this._bodyh),delete this._bodyh);alp.orphan(this._contNode);return this},isVisible:function(){return h===this&&this._contNode&&alp.isDescendant(this._contNode,alp.body())}});var h})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.interface_simple_menu");
(function(){var k=alp.sub("alp._gmap2_3.digitize",null,!0),h={};k._i18n.dfrd.then(function(g){h=g});k.InterfaceSimpleMenu={_getFormMenuItems:function(g,f,e){var d=this.itemController;d&&d.startExtending&&d.stopExtending&&!g._alpExtendAdded&&(g.add(),g.add({label:h.contextExtendFeature,disabled:d.isExtending&&!d.isRouting,onclick:function(){d.isExtending&&d.stopExtending();d.startExtending(!0,!1)}}),d.getModel().supportsRouting&&g.add({label:h.contextExtendFeatureRouted,disabled:d.isExtending&&d.isRouting,
onclick:function(){d.isExtending&&d.stopExtending();d.startExtending(!0,!0)}}),g._alpExtendAdded=!0)}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.interface_simple_routing_message");
(function(){var k=alp._gmap2_3,h={};alp.i18n.fetch("alp.all").then(function(f){h=f});alp.ensureCss(alp.cssBase()+"alp/x.css");var g=alp.cfg.image().loadbar;alp.sub("alp._gmap2_3.digitize",null,!0).InterfaceSimpleRoutingMessage={ROUTING_ERROR_ID_PREFIX:"routing_error_dialog",setRoutingStartMessage:function(f){this._routingStartMessage=f||this.config.routingStartMessage},onRoutingStart:function(f){var e;(e=this.config)&&e.routing_user_message_fun&&(this._routing_t=this._routing_t||[],this._routing_t.push(f.t),
this._update_routing_user_message(e.routing_user_message_fun("start",f)),alp.asyncF(e.routing_user_message_max_time,function(){this.onRoutingEnd(f)},this)())},onRoutingEnd:function(f,e,d){alp.asyncF(0,"_responseMessage",this)(f,e,d);if(f)if(d=(Date.now?Date.now():+new Date)-f.t,d<this.config.routing_user_message_min_time)window.setTimeout(alp.bindF("onRoutingEnd",this,f,e),this.config.routing_user_message_min_time-d);else if((d=this.config)&&d.routing_user_message_fun&&this._routing_t){var b=alp.indexOf(this._routing_t,
f.t);-1<b&&this._routing_t.splice(b,1);1>this._routing_t.length&&this._update_routing_user_message(d.routing_user_message_fun("end",f,e))}},_init_cfg_routing_message:function(){var f=this,e=f.config;null==e.routing_user_message_fun&&(e.routing_user_message_fun=alp.sub("alpConfig.digitize.routing_user_message_fun"));null==e.routing_user_message_fun&&(e.routing_user_message_fun=function(b,a,d){return"start"===b?(b=f._routingStartMessage,(d=a&&a.routingengine_cfg)?d.re_info.startMessage():alp.fVal(b,
a)||alp.opt(a,"routingengine_name")||h.routing_start_engine_outdooractive||alp.opt(a,"networkName")||""):""});if(void 0===e.routing_user_message_button){if(alp._gmap2_3.V2()&&alp.gmap&&alp.gmap.Button&&"function"==typeof GControlPosition&&"function"==typeof GSize){var d=new alp.gmap.Button("",void 0,"adsRoutingMessageContainer","adsRoutingMessage");d.getDefaultPosition=function(){return new GControlPosition(G_ANCHOR_BOTTOM_RIGHT,new GSize(7,28))};d.setButtonStyle_=function(b){}}else{d=new alp._gmap2_3.view.AbstractMapControl;
var b=alp.cE("div",null,{"class":"adsRoutingMessageContainer adsRoutingMessage"},{innerHTML:"brejigeruigf"});d.getDiv=function(){return b}}e.routing_user_message_button=d}void 0===e.routing_user_message_min_time&&(e.routing_user_message_min_time=1500);void 0===e.routing_user_message_max_time&&(e.routing_user_message_max_time=98765)},_update_routing_user_message:function(f){var e,d;if(this.map&&(e=this.config.routing_user_message_button))if(f){if(d=k.V2()?e._alpButtonNode:e.getDiv())d.innerHTML=alp.tmpl(f,
g),k.V2()?this.map.addControl(e):e.setMap(this.map)}else k.V2()?this.map.removeControl(e):e.setMap(null)},_responseMessage:function(f,e,d){alp.sub("_instanced._responseMessage",this,!0);if("object"===typeof d){e=h;var b="directions_error_"+(d&&d.code)+"_"+(d&&d.subcode||0);(f=e&&e[b+"_text"]||(200===d.code?"":alp.tmpl(h.directions_error_default,[d&&alp.oToString(d)+(f&&" from url: "+f.url)||""])))&&alp.humane(f)}}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.interface_simple_view_only_in_3d");
alp.sub("alp._gmap2_3.digitize",null,!0).InterfaceSimpleViewOnlyIn3d={viewonlyin3d:function(){var k=alp.sub("_instanced.viewonlyin3d",this,!0),h=this.itemController||alp.sub("alp._obj.digitizor.itemController");if(h&&h.setViewOnly){var g=alp._gmap2_3.V2()?"undefined"!==typeof G_SATELLITE_3D_MAP&&alp.gmap.equalGMapTypes(this.map.getCurrentMapType(),G_SATELLITE_3D_MAP):alp.m(this.map,"is3d");g?(k._last_2d_mode=this.itemController.getMode(),h.setViewOnly(g)):(h.setViewOnly(g),(k=k._last_2d_mode)&&this.itemController.setMode(k))}else alp.asyncF(100,
"viewonlyin3d",this)()}};"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.interface_simple_tourduration_display");
alp.sub("alp._gmap2_3.digitize",null,!0).InterfaceSimpleTourDurationDisplay={_install_tourduration_display:function(){var k=this,h=k.config.tourDurationV_q,g=k.config.tourDurationH_q,f=k.config.tourDurationM_q;if(g){var e=new alp.Eh,d;alp.m(k.state.model,["change_cb_init","changed_cb_init"],function(){function b(){k._factDuration_noli=h?alp.nodelist(h):[];k._factDurationH_noli=g?alp.nodelist(g):[];k._factDurationM_noli=f?alp.nodelist(f):[];k._qf_update_duration_values(d.get())}e.clear();if(d=alp.opt(k.state.model.get(),
"duration_ms_st"))e.push(alp.m(d,["change_cb","changed_cb"],alp.ratelimitF(358,b))),e.push(alp.m(alp.opt(k,"visible"),["change_cb","changed_cb"],b)),b()})}}};"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.interface_simple_info_public_transport");alp.sub("alp._gmap2_3.digitize",null,!0).InterfaceSimpleInfoPublicTransport={open_info_pubtrans_dialog:function(k){},_install_simple_info_public_transport:function(){var k=this;k.routedmultigeocoder&&k.routedmultigeocoder.openInfoPubtransDialogEvt().then(function(h){k.open_info_pubtrans_dialog(h)})}};
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.controllers.EditController");
(function(){var k=alp._gmap2_3,h=k.digitize,g=h.EVENT_MAP_CONTEXT_MENU();alp.declare("alp._gmap2_3.digitize.EditController",h.utils.eventHelper,function(f,e){var d=this;d.map=f;d.config=e||{};d.visible=new alp.BoolState({init_value:!d.config.start_hidden});d.visible.change_cb(function(b){var c=d.activeItemController();c&&c.visible&&c.visible.set(b)},d);d._activeIC=null;d._editState=!1;d.undoStack=new h.utils.undoStack;d._eh2=new alp.Eh;d._eh2.push(h.topic("/alp/_gmap2_3/digitize/actions/undo").then(alp.bindF("undo",
d.undoStack)));d._eh2.push(h.topic("/alp/_gmap2_3/digitize/actions/redo").then(alp.bindF("redo",d.undoStack)));d._eh2.push(h.topic(g).then(alp.bindF("_onMapContextMenu",d)));d._eh.base={google:[k.event("addListener")(f,"singlerightclick",function(b){h.topic(g).trigger(b)}),k.event("addListener")(f,"resize",function(){h.topic("/alp/_gmap2_3/digitize/EditController/event/resize").trigger()})].concat(alp.map(d._MAP_EVENTS,function(b){return k.event("addListener")(f,b,function(c){/click/.test(b)&&1E3>
(Date.now?Date.now():+new Date)-d._last_menu_close_date?d._last_menu_close_date=null:h.topic("/alp/_gmap2_3/digitize/EditController/map/event/"+b).trigger(c)})})),alp_eh:(new alp.Eh).push(alp.aEL(window,"resize",function(){h.topic("/alp/_gmap2_3/digitize/EditController/event/resize").trigger()})).push(d.undoStack.actionEvt().then(function(b,c){h.topic("/alp/_gmap2_3/digitize/EditController/undoAction").trigger(b)}))};d._eh.base.google=d._eh.base.google},{_MAP_EVENTS:["singleclick","dblclick","bounds_changed"],
destroy:function(){this._disconnect();this._eh2.clear()},activeItemController:function(f){0<arguments.length&&(this._activeIC=f);return this._activeIC},setMapEditingMode:function(f){f&&!this._editState?this._editState=!0:!f&&this._editState&&(this._editState=!1)},_onMapContextMenu:function(f,e){f=k.fromLatLngToContainerPixel(this.map,f.latLng);var d=new alp.x.Menu,b=this;d.add({label:h._i18n.contextUndo,disabled:0===b.undoStack.getState()[0],onclick:function(){h.topic("/alp/_gmap2_3/digitize/actions/undo").trigger()}});
d.add({label:h._i18n.contextRedo,disabled:0===b.undoStack.getState()[1],onclick:function(){h.topic("/alp/_gmap2_3/digitize/actions/redo").trigger()}});b.activeItemController()&&b.activeItemController().populateContextMenu(d,e,f);b.config.extraMenuItems&&b.config.extraMenuItems(d,e,f);e=alp.gBCR(b.map.getDiv(),!0);var c=alp.gWindowScroll();d.show({left:c.left+(e.left+f.x),top:c.top+(e.top+f.y)});k.event("addListenerOnce")(b.map,"click",function(){d.isVisible()&&(d.hide(),b._last_menu_close_date=Date.now?
Date.now():+new Date)})}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.controllers.BaseEditController");
(function(){alp.declare("alp._gmap2_3.digitize.controllers.BaseEditController",alp._gmap2_3.digitize.utils.eventHelper,function(k,h,g){this._eh={};this._eh2=new alp.Eh;this.opts=alp.oCreateMix(this.defaultOptions,g||{});this._editController=k;this._model=h;this.modes={};this._activeMode=null},{defaultOptions:{},destroy:function(){this._disconnect();this._eh2.clear();this.destroyModes&&this.destroyModes();this.destroyViews&&this.destroyViews()},destroyModes:function(){var k=this;k.modes&&alp.forIn(k.modes,
function(h,g){h.destroy&&h.destroy();k.modes[g]=null})},getModel:function(){return this._model},_onModeChange:function(){this._eh.modeChange||(this._eh.modeChange=!0,alp.asyncF(0,"onModeChange",this)())},onModeChange:alp.nowF(function(){this._eh.modeChange=!1;this.updateStyle&&this.updateStyle();this.modeChangeEvt().triggerSoon()}),modeChangeEvt:alp.memM("modeChangeEvt",'alp.event("BEC:modeChangeEvt",{then:1})'),getMode:function(k){return k?this.modes[k]:this._activeMode},setMode:function(k){this._activeMode=
k},setViewOnly:function(k){this._viewonly!==k&&(k&&this.setMode("view"),this._viewonly=k)}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.abstract_safe_goverlay");
(function(){alp.declare("alp._gmap2_3.digitize.AbstractSafeGOverlay",null,alp.nowF(function(){var k=this;k.on_map=new alp.BoolState;k.mapSt=new alp.State;k.mapSt.change_cb(function(h,g){function f(){k._map===h&&k.initialize(h)}g&&k.remove();k._map=h;k.on_map.set(!!h);h&&(!h.whenLoaded||alp.m(h,"isLoaded")?k.initialize(h):h.whenLoaded(f))})}),alp.util.InterfaceWithInit,{setMap:function(k){this.mapSt.setNow(k)},getMap:function(k){return this.mapSt.get()},initialize:alp.nowF(function(k){var h=this;h._initialize_called_once=
!0;h.gmap=h._map=k;k.whenLoaded(function(){h.initialize_impl(k);h.mark_init_done()})}),remove:function(){this._map=null;this._initialize_called_once&&this.init_cb("remove_impl",this)},initialize_impl:function(k){throw Error("You must implement this method!");},remove_impl:function(){throw Error("You must implement this method!");},copy:function(){throw Error("You must implement this method!");},redraw:function(k){throw Error("You must implement this method!");},visible_gmap:function(){return this.on_map.get()&&
this.gmap}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.PointView");
alp.gmap3(function(k){var h=alp._gmap2_3,g=h.digitize,f=g.EVENT_MAP_CLICK(),e=g.EVENT_MAP_CONTEXT_MENU();alp.declare("alp._gmap2_3.digitize.PointView",g.AbstractSafeGOverlay,function(d,b){this._model=d;this._options=b||{}},{initialize_impl:function(d){this._map=d;this.update()},remove_impl:function(){this._marker&&this._marker.setMap(null);this._map=this._marker=null},copy:function(){return new g.PointView(this._model,this._options)},redraw:function(d){},update:function(){var d=this._model.get();
if(d)if(this._marker)this._marker.setPosition(d);else{if(this._map){var b=this._marker=this._getMarker(d);b._alpEh=new alp.Eh;b._alpEh.push(h.event("addListener")(b,"click",function(c){g.topic(f).trigger(c,b)}),h.event("removeListener"));b._alpEh.push(h.event("addListener")(b,"rightclick",function(c){g.topic(e).trigger(c,b)}),h.event("removeListener"));this._marker.setMap(this._map)}}else this._marker&&(this._marker.setMap(null),this._marker._alpEh.clear(),this._marker=null)},isOverlay:function(d){return this._marker&&
this._marker===d},getBounds:function(){if(this._marker){var d=this._marker.getPosition();return new k.LatLngBounds(d,d)}return!1},_getMarker:function(d){d=alp.oCreateMix(this._options,{position:d});return new h.marker_gen(d)}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.EditPointView");
(function(){var k=alp._gmap2_3,h=k.digitize,g=h.EVENT_MAP_CLICK(),f=h.EVENT_MAP_CONTEXT_MENU();alp.declare("alp._gmap2_3.digitize.EditPointView",h.AbstractSafeGOverlay,function(e,d){this._model=e;this._options=d;this._marker=null},{initialize_impl:function(e){this._map=e;this.update()},remove_impl:function(){this._marker&&(this._marker.setMap(null),this._marker=null);this._map=null},copy:function(){return new h.EditPointView(this._model,this._options)},redraw:function(e){},_getMarker:function(e){var d=
k.marker_gen({position:e,clickable:!0,draggable:!0},"digitize_node_waypoint_sel");d.alp_view=this;d.alp_eh=[k.event("addListener")(d,"dragend",alp.nowF(function(){d.alp_view&&d.alp_view.nodeDragEndEvt().triggerSoon(d.getPosition())})),k.event("addListener")(d,"mouseover",alp.nowF(function(){d.alp_view&&d.alp_view.nodeMouseoverEvt().triggerSoon()})),k.event("addListener")(d,"click",function(b){h.topic(g).trigger(b,d)}),k.event("addListener")(d,"rightclick",function(b){h.topic(f).trigger(b,d)})];return d},
update:function(){if(this._map){var e=this._model.get();e?this._marker?this._marker.setPosition(e):(this._marker=this._getMarker(e),this._marker.setMap(this._map)):this._marker&&(this._marker.setMap(null),this._marker=null)}},isOverlay:function(e){return this._marker&&this._marker===e},nodeDragEndEvt:alp.memM("nodeDragEndEvt",'alp.event("EPointV:nodeDragEndEvt",{then:1})'),nodeMouseoverEvt:alp.memM("nodeMouseoverEvt",'alp.event("EPointV:nodeMouseoverEvt",{then:1})')})})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.controllers.PointEditController");
alp.gmap3(function(k){var h=alp._gmap2_3.digitize,g=h.EVENT_MAP_CLICK();alp.declare("alp._gmap2_3.digitize.PointEditController",h.controllers.BaseEditController,function(f,e,d){this.isEditing=!1;this._views={point:new h.PointView(e),edit:new h.EditPointView(e)};this._views.point.setMap(this._editController.map);this._eh.base={};this._eh2.push(this._model.geomChangeEvt().then(alp.bindF("_onGeomChange",this)));this._eh2.push(h.topic(g).then(alp.bindF("_base_onMapClick",this)))},{_onGeomChange:function(){for(var f in this._views)this._views.hasOwnProperty(f)&&
this._views[f].update()},_base_onMapClick:function(f,e){e&&this._views.point.isOverlay(e)&&!this.isEditing&&!this._viewonly&&this.startEditing()},getBounds:function(){return new k.LatLngBounds(this._model.get(),this._model.get())},startEditing:function(){this.isEditing||(this.isEditing=!0,this._editController.activeItemController(this),this._eh.edit={alp_eh:(new alp.Eh).push(this._views.edit.nodeDragEndEvt().then(alp.bindF("_edit_onNodeDragEnd",this))).push(h.topic(g).then(alp.bindF("_edit_onMapClick",
this)))},this._views.point.setMap(null),this._views.edit.setMap(this._editController.map),this._editController.setMapEditingMode(!0),this._onModeChange())},stopEditing:function(){this.isEditing&&(this._editController.activeItemController(null),this._views.edit.setMap(null),this._views.point.setMap(this._editController.map),this._disconnect("edit"),this.isEditing=!1,this._editController.setMapEditingMode(!1),this._onModeChange())},_edit_onNodeDragEnd:function(f){f=new h.UpdatePointCommand(this._model,
f);this._editController.undoStack.add(f)},_edit_onMapClick:function(f,e){e&&this._views.edit.isOverlay(e)?this.stopEditing():e||(f=new h.UpdatePointCommand(this._model,f.latLng),this._editController.undoStack.add(f))},_isEmpty:function(){return!!this._model.get()},populateContextMenu:function(f,e,d){var b=this;e?b._views.edit.isOverlay(e)&&f.add({label:h._i18n.contextDeleteFeature,onclick:function(){var c=new h.UpdatePointCommand(b._model,null);b._editController.undoStack.add(c)}}):b._isEmpty()&&
f.add({label:h._i18n.contextDigitize,onclick:function(){b.startEditing()}})}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.DirectionArrowView");
alp.gmap3(function(k){function h(){if(this._map&&(this._removeMarkers(),this._is_drawable())){var f=this._model.getVertices(),e=this._getSegments(f),d;for(d=0;d<e.length;d++){var b=e[d],c=f[b-1];b=f[b];var a=new k.LatLng((c.lat()+b.lat())/2,(c.lng()+b.lng())/2);this._markers[d]=this._pool_pop(c,b,a);this._markers[d].setPosition(a);this._markers[d].setMap(this._map)}for(;d<this._markers.length;)this._markers[d].setVisible(!1),d++}}var g=alp._gmap2_3;alp.declare("alp._gmap2_3.digitize.DirectionArrowView",
alp._gmap2_3.digitize.AbstractSafeGOverlay,alp.nowF(function(f,e){this._model=f;this._options||(this._options={subtype:null});this.visible=new alp.BoolState({init_value:!this._options.start_hidden});this.visible.change_cb("update",this);this._markers=[];this._showmarkers=!0;this._pool={};this._eh=new alp.Eh}),{initialize_impl:function(f){this._map=f;this._eh.push(g.event("addListener")(f,"maptypeid_changed",alp.bindF("_onmaptypeid_changed",this)),g.event("removeListener"));this._eh.push(g.event("addListener")(f,
"zoom_changed",alp.bindF("update",this)),g.event("removeListener"));this._onmaptypeid_changed();this.update()},remove_impl:function(){this._removeMarkers();this._map=null;this._eh.clear()},copy:function(){return new alp._gmap2_3.digitize.DirectionArrowView(this._model,this._options)},redraw:function(f){},_onmaptypeid_changed:function(){this._map&&"undefined"!==typeof G_SATELLITE_3D_MAP&&(alp.sub("alp.gmap.equalGMapTypes")&&(this._showmarkers=!alp.gmap.equalGMapTypes(this._map.getCurrentMapType(),
G_SATELLITE_3D_MAP)),this.update())},_removeMarkers:function(){for(;this._markers.length;)this._pool_push(this._markers.pop())},_pool_push:function(f){f.setMap(null);var e=f._alpUrl;e&&(this._pool[e]=this._pool[e]||[]).push(f)},_pool_pop:function(f,e,d){var b=alp.cfg.marker.arrow([f,e],this._options.subtype).url,c=this._pool[b];if(c&&c.length)return c.pop();f=g.marker_gen({position:d||new k.LatLng(0,0)},"arrow",[f,e],this._options.subtype);f._alpUrl=b;return f},_is_drawable:function(){return this._showmarkers&&
this.visible.get()},update:alp.nowF(function(){this.init_cb(alp.nowF(h,this))}),isOverlay:function(f){return!1},_getSegments:function(f){var e=f.length,d=[];if(2<e){"_total_m"in this||(this._total_m=360*g.cheap_lng2m_at([0,0]));var b=this._total_m,c=256<<this._map.getZoom();b*=(alp.likeIE8minus_backslash_v()?300:100)/c;c=0;for(var a,h,k,r,n=e-1,q=0;q<n;q++){var p=f[q],v=p.lng();p=p.lat();k&&0!=q%100||(k=g.cheap_lat2m_at([v,p]),r=g.cheap_lng2m_at([v,p]));0<q&&(a=r*Math.abs(v-a),h=k*Math.abs(p-h),c+=
Math.sqrt(a*a+h*h),c>b&&(d.push(q),c=0));a=v;h=p}d.length||d.push(e-1)}return d}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.EditGhostNodeMarkerView");
alp.gmap3(function(k){var h=alp._gmap2_3,g=h.digitize;g=h.digitize;var f=g.EVENT_MAP_CLICK(),e=g.EVENT_MAP_CONTEXT_MENU();alp.declare("alp._gmap2_3.digitize.EditGhostNodeMarkerView",g.AbstractSafeGOverlay,alp.nowF(function(d,b){this._model=d;this._options=b;this._st_dragging=new alp.BoolState;this._st_hovering=new alp.BoolState;this._at_most_one=new alp.PoliteSetState({init_value:[this._st_hovering,this._st_dragging]});this._st_hovering_info=new alp.State;this._st_shiftdown=new alp.BoolState;this._st_visible=
new alp.BoolState({init_value:!0});this._st_map_latlng=new alp.State;this._eh=new alp.Eh;this._p_eh=new alp.Eh;alp.ratelimitM(Math.abs(this.DELAY_MS),"_onMapMousemove",this)}),{DELAY_MS:10,mouseOutTolerance:10,setVisible:function(d){this._st_visible.set(d)},nodeDragStartEvt:alp.memM("nodeDragStartEvt",'alp.event("EGhostNMV:nodeDragStartEvt",{then:1})'),nodeDragEndEvt:alp.memM("nodeDragEndEvt",'alp.event("EGhostNMV:nodeDragEndEvt",{then:1})'),polylineMouseoverEvt:alp.memM("polylineMouseoverEvt",'alp.event("EGhostNMV:polylineMouseoverEvt",{then:1})'),
polylineMouseoutEvt:alp.memM("polylineMouseoutEvt",'alp.event("EGhostNMV:polylineMouseoutEvt",{then:1})'),isOverlay:function(d){return this._marker&&(d===this||d==this._ghost)},initialize_impl:function(d){var b=this;b._map=d;b._eh.push(alp.aEL(window,"keydown",alp.bindF("_onKeyDown",b)));b._eh.push(alp.aEL(window,"keyup",alp.bindF("_onKeyUp",b)));b._eh.push(h.event("addListener")(b._map,"mousemove",function(c){b._mmm_mev=c;b._onMapMousemove()}),h.event("removeListener"));b._eh.push(b._st_hovering_info.change_cb(function(){var c=
alp.opt(b._st_hovering_info.get(),"over_latlng");c&&b._m2v_updateGhost(c)}));b._eh.push(b._st_map_latlng.change_cb("_m2v_updateGhost",b));b._eh.push(b._st_hovering.change_v_cb(!1,"_m2v_stopHovering",b));b._eh.push(b._st_visible.change_v_cb(!1,"_hide_ghost",b));b._eh.push(b._st_dragging.change_v_cb(!1,"_hide_ghost",b))},remove_impl:function(){this._eh.clear();this._hide_ghost();this._map=null},copy:function(){return new g.EditGhostNodeMarkerView(this._model,this._options)},redraw:function(d){},connectMouseEvents:function(d){var b=
this;b.disconnectMouseEvents();b._piece_arr=d;b._p_eh.clear();alp.forEach(d,function(c){c.gpolyline&&b._p_eh.push(h.event("addListener")(c.gpolyline,"mouseover",alp.nowF(alp.bindF("_onPolyMouseover",b,c))),h.event("removeListener"))},b)},disconnectMouseEvents:function(){this._p_eh.clear()},update:function(){},_onPolyMouseover:alp.nowF(function(d,b){this._st_dragging.get()||(this._st_hovering_info.set({x:d,over_latlng:b.latLng}),this._st_hovering.set(!0),this.polylineMouseoverEvt().triggerSoon(this._st_hovering_info.get()))}),
_onMapMousemove:alp.nowF(function(){this._st_dragging.get()||this._st_hovering.get()&&this._st_map_latlng.set(this._mmm_mev.latLng)}),_onKeyDown:function(d){d.keyCode==alp.key.SHIFT&&this._st_shiftdown.setNow(!0)},_onKeyUp:function(d){d.keyCode==alp.key.SHIFT&&this._st_shiftdown.setNow(!1)},_connect_ghost:function(d){var b=this,c=alp.nowF(function(a){b._st_dragging.get()||(b._st_dragging.set(!0),d.alp_startPoint=a.latLng,d.alp_startPixel=a.pixel,b.nodeDragStartEvt().triggerSoon(d.alp_segIndex,d.alp_startPoint))}),
a=alp.nowF(function(a){b._st_dragging.get()&&(b._st_dragging.set(!1),a.latLng.equals(d.alp_startPoint)||d.alp_startPixel&&alp.m(a.pixel,"equals",d.alp_startPixel)||b.nodeDragEndEvt().triggerSoon(d.alp_segIndex,d.alp_startPoint,a.latLng,b._st_shiftdown.get()))});d.alp_eh=[h.event("addListener")(d,"dragstart",c),h.event("addListener")(d,"dragend",a),h.event("addListener")(d,"click",function(a){b._st_dragging.get()||g.topic(f).trigger(a,d)}),h.event("addListener")(d,"rightclick",function(a){b._st_dragging.get()||
g.topic(e).trigger(a,d)})]},_m2v_updateGhost:alp.nowF(function(d){if(this._st_hovering.get()&&this._map){var b=this._model,c=this._st_hovering_info.get();if(c=b.queryNearestPoint(d,c.x)){var a=this._map.getZoom(),e=h.getProjection(this._map),f=h.fromLatLngToPixel(e,c[1],a);c&&"number"===typeof c[0]&&alp.m(b.nextleg_to_highlight_st,"set",c&&c[0]);if((b=alp.m(b.no_ghost_latlng_st,"get"))&&c&&(b=h.fromLatLngToPixel(e,b,a),225>h.xyD2(b,f))){this._st_hovering.set(!1);return}d=h.fromLatLngToPixel(e,d,a);
this.mouseOutTolerance*this.mouseOutTolerance<h.xyD2(d,f)?this._st_hovering.set(!1):c&&this._st_visible.get()&&(d=this._ghost_marker(),d.alp_segIndex=c[0],c[1].equals(d.getPosition())||d.setPosition(c[1]),this._map!=d.getMap()&&d.setMap(this._map),alp.m(this._model.nextleg_to_highlight_st,"set",c[0]))}}}),_m2v_stopHovering:function(){this._st_dragging.get()||(this._hide_ghost(),alp.m(this._model.nextleg_to_highlight_st,"set",null));this.polylineMouseoutEvt().triggerSoon()},_hide_ghost:function(){this._ghost&&
(this._ghost.setMap(null),h.V2()&&(this._ghost=null))},_ghost_marker:function(){if(!this._ghost){var d={position:new k.LatLng(0,0),clickable:!0,draggable:!0,raiseOnDrag:!1,bouncy:!1,dragCrossMove:!1};this._ghost=h.marker_gen(d,"digitize_ghost");this._connect_ghost(this._ghost)}return this._ghost}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.EditLineView");
alp.gmap3(function(k){function h(d,b){if(!b)return!1;d=f.point.sub(d,b);return 400>d.x*d.x+d.y*d.y}function g(d,b,c,a){d._poly_length=c.targetDistance;alp.m(d._poly,"getMap")?d._poly.setPath(d._polyPath=alp.opt(a,"path")||[b,c.finalLatLng]):(a=a||d._options.lineOptions,b=f.polylineGen(alp.oCreateMix({path:d._polyPath=[b,c.finalLatLng],strokeColor:a.color,strokeWeight:a.weight,strokeOpacity:a.opacity},a)),d._poly=b)}var f=alp._gmap2_3,e=f.digitize.PUBLIC_TRANS_NONE();alp.declare("alp._gmap2_3.digitize.EditLineView",
f.digitize.AbstractSafeGOverlay,alp.nowF(function(d){var b=this;b._options=alp.oCreateMix({lineOptions:{},tryRoutingAtZoom:Infinity,tryWithPublicTransport:!1,routingPreviewRightAway:!1},d);b._model=alp.opt(b._options,"model");b._poly=null;b.visible=new alp.BoolState;b.transparent_st=new alp.BoolState;b.routing_st=new alp.BoolState;b.public_transport_st=new alp.BoolState;b.visible.change_cb(function(a){a&&this._poly?this._poly.setMap(this.getMap()):!a&&this._poly&&this._poly.setMap(null)});b.transparent_st.change_cb("_update_poly_transparency",
b);b.routing_st.change_cb("_update_transparent",b);b.public_transport_st.change_cb("_update_transparent",b);b._map_eh=new alp.Eh;b.set=alp.ratelimitF(171,"set",b);b._preview_route=alp.ratelimitF(b._options.routingPreviewRightAway?256:1E3,"_preview_route",b);var c=alp.opt(b._model,"default_public_transport_main");alp.m(c,"changed_cb",function(){b.public_transport_st.set(e!=c.get())})}),{mCanRoute:function(){return this.public_transport_st.get()?!1:"function"===typeof alp.opt(this._model,"_segmentRoute")},
_update_transparent:function(){if(this.public_transport_st.get())this.transparent_st.set(!0);else{var d=this.routing_st.get(),b=this.getMap();d&&this.mCanRoute()&&alp.m(b,"getZoom")>=this._options.tryRoutingAtZoom&&(d=!1);this.transparent_st.set(d)}},initialize_impl:function(d){this._map=d;this._map_eh.push(f.event("addListener")(d,"zoom_changed",alp.bindF("_update_transparent",this)),f.event("removeListener"))},remove_impl:function(){this.set();this._map=null;this._map_eh.clear()},copy:function(){return new alp._gmap2_3.digitize.EditLineView(this._options)},
redraw:function(d){},update:function(){},set:function(d,b){function c(){a._last_fixedDest===e&&a.set(a._last_source,a._last_dest)}var a=this;if(a.mCanRoute()){a._last_source=d;a._last_dest=b;if(a._map&&(!a._map.isLoaded||a._map.isLoaded())&&d&&b){var e=a._calcDestination(d,b);if(e){a.routing_st.get()&&a.mCanRoute()?(b=a._last_fixedDest,a._last_fixedDest=e,e.finalZ>=a._options.tryRoutingAtZoom&&e.finalZ==b.finalZ&&600>e.distPix&&(h(e.finalPoint,alp.opt(b,"finalPoint"))?(a._options.routingPreviewRightAway||
g(a,d,e),a.transparent_st.set(!1),a._preview_route(d,e)):(a._options.routingPreviewRightAway||a.transparent_st.set(!0),alp.asyncF(250,c)()))):(g(a,d,e),a.transparent_st.set(!1));a._update_poly_transparency();return}}a._poly&&a._poly.setMap(null)}else a.transparent_st.set(!0)},_preview_route:function(d,b){function c(c){(a._options.routingPreviewRightAway||a._last_fixedDest===b&&a._currently_routing===e)&&a._currently_routing&&(a._currently_routing===e&&(a._currently_routing=null),c&&c.getArray&&(c=
c.getArray()),c&&1<c.length&&c[0]instanceof k.LatLng&&(g(a,d,b,{path:c}),a.transparent_st.set(!1)))}var a=this;if(a._last_fixedDest===b){alp.m(a._currently_routing,"cancel");var e=a._currently_routing=a._model._segmentRoute(a._model.getNodeCount()-1,{from:d,to:b.finalLatLng},null,!0);e.then(c)}},_calcDestination:function(d,b){if(!(d&&b&&this._map))return null;var c=f.fromLatLngToContainerPixel(this._map,d);b=f.fromLatLngToContainerPixel(this._map,b);var a=b.x-c.x,e=b.y-c.y,g=Math.sqrt(Math.pow(a,
2)+Math.pow(e,2));if(5<g){var h=new k.Point(c.x+a,c.y+e);b=this._map.getZoom();var n=f.fromContainerPixelToLatLng(this._map,h);h=f.point.sub(h,c);d=n.distanceFrom(d);e=Math.asin(e/g);g-=5;a=a&&a/Math.abs(a)*Math.cos(e)*g;e=Math.sin(e)*g;c=new k.Point(c.x+a,c.y+e);a=f.fromContainerPixelToLatLng(this._map,c);return{distPix:Math.sqrt(h.x*h.x+h.y*h.y),finalPoint:c,finalZ:b,finalLatLng:a,targetDistance:d}}return null},isOverlay:function(d){return this._poly&&this._poly===d},getLength:function(){return this._poly&&
this._poly_length||0},_update_poly_transparency:function(){alp.m(this._poly,"setMap",this.transparent_st.get()?null:this._map)}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.EditMarkerView");
alp.gmap3(function(k){var h=alp._gmap2_3,g=h.digitize,f=g.EVENT_MAP_CLICK(),e=g.EVENT_MAP_CONTEXT_MENU(),d=alp.likeIE8minus_backslash_v();h.digitize.EDIT_MARKER_OPTIONS_DEFAULT=function(){return{nodeIcon:{size:"round",type:"A",routedColor:alp.sub("alpregioConfig")?"crimson":"black_green",manualColor:"silver",highlightColor:"lime"},ooi_a_1_icon:alp.cfg.ooi_a_1_icon,delay_ms_max:d?50:125,max_n_marker:d?5:250}};alp.declare("alp._gmap2_3.digitize.EditMarkerView",g.AbstractSafeGOverlay,alp.nowF(function(b,
c){this._model=b;this._options=alp.oCreateMix(g.EDIT_MARKER_OPTIONS_DEFAULT(),c);alp.ratelimitM(97,"update",this);this.visible=new alp.BoolState({init_value:!this._options.start_hidden});this.visible.change_cb("update",this);this._dragging_index_st=new alp.State;this._markers={};this._selected=[];alp.m(b.node_to_highlight_st,"change_cb","update",this);alp.m(b.node2_to_highlight_st,"change_cb","update",this);alp.m(b.next_segment_is_routed_st,"change_cb","update",this);this._eh=new alp.Eh}),{nodeIconType:function(){return(alp.oGet(this._options,
"nodeIcon.type")||".")+""},isNodeIconLetter:function(){return"a"===this.nodeIconType().toLowerCase()},isNodeIconNumber:function(){return"1"===this.nodeIconType()},isNodeIconUniform:function(){return!(this.isNodeIconLetter()||this.isNodeIconNumber())},isDragging:function(){return null!=this._dragging_index_st.get()},initialize_impl:function(b){this._map=b;this._eh.push(h.event("addListener")(b,"maptypeid_changed",alp.bindF("onmaptypeid_changed",this)),h.event("removeListener"));this._eh.push(h.event("addListener")(b,
"bounds_changed",alp.bindF("update",this)),h.event("removeListener"));b.stVis3d&&this._eh.push(b.stVis3d.change_cb("update",this));this.update()},remove_impl:function(){this._removeMarkers();this._map=null;this._eh.clear()},copy:function(){return new g.EditMarkerView(this._model,this._options)},redraw:function(b){},_removeMarkers:function(b){b||(b=this._markers);for(var c in b)if(b.hasOwnProperty(c)){for(var a=b[c];a&&0<a.length;)this.markerPool.put(a.pop());delete b[c]}},setSelected:function(b){this._selected=
b||[];this.update()},isSelected:function(b){for(var c=this._selected,a=0,d=c.length;a<d;a++)if(c[a]===b)return!0;return!1},isHighlighted:function(b){var c=this._model,a=c&&c.node2_to_highlight_st;return alp.m(c&&c.node_to_highlight_st,"is",b)&&1||alp.m(a,"is",b)&&2},startMoving:function(b){var c=this._selected,a=this._move_markers=[],d=this._map,e;for(e in this._markers)this._markers.hasOwnProperty(e)&&alp.forEach(this._markers[e]||[],function(e){var f=alp.indexOf(c,e.getPosition());0<=f&&e.getPosition()!==
b&&a.push([e,c[f],h.fromLatLngToContainerPixel(d,c[f]),f])})},moveSelected:function(b){var c=this._map;alp.forEach(this._move_markers,function(a){var d=a[0];a=a[2];a=new k.Point(a.x+b.x,a.y+b.y);d.setPosition(h.fromContainerPixelToLatLng(c,a))})},stopMoving:function(){var b=[];alp.forEach(this._move_markers,function(c){c=c[0];b.push([c.alp_nodeIndex,c.getPosition()])});this._move_markers=[];return b},update:function(){this.isNodeIconLetter();var b=this.isNodeIconNumber(),c=this.isNodeIconUniform(),
a=this._model,d=!c&&alp.m(a,"getImportantNodesIndices"),e=!c&&this._options.ooi_a_1_icon,f=this._options.nodeIcon;if(this._map){var g=alp.sub("G_SATELLITE_3D_MAP");this._3d_v3=alp.m(this._map,"is3d");this._3d_v2=g&&alp.gmap.equalGMapTypes(this._map.getCurrentMapType(),g);if(this._3d=this._3d_v3||this._3d_v2){g=this._markers;for(var h in g)if(g.hasOwnProperty(h)){for(var k=g[h];k&&k.length;)a=k.pop(),a.setMap(null);delete g[h]}}else{var v=this._map.getBounds(),u=this.visible.get()?a.getNodeCount():
0,t=a.getNodes(),w=this._markers||{},x=0;g=this._markers={};var y=alp.cfg.marker;if(v){for(var z=(Date.now?Date.now():+new Date)+this._options.delay_ms_max,A=this._options.max_n_marker,C=0,E=u;E--&&x<A;)if((k=t[E])&&v.contains(k)){var G=!1;h=this.isSelected(k);if(!c){var B=alp.indexOf(d,E);G=-1<B}var I=!h&&this.isHighlighted(E)?G?e(B,b,f.highlightColor,f.size):y.digitize_node_highlight():alp.m(a,"isSegmentRouted",E)||0<E&&!t[E-1]?h?y.digitize_node_waypoint_sel():G?e(B,b,f.routedColor,f.size):y.digitize_node_waypoint():
h?y.digitize_node_sel():G?e(B,b,f.manualColor,f.size):y.digitize_node();h=this.markerPool.poolkey(I,k,E);var L=alp.m(w[h],"pop");L?(C++,k.equals(L.getPosition())||L.setPosition(k),L.alp_nodeIndex=E,L.alp_view=this):L=this.markerPool.get(this,E,k,this._map,I);k=g[h]=g[h]||[];k.push(L);G||x++;if((Date.now?Date.now():+new Date)>z)break}(function(){for(var a=u,c=u+10;a<c;a++)alp.imgPreload(e(a,b,f.routedColor,f.size).url),alp.imgPreload(e(a,b,f.highlightColor,f.size).url),alp.imgPreload(e(a,b,f.manualColor,
f.size).url);var d=alp.cfg.marker;alp.forIn(d,function(a,b){/^digitize_/.test(b)&&alp.imgPreload(d[b]().url)})})();this._removeMarkers(w)}}}},isOverlay:function(b){if(this._map){var c=this._markers,a=alp.opt(b,"alp_poolkey");b=(c=a&&alp.opt(c,a))&&c.length&&alp.indexOf(c,b);if(-1<b)return c[b].alp_nodeIndex}return!1},nodeDragStartEvt:alp.memM("nodeDragStartEvt",'alp.event("AGDC:EditMarkerV:nodeDragStartEvt",{then:1})'),onNodeDragStart:function(b,c){this._dragging_index_st.set(b);this.nodeDragStartEvt().triggerSoon(b,
c)},nodeDragEvt:alp.memM("nodeDragEvt",'alp.event("AGDC:EditMarkerV:nodeDragEvt",{then:1})'),onNodeDrag:function(b,c){this.nodeDragEvt().triggerSoon(b,c)},nodeDragEndEvt:alp.memM("nodeDragEndEvt",'alp.event("AGDC:EditMarkerV:nodeDragEndEvt",{then:1})'),onNodeDragEnd:function(b,c){this._dragging_index_st.set(null);this.nodeDragEndEvt().triggerSoon(b,c)},nodeMouseoverEvt:alp.memM("nodeMouseoverEvt",'alp.event("EMV:nodeMouseoverEvt",{then:1})'),onNodeMouseover:alp.nowF(function(b,c){alp.m(this._model.node_to_highlight_st,
"set",b);c&&alp.m(this._model.no_ghost_latlng_st,"set",c.getPosition());this.nodeMouseoverEvt().triggerSoon(b)}),onmaptypeid_changed:function(){this.update()},markerPool:{pool:{},poolkey:function(b,c,a){return[alp.oToString(b),c.toString()].join(", ")},get:function(b,c,a,d,k){k=k||alp.cfg.marker.digitize_node().url;var l=this.poolkey(k,a,c),m=this.pool[l],q="object"===typeof k;if(m&&0<m.length)return k=m.pop(),k.alp_nodeIndex=c,k.alp_view=b,a.equals(k.getPosition())||k.setPosition(a),k.getVisible()||
(k.setVisible(!0),k.setMap(d)),k;q=q?k:alp.cfg.marker.digitize_node();m="string"===typeof k;a=alp.oCreateMix(h.marker_opts.markerCfg_2_markerOptions(q),{position:a,clickable:!0,draggable:!0,raiseOnDrag:!1,zIndex:this._getZIndex(m)});var p=h.marker_gen(a);p.alp_poolkey=l;p.alp_nodeIndex=c;p.alp_iconSpec=k;p.alp_is_flat=m;p.alp_view=b;p.alp_eh=[h.event("addListener")(p,"dragstart",alp.nowF(function(){alp.m(p.alp_view,"onNodeDragStart",p.alp_nodeIndex,p.getPosition())})),h.event("addListener")(p,"drag",
alp.nowF(function(){alp.m(p.alp_view,"onNodeDrag",p.alp_nodeIndex,p.getPosition())})),h.event("addListener")(p,"dragend",alp.nowF(function(){alp.m(p.alp_view,"onNodeDragEnd",p.alp_nodeIndex,p.getPosition())})),h.event("addListener")(p,"mouseover",alp.nowF(function(){if(!b.isDragging()&&p.alp_view)p.alp_view.onNodeMouseover(p.alp_nodeIndex,p)})),h.event("addListener")(p,"mouseout",alp.nowF(function(){if(!b.isDragging()&&p.alp_view)p.alp_view.onNodeMouseover()})),h.event("addListener")(p,"click",alp.nowF(function(a){b.isDragging()||
g.topic(f).trigger(a,p)})),h.event("addListener")(p,"rightclick",alp.nowF(function(a){b.isDragging()||g.topic(e).trigger(a,p)}))];p.setMap(d);m&&p.setIcon(k);return p},put:function(b){b.setVisible(!1);b.setMap(null);b.alp_view=null;var c=b.alp_poolkey;(this.pool[c]||(this.pool[c]=[])).push(b)},clear:function(b){for(var c in this.pool)if(this.pool.hasOwnProperty(c)){for(b=this.pool[c];b&&0<b.length;){for(var a=b.pop();a.alp_eh.length;)h.event("removeListener")(a.alp_eh.pop());a.setMap(null)}delete this.pool[c]}},
_getZIndex:function(b){return b?1:2}}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.PolylineView");
(function(){var k=alp._gmap2_3,h=k.digitize,g=h.EVENT_MAP_CLICK(),f=h.EVENT_MAP_CONTEXT_MENU();alp.declare("alp._gmap2_3.digitize.PolylineView",h.AbstractSafeGOverlay,alp.nowF(function(e,d){this._model=e;this._options=alp.oCreateMix({manualSegmentWeightRatio:1,backend_snap_tol_pixels:5},d);"number"!==typeof this._options.update_mindelay_ms&&(this._options.update_mindelay_ms=123);this._options.update_mindelay_ms=this._options.update_mindelay_ms;this._options.lineOptions=this._options.lineOptions||
{};this.visible=new alp.BoolState;this.visible.change_cb("update",this);e=this._options.lineOptions;e.color=e.color||"#0000ff";"number"!==typeof e.weight&&(e.weight=5);e.opacity=e.opacity||.8;this._install_zoom_level_be_snaptol()}),{initialize_impl:function(e){this.show()},remove_impl:function(){this.hide()},copy:function(){return new h.PolylineView(this._model,this._options)},redraw:function(e){},_is_drawable:function(){return this.on_map.get()&&this.visible.get()},_update_pieces:alp.nowF(function(e){function d(a){a._alpEh=
new alp.Eh;a._alpEh.push(k.event("addListener")(a,"click",function(b){h.topic(g).trigger(b,a)}),k.event("removeListener"));a._alpEh.push(k.event("addListener")(a,"rightclick",function(b){h.topic(f).trigger(b,a)}),k.event("removeListener"))}e=this._is_drawable()&&e||[];var b=!1,c={};this._piece_arr=this._piece_arr||[];alp.oToString(this._options.lineOptions);var a,m=alp.map(e,alp.f(".hashcolor"));for(a=this._piece_arr.length;a--;){var l=this._piece_arr[a];if(!(-1<alp.indexOf(m,l.hashcolor))){if(b=
this._piece_arr.splice(a,1)[0].gpolyline)b.setMap(null),b._alpEh.clear();b=!0;this._options.onepiece||alp.forEach(l.seg_ind,function(a){c[a]=!0})}}var r=alp.map(this._piece_arr,alp.f(".hashcolor"));a=0;for(m=e.length;a<m;a++)l=e[a],-1<alp.indexOf(r,l.hashcolor)||l.gll_arr.length&&!l.gll_arr[0]||(l.gpolyline=this._gll_arr_2_gpolyline(l.gll_arr,l.is_manual),this._piece_arr.push(l),d(l.gpolyline),l.gpolyline.setMap(this.gmap),b=!0,this._options.onepiece||alp.forEach(l.seg_ind,function(a){c[a]=!0}));
b&&this.polyChangedEvt().triggerSoon(c);return b&&c}),show:function(){this.visible.set(!0)},hide:function(){this.visible.set(!1)},update:function(){this.init_cb(this,"_update")},_update:function(){var e=this;(e._update=alp.ratelimitF(Math.abs(e._options.update_mindelay_ms),function(){e._update_pieces(e._is_drawable()&&e._getPieces())}))()},isOverlay:function(e){return e===this||!(!this._piece_arr||!alp.or(this._piece_arr,function(d){return d.gpolyline===e}))},getBounds:function(){var e=null,d=this._piece_arr||
this._getPieces();d&&alp.forEach(d,function(b){b=(b.gpolyline||this._gll_arr_2_gpolyline(b.gll_arr)).getBounds();e?(e.extend(b.getSouthWest()),e.extend(b.getNorthEast())):e=b},this);return e||!1},_getPieces:function(e){if(!this._options.onepiece&&this._model.getPieces)var d=this._model.getPieces();else this._onepiece_hash_count=(this._onepiece_hash_count||0)+1,d=[{gll_arr:this._model.getVertices(),hash:this._onepiece_hash_count+"."+(Date.now?Date.now():+new Date)}];var b=alp.oToString(this._options.lineOptions);
e||alp.forEach(d,function(c){c.hashcolor=c.hash+"."+b});return d},getPieces:function(){return this._piece_arr=this._piece_arr||this._getPieces(!0)},getPolyArr:function(){return alp.map(this.getPieces(),function(e){return e.gpolyline||this._gll_arr_2_gpolyline(e.gll_arr)},this)},getPolyLength:function(){for(var e=this.getPolyArr(),d=0,b=e.length;b--;)d+=e[b].getLength();return d},getVertexCount:function(){for(var e=this.getPolyArr(),d=e.length,b=d?1:0;d--;)b+=e[d].getVertexCount()-1;return b},getVertices:function(){for(var e=
this.getPieces(),d=[],b=e.length,c=0;c<b;c++)d.push.apply(d,e[c].gll_arr);return d},setStrokeStyle:function(e,d){alp.oEqual(this._options.lineOptions,e)||(this._options.lineOptions=e,"number"===typeof d&&(this._options.manualSegmentWeightRatio=d),this.update())},_gll_arr_2_gpolyline:function(e,d){var b=alp.oCreateMix(alp.sub({strokeColor:"color",strokeWeight:"weight",strokeOpacity:"opacity"},this._options.lineOptions),this._options.lineOptions);"number"!==typeof b.strokeWeight&&(b.strokeWeight=5);
d&&(d=this._options.manualSegmentWeightRatio,null!=d&&(b.strokeWeight*=d));return k.polylineGen(alp.mix({path:e},b))},polyChangedEvt:alp.memM("polyChangedEvt",'alp.event("PolylineV:polyChangedEvt", {then:1})'),_install_zoom_level_be_snaptol:function(){function e(){a.clear();var c=b.mapSt.get();c&&(a.push(k.event("addListener")(c,"zoom_changed",alp.nowF(function(){d(c)})),k.event("removeListener")),d(c))}function d(a){var d=a.getZoom();if(a=k.getProjection(a))d=k.getWrapWidth(a,d),d=2*Math.PI*k.earth_radius()*
b._options.backend_snap_tol_pixels/d,c.set(d)}var b=this,c=alp.opt(b._model,"backend_snap_t_st");if(c){var a=new alp.Eh;b.mapSt.change_cb(e);e()}}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.polygon");
alp.gmap3(function(k){var h=alp._gmap2_3,g=k.Polygon.prototype;h.overlay._install();var f="fromEncoded";k.Polygon[f]||(k.Polygon[f]=function(e){e=h.decodePolyline(e);return h.polygon_gen({path:alp._gmap2_3.xy2latlng(e.xy)})});f="getLength";g[f]=g[f]||function(){return h.pathLength(this.getPath())};h.polygon_gen=function(e){if(h.V3())return new k.Polygon(e);if(h.V2()){var d=new k.Polygon(e&&e.path||[],e&&e.strokeColor,e&&e.strokeWeight,e&&e.strokeOpacity,e&&e.fillColor,e&&e.fillOpacity,e);(e=e&&e.map)&&
d.setMap(e);return d}};h.V2()&&g.getVertex&&g.getVertexCount&&(g.getPath||(g.getPath=function(){for(var e=this.getVertexCount(),d=Array(e);e--;)d[e]=this.getVertex(e);return d}));h.V2()&&g.getVertex&&g.deleteVertex&&g.insertVertex&&(g.setPath||(g.setPath=function(e){var d=this.getVertexCount(),b=e.length,c;for(c=0;c<b;c++){var a=e[c];c>=d?this.insertVertex(c,a):a.equals(this.getVertex(c))||(this.deleteVertex(c),this.insertVertex(c,a))}for(c=b;c<d;c++)this.deleteVertex(b)}))});
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.PolygonView");
(function(){var k=alp._gmap2_3;alp.declare("alp._gmap2_3.digitize.PolygonView",k.digitize.PolylineView,function(h,g){this._options.fillOptions=alp.oCreateMix({color:"salmon",opacity:.5},this._options.fillOptions)},{_getPolyArr:function(){var h=this._model.getVertices(),g=this._options.lineOptions,f=this._options.fillOptions;return[k.polygon_gen({path:h,strokeColor:g.color,strokeWeight:g.weight,strokeOpacity:g.opacity,fillColor:f.color,fillOpacity:f.opacity})]}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.PublicTransportViewIW");
(function(){function k(f){return'<div style="width: 10px; height: 5px; background-color: '+f+'; margin: 5px 6px 5px 5px;" class="fl"></div>'}function h(f){return alp.tmpl('<span class="fr">${day}.${month}.${year}  <span style="margin-left: 30px"></span> ${hour}:${minute} Uhr</span>',alp.mapIn(f,function(e){return alp.sPad(e,2,"0")}))}function g(f){var e=alp.opt(f,"nameWO");f=alp.opt(f,"locality");return e||f?'<div class="clear"></div>'+k("transparent")+'<span class="s6">'+e+"&nbsp;/&nbsp;"+f+"</span>":
""}alp._gmap2_3.digitize.PublicTransportViewIW=function(f,e){if(!alp.and(alp.map(["travel_line","travel_start","travel_end"],function(a){return f[a]})))return null;var d="<div>",b="#777777";if(e&&(e=e[f.publictransport_iconid])){var c=e.img_title||f.publictransport_iconid;d+='<img src="'+e.img+'" title="'+c+'" alt="'+c+'" style="vertical-align: middle">';b=e.strokeColor||b}d+=' <span class="s5">'+(f.travel_line||"")+"</span>";d=d+'<hr><div class="clear"></div>'+k(b);d+='<span class="s5">Abfahrt</span> <span class="s6">'+
h(f.travel_start)+"</span>";d+=g(alp.oGet(f,"mentz_info.from"));d=d+'<div class="clear"></div>'+k(b);d+='<span class="s5">Ankunft</span> <span class="s6">'+h(f.travel_end)+"</span>";d+=g(alp.oGet(f,"mentz_info.to"));(b=alp.oGet(f,"mentz_info.smstext"))&&"string"===typeof b&&(d=d+'<div class="clear"></div><hr><div style="width: 230px"><div class="dialog-info" style="float: left; margin-left: 4px; margin-right: 4px;"></div><div class="s5" style="float: left;"> Anmerkungen</div>'+('<div class="s6" style="float: left;">'+
b+"</div>")+'<div class="clear"></div></div>');return d+="</div>"}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.PublicTransportView");
alp.gmap3(function(k){var h=alp._gmap2_3,g=alp._gmap2_3.digitize,f=g.NEXTLEG(),e=g.PUBLIC_TRANSPORT(),d=g.PUBLIC_TRANSPORT_STEP_ARR(),b=g.PUBLIC_TRANS_NONE(),c=g.DATATYPE_NAME();alp.declare("alp._gmap2_3.digitize.PublicTransportView",alp._gmap2_3.digitize.AbstractSafeGOverlay,alp.nowF(function(a,b){var c=this;c.model=a;c.opt=alp.oCreateMix({update_mindelay_ms:125,strokeColor:"#FF00FF",strokeWeight:6,strokeOpacity:1,outlineColor:"#FFFFFF",outlineWeightPlus:2,outlineOpacity:1,maxpoints:h.V2()?alp.likeIE()?
234:456:Infinity},b);c.opt.public_transport||(c.opt.public_transport=alp.cfg.publictransport());c.opt.routing_public_transport||(c.opt.routing_public_transport=alp.routing.extract.DEFAULT_CFG());c.visible=new alp.BoolState({init_value:!c.opt.start_hidden});c.active_st=new alp.BoolState({init_value:!0});c.visible.change_cb("update",c);c.active_st.change_cb("update",c);null!=c.opt.update_mindelay_ms&&alp.ratelimitM(Math.abs(c.opt.update_mindelay_ms),"update",c);a.geomChangeEvt().then(alp.ratelimitF(181,
function(){var a=c.visible_gmap();a&&h.iwCloseAll(a)}))}),{visible:null,active_st:null,initialize_impl:function(a){this.update()},remove_impl:function(){this.update()},copy:function(){return new alp._gmap2_3.digitize.PublicTransportView(this.model,this.opt)},redraw:function(){},update:function(a){function g(a,b,c){var d=x._travel_mode_2_id(a.travel_mode);d=null!=d&&x._id_2_obj(d);(d=alp.opt(n.opt.public_transport[d&&d.iconid],"strokeColor"))&&"transparent"!==d&&(b=b&&b.vertices)&&b.length&&(b=b.slice(a.from_point,
a.to_point+1),a=n.opt.maxpoints,alp.isFiniteNumber(a)&&b.length>a&&(b=h.simplify_path(b,a)),a=h.polylineGen({path:b,map:w,strokeColor:n.opt.outlineColor,strokeWeight:n.opt.outlineWeightPlus+n.opt.strokeWeight,strokeOpacity:n.opt.outlineOpacity}),a.seg_ind=c,q.push(a),a=h.polylineGen({path:b,map:w,strokeColor:d||n.opt.strokeColor,strokeWeight:n.opt.strokeWeight,strokeOpacity:n.opt.strokeOpacity}),a.seg_ind=c,q.push(a))}function l(a,b,c){var d=x._travel_mode_2_id(a.travel_mode);d=x._id_2_index(d);d=
null!=d&&x[d];var e=n.opt.public_transport[d&&d.iconid];d=alp.opt(e,"img");var f=alp.opt(e,"img_width"),g=alp.opt(e,"img_height"),l=alp.opt(e,"img_title"),m=alp.opt(e,"img_anchor_x")||f&&f>>1;e=alp.opt(e,"img_anchor_y")||g&&g>>1;var p=b&&alp.oGet(b,["vertices",a.from_point]);b=f&&g&&new k.Size(f,g);m=null!=m&&null!=e&&new k.Point(m,e);if(d&&p){b={icon:h.markerImage_gen(d,b,null,m),map:w,position:p,title:l||""};var r=h.marker_gen(b);r.seg_ind=c;q.push(r);a&&(h.event("addListener")(r,"click",alp.nowF(function(){h.iwOpen(w,
p,alp._gmap2_3.digitize.PublicTransportViewIW(a,n.opt.public_transport))})),h.event("addListener")(r,"mouseover",alp.nowF(function(){alp.m(n.model.no_ghost_latlng_st,"set",r.getPosition())})))}}function r(a,b,d){var e=x._travel_mode_2_id(a.travel_mode);if("none"==e){var g=v.get_property([d,f,c]),l=g&&n.opt.public_transport[e](g);if(l){e=alp.opt(l,"img");var m=alp.opt(l,"img_width"),p=alp.opt(l,"img_height");g=alp.opt(l,"img_title");var r=alp.opt(l,"img_anchor_x")||m&&m>>1;l=alp.opt(l,"img_anchor_y")||
p&&p>>1;a=b&&alp.oGet(b,["vertices",a.from_point]);b=m&&p&&new k.Size(m,p);r=null!=r&&null!=l&&new k.Point(r,l);e&&a&&(e={icon:h.markerImage_gen(e,b,null,r),map:w,position:a,title:g||""},e=h.marker_gen(e),e.seg_ind=d,q.push(e))}}}for(var n=this,q=n._polyline_arr||(n._polyline_arr=[]),p=!(n.visible.get()&&n.active_st.get()),v=alp.opt(n.model,"node_info"),u=q.length;u--;){var t;(t=p||!a)||(t=a?a[q[u].seg_ind]:!0);t&&q.splice(u,1)[0].setMap(null)}if(!p){var w=n.visible_gmap();if(w){u=alp.m(n.model,"getSegmentCount")||
0;for(p=Array(u);u--;)p[u]=u;if(a)for(t=p.length;t--;)a[p[t]]||p.splice(t,1);if(v){var x=n.opt.routing_public_transport;u=p.length;for(t=0;t<u;t++){a=p[t];var y=v.get_property([a,f]),z=y&&y[e];if(!z||z==b)break;y=y&&y[d];z=n.model.getSegmentModel(a);if(y)for(var A=y.length,C=0;C<A;C++){var E=y[C];g(E,z,a);l(E,z,a);C===A-1&&r(E,z,a)}}}}}}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.PolylineViewWithPublicTransport");
(function(){alp.declare("alp._gmap2_3.digitize.PolylineViewWithPublicTransport",alp._gmap2_3.digitize.PolylineView,alp.nowF(function(k,h){this._pubtransview=new alp._gmap2_3.digitize.PublicTransportView(k,alp.oCreateMix(alp.opt(h,["public_transport","routing_public_transport"]),{update_mindelay_ms:null}));this.visible.bind_to(this._pubtransview.visible,{loose:!0});this.polyChangedEvt().then(alp.bindF("_update_pubtransview",this))}),{_update_pubtransview:function(k){k&&(this._pubtransview.gmap!==this.gmap&&
(this._pubtransview.gmap&&this._pubtransview.setMap(null),this.gmap&&this._pubtransview.setMap(this.gmap)),this._pubtransview.update(k))}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.StartMarkerView");
(function(){var k=alp._gmap2_3;alp.declare("alp._gmap2_3.digitize.StartMarkerView",k.digitize.AbstractSafeGOverlay,alp.nowF(function(h,g){this._model=h;this._options=g||{};this.visible=new alp.BoolState({init_value:!this._options.start_hidden});this.visible.change_cb("update",this);this._marker=null;this._showmarker=!0}),{initialize_impl:function(h){this._map=h;k.event("addListener")(h,"maptypeid_changed",alp.bindF("_onmaptypeid_changed",this));this._onmaptypeid_changed();this.update()},remove_impl:function(){this._removeMarker();
this._map=null},copy:function(){return new alp._gmap2_3.digitize.StartMarkerView(this._model,this._options)},redraw:function(h){},_onmaptypeid_changed:function(){var h=alp.sub("G_SATELLITE_3D_MAP");this._map&&h&&(this._showmarker=!alp.gmap.equalGMapTypes(this._map.getCurrentMapType(),h),this.update())},_removeMarker:function(){this._marker&&(this._marker.setMap(null),this._marker=null)},_is_drawable:function(){return this._showmarker&&this.visible.get()},update:function(){if(this._map){var h=this._model;
this._is_drawable()&&h.getNodeCount()?(h=h.getNode(0),this._marker?this._marker.setPosition(h):(this._marker=k.marker_gen({position:h,clickable:!0,draggable:!1},"digitize_node_start"),this._marker.setMap(this._map))):this._removeMarker()}},isOverlay:function(h){return this._map&&this._marker===h?0:!1}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.AttributeLineView");
(function(){function k(b,c){b.polylineMouseoverEvt().triggerSoon(b._model.queryNearestPointAll(c.latLng,{mouseover:!0}))}function h(b,c){b.polylineMouseoutEvt().triggerSoon()}var g=alp._gmap2_3,f=g.digitize,e=f.EVENT_MAP_CLICK(),d=f.EVENT_MAP_CONTEXT_MENU();alp.declare("alp._gmap2_3.digitize.AttributeLineView",f.AbstractSafeGOverlay,function(b,c){this._model=b;this._options=c||{};this._options.lineOptions=this._options.lineOptions||{};this._polys=[];this._attributeKey=null;b=this._options.lineOptions;
b.weight=b.weight||5;b.opacity=b.opacity||1;this._ehg=[]},{initialize_impl:function(b){this._map=b;this.update()},remove_impl:function(){this._remove_polys();this._map=null},copy:function(){return new f.AttributeLineView(this._model,this._options)},redraw:function(b){},polylineMouseoverEvt:alp.memM("polylineMouseoverEvt",'alp.event("AttrLV:polylineMouseoverEvt",{then:1})'),polylineMouseoutEvt:alp.memM("polylineMouseoutEvt",'alp.event("AttrLV:polylineMouseoutEvt",{then:1})'),_remove_polys:function(){for(;this._polys.length;){var b=
this._polys.pop();b.setMap(null);b._alpEh.clear()}},update:function(){this._remove_polys();if(this._map&&this._attributeKey)for(var b=this._model.getAttributeSegments(this._attributeKey),c=0;c<b.length;c++){var a=this._getPoly(b[c]);a._alpEh=new alp.Eh;a._alpEh.push(g.event("addListener")(a,"click",function(b){f.topic(e).trigger(b,a)}),g.event("removeListener"));a._alpEh.push(g.event("addListener")(a,"rightclick",function(b){f.topic(d).trigger(b,a)}),g.event("removeListener"));a._alpEh.push(g.event("addListener")(a,
"mouseover",alp.nowF(alp.bindF(k,null,this))),g.event("removeListener"));a._alpEh.push(g.event("addListener")(a,"mouseout",alp.nowF(alp.bindF(h,null,this))),g.event("removeListener"));a.setMap(this._map);this._polys.push(a)}},isOverlay:function(b){if(b===this)return!0;for(var c=0;c<this._polys.length;c++)if(this._polys[c]===b)return!0;return!1},getBounds:function(){if(this._polys.length){for(var b=this._polys[0].getBounds(),c=1;c<this._polys.length;c++){var a=this._polys[c].getBounds();b.extend(a.getSouthWest());
b.extend(a.getNorthEast())}return b}return!1},_getPoly:function(b){var c=this._options.lineOptions,a=this._model.attributes.getColor(this._attributeKey,b.value).toHex();return g.polylineGen(alp.oCreateMix({path:b.vertices,strokeColor:a,strokeWeight:c.weight,strokeOpacity:c.opacity},c))},setAttribute:function(b){this._attributeKey=b;this.update()}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.AttributeLegendView");
alp.gmap3(function(k){function h(d,b,c){this.setMap||b.childNodes.a;this.widgetNode=b;this.model=d;this.widget=new g.digitize.views.AttributeLegendViewWidget(alp.oCreateMix(c||{},{model:this.model}),this.widgetNode);this.widget.clickEvt().bindEvent(this.clickEvt())}var g=alp._gmap2_3,f=g.digitize;alp.ensureCss(alp.cssBase()+"alp/_gmap2_3/digitize/resources/digitize.css");var e={getDiv:function(){return this.widget.domNode},getPositionV3:function(){return k.ControlPosition.RIGHT_BOTTOM},getPositionV2:function(){var d=
d;return new d.ControlPosition(d.ANCHOR_BOTTOM_RIGHT,new d.Size(2,16))},setAttribute:function(d,b){this.widget.attributeKey=d;1<arguments.length&&this.widget.selectedValue.set(b);this.update()},update:function(){this.widget.render()},remove:function(){this.widget&&this.widget.domNode&&alp.empty(this.widget.domNode);this.widget=null},clickEvt:alp.memM("clickEvt",'alp.event("AGDV:AttrLegendV:clickEvt",{then:1})')};alp.declare("alp._gmap2_3.digitize.AttributeLegendView",g.view.AbstractMapControl,alp.nowF(h),
e);alp.declare("alp._gmap2_3.digitize.AttributeLegendViewNoMap",null,alp.nowF(h),e);alp.declare("alp._gmap2_3.digitize.views.AttributeLegendViewWidget",null,function(d,b){alp.mixCheck(this,d);this.widgetNode=b;this.selectedValue=new alp.State;this.selectedValue.change_cb("render",this);this._eh=new alp.Eh;this._renderValue=new alp.State;this._renderValue.change_cb("_render_impl",this)},{model:null,attributeKey:null,selectedValue:null,widgetNode:null,markupVersion:1,domNode:null,titleNode:null,bodyNode:null,
attrNode:null,getAttributeData:function(){var d=this.attributeKey,b=this.model.attributes,c=alp.filter(b.getValues(d),'"_"!==v[0]');return alp.map(c,function(a){return{color:b.getColor(d,a),label:a,value:a}})},render:function(){this._renderValue.setNow(this.selectedValue.get())},_render_impl:function(){var d=this,b=2===this.markupVersion;d.domNode||(d.domNode=alp.cE("div",d.widgetNode,{"class":b?"alp-alv-legend-cont":"adAttributeLegend"},{innerHTML:b?'<div class="alp-alv-legend"><table><thead><tr><th colspan="2" ><span class="alp-alv-title alp-tpwiz-title-activity"></span></th></tr></thead><tbody></tbody></table></div>':
'<div class="adAttributeLegend"><table><thead><tr><th colspan="2" ><span class="adTitle"></span>:<br/><span class="adBody"></span></th></tr></thead><tbody></tbody></table></div>'}));d.titleNode=alp.nodify(b?"alp-alv-title":"adTitle",d.domNode);d.attrNode=alp.nodify(b?"alp-alv-body":"adBody",d.domNode);d.bodyNode=alp.gEBTN("tbody",d.domNode)[0];d.titleNode.innerHTML=f._i18n.attrAttribute||"Attribute";for(var c=d.bodyNode,a;a=c.lastChild;)c.removeChild(a);alp.style(d.domNode,"display",d.attributeKey?
"block":"none");d.attributeKey&&(console.log("xxx ALV eh clear"),d._eh.clear(),d.attrNode&&(d.attrNode.innerHTML=d.model.attributes.getLabel(d.attributeKey)),alp.forEach(d.getAttributeData(),function(a){var e=document.createElement("tr"),f=d.selectedValue.is(a.value);alp.setClass(e,[[b?"alp-alv-selected":"adAttributeLegendSelected",f],[b?"alp-alv-unselected":"adAttributeLegendUnselected",!f]]);if(b){f=d.model.attributes.getLabel(d.attributeKey,a.value);var g=document.createElement("td");g.appendChild(document.createTextNode(f));
alp.sA(g,"title",f||a.value);alp.sA(g,"data-value",a.value);alp.setClass(g,"alp-alv-legendlabel",!0);e.appendChild(g);g=document.createElement("td");alp.sA(g,"title",f||a.value);alp.sA(g,"data-value",a.value);alp.setClass(g,"alp-alv-legendcolor",!0);f=document.createElement("span");f.innerHTML="&nbsp;";alp.style(f,"backgroundColor",a.color.toHex());g.appendChild(f)}else f=d.model.attributes.getLabel(d.attributeKey,a.value),g=document.createElement("td"),g.innerHTML="&nbsp;",alp.sA(g,"title",a.value),
alp.style(g,"backgroundColor",a.color.toHex()),alp.setClass(g,"adAttributeLegendColor",!0),e.appendChild(g),g=document.createElement("td"),g.appendChild(document.createTextNode(f)),alp.sA(g,"title",a.value),alp.setClass(g,"adAttributeLegendLabel",!0);e.appendChild(g);c.appendChild(e);d.selectedValue.is(a.value)||(console.log("xxx ALV eh push nr click",e),d._eh.push(alp.aEL(e,"click",alp.nowF(function(){console.log("xxx ALV click");d.clickEvt().triggerSoon(d.attributeKey,a.value)}))))}))},clickEvt:alp.memM("clickEvt",
'alp.event("AttributeLegendV:clickEvt",{then:1})')})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views._widget");
(function(){alp.sub("alp._gmap2_3.digitize.views._widget",null,!0).setup_dom=function(k,h,g){(k&&h).substring.call.a;h=alp.cE("div",null,null,{innerHTML:h}).firstChild;g?alp.aC(alp.empty(g),h):g=h;k.domNode=g;alp.domWalkSelect(g,function(f){if(f.getAttribute){var e=f.getAttribute("dojoAttachPoint");e&&(k[e]=f);e=(f.getAttribute("dojoAttachEvent")||"").split(",");alp.forEach(e,function(d){var b=d.split(":");alp.aEL(f,b[0],function(c){c||(c=window.event);c.target||(c.target=c.srcElement);k[b[1]](c)})})}})}})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.LineProfileView");
alp.gmap3(function(k){var h=alp._gmap2_3,g=h.digitize.views;alp.declare("alp._gmap2_3.digitize.LineProfileView",null,alp.nowF(function(f,e,d){d&&alp.mixCheck(this,d);this.model=f;(this.profileNode=alp.nodelist(e)[0])?(alp.m(this.profileWidget,"destroy",!0),this.profileWidget=new alp._gmap2_3.digitize.LineProfileViewWidget({model:this.model},this.profileNode),this.withMapMarker&&(this.markerCfg=alp.cfg.marker.digitize_node_transparent(),this.markerCfg.url+="?alp._gmap2_3.digitize.LineProfileView."+
this._static.count++,this.markerOptions=alp.oCreateMix(h.marker_opts.markerCfg_2_markerOptions(this.markerCfg),{visible:!1,position:new k.LatLng(0,0)}),this.marker=h.marker_gen(this.markerOptions)),this.profileWidget.clickEvt().then(alp.bindF("_onClick",this)),this.profileWidget.selectEvt().then(alp.bindF("_onSelect",this)),this.profileWidget.markerSetEvt().then(alp.bindF("_profileSet",this)),this.withContextMenu&&this.profileWidget.contextMenuEvt().then(alp.bindF("_onContextMenu",this)),this.profileWidget.inactiveClickEvt().then(alp.bindF("_onInactiveClick",
this)),this.profileWidget.userZoomEvt().bindEvent(this.userZoomEvt()),this.profileWidget.mousemoveEvt().bindEvent(this.mousemoveEvt()),this.profileWidget.mouseoutEvt().bindEvent(this.mouseoutEvt())):console.error("alp.digitizie.LineProfileView could not find the profileNode",e)}),{_static:{count:0},withMapMarker:!0,withContextMenu:!0,addToMap:function(f){this.map=f;alp.m(this.marker,"setMap",f)},removeFromMap:function(f){alp.m(this.marker,"setMap",null)},setAttribute:function(f,e){this._attrKey=f;
this._attrValue=e;this.profileWidget.setAttribute(f,e);this._updateMarkerColor()},enableSelection:function(f){this.profileWidget.enableSelection(f)},getPc:function(){return this.profileWidget.getPc()},setPc:function(f){return this.profileWidget.setPc(f)},getZoom:function(){return this.profileWidget.getZoom()},setZoom:function(f){this.profileWidget.setZoom(f)},zoomOriginal:function(){return this.setZoom(1)},zoomIn:function(){return this.profileWidget.zoomIn()},zoomOut:function(){return this.profileWidget.zoomOut()},
update:function(){try{this.profileWidget.update()}catch(f){console.warn(this.declaredClass+": failed updating. Ignoring, since I am very likely outdated. e:"+f)}},getPointFromPc:function(f){var e=this.model.getSegmentLengths(),d=this.model.getLength();if(!(0<e.length&&0<d))return null;var b=e.length;d*=f;var c=0;for(f=0;f<b;f++){if(c+e[f]>d)return e=(d-c)/e[f],[this.model.getSegmentMidPoint(f,e),f,e];c+=e[f]}return[this.model.getNode(f),f-1,1]},_updateMarkerColor:function(){if(this.marker&&this.marker.getVisible()&&
(this.markerNode=alp.filter(alp.gEBTN("img",this.map.getDiv()),'alp.gA(v,"src")==="'+this.markerCfg.url+'"')[0]))if(this._attrKey&&null!==this._attrValue&&void 0!==this._attrValue){var f=this.model.attributes.getColor(this._attrKey,this._attrValue).toHex();alp.style(this.markerNode,"backgroundColor",f)}else alp.style(this.markerNode,"backgroundColor","white")},_profileSet:function(f){if("undefined"!=typeof f&&(f=this.getPointFromPc(f))){this.marker&&(this.marker.setPosition(f[0]),this.marker.setVisible(!0));
this._updateMarkerColor();return}alp.m(this.marker,"setVisible",!1)},clickEvt:alp.memM("clickEvt",'alp.event("AGDV:LineProfileV:clickEvt", {then:1})'),selectEvt:alp.memM("selectEvt",'alp.event("AGDV:LineProfileV:selectEvt", {then:1})'),contextMenuEvt:alp.memM("contextMenuEvt",'alp.event("AGDV:LineProfileV:contextMenuEvt", {then:1})'),inactiveClickEvt:alp.memM("inactiveClickEvt",'alp.event("AGDV:LineProfileV:inactiveClickEvt", {then:1})'),userZoomEvt:alp.memM("userZoomEvt",'alp.event("AGDV:LineProfileV:userZoomEvt", {then:1})'),
mousemoveEvt:alp.memM("mousemoveEvt",'alp.event("AGDV:LineProfileV:mousemoveEvt", {then:1})'),mouseoutEvt:alp.memM("mouseoutEvt",'alp.event("AGDV:LineProfileV:mouseoutEvt", {then:1})'),_onClick:alp.nowF(function(f){var e=this.getPointFromPc(f);e&&(e.unshift(f),f=this.clickEvt(),f.triggerSoon.apply(f,e))}),_onSelect:function(f,e){var d=this.getPointFromPc(f),b=this.getPointFromPc(e);d&&b&&(d.unshift(f),b.unshift(e),f=this.selectEvt(),f.triggerSoon.apply(f,d.concat(b)))},_onContextMenu:function(f){f||
(f=window.event);this.contextMenuEvt().triggerSoon(f)},_onInactiveClick:function(){this.inactiveClickEvt().triggerSoon()}});alp.declare("alp._gmap2_3.digitize.LineProfileViewWidget",null,alp.nowF(function(f,e){alp.mixCheck(this,f);g._widget.setup_dom(this,'<div class="alpDigitizeLineProfile" dojoAttachEvent="click:_onClick,mouseup:_onMouseUp">  <table>    <tbody>      <tr>        <td class="alpDigitizeLineProfileArrows">          <div title="Zoom In" class="alpDigitizeLineProfileArrowsIn" dojoAttachPoint="zoomInButtonNode" dojoAttachEvent="click:zoomIn" ></div>          <div title="Zoom Out" class="alpDigitizeLineProfileArrowsOut" dojoAttachPoint="zoomInButtonNode" dojoAttachEvent="click:zoomOut" ></div>        </td>        <td class="alpDigitizeLineProfileOuter">          <div class="alpDigitizeLineProfileScroller" dojoAttachPoint="scrollNode" dojoAttachEvent="scroll:updateLabels">            <div class="alpDigitizeLineProfileLine" dojoAttachPoint="lineNode" dojoAttachEvent="mousedown:_onMouseDown,mousemove:_onMouseMove">              <div class="alpDigitizeLineProfileContainer" dojoAttachPoint="containerNode"></div>              <div class="alpDigitizeLineProfileSelection" dojoAttachPoint="selectionNode"></div>            </div>            <div class="alpDigitizeLineProfileStartLabel" dojoAttachPoint="startLabelNode"></div>            <div class="alpDigitizeLineProfileEndLabel" dojoAttachPoint="endLabelNode"></div>            <div class="alpDigitizeLineProfileMouseLabelContainer" dojoAttachPoint="labelContainerNode">              <div class="alpDigitizeLineProfileMouseLabel" dojoAttachPoint="mouseLabelNode"></div>            </div>          </div>        </td>      </tr>    </tbody>  </table></div>',
e);this.postCreate()}),{clickEvt:alp.memM("clickEvt",'alp.event("AGDV_LPV:clickEvt",{then:1})'),selectEvt:alp.memM("selectEvt",'alp.event("AGDV_LPV:selectEvt",{then:1})'),markerSetEvt:alp.memM("markerSetEvt",'alp.event("AGDV_LPV:markerSetEvt",{then:1})'),contextMenuEvt:alp.memM("contextMenuEvt",'alp.event("AGDV_LPV:contextMenuEvt",{then:1})'),inactiveClickEvt:alp.memM("inactiveClickEvt",'alp.event("AGDV_LPV:inactiveClickEvt",{then:1})'),userZoomEvt:alp.memM("userZoomEvt",'alp.event("AGDV:LineProfileV:userZoomEvt", {then:1})'),
mousemoveEvt:alp.memM("mousemoveEvt",'alp.event("AGDV:LineProfileV:mousemoveEvt", {then:1})'),mouseoutEvt:alp.memM("mouseoutEvt",'alp.event("AGDV:LineProfileV:mouseoutEvt", {then:1})'),SNAP_PIXELS:5,selectionNode:null,containerNode:null,lineNode:null,model:null,attributeKey:null,attributeValue:null,_zoom:1,_attributePercentages:null,_canSelect:!1,_isDragging:!1,attributeNodes:null,zoomInButtonNode:null,zoomOutButtonNode:null,postCreate:function(){function f(b){b||(b=window.event);alp.stopEvent(b);
if(b&&0<b.wheelDelta){var c=d.getVisualRatio(b);b=d.getPc(c);d.zoomIn();d.setPc(b,c);e()}else b&&0>b.wheelDelta&&(c=d.getVisualRatio(b),b=d.getPc(c),d.zoomOut(),d.setPc(b,c),e())}function e(){d.userZoomEvt().triggerSoon({z:Math.max(0,Math.log(d.getZoom())/Math.log(2)),c:d.getPc()})}var d=this;alp.aEL(d.lineNode,"contextmenu",alp.nowF(function(b){d.contextMenuEvt().triggerSoon(b||window.event)}));alp.aEL(d.domNode,"dblclick",alp.nowF(function(b){b||(b=window.event);f(alp.mix(b,{wheelDelta:1}))}));
alp.aELdblrightclick(d.domNode,alp.nowF(function(b){b||(b=window.event);f(alp.mix(b,{wheelDelta:-1}))}));alp.aEL(d.domNode,"mousewheel",alp.nowF(f));d.update();alp.aEL(d.domNode,"mousemove",alp.nowF(function(b){b||(b=window.event);b=d.getVisualRatio(b);var c=d.getPc(b);d.mousemoveEvt().triggerSoon({pc:c,visual_ratio:b})}));alp.aEL(d.domNode,"mouseout",alp.nowF(function(b){d.mouseoutEvt().triggerSoon()}))},setAttribute:function(f,e){this.attributeKey=f;this.attributeValue=e;this.update()},enableSelection:alp.nowF(function(f){this._canSelect=
f;this.setDeleting(!1);this._isDragging&&!this._canSelect&&(this._isDragging=!1);this._canSelect||(alp.style(this.selectionNode,"visibility","hidden"),this.markerSetEvt().triggerSoon());this.updateLabels()}),getZoom:function(){return this._zoom},setZoom:function(f){var e=this.getPc();this._zoom=Math.max(1,f);alp.style(this.lineNode,"width",100*this._zoom+"%");this._calculateNumbers(this.lineNode.clientWidth);this.setPc(e);this.update()},getVisualRatio:function(f){return(f.clientX-alp.gBCR(this.scrollNode).left)/
this.scrollNode.clientWidth},getPc:function(f){f=void 0===f?.5:Math.max(0,Math.min(1,f));return(this.scrollNode.scrollLeft+this.scrollNode.clientWidth*f)/this.lineNode.clientWidth},setPc:function(f,e){e=void 0===e?.5:Math.max(0,Math.min(1,e));this.scrollNode.scrollLeft=Math.max(0,Math.min(1,f))*this.lineNode.clientWidth-this.scrollNode.clientWidth*e},_calculateNumbers:function(f){var e=this.scrollNode.scrollLeft/f;f=(this.scrollNode.scrollLeft+this.scrollNode.clientWidth)/f;this._overallLength=this.model.getLength();
this._visibleLength=this._overallLength*(f-e);return{left:e*this._overallLength,right:f*this._overallLength}},_calculateLabels:function(f){f=this._calculateNumbers(f);return{left:this._formatDistance(f.left,this._visibleLength),right:this._formatDistance(f.right,this._visibleLength)}},updateLabels:function(){var f=this._calculateLabels(this.lineNode.clientWidth);this.startLabelNode.innerHTML=f.left;this.endLabelNode.innerHTML=f.right},setDeleting:function(f){f=this._canSelect&&(void 0===f?!0:f);alp.setClass(this.lineNode,
{alpDigitizeLineProfileLineActive:this._canSelect,alpDigitizeLineProfileLineDeleting:f})},_formatDistance:function(f,e){var d=0;1E3>e?d=2:1E4>e&&(d=1);return(f/1E3).toFixed(d)+"km"},_updateAttributePercentages:function(){if(this.attributeKey){var f=this.model.attributes.get(this.attributeKey);if(f.length){this._attributePercentages={};for(var e=this.model.getLength(),d=this.model.getSegmentLengths(),b=d.length,c=[0],a=0;a<b;a++)c[a+1]=c[a]+d[a];for(a=0;a<f.length;a++){b=f[a];var g=Math.floor(b.from),
h=c[g];g!=b.from&&(h+=d[g]*(b.from-g));var k=Math.floor(b.to);g=c[k];k!=b.to&&(g+=d[k]*(b.to-k));h/=e;g/=e;b.value in this._attributePercentages||(this._attributePercentages[b.value]=[]);this._attributePercentages[b.value].push([h,g])}}}},update:function(){for(this.attributeNodes=[];this.containerNode.firstChild;)this.containerNode.removeChild(this.containerNode.firstChild);if(this.attributeKey&&null!==this.attributeValue&&void 0!==this.attributeValue){var f=this.model.attributes.getColor(this.attributeKey,
this.attributeValue).toHex();alp.style(this.selectionNode,"borderColor",f)}else alp.style(this.selectionNode,"borderColor","black");if(this.attributeKey&&this.model.attributes.get(this.attributeKey).length){this._updateAttributePercentages();for(var e in this._attributePercentages)if(this._attributePercentages.hasOwnProperty(e)){f=this._attributePercentages[e];for(var d=0;d<f.length;d++){var b=f[d][0],c=f[d][1],a=document.createElement("div");alp.style(a,{width:100*(c-b)+"%",left:100*b+"%",backgroundColor:this.model.attributes.getColor(this.attributeKey,
e).toHex()});alp.sA(a,"title",this.model.attributes.getLabel(this.attributeKey,e));this.containerNode.appendChild(a);this.attributeNodes.push(a)}}this.updateLabels()}},_snapToAttributeNode:function(f,e){var d=this.SNAP_PIXELS,b=null;f<=d&&(d=f,b=0);e-f<=d&&(d=e-f,b=e);for(var c=0;c<this.attributeNodes.length;c++){var a=this.attributeNodes[c],g=Math.abs(a.offsetLeft-f);g<=d&&(d=g,b=a.offsetLeft);g=Math.abs(a.offsetLeft+a.offsetWidth-f);g<=d&&(d=g,b=a.offsetLeft+a.offsetWidth)}if(null!==b)return this._pc=
b/e,!0;this._pc=f/e;return!1},_snapToNearestAttribute:function(){this._attributePercentages||this._updateAttributePercentages();var f=this._pc,e=null,d=null,b=function(a){for(var b=0;b<a.length;b++){var c=Math.abs(f-a[b]);if(null===d||c<d)d=c,e=a[b]}},c;for(c in this._attributePercentages)this._attributePercentages.hasOwnProperty(c)&&alp.forEach(this._attributePercentages[c],b);e?e>f&&e-f>f?e=0:e<f&&1-f<f-e&&(e=1):e=Math.round(f);this._pc=e;return!0},_updateMousePc:function(f){var e=alp.gBCR(this.lineNode);
return this._snapToAttributeNode(f.clientX-e.left,e.width)},_onMouseDown:function(f){2!=f.button&&(this._canSelect&&(this._isDragging=!0,this._updateMousePc(f)&&this._snapToNearestAttribute(),this._dragFrom=this._pc,this._eh_up=alp.aEL(document,"mouseup",alp.bindF("_onDocMouseUp",this))),alp.stopEvent(f))},_onMouseMove:alp.nowF(function(f){if(this._canSelect){this._updateMousePc(f);f=this._pc;if(this._isDragging){var e=f<this._dragFrom?f:this._dragFrom;var d=100*Math.abs(f-this._dragFrom)+"%"}else e=
f,d="0";alp.style(this.selectionNode,{left:e*this.lineNode.clientWidth+"px",width:d,visibility:"visible"});this.mouseLabelNode.innerHTML=this._formatDistance(this._overallLength*f,this._visibleLength);e=this.mouseLabelNode.clientWidth;d=alp.gBCR(this.lineNode).width;alp.style(this.mouseLabelNode,{left:Math.max(0,Math.min(d*f-e/2,d-e))+"px",visibility:"visible"});this.markerSetEvt().triggerSoon(f)}}),_onMouseUp:alp.nowF(function(f){f||(f=window.event);if(this._isDragging){alp.stopEvent(f);alp.rEL(this._eh_up);
this._isDragging=!1;this._onMouseMove(f);this._updateMousePc(f)&&this._snapToNearestAttribute();var e=this._pc;f=Math.min(this._dragFrom,e);e=Math.max(this._dragFrom,e);f!=e&&this.selectEvt().triggerSoon(f,e)}}),_onDocMouseUp:function(f){this._onMouseUp(f)},_onClick:alp.nowF(function(f){this._canSelect||this.inactiveClickEvt().triggerSoon()}),zoomIn:function(){return this.setZoom(2*this.getZoom())},zoomOut:function(){return this.setZoom(Math.max(1,this.getZoom()/2))}})});
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.EditHighlightLinePieceView");
(function(){alp.declare("alp._gmap2_3.digitize.EditHighlightLinePieceView",alp._gmap2_3.digitize.AbstractSafeGOverlay,alp.nowF(function(k,h){this.model=k;this.opt=alp.oCreateMix({update_mindelay_ms:125,highlightLineOptions:{strokeColor:"#00ed00",strokeWeight:2,strokeOpacity:1}},h);this.visible=new alp.BoolState({init_value:!this.opt.start_hidden});this.active_st=new alp.BoolState({init_value:!0});this.visible.change_cb("update",this);this.active_st.change_cb("update",this);alp.m(k.nextleg_to_highlight_st,
"change_cb","update",this);alp.ratelimitM(Math.abs(this.opt.update_mindelay_ms),"update",this)}),{visible:null,active_st:null,initialize_impl:function(k){this.update()},remove_impl:function(){this.update()},copy:function(){return new alp._gmap2_3.digitize.EditHighlightPieceView(this.model,this.opt)},redraw:function(k){},update:function(){if(this._polyline){var k=this._polyline;setTimeout(function(){k.setMap(null)},alp.likeIE()?333:250);this._polyline=null}if(this.visible.get()&&this.active_st.get()){var h=
this.on_map.get()&&this.gmap;if(h){var g=this.model.getNodeCount();if(!(3>g)){var f=alp.m(this.model.nextleg_to_highlight_st,"get");if(alp.isFiniteNumber(f)&&!(f>g-2)){var e;g=alp.m(this.model,"getCurrentImportantNode",f);f=alp.m(this.model,"getNextImportantNode",f);null!=g&&null!=f&&(e=alp.m(this.model,"getSegmentParts",g,f,"flat"));e&&e.length&&(this._polyline=alp._gmap2_3.polylineGen(alp.oCreateMix(this.opt.highlightLineOptions,{path:e,map:h})))}}}}}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views");
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.controllers.BaseEditMode");
alp.declare("alp._gmap2_3.digitize.controllers.BaseEditMode",alp._gmap2_3.digitize.utils.eventHelper,function(k,h){this.c=k;this.v=k._views;this.m=k._model;this.ec=k._editController;this.opts=h},{destroy:function(){this._disconnect();var k={},h;for(h in this)h in k||/^_eh2/.test(h)&&this[h].clear()},can:function(){return!0},startEvt:alp.memM("startEvt",'alp.event("BaseEditMode:startEvt",{then:1})'),start:function(){var k=this.startImpl.apply(this,arguments);this.startEvt().triggerSoon();return k},
startImpl:function(){this._is=!0},stopEvt:alp.memM("stopEvt",'alp.event("BaseEditMode:stopEvt",{then:1})'),stop:function(){var k=this.stopImpl.apply(this,arguments);this.stopEvt().triggerSoon();return k},stopImpl:function(){this._is=!1},populateContextMenu:function(k,h,g){return k}});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.controllers.PolyEditMode");
(function(){var k=alp._gmap2_3.digitize,h=k.EVENT_MAP_CLICK();alp.declare("alp._gmap2_3.digitize.controllers.PolyEditMode",k.controllers.BaseEditMode,null,{isEditing:!1,is:function(){return this.isEditing},can:function(g,f){return"undefined"==typeof g||g?(g=alp.dfrd("PolyEditMode:can",{then:1}),g.done(),g):!0},startImpl:function(){return this.can().then(alp.bindF("_start",this))},_start:function(){this.isEditing||(this.isEditing=!0,this.ec.activeItemController(this.c),alp.m(alp.opt(this._eh.edit,
"alp_eh"),"clear"),this._eh.edit={alp_eh:(new alp.Eh).push(this.v.poly.polyChangedEvt().then(alp.bindF("_onPolyChanged",this)))},alp.m(this._eh2_edit,"clear"),this._eh2_edit=new alp.Eh,this._eh.edit?(this._eh2_edit.push(k.topic(h).then(alp.bindF("_onMapEditClick",this))),this._eh2_edit.push(k.topic("/alp/_gmap2_3/digitize/EditController/map/event/moveend").then(alp.bindF("update",this.v.editMarker))),this._eh.edit.alp_eh.push(this.v.editMarker.nodeDragEndEvt().then(alp.bindF("_onNodeDragEnd",this))).push(this.v.editGhostMarker.nodeDragEndEvt().then(alp.bindF("_onGhostNodeDragEnd",
this))).push(this.c.geomChangeEvt().then(alp.bindF("_onGeomChange",this))),this.v.editMarker.setMap(this.ec.map),this.v.editGhostMarker.setMap(this.ec.map),this.v.editGhostMarker.connectMouseEvents(this.v.poly.getPieces()),this.ec.setMapEditingMode(!0),this.v.startMarker&&this.v.startMarker.setMap(null),this.v.directionArrows&&this.v.directionArrows.setMap(null)):console.warn("PolyEditMode: that._eh.edit:",this._eh.edit))},stopImpl:function(){this.isEditing&&(this.ec.activeItemController(null),this.v.editMarker.setMap(null),
this.v.editGhostMarker.setMap(null),this.v.editGhostMarker.disconnectMouseEvents(),this.v.startMarker&&this.v.startMarker.setMap(this.ec.map),this.v.directionArrows&&this.v.directionArrows.setMap(this.ec.map),this._disconnect("edit"),this._eh2_edit.clear(),this.isEditing=!1,this.ec.setMapEditingMode(!1))},_onGeomChange:function(){this.ec.setMapEditingMode(!0);this.v.editGhostMarker.disconnectMouseEvents();this.v.editGhostMarker.connectMouseEvents(this.v.poly.getPieces())},_onMapEditClick:function(g,
f){g=g.latLng;f&&this.v.poly.isOverlay(f)&&!this.isExtending&&this.stop();f||!g||this.isExtending||(this.is()&&this.stop(),f=(f=this.c.getMode())&&f===this.c.getMode("extend")&&f.is()?f.isRouting:!0,this.c.setMode("extend",!0,f,g))},_onNodeDragEnd:function(g,f){g=new k.UpdateNodeCommand(this.m,g,f,{address:"",poiId:""});this.ec.undoStack.add(g)},_onGhostNodeDragEnd:function(g,f,e,d){g=d?new k.InsertNodesCommand(this.m,[f,e],g+1,!1):new k.InsertNodesCommand(this.m,[e],g+1);this.ec.undoStack.add(g)},
_onPolyChanged:function(){this.v.editGhostMarker.disconnectMouseEvents();this.v.editGhostMarker.connectMouseEvents(this.v.poly.getPieces())}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.controllers.PolyExtendMode");
alp.gmap3(function(k){var h=alp._gmap2_3,g=h.digitize,f=g.EVENT_MAP_CLICK(),e=alp.declare("alp._gmap2_3.digitize.controllers.PolyExtendMode",g.controllers.PolyEditMode,alp.nowF(function(){var d=this;alp.ratelimitM(250,"_updateView",d);alp.ratelimitM(123,"_updateTooltip",d);d.tooltipVisible=new alp.BoolState({init_value:!0});d.tooltipVisible.change_cb("_updateTooltip",d);var b=d.opts&&d.opts.no_tooltip_on;if(b){var c=alp.nodelist(b);c.length&&alp.aEL(document,"mousemove",alp.ratelimitF(287,function(a){a||
(a=window.event);a&&a.target&&alp.isDescendant(a.target,c)&&d._removeTooltip()}))}alp.m(d.m.default_is_manual_st,"changed_cb",function(a){d.is()&&a!=d.isRouting||(d.is()&&d.stop(),d.start(!0,!a))})}),{isExtending:!1,tooltipVisible:null,_tooltipNode:null,startImpl:function(d,b,c){if(b&&!this.m.supportsRouting)throw Error("Not using a Model class that supports routing.");return this.can().then(alp.bindF("_start",this,d,b,c))},is:function(){return this.isExtending},_is_visible:function(){return this.ec.visible&&
!this.ec.visible.get()||this.c.visible&&!this.c.visible.get()?!1:!0},_start:function(d,b,c){alp.m(this.m.default_is_manual_st,"set",!b);this.tooltipVisible.set(!b);this.isExtending||(this._append="undefined"==typeof d?!0:d,this._snap=null,this.ec.activeItemController(this.c),this.ec.setMapEditingMode(!0),e.parent.prototype._start.apply(this,arguments),this._eh.extend={google:[h.event("addListener")(this.ec.map,"mousemove",alp.bindF("_onMapMouseMove",this)),h.event("addListener")(this.ec.map,"mouseout",
alp.bindF("_removeTooltip",this))],alp_eh:(new alp.Eh).push(this.c.geomChangeEvt().then(alp.bindF("_onGeomChange",this))).push(this.v.editMarker.nodeMouseoverEvt().then(alp.bindF("_onNodeMouseover",this)))},alp.m(this._eh2_extend,"clear"),this._eh2_extend=new alp.Eh,this._eh2_extend.push(g.topic(f).then(alp.bindF("_onMapExtendClick",this))),this._eh2_extend.push(g.topic("/alp/_gmap2_3/digitize/EditController/map/event/dblclick").then(alp.bindF(function(){this.c.setMode("edit")},this))),this.isRouting=
"undefined"==typeof b?!1:b,this.v.editMarker,"setMap",this.ec.map,this.v.editLine.setMap(this.ec.map),this.v.editLine.routing_st.set(this.isRouting),this.isExtending=!0,this._onGeomChange(),this._update_aggressive_network_overlay(),c&&this.append_new_latlng(c))},stopImpl:function(){this.isExtending&&(this.v.editMarker.setMap(null),this.v.editLine.setMap(null),this._disconnect("extend"),this._eh2_extend.clear(),this.isRouting=this.isExtending=!1,this._removeTooltip(),e.parent.prototype.stopImpl.apply(this,
arguments),this._update_aggressive_network_overlay())},append_new_latlng:function(d,b){var c=this._append?null:0,a=this.m.default_is_manual_st;null==b&&a&&(b=!a.get());null==b&&(b=this.isRouting&&0<this.m.getNodeCount());b=new g.InsertNodesCommand(this.m,[d],c,b);this.ec.undoStack.add(b);alp.m(alp.opt(this.m,"no_ghost_latlng_st"),"set",d)},_update_aggressive_network_overlay:function(){alp.oGet(this,"opts.extension.segment_network")&&alp.m(this.m.aggressive_network_highlight_st,"set",!0)},_onMapExtendClick:function(d,
b){if(this._is_visible()){this.ec.setMapEditingMode(!0);var c;b?(d=this.v.editMarker.isOverlay(b),"number"==typeof d&&(d==(this._append?this.m.getNodeCount()-1:0)?this.c.setMode("edit"):this.m.isClosed&&d==this.m.getNodeCount()-2?this.c.setMode("edit"):c=this.m.getNode(d))):c=d.latLng;c&&this.append_new_latlng(c)}},_onNodeMouseover:function(d){this._snap="undefined"==typeof d?null:this.m.getNode(d)},_updateView:function(){this.v.editLine.set(this._updateViewParams[0],this._updateViewParams[1]);this.ec.setMapEditingMode(!0)},
_formatDistance:function(d){var b=0,c="m";1500<d&&(d/=1E3,c="km");10>d?b=2:100>d&&(b=1);return d.toFixed(b)+c},_updateTooltip:function(d){d&&d instanceof k.LatLng?this._last_tooltip_latlng=d:d=this._last_tooltip_latlng;if(alp.likeIE8minus_backslash_v()||!this._is_visible()||!this.tooltipVisible.get())return this._removeTooltip();null==this._length&&(this._length=this.v.poly.getPolyLength()||0);if(!this._tooltipNode){this._tooltipNode=alp.cE("div",null,{style:"position: absolute; margin-left: -10px; margin-top: 20px;"});
var b=this.ec.map;b=alp.m(b,"getContainer")||alp.m(b,"getDiv");alp.m(b,"appendChild",this._tooltipNode);alp.setClass(this._tooltipNode,"alpDigitizeDistanceTooltip",!0)}b=this.v.editLine.getLength();b=[this._formatDistance(this._length+b||0),this._formatDistance(b||0)];this._tooltipNode.innerHTML=alp.tmpl(g._i18n.polylineLengthTooltip||"",b);d&&(d=h.fromLatLngToContainerPixel(this.ec.map,d),alp.style(this._tooltipNode,{left:d.x+"px",top:d.y+"px"}))},_removeTooltip:function(){this._tooltipNode&&alp.style(this._tooltipNode,
{left:"-1000px"})},_onMapMouseMove:function(d){d=d.latLng;this._updateViewParams=[this._append?this.m.getNode(-1):this.m.getNode(0),this._snap||d];this._updateTooltip(d);this._updateView()},_onGeomChange:function(){var d=this.m.getNode(-1);this.v.editLine.set(d,d);this._length=null}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.controllers.PolyAttrMode");
(function(){function k(b){var c={};c[e]=b||alp.date2str();return c}var h=alp._gmap2_3,g=h.digitize,f=g.EVENT_MAP_CLICK(),e=g.LINREF_ORIGIN_DATETIME(),d=g.LINREF_ORIGIN_HUMAN();alp.declare("alp._gmap2_3.digitize.controllers.PolyAttrMode",g.controllers.BaseEditMode,alp.nowF(function(){var b=this;b._menus={attrs:{},values:{}};b.v.attributeProfile&&(b._eh.base={alp_eh:(new alp.Eh).push(b.v.attributeProfile.inactiveClickEvt().then(function(){b.is()||b.c.setMode("attr")}))})}),{isAttributing:!1,_attrValue:null,
attributeChangeEvt:alp.memM("attributeChangeEvt",'alp.event("AGDC:PolyAttrMode:attributeChangeEvt",{ then:1 })'),is:function(){return this.isAttributing},can:function(){return!0},startImpl:function(){if(!this.isAttributing){this.m.attributes.fix();this._snap=null;this.ec.activeItemController(this.c);this.ec.setMapEditingMode(!0);this._clicks=[null,null];this._click_marker={};if(!this.getCurrentAttribute()&&this.m.attributes.getKeys().length){this.setAttribute(this.opts&&this.opts.default_key||this.m.attributes.getKeys()[0]);
var b=this.getCurrentAttribute(),c=this.m.attributes.getValues(b);c&&c.length&&this.setAttribute(b,this.opts&&this.opts.default_value||c[1]||c[0])}this.v.attributeLine.setMap(this.ec.map);alp.m(this.v.attributeLegend,"setMap",this.ec.map);this.v.attributeProfile&&(this.v.attributeProfile.addToMap(this.ec.map),this.v.attributeProfile.enableSelection(!0));this._eh.attr={};alp.m(this._eh2_attr,"clear");this._eh2_attr=new alp.Eh;this._eh2_attr.push(g.topic(f).then(alp.bindF("_onMapClick",this)));this.v.attributeProfile&&
(this._eh.attr.alp_eh=(new alp.Eh).push(this.v.attributeProfile.selectEvt().then(alp.bindF("_onProfileSelect",this))).push(this.v.attributeProfile.contextMenuEvt().then(alp.bindF("_onProfileContextMenu",this))));this.isAttributing=!0}},stopImpl:function(){this.isAttributing&&(this.v.attributeProfile&&this.v.attributeProfile.enableSelection(!1),this.v.attributeLine.setMap(null),alp.m(this.v.attributeLegend,"setMap",null),this.v.attributeProfile&&this.v.attributeProfile.removeFromMap(this.ec.map),this._placeClickMarker(),
this._disconnect("attr"),this._eh2_attr.clear(),this.isAttributing=!1)},getCurrentAttribute:function(){return this._attrKey},getCurrentAttributeValue:function(){return void 0===this._attrValue?null:this._attrValue},setAttribute:function(b,c){this.v.attributeProfile&&this.v.attributeProfile.profileWidget.setDeleting(!1);this._attrKey=b;this._attrValue=void 0===c?null:c;this._onAttributeChange()},_onAttributeChange:function(){for(var b in this.v)this.v.hasOwnProperty(b)&&this.v[b].setAttribute&&this.v[b].setAttribute(this._attrKey,
this._attrValue);this._updateMenus();this.attributeChangeEvt().triggerSoon()},_place:function(b){if(null===this._clicks[0])return this._clicks[0]=b,this._placeClickMarker(0,b.p),!1;this._clicks[1]=b;this._clicks[1].i<this._clicks[0].i&&(this._clicks[1]=this._clicks[0],this._clicks[0]=b);if(this._clicks[1].i==this._clicks[0].i)return alert(g._i18n.attrErrorSamePoint),this._placeClickMarker(),this._clicks=[null,null],!1;this._placeClickMarker(0,this._clicks[0].p);this._placeClickMarker(1,this._clicks[1].p);
return!0},_onMapClick:function(b,c){b=b.latLng;if(c&&b&&(this.v.poly.isOverlay(c)||this.v.attributeLine.isOverlay(c))&&(null===this._clicks[0]||null===this._clicks[1])&&(c=this.m.getIndexForPoint(b),this._place(c)))if(this._attrKey&&null!==this._attrValue)this.m.attributes.set(this._clicks[0].i,this._clicks[1].i,this._attrKey,this._attrValue,d,k()),this.m.onGeomChange(this.m),this._placeClickMarker(),this._clicks=[null,null];else throw Error("digitize PolyAttrMode: free attributes not supported yet! Please define your attributes through configuration.");
},_onProfileSelect:function(b,c,a,e,f,g,h,q){this._placeClickMarker();this._clicks=[null,null];this._place({p:c,i:a+e});if(this._place({p:g,i:h+q}))if(console.log("_onProfileSelect: k=",this._attrKey,"v=",this._attrValue),this._attrKey&&null!==this._attrValue)this.m.attributes.set(this._clicks[0].i,this._clicks[1].i,this._attrKey,this._attrValue,d,k()),this.m.onGeomChange(this.m),this._placeClickMarker(),this._clicks=[null,null];else throw Error("digitize PolyAttrMode: free attributes not supported yet! Please define your attributes through configuration.");
},_onNodeMouseover:function(b){this._snap="undefined"==typeof b?null:this.m.getNode(b)},_onMapMouseMove:function(b){var c=this._append?this.m.getNode(-1):this.m.getNode(0);this.v.editLine.set(c,this._snap||b);this.ec.setMapEditingMode(!0)},_onGeomChange:function(){},_placeClickMarker:function(b,c){if(void 0===b)for(var a in this._click_marker)this._click_marker.hasOwnProperty(a)&&this._click_marker[a]&&(this._click_marker[a].setMap(null),this._click_marker[a]=null);else this._click_marker[b]&&(this._click_marker[b].setMap(null),
this._click_marker[b]=null),c&&(this._click_marker[b]=h.marker_gen({position:c},"digitize_node"),this._click_marker[b].setMap(this.ec.map))},getAttributeListMenu:function(b){var c=this;if(c._menus.attrs[b])return c._menus.attrs[b];var a=new alp.x.Menu;c.m.attributes.options.newKeys&&c.m.attributes.options.newValues&&(a.add(),a.add({label:g._i18n.attrNew,onclick:function(){var a=window.prompt(g._i18n.attrTypePrompt,"");""!==a&&c.setAttribute(a)}}));c._menus.attrs[b]=a;c._updateMenus();return a},getValueListMenu:function(b){var c=
this;if(c._menus.values[b])return c._menus.values[b];var a=new alp.x.Menu;c.m.attributes.options.newValues&&(a.add(),a.add({label:g._i18n.attrNew,onclick:function(){var a=c.m.attributes.getLabel(c._attrKey);a=alp.tmpl(g._i18n.attrValuePrompt,[a]);a=window.prompt(a,"");""!==a&&c.setAttribute(c._attrKey,a)}}));c._menus.values[b]=a;c._updateMenus();return a},_createKeysMenu:function(){var b=this.m.attributes.getKeys();this.getCurrentAttribute();var c,a=this,d=[];for(c=b.length-1;0<=c;c--){var e={label:this.m.attributes.getLabel(b[c]),
selected:a.getCurrentAttribute()===b[c],onclick:function(b){return function(){a.setAttribute(b)}}(b[c]),isAttributeKey:!0};d.unshift(e)}return d},_createValuesMenu:function(){var b=this.getCurrentAttribute(),c=this.m.attributes.getValues(b);this.getCurrentAttributeValue();var a,d=this,e=[];for(a=c.length-1;0<=a;a--){var f={label:'<span style="background-color:'+this.m.attributes.getColor(this.getCurrentAttribute(),c[a])+';">&nbsp;</span>&nbsp;'+this.m.attributes.getLabel(b,c[a]),selected:d.getCurrentAttributeValue()===
c[a],onclick:function(a){return function(){d.setAttribute(d.getCurrentAttribute(),a)}}(c[a]),isAttributeValue:!0};e.unshift(f)}return e},_updateMenus:function(){var b;this.m.attributes.getKeys();this.getCurrentAttribute();for(b in this._menus.attrs)if(this._menus.attrs.hasOwnProperty(b)){var c=this._menus.attrs[b];c.modify("!v.isAttributeKey");alp.forEach(this._createKeysMenu(),c.add,c)}c=this.getCurrentAttribute();this.m.attributes.getValues(c);this.getCurrentAttributeValue();for(b in this._menus.values)this._menus.values.hasOwnProperty(b)&&
(c=this._menus.values[b],c.modify("!v.isAttributeValue"),alp.forEach(this._createValuesMenu(),c.add,c))},_startDeleting:function(){this._attrValue=void 0;this.v.attributeProfile&&this.v.attributeProfile.profileWidget.setDeleting(!0);this.onAttributeChange()},_onProfileContextMenu:function(b){b||(b=window.event);var c=this,a=1==this.v.attributeProfile.getZoom(),d=new alp.x.Menu;if(1<this.m.attributes.getKeys().length||this.m.attributes.options.newKeys&&this.m.attributes.options.newValues){var e=this.getAttributeListMenu("_profileContext");
d.add({label:g._i18n.attrAttributeTypes,onclick:e})}alp.forEach(this._createValuesMenu(),alp.bindF("add",d));d.add();d.add({label:g._i18n.attrZoomIn,onclick:function(){c.v.attributeProfile.zoomIn()}});this._profileContextMenu_zoomOut={label:g._i18n.attrZoomOut,disabled:a,onclick:function(){c.v.attributeProfile.zoomOut()}};d.add(this._profileContextMenu_zoomOut);this._profileContextMenu_zoomOriginal={label:g._i18n.attrZoomOriginal,disabled:a,onclick:function(){c.v.attributeProfile.zoomOriginal()}};
d.add(this._profileContextMenu_zoomOriginal);this._profileContextMenu=d;d.show(b)},populateContextMenu:function(b,c,a){b.add();if(1<this.m.attributes.getKeys().length||this.m.attributes.options.newKeys&&this.m.attributes.options.newValues)c=this.getAttributeListMenu("_mapContext"),b.add({label:g._i18n.attrAttributeTypes,onclick:c});alp.forEach(this._createValuesMenu(),alp.bindF("add",b))}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.box");
alp.gmap3(function(k){var h=alp._gmap2_3;alp.declare("alp._gmap2_3.x.Box",null,alp.nowF(function(g){this._eh=new alp.Eh;this._drag_eh=new alp.Eh;this.options=alp.oCreateMix(this.DEFAULT_OPTIONS,g||{});this.map_st=new alp.State;this.map_st.change_cb("_on_mapset",this);this.active_st=new alp.BoolState;this.isDragging_st=new alp.BoolState;this._map_and_active_st=alp.andState([this.map_st,this.active_st]);this._map_and_active_st.change_cb("_on_mapactive_change",this)}),{DEFAULT_OPTIONS:{persistent:!1},
map_st:null,active_st:null,isDragging_st:null,getMap:function(){return this.map_st.get()},setMap:function(g){this.map_st.set(g)},clear:function(){this.end();this._eh.clear();this.boxDiv&&(this.map.getDiv().removeChild(this.boxDiv),this.boxDiv=null)},start:function(){this.active_st.set(!0)},end:function(){this.active_st.unset()},isDragging:function(){return this.isDragging_st.get()},boxEvt:alp.memM("boxEvt",'alp.event("AGX:Box:boxEvt",{then:1})'),cancelEvt:alp.memM("cancelEvt",'alp.event("AGX:Box:cancelEvt",{then:1})'),
_onBox:function(g,f){this.boxEvt().triggerSoon(g,f)},_onCancel:function(){this.cancelEvt().triggerSoon()},_on_mapset:function(g){this._eh.clear();if(this.map=g){var f=document.createElement("div");alp.style(f,{display:"none",position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",overflow:"hidden",cursor:"crosshair",zIndex:9999});alp.likeIE()&&alp.style(f,{opacity:.01,backgroundColor:"#ffffff"});this._eh.push(alp.aEL(f,"mousedown",alp.nowF("_onCoverMouseDown",this),!0));this.coverDiv=
f;var e=document.createElement("div");alp.setClass(e,"agcBoxControl",!0);alp.style(e,{display:"none",position:"absolute",zIndex:9999});this.boxDiv=e;g.getDiv().appendChild(this.boxDiv);g.getDiv().appendChild(f);return f}},_on_mapactive_change:function(g){g?(alp.style(this.boxDiv,"display","none"),alp.style(this.coverDiv,"display","block"),this.isDragging_st.unset()):(this.coverDiv&&alp.style(this.coverDiv,"display","none"),this._cleanupDragging())},_onCoverMouseDown:function(g){g||(g=window.event);
alp.likeIE8minus_backslash_v()&&1!=g.button||!alp.likeIE()&&0!==g.button||(alp.stopEvent(g),this._startMouse={x:g.clientX,y:g.clientY},g=alp.gBCR(this.coverDiv),this._start={x:this._startMouse.x-g.left,y:this._startMouse.y-g.top},this._checkAndPositionBox(this._start),alp.style(this.boxDiv,"display","block"),this._drag_eh.clear(),this._drag_eh.push(alp.aEL(document,"pointermove",alp.stopEvent,!0)),this._drag_eh.push(alp.aEL(document,"pointerup",alp.stopEvent,!0)),this._drag_eh.push(alp.aEL(document,
"mousemove",alp.nowF("_onCoverMove",this),!0)),this._drag_eh.push(alp.aEL(document,"mouseup",alp.nowF("_onCoverUp",this),!0)),this.isDragging_st.set(!0))},_onCoverMove:function(g){this.isDragging()&&(alp.stopEvent(g),this._checkAndPositionBox({x:this._start.x+(g.clientX-this._startMouse.x),y:this._start.y+(g.clientY-this._startMouse.y)}))},_checkAndPositionBox:function(g){var f=new k.LatLngBounds;f.minX=Math.min(g.x,this._start.x);f.maxX=Math.max(g.x,this._start.x);f.minY=Math.min(g.y,this._start.y);
f.maxY=Math.max(g.y,this._start.y);this.boxDiv.style.left=f.minX+"px";this.boxDiv.style.top=f.minY+"px";this.boxDiv.style.width=f.maxX-f.minX+"px";this.boxDiv.style.height=f.maxY-f.minY+"px";this._box=f},_onCoverUp:function(g){function f(b){var c=d.getZoom();b=h.fromContainerPixelToLatLng(d,new k.Point(e._box.minX,e._box.maxY),c);c=h.fromContainerPixelToLatLng(d,new k.Point(e._box.maxX,e._box.minY),c);e._cleanupDragging();if(b.equals(c))e.end(),e._onCancel();else{var a=256*Math.pow(2,e.map.getZoom());
Math.abs(e._box.maxX-e._box.minX)>=a&&(b=new k.LatLng(b.lat(),-180),c=new k.LatLng(c.lat(),180));b=new k.LatLngBounds(b,c);e.options.persistent||e.end();e._onBox(b,e)}}var e=this,d=e.map;d&&e.isDragging()&&(alp.stopEvent(g),d.whenLoaded(function(){h.getProjectionDfrd(d).thenSoon(f)}))},_cleanupDragging:function(){this.isDragging_st.unset();this.boxDiv&&alp.style(this.boxDiv,"display","none");this._drag_eh.clear()}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.controllers.PolyBulkEditMode");
alp.gmap3(function(k){var h=alp._gmap2_3,g=h.digitize,f=g.EVENT_MAP_CLICK(),e={};g._i18n.dfrd.then(function(d){e=d});alp.declare("alp._gmap2_3.digitize.controllers.PolyBulkEditMode",g.controllers.PolyEditMode,function(d,b){this._opt_keyEvents=null==b.boxKeyboardEvents||b.boxKeyboardEvents;this._boxControl=new h.x.Box;alp.ratelimitM(123,"_onGeomChange",this)},{_start:function(){this.isEditing||(this.isEditing=!0,this.ec.activeItemController(this.c),this._selected=null,this._eh.edit={alp_eh:(new alp.Eh).push(this.v.editMarker.nodeDragStartEvt().then(alp.bindF("_onNodeDragStart",
this))).push(this.v.editMarker.nodeDragEvt().then(alp.bindF("_onNodeDrag",this))).push(this.v.editMarker.nodeDragEndEvt().then(alp.bindF("_onNodeDragEnd",this))).push(this._boxControl.boxEvt().then(alp.bindF("_onBoxDragged",this))).push(this._boxControl.cancelEvt().then(alp.bindF("stop",this))).push(this.c.geomChangeEvt().then(alp.bindF("_onGeomChange",this))).push(this.c.geomChangeEvt().then(alp.bindF("setMapEditingMode",this.ec,!0)))},this._opt_keyEvents&&this._eh.edit.alp_eh.push(alp.aEL(window,
"keyup",alp.nowF("_onKeyUp",this))),alp.m(this._eh2_edit,"clear"),this._eh2_edit=new alp.Eh,this._eh2_edit.push(g.topic("/alp/_gmap2_3/digitize/EditController/map/event/moveend").then(alp.bindF("update",this.v.editMarker))),this._eh2_edit.push(g.topic(f).then(alp.bindF("_onMapClick",this))),this.v.editMarker.setSelected(),this.v.editMarker.setMap(this.ec.map),this.ec.setMapEditingMode(!0),this._boxControl.setMap(this.ec.map),this.v.startMarker&&this.v.startMarker.setMap(null),this.v.directionArrows&&
this.v.directionArrows.setMap(null),this.startBox())},stopImpl:function(){this.isEditing&&(alp.m(this._eh2_edit,"clear"),this.ec.activeItemController(null),this.v.editMarker.setMap(null),this.v.editMarker.setSelected(),this._boxControl.setMap(null),alp.m(this.v.startMarker,"setMap",this.ec.map),alp.m(this.v.directionArrows,"setMap",this.ec.map),this._disconnect("edit"),this.isEditing=!1,this._selected=null,this.ec.setMapEditingMode(!1),alp.m(this.c,"setMode","edit",!0))},startBox:function(){this._boxControl.start()},
stopBox:function(){this._boxControl.end()},_onGeomChange:function(){this._selected=null;this.v.editMarker.setSelected()},_onMapClick:function(d,b){if(b&&(d=this.v.editMarker.isOverlay(b),!1!==d)){b=this.m.getNode(d);if(this._selected){var c=this._selected.indexes.indexOf(d);if(0<=c){this._selected.nodes.splice(c,1);this._selected.indexes.splice(c,1);if(0==this._selected.indexes.length){this._cancelSelection();return}this.v.editMarker.setSelected(this._selected.nodes);return}}else this._selected={nodes:[],
indexes:[]};this._selected.nodes.push(b);this._selected.indexes.push(d);this.v.editMarker.setSelected(this._selected.nodes)}},_onKeyUp:function(d){if(this._selected)switch(d.keyCode){case alp.key.DELETE:case alp.key.BACKSPACE:this._deleteSelection();break;case alp.key.ESCAPE:this._cancelSelection()}},_onNodeDragStart:function(d,b){this._dragIndex=d;this._dragFrom=b;this.v.editMarker.startMoving(this.m.getNode(d))},_onNodeDrag:function(d,b){var c=this.ec.map;d=h.fromLatLngToContainerPixel(c,this._dragFrom);
b=h.fromLatLngToContainerPixel(c,b);b=new k.Point(b.x-d.x,b.y-d.y);this.v.editMarker.moveSelected(b)},_onNodeDragEnd:function(d,b){var c=this.v.editMarker.stopMoving(),a=this.m;d=[d];b=[b];this._selected.indexes.slice();for(var e=0,f=c.length;e<f;e++){var h=c[e];d.push(h[0]);b.push(h[1])}c=new g.UpdateNodeArrayCommand(a,d,b);this.ec.undoStack.add(c);this.startBox()},_onBoxDragged:function(d){this._selected=d=this.m.findNodesForBounds(d);this.v.editMarker.setSelected(d.nodes);d.nodes.length||this.stop()},
_cancelSelection:function(){this._selected=null;this.v.editMarker.setSelected();this.startBox()},_deleteSelection:function(){if(this._selected){for(var d=this._selected.indexes.concat(),b=[],c=[d.shift()];d.length;){var a=d.shift();a==c[c.length-1]+1?c.push(a):(b.push(c),c=[a])}for(b.push(c);b.length;)c=b.pop(),d=new g.DeleteNodesCommand(this.m,c[0],c.length),this.ec.undoStack.add(d);this._cancelSelection();this.startBox()}},populateContextMenu:function(d,b,c){d.add();this._selected&&this._selected.nodes.length?
(d.add({label:e.contextCancelSelection,onclick:alp.bindF("_cancelSelection",this)}),d.add({label:e.contextDeleteNodes,onclick:alp.bindF("_deleteSelection",this)}),d.add()):this._boxControl.active_st.get()||d.add({label:e.agcDTBBulkedit,onclick:alp.bindF(function(){this.startBox()},this)})}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.controllers.PolyEditController");
(function(){var k=alp._gmap2_3,h=k.digitize;h.EXTENSION();h.PUBLIC_TRANSPORT();var g=h.REVERSE_FEATURE(),f=h.EVENT_MAP_CLICK();alp.declare("alp._gmap2_3.digitize.PolyEditController",h.controllers.BaseEditController,alp.nowF(function(e,d,b){var c=this;c._opts=alp.oCreateMix({editLineOptions:{manualSegmentWeightRatio:.5,opacity:1}},b);d.undoStack=e.undoStack;g in c._opts||(c._opts[g]=!alp.sub("extension.public_transport",c._opts));c._viewList=[];c.visible=new alp.BoolState({init_value:!0});c.visible.change_cb("_update_views_visibility",
c);c._viewList.push(["poly",new (d.isClosed?h.PolygonView:h.PolylineViewWithPublicTransport)(d,alp.oCreateMix(c._opts.polyViewOptions,{fillOptions:c._opts.viewFillOptions,public_transport:c._opts.public_transport,routing_public_transport:c._opts.routing_public_transport}))]);c._viewList.push(["editGhostMarker",new h.EditGhostNodeMarkerView(d)]);c._viewList.push(["editMarker",new h.EditMarkerView(d,c._opts.editMarkerOptions)]);c._viewList.push(["editLine",new h.EditLineView(alp.oCreateMix(c._opts.editLineOptions,
{model:d}))]);c._viewList.push(["editHighlightLinePiece",new h.EditHighlightLinePieceView(d)]);if(!d.isClosed){c._viewList.push(["startMarker",new h.StartMarkerView(d)]);c._viewList.push(["directionArrows",new h.DirectionArrowView(d)]);if(e=alp.nodify(c._opts.profileNode))c._viewList.push(["attributeProfile",new h.LineProfileView(d,e,c._opts.profile_opts)]),e=c._opts.attrLegendNoMap_widgetNode,c._viewList.push(["attributeLegend",new h[e?"AttributeLegendViewNoMap":"AttributeLegendView"](d,e,c._opts.attrLegendOptions)]);
c._viewList.push(["attributeLine",new h.AttributeLineView(d)])}c._views={};for(e=0;e<c._viewList.length;e++)b=c._viewList[e],c._views[b[0]]=b[1];c._views.editMarker.setMap(c._editController.map);d.isClosed||(c._views.startMarker.setMap(c._editController.map),c._views.directionArrows.setMap(c._editController.map));window.setTimeout(function(){c._views.poly.setMap(c._editController.map);alp.forEach(["editHighlightLinePiece","publicTransport"],function(a){(a=c._views[a])&&a.setMap(c._editController.map)})},
0);d.getNetworkSnapTolerance&&(d.getNetworkSnapTolerance=alp.bindF("_modelGetSnapTolerance",c));d={extension:c._opts.extension,elproLinrefEdit:c._opts.elproLinrefEdit};c.modes={edit:new h.controllers.PolyEditMode(c,alp.oCreate(d)),extend:new h.controllers.PolyExtendMode(c,alp.oCreateMix(d,c._opts.polyExtendMode)),attr:new h.controllers.PolyAttrMode(c,alp.oCreate(d)),bulkedit:new h.controllers.PolyBulkEditMode(c,alp.oCreateMix(d,c._opts.keyboardEvents))};for(var a in c.modes)c.modes.hasOwnProperty(a)&&
(c.modes[a]._mode_id=a);c.nodeMouseoverEvt=c._views.editMarker.nodeMouseoverEvt;c._eh.base={alp_eh:(new alp.Eh).push(c.modes.attr.attributeChangeEvt().then(alp.bindF("_onAttributeChange",c)))};c._eh2.push(c._model.geomChangeEvt().then(alp.bindF("_onGeomChange",c)));c._eh2.push(h.topic(f).then(alp.bindF("_base_onMapClick",c)));c._eh2.push(h.topic("/alp/_gmap2_3/digitize/EditController/map/event/zoomend").then(alp.bindF("_base_onMapZoomEnd",c)));c._views&&c._views.attributeLegend&&c._eh.base.alp_eh.push(c._views.attributeLegend.clickEvt().then(alp.bindF("setAttribute",
c.modes.attr)));c._update_views_visibility();c.updateStyle();c._onGeomChange()}),{startExtending:function(e){var d=this&&this.getMode("extend"),b=this&&this.getMode("bulkedit"),c=this&&this.getMode("attr");this&&this.getMode("edit");d.is()&&d.stop();b.is()&&b.stop();c.is()&&c.stop();(d=this&&this.getMode())&&d.is()&&d.stop();e&&!this._model.supportsRouting&&(alert(h._i18n.agcDTBRoutingUnavailable),e=!1);this.setMode("extend",!0,e)},hasAttributeProfile:function(){return!!this._views.attributeProfile||
alp.m(this._opts,"hasCustomAttributeProfile")},geomChangeEvt:alp.memM("geomChangeEvt",'alp.event( "AGDC:PolyEditC:geomChangeEvt", {then:1})'),attributeChangeEvt:alp.memM("attributeChangeEvt",'alp.event("AGDC:PolyEditC:attributeChangeEvt", {then:1})'),_update_views_visibility:function(){var e=this.visible.get();alp.forIn(this._views,function(d,b){d&&d.visible&&d.visible.set(e)})},destroyViews:function(){for(var e=this._viewList;e&&e.length;){var d=e.pop()[1];d.visible&&d.visible.set();d.remove&&d.remove();
d.destroy&&d.destroy(!0)}},_onGeomChange:function(){for(var e=0;e<this._viewList.length;e++)this._viewList[e][1].update();this.geomChangeEvt().triggerSoon()},_onAttributeChange:function(){var e=this.modes.attr.getCurrentAttribute(),d=this.modes.attr.getCurrentAttributeValue(),b;e&&d&&(b=this._views.attributeLegend)&&(b.setAttribute(e,d),this.attributeChangeEvt().triggerSoon(e,d))},setMode:function(){var e=Array.prototype.slice.call(arguments),d=e.shift()||null;d&&"object"===typeof d&&(d=d._mode_id);
var b=this._activeMode||null;d=this.modes[d]||null;b&&b.is()&&b.stop();if(d&&d.can()){this._activeMode=d;var c=d.start.apply(d,e)}else this._activeMode=null;this._onModeChange(d,b);return c},_base_onMapClick:function(e,d){!d||!this._views.poly.isOverlay(d)||this._viewonly||this._activeMode&&this._activeMode.is()||this.setMode("edit",!0,e.latLng)},_base_onMapZoomEnd:function(e,d){this._activeMode&&!this.modes.edit.can(!1)&&(this._activeMode.stop(),this._activeMode.start(this._extend_append,this.isRouting));
this._views.directionArrows&&this._views.directionArrows.update()},updateStyle:function(){var e=this._views.poly;e&&(this._activeMode&&this._activeMode.isEditing?this._opts.editLineOptions&&e.setStrokeStyle(this._opts.editLineOptions,.5):this._opts.viewLineOptions&&e.setStrokeStyle(this._opts.viewLineOptions,1),this._activeMode&&this._activeMode.isAttributing?e.hide&&e.hide():e.show&&e.show())},getBounds:function(){var e=this._views.poly.getBounds(),d=(e=e?e:k.polylineGen({path:this._model.getVertices()}).getBounds())&&
e.toSpan();return d&&d.lat()&&d.lng()&&e},_modelGetSnapTolerance:function(e){var d=this._editController.map.getZoom();return 156543.03390625/Math.pow(2,d)*e},populateContextMenu:function(e,d,b){function c(b){q&&(b&&e.add(),"isSegmentRouted"in k&&n<r-1&&(k.isSegmentRouted(n)?e.add({label:h._i18n.contextSegManual,onclick:alp.nowF(function(){var b=new h.SetSegmentManualCommand(a._model,n);a._editController.undoStack.add(b)})}):e.add({label:h._i18n.contextSegRouted,onclick:alp.nowF(function(){var b=new h.SetSegmentRoutedCommand(a._model,
n);a._editController.undoStack.add(b)})})))}var a=this,f=!1,k=a._model,r=k.getNodeCount(),n=alp.m(k.nextleg_to_highlight_st,"get"),q=alp.isFiniteNumber(n),p=!1;if(d&&!d.nodeType){var v=a._views.poly.isOverlay(d);if(!v){var u=a._views.editMarker.isOverlay(d);var t=a._views.editGhostMarker.isOverlay(d)}!1!==u&&0<=u&&(e.add(),e.add({label:h._i18n.contextDeleteNode,onclick:alp.nowF(function(){var b=new h.DeleteNodesCommand(a._model,u,1);a._editController.undoStack.add(b)})}),!q&&"isSegmentRouted"in k&&
u<r-1&&(k.isSegmentRouted(u)?e.add({label:h._i18n.contextNextSegManual,onclick:alp.nowF(function(){var b=new h.SetSegmentManualCommand(a._model,u);a._editController.undoStack.add(b)})}):e.add({label:h._i18n.contextNextSegRouted,onclick:alp.nowF(function(){var b=new h.SetSegmentRoutedCommand(a._model,u);a._editController.undoStack.add(b)})})));p=!0;if(!1!==v||!1!==u||!1!==t)e.add(),e.add({label:h._i18n.contextDeleteFeature,onclick:alp.nowF(function(){alp.m(a._model,["cmdDeleteNodes","deleteNodes"],
0,r)})}),a._opts[g]&&e.add({label:h._i18n.contextReverseFeature,onclick:alp.nowF(function(){var b=new h.ReverseCommand(a._model);a._editController.undoStack.add(b)})})}else 0!==r||a._activeMode&&a._activeMode.isExtending||(p=!0,e.add(),e.add({label:h._i18n.contextDigitize,onclick:alp.nowF(function(){a.setMode("extend",!0)})}),e.add({label:h._i18n.contextDigitizeRouted,onclick:alp.nowF(function(){a.setMode("extend",!0,!0)})}),f=!0);if(p=p||a._activeMode)c(!0),a._activeMode.populateContextMenu(e,d,
b);f||(e.add({label:h._i18n.contextExtendFeature,disabled:a._activeMode&&a._activeMode.isExtending&&!a._activeMode.isRouting,onclick:alp.nowF(function(){a._activeMode.isExtending&&a._activeMode.stop();a.setMode("extend",!0,!1)})}),a._model.supportsRouting&&e.add({label:h._i18n.contextExtendFeatureRouted,disabled:a._activeMode&&a._activeMode.isExtending&&a._activeMode.isRouting,onclick:alp.nowF(function(){a._activeMode.isExtending&&a._activeMode.stop();a.setMode("extend",!0,!0)})}),f=!0);e._alpExtendAdded=
f}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.controllers.link_center_zoom_elpro_and_linref");
(function(){alp.sub("alp._gmap2_3.digitize.controllers",null,!0).link_center_zoom_elpro_and_linref=function(k,h,g){function f(){var d=h.m.zoom.get(),b=h.m.center.get();g.setZoom(Math.pow(2,d));g.setPc(b)}if(h&&g){f();k.push(h.m.zoom.change_cb(f));k.push(h.m.center.change_cb(f));var e=new alp.BoolState;h.m.canvasFriends.add(e);k.push(g.userZoomEvt().thenSoon(function(d){h.m.zoom.set(d.z);h.m.center.set(d.c);h.mouseZoomEvt().triggerSoon()}));k.push(g.mousemoveEvt().thenSoon(function(d){e.set(!0);var b=
h.m.visible.get(),c=b&&b.left;b=b&&b.right;null!=c&&null!=b&&h.m.highlightD.set(c+d.visual_ratio*(b-c))}));k.push(g.mouseoutEvt().thenSoon(function(){e.unset()}))}}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.PolygonModel");
(function(){alp.declare("alp._gmap2_3.digitize.PolygonModel",alp._gmap2_3.digitize.PolylineModel,null,{isClosed:!0,getNodes:function(){return this._nodes.length?this._nodes.concat([this._nodes[0]]):[]},getNodeCount:function(){var k=this._nodes.length;return k?k+1:0},toGeoJSON:function(){return alp._gmap2_3.toGeoJSON("POLYGON",this.getNodes())},_mod:function(k){for(;0>k;)k+=this._nodes.length;return k%this._nodes.length},getNode:function(k){return this._nodes.length?this._nodes[this._mod(k)]:null}});
alp._gmap2_3.digitize.PolygonModel.fromGeoJSON=function(k,h){k=alp._gmap2_3.fromGeoJSON(k,"POLYGON");return new alp._gmap2_3.digitize.PolygonModel(h,k)}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.models.PointModel");
(function(){var k=alp._gmap2_3;alp.declare("alp._gmap2_3.digitize.PointModel",null,function(h,g){this._opts=h||{};this._point=g||null},k.digitize.InterfaceBaseModel,{clear:function(){this._point=null;this.onGeomChange(this)},get:function(){return this._point},set:function(h){var g=this._point;this._point=h;this.onGeomChange(this);return g},equals:function(h){return this._point&&this._point.equals(h)},toGeoJSON:function(){return k.geojson.toGeoJSON("POINT",this._point)},onGeomChange:alp.nowF(function(h){this.geomChangeEvt().triggerSoon(h)}),
geomChangeEvt:alp.memM("geomChangeEvt",'alp.event("PointM:geomChangeEvt",{then:1})')});alp._gmap2_3.digitize.PointModel.fromGeoJSON=function(h,g){h=k.geojson.fromGeoJSON(h,"POINT");return new alp._gmap2_3.digitize.PointModel(g,h)}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.toolbar");
alp.gmap3(function(k){var h=alp._gmap2_3,g=h.digitize;alp.ensureCss(alp.cssBase()+"alp/x.css");alp.ensureCss(alp.cssBase()+"alp/_gmap2_3/digitize/resources/digitize.css");alp.declare("alp._gmap2_3.digitize.Toolbar",h.view.AbstractMapControl,function(f,e){this.polyEditController=f;alp.mix(this,e);this._eh=new alp.Eh;this.visible_st=new alp.BoolState({init_value:!0});this.div=alp.cE("div")},{whenLoc:g._i18n.dfrd,preText:!1,getDiv:function(){return this.div},getPositionV3:function(){return k.ControlPosition.TOP_LEFT},
getPositionV2:function(){var f=f;return new f.ControlPosition(f.ANCHOR_TOP_LEFT,new f.Size(0,0))},alp_destroy:function(f){this._eh.clear()},alp_create:function(f){function e(){a.setVisible(c.visible_st.get())}function d(){var b=k,e=b&&b.getMode("edit"),f=b&&b.getMode("extend"),g=b&&b.getMode("bulkedit");b=b&&b.getMode("attr");e&&f&&(a.setVisible(a.always()||e.is()||f.is()||g.is()||b.is()),a.setButtonSelected("routed",f.is()&&f.isRouting),a.setButtonSelected("manual",f.is()&&!f.isRouting),a.setButtonSelected("bulkedit",
g.is()),a.setButtonSelected("attr",b.is()),c._connected||(alp.forEach([f.startEvt().then(d),f.stopEvt().then(d),e.startEvt().then(d),e.stopEvt().then(d),g.startEvt().then(d),g.stopEvt().then(d),b.startEvt().then(d),b.stopEvt().then(d)],function(a){c._eh.push(a)}),c._connected=!0))}function b(a){var b=k,c=b&&b.getMode("extend"),d=b&&b.getMode("bulkedit"),e=b&&b.getMode("attr");b&&b.getMode("edit");var f=c.is()&&c.isRouting==a;c.is()&&c.stop();d.is()&&d.stop();e.is()&&e.stop();(c=b&&b.getMode())&&c.is()&&
c.stop();f?b.setMode("edit"):(a&&!k._model.supportsRouting&&(alert(g._i18n.agcDTBRoutingUnavailable),a=!1),b.setMode("extend",!0,a))}var c=this;c._eh.clear();c.map=f;var a=new h.digitize.views.DigitizeToolbarW({},c.div);c.div.appendChild(a.domNode);c.widget=a;alp.setClass(c.div,"agShowPreText",c.preText);c._eh.push(c.visible_st.change_cb(e));e();var k=c.polyEditController;c._connected=!1;c.polyEditController&&d();c._eh.push(g.topic("/alp/_gmap2_3/digitize/views/DigitizeToolbarW/routed").then(alp.bindF(b,
null,!0)));c._eh.push(g.topic("/alp/_gmap2_3/digitize/views/DigitizeToolbarW/manual").then(alp.bindF(b,null,!1)));c._eh.push(g.topic("/alp/_gmap2_3/digitize/views/DigitizeToolbarW/bulkedit").then(function(){var a=k,b=alp.m(a,"getModel"),c=alp.m(b,"getNodeCount");b=alp.m(b,"getVertexCount");if(0<c||0<b){b=a&&a.getMode("extend");var d=a&&a.getMode("attr");c=(a&&a.getMode("bulkedit")).is();b.is()&&b.stop();d.is()&&d.stop();(b=a&&a.getMode())&&b.is()&&b.stop();c?a.setMode("edit"):a.setMode("bulkedit",
!0)}else alp.humane(g._i18n.agcDTBBulkeditEmptyModelContent)}));c._eh.push(g.topic("/alp/_gmap2_3/digitize/views/DigitizeToolbarW/attr").then(function(){var a=k,b=a&&a.getMode("extend"),c=a&&a.getMode("attr"),d=c.is();alp.m(a,"hasAttributeProfile")?(b.is()&&b.stop(),c.is()&&c.stop(),(b=a&&a.getMode())&&b.is()&&b.stop(),d?a.setMode("edit"):a.setMode("attr",!0)):(alert(g._i18n.agcDTBAttrUnavailable),c.stop())}))}});g._i18n.dfrd.then(function(f){alp.declare("alp._gmap2_3.digitize.views.DigitizeToolbarW",
null,function(e){var d=this;alp.mixCheck(d,e);d._buttonNode={};d.domNode=alp.cE("div",null,{"class":"agcDTB"},{innerHTML:alp.tmpl('<div class="agcDTB"><div style="float: left"><div class="agTop"></div><div style="clear: both;"></div><div> <div class="agPreTextCont">    <div class="agPreText" onselectstart="return false;" onmousedown="return false;">      ${i18n.agcDTBPreText}    </div>  </div>  <div class="agcNav">    <div class="agcNavContainer">      <div class="agcNavViews">        <div class="agcNavViewsBg agcNavColor">          <ul><li id="agcDTB-routed-li" class="alp-js-agcDTB-button"><span class="agcNavCollapse"><span id="agcDTB-routed" class="alpdtb_sprite map_tools_routing" align="top" alt="${i18n.agcDTBRouted}" title="${i18n.agcDTBRouted}"></span></span></li><li id="agcDTB-manual-li" class="alp-js-agcDTB-button"><span class="agcNavCollapse"><span id="agcDTB-manual" class="alpdtb_sprite map_tools_routing_manual" align="top" alt="${i18n.agcDTBManual}" title="${i18n.agcDTBManual}"></span></span></li><li id="agcDTB-bulkedit-li" class="alp-js-agcDTB-button"><span class="agcNavCollapse"><span id="agcDTB-bulkedit" class="alpdtb_sprite map_tools_bulkedit" align="top" alt="${i18n.agcDTBBulkedit}" title="${i18n.agcDTBBulkedit}"></span></span></li><li id="agcDTB-attr-li" class="alp-js-agcDTB-button"><span class="agcNavCollapse"><span id="agcDTB-attr" class="alpdtb_sprite map_tools_attr" align="top" alt="${i18n.agcDTBAttr}" title="${i18n.agcDTBAttr}"></span></span></li><li id="agcDTB-undo-li" class="alp-js-agcDTB-button"><span class="agcNavCollapse"><span id="agcDTB-undo" class="alpdtb_sprite map_tools_undo" align="top" alt="${i18n.agcDTBUndo}" title="${i18n.agcDTBUndo}"></span></span></li><li id="agcDTB-redo-li" class="alp-js-agcDTB-button"><span class="agcNavCollapse"><span id="agcDTB-redo" class="alpdtb_sprite map_tools_redo" align="top" alt="${i18n.agcDTBRedo}" title="${i18n.agcDTBRedo}"></span></span></li></ul>        </div>      </div>    </div>  </div></div><div style="clear: both;"></div><div class="agBottom"></div></div><div style="float:right"><div class="agRight"></div></div></div>',
{i18n:f})});alp.forEach(alp.gEBCN("alp-js-agcDTB-button",d.domNode),function(b){var c=alp.gA(b,"id").match(/^agcDTB-(.*?)(-li)?$/)[1];alp.aEL(b,"click",alp.bindF("_on_"+c+"_clicked",d))})},{i18n:f,_buttonNode:null,always:function(){return!1!==alp.sub("alpConfig.digitize.toolbar_always")},_on_routed_clicked:function(e){this._publish("routed")},_on_manual_clicked:function(e){this._publish("manual")},_on_bulkedit_clicked:function(e){this._publish("bulkedit")},_on_attr_clicked:function(e){this._publish("attr")},
_on_undo_clicked:function(e){g.topic("/alp/_gmap2_3/digitize/actions/undo").trigger()},_on_redo_clicked:function(e){g.topic("/alp/_gmap2_3/digitize/actions/redo").trigger()},_publish:function(e){g.topic("/alp/_gmap2_3/digitize/views/DigitizeToolbarW/"+e).trigger()},setVisible:function(e){alp.setClass(this.domNode,"agcNavCollapsed",!e)},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},setButtonSelected:function(e,d){var b=this._buttonNode;b=b[e]=b[e]||alp.domWalkSelect(this.domNode,
alp.f('.id == "agcDTB-'+e+'-li"'),!0);if(!b)return console.error("Could not find HTML node for button: '"+e+"'"),!1;alp.setClass(b,"selected",d);return!0},selectButton:function(e){this.setButtonSelected(e,!0)},unselectButton:function(e){this.setButtonSelected(e,!1)}})})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.x.activityspeedselector");
(function(){var k=alp.i18n.unit,h=["change_cb","changed_cb"],g=["change_cb_init","changed_cb_init"];alp.declare("alp._gmap2_3.digitize.x.ActivitySpeedSelector",null,function(f){this.cfg=alp.oCreateMix({container_q:null,datatypename_st:null,number_q:".js-tp-segment-property-speed",slider_q:".js-tp-segment-property-speed-slider",slider_steps:100,slider_2_speed_delay_ms:456,datatype_cfg:alp.cfg.datatype()},f);this.datatypename_st=this.cfg.datatypename_st;this.speed_st=new alp.MinMaxState({min:1,max:15,
init_value:8});this._slider_st=new alp.MinMaxState({min:0,max:this.cfg.slider_steps,init_value:this.cfg.slider_steps>>1})},{init:function(){var f=this;f._slider=f._slider||[];f._eh=f._eh||new alp.Eh;f._eh.clear();alp.forEach(f._slider,alp.f(".destroy()"));f._slider=[];alp.forEach(alp.nodelist(f.cfg.container_q),function(e){alp.forEach(alp.nodelist(f.cfg.number_q,e),function(b){function c(){var a=f.speed_st.min+(f.speed_st.max-f.speed_st.min)*f._slider_st.getProp();b.innerHTML=k.kmhWithLabel(a)}f._eh.push(alp.m(f._slider_st,
h,c));f._eh.push(alp.m(f.speed_st,h,c));c()});var d=f._slider_st;alp.forEach(alp.nodelist(f.cfg.slider_q,e),function(b){alp.empty(b);b=new alp.x.Slider({cont:b,vInit:d.get(),vMin:d.min,vMax:d.max,discreteStep:1,initNow:!0});f._slider.push(b);b=b.m.low;f._eh.push(d.bind_to(b));f._eh.push(b.bind_to(d))})});this._connect_controller()},_connect_controller:function(){function f(){e.speed_st.setProp(e._slider_st.getProp())}var e=this;e._eh.push(alp.m(e.datatypename_st,g,function(){var b=e.cfg.datatype_cfg,
c=e.datatypename_st.get()||b._default;b=b[c]||b[b._default];c=e.speed_st.getProp();e.speed_st.min=b.speed_kmh.min;e.speed_st.max=b.speed_kmh.max;e.speed_st.setProp(c);e.speed_st.constrain()}));var d;e._eh.push(e._slider_st.change_cb(function(){null!=d&&clearTimeout(d);d=setTimeout(alp.nowF(f),e.cfg.slider_2_speed_delay_ms)}));e._eh.push(alp.m(e.speed_st,g,function(){e._slider_st.setProp(e.speed_st.getProp())}))}})})();"undefined"!==typeof dojo&&dojo.provide("alp.view.button_on_off");
(function(){alp.ensureCss(alp.cssBase()+"alp/x.css");var k={},h=["change_cb","changed_cb"],g=["change_cb_init","changed_cb_init"];alp.declare("alp.view.ButtonOnOff",null,function(f){var e=this,d;for(d in e)d in k||d in f&&(e[d]=f[d]);alp.forEach(["container"],function(b){if(!e[b])throw Error("alp.view.ButtonOnOff.constructor(): `cfg."+b+"` required");});e.state=e.state||new alp.BoolState;e._eh=new alp.Eh;e._init()},{container:null,on_img_url:null,off_img_url:null,on_class:"alp-button-on",off_class:"alp-button-off",
on_img_class:"alp-button-on-img",off_img_class:"alp-button-off-img",subcont_class:"alp-button-subcont",on_text:null,off_text:null,text_class:"alp-button-text",on_text_class:"alp-button-on-text",off_text_class:"alp-button-off-text",state:null,init:function(){function f(){return alp.and(d,e)}function e(b){return"function"===typeof b?b():b.get()}var d=[];this.on_text&&"string"!==typeof this.on_text&&d.push(this.on_text);this.off_text&&"string"!==typeof this.off_text&&d.push(this.off_text);0<d.length?
alp.subDfrd(f).then(alp.bindF("_init",this)):this._init()},disconnect:function(){this._eh.clear()},_init:alp.nowF(function(){var f=this;f.disconnect();alp.forEach(alp.nodelist(f.container),function(e){function d(){var b=f.state.get();alp.setClass(e,alp.arr2o([[f.on_class,b],[f.off_class,!b]],0,1));a&&(a.style.display=b?"":"none");l&&(l.style.display=b?"":"none");k&&(k.style.display=b?"none":"");r&&(r.style.display=b?"none":"")}function b(a,b){a instanceof alp.State&&f._eh.push(alp.m(a,g,function(a){b.innerHTML=
a}))}var c=alp.gEBCN(f.subcont_class,e)[0]||alp.cE("div",e,{"class":f.subcont_class});alp.empty(c);var a=f.on_img_url&&alp.cE("img",c,{src:f.on_img_url,"class":f.on_img_class,style:"display: none;"}),k=f.off_img_url&&alp.cE("img",c,{src:f.off_img_url,"class":f.off_img_class,style:"display: none;"}),l=f.on_text&&alp.cE("span",c,{"class":f.text_class+" "+f.on_text_class,style:"display: none;"},{innerHTML:"get"in f.on_text?alp.m(f.on_text,"get"):alp.fVal(f.on_text)}),r=f.off_text&&alp.cE("span",c,{"class":f.text_class+
" "+f.off_text_class,style:"display: none;"},{innerHTML:"get"in f.off_text?alp.m(f.off_text,"get"):alp.fVal(f.off_text)});f._eh.push(alp.aEL(e,"click",alp.nowF(function(a){f.state.toggle();alp.stopEvent(a||window.event)})));f._eh.push(alp.m(f.state,h,d));b(f.on_text,l);b(f.off_text,r);d()})})})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.x.geocoder_plus_options");
(function(){var k=alp._gmap2_3.digitize,h=["change_cb","changed_cb"];alp.declare("alp._gmap2_3.digitize.x.GeocoderPlusOptions",null,function(g){function f(){var d=e.visible_st.get(),b=e.options_open_st.get();alp.style(e._container,{display:d?"":"none"});alp.style(e._target_container,{display:d&&b?"":"none"})}var e=this;alp.mixCheck(e,g);e.visible_st||(e.visible_st=new alp.BoolState({init_value:!0}));e.options_open_st||(e.options_open_st=new alp.BoolState({init_value:!1}));e._container=alp.nodelist(e.options_q);
0<e._container.length?(e._target_container=alp.nodelist(e.options_target_q),0<e._target_container.length&&(alp.forEach(e._container,function(d){d=alp.cE("table",d);d=alp.cE("tbody",d);var b=alp.cE("tr",d);d=alp.cE("td",b);b=alp.cE("td",b);var c=alp.newId();d=alp.cE("div",d,{id:c,"class":e.options_btn_class,style:"float: left;"});b=alp.cE("label",b,{"for":c,"class":e.options_label_class,style:"float: left;"});c=k._i18n.ctn({i18n_key:e.i18n_text_name});b.onselectstart=b.onmousedown=function(){return!1};
b.appendChild(c);alp.aEL(b,"click",alp.nowF(function(){e.options_open_st.toggle()}));(e._btn||(e._btn=[])).push(new alp.view.ButtonOnOff(alp.oCreateMix(e,{container:d,state:e.options_open_st})))}),alp.m(e.visible_st,h,f),alp.m(e.options_open_st,h,f),f())):console.error("alp._gmap2_3.digitize.x.GeocoderPlusOptions could not find container node. Check your options_q value")},{options_q:null,options_target_q:null,visible_st:null,options_open_st:null,options_btn_class:"js-gcp-btn",options_label_class:"js-gcp-options",
options_contents_q:".timeplan",on_img_url:alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/options_open.png",off_img_url:alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/options_close.png",on_img_class:"gcp-options-open-img",off_img_class:"gcp-options-close-img",i18n_text_name:"geocoderOptions",setContentsHTML:function(g){g=g||"";var f=this;alp.forEach(f._target_container,function(e){alp.forEach(alp.nodelist(f.options_contents_q,e),function(d){var b=typeof g;"string"===b?d.innerHTML=g:"object"===
b?alp.empty(d):console.error("alp._gmap2_3.digitize.x.GeocoderPlusOptions.setInnerHTML: `html_or_node` must be a HTML string or a DOM Node, you gave a:"+b)})})}})})();"undefined"!==typeof dojo&&dojo.provide("alp.view.selector_fancy");
(function(){alp.declare("alp.view.SelectorFancy",alp.view.Selector,function(){this.cfg=alp.oCreateMix({title_q:".js-selector-fancy-title"},this.cfg);this.open_st=new alp.BoolState;this.table=new alp.view.Table(null,{nrow_min:0,nrow_max:Infinity,hide_on_mousewheel:!0,hide_on_click:!0})},{init:function(){var k=this,h=k._eh();h.clear();var g=alp.filter(k.table.array_st.get(),alp.f());g&&g.length||alp.subDfrd(function(){var f=alp.filter(alp.map(k.cfg.entries,alp.bindF("entry_title",k)),alp.f());if(f.length)return f}).then(function(f){k.table.array_st.setNow(f)});
alp.forEach(alp.nodelist(k.cfg.node_q),function(f){function e(){var b=k._entries_obj[k.name.get()];b=b&&k.entry_title(b);alp.setText(alp.nodelist(k.cfg.title_q,f),b||"")}function d(){var b=k.name.get();b&&k.table.selected_index_st.set(k.entry_name_2_ind(b))}h.push(alp.m(k.name,["change_cb","changed_cb"],e));e();h.push(alp.aEL(f,"click",alp.nowF(function(){k.table.ref_st.set(f);k.open_st.toggle()})));h.push(k.open_st.bind_to(k.table.vis_st));h.push(k.table.vis_st.bind_to(k.open_st));h.push(k.table.clickEvt().then(function(b,
c){(b=alp.oGet(k.cfg.entries,[c,"name"]))&&k.name.set(b)}));h.push(alp.m(k.name,["change_cb","changed_cb"],d));h.push(alp.m(k.open_st,["change_v_cb","changed_v_cb"],!1,d));d();k._connect_disable(f);k._show(f)})}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.x.networkselector");
(function(){function k(e,d){var b=this;d=d||new alp.State;b.cfg=alp.oCreateMix({network_init_value:null,button_routed:".js-tp-segment-network-routed-button",button_manual:".js-tp-segment-network-manual-button",button_routed_on:g.routed_on,button_routed_off:g.routed_off,button_manual_on:g.manual_on,button_manual_off:g.manual_off,button_on_img_class:"tp-button-on-img",button_off_img_class:"tp-button-off-img",networkselect_fancy:!0,routing_engine_q:null,engineselect_fancy:!0,engine_init_value:null},
e);b.routing_network=e.modelOptions.routing_network;b.viewClass=b.cfg.networkselect_fancy?alp.view.SelectorFancy:alp.view.Selector;b.view=new b.viewClass({node_q:b.cfg.routing_network_q,title_q:b.cfg.routing_network_title_q,entries:b.routing_network,init_value:b.cfg.network_init_value});b.name=b.view.name;b.model_state=d;b.routing_engine=e.modelOptions.routing_engine;b.routing_engine&&b.cfg.routing_engine_q&&(b.engineViewClass=b.cfg.engineselect_fancy?alp.view.SelectorFancy:alp.view.Selector,b.engineView=
new b.engineViewClass({node_q:b.cfg.routing_engine_q,title_q:b.cfg.routing_engine_title_q,entries:b.routing_engine,init_value:b.cfg.engine_init_value||b.routing_engine._defaultName}),b.engine_name=b.engineView.name);b.rmode_routed_st=new alp.BoolState({init_value:!0});b.rmode_manual_st=new alp.BoolState({init_value:!1});b.rmode_pst=new alp.PoliteSetState({init_value:[b.rmode_routed_st,b.rmode_manual_st]});b.rmode_view={};(e=b.cfg.button_container)&&alp.mix(b.rmode_view,{routed:new alp.view.ButtonOnOff({container:alp.nodelist(b.cfg.button_routed,
e),state:b.rmode_routed_st,on_img_url:b.cfg.button_routed_on.url,off_img_url:b.cfg.button_routed_off.url,on_img_class:b.cfg.button_on_img_class,off_img_class:b.cfg.button_off_img_class}),manual:new alp.view.ButtonOnOff({container:alp.nodelist(b.cfg.button_manual,e),on_img_url:b.cfg.button_manual_on.url,off_img_url:b.cfg.button_manual_off.url,state:b.rmode_manual_st,on_img_class:b.cfg.button_on_img_class,off_img_class:b.cfg.button_off_img_class})});b.rmode_manual_st.bind_to(b.view.disabled_st,{loose:!0});
alp.m(d,f,alp.bindF("_update_model",b));alp.m(b.name,f,alp.bindF("_update_model",b));alp.forEach(b.rmode_pst.get(),function(c){alp.m(c,f,alp.bindF("_rmode_view_update",b))});b.active=new alp.BoolState}var h=function(){return alp.declare("alp._gmap2_3.digitize.x.NetworkSelector",null,k,{init:function(){alp.m(this.view,"init");alp.m(this.engineView,"init");this._rmode_view_init()},_update_model:function(){var e=this.model_state.get(),d=this.name.get();alp.m(e,"setRoutingNetwork",d);this._updated({name:d})},
updatedEvt:alp.memM("updatedEvt",'alp.event("AGDX:networkselector:updatedEvt",{then:1})'),_rmode_view_init:function(){alp.forIn(this.rmode_view,alp.f(".init()"))},_rmode_view_update:function(){},_updated:function(e){this.updatedEvt().triggerSoon(e)}})}(),g=alp.cfg.button(),f=["change_cb","changed_cb"];h.RMODE_ROUTED="routed";h.RMODE_MANUAL="manual"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.radio_group");
(function(){alp.sub("alp.x",null,!0);alp.declare("alp.x.RadioGroup",alp.x.AbstractController,null,{modeState:null,contNode:null,inputArr:null,augmentModel:function(k){this._inputArr=this.inputArr||alp.filter(alp.gEBTN("input",this.contNode),'alp.gA( v, "type" ) === "radio"');k.modeState=this.modeState||alp.modeStateFromArr(alp.map(this._inputArr,'alp.gA( v, "value" )'),{init_value:alp.f('v  &&  alp.gA( v, "value" )')(alp.filter(this._inputArr,'.checked  ||  /^checked$/i.test( alp.gA( v, "checked" ))')[0])})},
augmentKids:function(k){var h=this;h.contNode.childNodes.a;var g=h.m.modeState.get();alp.styleform.init({now:!0,cont:{input:h._inputArr},labelCont:h.contNode,oncheck_init:function(f,e,d){f=d.originalNode;if((e=f.value)&&e in h.m.modeState.modeSet)if(e in k)console.error("RadioGroup: already known value "+e+" - you might have duplicates in the DOM");else return d=new alp.BoolState({init_value:e===g}),f.checked=d.get(),k[e]={m:{is:d}},d;else console.error("RadioGroup: unknown value "+e)}})},connectModel2View:function(k,
h,g,f){h.push(g.modeState.change_cb_init(function(){var e=g.modeState.get();(e=f[e])&&e.m.is.set(!0)}))},connectView2Model:function(k,h,g,f){alp.forIn(f,function(e,d){h.push(e.m.is.change_cb(function(){e.m.is.get()&&g.modeState.set(d)}))})}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.x.networkselector2");
(function(){function k(h){for(var g=[],f=h.length;f--;){var e=h[f];g.push(e);var d=[].concat(h);d.splice(f,1);g.push.apply(g,alp.map(k(d),'"'+e+',"+v'))}return g}alp.declare("alp._gmap2_3.digitize.x.NetworkSelector2",alp.x.AbstractController,null,{contNode:null,routingOn:"alp-tpwiz-segment-property-routing-on",routingOff:"alp-tpwiz-segment-property-routing-off",buttonSel:"alp-tpwiz-sel",hideShow:"alp-tpwiz-segment-property-routing-engine-cont",routing_engine:null,engine_init_value:null,augmentModel:function(h){h.rmode_routed_st=
new alp.BoolState({init_value:!0});h.rmode_manual_st=new alp.BoolState({init_value:!1});h.rmode_pst=new alp.PoliteSetState({init_value:[h.rmode_routed_st,h.rmode_manual_st]});if(this.routing_engine){var g=alp.map(this.routing_engine,".name");g=k(g);h.engine_name=new alp.ModeState({modeSet:alp.arr2oSimple(g),init_value:this.engine_init_value||g[0]})}},augmentKids:function(h){this.contNode.childNodes.a;(this._routingOn=alp.nodify(this.routingOn,this.contNode)).childNodes.a;(this._routingOff=alp.nodify(this.routingOff,
this.contNode)).childNodes.a;this._hideShow=alp.nodify(this.hideShow,this.contNode);this.m.engine_name&&(h.engineRadioGroup=new alp.x.RadioGroup({contNode:this.contNode,modeState:this.m.engine_name}))},connectModel2View:function(h,g,f,e){g.push(f.rmode_routed_st.change_cb_init(function(){var d=h.m.rmode_routed_st.get();alp.setClass(h._routingOn,h.buttonSel,d);alp.setClass(h._routingOff,h.buttonSel,!d);h._hideShow&&(h._hideShow.style.visibility="hidden")}))},connectView2Model:function(h,g,f,e){g.push(alp.aEL(h._routingOn,
"click",function(){f.rmode_routed_st.setNow(!0)}));g.push(alp.aEL(h._routingOff,"click",function(){f.rmode_manual_st.setNow(!0)}))}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.x.publitransselector");
(function(){var k=alp._gmap2_3.digitize,h=k.PUBLIC_TRANS_NONE(),g=k.PUBLIC_TRANS_SIMPLE(),f=["change_cb","changed_cb"];alp.declare("alp._gmap2_3.digitize.x.PubliTransSelector",null,function(e,d,b){function c(){a._view.state.set(a.public_trans_st.get()!==h)}var a=this;alp.mixCheck(a,e);a.public_trans_st||(a.public_trans_st=new alp.State);a._container=alp.nodelist(a.public_trans_q);0<a._container.length?(a._view=new alp.view.ButtonOnOff({container:a._container,on_img_url:a.button_on_img,off_img_url:a.button_off_img,
on_img_class:a.button_on_img_class,off_img_class:a.button_off_img_class}),alp.m(a._view.state,f,function(){a.public_trans_st.set(a._view.state.get()?g:h)}),alp.m(a.public_trans_st,f,c),c()):console.error("alp._gmap2_3.digitize.x.PubliTransSelector could not find container node. Check your public_trans_q value")},{public_trans_q:null,public_trans_st:null,button_on_img:alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/public_transport_on.png",button_off_img:alp.cssBase()+"alp/_gmap2_3/digitize/resources/images/public_transport_off.png",
button_on_img_class:"tp-button-on-img",button_off_img_class:"tp-button-off-img",set:function(){this.public_trans_st.set(g)},unset:function(){this.public_trans_st.set(h)}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.x.segmentpropertyselector");
(function(){var k=alp._gmap2_3.digitize,h=k.KSF_DEFAULT(),g=k.KSF_NETWORK(),f=k.KSF_FAST(),e=k.KSF_FLAT(),d=k.KSF_SHORT(),b=k.KSF_ARR(),c=alp.cfg.button(),a={},m=["change_cb","changed_cb"],l=["change_cb_init","changed_cb_init"],r=["change_v_cb","changed_v_cb"];alp.i18n.fetch("alp.all").then(function(b){a=b});alp.declare("alp._gmap2_3.digitize.x.SegmentPropertySelector",null,function(a){var k=this;k.cfg=alp.oCreateMix({propertyselect_q:null,button_node_selectF:function(a){return function(b){return alp.hasClass(b,
"js-tp-segment-property-button")&&alp.hasClass(b,"segment-"+a)}},button_segment_network_off:c.segment_network_off,button_segment_network_on:c.segment_network_on,button_segment_fast_off:c.segment_fast_off,button_segment_fast_on:c.segment_fast_on,button_segment_flat_off:c.segment_flat_off,button_segment_flat_on:c.segment_flat_on,button_segment_short_off:c.segment_short_off,button_segment_short_on:c.segment_short_on,button_off_img_class:"tp-button-off-img",button_on_img_class:"tp-button-on-img",datatypename_st:null,
datatype_cfg:alp.cfg.datatype()},a);k.ksf_network_st=k.cfg.ksf_network_st||new alp.BoolState;k.ksf_fast_st=k.cfg.ksf_fast_st||new alp.BoolState;k.ksf_flat_st=k.cfg.ksf_flat_st||new alp.BoolState;k.ksf_short_st=k.cfg.ksf_short_st||new alp.BoolState;k.ksf_st=new alp.ModeState({modeSet:alp.arr2o(b,alp.f(),alp.f("1")),init_value:h});k._st_c_obj={network:{state:k.ksf_network_st,constant:g},fast:{state:k.ksf_fast_st,constant:f},flat:{state:k.ksf_flat_st,constant:e},"short":{state:k.ksf_short_st,constant:d}};
k.ksf_pst=new alp.PoliteSetState({init_value:[k.ksf_network_st,k.ksf_fast_st,k.ksf_flat_st,k.ksf_short_st],at_least_st:k.ksf_network_st});alp.forIn(k._st_c_obj,function(a,b){function c(){a.state.set(a.constant===k.ksf_st.get())}alp.m(a.state,r,!0,function(){k.ksf_st.set(a.constant)});alp.m(k.ksf_st,m,c);c()});k._view={}},{init:function(){var a=this;alp.forIn(a._view,alp.f(".disconnect()"));a._view={};alp.forIn(a._st_c_obj,function(b,c){var d=a.cfg.button_node_selectF(c);d=alp.domWalkSelect(alp.nodify(a.cfg.propertyselect_q),
d);d.length&&(a._view[c]=new alp.view.ButtonOnOff({container:d,state:b.state,off_img_url:a.cfg["button_segment_"+c+"_off"].url,on_img_url:a.cfg["button_segment_"+c+"_on"].url,off_img_class:a.cfg.button_off_img_class,on_img_class:a.cfg.button_on_img_class,off_text:a._button_off_text(c),on_text:a._button_on_text(c)}),a._view[c].init())})},_button_off_text:function(a){return this._button_on_text(a)},_button_on_text:function(b){var c=this.cfg["button_segment_"+b+"_on"].text,d=this.cfg.datatypename_st,
e=this.cfg.datatype_cfg;if("network"!==b||!d||!e)return c;var f=new alp.StringState;alp.m(d,l,function(b){b=(b=(b=alp.opt(b&&e[b],"default_network"))&&a["prefer_network_"+b])||alp.fVal(c);f.set(b)});return f}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.x.segmentpropertyselector2");
(function(){var k=alp._gmap2_3.digitize,h=k.KSF_DEFAULT();k.KSF_NETWORK();k.KSF_FAST();k.KSF_FLAT();k.KSF_SHORT();var g=k.KSF_ARR();alp.declare("alp._gmap2_3.digitize.x.SegmentPropertySelector2",alp.x.AbstractController,null,{propertyselect:null,augmentModel:function(f){f.ksf_st=new alp.ModeState({modeSet:alp.arr2oSimple(g),init_value:h})},augmentKids:function(f){this.propertyselect.childNodes.a;f.radioGroup=new alp.x.RadioGroup({modeState:this.m.ksf_st,contNode:this.propertyselect})}})})();
"undefined"!==typeof dojo&&dojo.provide("alp.x.checkbox");
alp.sub("alp.x.checkbox",0,1).link=function(k,h,g,f){function e(){alp.setProp(k,"checked",h.get())}if(!k)throw Error("alp.x.checkbox needs a `node`");"parentNode"in k||k.length.toPrecision.call.a;g||(g=new alp.Eh);alp.m(g,["push","eh_push"],alp.aEL(k,"click",function(d){d||(d=window.event);d=d.target||d.srcElement;alp.m(h,["setNow","set"],"parentNode"in k?k.checked:d.checked)}));h.change_cb&&h.drop_cb?alp.m(g,["push","eh_push"],h.change_cb(e),alp.bindF("drop_cb",h)):alp.m(g,["push","eh_push"],h.changed_cb(e));
e();(function(){var d=f&&f.label_q;d&&alp.forEach(alp.nodelist(d),function(b){alp.m(g,["push","eh_push"],alp.aEL(b,"click",alp.nowF(function(){h.toggle()})));alp.setProp(b,"onselectstart",alp.f("false"));alp.setProp(b,"onmousedown",alp.f("false"))})})();return g};"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.x.geocoder_plus");
alp.gmap3(function(k){var h=alp._gmap2_3.digitize,g=h.NEXTLEG();h.DATATYPE_NAME();h.PUBLIC_TRANSPORT();var f=h.ROUTING_ENGINE(),e={},d=["change_cb","changed_cb"],b=["change_cb_init","changed_cb_init"],c=["change_v_cb","changed_v_cb"],a=alp.declare("alp._gmap2_3.digitize.x.GeocoderPlus",alp._gmap2_3.x.Geocoder,function(a,b,c){if(alp.or(alp.oValues(this.cfg.extension))){var d=this;for(k in d)k in e||k in a&&(d[k]=a[k]);d.public_trans_st=new alp.State({init_value:alp.m(alp.m(d,"get_default_public_transport_main"),
"get")||alp._gmap2_3.digitize.PUBLIC_TRANS_NONE(),constrain_all:function(a){var b=alp._gmap2_3.digitize.PUBLIC_TRANS();return b[Math.max(0,alp.indexOf(b,a))]}});d.options_open_st=new alp.BoolState({init_value:!1});d.details_vis_st=new alp.BoolState({init_value:!1});d.details_open_st=new alp.BoolState({init_value:!1});d.details_content_st=d.details_content_st||new alp.StringState;d.differs_from_default_st=new alp.BoolState({init_value:!1});b=d.modelOptions.datatype_entries;if(d.cfg.extension.segment_datatype){var k=
(c=(c=(k=d.node&&alp.nodelist(d.datatypecont_q,d.node)[0])&&alp.nodelist(d.datatypeselect_q,k))&&c[0])&&alp.nodelist(d.datatypeicon_q,k);var l=!1;c||(k=(k=(c=alp.nodify(d.datatypeselect_fromdom,d.node))&&alp.nodify(d.datatypeicon_fromdom,d.node))?[k]:[],l=!0);c&&(d._datatypeselector=new alp.view.SelectorWithImg({node_q:[c],img_q:k,from_dom:l,entries:b,init_value:a.datatypename_init||alp.m(alp.m(d,"get_default_datatype_main"),"get"),sort_by_title:a.datatypename_sort_by_title}),d.datatypename_st=d._datatypeselector.name)}d.datatypename_st=
d.datatypename_st||new alp.State;d.cfg.extension.segment_datatype&&(b=d.node&&d.dupli_datatype_sel(d.node))&&b.length&&(d._dupli_datatype_img=new alp.view.Img({img_q:b,entries:d.modelOptions.datatype_entries,name_st:d.datatypename_st,visible_st:new alp.BoolState({init_value:!1})}));if(d.cfg.extension.segment_datatype_property){b=d.node&&alp.nodelist(d.propertyselect_q,d.node)[0];var m=d.node&&alp.nodify(d.propertyselect2,d.node);b?(d._propertyselector=new h.x.SegmentPropertySelector({modelOptions:a.modelOptions,
propertyselect_q:b,datatypename_st:d.datatypename_st}),d.ksf_st=d._propertyselector.ksf_st):m&&(d._propertyselector=new h.x.SegmentPropertySelector2({propertyselect:m}),d.ksf_st=d._propertyselector.m.ksf_st)}d.ksf_st=d.ksf_st||new alp.State;d.cfg.extension.segment_datatype_property?(b=d.node&&alp.nodelist(d.speedselect_q,d.node)[0],m=d.node&&!b&&alp.nodify(d.speedselect2,d.node)):b=alp.nodelist(alp.cE("div"));if(b||m)b={modelOptions:a.modelOptions,container_q:b||m,datatypename_st:d.datatypename_st,
datatype_cfg:d.modelOptions.datatype_cfg},m&&(b.number_q=".alp-tpwiz-segment-property-speed",b.slider_q=".alp-tpwiz-segment-property-speed-slider"),d._speedselector=new h.x.ActivitySpeedSelector(b),d.speed_st=d._speedselector.speed_st;d.speed_st=d.speed_st||new alp.State;d.cfg.extension.segment_network&&(m=d.node&&alp.nodelist(d.networkselect_q,d.node)[0],d.node&&alp.nodelist(d.networkselect_q+"-title",d.node),b=d.node&&alp.nodelist(d.networkbuttoncontainer_q,d.node)[0],c=d.node&&alp.nodelist(d.engineselect_q,
d.node)[0],k=d.node&&alp.nodelist(d.engineselect_q+"-title",d.node)[0],l=d.node&&!m&&alp.nodify(d.networkselect2,d.node),m||c?(d._networkselector=new alp._gmap2_3.digitize.x.NetworkSelector({modelOptions:a.modelOptions,button_container:b,networkselect_fancy:d.networkselect_fancy,routing_engine_q:alp.nodelist(c),routing_engine_title_q:alp.nodelist(k),engineselect_fancy:d.engineselect_fancy,engine_init_value:alp.m(alp.m(a,"get_default_routingengine_main"),"get")}),d.routingenginename_st=d._networkselector.engine_name,
d.rmode_manual_st=d._networkselector.rmode_manual_st,d.rmode_routed_st=d._networkselector.rmode_routed_st):l&&(d._networkselector=new alp._gmap2_3.digitize.x.NetworkSelector2({routing_engine:a.modelOptions&&a.modelOptions.routing_engine,contNode:l,engine_init_value:alp.m(alp.m(a,"get_default_routingengine_main"),"get")}),d.rmode_manual_st=d._networkselector.m.rmode_manual_st,d.rmode_routed_st=d._networkselector.m.rmode_routed_st,d.routingenginename_st=d._networkselector.m.engine_name));d.routingenginename_st=
d.routingenginename_st||new alp.State;alp.now("set_property",d.info,[g,f],d.routingenginename_st.get());d.cfg.extension.public_transport&&((a=d.node&&alp.nodelist(d.public_trans_q,d.node))&&1===a.length&&(d._publitransselector=new alp._gmap2_3.digitize.x.PubliTransSelector({public_trans_q:a,public_trans_st:d.public_trans_st})),(a=d.node&&alp.nodify("info-tp-pubtrans-dialoglink",d.node))&&alp.aEL(a,"click",alp.nowF(function(a){alp.stopEvent(a||window.event);d.openInfoPubtransDialogEvt().triggerSoon(this);
return!1})));d.pt_with_bike_st=new alp.BoolState;d.pt_rail_only_st=new alp.BoolState;d.cfg.extension.segment_pt_options&&(a=alp.nodelist(d.pt_options_with_bike_cb_q,d.node)[0],m=alp.nodelist(d.pt_options_with_bike_label_q,d.node),b=alp.nodelist(d.pt_options_rail_only_cb_q,d.node)[0],c=alp.nodelist(d.pt_options_rail_only_label_q,d.node),a&&alp.x.checkbox.link(a,d.pt_with_bike_st,null,{label_q:m}),b&&alp.x.checkbox.link(b,d.pt_rail_only_st,null,{label_q:c}));d.cfg.extension.options&&(a=d.node&&alp.nodelist(d.options_q,
d.node),0<a.length&&(d._options=new alp._gmap2_3.digitize.x.GeocoderPlusOptions({options_q:a,options_target_q:alp.nodelist(d.options_target_q,d.node),options_open_st:d.options_open_st})));d.cfg.extension.details&&(a=d.node&&alp.nodelist(d.details_q,d.node),0<a.length&&(d._details=new alp._gmap2_3.digitize.x.GeocoderPlusOptions({options_q:a,options_target_q:alp.nodelist(d.details_target_q,d.node),options_open_st:d.details_open_st,i18n_text_name:d.details_i18n_text_name,visible_st:d.details_vis_st,
options_contents_q:".timeplan"})))}},{modelOptions:null,datatypename_init:null,datatypename_sort_by_title:!1,datatypecont_q:".js-tp-node-digitize-datatype",datatypeselect_q:".js-digitize-datatype-select",datatypeicon_q:".js-digitize-datatype-icon",datatypeselect_fromdom:h.SEGMENT_ACTIVITY_SELECT(),datatypeicon_fromdom:"alp-tpwiz-activity-icon",propertyselect_q:".js-tp-segment-property-cont",propertyselect2:"alp-tpwiz-segment-prefRoute-cont",speedselect_q:".js-tp-segment-activity-cont",speedselect2:"alp-tpwiz-segment-property-speed-cont",
networkselect_q:".js-tp-node-digitize-network-select",networkselect_fancy:!0,engineselect_q:".js-tp-node-digitize-engine-select",engineselect_fancy:!0,networkbuttoncontainer_q:".js-tp-segment-network-mode-table",networkselect2:"alp-tpwiz-segment-property-routing",public_trans_q:".js-tp-node-public-transport",options_q:".js-tp-node-options",options_target_q:".wp-options",details_q:".js-tp-node-legdetails",details_target_q:".wp-legdetails",details_i18n_text_name:"geocoderLegDetails",details_content_st:null,
dupli_datatype_sel:function(a){return(a=alp.nodify("wp-dupli-datatype",a))&&alp.gEBTN("img",a)},pt_options_q:".js-tp-node-digitize-ptoptions",pt_options_with_bike_cb_q:".js-tp-segment-ptoptions-with-bike-cb",pt_options_with_bike_label_q:".js-tp-segment-ptoptions-with-bike-label",pt_options_rail_only_cb_q:".js-tp-segment-ptoptions-rail-only-cb",pt_options_rail_only_label_q:".js-tp-segment-ptoptions-rail-only-label",get_default_public_transport_main:null,get_default_datatype_main:null,get_default_ksf_main:null,
get_default_routingengine_main:null,get_default_speedprop_main:null,segopt_toggle_icon:"alp-tpwiz-options-toggle-icon",segopt_toggle_icon_selected:"alp-tpwiz-options-selected",cfg_default:function(){return alp.oCreateMix(alp._gmap2_3.x.Geocoder.prototype.cfg_default,{new_geocoder_mouseover_part:"wp",new_geocoder_nextleg_mouseover_part:"wp-nextleg"})},datatypename_st:null,routingenginename_st:null,public_trans_st:null,options_open_st:null,pt_with_bike_st:null,pt_rail_only_st:null,details_vis_st:null,
details_open_st:null,differs_from_default_st:null,_networkselector:null,initImpl:function(){this._eh().clear();alp.m(this._datatypeselector,"init");alp.m(this._propertyselector,"init");alp.m(this._speedselector,"init");alp.m(this._networkselector,"init");alp.m(this._publitransselector,"init");alp.m(this._dupli_datatype_img,"init");a.parent.prototype.initImpl.apply(this);this._init_nextleg_mouseover()},_connect_controller:function(){function e(){p._publitransselector.set()}function f(){v.visible_st.set(!v.name_st.is(u.get()))}
function g(a){p.details_vis_st.set(!!a);p._details.setContentsHTML(a)}function h(){var a=t.get(),b=p.datatypename_st.get();a&&b&&a!==b?p.differs_from_default_st.set(!0):(a=w.get(),b=p.ksf_st.get(),a&&b&&a!==b?p.differs_from_default_st.set(!0):(a=x.getProp(),b=p.speed_st.getProp(),null!==a&&null!==b&&1E-5<Math.abs(a-b)?p.differs_from_default_st.set(!0):(a=y.get(),b=p.routingenginename_st.get(),a&&b&&a!==b?p.differs_from_default_st.set(!0):p.differs_from_default_st.set(!1))))}function k(){alp.setClass(p._iconnodeArr,
p.segopt_toggle_icon_selected,p.differs_from_default_st.get())}var p=this;a.parent.prototype._connect_controller.apply(p);p._eh().push(alp.m(p.pt_with_bike_st,c,!0,e));p._eh().push(alp.m(p.pt_rail_only_st,c,!0,e));var v=p._dupli_datatype_img;if(p.cfg.extension.segment_datatype&&v){var u=alp.m(p.cfg,"get_default_datatype_main");u&&(alp.m(u,d,f),alp.m(v.name_st,b,f))}p.cfg.extension.details&&p._details&&alp.m(p.details_content_st,b,g);p._iconnodeArr=alp.gEBCN(p.segopt_toggle_icon,p.node);if(p._iconnodeArr.length){var t=
p.get_default_datatype_main(),w=p.get_default_ksf_main(),x=p.get_default_speedprop_main(),y=p.get_default_routingengine_main();p._eh().push(t.change_cb_init(h));p._eh().push(p.datatypename_st.change_cb_init(h));p._eh().push(w.change_cb_init(h));p._eh().push(p.ksf_st.change_cb_init(h));p._eh().push(x.change_cb_init(h));p._eh().push(p.speed_st.change_cb_init(h));p._eh().push(y.change_cb_init(h));p._eh().push(p.routingenginename_st.change_cb_init(h));p._eh().push(p.differs_from_default_st.change_cb_init(k))}},
nextlegMouseoverEvt:alp.memM("nextlegMouseoverEvt",'alp.event("GP:nextlegMouseoverEvt",{then:1})'),nextlegMouseoutEvt:alp.memM("nextlegMouseoutEvt",'alp.event("GP:nextlegMouseoutEvt",{then:1})'),openInfoPubtransDialogEvt:alp.memM("openInfoPubtransDialogEvt",'alp.event("GP:openInfoPubtransDialogEvt",{then:1})'),_eh:alp.memM("_eh","new alp.Eh()"),_init_nextleg_mouseover:function(){var a=this,b=a.cfg,c=a._eh();(b=b.new_geocoder_nextleg_mouseover_part)&&alp.forEach(alp.gEBCN(b,a.node),function(b){c.push(alp.aEL(b,
"mouseover",alp.nowF(function(){a.nextlegMouseoverEvt().triggerSoon()})));c.push(alp.aEL(b,"mouseout",alp.nowF(function(){a.nextlegMouseoutEvt().triggerSoon()})))})}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.views.PublicTransportViewLegDetails");
(function(){var k=alp._gmap2_3.digitize;k.PublicTransportViewLegDetails=function(h,g){h=alp.filter(alp.map(h,function(f){return k.PublicTransportViewIW(f,g)}),"");return h.length&&"<div>"+h.join('<div class="clear"></div><hr><div class="clear"></div><hr><div class="clear"></div>')+"</div>"}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.multigeocoder");
(function(){var k='<img alt="Start" title="Start" src=\''+alp.cssBase()+'alp/images/mg_s_routed.png\' class="tp-mgeo-icon-routed"/><img alt="Start" title="Start" src=\''+alp.cssBase()+'alp/images/mg_s_manual.png\' class="tp-mgeo-icon-manual"/><img alt="Start" title="Start" src=\''+alp.cssBase()+'alp/images/mg_s_highlight.png\' class="tp-mgeo-icon-highlight"/>',h='<img alt="Ziel" title="Ziel" src=\''+alp.cssBase()+'alp/images/mg_z_routed.png\' class="tp-mgeo-icon-routed"/><img alt="Ziel" title="Ziel" src=\''+
alp.cssBase()+'alp/images/mg_z_manual.png\' class="tp-mgeo-icon-manual"/><img alt="Ziel" title="Ziel" src=\''+alp.cssBase()+'alp/images/mg_z_highlight.png\' class="tp-mgeo-icon-highlight"/>',g='<img alt="via" title="via" src=\''+alp.cssBase()+'alp/images/mg_wp_routed.png\' class="tp-mgeo-icon-routed"/><img alt="via" title="via" src=\''+alp.cssBase()+'alp/images/mg_wp_manual.png\' class="tp-mgeo-icon-manual"/><img alt="via" title="via" src=\''+alp.cssBase()+'alp/images/mg_wp_highlight.png\' class="tp-mgeo-icon-highlight"/>';
alp.declare("alp._gmap2_3.x.MultiGeocoder",null,function(e,d){var b=this;b.cfg=alp.oCreateMix(this.cfg_default,e);(e=b.cfg.geocoder_ctor)&&"string"===typeof e&&(b.cfg.geocoder_ctor=alp.sub(e));b.map=d;b.active_st=new alp.BoolState({init_value:!0});this.n=new alp.MinMaxState({min:this.cfg.multigeocoder_nmin,max:this.cfg.multigeocoder_nmax,init_value:this.cfg.multigeocoder_nmin,constrain_all:function(c,a){c=alp.MinMaxState.constrain_min_max_impl.apply(this,arguments);if(3>c&&c>a&&!(a>this.min))for(var d=
0;d<a;d++)if(!b.has_xy(d))return a;return c}});this.geo_info=new alp.ObjectState({init_value:[]});b.highlight_g_ind_st=new alp.State;b.cfg.multigeocoder_mouseover&&(b.over_g_ind_st=new alp.State);this._geo=alp.mapany()},{n:null,geo_info:null,cfg:null,cfg_default:alp.oCreateMix({geocoder_ctor:alp._gmap2_3.x.Geocoder,passive_dnd_move:!1,multigeocoder_nmin:2,multigeocoder_nmax:520,multigeocoder_css_first:"js-tp-mgeo-first",multigeocoder_css_last:"js-tp-mgeo-last",multigeocoder_css_not_first:"js-tp-mgeo-not-first",
multigeocoder_css_not_last:"js-tp-mgeo-not-last",multigeocoder_css_b_new:"js-tp-mgeo-b-new",multigeocoder_css_new:"js-tp-mgeo-new",multigeocoder_css_highlight:"js-mgeo-highlight",multigeocoder_dnd:"js-tp-node-draggable",multigeocoder_delete:".js-tp-node-close",multigeocoder_dnd_xy_constrain:alp.x.dnd.XY_CONSTRAIN_V,multigeocoder_css_dragging:"js-mgeo-dragging",multigeocoder_css_not_dragging:"js-mgeo-not-dragging",multigeocoder_mouseover:!0,multigeocoder_scroll_cont:null,multigeocoder_n_class:"alp-tp-mgeo-n-",
create_geocoders_max_duration_ms:250},function(){var e={};return{multigeocoder_start:function(d){return this._tp_mg_letter_number(d,k)},multigeocoder_end:function(d){return this._tp_mg_letter_number(d,h)},multigeocoder_via:function(d){return this._tp_mg_letter_number(d,g)},multigeocoder_add:function(d){return this._tp_mg_letter_number(d,g)},_cfg_emo:function(){return this.itemControllerOptions.editMarkerOptions},_tp_mg_letter_number:function(d,b){var c=d+":"+b;if(c in e)return e[c];var a=this._cfg_emo(),
f=alp.opt(a,"nodeIcon");a=this._tp_mg_is_letter();var g=this._tp_mg_is_number();if(a||g)b=alp.cE("div",null,null,{innerHTML:b}),alp.forEach(alp.gEBTN("img",b),function(a){var b=f.routedColor;/manual/.test(a.className)?b=f.manualColor:/highlight/.test(a.className)&&(b=f.highlightColor);a.src=alp.cfg.ooi_a_1_icon(d,g,b,"round").url}),b=b.innerHTML;return e[c]=b},_tp_mg_is_letter:function(){return"A"===alp.oGet(this._cfg_emo(),"nodeIcon.type")},_tp_mg_is_number:function(){return"1"===alp.oGet(this._cfg_emo(),
"nodeIcon.type")}}}()),map:null,node:null,active_st:null,highlight_g_ind_st:null,over_g_ind_st:null,create_geocoder_opt:null,get_n_defined:function(){for(var e=this.geo_info._get_no_clone(),d=e.length;d--;)if(e[d])return d;return 0},get_i_last_defined_xy:function(){for(var e=this.geo_info._get_no_clone(),d=e.length;d--;){var b=e[d];if(b&&b.geo_xy&&alp.isFiniteNumber(b.geo_xy.x)&&alp.isFiniteNumber(b.geo_xy.y))return d}return null},init:function(){var e=this;e.node&&alp.empty(e.node);var d=alp.nodelist(e.cfg.multigeocoder_container)[0];
d?(e.node=d,e._drop_geocoder(0),e._init_geo(),e.geo_info.change_cb_init(function(){var b=e.cfg.multigeocoder_n_class;alp.setClass(e.node,[[b+"*",!1],[b+alp.filter(e.geo_info._get_no_clone(),"v && v.geo_xy").length,!0]])}),e._connect_controller()):console.error("alp._gmap2_3.x.MultiGeocoder.init() failed to find the container")},_connect_controller:function(){var e=this;e.highlight_g_ind_st.change_cb("_update_highlight",e);e.n.change_cb(alp.ratelimitF(23,function(){null!=e.n.getPrevious()&&e._init_geo()}));
var d=alp.ratelimitF(357,function(){null!=e.geo_info.getPrevious()?e._init_geocoders():setTimeout(d,357)});e.geo_info.change_cb(d);e.cfg.multigeocoder_mouseover&&e.over_g_ind_st.bind_to(e.highlight_g_ind_st)},has_xy:function(e){return(e=this.geo_info.get_property([e,"geo_xy"]))&&"number"===typeof e.x&&"number"===typeof e.y},changeEvt:alp.memM("changeEvt",'alp.event("AGX:MG:changeEvt",{then:1})'),deleteEvt:alp.memM("deleteEvt",'alp.event("AGX:MG:deleteEvt",{then:1})'),draggingEvt:alp.memM("draggingEvt",
'alp.event("AGX:MG:draggingEvt",{then:1})'),moveEvt:alp.memM("moveEvt",'alp.event("AGX:MG:moveEvt",{then:1})'),_geo:null,_init_geo:function(){var e=this.geo_info.get(),d=this.n.get();e.length=d;this.geo_info.set(e);this._init_geocoders()},_init_geocoders:alp.nowF(function(){function e(){var a=d._dnd_group.is_dragging_st().get();alp.setClass(d.node,alp.arr2o([[d.cfg.multigeocoder_css_dragging,a],[d.cfg.multigeocoder_css_not_dragging,!a]],0,1))}if(this.node){for(var d=this,b=d.n.get(),c=Date.now?Date.now():
+new Date,a=d.cfg.create_geocoders_max_duration_ms,g=d._geo.length;g<b;g++){var h=d._create_geocoder(g).g;1>g&&setTimeout(function(){h&&h.focus()},234);var k=(Date.now?Date.now():+new Date)-c;if(k>a){g<b-1&&(clearTimeout(this[f]),this[f]=setTimeout(function(){d._init_geocoders()},3*k));break}}d._drop_geocoder(b);var n=d.geo_info.get();d._geo.forEach(function(a,c,e){d._init_one_geocoder(n,a,c,e,b)});d.cfg.multigeocoder_dnd&&(d._dnd_group&&d._dnd_group.clear(),d._dnd_group||(d._dnd_group=alp.x.dnd.group(null,
!1,{container_class:"alp-tpwiz-block"}),d._dnd_group.draggingDummyEvt().then(function(a,b){d.draggingEvt().triggerSoon(a,b)}),d._dnd_group.movedEvt().then(alp.bindF("_dnd_moved",d)),d._dnd_group.is_dragging_st().change_cb(e),e()),b=d._geo.length,d._geo.forEach(function(a,c,e){if(a=a&&a.dnd)2<b&&e<b-1?(d._dnd_group.push(a),a.active.setNow(!0)):a.active.setNow(!1)}))}}),_create_geocoder:function(e){var d=this,b=alp.cE("div");e=alp.mix(alp.m(d,"create_geocoder_opt",e),{is_startpoint_init_value:0===d.get_n_defined()});
var c=new d.cfg.geocoder_ctor(alp.oCreateMix(d.cfg,e),b,d.map),a={};alp.m(c,"init");d.node.appendChild(b);var f=new alp.Eh;f.push(d.active_st.bind_to(c.active_st,{loose:!0}));f.push(alp.m(c.info,["change_cb","entered_cb"],alp.bindF(function(b,c){var e=d.geo_info.get(),f=a&&a.ind();e[f]=b;d.geo_info.set(e);d.changeEvt().triggerSoon(f,e[f],c);setTimeout(function(){f<d._geo.length-1&&d._geo.forEach(function(a,b,c){(a&&a.ind()||c)===f+1&&b.focus()})},333)},d)));d.cfg.multigeocoder_mouseover&&(f.push(c.mouseoverEvt().then(function(){var b=
a&&a.ind();"number"===typeof b&&d.over_g_ind_st.set(b)})),f.push(c.mouseoutEvt().then(function(){var b=a&&a.ind();"number"===typeof b&&d.over_g_ind_st.is(b)&&d.over_g_ind_st.set(null)})));d.cfg.multigeocoder_delete&&alp.forEach(alp.nodelist(d.cfg.multigeocoder_delete,c.node),function(b){f.push(alp.aEL(b,"click",alp.nowF(function(){var b=a&&a.ind(),e=d.n.get();c.remove();d._geo.splice(b,1);f.clear();var g=d.geo_info.get();g.splice(b,1);d.geo_info.set(g);d.n.set(e-1);d.deleteEvt().triggerSoon(b)})))});
d.cfg.multigeocoder_dnd&&(a.dnd=alp.x.dnd(c.node,{clickable:d.cfg.multigeocoder_dnd,xy_constrain:function(a,b,c,e,f){return 2>d.n.get()?{x:e,y:f}:d.cfg.multigeocoder_dnd_xy_constrain.apply(this,arguments)},container:d.cfg.multigeocoder_scroll_cont||null}));a.eh=f;a.ind=function(){var a=d._geo.indexOf(c);return-1<a?a:null};a.has_xy=function(){return d.has_xy(a.ind())};d._geo.set(c,a);return{g:c,o:a}},_dnd_moved:function(e,d,b){if(e!==d){if(!this.cfg.passive_dnd_move){b=this.geo_info.get();var c=[].concat(b),
a=b.splice(d,1)[0];b.splice(e,0,a);this.geo_info.set(b);a=Math.min(d,e);for(var f=Math.min(b.length,c.length,2+Math.max(d,e));a<f;a++)alp.oEqual(c[a],b[a])||this.changeEvt().triggerSoon(a,b[a],c[a])}this.moveEvt().triggerSoon(e,d)}},_drop_geocoder:function(e){for(e=e||0;this._geo.length>e;){var d=this._geo.pop();d[0].remove();d[1].eh.clear()}},_update_highlight:function(){var e=this;alp.forEach(e._geo,function(d,b){(d=d&&d[0])&&e._update_geo_node(d,b)})},_update_geo_node:function(e,d){var b=this.highlight_g_ind_st.get();
b="number"===typeof b&&b<this._geo.length-1&&this.geo_info.get_property(b)&&b;var c=e&&e.node;c&&this._update_geo_node_highlight(e,c,d,b)},_update_geo_node_highlight:function(e,d,b,c){alp.setClass(d,this.cfg.multigeocoder_css_highlight,b===c)},_init_one_geocoder:function(e,d,b,c,a){var f=this.cfg;d=d&&d.ind()||c;c=(e=e[d])&&e.address||"";b.is_startpoint.set(0===d&&0===this.get_n_defined());b.input.setNow(c);b.input_active.setNow(!1);b.info.set(e);b.view&&b.view.update&&b.view.update();e=1>d;var g=
(c=d===a-1)&&2===a,h=c&&2<a,k=this.cfg.multigeocoder_via;e?k=this.cfg.multigeocoder_start:d===Math.max(1,a-2)?k=this.cfg.multigeocoder_end:c&&a<this.n.max&&(k=this.cfg.multigeocoder_add);"function"===typeof k&&(k=k.call(this.cfg,d));b.label.setNow(k);alp.setClass(b.node,[[f.multigeocoder_css_first,e],[f.multigeocoder_css_not_first,!e],[f.multigeocoder_css_last,c],[f.multigeocoder_css_not_last,!c],[f.multigeocoder_css_b_new,g],[f.multigeocoder_css_new,h]])}});var f="_h_finish_later"})();
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.x.multigeocoder_plus");
(function(){function k(a,b,c){(a||null).substring.call.a;alp.isFiniteNumber(b)||null.bug;a=c[a];c=a.speed_kmh.min;b=c+b*(a.speed_kmh.max-c);alp.isFiniteNumber(b)||null.bug;return b}function h(a){a.cfg.hasOwnProperty.call.a;var b;return alp.isFiniteNumber(b=alp.m(alp.m(a.cfg,"get_default_speedprop_main"),"get"))?b:.5}var g=alp._gmap2_3.digitize,f=g.NEXTLEG(),e=g.DATATYPE_NAME(),d=g.PT_RAIL_ONLY(),b=g.PT_WITH_BIKE(),c=g.PUBLIC_TRANSPORT(),a=g.PUBLIC_TRANSPORT_STEP_ARR(),m=g.ROUTING_ENGINE(),l=g.ROUTING_ENGINE_MANUAL(),
r=g.KSF(),n=g.SPEED_KMH(),q=["change_cb","changed_cb"],p=["change_v_cb","changed_v_cb"],v=alp.declare("alp._gmap2_3.digitize.x.MultiGeocoderPlus",alp._gmap2_3.x.MultiGeocoder,function(){this.cfg=alp.oCreateMix({multigeocoder_css_routed:"js-mgeo-routed",multigeocoder_css_manual:"js-mgeo-manual",multigeocoder_css_nextleg_highlight:"js-mgeo-nextleg-highlight",datatype_cfg:alp.cfg.datatype()},this.cfg)},{nextleg_over_g_ind_st:alp.memM("nextleg_over_g_ind_st","new alp.State()"),_connect_controller:function(){function a(){function a(){for(var a=
0;a<k.length;a++){var b=k[a][0];b&&h(b)}}function c(){for(var a=k.length;a--;){var b=k[a][0];alp.m(b.rmode_manual_st,"set",!g);alp.m(b.rmode_routed_st,"set",g)}}var e=d.get();if(e){var f=b.cfg.datatype_cfg,g=(f=(f=f[e]||f[f._default])&&f[m])?f!==l:null,h=alp.nowF(function(a){a.datatypename_st.set(e);!1===g&&(alp.m(a.rmode_manual_st,"set",!g),alp.m(a.rmode_routed_st,"set",g))}),k=b._geo;!1===g&&alp.now(c);a();setTimeout(a,1E3)}}var b=this,c=b.cfg.extension||(b.cfg.extension={});v.parent.prototype._connect_controller.apply(b);
b._connect_update_default_on_last_change();alp.m(b.nextleg_over_g_ind_st(),q,alp.bindF("_update_highlight",b));alp.m(b.n,q,alp.nowF(function(){var a,d,e;c.public_transport&&(d=alp.m(alp.m(b.cfg,"get_default_public_transport_main"),"get"));c.segment_datatype&&(e=alp.m(alp.m(b.cfg,"get_default_datatype_main"),"get"));c.segment_network&&(a=alp.m(alp.m(b.cfg,"get_default_routingengine_main"),"get"));if(c.segment_datatype_property){var f=alp.m(alp.m(b.cfg,"get_default_ksf_main"),"get");var g=h(b)}for(var k=
!1,l=!1,m=0;2>m;m++)b._geo.forEach(function(b,h,n){n=alp.m(h.routingenginename_st,"get");var p=alp.m(h.public_trans_st,"get"),q=alp.m(h.datatypename_st,"get"),r=alp.m(h.pt_rail_only_st,"get"),t=alp.m(h.pt_with_bike_st,"get"),u=alp.m(h.ksf_st,"get"),w=alp.m(h.speed_st,"getProp");0===m&&b.has_xy()&&(a=a||n,d=d||p,e=e||q,k=k||r,l=l||t,f=f||u,alp.isFiniteNumber(g)||(g=w));1!==m||b.has_xy()||(a&&c.segment_network&&alp.m(h.routingenginename_st,"set",a),d&&c.public_transport&&alp.m(h.public_trans_st,"set",
d),e&&c.segment_datatype&&alp.m(h.datatypename_st,"set",e),c.segment_pt_options&&(alp.m(h.pt_rail_only_st,"set",k),alp.m(h.pt_with_bike_st,"set",l)),f&&c.segment_datatype_property&&alp.m(h.ksf_st,"set",f),alp.isFiniteNumber(g)&&alp.m(h.speed_st,"setProp",g))})}));var d=alp.m(b.cfg,"get_default_datatype_main");d&&d.change_cb(a)},set_all_ksf:function(a){for(var b=this.geo_info.get(),c=0,d=this.n.get();c<d;c++)alp.oSet(b,[c,f,r],a);this.geo_info.set(b)},set_all_speed_prop:function(a){var b=this,c=b.geo_info.get();
b._geo.forEach(function(d,g){d=d.ind();g=alp.oGet(c,[d,f,e])||alp.m(alp.m(b.cfg,"get_default_datatype_main"),"get")||b.cfg.datatype_cfg._default;g=k(g,a,b.cfg.datatype_cfg);alp.oSet(c,[d,f,n],g)});b.geo_info.set(c)},lastNetworkChangeEvt:alp.memM("lastNetworkChangeEvt",'alp.event("MGP:lastNetworkChangeEvt",{then:1})'),lastRoutingengineChangeEvt:alp.memM("lastRoutingengineChangeEvt",'alp.event("MGP:lastRoutingengineChangeEvt",{then:1})'),lastPublicTransportChangeEvt:alp.memM("lastPublicTransportChangeEvt",
'alp.event("MGP:lastPublicTransportChangeEvt",{then:1})'),lastDatatypeChangeEvt:alp.memM("lastDatatypeChangeEvt",'alp.event("MGP:lastDatatypeChangeEvt",{then:1})'),lastKsfChangeEvt:alp.memM("lastKsfChangeEvt",'alp.event("MGP:lastKsfChangeEvt",{then:1})'),lastSpeedpropChangeEvt:alp.memM("lastSpeedpropChangeEvt",'alp.event("lastSpeedpropChangeEvt",{then:1})'),openInfoPubtransDialogEvt:alp.memM("openInfoPubtransDialogEvt",'alp.event("openInfoPubtransDialogEvt",{then:1})'),_last_ind:function(){var a=
this.n.get();return a===this.n.min&&this.has_xy(a-1)?a-1:Math.max(0,a-2)},create_geocoder_opt:function(a){var b=alp.oCopy(alp.m(v.parent.prototype.create_geocoder_opt,"apply",this,arguments)||{}),c=this.geo_info.get_property(a);if(c=c&&alp.oGet(c,[f,e]))b.datatypename_init=c;null==b.withautocomplete&&(b.withautocomplete=!0);null==b.datasource&&b.withautocomplete&&(b.datasource=new alp.data.AutoCompleteWhereAlpstein({project:this.cfg.proj,subset:"poi",displayResultSnippets:!0}));return b},_create_geocoder:function(h){function t(a){var b=
F.cfg.datatype_cfg;return(b[a]||b[b._default])[m]||R.init_value||"outdooractive,osrm,google"}function u(){if(!F._within_set_datatype){alp.now(z,null,T.get());if(K.has_xy()){var a=S.get();null!=a&&F.geo_info.set_property([K.ind(),f,c],a);null!=N.get()&&F.geo_info.set_property([K.ind(),f,d],N.get());null!=X.get()&&F.geo_info.set_property([K.ind(),f,b],X.get());(a=Q.get())&&F.geo_info.set_property([K.ind(),f,r],a);O.get()&&(a=[K.ind(),f,n],F.geo_info.set_property(a,O.get()))}a=[K.ind(),f,m];var e=R.get();
e&&F.geo_info.set_property(a,e)}}function x(){var a=alp.m(F.cfg,"get_default_public_transport_main");a&&U.push(alp.m(a,q,function(a){K.ind()===F._last_ind()&&alp.m(S,"set",a)}))}function y(){var a=F.geo_info._get_no_clone(),b=K.ind(),c=ja;if((a=ja=a&&alp.oGet(a,[b,f,e]))&&a!==c&&(c=t(a))){var d=[K.ind(),f,m];F.geo_info.set_property(d,c);R.set(c)}a&&b<F._last_ind()&&alp.m(F.cfg,"setSameDatatypeNameEtc",b)}function z(a){F._within_set_datatype=!0;var b=K.ind(),c=F.geo_info.get()||{},d=[b,f,e],g=!1;if(a=
a||alp.oGet(c,d)||T.get()){T.is(a)||T.set(a);if(a!==alp.oGet(c,d)){var h=k(a,.5,F.cfg.datatype_cfg);g=!0;alp.oSet(c,d,a);alp.oSet(c,[b,f,n],h);d=F.cfg.datatype_cfg;if(d=(d=d[a]||d[d._default])&&d[m])d=d!==l,!1===d&&(alp.m(M.rmode_manual_st,"set",!d),alp.m(M.rmode_routed_st,"set",d))}b+=1;d=F.get_i_last_defined_xy();if(a&&(null==d||b>d))for(;b<F._geo.length;b++)d=[b,f,e],alp.oGet(c,d)!==a&&(g=!0,alp.oSet(c,d,a));g&&F.geo_info.set(c);g&&A()}F._within_set_datatype=!1}function A(a){var b=[K.ind(),f,m];
a=a||F.geo_info.get_property(b);alp.m(R,"set",a);u()}function C(a){alp.m(F.cfg,"setRouted",K.ind(),!a);K.ind()===F._last_ind()&&(alp.m(alp.m(F.cfg,"default_is_manual_st"),"set",a),alp.m(F.cfg.next_segment_is_routed_st(),"set",!a));F._update_geo_node(M,K.ind())}function E(){var a=K.ind()!==F._last_ind()&&K.has_xy()?F.cfg.isRouted(K.ind()):!alp.m(alp.m(F.cfg,"default_is_manual_st"),"get");alp.m(M.rmode_manual_st,"set",!a);alp.m(M.rmode_routed_st,"set",a)}function G(){var a=F.geo_info._get_no_clone(),
b=F.geo_info.getPrevious(),c=[K.ind(),f,m];a=a&&alp.oGet(a,c);b=b&&alp.oGet(b,c);a&&a!==b&&R.setNow(a)}function B(){var a=F.geo_info.get_property([K.ind(),f,c]);a&&S.set(a)}function I(){N.set(F.geo_info.get_property([K.ind(),f,d]));X.set(F.geo_info.get_property([K.ind(),f,b]))}function L(){var a=F.geo_info._get_no_clone(),b=F.geo_info.getPrevious(),c=[K.ind(),f,e];a=a&&alp.oGet(a,c);b=b&&alp.oGet(b,c);a&&a!=b&&z(a)}function J(){Q.set(F.geo_info.get_property([K.ind(),f,r]))}function P(){var a=F.geo_info.get_property([K.ind(),
f,n]);alp.isFiniteNumber(a)&&O.set(a)}function H(){var b=[K.ind(),f,a];b=F.geo_info.get_property(b);var c;b&&(c=g.PublicTransportViewLegDetails(b,F.cfg.public_transport));V.set(c||"")}var F=this,D=v.parent.prototype._create_geocoder.apply(F,arguments),M=D.g,R=M.routingenginename_st,S=M.public_trans_st,T=M.datatypename_st,Q=M.ksf_st,O=M.speed_st,N=M.pt_rail_only_st,X=M.pt_with_bike_st,V=M.details_content_st,K=D.o,U=K.eh,W=F.cfg.extension;alp.nowF(function(){var a=t(T.get());if(/^google$/i.test(a)){var b=
[K.ind(),f,m];F.geo_info.set_property(b,a);R.set(a)}})();var Y=alp.nowF(E);alp.nowF(G);var aa=alp.nowF(function(){var a=R.get();a&&(A(a),K.ind()===F._last_ind()&&F.lastRoutingengineChangeEvt().triggerSoon(a))});alp.nowF(B);var Z=alp.nowF(function(){var a=S.get();a&&null!=a&&(u(),K.ind()===F._last_ind()&&F.lastPublicTransportChangeEvt().triggerSoon(a))});alp.nowF(I);var ba=alp.nowF(function(){K.has_xy()&&u()});alp.nowF(L);alp.nowF(y);var da=alp.nowF(function(){var a=T.get();a&&(z(a),K.ind()===F._last_ind()&&
F.lastDatatypeChangeEvt().triggerSoon(a))});alp.nowF(J);var ca=alp.nowF(function(){var a=Q.get();a&&(K.has_xy()&&u(),K.ind()===F._last_ind()&&F.lastKsfChangeEvt().triggerSoon(a))});alp.nowF(P);var fa=alp.nowF(function(){O.get()&&(K.has_xy()&&u(),O.getProp&&K.ind()===F._last_ind()&&F.lastSpeedpropChangeEvt().triggerSoon(O.getProp()))});alp.nowF(H);var ka=alp.nowF(function(){T&&W.segment_datatype&&y()}),ha=alp.nowF(function(){E();R&&W.segment_network&&G();S&&W.public_transport&&B();W.segment_pt_options&&
N&&X&&I();T&&W.segment_datatype&&L();Q&&W.segment_datatype_property&&J();O&&P();V&&W.details&&H()});ka();ha();setTimeout(alp.nowF(function(){var a=F.geo_info._get_no_clone()[0]?0:1;K.ind()===F._last_ind()&&K.ind()===a&&z()}));U.push(alp.m(F.geo_info,q,ka));U.push(alp.m(F.geo_info,q,ha));alp.m(M.rmode_manual_st,p,!0,function(){C(!0)});alp.m(M.rmode_routed_st,p,!0,function(){C(!1)});alp.asyncF(0,"_update_geo_node",F)(M,K.ind());U.push(alp.m(alp.m(F.cfg,"default_is_manual_st"),q,Y));R&&W.segment_network&&
U.push(alp.m(R,q,aa));S&&W.public_transport&&(U.push(alp.m(S,q,Z)),x());W.segment_pt_options&&N&&X&&(U.push(alp.m(N,q,ba)),U.push(alp.m(X,q,ba)));T&&W.segment_datatype&&U.push(alp.m(T,q,da));var ja;Q&&W.segment_datatype_property&&U.push(alp.m(Q,q,ca));O&&U.push(alp.m(O,q,fa));F.cfg.multigeocoder_mouseover&&(U.push(M.nextlegMouseoverEvt().then(function(){var a=K&&K.ind();"number"===typeof a&&F.nextleg_over_g_ind_st().set(a)})),U.push(M.nextlegMouseoutEvt().then(function(){var a=K&&K.ind();"number"===
typeof a&&F.nextleg_over_g_ind_st().is(a)&&F.nextleg_over_g_ind_st().set(null)})));M.openInfoPubtransDialogEvt().bindEvent(F.openInfoPubtransDialogEvt());return D},_update_geo_node_highlight:function(a,b,c,d){var e=this.nextleg_over_g_ind_st().get();if(b){d=c===d;var f=!d&&alp.m(a.rmode_routed_st,"get");a=!d&&alp.m(a.rmode_manual_st,"get");alp.setClass(b,alp.arr2o([[this.cfg.multigeocoder_css_highlight,d],[this.cfg.multigeocoder_css_routed,f],[this.cfg.multigeocoder_css_manual,a],[this.cfg.multigeocoder_css_nextleg_highlight,
c===e]]))}},_init_one_geocoder:function(a,b,c,d,g){v.parent.prototype._init_one_geocoder.apply(this,arguments);var h=b&&b.ind()||d,k=a[h];h=k&&alp.oGet(k,[f,e]);var l=k&&alp.oGet(k,[f,r]),p=k&&alp.oGet(k,[f,n]);k=k&&alp.oGet(k,[f,m]);h&&c.datatypename_st.set(h);l&&c.ksf_st.set(l);p&&c.speed_st.set(p);k&&c.routingenginename_st.set(k)},_connect_update_default_on_last_change:function(){var a=this,b=a.cfg.extension||(a.cfg.extension={});alp.forEach([{cfg_bool_name:"segment_network",event_name:"lastRoutingengineChangeEvt",
getter_name:"get_default_routingengine_main"},{cfg_bool_name:"public_transport",event_name:"lastPublicTransportChangeEvt",getter_name:"get_default_public_transport_main"},{cfg_bool_name:"segment_datatype_property",event_name:"lastKsfChangeEvt",getter_name:"get_default_ksf_main"},{cfg_bool_name:"segment_datatype_property",event_name:"lastSpeedpropChangeEvt",getter_name:"get_default_speedprop_main"},{cfg_bool_name:"segment_datatype",event_name:"lastDatatypeChangeEvt",getter_name:"get_default_datatype_main",
n_max:1}],function(c){b[c.cfg_bool_name]&&a[c.event_name]&&a[c.event_name]().then(function(b){"number"===typeof c.n_max&&a.n.get()>c.n_max||b&&alp.m(a.cfg[c.getter_name](),"set",b)})})}})})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.x.routedmultigeocoder");
alp.gmap3(function(k){function h(){var a=alp.m(alp.opt(this.model,"node_to_highlight_st"),"get"),b=null!=a&&alp.m(this.model,"getImportantNodesIndices");a=b&&null!=a&&alp.indexOf(b,a);this.multigeocoder.highlight_g_ind_st.set(-1<a?a:void 0)}function g(){var a=alp.m(alp.opt(this.model,"nextleg_to_highlight_st"),"get"),b=null!=a&&alp.m(this.model,"getImportantNodesIndices"),c=this.multigeocoder.highlight_g_ind_st.get();b=b&&null!=a&&(null==c||0==c)&&alp.arrMinIndex(b,function(b){return b<=a?a-b:Infinity});
alp.m(this.multigeocoder.nextleg_over_g_ind_st(),"set",-1<b?b:void 0)}function f(){var a=this.model_state.get();(a=a&&a.getImportantNodesIndices&&a.getImportantNodesIndices())&&this.multigeocoder.n.set(a.length+1)}function e(a,b){a=a||0;var c=this.model_state.get();if(c){b="number"===typeof b?a+b:Infinity;var d=alp.m(c,"getImportantNodesIndices"),e=c&&c.node_info&&c.node_info._get_no_clone();if(d&&e&&a<b){f.call(this);for(var g=this.multigeocoder,h=g.n.get(),k=g.geo_info.get();k.length<h;)k.push({});
k.length>h&&k.splice(h);for(h=k.length;h--;){var l=d[h];if(!(l<a)){if(l>=b)break;var m=e[l];m&&m.geo_xy||(l=c.getNode(l))&&"number"===typeof l.x&&"number"===typeof l.y&&(m=alp.mix({},alp.oCreateMix(m,{geo_xy:{x:l.x,y:l.y}})));k[h]=m}}g.geo_info.set(k)}}}function d(){var b=this,c=b.multigeocoder=new (b.cfg.multigeocoder_ctor||alp._gmap2_3.x.MultiGeocoder)(function(){return alp.mix({get_default_public_transport_main:function(){return alp.opt(b.model_state.get(),"default_public_transport_main")},get_default_routingengine_main:function(){return alp.opt(b.model_state.get(),
"default_routingengine_main")},get_default_datatype_main:function(){return alp.opt(b.model_state.get(),"default_datatype_main")},get_default_ksf_main:function(){return alp.opt(b.model_state.get(),"default_ksf_main")},get_default_speedprop_main:function(){return alp.opt(b.model_state.get(),"default_speedprop_main")},next_segment_is_routed_st:function(){return alp.opt(b.model_state.get(),"next_segment_is_routed_st")},setSameDatatypeNameEtc:function(d){var e=c.geo_info.get_property([d,a,m]),f=l,g=alp.map(f,
function(b){return c.geo_info.get_property([d,a,b])}),h=b.model_state.get(),k=alp.opt(h,"node_info"),n=alp.m(h,"getImportantNodesIndices");n=n&&n[d];e=e||alp.m(alp.opt(h,"default_datatype_main"),"get");if(!e)throw Error("alp._gmap2_3.digitize.x.RoutedMultiGeocoder setSameDatatypeNameEtc("+d+"): found a bug!");if(k&&null!=n){var p=h.getCurrentImportantNode(n);if(!h.isSegmentRouted(p)&&(h=h.getNextImportantNode(n),1<h-p)){n=k._get_no_clone()||{};for(var q=!1;p<h;p++){var r=n[p],v=(r=r&&r[a])||{},B=
!1;e!==v[m]&&(v[m]=e,B=!0);for(var I=f.length;I--;){var L=f[I],J=g[I];J!==v[L]&&(v[L]=J,B=!0)}B&&((n[p]||(n[p]={}))[a]=r?alp.mix({},v):v,q=!0)}q&&k.set(alp.mix({},n))}}},setRouted:function(a,c){var d=b.model_state.get(),e=alp.m(d,"getImportantNodesIndices");e=e&&e[a];null!=e&&(a=alp.m(d,"getCurrentImportantNode",e),e=alp.m(d,"getNextImportantNode",e),null!=a&&null!=e&&alp.m(d,c?"cmdSetContiguousSegmentsRouted":"cmdSetContiguousSegmentsManual",a,e))},isRouted:function(a){var c=b.model_state.get(),
d=alp.m(c,"getImportantNodesIndices");a=d&&d[a];return!1===(null!=a&&alp.m(c,"isSegmentRouted",a))?!1:!0},default_is_manual_st:function(){var a=b.model_state.get();return alp.opt(a,"default_is_manual_st")}},b.cfg,{passive_dnd_move:!0})}(),b.map);return c}var b=alp._gmap2_3,c=alp._gmap2_3.digitize,a=c.NEXTLEG(),m=c.DATATYPE_NAME(),l=c.NEXTLEG_ETC();c.SPEED_KMH();c.KSF();c.PUBLIC_TRANSPORT();c.PT_RAIL_ONLY();c.PT_WITH_BIKE();c.ROUTING_ENGINE();c.TIME_START();c.TIME_END();var r={},n=["change_cb","changed_cb"];
alp.declare("alp._gmap2_3.digitize.x.RoutedMultiGeocoder",alp.Eh,function(a,b,c){alp.or(alp.oValues(a.extension))||(delete this.cfg_default.geocoder_ctor,delete this.cfg_default.multigeocoder_ctor);this.cfg=alp.oCreateMix(this.cfg_default,a);this.model_state=b;this.map=c;this.active_st=new alp.BoolState({init_value:!0});this.highlight_dnd_target_on_map_st=new alp.BoolState;d.call(this)},{cfg_default:{geocoder_ctor:alp._gmap2_3.digitize.x.GeocoderPlus,multigeocoder_container:"#js-tp-multigeocoder",
multigeocoder_ctor:alp._gmap2_3.digitize.x.MultiGeocoderPlus},model_state:null,map:null,active_st:null,highlight_dnd_target_on_map_st:null,openInfoPubtransDialogEvt:alp.memM("openInfoPubtransDialogEvt",'alp.event("RMG:openInfoPubtransDialogEvt",{then:1})'),init:function(){function a(){var c=b.model_state.get();c?(b.set_model(c),b.multigeocoder.init(),b._connect_controller()):setTimeout(a,123)}var b=this;a()},_connect_controller:function(){var a=this.multigeocoder;a.changeEvt().then(alp.bindF("onchange",
this));a.deleteEvt().then(alp.bindF("ondelete",this));a.draggingEvt().then(alp.bindF("ondrag",this));a.moveEvt().then(alp.bindF("onmove",this));a.openInfoPubtransDialogEvt().bindEvent(this.openInfoPubtransDialogEvt());alp.m(a.over_g_ind_st,n,alp.bindF("on_over_g_ind_change",this));alp.m(a.nextleg_over_g_ind_st(),n,alp.bindF("on_nextleg_over_g_ind_change",this));alp.m(this.model_state,n,alp.bindF("set_model",this));this.active_st.bind_to(a.active_st,{loose:!0})},onchange:function(a){var b=this.multigeocoder,
d=b.geo_info.get_property(a);b=alp.oGet(b.geo_info.getPrevious(),a);if(this.active_st.get()){if(d&&b)for(var e in b)e in r||b[e]&&null==d[e]&&(d[e]=b[e]);d&&(d=c.SELECT_RMG_CHANGE_FOR_MODEL(d));var f=(e=d&&d.geo_xy)&&e.x,g=e&&e.y,h="number"===typeof f&&"number"===typeof g;if("number"===typeof a){var l=(b=(e=this.model_state.get())&&e.getImportantNodesIndices&&e.getImportantNodesIndices())&&b[a];e&&(f=h&&new k.LatLng(g,f),h=e.node_info&&e.node_info._get_no_clone(),g=null==l?e.getNodeCount()-1:l,f&&
(h=(h=(h=h&&h[g])&&h.geo_xy)&&new k.LatLng(h.y,h.x)||e.getNode(g),null==l&&h&&h.equals(f)?alert(alp._gmap2_3.i18n.geocoderSameAsLast):null==l?(a-=b.length,0<a?(b=Math.max(0,1+g),l=Array(a).concat([f]),d=Array(a).concat([d]),e.insertNodes(l,b,!0,d)):e.insertNodes([f],null,!0,[d])):h?e.updateNode(l,!h.equals(f)&&f,d):e.getNode(g)?(void 0).bug:e.insertNodes([f],null,!0,d&&[d])))}}},ondelete:function(a){if(this.active_st.get()&&"number"===typeof a){var b=this.multigeocoder.n.get();if(!(2<b&&a===b)){var c=
(b=this.model_state.get())&&b.getImportantNodesIndices&&b.getImportantNodesIndices();a=c&&c[a];c&&b&&b.deleteNodes&&"number"===typeof a&&b.deleteNodes(a,1)}}},ondrag:function(a,b){this.highlight_dnd_target_on_map(a,b)},onmove:function(a,b){var c=this.model_state.get(),d=alp.m(c,"getImportantNodesIndices");d&&(alp.m(c,"cmdMoveNode",d[a],d[b],!0),this.clear_dnd_target_on_map())},on_over_g_ind_change:function(a){var b=this.model_state.get(),c=alp.m(b,"getImportantNodesIndices");a=c&&c[a];b&&b.node_to_highlight_st&&
b.node_to_highlight_st.set(a)},on_nextleg_over_g_ind_change:function(a){var b=this.model_state.get(),c=alp.m(b,"getImportantNodesIndices");alp.m(b&&b.nextleg_to_highlight_st,"set",c&&c[a])},set_model:function(a){var b=this;b.clear();b.model=a;b.model&&(alp.forEach("geomChangeEvt deleteNodesEvt insertNodesEvt updateNodeEvt updateNodeArrayEvt reverseEvt geomClearEvt changeSegmentEvt".split(" "),function(a){b.push(b.model[a]().then(alp.bindF("on_"+a,b)))}),b.push(alp.m(b.model.node_to_highlight_st,n,
alp.bindF(h,b))),b.push(alp.m(b.model.nextleg_to_highlight_st,n,alp.ratelimitF(250,alp.nowF(g,b)))));b.on_geomChangeEvt()},set_all_ksf:function(a){this.multigeocoder.set_all_ksf(a)},set_all_speed_prop:function(a){this.multigeocoder.set_all_speed_prop(a)},on_geomChangeEvt:function(a,b){function c(a){e.call(d,a,1)}var d=this;d.active_st.get()&&(f.call(d),b?alp.forEach(b,c):e.call(d))},on_changeSegmentEvt:function(a){e.call(this,a,1)},on_deleteNodesEvt:function(a,b){e.call(this,a,b)},on_insertNodesEvt:function(a,
b){e.call(this,b,a.length+1)},on_updateNodeEvt:function(a){e.call(this,a,1)},on_updateNodeArrayEvt:function(a){var b=Math.min.apply(Math,a);a=Math.max.apply(Math,a);e.call(this,b,1+a-b)},on_reverseEvt:function(){e.call(this)},on_geomClearEvt:function(){e.call(this);this.multigeocoder.init()},clear_dnd_target_on_map:function(){this.highlight_dnd_target_on_map();this.highlight_dnd_target_on_map_st.set(!1)},highlight_dnd_target_on_map:function(a,c){var d=this.model_state.get(),e=this.highlight_dnd_target_on_map_st;
alp.m(this._dnd_target_on_map,"setMap",null);this._dnd_target_on_map=null;if(a===c||null==a||null==c)e.set(!1);else{var f=this.map&&this.map.gmap||this.map;if(f&&d.getNode){var g=this.multigeocoder.n.get(),h=alp.m(d,"getImportantNodesIndices"),k=a>c?a+1:a;h&&f?(a=1>k||k>g-2?alp.map([h[c],h[Math.min(a,g-2)]],d.getNode,d):alp.map([h[k-1],h[c],h[k]],d.getNode,d),this._dnd_target_on_map=b.polylineGen({path:a,map:f,strokeColor:"#00ff00",strokeWeight:2,strokeOpacity:1}),e.set(!0)):e.set(!1)}else e.set(!1)}}})});
"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.digitize.simple");
alp.gmap3(function(k){function h(a,b){return"function"===typeof a?h(a(),b):"string"===typeof a?a.split(b||","):a}function g(a){var b="hikingTourTrail longDistanceHikingTrail cycling longDistanceCyclingTrack mountainbiking transalpMountainbiking".split(" "),c=alp.arr2oSimple(b);a=alp.arrSorted(alp.filter(alp.oKeys(a),"!(v in this) && /^[a-zA-Z]+$/.test(v)",c));return b.concat(a)}function f(a){a.state.routingstyle.change_cb_init(function(){var b=a.state.routingstyle.get();b&&alp.m(alp.opt(a._model,
"default_ksf_main"),"set",b)});a.state.routingstyle.change_cb(function(){var b=a.state.routingstyle.get();b&&alp.m(a.routedmultigeocoder,"set_all_ksf",b)})}function e(b){b.state.pace.change_cb_init(function(){var c=b.state.pace.get();c=c&&a.PACE_2_SPEEDPROP(c);null!=c&&alp.m(alp.opt(b._model,"default_speedprop_main"),"setProp",c)});b.state.pace.change_cb(function(){var c=b.state.pace.get();c=c&&a.PACE_2_SPEEDPROP(c);null!=c&&alp.m(b.routedmultigeocoder,"set_all_speed_prop",c)})}function d(a){var b=
typeof a;return"string"===b?a:"object"===b?alp.oToString(a):(void 0).bug}function b(a){var b=a.state.editMode.get()||{};b=/\bPolyAttrMode$/.test(b&&b.modeClass||"");alp.setClass(a.config.elproCont_q||[],[[p.linrefEditActiveClass,b],[p.linrefEditInactiveClass,!b]]);alp.style(a.config.linrefEdit_attrLegendNode||[],"display",b?"block":"none")}var c=alp._gmap2_3,a=c.digitize,m=alp.util.json,l=alp.i18n.fetch("alp.all"),r={},n=["change_cb","changed_cb"],q=["change_v_cb","changed_v_cb"],p=c.x.ConstElpro,
v=a.ROUTING_ENGINE(),u=a.ROUTING_ENGINE_MANUAL(),t=a.ROUTING_ENGINE_OSRM();alp.i18n.fetch("alp.all").then(function(a){r=a});alp.declare("alp._gmap2_3.digitize.simple",null,alp.nowF(function(b,d){var g=this;this.map=b;this.state={model:new alp.State,editMode:new alp.State};alp.m(g.state.model,n,function(a,b){a&&b&&a!=b&&(g._changed=!0)});this._original_st=new alp.State;b=this.config=this._mix_default(d);this.state.routingstyle=alp.modeStateFromArr(a.KSF_ARR(),{init_value:b.routingstyle_init||a.ROUTINGSTYLE_DEFAULT()});
this.state.pace=alp.modeStateFromArr(a.PACE_ARR(),{init_value:b.pace_init||a.PACE_DEFAULT()});this.config.extension=this.config.extension||{};this.config.extension.segment_datatype_property=!1!==this.config.extension.segment_datatype_property;this.visible=new alp.BoolState({init_value:!b.start_hidden});this._init_cfg_routing_message();this._init_datatype();this._imr_change_gui();if(b.datatype_node_select){var h=b.modelOptions.datatype_entries=this._create_datatype_selector().entries;if(h){for(var k=
{},l=alp.cfg.datatype(),m=h.length;m--;){var p=h[m],q=p.name,r=p.id;p=alp.oCreateMix(l[q]||{},alp.oCopy(p));var t=p.routing;t&&(delete p.routing,alp.mix(p,alp.opt(t,a.DATATYPE_CFG_ROUTING_ENTRIES(),!0)),(t=t.routingEngine)&&(p[v]=t));k[q]=k[r]=alp.oCreateMix(l[q]||{},p);1>m&&(k._default=q)}b.datatype_cfg=b.modelOptions.datatype_cfg=k}}b.multigeocoder_container&&alp.nodelist(b.multigeocoder_container).length&&(this.routedmultigeocoder=new a.x.RoutedMultiGeocoder(alp.mix({get_default_datatype_main:function(){return g.state.datatype}},
b),this.state.model,d.alp_map),this.visible.bind_to(this.routedmultigeocoder.active_st,{loose:!0}),alp.m(this.routedmultigeocoder.highlight_dnd_target_on_map_st,n,function(a){alp.m(alp.oGet(g.itemController,"_views.editHighlightLinePiece.active_st"),"set",!a)}));this._changed=!1;this.formField=b.formField&&alp.nodify(b.formField);this.geomType=b.geomType.toUpperCase();if(!this.geomType)throw"alp._gmap2_3.digitize.simple:  geomType must be specified.";a.topic("/alp/_gmap2_3/digitize/routing/start").then(alp.bindF("onRoutingStart",
this));a.topic("/alp/_gmap2_3/digitize/routing/end").then(alp.bindF("onRoutingEnd",this));c.event("addListener")(this.map,"maptypeid_changed",alp.asyncF(0,"viewonlyin3d",this));this.viewonlyin3d();alp.ratelimitM(500,"_update_formField_value",this);this._init_original_geojson_cb();alp.ratelimitM(121,"_update_tourLength_value",this);alp.ratelimitM(356,"_update_elpro_summary_values",this);this._install_tourduration_display();this._install_simple_info_public_transport();this.undoLength=new alp.MinMaxState({min:0,
max:Infinity});this.redoLength=new alp.MinMaxState({min:0,max:Infinity});f(this);e(this);this.update()}),a.InterfaceSimpleChangeGui,a.InterfaceSimpleDatatypeSelector,a.InterfaceSimpleInitOriginalGeojsonCb,a.InterfaceSimpleMenu,a.InterfaceSimpleRoutingMessage,a.InterfaceSimpleViewOnlyIn3d,a.InterfaceSimpleTourDurationDisplay,a.InterfaceSimpleInfoPublicTransport,a.InterfaceSimpleHoverPoints,a.InterfaceSimpleQuickFacts,{m_routing_source_set:null,getDatatypeName:function(){return this.state.datatype.get()},
getDatatypeId:function(){return alp.oGet(this.config.datatype_cfg,[this.getDatatypeName(),"id"])},resize:function(){alp.m(this._x_elpro,"resize")},getLength:function(){return alp.m(this.state.model.get(),"getLength")||0},closeLoop:function(){return alp.m(this.state.model.get(),"closeLoop")},appendNode:function(a,b){return alp.m(this.state.model.get(),"appendNode",a,b)},autoInsertNode:function(a,b){return alp.m(this.state.model.get(),"autoInsertNode",a,b)},clearGeometry:function(){return this.deleteNodes(0,
Infinity)},deleteNodes:function(a,b){return(alp.m(this.state.model.get(),["cmdDeleteNodes","deleteNodes"],a,b||1)||[[]])[0]||[]},setGeoInfo:function(a,b){"number"===typeof a?this.routedmultigeocoder.multigeocoder.geo_info.set_property(a,b):this.routedmultigeocoder.multigeocoder.geo_info.mixin(alp.mix([],a))},undo:function(){alp.m(alp.opt(this.editController,"undoStack"),"undo")},redo:function(){alp.m(alp.opt(this.editController,"undoStack"),"redo")},startExtending:function(a){alp.m(alp.m(this.itemController,
"getMode"),"stop");alp.m(this.itemController,"startExtending",a)},startLinrefEdit:function(){alp.m(alp.m(this.itemController,"getMode"),"stop");alp.m(this.itemController,"setMode","attr")},startBulkEdit:function(){alp.m(alp.m(this.itemController,"getMode"),"stop");alp.m(this.itemController,"setMode","bulkedit")},_init_datatype:function(){var a=this,b=a.config,c=alp.fVal(b.datatype_arr);"*"===c&&(c=g(b.datatype_cfg));c=h(c);var d=alp.filter(c,function(a){return!b.datatype_cfg[a]});if(0<d.length&&(console.error("alp._gmap2_3.digitize.simple._init_datatype(): not all datatype names were found in the config, dropping some of them: "+
d.join(",")),c=alp.filter(c,function(a){return b.datatype_cfg[a]}),1>c.length))throw Error("nothing left!");a.state.datatype=alp.modeStateFromArr(c,{init_value:b.datatype_init||b.datatype_cfg._default});alp.m(a.state.datatype,n,function(){a._update_model_default_datatype();a._update_formField_value();a._update_hidden_datatype_inputs();alp.m(alp.opt(a.state.model.get(),"aggressive_network_highlight_st"),"set",!0);var b=a.state.datatype.get(),c=a.config.datatype_cfg;c=c&&c[b];if(b&&c){var d=c[v];b=
a.itemController;d&&b&&(c=b.getMode(),d=u!==d,c&&c.is()&&c.stop(),b.setMode("extend",!0,d))}});a._update_hidden_datatype_inputs()},init:alp.nowF(function(){var a,b,c=this;this._is_reinit?this._imr_change_gui():this._is_reinit=!0;(a=this.datatype_selector)&&l.then(function(){a.init();alp.style(alp.nodelist(c.config.datatype_node_cont),{display:""})});(b=this.routedmultigeocoder)&&l.then(alp.bindF("init",b));this._update_tourLength_value()}),getNodeCount:function(){return alp.m(this.model,"getNodeCount")},
currentJson:function(){return m.stringifySafe(this.currentObjectUnsafe())},currentObjectUnsafe:function(){var a=alp.m(this.model,"toGeoJSON")||{},b=this._original_st.get();alp.mix(a,{datatype_name:this.state.datatype.get(),routingstyle:this.state.routingstyle.get(),pace:this.state.pace.get()},this.getDerivedValues());b&&alp.mix(a,{original:b});return a},getDerivedValues:function(){var a={},b=alp.m(alp.opt(this.model,"elevationSummary"),"get");b&&(b=alp.filterIn(b,'w[0]!=="_"'),alp.oSet(a,"derivedValues.elevationSummary",
b));(b=alp.m(alp.sub("m.attrSummary",this._x_elpro),"get"))&&alp.oSet(a,"derivedValues.attributeSummary",b);if((b=alp.m(alp.opt(this.model,"duration_ms_st"),"get"))&&alp.isFiniteNumber(b)){var c=Math.round(b/1E3/60);alp.oSet(a,"derivedValues.durationSummary",{total_ms:b,human:{hours:c/60|0,minutes:c%60,seconds:0,ms:0}})}return a},changed:function(){return this._changed},geomChangeEvt:alp.memM("geomChangeEvt",'alp.event("AGD:simple:geomChangeEvt",{then:1})'),attrChangeEvt:alp.memM("attrChangeEvt",
'alp.event("AGD:simple:attrChangeEvt",{then:1})'),durationChangeEvt:alp.memM("durationChangeEvt",'alp.event("AGD:simple:durationChangeEvt",{then:1})'),elevationChangeEvt:alp.memM("elevationChangeEvt",'alp.event("AGD:simple:elevationChangeEvt",{then:1})'),onChange:function(a){},onModeChange:alp.nowF(function(a,b){this.state.editMode.set({modeClass:a,mode:b})}),append_new_latlng:function(a){var b=alp.m(this.itemController,"getMode","extend");alp.m(b,"append_new_latlng",a)},update:function(e,f,g){function h(a){if(!a||
!a.coordinates)return a;if(/^multilinestring$/i.test(a.type))return{encPolyline:c.encodePolyline({xy:alp.arrChain(a.coordinates)}),type:"LineString"};var b=alp.filterIn(a,'w!="coordinates"');b.encPolyline=c.encodePolyline({xy:a.coordinates});return b}var l=this;g=alp.oCreateMix({keep_original:!f},g);var p=alp.oFrom(e),r=p&&(p.gpx||alp.oGet(p,"original.gpx"));g.keep_original&&(g=this._original_st.get())&&(e=m.stringify(alp.mix({},alp.oFrom(e),{original:g})));l._tourLength_noli=null;(p=alp.oFrom(e))&&
p.original&&(p.original=h(p.original),e=m.stringify(p));p=alp.oFrom(e);r&&(delete p.gpx,alp.oSet(p,"original.gpx",r),e=m.stringify(p));(this._eh||(this._eh=new alp.Eh)).clear();this._dtb&&(this._dtb.setMap(null),this._dtb=null);alp.forEach(["editController","itemController"],function(a){var b=this[a],c=b&&b.getMode&&b.getMode();c&&c.stop&&c.stop();b&&b.destroy&&b.destroy();this[a]=void 0},this);alp.m(l.visible,q,!1,function(){var a=l.itemController.getMode("bulkedit");a.is()&&a.stop()});if(this.model){var u=
this.currentJson();this.state.model.set(this.model=null);this.formField&&(this.formField.value=d(u))}e&&(u=e,this.formField&&(this.formField.value=d(u)));if("LINESTRING"==this.geomType)g=alp._gmap2_3.digitize.PolylineModel;else if("MULTILINESTRING"==this.geomType)g=alp._gmap2_3.digitize.RoutedPolylineModel,this.config.modelOptions=this.config.modelOptions||{};else if("POLYGON"==this.geomType)g=alp._gmap2_3.digitize.PolygonModel;else if("POINT"==this.geomType)g=alp._gmap2_3.digitize.PointModel;else throw Error("alp._gmap2_3.digitize.simple: No support for geomType: "+
this.geomType);r=this.config.modelOptions;r.attr_default=r.attr_default||a.ATTR_DEFAULT;u=u||this.formField&&this.formField.value;if("undefined"===u||"null"===u)u=null;if(u)try{var v="string"===typeof u?(new Function("return ("+u+");"))():u}catch(L){console.warn("Error parsing GeoJSON:",L),u=""}r=(r=alp.oFrom(e))&&(r.gpx||alp.oGet(r,"original.gpx"));this._original_st.set(null);u&&(u="string"===typeof u?alp.oFrom(u):u,null==f&&u.type&&!u.original&&(/^linestring$/i.test(u.type)?f=!0:/^multilinestring$/i.test(u.type)&&
u.coordinates&&1<u.coordinates.length&&(f=alp.and(u.coordinates,".length===2"))),f?(delete u.original,f=u):f=u.original,f=h(f),r&&(f.gpx=r),this._original_st.set(f));f=alp.mix({},this.config.modelOptions,{extension:this.config.extension,default_datatype_name:l.state.datatype.get(),routingengine_name_modifier:function(a){if(/(?:^|_)osm\b/.test(alp.m(l.map,"getMapTypeId"))){var b=a.indexOf(t);0<b&&(a=[a[b]].concat(a.slice(0,b)).concat(a.slice(b+1)))}return a},m_routing_source_set:this.config.m_routing_source_set||
null});if(r=this.datatype_selector)f.getDatatypeEntry=r.getEntry&&alp.bindF("getEntry",r);this.config.default_routingengine&&(f.routing_engine_init=this.config.default_routingengine);this.state.model.get()&&(this._changed=!0);this.state.model.set(this.model=v?g.fromGeoJSON(v,f):new g(f));this._update_model_default_datatype();this.setRoutingStartMessage();g=alp.mix({start_hidden:this.config.start_hidden,extension:this.config.extension},this.config.editControllerOptions||{});this.formField&&this.formField.form&&
!this.config.ignoreForm&&(g.extraMenuItems=alp.bindF("_getFormMenuItems",this));this.model.geomChangeEvt&&this.model.geomChangeEvt().bindEvent(this.geomChangeEvt());(f=this.model.attributes&&this.model.attributes.attrChangeEvt())&&f.bindEvent(this.attrChangeEvt());(f=alp.m(alp.opt(this.model,"elevationSummary"),"change"))&&f.bindEvent(this.elevationChangeEvt());(f=alp.m(this.model.duration_ms_st,"change"))&&f.bindEvent(this.durationChangeEvt());this.editController=new alp._gmap2_3.digitize.EditController(this.map,
g);this._eh.push(this.editController.undoStack.undoLength.bind_to(this.undoLength));this._eh.push(this.editController.undoStack.redoLength.bind_to(this.redoLength));alp.m(this.visible,n,"_update_ec_vis",this);this._update_ec_vis();g=alp.oCreateMix(alp.opt(this.config,["extension"]),this.config.itemControllerOptions);f=this.config.linrefEdit_withMapMarker;null!=f&&(g.profile_opts={withMapMarker:f});f=this.config.linrefEdit_withContextMenu;null!=f&&(g.profile_opts={withContextMenu:f});g.hasCustomAttributeProfile=
function(){return!!l._x_elpro};"POINT"==this.geomType?this.itemController=new alp._gmap2_3.digitize.PointEditController(this.editController,this.model,g):(this.itemController=new alp._gmap2_3.digitize.PolyEditController(this.editController,this.model,g),this.config.withDigitizeToolbar&&(g=this._dtb=new c.digitize.Toolbar(this.itemController,this.config.dtb_options),g.setMap(this.map),this.visible.bind_to(g.visible_st,{loose:!0})));alp.m(this.visible,n,"_update_ic_vis",this);this._update_ic_vis();
alp.forEach("factAscent factDescent factHighest factLowest factLength elproCont elproCanvas elproLegendHeight elproLegendDistance elproClipping elproClippingLeft elproClippingRight".split(" "),function(a){this["_"+a+"_noli"]=this.config[a+"_q"]?alp.nodelist(this.config[a+"_q"]):[]},this);this._eh.push(this.model.geomChangeEvt().then(function(a,b){l._update_formField_value();l._update_tourLength_value();l._update_elpro_summary_values();l._changed=!0;l.onChange(a||l.model,b)}));this.model.elevationSummary&&
this._eh.push(this.model.elevationSummary.change_cb(function(){l._update_formField_value();l._update_elpro_summary_values()}));this.model.duration_ms_st&&this._eh.push(this.model.duration_ms_st.change_cb(function(){l._update_formField_value()}));this._update_tourLength_value();this._update_elpro_summary_values();this._elproCanvas_noli&&this._elproCanvas_noli.length&&(alp.m(l._x_elpro,"destroy"),l._x_elpro=new alp.x.Elpro({initNow:!0,polyModel:this.model,canvasNode:this._elproCanvas_noli[0],heightNode:this._elproLegendHeight_noli[0],
distanceNode:this._elproLegendDistance_noli[0],clippingNode:this._elproClipping_noli[0],clippingLeft:this._elproClippingLeft_noli,clippingRight:this._elproClippingRight_noli}),l._eh.push(l._x_elpro.m.attrSummary.change_cb(l._update_formField_value,l)),l._eh.push(l.state.editMode.change_cb_init(b,null,l)));a.controllers.link_center_zoom_elpro_and_linref(l._eh,l._x_elpro,l.itemController._views.attributeProfile);a.controllers.link_map_bounds_and_elpro_bounds(l._eh,l.map,l._x_elpro,alp.opt(l.config,
["mapPadding"]));l._init_hover_points();this.itemController.nodeMouseoverEvt&&this._eh.push(this.itemController.nodeMouseoverEvt().then(function(a){var b=l.routedmultigeocoder;b&&b.set_highlight_for_node&&b.set_highlight_for_node(a)}));var w=this.itemController;this._eh.push(w.modeChangeEvt().then(function(){var a=w.getMode();l.onModeChange(alp.opt(a,"declaredClass"),a)}));this.formField&&this.formField.form&&!this.config.ignoreForm&&alp.aEL(this.formField.form,"submit",alp.nowF(function(a){var b=
(a=l.itemController)&&a.getMode("edit");a.stopEditing?a.stopEditing():b&&b.stop();a=l.currentJson();alp.sA(l.formField,"value",l.formField.value=a||"")}));v&&(g=new k.LatLngBounds,f=this.itemController.getBounds())&&(g.extend(f.getSouthWest()),g.extend(f.getNorthEast()),v.mapView?(this.map.setCenter(new k.LatLng(v.mapView[1],v.mapView[0]),v.mapView[2]),this.map.setZoom(v.mapView[2])):g.isEmpty()||c.set_bbox(this.map,g,alp.opt(this.config,"mapPadding"),{maxZoom:this.config.maxInitialZoom,now:!0}));
if("POINT"==this.geomType)switch(v="EDIT",this.config.initialState&&(v=this.config.initialState.toUpperCase()),v){case "EDIT":this.itemController.startEditing();break;default:v&&console.warn("alp._gmap2_3.digitize.simple: Unknown initial edit-state: "+v)}else switch(v=v?"VIEW":"EXTEND_ROUTED",this.config.initialState&&(v=this.config.initialState.toUpperCase()),v){case "EXTEND_ROUTED":this.itemController.setMode("extend",!0,!0);break;case "EXTEND":this.itemController.setMode("extend",!0,!1);break;
case "EDIT":this.itemController.setMode("edit");break;default:v&&console.warn("alp._gmap2_3.digitize.simple: Unknown initial edit-state: "+v)}this._update_formField_value();this.geomChangeEvt().triggerSoon()},_update_ec_vis:function(){var a=this.editController;a&&a.visible&&a.visible.set(this.visible.get())},_update_ic_vis:function(){var a=this.itemController;a&&a.visible&&a.visible.set(this.visible.get())},_update_formField_value:function(){if(this.formField&&this.config.ignoreForm){var a=this.currentJson();
a&&(this.formField.value=d(a))}},_update_hidden_datatype_inputs:function(){var a=this.getDatatypeName(),b=this.getDatatypeId();if(a&&b){var c=this.config.datatype_hidden_name,d=this.config.datatype_hidden_id;c&&alp.setProp(alp.nodelist(c),"value",a);c&&alp.setProp(alp.nodelist(d),"value",b)}},_update_tourLength_value:function(){var a=this.config.tourLength_q;this._tourLength_noli&&!alp.and(this._tourLength_noli,"v.offsetWidth  &&  v.offsetHeight")&&(this._tourLength_noli=null);this._tourLength_noli||
(this._tourLength_noli=a&&alp.nodelist(a)||[]);this._qf_update_tourLength_value(this.getLength())},_update_elpro_summary_values:function(){this._qf_update_elpro_summary_values(alp.m(alp.opt(this.state.model.get(),"elevationSummary"),"get"))},_update_model_default_datatype:function(){var a=this.state.model.get();alp.m(alp.opt(a,"default_datatype_main"),"set",this.state.datatype.get())},_mix_default:function(b){var c=alp.cfg.linref();b=alp.mix({},{withDigitizeToolbar:!0,formField:"f_geom",geomType:"MULTILINESTRING",
initialState:null,multigeocoder_container:"#js-tp-multigeocoder",multigeocoder_scroll_cont:null,tourLength_q:"#tourLength",tourDurationV_q:".tourDuration",tourDurationH_q:".tourDurationH",tourDurationM_q:".tourDurationM",factAscent_q:null,factDescent_q:null,factLowest_q:null,factHighest_q:null,factLength_q:null,elproCont_q:null,elproCanvas_q:null,elproLegendHeight_q:null,elproLegendDistance_q:null,original_geojson_cb_container:".js-digitize-original-geojson-cb",original_geojson_checkbox:function(){var a=
alp.nodify("js-digitize-original-geojson-cb");return a&&alp.gEBTN("input",a)},original_geojson_init:!1,original_geojson_polystyle:{color:"#FF00FF",weight:5,opacity:.7},datatype_arr:"hikingTourTrail,longDistanceHikingTrail,cycling",datatype_init:"hikingTourTrail",datatype_node_cont:".datatype-global",datatype_node_select:function(a){return(a=alp.nodify("js-digitize-datatype-global",a))&&alp.nodelist("js-digitize-datatype-select",a)},datatype_img_select:function(a){return(a=alp.nodify("js-digitize-datatype-global",
a))&&alp.nodelist("js-digitize-datatype-icon",a)},datatype_from_dom:!1,datatype_sort_by_title:!1,datatype_do_not_force_show:!1,datatype_hidden_id:null,datatype_hidden_name:null,default_routingengine:null,mapPadding:null,routingstyle_init:a.KSF_DEFAULT(),pace_init:a.PACE_DEFAULT(),new_geocoder_node_template:a.NEW_GEOCODER_NODE_TEMPLATE(),new_geocoder_node_template_address:"js-tp-node-address",new_geocoder_node_template_label:"js-tp-node-label",new_geocoder_prompt:function(a){a=a?"geocoderPromptStartPoint":
"geocoderPrompt";return r?r[a]:"AGD:simple:i18n:xxx:"+a},new_geocoder_error:function(){return r.geocoderError},new_geocoder_alwaysPointGeometry:!1,public_transport:alp.cfg.publictransport(),routing_public_transport:alp.routing.extract.DEFAULT_CFG(),roadbookRouting:!1},alp.sub("alpConfig.digitize"),alp.filterIn(b,"!=null"));b.datatype_cfg||(b.datatype_cfg=alp.cfg.datatype());var d=b.default_routingengine;null===d&&(d=alp.nodify(b.new_geocoder_node_template))&&(d=(d=alp.filter(alp.gEBTN("input",d),
'alp.gA(v,"name")==="routing-network"')[0])&&d.value)&&(b.default_routingengine=d);var e=(d=(d=b.formField&&alp.nodify(b.formField))&&d.value)&&alp.oFrom(d);d=e&&e[a.DATATYPE_NAME()];var f=e&&e[a.ROUTINGSTYLE()];e=e&&e[a.PACE()];var g=alp.opt(alp.nodify("datatypename"),"value");g&&(d=g);d&&(b.datatype_init=d);f&&(b.routingstyle_init=f);e&&(b.pace_init=e);b.modelOptions=alp.mix({routing_engine:alp.cfg.routingengine(alp.opt(b,["roadbookRouting"],!0)),attributes:c&&c.attributes},b.modelOptions);b.modelOptions.datatype_cfg=
b.datatype_cfg;alp.oSet(b,"itemControllerOptions.editMarkerOptions",alp.mix(alp._gmap2_3.digitize.EDIT_MARKER_OPTIONS_DEFAULT(),alp.oGet(b,"itemControllerOptions.editMarkerOptions")));b.itemControllerOptions=alp.mix({enforce_minEditZoom:!1,editLineOptions:{color:"#0000ff",opacity:1},viewLineOptions:{color:"#ff0000",opacity:1},profileNode:b.linrefEdit_profileNode||c&&c.profileNode,attrLegendNoMap_widgetNode:b.linrefEdit_attrLegendNode,attrLegendOptions:b.linrefEdit_attrLegendOptions},b.itemControllerOptions);
b.extension=alp.mix({datatype:!0,details:!0,options:!0,public_transport:!1,segment_datatype:!0,segment_datatype_hide_gui:!1,segment_datatype_property:!0,segment_network:!0},b.extension);return b}})});"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.layer.tour_edit_layer");
alp.gmap3(function(k){function h(a,b){var c=alp.opt(b,"modeClass");b=alp.opt(b,"mode");c=c&&c.split&&c.split(".");a.triggerEvent("modeChange",c&&c[c.length-1],b&&alp.opt(b,["isRouting"],!0));a.mark_init_done()}function g(a,b){return a||alp.opt(location.search.match(new RegExp("(?:\\?|&)"+b+"=([^&]*)(?:&|$)")),1)}function f(a){function b(a){d.done(alp.filterIn({poiId:e.poiId,address:g?a.data.title||a.data.name:e.address,geo_xy:c(f?alp.data.ooi_geometry(a.data):e)},""))}function c(a){return{x:a.lng,
y:a.lat}}var d=alp.dfrd("_TEL_complete_initFromTo");if(a){var e=alp.oCopy("string"!==typeof a?a:alp.arr2o(alp.map(a.split(","),'v=v.split(":"),[v[0],decodeURIComponent(v[1])]'),"0","1"));e.lat&&(e.lat=parseFloat(e.lat));e.lng&&(e.lng=parseFloat(e.lng));alp.oCheckScheme(e,'"string" === typeof (v.poiId || 0)  || alp.and([v.lat,v.lng],alp.isFiniteNumber)');var f=!alp.isFiniteNumber(e.lat),g=e.poiId&&"string"!==typeof e.address;f||g?((this.proj||0).substring.call.a,(new alp.data.SingleOOI(e.poiId,{proj:this.proj})).load(b)):
d.done(alp.filterIn({poiId:e.poiId,address:e.address,geo_xy:c(e)},""))}else d.done();return d}var e=alp._gmap2_3,d=e.geojson,b=e.digitize,c=alp.maps;k=alp.util;b.DATATYPE_NAME();alp.declare("alp._gmap2_3.TourEditLayer",k.PublicEh,alp.nowF(function(a){alp.mixCheck(this,a);a=this._={map_st:this.mapSt=new alp.State};a.map_st.change_cb("_on_map_change",this);null==this.ovmtcoll&&(this.ovmtcoll=e.util.createOvmtcoll({slope_overlay:!0,skiresort_overlay:!0}));this.undoLength=new alp.MinMaxState({min:0,max:Infinity});
this.redoLength=new alp.MinMaxState({min:0,max:Infinity});this.addEvent("datatypeChange");this.addEvent("modeChange");this.addEvent("geomChange");this.addEvent("attrChange");this.addEvent("durationChange");this.addEvent("elevationChange");a.map2d=alp.mapany();a.d_eh=new alp.Eh}),k.InterfaceWithInit,{own_css:!0,ovmtcoll:null,initData:null,initFrom:null,initTo:null,proj:null,formField:null,datatypeList:"hikingTourTrail,longDistanceHikingTrail,cycling,longDistanceCyclingTrack,transalpMountainbiking",
extension:null,datatypeInit:null,datatype_cfg:null,datatype_do_not_create_dom:!1,datatype_node_select:null,datatype_img_select:null,datatype_from_dom:!1,datatype_hidden_id:null,datatype_hidden_name:null,default_routingengine:null,tourDurationV_q:null,tourDurationH_q:null,tourDurationM_q:null,factAscent_q:null,factDescent_q:null,factHighest_q:null,factLowest_q:null,elproCont_q:null,elproCanvas_q:null,elproLegendHeight_q:null,elproLegendDistance_q:null,elproClipping_q:null,elproClippingLeft_q:null,
elproClippingRight_q:null,linrefEdit_profileNode:null,linrefEdit_attrLegendNode:null,linrefEdit_attrLegendOptions:null,linrefEdit_withMapMarker:null,linrefEdit_withContextMenu:null,multigeocoder_scroll_cont:null,mapPadding:null,initialState:null,withDigitizeToolbar:!0,roadbookRouting:!1,new_geocoder_alwaysPointGeometry:!1,new_geocoder_autocomplete_mix:["alp.data.AutoCompleteWhereAlpstein","alp.data.AutoCompleteWherePhoton"],new_geocoder_autocomplete_opts:{subset:null,displayResultSnippets:!0},m_routing_source_set:null,
onDatatypeChange:null,onModeChange:null,onGeomChange:null,onAttrChange:null,onDurationChange:null,onElevationChange:null,getMap:function(){return this._.map_st.get()},setMap:function(a){this._.map_st.setNow(a)},getActivityObject:function(a){return alp.m(alp.opt(this._current_d(),"datatype_selector"),"getEntry",a)},getDatatypeCfg:function(){return alp.oCopy(this.datatype_cfg||alp.oGet(this._current_d(),"config.datatype_cfg"))},getDerivedValues:function(){return alp.m(this._current_d(),"getDerivedValues")},
getLength:function(){return alp.m(this._current_d(),"getLength")},getNodeCount:function(){return alp.m(this._current_d(),"getNodeCount")},getData:function(){return alp.m(this._current_d(),"currentJson")},setData:alp.nowF(function(a,b){a?(a=d.fix_datatype_name(a),alp.m(this._current_d(),"update",a,b&&b.save_as_original,b)):alp.m(this._current_d(),"clearGeometry");this.triggerEvent("geomChange");this.triggerEvent("attrChange")}),hasChanged:function(){return alp.m(this._current_d(),"changed")},resize:function(){alp.m(this._current_d(),
"resize")},getDatatype:function(){return alp.m(alp.opt(alp.opt(this._current_d(),"state"),"datatype"),"get")},setDatatype:alp.nowF(function(a){return alp.m(alp.opt(alp.opt(this._current_d(),"state"),"datatype"),"set",a)}),getDatatypeId:function(){return alp.m(this._current_d(),"getDatatypeId")},setPace:alp.nowF(function(a){return alp.m(alp.opt(alp.opt(this._current_d(),"state"),"pace"),"set",a)}),getRoutingstyle:function(){return alp.m(alp.opt(alp.opt(this._current_d(),"state"),"routingstyle"),"get")},
setRoutingstyle:alp.nowF(function(a){return alp.m(alp.opt(alp.opt(this._current_d(),"state"),"routingstyle"),"set",a)}),closeLoop:alp.nowF(function(){return alp.m(this._current_d(),"closeLoop")}),appendNode:alp.nowF(function(a,b){"function"!==typeof a.lat&&(a=e.xy2latlng(a));return alp.m(this._current_d(),"appendNode",a,b)}),autoInsertNode:alp.nowF(function(a,b){"function"!==typeof a.lat&&(a=e.xy2latlng(a));return alp.m(this._current_d(),"autoInsertNode",a,b)}),clearGeometry:alp.nowF(function(){return alp.m(this._current_d(),
"clearGeometry")}),deleteNodes:alp.nowF(function(a,b){return alp.m(this._current_d(),"deleteNodes",a,b)}),setGeoInfo:alp.nowF(function(a,b){return alp.m(this._current_d(),"setGeoInfo",a,b)}),undo:alp.nowF(function(){return alp.m(this._current_d(),"undo")}),redo:alp.nowF(function(){return alp.m(this._current_d(),"redo")}),startExtending:alp.nowF(function(a){return alp.m(this._current_d(),"startExtending",a)}),startLinrefEdit:alp.nowF(function(){return alp.m(this._current_d(),"startLinrefEdit")}),startBulkEdit:alp.nowF(function(){return alp.m(this._current_d(),
"startBulkEdit")}),whenLoaded:alp.nowF(k.InterfaceWithInit.whenLoaded),_on_map_change:alp.nowF(function(a,b){b&&this._digitizor(b).visible.set(!1);a&&this._digitizor(a).visible.set(!0);alp.m(this.ovmtcoll,"setMap",a)}),_digitizor:alp.nowF(function(a){function b(){function b(a){var b=alp.oGet(a,[0,0]),d=alp.oGet(a,[1,0]);if(b||d){var f={};a=[];b&&(f[0]=b,a.push({lat:b.geo_xy.y,lng:b.geo_xy.x}));d&&(f[1]=d,a.push({lat:d.geo_xy.y,lng:d.geo_xy.x}));k.setGeoInfo(f);var g=k.getMap();if(b=alp.m(g,"getDiv")){a=
c.bounds(a);var h=c.bounds2zoomcenter(a,b);setTimeout(function(){e.setView(g,h.center,h.zoom)},1234)}}k.startExtending(!0)}k.initData=d.fix_datatype_name(k.initData);k.initFrom=g(k.initFrom,"from");k.initTo=g(k.initTo,"to");if(k.initData&&(k.initFrom||k.initTo))throw Error("Either `initData` or `initFrom/To` but not both! #11141");r.map2d.set(a,n=new e.digitize.simple(a,k._digitizor_options(a)));n.init();null==k.initData||k.initFrom||k.initTo?(k.initFrom||k.initTo)&&alp.gatherDfrd(alp.map([k.initFrom,
k.initTo],f,k)).thenSoon(b):(k.setData(k.initData),k.startExtending(!0))}if(!a)throw Error("alp._gmap2_3.TourEditLayer._digitizor: found a bug!");var k=this,r=k._,n=r.map2d.get(a);n||(alp.now(b),r.d_eh.clear(),r.d_eh.push(n.state.datatype.change_cb("triggerEvent",k,"datatypeChange")),r.d_eh.push(n.state.editMode.change_cb_init(alp.bindF(h,null,k))),r.d_eh.push(n.geomChangeEvt().then(alp.ratelimitF(133,function(){k.triggerEvent("geomChange")}))),r.d_eh.push(n.attrChangeEvt().then(alp.ratelimitF(133,
function(){k.triggerEvent("attrChange")}))),r.d_eh.push(n.durationChangeEvt().then(alp.ratelimitF(133,function(){k.triggerEvent("durationChange")}))),r.d_eh.push(n.elevationChangeEvt().then(alp.ratelimitF(133,function(){k.triggerEvent("elevationChange")}))),r.d_eh.push(n.undoLength.bind_to(k.undoLength)),r.d_eh.push(n.redoLength.bind_to(k.redoLength)));return n}),_current_d:function(){var a=this.getMap();return alp._tel_d=a&&this._digitizor(a)},_digitizor_options:function(a){return alp.oCreateMix(this,
{alp_map:a,datatype_arr:this.datatypeList,datatype_init:alp.opt(this.initData,b.DATATYPE_NAME())||this.datatypeInit||alp.oGet(this,"datatype_cfg._default"),routingstyle_init:alp.opt(this.initData,b.ROUTINGSTYLE())||this.routingstyleInit,pace_init:alp.opt(this.initData,b.PACE())||this.paceInit})}})});"undefined"!==typeof dojo&&dojo.provide("alp.data.api.tour");
(function(){function k(g){return alp.util.json.stringify({category:{id:g.categoryid},title:g.title,geoJson:g.geoJsonStr})}var h=alp.sub("alp.data.api",null,!0);h.tourCreate=function(g,f){(g.proj||null).substring.call.a;(g.token||null).substring.call.a;(g.categoryid||null).substring.call.a;g.title.substring.call.a;(g.geoJsonStr||null).substring.call.a;return alp.xhrPut(alp.cfg.url.api_write_tour_create(g),{sendData:k(g),receiveJson:!0})};h.tourDelete=function(g,f){(g.proj||null).substring.call.a;(g.token||
null).substring.call.a;(g.tourid||null).substring.call.a;return alp.xhrDelete(alp.cfg.url.api_write_tour_delete(g),{receiveJson:!0})};h.tourUpdate=function(g,f){(g.proj||null).substring.call.a;(g.token||null).substring.call.a;(g.tourid||null).substring.call.a;(g.categoryid||null).substring.call.a;g.title.substring.call.a;(g.geoJsonStr||null).substring.call.a;return alp.xhrPost(alp.cfg.url.api_write_tour_update(g),{sendData:k(g),receiveJson:!0})};h.tourUpdateImagesOnly=function(g,f){(g.proj||null).substring.call.a;
(g.token||null).substring.call.a;(g.tourid||null).substring.call.a;(g.images.image||null).splice.call.a;return alp.xhrPost(alp.cfg.url.api_write_tour_update(g),{sendData:alp.util.json.stringify({images:h.imageFixAuthorSource(g.images)}),receiveJson:!0})}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.i_tew_actions");
(function(){function k(){var a=this._json_outnode;a&&alp.sA(a,"value",a.value=this.kx.tel.getData()||"")}function h(a){var b=this;b.save_tour().thenSoon(function(c,d,e,f){b._gpx_dialog.tourid=f;b._gpx_dialog.original=a;b._gpx_dialog.login_open_dialog=alp.bindF("login_open_dialog",b,{tourEditor:!0,tourid:f,token:d,context:"tourplanner",type:"TEW:DIALOG:GPX",opt_user_info:e});b._gpx_dialog.openModalwinOrLogin()})}function g(a){function b(b,c){var e=a.m.id.get();alp.and([a.proj,b,c,e],"(v || null).substring.call.a");
d.tourUpdateImagesOnly({proj:a.proj,userid:b,token:c,tourid:e,images:{image:f}},{throwError:!1}).thenSoon(alp.bindF("triggerSoon",k))}var f=alp.map(a.kx.ifm_img.m.files.get(),"this.format_image_or_video_2_api_obj( v )",e),g=f.length,h=a[c],k=alp.dfrd("_i_tew_saveMedia");a[c]=g;return g||g!==h?a.dfrd_userid_token().thenSoon(b):k.triggerSoon(),k}var f=alp.sub("alp._gmap2_3.x",null,!0),e=alp.data,d=e.api,b=alp.dom;f.InterfaceTourEditWizardActions={connectView2ModelActions:function(a,b,c,d){b.push(alp.aEL(a._actionNextArr,
"click",alp.nowF("_actionNext",this)))},connectPureViewActions:function(a,b,c,d){function e(b){alp.setClass(a._actionSaveArr,a.disabledClass,!0);k.call(a,b);a._actionSave(b)}function f(b){alp.setClass(a._actionSaveArr,a.disabledClass,!0);k.call(a,b);a._actionSaveExisting(b)}b.push(alp.aEL(a._actionDeleteArr,"click",alp.nowF("_actionDelete",this)));b.push(alp.aEL(a._actionGpxArr,"click",alp.nowF("_actionGpx",this)));b.push(alp.aEL(a._actionGpxOrigArr,"click",alp.nowF("_actionGpxOrig",this)));b.push(alp.aEL(a._actionKmlArr,
"click",alp.nowF("_actionKml",this)));b.push(alp.aEL(a._actionPrintArr,"click",alp.nowF("_actionPrint",this)));a.usecase_newtour?b.push(alp.aEL(a._actionSaveArr,"click",alp.nowF(e))):b.push(alp.aEL(a._actionSaveArr,"click",alp.nowF(f)));a.login_indicator?(a._gpx_dialog=alp.view.dialog.gpx.init({node:a._actionGpxArr.concat(a._actionGpxOrigArr),template:alp.gEBCN(oax.GPX_DIALOG)[0],login_indicator:alp.bindF("login_indicator",a),login_after:alp.bindF(a.login_after,null,{type:"TEW:DIALOG:GPX"})}),a._gpx_dialog.openModalwinAfterLogin(alp.nowF("_actionGpx",
this)),a._kml_dialog=alp.view.dialog.kml.init({node:a._actionKmlArr,template:alp.gEBCN(oax.KML_DIALOG)[0],login_indicator:alp.bindF("login_indicator",a),login_after:alp.bindF(a.login_after,null,{type:"TEW:DIALOG:KML"})}),a._kml_dialog.openModalwinAfterLogin(alp.nowF("_actionKml",this)),a._pdf_dialog=alp.view.dialog.print.init({node:a._actionPrintArr,login_indicator:alp.bindF("login_indicator",a),login_after:alp.bindF(a.login_after,null,{type:"TEW:DIALOG:PDF"})}),a._pdf_dialog.openModalwinAfterLogin(alp.nowF("_actionPrint",
this))):console.error("tour_edit_wizard: no login_indicator => no support for login, save etc.")},_actionDelete:function(){confirm(alp.opt(this._confirmDeleteFirst,"innerHTML")||"Do you really want to delete the geometry?")&&this.kx.tel.clearGeometry()},_actionGpx:alp.bindF(h,null,!1),_actionGpxOrig:alp.bindF(h,null,!0),_actionKml:function(){var a=this;a.save_tour().thenSoon(function(b,c,d,e){a._kml_dialog.tourid=e;a._kml_dialog.login_open_dialog=alp.bindF("login_open_dialog",a,{tourEditor:!0,tourid:e,
token:c,context:"tourplanner",type:"TEW:DIALOG:KML",opt_user_info:d});a._kml_dialog.openModalwinOrLogin()})},_actionPrint:function(){var a=this.usecase_newtour?550:850,b=this;b.save_tour().thenSoon(function(c,d,e,f){c=alp.nodify(oax.PDF_DIALOG);var g=alp.gEBCN("oax-hidden-pdf-wait-dialog")[0];g&&!alp.gEBCN("oax-wait-dialog",c)[0]&&(g=alp.cE("div",null,null,{innerHTML:g.innerHTML}),alp.aC(c,g));(g=alp.gEBCN("oax-hidden-pdf-ready-dialog")[0])&&!alp.gEBCN("oax-ready-dialog",c)[0]&&(g=alp.cE("div",null,
null,{innerHTML:g.innerHTML}),alp.aC(c,g));b._pdf_dialog.template=c;b._pdf_dialog.height=480;b._pdf_dialog.width=a;b._pdf_dialog.tourid=f;b._pdf_dialog.login_open_dialog=alp.bindF("login_open_dialog",b,{tourEditor:!0,tourid:f,token:d,context:"tourplanner",type:"TEW:DIALOG:PDF",opt_user_info:e});b._pdf_dialog.openModalwinOrLogin()})},_actionSave:function(){var a=this;a.save_tour().thenSoon(function(c,d,e,f){alp.setClass(a._actionSaveArr,a.disabledClass,!1);c=(c=(c=alp.gEBCN("alp-tpwiz-editurl-tmpl")[0])&&
c.value)&&c.replace(/###tourid###/g,"${tourid}");c=alp.tmpl(c,{tourid:f});a.login_indicator()?(b.windowExitInterceptClearAll(),location.href=c):a.login_open_dialog({tourEditor:!0,tourid:f,token:d,context:"tourplanner",opt_user_info:e})})},_actionSaveExisting:function(a){var c=this;(new alp.x.Waitbox({targetInit:alp.body()})).startWait();c.kx.ifm_img.m.filesModified.get()?(alp.stopEvent(a||window.event),g(c).thenSoon(function(){var a=alp.gEBCN("alp-tpwiz-nexturl")[0];a&&a.value&&(a.value=a.value+"#tptab="+
c.m.tabShowed.get());b.windowExitInterceptClearAll();c._form.submit()})):(alp.stopEvent(a||window.event),(a=alp.gEBCN("alp-tpwiz-nexturl")[0])&&a.value&&(a.value=a.value+"#tptab="+c.m.tabShowed.get()),b.windowExitInterceptClearAll(),c._form.submit())},_actionNext:function(a){this.m.tabShowed.is(oax.TP_TAB_SHORT)&&!this.m.publishable.get()?(alp.stopEvent(a||window.event),this._alert("alertUnpublishableOnNext")):(a=alp.lastIndexOf(oax.TABARR_TP,this.m.tabShowed.get()),-1<a&&this.m.tabShowed.set(oax.TABARR_TP[1+
a]))}};var c="_i_tew_lastSavedImages_lastLength"})();"undefined"!==typeof dojo&&dojo.provide("alp.data.api.evaluate_user");(function(){alp.sub("alp.data.api",null,!0).evaluateUser=function(){return alp.xhrGet(alp.cfg.url.api_evaluateUser(),{receiveJson:!0})}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.i_tew_user_tour");
(function(){function k(b){function c(a){b[d].triggerSoon(e,a,{isTemporary:!1})}function a(a){var c=a.responseJson.user;b[d].triggerSoon(c,a.responseJson.token,{isTemporary:!0,temp_userid:c,temp_accountid:a.responseJson.account})}if(!b[d])if(b[d]=alp.dfrd("iTEW_get_userid_token"),alp.m(b,"login_indicator")){var e=b.login_get_userid();(e||null).substring.call.a;f.token().thenSoon(c)}else f.evaluateUser().thenSoon(a);return b[d]}function h(b,c,a){(c||null).substring.call.a;(a||null).substring.call.a;
var d=b.m.id.get(),e=b.m.title_out.get(),g=b.kx.tel.getData(),h=b.kx.tel.getDatatypeId(),k=b.proj;(g||null).substring.call.a;(h||null).substring.call.a;(k||null).substring.call.a;var p=alp.dfrd("_iTEW_save_tour_impl");f[d?"tourUpdate":"tourCreate"]({proj:k,categoryid:h,userid:c,token:a,tourid:d,title:e,geoJsonStr:g}).thenSoon(function(a){console.log("xxx iTEW_dfrd_save_tour_hidden_finish",a);a=a.responseJson.id;(a||null).substring.call.a;b.m.id.setNow(a);p.triggerSoon(a)});return p}var g=alp.sub("alp._gmap2_3.x",
null,!0),f=alp.data.api;g.InterfaceTourEditWizardUserTour={login_indicator:null,login_open_dialog:null,login_get_userid:null,login_after:null,clear_tour:function(){this[e]=null},clear_user:function(){this[d]=null},save_tour:alp.nowF(function(){var b=alp.dfrd("iTEW_save_tour"),c=this;k(c).thenSoon(function(a,d,e){(a||null).substring.call.a;(d||null).substring.call.a;c.kx.tel.whenLoaded(function(){h(c,a,d).thenSoon(alp.bindF("triggerSoon",b,a,d,e))})});return b}),dfrd_userid_token:function(){return k(this)}};
var e="_iTEW_dfrd_tourid",d="_iTEW_dfrd_userid_token"})();"undefined"!==typeof dojo&&dojo.provide("alp.dom.iframe_upload");
(function(){alp.sub("alp.dom",null,!0).iframe_upload=function(h){var g=h.form;g="string"===typeof g?document.forms[g]:g;/^form$/i.test(g.tagName)&&g.childNodes.a;var f=h.receiveJson||!1,e=alp.dfrd("ADOM:iframe_upload",{then:1}),d=++k,b=alp.cE("iframe",alp.body(),{src:"about:blank",style:"visibility: hidden; position: absolute; top: 0; left: 0; width: 1px; height: 1px;",name:"alp_dom_iframe_upload",id:"alp_dom_iframe_upload"});alp.sA(b,"onload","alp.dom.iframe_upload._receive["+d+"]();");alp.oSet(alp.dom.iframe_upload,
["_receive",d],alp.nowF(function(){if(d===k){var c=alp.sTrim(b.contentWindow.document.getElementsByTagName("textarea")[0].value||"");e.done(f?alp.oFrom(c):c)}alp.orphan(b)}));(h=g.getAttributeNode("target"))?alp.setProp(h,"value","alp_dom_iframe_upload"):alp.sA(g,"target","alp_dom_iframe_upload");g.target="alp_dom_iframe_upload";g.submit();return e};var k=0})();"undefined"!==typeof dojo&&dojo.provide("alp.x.input_number");
(function(){function k(c){function e(){c[g]();c[a]=setTimeout(e,c.polyfillRepeatLater)}null!=c[a]&&(clearTimeout(c[a]),c[a]=null);var f=c.m._pressed.get();if(f!==d){var g=f===b?"stepUp":"stepDown";c[g]();c[a]=setTimeout(e,c.polyfillRepeatFirst)}}function h(a,e){e||(e=window.event);var f=alp.gBCR(a.node);a.m._pressed.set(e.clientX<f.right-a.polyfillWidth?d:e.clientY<f.top+a.node.clientTop+a.node.clientHeight/2?b:c);a.m._pressed.is(d)||(alp.stopEvent(e),a.node.focus())}function g(a,b){a.m._pressed.is(d)}
function f(a,b){a.m._pressed.set(d)}function e(a,b){a.m._pressed.set(d)}alp.ensureCss(alp.cssBase()+"alp/x.css");alp.x.inputNumberMany=function(a,b){a=alp.map("string"===typeof a?alp.gEBCN(a,b&&b.cont):a,"new alp.x.InputNumber( alp.oCreateMix( this, { node : v } ) )",alp.oCreateMix({initNow:!0},b));alp.forEach(a,"arr[v.node.name]=v; arr[v.node.id]=v;");return a};alp.declare("alp.x.InputNumber",alp.x.AbstractController,null,{node:null,min:null,max:null,step:null,value:null,polyfillClass:"alp-x-input-number-polyfill",
polyfillWidth:15,polyfillClassUp:"alp-x-input-number-up",polyfillClassDown:"alp-x-input-number-down",polyfillRepeatFirst:666,polyfillRepeatLater:96,stepUp:function(){this.m.number.stepUpNow()},stepDown:function(){this.m.number.stepDownNow()},augmentModel:function(a){alp.forEach(["min","max","step","value"],'this["_" + v] = parseFloat( (this[v] != null  ?  this[v]+""  :  alp.gA( this.node, v )).replace( ",", "." ) )',this);a.number=new alp.MinMaxState({min:this._min,max:this._max,init_value:this._value,
step:this._step});this._supportsInputNumber=alp.supportsInputNumber();this._useComma=alp.i18n.useComma();this._supportsInputNumber||(a._pressed=alp.modeStateFromArr([d,b,c],{init_value:d}))},augmentKids:function(a){alp.setClass(this.node,this.polyfillClass,!this._supportsInputNumber)},connectModel2Model:function(a,b,c,d){a._supportsInputNumber||b.push(c._pressed.change_cb_init(k,null,a))},connectModel2View:function(a,d,e,f){function g(){alp.setClass(a.node,[[a.polyfillClassUp,a.m._pressed.is(b)],
[a.polyfillClassDown,a.m._pressed.is(c)]]);try{0<window.getSelection().rangeCount&&0<window.getSelection().getRangeAt(0).getClientRects.length&&(a.node.selectionStart=a.node.selectionEnd)}catch(p){console.error("alp.x.InputNumber: failure (Edge?) see also trac#13396")}}d.push(e.number.change_cb_init(function(){var b=e.number.get();a._supportsInputNumber?a.node.valueAsNumber=b:(b=""+b,a._useComma&&(b=b.replace(".",",")),a.node.value=b)}));a._supportsInputNumber||d.push(e._pressed.change_cb_init(g))},
connectView2Model:function(a,b,c,d){function k(b){b||(b=window.event);alp.stopEvent(b);a[0<b.wheelDelta?"stepUp":"stepDown"]()}b.push(alp.aEL(a.node,"change",function(){c.number.setNow(a._supportsInputNumber?a.node.valueAsNumber:parseFloat(a.node.value.replace(",",".")))}));a._supportsInputNumber||(b.push(alp.aEL(a.node,"mousewheel",k)),b.push(alp.aEL(a.node,"mousedown",alp.bindF(alp.nowF(h),null,a))),b.push(alp.aEL(a.node,"mousemove",alp.bindF(alp.nowF(g),null,a))),b.push(alp.aEL(a.node,"mouseout",
alp.bindF(alp.nowF(f),null,a))),b.push(alp.aEL(a.node,"mouseup",alp.bindF(alp.nowF(e),null,a))))}});var d="none",b="up",c="down",a="_pressed_h"})();"undefined"!==typeof dojo&&dojo.provide("alp.x.url_hash");
(function(){function k(){c=Date.now?Date.now():+new Date}function h(){return c&&!(1E3<(Date.now?Date.now():+new Date)-c)}function g(){var a=/[#&]\w+=\d+([\.,]\d+)+/g;return new alp.x.AbstractController({initNow:!0,augmentModel:function(a){a.urlObj=new alp.ObjectState({init_value:e.s2o()})},connectModel2View:function(b,c,d,f){var g=alp.ratelimitF(357,function(){var b=e.o2s(d.urlObj.get()),c=(location.hash||"#").substring(1),f=(b||"#").substring(1);f!==c&&(c.replace(a,"")===f.replace(a,"")&&alp.supportsHistory()?
history.replaceState({},"",location.href.split("#")[0]+b):location.hash=b,k())});c.push(d.urlObj.change_cb(function(){k();setTimeout(g,0)}))},connectView2Model:function(a,b,c,d){b.push(setInterval(alp.nowF(function(){h()||c.urlObj.set(e.s2o())}),345),clearInterval)}})}var f=alp.sub("alp.x.url_hash",null,!0),e=alp.util.url_hash;b||(b=g());var d=b.m.urlObj;f.BOOL_CONSTRAINT={constrain_url2model:alp.f("v  &&  v.match(/(?:t|true|1)/)?1:0"),constrain_model2url:alp.f("?1:0")};f.bind_key_to_state=alp.nowF(function(a,
b,c){function e(){k();var e=c.model_subkey?b.get_property(c.model_subkey):b.get();e=f(e);var g=f(m(!0),!0);e!==g&&d.set_property(a,e)}function f(a,c){return c&&null==a?a:""+(t?t(a,b):null==a?"":a)}function g(){h()?setTimeout(g,123):l()}function l(){var a=m();c.model_subkey?alp.m(b,["set_flex_now","set_flex"],c.model_subkey,a):alp.m(b,["setNow","set"],a)}function m(c){var e=d.get_property(a);return c&&null==e?e:w?w(e,b):e}c||(c={});c=alp.mixCheck({constrain_model2url:null,constrain_url2model:null,
eh:null,model_subkey:null},c);var u=c.eh,t=c.constrain_model2url,w=c.constrain_url2model;l();b.change_cb?alp.m(u,["push","eh_push"],b.change_cb(e)):alp.m(u,["push","eh_push"],b.changed_cb(alp.nowF(e)));alp.m(u,["push","eh_push"],d.change_cb(g))});f.change_cb=alp.bindF("change_cb",d);f.change_cb_init=alp.bindF("change_cb_init",d);f.get=alp.bindF("get",d);f.get_property=alp.bindF("get_property",d);f.set_constrain=alp.nowF(function(a){k();d.constrain_def=a});f.set_constrain_key_list=alp.nowF(function(a){if("object"!==
typeof a)throw Error("AXUH_set_constrain_key_list(): key_list must be an array!");k();d.constrain_def=function(b){return alp.opt(b,a,!0)}});f.set_flex=alp.nowF(function(a,b){k();d.set_flex.apply(d,arguments)});f.changed_cb=alp.nowF("change_cb",f);f.changed_cb_init=alp.nowF("change_cb_init",f);var b,c})();"undefined"!==typeof dojo&&dojo.provide("alp.tinymce");
(function(){var k=alp.sub("alp.tinymce",null,!0);k.createMany=function(h,g){return alp.map(alp.gEBCN(g||"mceEditor"),function(f){function e(a){return a in c?"":a}var d=alp.oFrom(alp.opt(alp.dataset(f),"oaTinyopt")||"{}"),b=f.parentNode&&alp.nodify("oa-tinymceopt",f.parentNode);b=b&&alp.oFrom(b.value||"{}");b=alp.oCreateMix(b,d);d=alp.oCreateMix(h,b);var c=b.oaToolbarRemove;b=b.oaToolbarAdd;c&&(d.toolbar=d.toolbar.replace(/\b\w+\b/g,e),d.contextmenu&&(d.contextmenu=d.contextmenu.replace(/\b\w+\b/g,
e)));if(b){var a=d.toolbar.split(/\s+/);a=alp.arr2oSimple(a);b=alp.filter(b,"!(v in this)",a);b.length&&(d.toolbar+=(/|\s*$/.test(d.toolbar)?"":" | ")+b.join(" | "))}b=f.id;d=tinyMCE.createEditor(b,alp.mix({},d));d.render();return{node:f,id:b,ed:d}})};k.paste_preprocess_remove_all_tags=function(h,g){h=g.content;console.log("xxx ____ IN: paste_preprocess: ",h);h=h.replace(/<\/?(?:b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|time|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)\b[^>]*>/gi,
"");h=h.replace(/<[^\/][^>]*>/gi,"<p>");h=h.replace(/<\/[^>]+>/gi,"</p>");h=alp.cE("div",null,null,{innerHTML:h});for(var f;f=h.lastChild,!alp.sTrim(alp.textContent(f));)alp.rC(h,f);console.log("xxx ____ out: paste_preprocess: ",h.innerHTML);g.content=h.innerHTML}})();"undefined"!==typeof dojo&&dojo.provide("alp._gmap2_3.x.tour_edit_wizard");
(function(){function k(){alp.m(this.kx.tel,"resize")}function h(a,b){null==b&&(b=alp.opt(a._actobj[a.m.activity.get()],"index"));return alp.oGet(a._actarr,[b,"title"])}function g(a,b){a=alp.gEBCN("alp-tpwiz-gpx-hidden-info-dialog")[0];J.open({html:a.innerHTML,height:420,width:400,onOpenNow:function(a,b,c){var d=alp.gEBI("alp-tpwiz-gpx-removeNoice",a),e=alp.gEBCN("alp-tpwiz-gpx-upload-removeNoices")[0];d.checked="true"===e.value;alp.aEL(d,"change",function(){e.value=d.checked})}})}function f(a,b){alp.stopEvent(b||
window.event);B.iframe_upload({form:a._gpxUploadFormArr[0]}).then(function(b){b?(a.kx.tel.setData(b,{save_as_original:!0}),a.kx.tel.startExtending(!0),a.m.gpxupload.set(!1),b=a._gpxUploadDoneInfoFirst):b=a._gpxUploadFailedInfoFirst;(b=b&&alp.sTrim(b.innerHTML))&&alp.humane(b)})}function e(a){var b=a.m.map.get(),c=alp.m(b,"getDiv");c=c&&alp.gBCR(c);var d=a[M];c&&0<c.width&&0<c.height&&(!d||c.width!==d.width||c.height!==d.height)&&(a[M]=c,z.event("trigger")(b,"resize"))}function d(a,c,d,e){var f=(a.kx.monthCB||
(a.kx.monthCB={m:{}})).m[c]=new alp.BoolState({init_value:d});b(a,c,d,e);return f}function b(a,b,c,d){c?alp.sA(d.originalNode,"value","on"):alp.rA(d.originalNode,"value");a.kx.allSeasonCB&&(b=alp.oValues(alp.mapIn(a.kx.monthCB.m,".get()")),alp.and(b)?a.kx.allSeasonCB.m.is.setNow(!0):alp.or(b)||a.kx.allSeasonCB.m.is.setNow(!1))}function c(a,b,c,d){b=new alp.BoolState({init_value:c});a.kx.allSeasonCB={m:{is:b}};return b}function a(a,b,c,d){alp.forIn(a.kx.monthCB.m,".setNow("+c+")")}function m(a,b,c,
d){}function l(a,b,c,d){}function r(a,b){function c(a){a=f();if(a===k||a===l)b.setContent(""),b.getBody().style.color="inherit";b.focus();b.execCommand("mceAutoResize",function(a){})}function d(a){0==f().length&&(b.setContent(k),l=f()||k,b.getBody().style.color="#999999",b.getElement().value="")}function e(){if(b.initialized){var c=f(),d=b.getElement(),g=alp.gA(d,"id").split(".")[1],h=g&&alp.gEBI(g);g=g&&"cms."+g;c=c==k||c===l?"":c;x(d,c);h&&(x(h,c),g!==alp.gA(h,"name")&&alp.sA(h,"name",g));var p=
null;d.className.replace(/(?:^|\s)alp-tpwiz-(\w+?)(?=\s|$)/g,function(b,c){p||(p=a.m[c+"_in"])});p?p.setNow(c):a.m.other_text_change.setNow(alp.or(m.map(function(a,b){return a!==n(b.value)})))}else setTimeout(e,100)}function f(){var a=/\blink\b/i.test(b.settings.toolbar)||/\blink\b/i.test(b.settings.contextmenu);return n(b.getContent(),{link_permitted:a})}function g(){null!=p&&(clearInterval(p),p=null)}var h=b.getElement(),k=n(alp.gA(h,"placeholder")),l=k;alp.gEBI(b.id);var m=a[R]||(a[R]=alp.mapany());
(function(){var a=b.getElement();m.setNow(a,n(a.value||""));k&&(b.on("init",d),b.on("blur",d),b.on("focus",c))})();b.on("change",e);e();b.on("focus",function(){g();p=setInterval(function(){var c=b.getContent();c!==a&&(a=c,e())},357);var a});b.on("blur",g);var p}function n(a,b){function c(a){var b,c=b=alp.gA(a,"href");/^\/\//.test(c)&&(c="http:"+c);/^\w+?:/i.test(c)||(c=!/\//.test(c)&&/@/.test(c)?"mailto:"+c:"http://"+c);c=c.replace(/^http:\/\/mailto:/i,"mailto:");c!==b&&alp.sA(a,"href",c)}if(!a||
"string"!==typeof a)return a;b=b&&b.link_permitted;a=a.replace(/^<p>(.*)<\/p>$/,"$1").replace(/<p>([\s\r\n]|&nbsp;)*<\/p>/g,"").replace(/(?:^([\s\r\n]|&nbsp;)+|([\s\r\n]|&nbsp;)+$)/g,"").replace(/<\/?(i|em)>/gi,"");S.innerHTML=a;q(S);b?alp.forEach(alp.gEBTN("a",S),c):alp.forEach(Array.apply(null,alp.gEBTN("a",S)),"alp.orphan(v)");return S.innerHTML}function q(a){if(a&&a.attributes&&a.attributes.item&&a.removeAttributeNode)for(var b;b=a.attributes.item(a.attributes.length||0);)a.removeAttributeNode(b);
a&&a.childNodes&&alp.forEach(a.childNodes,q)}function p(a){var b=a.m.publishable.get();b||alp.m(a&&alp.oGet(a,"kx.radioGroup_publishTour.m.modeState"),"set","0");alp.setClass(a.contNode,[[a.publishableYes,b],[a.publishableNo,!b]]);alp.setClass(a._publishCont1Arr,a.radioDisabledClass,!b)}function v(a){a.kx.tel.startExtending(!a.m.manual.get())}function u(a){function b(){c===a.m.bulkEditVisible.get()&&alp.setClass(a._bulkEditContArr,oax.NO_DISPLAY,!c)}var c=a.m.bulkEditVisible.get();c?setTimeout(b,
357):b()}function t(a){var b=a.m.bulkEdit.get();alp.setClass(a._bulkEditBtnArr,a.bulkEditSelectedClass,b);b?a.kx.tel.startBulkEdit():v(a)}function w(a,b){function c(){var b=alp.gEBCN("alp-tpwiz-hidden-linref-cancel-check-dialog")[0];J.open({html:b.innerHTML,height:180,width:380,onOpenNow:function(b,c,d){c=alp.gEBCN("alp-tpwiz-linref-edit-drop",b);b=alp.gEBCN("alp-tpwiz-linref-edit-further",b);alp.aEL(c,"click",alp.nowF(function(){w(a,!0);J.close(d);f.triggerSoon({linrefEditCancelled:!0})}));alp.aEL(b,
"click",alp.nowF(function(){J.close(d);f.triggerSoon({linrefEditCancelled:!1})}))}})}var d=a.m,e=a.kx,f=alp.dfrd("_TEW_linrefEditCancel");if(a[F]&&a[D])if(b||"undefined"===typeof oax)e.tel.setData(a[F]);else return c(),f;d.linrefEdit.setNow(!1);f.triggerSoon({linrefEditCancelled:!0});return f}function x(a,b){b!==a.value&&(a.value=b)}function y(a){return alp.sTrim(a||"").replace(/\s*[\r\n]/g,"")}var z=alp._gmap2_3,A=z.geojson,C=z.digitize,E=alp.x.url_hash,G=alp.data,B=alp.dom,I=alp.tinymce,L=alp.i18n.unit,
J=alp.view.modalwin,P=alp.cfg.datatype(),H=/^new-tour$/i;alp.ensureCss(alp.cssBase()+"alp/x.css");alp.declare("alp._gmap2_3.x.TourEditWizard",alp.x.AbstractController,null,z.x.ConstElpro,z.x.InterfaceTourEditWizardActions,z.x.InterfaceTourEditWizardUserTour,{contNode:null,proj:null,elpro:"alp-tpwiz-elpro-subcont",form:"alp-tpwiz-form",initData:null,initFrom:null,initTo:null,roadbookRouting:!1,geocodeAlwaysPointGeometry:!1,usecase:"alp-tpwiz-hidden-use-case",formFieldSave:"alp-tpwiz-hidden-geom-save",
ovmtcoll:null,waitForCss:!0,default_activity:null,default_routingstyle:C.KSF_NETWORK(),default_pace:C.PACE_MEDIUM(),default_manual:!1,default_routingengine:null,bulkEditThreshold:0,bulkEditCont:"alp-tpwiz-waypoints",bulkEditBtn:"alp-tpwiz-waypoints-select",bulkEditSelectedClass:"alp-tpwiz-selected",activityHiddenId:"alp-tpwiz-hidden-datatype",activityHiddenName:"alp-tpwiz-hidden-datatypename",activityChangeAlert:"alp-tpwiz-activity-change-alert",activityChangeClass:"alp-tpwiz-activity-change",actsel:"alp-tpwiz-global-activity",
actselicon:"alp-tpwiz-global-activity-icon",acttitle:"alp-tpwiz-title-activity",title:"alp-tpwiz-title",shortdesc:"alp-tpwiz-shortdesc",undo:"alp-tpwiz-undo",redo:"alp-tpwiz-redo",routing:"alp-tpwiz-routing",manual:"alp-tpwiz-manual",inputNumberDurationMin:"alp-tpwiz-form-duration-min",inputNumberDurationMax:"alp-tpwiz-form-duration-max",selected:"alp-tpwiz-sel",contClassStepDonePrefix:"alp-tpwiz-stepdone-",contClassStepTodoPrefix:"alp-tpwiz-steptodo-",gpxactivate:"alp-tpwiz-activate-gpx-upload",
gpxleave:"alp-tpwiz-leave-gpx-upload",gpxUploadActive:"alp-tpwiz-gpx-upload-active",gpxUploadForm:"alp-tpwiz-gpx-upload",gpxUploadFile:"alp-tpwiz-gpx-file",gpxUploadCont:"alp-tpwiz-gpx-upload-cont",gpxUploadInfoBtn:"alp-tpwiz-gpx-upload-info",gpxUploadButton:"alp-tpwiz-gpx-upload-button",gpxUploadFileName:"alp-tpwiz-gpx-file-name",gpxUploadDoneInfo:"alp-tpwiz-bulk-edit-alert",gpxUploadFailedInfo:"alp-tpwiz-gpx-upload-failed-alert",actionDelete:"alp-tpwiz-action-delete",actionPrint:"alp-tpwiz-action-print",
actionGpx:"alp-tpwiz-action-gpx",actionGpxOrig:"alp-tpwiz-action-gpx-original",actionKml:"alp-tpwiz-action-kml",actionSave:"alp-tpwiz-save-button",actionNext:"alp-tpwiz-next-button",disabledClass:"oax_disabled",confirmDelete:"alp-tpwiz-action-delete-confirm",detailsCalcMinTime:"alp-tpwiz-calc-minTime",detailsCalcTourLength:"alp-tpwiz-calc-tourLength",detailsCalcTourLengthKm:"alp-tpwiz-calc-tourLengthKm",detailsCalcAscent:"alp-tpwiz-calc-ascent",detailsCalcDescent:"alp-tpwiz-calc-descent",imgCont:"alp-tpwiz-media-block",
imgToggle:"alp-tpwiz-in-images-toggle",imgInput:"alp-tpwiz-in-images-input",inputBtn:"alp-tpwiz-in-button",imgFiles:"alp-tpwiz-in-images-files",imgDisplay:"alp-tpwiz-in-images-display",publishableYes:"alp-tpwiz-publishable-yes",publishableNo:"alp-tpwiz-publishable-no",publishButton:"alp-tpwiz-publish-button",publishCont1:"alp-twiz-radiocont-publishTour-1",alertUnpublishableOnTabChange:"alp-tpwiz-unpublishable-alert-tabchange",alertUnpublishableOnPublish:"alp-tpwiz-unpublishable-alert-publish",alertUnpublishableOnNext:"alp-tpwiz-unpublishable-alert-next",
radioDisabledClass:"alp-tpwiz-disabled",activeButton:"alp-active",inactiveButton:"alp-inactive",contClassNoGeom:"alp-tpwiz-steptodo-tour",contClassHasGeom:"alp-tpwiz-stepdone-tour",inputConditionRatingClass:"alp-tpwiz-condition-rating",inputLandscapeRatingClass:"alp-tpwiz-landscape-rating",inputQualityOfExperienceRatingClass:"alp-tpwiz-qualityOfExperience-rating",inputRadio:"alp-tpwiz-radio-input",radioConnect:"alp-tpwiz-radio-connnect",inputTextSelectListenChange:["alp-tpwiz-input-listen-change",
"alp-tpwiz-select-input","alp-select-input"],externLeaveLinkCheckChange:B.gLinkToLeavePage,submitLeaveCheckChange:function(){return document.forms},outputTab:"alp-tpwiz-currenttab",allSeasonCB:"alp-tpwiz-all-season-checkbox",monthCB:"alp-tpwiz-season-checkbox",otherCB:"alp-checkbox-input",date:"alp-tpwiz-dayOfInspection-date-pick",dateIcon:"alp-tpwiz-dayOfInspection-date-icon",datePosition:"fixed",dateScrollContainer:"alp-tpwiz-detail-block",inputNumberClass:"alp-tpwiz-input-number",getMap:function(){return this.m.map.get()},
setMap:function(a){var b=this.m,c=b.change.get();b.map.setNow(a);b.change.setNow(c)},getOvmtColl:function(){return this.kx.tel.ovmtcoll},resize:k,augmentModel:function(a){var b=this;(b.proj||null).substring.call.a;b._initData=A.fix_datatype_name(b.initData);b.usecase_newtour=H.test(alp.opt(alp.nodify(b.usecase),"value"));a.map=new alp.State;a.id=new alp.StringState;a.activity=alp.modeStateFromArr(P._keys());a.activityObject=new alp.State;a.routingstyle=alp.modeStateFromArr(C.KSF_ARR());a.pace=alp.modeStateFromArr(C.PACE_ARR());
a.title_in=new alp.StringState;a.title_out=alp.oneWayCopyState(a.title_in,y);a.shortdesc_in=new alp.StringState;a.shortdesc_out=alp.oneWayCopyState(a.shortdesc_in,function(a){a=n(a);var c=n(b._shortdesc&&alp.gA(b._shortdesc,"placeholder")||"");return c&&a===c?"":a});a.publishable=alp.andState([a.title_out,a.shortdesc_out]);a.tel_vis=new alp.BoolState({init_value:!0});a.tel_vis_and_map=alp.andState([a.tel_vis,a.map]);a.linrefEdit=new alp.BoolState;a.manual=new alp.BoolState;a.gpxupload=new alp.BoolState;
a.bulkEditVisible=new alp.BoolState;a.bulkEdit=new alp.BoolState;a.tabShowed=new alp.ModeState({modeSet:oax.TABSET_TP,init_value:oax.TP_TAB_GEOM});E.bind_key_to_state("tptab",a.tabShowed);a.other_text_change=new alp.BoolState;a.change=new alp.BoolState;a.routing_source_set=new alp.ObjectState({init_value:{}})},augmentKids:function(e){alp.forEach("elpro form actsel acttitle undo redo routing manual".split(" ").concat(this.usecase_newtour?[]:["title","shortdesc"]),'(this["_"+v] = alp.nodify( this[v], this.contNode )).childNodes.a',
this);alp.forEach(["elproCanvas","elproLegendHeight","elproLegendDistance","elproClipping"],'(this["_"+v] = alp.nodify( this[v], this._elpro )).childNodes.a',this);alp.forEach("actselicon acttitle gpxactivate gpxleave gpxUploadForm gpxUploadFile gpxUploadCont gpxUploadInfoBtn gpxUploadButton gpxUploadFileName gpxUploadDoneInfo gpxUploadFailedInfo detailsCalcMinTime detailsCalcTourLength detailsCalcTourLengthKm detailsCalcAscent detailsCalcDescent factDuration factLength factAscent factDescent factHighest factLowest inputRadio radioConnect inputTextSelectListenChange outputTab actionDelete actionPrint actionGpx actionGpxOrig actionKml actionSave actionNext confirmDelete allSeasonCB monthCB otherCB inputNumberDurationMin inputNumberDurationMax linrefEditCont linrefEditToggle linrefEditActivate linrefEditCancel linrefEditSave linrefEditView linrefEditLegend elproClippingLeft elproClippingRight publishButton publishCont1 bulkEditCont bulkEditBtn".split(" "),
'this["_"+v+"First"] = (this["_"+v+"Arr"] = alp.gEBCN( this[v], this.contNode ))[ 0 ];',this);for(var f=this._otherCBArr.length;f--;)-1<alp.lastIndexOf(this._monthCBArr,this._otherCBArr[f])&&this._otherCBArr.splice(f,1);this._externLeaveLinkCheckChangeArr=this.externLeaveLinkCheckChange();this._submitLeaveCheckChangeArr=this.submitLeaveCheckChange();this._actopt=alp.gEBTN("option",this._actsel);this._actarr=alp.map(this._actopt,"alp.mix( alp.oFrom(v.value), { index : i, title : alp.textContent( v ) } )");
this._actnamearr=alp.map(this._actarr,".name");this._actobj=alp.mix(alp.arr2o(this._actarr),alp.arr2o(this._actarr,alp.f(".name")));this._fileEmptyTxt=this._gpxUploadFileNameArr[0].textContent;(f=this._json_outnode=this.formFieldSave&&alp.nodify(this.formFieldSave))&&alp.sA(f,"value",f.value="");alp.mix(this,C.activity_from_dom(this._actsel));this._default_activity||(this._default_activity=this._actdtcfg._default);e.tel=new z.TourEditLayer({datatypeList:this._actnamearr.join(","),withDigitizeToolbar:!1,
ovmtcoll:this.ovmtcoll,initData:this.usecase_newtour?!1:alp.oFrom(this._initData&&this._initData.geoJson),initFrom:this.initFrom,initTo:this.initTo,proj:this.proj,roadbookRouting:this.roadbookRouting,new_geocoder_alwaysPointGeometry:this.geocodeAlwaysPointGeometry,formField:null,datatype_cfg:this._actdtcfg,datatype_node_select:[this._actsel],datatype_img_select:this._actseliconArr,datatype_from_dom:!0,datatype_hidden_id:alp.gEBCN(this.activityHiddenId,this.contnode),datatype_hidden_name:alp.gEBCN(this.activityHiddenName,
this.contnode),default_routingengine:this.default_routingengine,tourDurationV_q:alp.gEBCN(this.factDuration,this.contNode),tourDurationH_q:alp.gEBCN(this.factDurationH,this.contNode),tourDurationM_q:alp.gEBCN(this.factDurationM,this.contNode),factAscent_q:alp.gEBCN(this.factAscent,this.contNode),factDescent_q:alp.gEBCN(this.factDescent,this.contNode),factHighest_q:alp.gEBCN(this.factHighest,this.contNode),factLowest_q:alp.gEBCN(this.factLowest,this.contNode),elproCanvas_q:this._elproCanvas,elproLegendHeight_q:this._elproLegendHeight,
elproLegendDistance_q:this._elproLegendDistance,elproClipping_q:this._elproClipping,elproClippingLeft_q:this._elproClippingLeftArr,elproClippingRight_q:this._elproClippingRightArr,linrefEdit_profileNode:this._linrefEditViewArr[0],linrefEdit_attrLegendNode:this._linrefEditLegendArr[0],linrefEdit_attrLegendOptions:{markupVersion:2},linrefEdit_withMapMarker:!1,linrefEdit_withContextMenu:!1,multigeocoder_scroll_cont:"alp-tpwiz-block",m_routing_source_set:this.m.routing_source_set});this.usecase_newtour||
(e.ifm_img=new alp.x.InputFileMultipleImgExt({cont:alp.gEBCN(this.imgCont,this.contNode)[0],input:this.imgInput,inputBtn:this.inputBtn,display:this.imgDisplay,toggle:this.imgToggle,files:this.imgFiles,initNow:!1}));alp.forIn(this,function(a,b){(b=b.match(/^(input.+Rating)Class$/))&&alp.nodify(a,this.contNode)&&(e[b[1]]=new alp.x.Rating({cont:alp.nodify(a,this.contNode)}))},this);alp.styleform.init({now:!0,cont:{input:this._monthCBArr},labelCont:this.contNode,oncheck_init:alp.bindF(d,null,this),oncheck:alp.bindF(b,
null,this)});alp.styleform.init({now:!0,cont:{input:this._allSeasonCBArr},labelCont:this.contNode,oncheck_init:alp.bindF(c,null,this),oncheck:alp.bindF(a,null,this)});alp.styleform.init({now:!0,cont:{input:this._otherCBArr},labelCont:this.contNode,oncheck_init:alp.bindF(m,null,this),oncheck:alp.bindF(l,null,this)});f=new Date;alp.nodify(this.date,this.contNode)&&(e.date=new alp.x.Pikaday({field:alp.nodify(this.date,this.contNode),clickNode:alp.nodify(this.dateIcon,this.contNode),style:{position:this.datePosition},
scrollContainerNode:alp.nodify(this.dateScrollContainer,this.contNode),minDate:new Date("2000-01-01"),maxDate:f,useRelativeDays:!0}));f=alp.arr2oSimple(alp.map(this._inputRadioArr,'alp.gA(v,"name")'));alp.forIn(f,function(a,b){a=alp.filter(this._inputRadioArr,'"'+b+'" == alp.gA(v,"name")');a.length&&(e["radioGroup_"+b]=new alp.x.RadioGroup({contNode:this.contNode,inputArr:a}))},this);e.inum=alp.x.inputNumberMany(alp.gEBCN(this.inputNumberClass,this.contNode));e.tmce=[];if("undefined"!==typeof tinyMCE&&
tinyMCE){f=!tinyMCE.isWebKit;var g={mode:"specific_textareas",editor_selector:"mceEditor",extended_valid_elements:"a[href]",plugins:["link","lists","autolink"].concat(alp.likeIE()?[]:["paste"]).concat(f?["autoresize"]:[]).concat(alp.isRTL?["directionality"]:[]),external_plugins:{charactercount:alp.cssBase()+"alp/tinymce4_plugins/charactercount/plugin.min.js"},target_list:!1,link_title:!1,menubar:!1,resize:!1,statusbar:!1,skin:"lightgray",theme:"modern",height:150,toolbar:"undo redo | bold | bullist numlist | link",
setup:alp.bindF(r,null,this),paste_data_images:!1,link_assume_external_targets:!0,relative_urls:!1,remove_script_host:!1,paste_preprocess:I.paste_preprocess_remove_all_tags};f&&(g.autoresize_on_init=!1);alp.isRTL()&&(g.directionality="rtl");I.createMany(g)}},setInitVal:function(a,b,c,d){function e(a){(a=alp.sub("data.images.image",a))&&a.length&&(d.ifm_img.max+=a.length,alp.now("setFileArr",d.ifm_img,a,{programmatic:!0,isInit:!0}))}b=a._initData;c.id.set(b&&b.id||"");var f=alp.oFrom(b&&b.geoJson);
c.activity.set(alp.opt(f,C.DATATYPE_NAME())||a.default_activity||a._default_activity);c.routingstyle.set(alp.opt(f,C.ROUTINGSTYLE())||a.default_routingstyle);c.pace.set(alp.opt(f,C.PACE())||a.default_pace);c.title_in.set(b&&b.title||alp.opt(a._title,"value"));c.shortdesc_in.set(b&&b.shortdesc||alp.opt(a._shortdesc,"value"));c.manual.set(!!alp.opt(f,C.MANUAL()||a.default_manual));c.change.set(!1);d.tel.startExtending(!0);if(d.ifm_img){var g=this.m.id.get();(g||null).substring.call.a;a.dfrd_userid_token().thenSoon(function(a,
b){(new G.SingleOOI(g,{proj:this.proj,edit:!0,token:b})).load(e)})}},connectModel2Model:function(a,b,c,d){function e(){var a=c.activity.get();a=a&&d.tel.getActivityObject(a);c.activityObject.set(a)}function f(){c.change.set(!0)}function g(){var b=a.m.tabShowed.get();c.bulkEditVisible.set((b===oax.TP_TAB_GEOM||b===oax.TP_TAB_SHORT)&&!a.m.linrefEdit.get()&&d.tel.getNodeCount()>a.bulkEditThreshold)}function h(){if(!c.publishable.get()){var a=c.tabShowed.get();a!==oax.TP_TAB_GEOM&&a!==oax.TP_TAB_SHORT&&
c.tabShowed.set(oax.TP_TAB_SHORT)}}alp.forEach(["activity","title_out","shortdesc_out","routingstyle","pace"],function(a){b.push(c[a].change_cb(f))});b.push(c.activity.change_cb_init(e));d.tel.whenLoaded(e);b.push(d.tel.listen("geomChange",f),"drop",d.tel);b.push(c.linrefEdit.change_cb_init(g));b.push(c.tabShowed.change_cb_init(g));b.push(d.tel.listen("geomChange",g),"drop",d.tel);alp.forIn(d,function(a){a instanceof alp.x.Rating&&b.push(a.m.selection.change_cb(f))});alp.forEach(["inputNumberDurationMin",
"inputNumberDurationMax"],function(c){function e(){x(a["_"+c+"First"],""+(60*h.get()+k.get()));"inputNumberDurationMin"===c&&(0!=60*h.get()+k.get()?d.radioGroup_minTimeDisplay.m.modeState.set("display"):d.radioGroup_minTimeDisplay.m.modeState.set("calc"))}var f=a[c],g=d.inum[f+"-h"];f=d.inum[f+"-m"];if(g&&f){var h=g.m.number,k=f.m.number;alp.forEach([h,k],function(a){b.push(a.change_cb(e))})}});b.push(c.publishable.change_cb_init(h));b.push(c.tabShowed.change_cb(h))},connectModel2View:function(a,
b,c,d){function e(){var b=d.tel.undoLength.get(),c=d.tel.redoLength.get();a._undo&&(a._undo.style.visibility=0<b?"visible":"hidden");a._redo&&(a._redo.style.visibility=0<c?"visible":"hidden")}function f(){var b=a._title;document.activeElement===b?null==r&&(r=setTimeout(f,100)):x(b,c.title_out.get())}function g(){x(a._shortdesc,c.shortdesc_out.get())}function l(){var a=c.activity.get();a&&(null!=d.tel.setDatatype(a)||setTimeout(l,123))}function m(){var a=c.routingstyle.get();a&&(null!=d.tel.setRoutingstyle(a)||
setTimeout(m,124))}function n(){var a=c.pace.get();a&&(null!=d.tel.setPace(a)||setTimeout(n,125))}b.push(c.activity.change_cb_init(function(){var b=c.activity.get(),d=alp.opt(a._actobj[b],"index"),e;null!=d&&(a._actsel.selectedIndex=d,(e=h(a,d))&&alp.setText(a._acttitleArr,e));a.usecase_newtour||(d=c.activity.getPrevious(),b&&d&&b!==d&&(a._activity_change_humane||(a._activity_change_humane=!0,(b=alp.opt(alp.nodify(a.activityChangeAlert,a.contNode),"innerHTML"))&&alp.humane(b)),alp.setClass(a.contNode,
a.activityChangeClass,!0)))}));b.push(c.tabShowed.change_cb_init(function(){var b=c.tabShowed.get(),d="alp-tpwiz-"+b+"-block",e="alp-tpwiz-current-tab-"+b;alp.gEBCN("alp-tpwiz-flexView-container")&&(alp.setClass(alp.gEBCN("alp-tpwiz-flexView-container"),{"alp-tpwiz-current-tab-*":!1,"alp-tpwiz-show-dp-wide":b===oax.TP_TAB_MEDIA||b===oax.TP_TAB_DATA||b===oax.TP_TAB_DETAIL}),alp.setClass(alp.gEBCN("alp-tpwiz-flexView-container"),e,!0));alp.forEach(alp.gEBCN(oax.TP_TAB),function(a){alp.setClass(a,oax.NO_DISPLAY,
!alp.hasClass(a,d))});alp.gEBCN("alp-tpwiz-tab-control")&&alp.setClass(alp.gEBCN("alp-tpwiz-tab-control"),"alp-tpwiz-selected",!1);alp.gEBCN("alp-tpwiz-show-"+b)&&alp.setClass(alp.gEBCN("alp-tpwiz-show-"+b),"alp-tpwiz-selected",!0);alp.forEach(a._outputTabArr,'.value="'+b+'"');a.usecase_newtour||b!==oax.TP_TAB_SHORT||c.publishable.get()||a._alert("alertUnpublishableOnTabChange")}));alp.forEach(["routingstyle","pace"],function(a){b.push(c[a].change_cb_init(function(){var b=c[a].get();b&&alp.m(alp.oGet(d,
[a,"m",b]),"set",!0)}))});a._title&&b.push(c.title_out.change_cb_init(f));a._shortdesc&&b.push(c.shortdesc_out.change_cb_init(g));b.push(c.manual.change_cb_init(function(){var b=c.manual.get();alp.setClass(a._routing,a.selected,!b);alp.setClass(a._manual,a.selected,b)}));b.push(c.map.change_cb_init(function(){var b=(a._map_eh||(a._map_eh=new alp.Eh)).clear(),d=c.map.get();d&&b.push(z.event("addListener")(d,"click",function(){c.tabShowed.setNow(oax.TP_TAB_GEOM)}),z.event("removeListener"))}));var q=
alp.ratelimitF(250,function(){var b=d.tel.getLength(),e=0<b,f=e&&b.toFixed?L.kmString(b):"0";alp.setText(a._factLengthArr,f);alp.setClass(a.contNode,[[a.contClassHasGeom,e],[a.contClassNoGeom,!e]]);e||c.linrefEdit.set(!1);var g=alp.opt(d.tel.getDerivedValues(),"derivedValues")||{};e=alp.oGet(g,"durationSummary.human.hours")||0;var h=alp.oGet(g,"durationSummary.human.minutes")||0,k=alp.oGet(g,"elevationSummary.ascent")||0;g=alp.oGet(g,"elevationSummary.descent")||0;var l,m;(l=a._detailsCalcMinTimeFirst)&&
null!=e&&null!=h&&(l.value=e+":"+alp.sPad(h,2,"0"));(l=a._detailsCalcTourLengthFirst)&&(m=a._detailsCalcTourLengthKmFirst)&&null!=b&&null!=f&&(l.value=""+Math.round(b),m.value=f);(l=a._detailsCalcAscentFirst)&&(m=a._detailsCalcDescentFirst)&&null!=k&&null!=g&&(l.value=Math.round(k),m.value=Math.round(g))});b.push(d.tel.listen("geomChange",q));b.push(d.tel.listen("durationChange",q));b.push(d.tel.listen("elevationChange",q));q();b.push(c.activity.change_cb_init(l));b.push(c.routingstyle.change_cb_init(m));
b.push(c.pace.change_cb_init(n));b.push(c.tel_vis_and_map.change_cb_init(function(){var a=c.tel_vis_and_map.get();d.tel.setMap(a)}));b.push(c.manual.change_cb_init(v,null,a));b.push(c.gpxupload.change_cb_init(function(){alp.setClass(a.contNode,a.gpxUploadActive,c.gpxupload.get())}));b.push(d.tel.undoLength.change_cb_init(e));b.push(d.tel.redoLength.change_cb_init(e));b.push(c.linrefEdit.change_cb_init(function(){var b=c.linrefEdit.get();alp.setClass(a.contNode,[[a.linrefEditActiveClass,b],[a.linrefEditInactiveClass,
!b]]);b?d.tel.startLinrefEdit():d.tel.startExtending(!0);(b=h(a))&&alp.setText(alp.gEBCN(a.acttitle,a._linrefEditLegendFirst),b);(b=c.map.get())&&z.event("trigger")(b,"resize");k.call(a)}));b.push(c.publishable.change_cb_init(p,null,a));b.push(c.bulkEditVisible.change_cb_init(u,null,a));b.push(c.bulkEdit.change_cb(t,null,a));var r},connectView2Model:function(a,b,c,d){function h(){c.change.set(!0)}function k(a,b){a||(a=window.event);if(m()){alp.stopEvent(a);t=!0;var c=b.prepare(a);a=alp.gEBCN("alp-tpwiz-hidden-save-check-dialog")[0];
J.open({html:a.innerHTML,width:380,onOpenNow:function(a){var d=alp.gEBCN("alp-tpwiz-close",a)[0];a=alp.gEBCN("oax-modal-action-close",a)[0];d&&alp.aEL(d,"click",function(){b.leave(c)});a&&alp.aEL(a,"click",function(){t=!1})}})}}function l(a){return alp.gA(a,"href")||a.parentNode&&l(a.parentNode)}function m(){return c.change.get()||c.other_text_change.get()||d.ifm_img&&d.ifm_img.m.filesModified.get()}function n(){c.title_in.setNow(a._title.value||"")}function p(){c.shortdesc_in.setNow(a._shortdesc.value||
"")}function q(){x(alp.nodify("alp-tpwiz-dayOfInspection-date-in",a.contNode),alp.date2str(d.date.getDate()))}b.push(alp.aEL(a._actsel,"change",alp.nowF(function(){var b=a._actarr[a._actsel.selectedIndex];b&&c.activity.setNow(b.name)})));alp.forEach(["routingstyle","pace"],function(a){function e(d,e){b.push(d.change_cb(function(){d.get()&&c[a].set(e)}))}var f=alp.oGet(d,[a,"m"]);f&&alp.forIn(f,e)});a._title&&b.push(setInterval(n,131),clearInterval);a._shortdesc&&b.push(setInterval(p,131),clearInterval);
b.push(alp.aEL(a._redo,"click",alp.nowF(function(a){alp.stopEvent(a||window.event);d.tel.redo()})));b.push(alp.aEL(a._undo,"click",alp.nowF(function(a){alp.stopEvent(a||window.event);d.tel.undo()})));b.push(alp.aEL(a._routing,"click",alp.nowF(function(a){alp.stopEvent(a||window.event);c.manual.setNow(!1)})));b.push(alp.aEL(a._manual,"click",alp.nowF(function(a){alp.stopEvent(a||window.event);c.manual.setNow(!0)})));b.push(alp.aEL(a._gpxactivateArr,"click",function(){alp.setClass(a._gpxUploadContArr[0],
oax.NO_DISPLAY,!0);c.gpxupload.setNow(!0)}));b.push(alp.aEL(a._gpxleaveArr,"click",function(){a._gpxUploadFileNameArr[0].innerHTML=a._fileEmptyTxt;a._gpxUploadFileArr[0].value=null;c.gpxupload.setNow(!1)}));b.push(alp.aEL(a._gpxUploadInfoBtnArr,"click",alp.bindF(alp.nowF(g),null,this)));b.push(alp.aEL(a._gpxUploadButtonArr,"click",alp.bindF(alp.nowF(f),null,this)));b.push(alp.aEL(a._gpxUploadFileArr,"change",alp.nowF(function(){a._gpxUploadFileNameArr[0].innerHTML=this.value.replace(/^.+[\\\/]/,"");
alp.setClass(a._gpxUploadContArr[0],oax.NO_DISPLAY,!1)})));b.push(d.tel.listen("modeChange",function(a,b){var d=/BulkEditMode/.test(a);"PolyExtendMode"===a?(c.manual.set(!b.isRouting),c.bulkEdit.set(d)):"PolyAttrMode"!==a&&c.bulkEdit.set(d)}));var r=alp.bindF(e,null,a);b.push(alp.aEL(window,"resize",r));b.push(setInterval(r,191),clearInterval);b.push(d.tel.listen("attrChange",function(){a[D]=!0}),"drop",d.tel);b.push(alp.aEL(a._linrefEditActivateArr,"click",function(){a[F]=d.tel.getData();a[D]=!1;
c.linrefEdit.setNow(!0)}));b.push(alp.aEL(a._linrefEditToggleArr,"click",alp.nowF(function(){var b=alp.gEBCN("alp-tpwiz-current-tab-geom")[0];alp.setClass(b,a.elproMiniClass,!alp.hasClass(b,a.elproMiniClass))})));b.push(alp.aEL(a._linrefEditSaveArr,"click",function(){c.linrefEdit.setNow(!1)}));b.push(alp.aEL(a._linrefEditCancelArr,"click",alp.nowF(function(){w(a)})));b.push(alp.aEL(a._bulkEditBtnArr,"click",function(){c.bulkEdit.toggleNow()}));b.push(alp.aEL(a._radioConnectArr,"change",alp.nowF(function(){""!=
this.value?d["radioGroup_"+this.id].m.modeState.set("input"):d["radioGroup_"+this.id].m.modeState.set("calc")})));b.push(alp.aEL(a._inputTextSelectListenChangeArr,"change",alp.nowF(h)));alp.forIn(d,function(a,c){/^radioGroup_/.test(c)&&b.push(a.m.modeState.change_cb(h))});alp.forIn(d,function(a,c){a instanceof alp.x.Pikaday&&b.push(a.selectEvt().thenSoon(h))});b.push(alp.aEL(a._externLeaveLinkCheckChangeArr,"click",alp.nowF(function(a){k(a,{prepare:function(a){return{href:l(a.target||a.srcElement)}},
leave:function(a){window.location.href=a.href}})})));b.push(alp.aEL(a._submitLeaveCheckChangeArr,"submit",alp.nowF(function(a){k(a,{prepare:function(a){return{form:a.target||a.srcElement}},leave:function(a){a.form.submit()}})})));b.push(alp.dom.windowExitIntercept(function(a){return!t&&m()&&"  "}));a.connectView2ModelActions(a,b,c,d);var t;alp.forEach(oax.TABARR_TP,function(b){function d(){c.linrefEdit.get()&&b!==oax.TP_TAB_GEOM?w(a).thenSoon(e):c.tabShowed.setNow(b)}function e(a){a=a.linrefEditCancelled;
("boolean"===typeof a||null).toValue;a&&c.tabShowed.setNow(b)}var f=alp.gEBCN("alp-tpwiz-show-"+b,a.contNode)[0];f&&alp.aEL(f,"click",alp.nowF(d))});d.date&&b.push(d.date.selectEvt().then(q))},connectPureView:function(a,b,c,d){function e(){if(!a._css_arrived){var b=a._css_img||(a._css_img=alp.cE("img",null,{src:"#",style:"width: 1px; height: 1px; position: fixed; bottom: 0; right: 0; color: transparent","class":"oax-tew-css-arrival-img"})),c=a.contNode;b.parentNode!==c&&alp.aC(c,b);(0<c.clientWidth||
0<c.clientHeight)&&c.offsetParent&&0===b.clientWidth&&0===b.clientHeight&&!b.offsetParent&&(a._css_arrived=!0,alp.orphan(b),alp.style(a.contNode,"visibility",""),alp.style(alp.gEBCN("oax-part-flexview",a.contNode),"visibility",""))}}a.connectPureViewActions(a,b,c,d);b.push(alp.aEL(a._publishCont1Arr,"click",alp.nowF(function(b){b||(b=window.event);c.publishable.get()||(alp.stopEvent(b),d.radioGroup_publishTour.kx[0].m.is.set(!0),a._alert("alertUnpublishableOnPublish"))})));a.waitForCss&&b.push(setInterval(e,
211),clearInterval)},_alert:function(a){(a||null).substring.call.a;var b="_"+a+"_html",c;(a=b in this?this[b]:(c=this[a],(c||null).substring.call.a,this[b]=alp.opt(alp.nodify(c,this.contNode),"innerHTML")||"#%?"+a))&&alp.humane(a)}});var F="_linrefSavedData",D="_linrefChanged",M="_last_map_rect",R="_tinyMCE_textarea_2_initialtext",S=alp.cE("div")})();"undefined"!==typeof dojo&&dojo.provide("oax.util.cbtreemoreless");
(function(){alp.sub("oax.util",null,!0).cbtreeMoreLess=function(k){var h=alp.nodify("oax-cbtree-i18n-more",k);k=alp.nodify("oax-cbtree-i18n-less",k);return h&&k&&{more:h.innerHTML,less:k.innerHTML,n:3}}})();"undefined"!==typeof dojo&&dojo.provide("oax.util.mlp_to_winter_and_overlays");
(function(){alp.sub("oax.util",null,!0).mlp_to_winter_and_overlays=function(k,h){function g(f){var e=f.m._out_maptype.get();if(e="string"===typeof e?e:e.id)e=k.isWinter?e.replace(/summer$/,"winter"):e.replace(/winter$/,"summer"),f._setMaptypeid(e,k.mapOverlays)}h.isDfrd?h.then(g):g(h)}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.tourplanner");
alp.gmap3(function(k){function h(a,b){function c(b){e=(b=v.bounds2zoomcenter(b,g(a),{padding:.1}))&&b.zoom;f=b&&b.center&&[b.center.lng,b.center.lat]}var d=b?"_cfg_gm":"_cfg";if(!a[d]){a[d]=oa.cfg.cfg_flexview.fill_default_and_fix_backward_compatibility(a,b);var e=null,f=null;if(a.initData&&!/(#|&)zc=/.test(location.hash)){var h=(b=p.ooi_geometry(a.initData,{polyline:!0}))&&b.polyline;h&&h.length?c(v.bounds(alp.map(h,"{lat:v[1],lng:v[0]}"))):b&&b.length&&(e=14,f=b)}(b=location.search.match(/(?:\?|&)bbox=([^&]+)/))&&
c(alp.map(b[1].split(","),parseFloat));null!=e&&null!=f&&(alp.oSet(a[d],"maplayer.basemap.zoom",e),alp.oSet(a[d],"maplayer.basemap.center",f));t.overwrite_map_cfg_from_url_hash(a[d])}return a[d]}function g(a){return a._mapNode||(a._mapNode="string"===typeof a.mapNode?alp.f(a.mapNode)():a.mapNode)}function f(b){oax.api.maps(function(f,k){function l(){b.kx.mlp&&b.kx.mlp.m.isOpen.set(!1);b.kx.mcp&&b.kx.mcp.m.isOpen.set(!1)}function p(a){a.listen("markerClick",m,b)}function q(a){var c=alp.opt(a.m,"out_map_source_set");
c&&c.bind_to(b.kx.tewiz.m.routing_source_set);if(c=b.prefer_mapconfig_bounds&&alp.oGet(a,"mapconfig.bounds"))a=c[0],c=c[1],a=new k.LatLngBounds(new k.LatLng(a[1],a[0]),new k.LatLng(c[1],c[0])),b.map.fitBounds(a)}var r=h(b,k),v=g(b);r=r.maplayer.basemap;var w=r.layer,z=r.init||w[0],y=r.zoom;r=alp.oCreateMix(r||{},{center:n.xy2latlng(r.center),zoom:y,mapTypeId:z,mapTypeControlOptions:{mapTypeIds:w},panControlOptions:{position:k.ControlPosition.RIGHT_TOP},zoomControlOptions:{position:k.ControlPosition.RIGHT_TOP},
streetViewControl:!1});if(w=oa.cfg.ovmtids_filter(alp.sub("alp.overlayMapTypeIds",r),"tourplanner"))b._overlayMapTypeIds=alp.filterIn(w,"w !='*'"),r.oa.overlayMapTypeIds=alp.filterIn(w,"w==='*'");b.map=new f.Map(v,r);b._emptyButton=oax.x.emptybutton({position:k.ControlPosition.TOP_RIGHT},b.map);b.hasFullscreenToggle?(b.fullscreen=new alp._gmap2_3.x.Fullscreen({map:b.map,initNow:!0,init_value:!1,instruction_alert:!1}),b.fullscreen.m.isFull.change_cb(l)):alp.setClass(alp.nodify("oax-part-flexview",
b.contNode)||b.contNode,oax.NO_FULLSCREEN,!0);f=b.hasFullscreenToggle?b.fullscreen.m.isFull:new alp.BoolState({init_value:!0});v=b.hasFullscreenToggle?b.fullscreen.m.isMapVis:new alp.BoolState({init_value:!0});r=new alp.BoolState({init_value:!0});b._layout.install_isFull_isMapVis_stVis3d_isDpVis(f,v,b.map.stVis3d,r);alp.setClass(b.contNode,oax.READY,!0);v=c(b,b.map);b.initData&&d(b);v={initNow:!0,contNode:b.contNode,proj:b.proj,initData:b.initData,ovmtcoll:v,roadbookRouting:b.roadbookRouting,geocodeAlwaysPointGeometry:b.geocodeAlwaysPointGeometry,
login_indicator:u.login_indicator,login_open_dialog:u.open_login_dialog,login_get_userid:u.get_user_id,login_after:x.generic_login_barrier_after};if(r=b.cat&&e(b,b.cat))v.default_activity=r;b.kx.tewiz=new n.x.TourEditWizard(v);b.hasFullscreenToggle&&f.change_cb(function(){b.kx.tewiz.resize()});f=b.kx.tewiz.m.activityObject;v=alp.bindF(a,null,b,f);f.change_cb_init(v);b.kx.tewiz.kx.tel.whenLoaded(v);b.mcpToggleNode&&(b._mcpContNode=b.mcpContNode,b._mcpToggleNode=b.mcpToggleNode,b._mcpTogglePlaceholderNode=
"string"===typeof b.mcpTogglePlaceholder?alp.nodify(b.mcpTogglePlaceholder,b.contNode):b.mcpTogglePlaceholder,b.mcpCatList&&b._mcpToggleNode?(f=b.mcpCatList,f="string"===typeof f?f.split(","):f,b._mcpCfg={initNow:!0,proj:b.proj,cont:b._mcpContNode,toggleNode:b._mcpToggleNode,mcpCatList:f,mcpInitList:b.mcpInitList,initCheckedIds:b.mcpInitCheckedIds,onNewTreeEvt:alp.chainF(t.mcp.setupClusterLayerF(b,b.map),p),cbtreeMoreLess:t.cbtreeMoreLess(b.flexviewNode)},b._mcp=new oa.x.MapContentPanel(b._mcpCfg),
b._mcp.setMap(b.map),alp.setClass(b._mcpToggleNode,oax.NO_DISPLAY,!1),b._mcpTogglePlaceholderNode&&alp.setClass(b._mcpTogglePlaceholderNode,oax.NO_DISPLAY,!0)):b._mcpToggleNode&&alp.setClass(b._mcpToggleNode,oax.NO_DISPLAY,!0));t.mapbtn.manageWrapper(b.mapbtnsWrapper,null,b.mapbtnsOpenClass,[b.kx.mlp,b._mcp],b.mpContNode,b.m.isMapPanelOpenSt);t.streetview(b.map,b.contNode);alp.forIn(b.kx,function(a){alp.m(a,"setMap",b.map)});(f=alp.m(b.kx.mlp,"newMlpMaybeDfrd"))&&f.then(q);b.mapDfrd().triggerSoon(b.map)})}
function e(a,c){(c||null).substring.call.a;a=b(a);return alp.or(a,function(a){a=alp.gEBTN("option",a);return(a=(a=alp.or(a,'(-1<v.value.lastIndexOf("'+c+'")  ||  -1<v.innerHTML.lastIndexOf("'+c+'"))  &&  v.value'))&&alp.oFrom(a))&&a.name})}function d(a){var c=a.initData.category,d=alp.oFrom(a.initData.geoJson).datatype_name;a=b(a);alp.forEach(a,function(a){var b=alp.gEBTN("option",a);alp.and(b,'0 > v.value.lastIndexOf("'+c.id+'")  &&  0 > v.value.lastIndexOf("'+d+'")')&&alp.place(alp.cE("option",
null,{value:alp.oToString(alp.oCreateMix(alp.oFrom(b[0].value),{id:c.id,name:d,iconUrl:c.iconUrl}))},{innerHTML:c.name}),a,"last")})}function b(a){return[a.kx.tewiz?alp.nodify(a.kx.tewiz.actsel,a.kx.tewiz.cont):alp.nodify(alp._gmap2_3.x.TourEditWizard.prototype.actsel,a.contNode),alp.nodify(q.SEGMENT_ACTIVITY_SELECT(),alp.nodify(y,a.kx.tewiz?a.kx.tewiz.cont:a.contNode))]}function c(a,b){return a.kx.ovmtcoll=t.createOvmtcoll({oaxcfg:h(a),map:b,mlp:a.kx.mlp})}function a(a,b){(b=b.get())&&w(b,alp.subDfrd("_new_mlp",
a.kx.mlp))}function m(a){var b=this.map,c=b.getCenter(),d=b.getZoom();oax.iwOpenLoadingMessage(b,a.latlng);a.load(l,this,b,a.latlng,{iwCloseCallback:function(a){a.mapMoved||(b.setZoom(d),b.panTo(c))}})}function l(a,b,c,d,e){var f=(e||alp.oValues(d))[0];var g=f.frontendtype;oax.MODE_MAP_IW.substring.call.a;(g||0).substring.call.a;g={tmpl:oax.snippet.getSnippetTmplDfrd(g),classArr:this.snippetClassArr||[]};c=alp.oCreateMix(c,{iwNodePostProcess:r(this,f.id)});return oax.iwOpen(a,b,c,g,d,e)}function r(a,
b){return function(c,d){function e(b){alp.stopEvent(b||window.event);b=alp.oGet(d,"category.name");var c=d.title;a.kx.tewiz.kx.tel.appendNode(f,{address:c?c+(b?" ("+b+")":""):"",poiId:d.id});n.iwCloseAll(a.map)}var f=p.ooi_geometry(d);if(f){alp.forEach(alp.gEBTN("a",c),'alp.sA(v,"target","_blank")');alp.cE("div",c,{"class":"oax_clear"});var g=d.frontendtype;g="condition"!==g&&"skiresort"!==g;var h=alp.cE("div",c,{"class":"oax_routeToOOI_footer"},{innerHTML:alp.gEBCN("oax-hidden-im-routeToOOI-footer")[0].innerHTML});
h=alp.children(h)[0];g?alp.aEL(h,"click",e,!0):alp.setText(h,"");t.basket_add_or_login(c,{proj:a.proj,ooiid:b})}}}var n=alp._gmap2_3,q=n.digitize,p=alp.data,v=alp.maps,u=oax.community_layout,t=oax.util,w=t.mlp_to_winter_and_overlays,x=oa.util.community,y=q.NEW_GEOCODER_NODE_TEMPLATE();alp.i18n.fetch("alp.all").then(function(a){});alp.declare("oax.x.Tourplanner",alp.x.AbstractController,function(){h(this);this._layout=new oax.FlexViewLayout({topNode:this.contNode,is_tourplanner:!0});f(this)},{proj:null,
key:null,contNode:null,mapNode:'alp.gEBCN("alp-tpwiz-map-canvas")[0]',initData:null,mapbtnsWrapper:"oax-mapbtns-wrapper",mapbtnsOpenClass:"oax-mapbtns-open",mpContNode:null,mlpContNode:null,mlpToggleNode:null,mcpContNode:null,mcpToggleNode:null,mcpTogglePlaceholder:"oax-toggle-placeholder",mcpCatList:"",mcpInitList:"",mcpInitCheckedIds:"",sessionExpirationTmpljsNode:null,snippetClassArr:["oax-snippet-tourplanner"],withMapOverlay:!0,hasFullscreenToggle:!0,roadbookRouting:!1,geocodeAlwaysPointGeometry:!1,
cat:null,isMapPanelOpenSt:null,maplayer:null,maplayerpanel:null,prefer_mapconfig_bounds:!1,augmentModel:function(a){a.isMapPanelOpenSt=this.isMapPanelOpenSt||new alp.BoolState},augmentKids:function(a){var b=h(this);this.mlpToggleNode&&(a.mlp=new alp.x.MapLayerPanel({cont:this.mlpContNode,toggle:this.mlpToggleNode,cfg:b,withoutMapOverlay:!this.withMapOverlay}))},connectPureView:function(a,b,c,d){(a=a.sessionExpirationTmpljsNode)&&b.push(x.session_expiration_view(a))},mapCB:alp.eventCB("mapDfrd",{then:1}),
mapDfrd:alp.memM("mapDfrd",'alp.dfrd("flexview map", {then:1})')})});"undefined"!==typeof dojo&&dojo.provide("oax.tppage");
(function(){var k=alp.data,h=oa.util,g=oax.util.info;alp.declare("oax.TpPage",null,alp.nowF(function(f){alp.mixCheck(this,f);this.proj.substring.call.a;!this.tourid||this.tourid.substring.call.a;if(f=location.search.match(/(?:\?|&)cat=([^&]+)/))this.cat=f[1]}),alp.util.InterfaceWithInit,{proj:null,tourid:null,topCont:"oax-top-cont",tppageCont:oax.PART_CSS_CLASS+"flexviewpage",mpCont:oax.MP_CONT,mlpCont:oax.MLP_CONT,mcpCont:oax.MCP_CONT,mlpToggle:oax.MLP_TOGGLE,mcpToggle:oax.MCP_TOGGLE,mcpCatList:null,
mcpInitList:null,mcpInitCheckedIds:"",sessionExpirationTmpljs:oa.SESS_EXP_TMPL,cfg:null,mapTypeIds:null,mapTypeId:null,center:null,zoom:null,bbox:null,hasFullscreenToggle:!0,roadbookRouting:!1,geocodeAlwaysPointGeometry:!1,cat:null,initASAP:alp.nowF(function(){function f(d){alp.onDCL(function(){var b=alp.oCreateMix({proj:e.proj,contNode:e._tpp,mpContNode:e._mpContNode,mlpContNode:e._mlpContNode,mlpToggleNode:e._mlpToggleNode,mcpContNode:e._mcpContNode,mcpToggleNode:e._mcpToggleNode,mcpCatList:e.mcpCatList,
mcpInitList:e.mcpInitList,mcpInitCheckedIds:e.mcpInitCheckedIds,sessionExpirationTmpljsNode:e._sessionExpirationTmpljsNode,initNow:!0,initData:d&&alp.opt(k.single_ooi(d,e.tourid),"data"),hasFullscreenToggle:e.hasFullscreenToggle,roadbookRouting:e.roadbookRouting,cat:e.cat,geocodeAlwaysPointGeometry:e.geocodeAlwaysPointGeometry},e.cfg);e.mapTypeIds&&alp.oSet(b,"maplayer.basemap.content",e.mapTypeIds);e.mapTypeId&&alp.oSet(b,"maplayer.basemap.init",e.mapTypeId);e.center&&alp.oSet(b,"maplayer.basemap.center",
e.center);null!=e.zoom&&alp.oSet(b,"maplayer.basemap.zoom",e.zoom);e.bbox&&alp.oSet(b,"maplayer.basemap.bbox",e.bbox);b.prefer_mapconfig_bounds=!h.user_gave_extent(e);e.tp=new oax.x.Tourplanner(b);g.setup(e._tpp);e._tp_cfg=b;e.mark_init_done(e)})}var e=this;e._top=alp.nodify(e.topCont);e._tpp=alp.nodify(e.tppageCont,e._top);e._mpContNode=alp.nodify(e.mpCont,e._top);e._mlpContNode=alp.nodify(e.mlpCont,e._top);e._mlpToggleNode=alp.nodify(e.mlpToggle,e._top);e._mcpContNode=alp.nodify(e.mcpCont,e._top);
e._mcpToggleNode=alp.nodify(e.mcpToggle,e._top);e._sessionExpirationTmpljsNode=alp.nodify(e.sessionExpirationTmpljs,e._top);e.tourid?(new k.GeometryOOIs([e.tourid],{proj:e.proj})).load(f):f();h.setTouchSupportClass(e._top)})})})();"undefined"!==typeof dojo&&dojo.provide("oax.where");
(function(){function k(g){function f(a){var c=alp.opt(a,"geometry"),d=alp.opt(c,"location");c=alp.opt(c,"viewport");var e=oax.PLACES_MAX_ZOOM;d=c?h.bounds2zoomcenter(c,{width:800,height:600},{maxZoom:e}):d?{center:d,zoom:e}:null;c=[];d&&c.push("zc="+d.zoom+","+alp.map(alp._gmap2_3.latlng2xy(d.center),alp.f(".toFixed(5)")).join(","));a.name&&c.push("wt="+alp.util.url_hash.encodeURIComponentExceptComma(a.name));if(a=c.length&&b+"#"+c.join("&"))window.location.href=a}function e(a){a&&a.id&&(location.href=
oax.URL_SHORT_FROM_ID(a.id))}var d=g.whereNode=alp.nodify(oax.PART_CSS_CLASS+"where"),b=alp.opt(alp.nodify("oax-where-url",d),"value");if(d){var c=oax.x["Where"+alp.sCamel(g.whereType)];g.regions?(g.where=new c({initNow:!0,node:d,proj:oax.API_CFG.proj,key:oax.API_CFG.key,useGooglePlaces:!1,usePhoton:!1,subset:"region"}),g.where.placeChangeCB(e)):(g.where=new c({node:d,initNow:!0,proj:g.proj,key:g.key,useGooglePlaces:!1}),g.where.placeChangeCB(f))}}var h=alp._gmap2_3;alp.declare("oax.Where",null,alp.nowF(function(g){alp.mixCheck(this,
g)}),{whereType:"alpstein",proj:null,key:null,regions:!1,initASAP:function(){alp.onDCL(alp.bindF(alp.nowF(k),null,this))}})})();"undefined"!==typeof dojo&&dojo.provide("oa.util.competition");
(function(){var k=alp.sub("oa.util",null,!0),h=alp.view.modalwin;k.competitionDialog=function(g){g||(g=window.event);g=g.target||g.srcElement;var f=g.id.split("_"),e=f[1],d=f[2];f=f[3];alp.gEBCN("oax-dialog-content-"+e)&&h.open({html:alp.gEBCN("oax-dialog-content-"+e)[0].innerHTML,title:g.title,height:d,width:f})};k.competitionGaEv=function(g){var f="competition";g&&g.comp&&(f+=g.comp);return f};k.competitionCookieName=function(g){var f="comp";g&&g.comp&&(f=f+"."+g.comp);return f}})();
"undefined"!==typeof dojo&&dojo.provide("oax.competition_layout");
(function(){function k(a){function b(a){alp.forEach(a,function(a){new alp.x.YTPlayer({cont:a,videoid:a.dataset.source,previewUrl:a.dataset.preview,hideControls:!1,allowfullscreen:!0,initNow:!0})})}var f=alp.nodify(oax.TOP_CONT)||alp.body();c.slideshow_setup(f,{withLightbox:!0});oax.community_layout.login_install();alp.forEach(alp.gEBCN(oax.CONT_EACH_WRAP_ANCHOR),alp.dom.anchor.wrap_ooi_snippet);f=alp.gEBCN("oax-participate-form");alp.aEL(f,"submit",function(){alp.cookie(d.competitionCookieName(a),
"participated",{path:"/",expires:60});e.emitCustomAction(d.competitionGaEv(a),"participated")});(f=alp.gEBCN("oax-dialog-node"))&&alp.aEL(f,"click",d.competitionDialog);f=alp.gEBCN("oax-one-video-cont");f.length&&b(f)}function h(a){function c(a){alp.forEach(a,function(a){new alp.x.YTPlayer({cont:a,videoid:a.dataset.source,previewUrl:a.dataset.preview,hideControls:!1,allowfullscreen:!0,initNow:!0})})}var f=alp.gEBCN("oax-competiton-wrap")[0];if(f){oax.community_layout.submitLogin_install();alp.styleform.init({now:!0,
cont:f});alp.forEach(alp.gEBCN(oax.CONT_EACH_WRAP_ANCHOR),alp.dom.anchor.wrap_ooi_snippet);var g=alp.gEBCN("oax-register-link")[0];g&&alp.aEL(g,"click",function(){e.emitCustomAction(d.competitionGaEv(a),"registered");b.generic_login_barrier_before({type:"oax-competition"})});f=alp.gEBCN("oax-participate-form",f);alp.aEL(f,"submit",function(){alp.cookie(d.competitionCookieName(a),"participated",{path:"/",expires:60});e.emitCustomAction(d.competitionGaEv(a),"participated")});(f=alp.gEBCN("oax-dialog-node"))&&
alp.aEL(f,"click",d.competitionDialog);f=alp.gEBCN("oax-one-video-cont");f.length&&c(f)}}function g(a){function b(){alp.style(c,{height:"0px",visibility:"hidden"});alp.cookie(d.competitionCookieName(a),4,{path:"/"})}var c=alp.gEBCN("oax_competition_banner")[0],e=alp.gEBCN("oax_competition_banner_close",c)[0],f=!1;if(c){var g=alp.cookie(d.competitionCookieName(a));if(!g||"participated"!=g){var h=parseInt(g);if(!h||3>h)alp.aEL(window,"scroll",function(e){0<alp.gWindowScroll().top?f||(alp.style(c,{height:a.height,
visibility:"visible"}),alp.cookie(d.competitionCookieName(a),h?h+1:1,{path:"/"})):b()}),alp.aEL(e,"click",function(a){b();f=!0})}}}var f=alp.sub("oax.competition_layout",null,!0),e=oa.ga_track_anonymous,d=oa.util,b=oa.util.community,c=oax.layout;f.OVERLAY_TIMEOUT=4E3;f.install=function(a){alp.onDCL(alp.bindF(h,null,a))};f.install2=function(a){alp.onDCL(alp.bindF(k,null,a))};f.footer=function(a){alp.onDCL(alp.bindF(g,null,a))}})();"undefined"!==typeof dojo&&dojo.provide("oax.oaregio_layout");
(function(){var k=alp.sub("oax.oaregio_layout",null,!0),h=alp.data;k.install=function(){function g(b){h.api_region_geometry({areaid:d}).then(function(a){oax.util.region_polygon(b,alp.arrChain(a&&a.encPolyline),f)})}var f={fillColor:"#000000",fillOpacity:.23},e=alp.gEBCN("oax-region-poly-id")[0],d=e&&e.value;if(d)oax._fvp&&oax._fvp.whenLoaded(function(){oax._fvp.flexview.mapCB(function(b){g(b)})}),oax._tp&&oax._tp.whenLoaded(function(){oax._tp.tp.mapCB(function(b){g(b)})});else{var b=(e=alp.gEBCN("oax-region-poly")[0])&&
e.value;b&&("undefined"!=typeof fvp&&fvp.whenLoaded(function(){fvp.flexview.mapCB(function(c){oax.util.region_polygon(c,b,f)})}),oax._tp&&oax._tp.whenLoaded(function(){oax._tp.tp.mapCB(function(c){oax.util.region_polygon(c,b,f)})}))}}})();"undefined"!==typeof dojo&&dojo.provide("oa.util.process_steps");
(function(){function k(d,b){return function(c){c||(c=window.event);c=c.currentTarget||c.target||c.srcElement;for(var a="function"===typeof b?b(c):b;!alp.hasClass(c,d.stepClass)&&(c=c.parentNode););alp.setClass(alp.filter(alp.gEBCN(d.doStepClass+d.dirFwd,c),"!alp.hasClass(v, this.stepSkipClass)",d),"oax_disabled",!a)}}function h(d){function b(b,f){function g(){alp.forEach(alp.gEBTN("input",a),"v.blur()");d.curStep=k===d.dirFwd?d.curStep+1:d.curStep-1;c(n,h);k===d.dirFwd&&alp.setClass(h,d.stepSkipedClass,
alp.hasClass(y,d.stepSkipClass));if("function"===typeof d.onStepChange)d.onStepChange();return!0}f&&alp.stopEvent(f);var h=alp.opt(b,"cur")||alp.nodify(d.currentClass,d.stepContainer),k=alp.opt(b,"dir"),l=h.id,m=d.steps,n="",r=null,y=f?f.target||f.srcElement:null;m&&m[l]&&(n=m[l][k],r=m[l].onNext);if(!n){y=y||alp.gEBCN(d.doStepClass+k,h)[0];if(!y)return!1;f=y.href?y.href:y.parentNode.href;l=f.indexOf("#");-1<l&&(n=f.substring(l+1))}b=!!alp.opt(b,"skip")||alp.hasClass(y,d.stepSkipClass);if(k!==d.dirFwd||
b||"function"!==typeof r)return g();r(g,function(a,b){e.show_exception_msg(a,b)})}function c(b,c){if(b){var e=c?c:alp.gEBCN(d.stepClass,a),f=alp.gEBI(b),g=d.curStep/d.nrSteps*100,h=alp.nodify(d.progressBar,f),k=alp.gEBTN("input",f);alp.setClass(e,d.currentClass,!1);alp.setClass(f,d.currentClass,!0);c&&alp.setClass(d.stepContainer,"oax-process-"+c.id,!1);alp.setClass(d.stepContainer,"oax-process-"+b,!0);h&&alp.style(h,{background:"linear-gradient(to right, currentColor "+g+"%, #fff "+g+"%)"});d.autofocus&&
k.length&&k[0]&&setTimeout(function(){k[0].focus()},100)}}d.initialStep.substring.call.a;d.stepContainer.childNodes.length;var a=d.stepContainer,f=alp.gEBCN(d.stepClass,a);if(d.initialStep){var h=alp.nodify(d.initialStep);(h=alp.nodify("oax-step-backward",h))&&alp.setClass(h,"oax_no_display",!0)}alp.forEach(f,function(a){var c=alp.gEBCN(d.doStepClass+d.dirFwd,a),e=alp.gEBCN(d.doStepClass+d.dirBwd,a);d.eh_or_hg.push(g(c,alp.bindF(b,null,{dir:d.dirFwd,cur:a})));d.eh_or_hg.push(g(e,alp.bindF(b,null,
{dir:d.dirBwd,cur:a})));d.eh_or_hg.push(alp.aEL(a,"keyup",function(c){c||(c=window.event);c.keyCode===alp.key.ENTER&&(c=alp.gEBCN(d.doStepClass+d.dirFwd,a),alp.filter(c,'alp.hasClass(v, "oax_disabled")').length||b({dir:d.dirFwd,cur:a},{target:c[0]}))}))});c(d.initialStep,null);return{toggleNextBtnF:alp.bindF(k,null,d),backF:alp.bindF(b,null,{dir:d.dirBwd},null),skipF:alp.bindF(b,null,{dir:d.dirFwd,skip:!0},null),isSkippableF:function(a){a||(a=alp.nodify(d.currentClass,d.stepContainer));return null!==
alp.nodify(d.stepSkipClass,a)}}}function g(d,b){alp.aEL(d,"click",alp.stopEvent);return alp.aELtouchup(d,b)}var f=alp.sub("oa.util",null,!0),e=oa.util.community;f.process_steps_install=function(d){return h(alp.mixCheck({initialStep:null,stepContainer:null,nrSteps:null,curStep:0,autofocus:!0,onStepChange:null,stepClass:"oax-process-step",currentClass:"oax-process-step-visible",errorMsgClass:"oax-validation-error",stepSkipClass:"oax-step-validation-skip",stepSkipedClass:"oax-step-skiped",doStepClass:"oax-step-",
dirFwd:"forward",dirBwd:"backward",progressBar:"oax-steps-progress",eh_or_hg:alp.Eh?new alp.Eh:alp.hg(),steps:null},d))};f.toggle_next_btn=k})();"undefined"!==typeof dojo&&dojo.provide("alp.util.anti_spam");(function(){var k=alp.sub("alp.util.anti_spam",0,1);k.hide=function(){var h=alp.gEBI("oax-avian-carriers-wrapper");h&&alp.style(h,{visibility:"hidden",position:"absolute"})};k.remove_required=function(){var h=alp.gEBI("oax-avian-carriers");h&&(h.required=!1)}})();"undefined"!==typeof dojo&&dojo.provide("oa.i.i_registration_process");
(function(){function k(a){if(!this.mobacInput){var b=alp.nodify(this[this.type+"Form"]);b&&(this.mobacInput=alp.cE("input",b,{type:"hidden",name:"mobac"}))}this.mobacInput&&(this.mobacInput.value=a);return!!this.mobacInput}function h(){var a=alp.nodify(this[this.type+"Form"]);return alp.nodify(this.emailInput,a).value}function g(){var a=alp.nodify(this[this.type+"Form"]);return alp.nodify(this.pwInput,a).value}function f(a,b){q?(a.m._exitIntercept||(a.m._exitIntercept=alp.dom.windowExitIntercept(alp.opt(q,
"reallyWantToLeave"))),b&&b()):setTimeout(alp.bindF(f,null,a,b),100)}function e(a){(a=alp.gEBCN(a.pwToggle)[0])&&alp.aEL(a,"click",alp.util.pw_toggle)}function d(a){return a.validity.valid}function b(a){t.pw_check(a);return 6<=a.value.length}function c(a){return function(b){var c=[].slice.call(alp.gEBTN("input",b));b=[].slice.call(alp.gEBTN("select",b));c=alp.filter(c.concat(b),"v.required");return alp.reduce(c,"v"+a+'(w.type === "checkbox" ? w.checked : !!w.value)',"&&"===a)}}function a(a,b,c){if(y&&
2E3>(new Date).getTime()-y)console.log("To many request in a to short time period");else{y=(new Date).getTime();var d=alp.gEBI(a.emailInput),e=alp.cfg.url.api_check_email(encodeURIComponent(d.value)),f=alp.xhrGet(e,{receiveJson:!0});alp.m(a,"startWait",d.parentNode);p.to(f,function(d){alp.m(a,"stopWait");if(200!==d.status){var f="there was an error during email validation "+d.status+" while loading url: "+e;console.error(f,d);throw Error(f,d);}(d=d.responseJson)&&"success"===d.status?b():(d&&"wrong email"===
d.status?f=alp.opt(q,"validate.emailWrongFormat")||"wrong email format":d&&"sth went wrong"===d.status?f=alp.opt(q,"validate.toManyRequests")||"to many requests":(f=alp.nodify(a.emailTmpl))?(f=f.innerHTML,f=alp.tmplJs(f,{errorMsg:d.status})):f=d.status,c({message:f,invalidField:"email-input"}))})}}function m(a,b,c){var d=alp.nodify(a.registrationForm);d?(x.remove_required(),u.submit(d,null,function(c,d){d.stopWait();alp.rEL(a.m._exitIntercept);a.isApp?location.href=c.redirect:(c=alp.nodify("oax-email-input"),
d=alp.nodify("oax-email4you-txt"),c&&d&&(d.innerHTML=alp.tmplJs(d.innerHTML,{email:c.value})),b())})):c({message:"No data available!"})}function l(a,b,c){var d=alp.nodify(a.invitationForm);d?u.submit(d,null,function(c,d){d.stopWait();c=alp.nodify("oax-email-input");d=alp.nodify("oax-email4you-txt");c&&d&&(d.innerHTML=alp.tmplJs(d.innerHTML,{email:c.value}));alp.rEL(a.m._exitIntercept);b()}):c({message:"No data available!"})}function r(a,b,c){if(b=alp.nodify(a.onboardingForm)){alp.forEach(b.children,
"alp.hasClass(v, this.stepSkipedClass) && alp.empty(v) ",a);var d="";c=alp.filter(b.elements,'v.className == "oax-favorite-activities" && v.checked');var e=alp.nodify("oax-activities-list-field");e&&(alp.forEach(c,function(a){d=0<d.length?d+","+a.value:a.value}),e.value=d);var f="";c=alp.filter(b.elements,'v.className == "oax-favorite-regions" && v.checked');if(e=alp.nodify("oax-regions-list-field"))alp.forEach(c,function(a){f=0<f.length?f+","+a.value:a.value}),e.value=f;u.submit(b,null,function(b,
c){b=b.redirect;a.mobacInput&&(b=a.mobacInput.value);alp.rEL(a.m._exitIntercept);location.href=b})}else c({message:"No data available!"})}function n(){if(this.isApp){var a=this.isStepSkippable();window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.notifySkippable?window.webkit.messageHandlers.notifySkippable.postMessage(a):"undefined"!=typeof Onboarding&&Onboarding.notifySkippable(a)}}var q,p=oa.util,v=p.community,u=p.asyncForm,t=alp.util,w=alp.i.state,x=alp.util.anti_spam;
p.to(alp.i18n.fetch("alp.all"),function(a){q=a||{}});alp.sub("oa.i",null,!0).IRegistrationProcess={type:null,proj:null,initialStep:"step0",stepContainerClass:"oax-process-steps-container",steps:null,config_registration:function(){var b={step0:{onNext:alp.bindF(f,null,this)},step1:{onNext:alp.bindF(a,null,this)},step5:{onNext:alp.bindF(m,null,this)}};return{stepContainer:this.m.stepContainer,initialStep:this.initialStep,nrSteps:6,steps:b}},config_onboarding:function(){var a={step0:{onNext:alp.bindF(f,
null,this)},step3:{onNext:alp.bindF(r,null,this)}},b=alp.filter(alp.gEBCN("oax-process-step"),'!alp.hasClass(v, "oax-step-skipped")').length-1;return{stepContainer:this.m.stepContainer,initialStep:this.initialStep,nrSteps:b,steps:a,autofocus:this.autofocus,onStepChange:alp.bindF(n,this),stepSkipedClass:this.stepSkipedClass}},config_acceptTerms:function(){var b={step1:{onNext:alp.bindF(a,null,this),forward:"step5"},step5:{onNext:alp.bindF(m,null,this),backward:"step1"}};return{stepContainer:this.m.stepContainer,
initialStep:this.initialStep,nrSteps:4,curStep:1,steps:b}},config_invitation:function(){var a={step0:{onNext:alp.bindF(f,null,this)},step5:{onNext:alp.bindF(l,null,this)}};return{stepContainer:this.m.stepContainer,initialStep:this.initialStep,nrSteps:6,curStep:1,steps:a}},install_registration:function(a,f){function g(){var a=alp.sessionStorage(),b=(a=a&&alp.oGet(a,k))&&alp.oFrom(a);b&&alp.forEach(h,function(a){alp.forIn(b,function(b,c){alp.cE("input",a,{"class":c,type:"hidden",name:c,value:b})})})}
alp.m(this,"initStyleforms",this.m.stepContainer);e(this);alp.aEL(alp.gEBI(this.emailInput),"change input",a(d));alp.aEL(alp.gEBI(this.pwInput),"change keyup",a(b));alp.aEL(alp.gEBI("step3"),"change keyup",a(c("&&")));alp.aEL(alp.gEBCN(this.agbCheck),"click",a(c("&&")));if(!f){var h=alp.gEBTN("form");a=["oax-tourplanner","TEW:DIALOG:GPX","TEW:DIALOG:KML","TEW:DIALOG:PDF"];var k=a[0];(h.length||null).mandatory;alp.forEach(a,"oa.util.community.generic_login_barrier_after({type: v}, this)",g);alp.forEach(h,
alp.bindF(v.generic_login_barrier_to_dom,null,!0))}},install_onboarding:function(a){function b(a){alp.nodify("check_cat_"+a)&&(alp.nodify("check_cat_"+a).checked=!0)}alp.m(this,"initStyleforms",this.m.stepContainer);var d=this,e=this.kx.whereOnMap.m.areaid,f=alp.bindF(a(c("&&")),null,{currentTarget:alp.gEBI("step2")});e.get()&&a(!0)({currentTarget:alp.gEBI("step2")});w.chen(e,function(a){alp.nodify(d.areaidInput).value=e.get()?e.get():"";f()});w.chen(this.kx.regionsFree.m.areaid,alp.bindF(function(){var b=
this.kx.regionsFree,c=b.m.areaid.get(),d=alp.nodify(this.regionsTmpl);if(c){var e=alp.gEBI("check_reg."+c);e?e.checked=!0:(e=alp.gEBCN(this.favoriteRegions)[0],b=(b=b.m.title)?b.get():alp.gEBCN(this.regionsInput)[0].value,d=alp.tmplJs(d.innerHTML,{areaid:c,name:b}),c=alp.cE("div",null,null,{innerHTML:d}),alp.place(c,e.firstChild,"before"),a(!0)({currentTarget:e}))}},this));alp.aEL(alp.gEBI("step1"),"change",a(c("||")));alp.aEL(alp.nodify("oax-where-clear"),"click",function(){alp.nodify(d.areaidInput).value=
"";f()});var g;if(g=alp.nodify("oax-activities-list-field"))g=g.value,0<g.length&&(alp.nodify("oax-toggle-activities").checked=!0,alp.forEach(g.split(","),b),a(!0)({currentTarget:alp.gEBI("step1")}))},install_acceptTerms:function(a){this.install_registration(a,!0);f(this)},install_invitation:function(a){this.install_registration(a,!0);f(this)},registrationForm:"oax-registration-form",onboardingForm:"oax-onboarding-form",invitationForm:"oax-invitation-form",emailInput:"oax-email-input",emailTmpl:"oax-email-in-use-tmpl",
pwInput:"oax-pw-input",pwToggle:"oax-toggle-pw",agbCheck:"oax-ckbAgb",mapCont:"oax-where-on-map",areaidInput:"oax-where-areaid",favoriteRegions:"oax-favorite-regions-cont",regionsCont:"oax-regions-free-cont",regionsInput:"oax-regions-free-input",regionsOutput:"oax-regions-free-output",regionsClear:"oax-regions-free-clear",regionsTmpl:"oax-regions-free-tmpl",stepSkipedClass:"oax-step-skiped",autofocus:!0,autosuggestSubset:"region",get_init_areaid:alp.memM("get_init_areaid","alp.opt( alp.nodify( this.areaidInput ), 'value' )  ||  '';"),
augmentModel:function(a){this.type.substring.call.a;this.proj.substring.call.a;this.get_init_areaid();a.stepContainer=alp.nodify(this.stepContainerClass);if(this.isApp=/^app-/.test(this.proj))oa.i.IRegistrationProcess.setMobAC=alp.bindF(k,this),oa.i.IRegistrationProcess.getUsername=alp.bindF(h,this),oa.i.IRegistrationProcess.getPassword=alp.bindF(g,this);x.hide()},connectView2Model:function(a,b,c,d){c=alp.m(a,"config_"+a.type);c.eh_or_hg=b;a.steps&&"object"===typeof a.steps&&alp.forIn(a.steps,"this[w] ? alp.mix(this[w], v) : this[w] = v",
c.steps);var e=p.process_steps_install(c);b=e.toggleNextBtnF;a.isApp&&(oa.i.IRegistrationProcess.back=e.backF,oa.i.IRegistrationProcess.skip=function(){return e.isSkippableF()&&e.skipF()},a.isStepSkippable=e.isSkippableF);alp.m(a,"install_"+a.type,b)}};oa.i.IRegistrationProcess.checkSubmit_install=function(a,b,c){alp.aEL(a,b,p.toggle_next_btn({stepClass:"oax-steps-container",doStepClass:"oax-submit-btn",dirFwd:"",stepSkipclass:""},c))};var y=oa.i.IRegistrationProcess.back=null})();
"undefined"!==typeof dojo&&dojo.provide("oax.registration_process");
(function(){alp.declare("oax.RegistrationProcess",alp.x.AbstractController,null,oa.i.IRegistrationProcess,{initStyleforms:function(k){alp.styleform.init({now:!0,cont:k})},startWait:function(k){(this._waitbox||(this._waitbox=new alp.x.Waitbox)).setTarget(k).startWait()},stopWait:function(){var k=this._waitbox;k&&k.stopWait().setTarget(null)},augmentKids:function(k){var h=alp.nodify(this.mapCont,this.m.stepContainer);h&&(k.whereOnMap=new oax.WhereOnMap({node:h,proj:this.proj,usePhoton:!1,subset:this.autosuggestSubset,
areaid:this.get_init_areaid()}));if(h=alp.nodify(this.regionsCont,this.m.stepContainer))k.regionsFree=new oax.WhereOnMap({node:h,proj:this.proj,usePhoton:!1,subset:this.autosuggestSubset,clearOnSelect:!0,inptClass:this.regionsInput,clearClass:this.regionsClear,stateClass:this.regionsCont,mapClass:null})}})})();"undefined"!==typeof dojo&&dojo.provide("oax.util.map_init");
(function(){var k=alp.sub("oax.util",null,!0),h=oa.util;alp.maps.mapconfig.SEP();k.map_init_opt=function(g){if(g){var f=g.mapInit;if(f){g=alp.mix({},g);delete g.mapInit;var e={};h.fvp_cfg_map_init(e,f);if(f=alp.oGet(e,"maplayer.basemap.init"))g.mapTypeId=f;(f=(f=alp.oGet(e,"maplayer.mapoverlay.init"))&&alp.oKeys(alp.filterIn(f,"")))&&alp.oSet(g,"oa.overlayMapTypeIds",{"*":f});(e=alp.oGet(e,"maplayer.basemap.layer"))&&0<e.length&&alp.oSet(g,"mapTypeControlOptions.mapTypeIds",e)}e=g.mapTypeId;f=alp.oGet(g,
"mapTypeControlOptions.mapTypeIds")||[];e&&f&&0>alp.lastIndexOf(f,e)&&alp.oSet(g,"mapTypeControlOptions.mapTypeIds",f.concat(e))}g||(g={});alp.oGet(g,"mapTypeControlOptions.mapTypeIds")||(e={},k.fvp_cfg_map_init(e,{}),(f=alp.oGet(e,"maplayer.basemap.layer"))?alp.oSet(g,"mapTypeControlOptions.mapTypeIds",f):console.error("oaxu:map_init: could not determine default mtids"));if(!alp.oGet(g,"mapTypeId")){e={};k.fvp_cfg_map_init(e,{});var d;(e=alp.oGet(e,"maplayer.basemap.init")||(d=alp.oGet(g,"mapTypeControlOptions.mapTypeIds"))&&
d.length&&d[0])?alp.oSet(g,"mapTypeId",e):console.error("oaxu:map_init: could not determine default init mapTypeId")}return g}})();"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.empty_maptype");
(function(){function k(f,e,d){return alp.cE("img",null,{src:g,width:256,height:256})}var h=alp.sub("alp.gmap3",null,!0),g=alp.cfg.image().transp_1x1;h.empty_maptype=function(f){var e=f.minZoom||0;f=f.maxZoom;e.toPrecision.call.a;f.toPrecision.call.a;return{getTile:k,tileSize:{width:256,height:256},maxZoom:f,minZoom:e,name:"AG3:empty_maptype"}}})();"undefined"!==typeof dojo&&dojo.provide("alp.gmap3.raster_maptype");
(function(){var k=alp.gmap3;alp.cfg.image();var h;k(function(f){h=f});k.raster_maptype=function(f){function e(a,b,c){return alp.cE("img",null,{src:d(a,b)})}function d(a,b){var c=a.x;a=a.y;var d=m.subdomains[(c+a)%m.subdomains.length];return alp.tmplWithoutDollar(m.tiles[d]||m.tiles[0],{s:d,x:c,y:a,z:b})}var b="raster"in f?f:{raster:f},c="AG3:raster_maptype_"+g++,a=h&&k.maybe_mt_of_mapconfig&&b.raster&&k.maybe_mt_of_mapconfig(h,c,b);if(!a){var m=(b.raster.rasterStack||[])[0];if(m){var l=m.minZoom||
0,r=m.maxZoom;alp.isFiniteNumber(l)&&alp.isFiniteNumber(r)&&(a={getTile:e,name:c,minZoom:l,maxZoom:r,tileSize:{width:256,height:256}},a._alp_imtcfg_arr=[alp.oCreateMix(a,{getTileUrl:d})])}}a||(console.error("AG3:raster_maptype: could not create",f," => falling back onto empty maptype."),a=k.empty_maptype(b.raster));return a};var g=0})();"undefined"!==typeof dojo&&dojo.provide("alp.maps.mapconfig.get_maybe_mtcfg");
(function(){var k=alp.sub("alp.maps.mapconfig",null,!0),h=k.MAYBE_VECTOR_MAPTYPEID_SPLIT;k.get_maybe_mtcfg=function(g,f){var e="string"===typeof f?h(f):f;f=e.style;return(g=alp.or(g.maps||[],"v.name === this.basename  &&  v",{basename:e.basename}))&&alp.or((g.styles||[]).concat(g.overlays||[]),"v.name === this.style  &&  v",{style:f})||null}})();"undefined"!==typeof dojo&&dojo.provide("oax.x.tilelayer");
(function(){function k(a){alp.sub("oa.api.maps")?oa.api.maps(a):alp.sub("alp.gmap3")?alp.gmap3(a):a()}var h=alp.cfg.maptypeid,g=alp.gmap3,f=alp.maps.mapconfig;f.SEP();var e=h.get_new_mtid,d=g.empty_maptype,b=g.raster_maptype,c=f.MAYBE_VECTOR_MAPTYPEID_SPLIT,a=f.get_maybe_mtcfg,m=f.is_style_vector_ready;h=alp.sub("oax.x",0,1);h.showCopyright=function(a){k(function(){a.__alp_copyright||(a.__alp_copyright=new alp.gmap3.x.Copyright(a))})};h.tilelayer=function(f,h){function l(a,b,c){var d=alp.cE("div");
k(function(e,f){g.maptype(r,{layermask_fineformat:"jsonp"}).then(function(e,f){alp.aC(d,f.getTile(a,b,c));w._alp_copyright_spec=f._alp_copyright_spec})});return d}function q(a,b){var c=alp.dfrd("oax:x:tilelayer:"+u+":loadTileData",{then:1});g.maptype(r,{layermask_fineformat:"jsonp"}).then(function(a,b){c.done(b)});return c}function p(a,b,c,d){a=d&&alp.oGet(d,"tileSize.width")||256;var e=d&&alp.oGet(d,"tileSize.height")||256,f;a=d.getTile?d.getTile(c,c.z,document):alp.cE("img",null,{src:f=d.getTileUrl(c,
c.zoom),width:a,height:e});f?alp.aC(alp.empty(b),alp.style(a,{position:"absolute",top:"0",left:"0"})):(this._empty_url_warned||(this._empty_url_warned=!0,console.error("empty URL for mt ",d," at ",c,'. Maybe an old mtid? Mapping-to-vector issues? In any case try to convert your old ids e.g. "oa_hiking" to new ones e.g. "oac:hiking", "osm:hiking".')),alp.empty(b))}var r=alp.sub("oa.api.maps")&&e(f)||f,u=h||{oa_map:"Outdooractive",oa_map_winter:"Outdooractive Winter",oa_hybrid:"Outdooractive Hybrid",
oa_osm:"OpenStreetMap",oa_osm_winter:"OpenStreetMap Winter",oa_topo:"Outdooractive Topo","oac:summer":"Outdooractive Summer","oac:winter":"Outdooractive Winter","oac:hybrid":"Outdooractive Hybrid","osm:summer":"OpenStreetMap Summer","osm:winter":"OpenStreetMap Winter","osm:hybrid":"OpenStreetMap Hybrid","topo:topo":"Outdooractive Topo"}[r]||r;f=c(r);var t=alp.sub("oa._MAPCONFIG");if(f){if(t)if(t=(f=a(t,f))&&(f.title_unique||f.title),!h&&t&&(u=t),m(f)){var w=d(f.raster);w.vector_mtcfg=f}else f&&(w=
b(f));else console.error("oax.x.tilelayer: could not find mapconfig. Trying to fallback onto raster.");w&&u&&(w.name=w._alp_custom_name=u)}w||(w={getTile:l,maxZoom:18,tileSize:{width:256,height:256},name:u,getTileUrl:alp.f('"'+alp.cfg.image().transp_1x1.url+'"'),_lfgm_customTile:{loadTileData:q,receiveTileData:p},_oa_mtid:r});h&&(w._alp_custom_name=h);w._alp_imtcfg_arr||(w._alp_imtcfg_arr=[w]);return w}})();"undefined"!==typeof dojo&&dojo.provide("oax.api");
(function(){var k=alp.maps.mapconfig.get_polished_mapconfig,h=oax.util,g=alp.data.api.get_mapconfig_paid_dfrd();oa._api_install("oax",function(f,e,d,b){function c(b){function c(c){b(a,c)}alp.gatherDfrd([alp.subDfrd("alp.gmap3"),g],{then:!0}).then(function(a){var b=a[0][0];a=a[1][0];a||null.bug;oa._MAPCONFIG||(/[\?&]xxxev=0(?:&|$)/.test(location.search)&&(a.enableVector=!1),/[\?&]xxxev=1(?:&|$)/.test(location.search)&&(a.enableVector=!0),oa._MAPCONFIG=k(a));b(c)})}oa.API_SAMEHOST&&alp.util.bCookieMessage();
b(d,{Lightbox:[alp.x,{proj:0}],OOIs:[alp.data,{proj:0}],SingleOOI:[alp.data,{proj:1}]});var a={};d.maps=c;c(function(a){b(a,{ClusterLayer:[alp._gmap2_3,{proj:0,iwClass:[0,["oax alp-x-clickable"]]}],FilterClusterLayer:[alp._gmap2_3,{proj:0,iwClass:[0,["oax alp-x-clickable"]]}],GeomLayer:[alp._gmap2_3,{proj:1},{oldName:"TourPoiLayer"}],iwCloseAll:[alp._gmap2_3],iwOpen:[alp._gmap2_3],Map:[alp.gmap3,null],SkiresortLayer:[alp.ski,{proj:0}],WhereOnMap:[oax,{proj:0}]});a.tilelayer=alp.bindF("tilelayer",
oax.x);a.map=function(b,c){c=h.map_init_opt(c);return new a.Map(alp.nodify(b),c)};a.setOverlay=alp._gmap2_3.setOvmtLater});f=alp.sub(f+".priv",null,!0);f.mypage=function(a){(e._mp=new e.MyPage(d.opt2cfg(a))).initASAP()};f.author_edit=function(a){(e._cep=new e.AuthorEditPage(d.opt2cfg(a))).initASAP()};f.list=function(a){(e._cp=new e.ListPage(d.opt2cfg(a))).initASAP()};f.list_edit=function(a){(e._cep=new e.ListEditPage(d.opt2cfg(a))).initASAP()};f.team_activity_edit=function(a){(e._cep=new e.TeamActivityEditPage(d.opt2cfg(a))).initASAP()};
f.communitypage=function(a){(e._com=new e.CommunityPage(d.opt2cfg(a))).initASAP()};f.where=function(a){var b=alp.oCreateMix(alp.oCreateMix({whereType:"alpstein"},a),d.opt2cfg(b));(e._wh=new e.Where(b)).initASAP()};f.search=function(a){(e._s=new e.Search(d.opt2cfg(a))).initASAP()};f.tppage=function(a){a=e._tp=new e.TpPage(d.opt2cfg(a));a.initASAP();return a};f.guide=function(a){e.guide_layout.install(d.opt2cfg(a))};f.author=function(a){(e._ap=new e.AuthorPage(d.opt2cfg(a))).initASAP()};f.source=function(a){(e._sp=
new e.SourcePage(d.opt2cfg(a))).initASAP()};f.webpageItems=oax.webpageItems})})();"undefined"!==typeof dojo&&dojo.provide("oa.all");
