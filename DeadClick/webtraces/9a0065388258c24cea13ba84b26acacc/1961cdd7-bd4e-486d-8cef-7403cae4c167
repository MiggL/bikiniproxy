define(["jquery","wcs.context","pubsub","shared.main.screen"],function(b,a){(function(g,f,d,h){var e="OnlineDealers";var c=function(i){this.$element=g(i);this.$productForm=this.$element.closest(".product-form-js");this.onlineDealerURL=a.getURLWithContextRoot(g(this.$element).first().data("bfd-url"));this._viableOnlineDealer=[];this.onlineDealerFirstLoad=true;this._cachedOnlineDealerList=this._cachedOnlineDealerList||0;this._onlineDealerProductIds=[];this.storeId=a.getStoreId();this.langId=a.getLangId();this.productId=this.$element.closest(".product-form-js").find("input[name=catEntryId]").val()};c.prototype={init:function(){var i=this;console.log("Initializing Online Dealers");i.initOnlineDealer();i.initOnlineDealerEvents();return i},initOnlineDealer:function(){var i=this;if(i.onlineDealerFirstLoad&&i.onlineDealerURL){g.ajax({type:"GET",url:i.onlineDealerURL,data:{storeId:i.storeId,langId:i.langId,productId:i.productId},dataType:"JSON"}).done(function(j){i.handleOnlineDealerResponse(j)})}},initOnlineDealerEvents:function(){var i=this;g.pubsub("subscribe","WCS.PDPSWATCHES.PRODUCTFORM.EVENT.FORMCLICK",function(){i.handleOnlineDealersSection()});g.pubsub("subscribe","window.resize",function(){i.populateOnlineDealers()});g.pubsub("subscribe","WCS.PRODUCTFORM.EVENT.ONLINEDEALER.ACTIVE",function(){i.displayOnlineDealers()})},handleOnlineDealerResponse:function(j){var i=this;i.onlineDealerFirstLoad=false;i._cachedOnlineDealerList=j;i._cachedOnlineDealerList.map(function(l,k){Object.keys(l.products).map(function(m){i._onlineDealerProductIds.push(m)})});i.$element.each(function(){var l=g(this),k=g(".dealer-info-template-js",l);i._cachedOnlineDealerList.map(function(o,n){var m=k.clone().hide();m.attr("id",i._cachedOnlineDealerList[n].id);m.find(".dealer-logo-js").attr("data-src",i._cachedOnlineDealerList[n].logo);m.find(".dealer-name-js").text(i._cachedOnlineDealerList[n].name);m.appendTo(l)})})},displayOnlineDealers:function(){var i=this;g(".notify-me-container-js").removeClass("expanded");i.$element.each(function(){var j=g(this);if(j.hasClass("expanded")){j.slideUp(500);j.removeClass("expanded")}else{i.populateOnlineDealers();g("img.lazy",j).lazyload();j.slideDown(500,function(){i.scrollToSection(j)});j.addClass("expanded")}})},scrollToSection:function(i){g("html, body").animate({scrollTop:i.offset().top},500)},populateOnlineDealers:function(){var i=this;i.$element.each(function(){var m=g(this),l=g(f).width(),k=1,j=g(".dealer-info-template-js",m),n=m.data("column-"+main.screen.size());j.removeClass("first");j.removeClass("last");j.hide();i._viableOnlineDealer.map(function(q,p){var r=g("#"+i._viableOnlineDealer[p],m),o;r.show();o=k++%n;if(o===0){r.addClass("last")}else{if(o==1){r.addClass("first")}}})})},getOnlineDealers:function(k){var i=this,j=false;i._viableOnlineDealer=[];if(!i._cachedOnlineDealerList){return}Object.keys(i._cachedOnlineDealerList).map(function(m){var n=i._cachedOnlineDealerList[m].products,l=i._cachedOnlineDealerList[m].id;if(n[k]){j=true;product=n[k];g("#"+l).attr("href",product.url)}if(j){i._viableOnlineDealer.push(l);j=false}});return i._viableOnlineDealer},getProductColorCode:function(m,o,l){var j=this,k=g(".product-attr-form .attr-color").attr("data-attribute-id")||null,i=g(".product-attr-form .attr-size").attr("data-attribute-id")||null,n;if(k===null){n=m.attributes[i][l]}else{n=m.attributes[k][o]}if(typeof n!=="undefined"){n.map(function(p,q){if(j._onlineDealerProductIds.indexOf(p)>-1){g(".attr-size .attr-box:eq("+[q]+")",j.$productForm).removeClass("out-of-stock")}})}},handleOnlineDealersSection:function(){var i=this;if(g(".online-dealer-js").hasClass("expanded")){i.displayOnlineDealers();g(".online-dealer-js").removeClass("expanded").slideUp()}}};g.fn.OnlineDealers=function(){return this.each(function(){var i=g(this).data(e);if(!i){i=new c(this).init();g(this).data(e,i)}})}})(jQuery,window,document)});