define(["jquery","pubsub","wcs.context","wcs.product-form-core","wcs.product-form-util"],function(f,e,a,c){var b=false,d="AddToCartForm";var g=function(h){if(!(this instanceof g)){return new g(h)}this.productForm=f(h);return this};g.prototype={initAddToCart:function(){this.unbindAddToCartEvents();this.initAddToCartEvents();this.initProductFormCore();return this},unbindAddToCartEvents:function(){f.pubsub("unsubscribe",this.updateItemSelectionInStockEventToken);f.pubsub("unsubscribe",this.addToCartItemSelectionInStockEventToken);f.pubsub("unsubscribe",this.addToWishListMessaging);this.productForm.find(".add-to-bag-js").unbind("click",this.handleAddToBagClick);this.productForm.off("submit",this.handleAddToBagClick)},initAddToCartEvents:function(){var h=this;this.productForm.find(".add-to-bag-js").on("click",{self:this},this.handleAddToBagClick);this.productForm.on("submit",{self:this},this.handleAddToBagClick);this.addToCartItemSelectionInStockEventToken=f.pubsub("subscribe","WCS.PRODUCTFORM.CURRENT_SELECTION.HAS_INVENTORY",function(j,i){if(i===h.productFormIndex){if(b){console.log("capture WCS.PRODUCTFORM.CURRENT_SELECTION.HAS_INVENTORY")}h.enableAddToCartButtonForInStockSelection()}})},handleAddToBagClick:function(k){if(b){console.log("handleAddToBagClick")}var j=k.data.self,i=j.productForm.find(".add-to-bag-js"),h=j.productForm.find(".out-of-stock"),l=j.isValidForm();k.preventDefault();if(i.hasClass("notify-me-active")){f.pubsub("publish","WCS.PRODUCTFORM.EVENT.NOTIFYME.ACTIVE");return}else{if(i.hasClass("bfd-active")){f.pubsub("publish","WCS.PRODUCTFORM.EVENT.ONLINEDEALER.ACTIVE");return}}if(i.hasClass("disabled")){return}if(!l){return}if(!f("#uclw").length){j.addToBag(k);return}if(j.selectChangeComplete===true&&f("#uclw").length&&f("#uclw").is(":visible")){j.addToBag(k);j.selectChangeComplete=false;return}else{setTimeout(function(){j.productForm.find(".add-to-bag-js").click()},100)}},addToBag:function(k){if(b){console.log("addToBag")}var i=k.data.self,h=i.buildDataObjectForValidAddToBag(),j=a.getContextRoot()+"VFAjaxOrderItemAdd";f.pubsub("publish","vfdp.wcs.product_form.add_to_cart_clicked");i.submitForm(h,j,function(l){i.handleFormSubmitResponse(l)})},buildDataObjectForValidAddToBag:function(){if(b){console.log("buildDataObjectForValidAddToBag")}var i=this;var h={};h.categoryId=i.categoryId;h.storeId=i.storeId;h.langId=i.langId;h.catalogId=i.catalogId;h.catEntryId=i.catEntryId;h.quantity=f.productFormUtil.getQuantity(i.productForm);h.orderId=".";h.URL="/";return h},handleFormSubmitResponse:function(i){if(b){console.log("handleFormSubmitResponse")}if(i.orderId){f.productFormUtil.clearAddTOCartErrorMessage(this.productForm);f.pubsub("publish","ORDER_ID_UPDATED",{orderId:i.orderId});var l=f(".product-form-js").index(this.productForm);f.pubsub("publish","vfdp.wcs.product_form.add_to_cart_succeeded",{productFormIndex:l});var m=this.productForm.parents(".bundle-product-info-js"),h,n=this.productForm.data("child-part-number"),j=this.productForm.data("bundle-part-number").toString(),k=this.productForm.data("product-part-number");if(m.length>0){h=m.find(".product-info-js").data("catentry-name-dl")}else{h=f("#product-info .product-info-js:not(.hide)").data("catentry-name-dl")}f.pubsub("publish","SHOPCART_UPDATED.add",{product:[{bundleId:j,itemId:n,name:h,productId:k,}],rewardEligibility:{orderId:i.orderId[0],rewardOptionEligible:i.rewardOptionEligible,rewardsAdded:i.rewardsAdded,},action:"add"})}else{f.productFormUtil.displayErrorMessage(i.errorMessage,this.productForm);f.productFormUtil.setProductGridProductHeights()}},addToWishList:function(k){if(b){console.log("addToWishList")}var i=this,j,h;k.preventDefault();if(!i.checkAllAttributeSelection()){return}h=i.buildDataObjectForValidAddToWishList();j=a.getContextRoot()+"VFAjaxInterestItemAdd";i.submitForm(h,j,function(l){i.handleWishListAddResponse(l)})},addToWishListMessaging:function(h){f.pubsub("subscribe","vfdp.wcs.product_form.add_to_wishlist_message",function(k,l){if(f(".add-to-wishlist-js").attr("data-changed-add-to-wishlist-text")){var j=l.formAction;var m=f(".add-to-wishlist-js").attr("data-changed-add-to-wishlist-text");var i=f(".add-to-wishlist-js").attr("data-default-add-to-wishlist-text");if(j==="success"){f(".add-to-wishlist-js .wishlist-button-text").text(m);f(".add-to-wishlist-js .icon-check").removeClass("hide");f(".add-to-wishlist-js").addClass("success")}else{f(".add-to-wishlist-js .wishlist-button-text").text(i);f(".add-to-wishlist-js .icon-check").addClass("hide");f(".add-to-wishlist-js").removeClass("success")}}})},buildDataObjectForValidAddToWishList:function(){if(b){console.log("buildDataObjectForValidAddToWishList")}var i=this,h={};h={};h.storeId=i.storeId;h.langId=i.langId;h.catalogId=i.catalogId;h.catEntryId=i.catEntryId;h.quantity=(!f.productFormUtil.isValidQuantity(i.productForm)?1:f.productFormUtil.getQuantity(i.productForm));h.listId=".";h.URL="/";return h},handleWishListAddResponse:function(h){if(b){console.log("handleWishListAddResponse -- ","response : ",h)}if(h.listId){f.pubsub("publish","WISHLIST_UPDATED");if(f(".wishlist-js").length>0){f(".wishlist-js").trigger("click")}var i=f(".product-form-js").index(this.productForm);f.pubsub("publish","vfdp.wcs.product_form.add_to_wishlist_succeeded",{productFormIndex:i});f.pubsub("publish","vfdp.wcs.product_form.add_to_wishlist_message",{formAction:"success"})}else{f.productFormUtil.displayErrorMessage(h.errorMessage,this.productForm)}},enableAddToCartButtonForInStockSelection:function(){if(b){console.log("enableAddToCartButtonForInStockSelection")}var h=this.addToCartButton.attr("data-add-to-cart-text")||this.addToCartText,i=this.addToCartButton.attr("data-out-of-stock-text")||LANG_MSG.OUT_OF_STOCK;this.productForm.find(".availability-information").hide();this.addToCartButton.removeClass("notify-me-active");if(i!==undefined){if(b){console.log("removing out of stock class")}this.addToCartButton.removeClass("disabled btn-out-of-stock").text(h)}if(b){console.log("showing add to cart button")}if(this.hasAgeVerification){this.updateAgeVerification()}else{this.addToCartButton.show().removeClass("disabled");this.updateItemButton.show().removeClass("disabled");this.productForm.find(".customize-button-js").show()}if(this.productForm.find(".quantity-text-js")){this.updateItemButton.show().removeClass("disabled")}if(!this.productForm.is(".authorized-retailer")){this.productForm.find(".find-brand-store-js").hide()}this.productForm.find(".notify-me-button-container-js").addClass("hidden");this.productForm.find(".qty-step-js").removeClass("hide");this.productForm.find(".out-of-stock-js").hide()}};f.extend(g.prototype,c.prototype);f.fn.AddToCartForm=function(h){return this.each(function(){var i=f(this).data(d);if(!i){i=new g(this,h).initAddToCart();f(this).data(d,i)}})}});