window._fitAnalytics=function(){var t=window._fitAnalytics.shop={prefix:"tnf-",timers:{},products:{sizes:{}},hideSizeChart:!0,isTouchDevice:/ipad|iphone|android|iemobile|blackberry/i.test(window.navigator.userAgent)&&("onorientationchange"in window&&"ontouchstart"in window||"ontouchstart"in window)},e=function(e,i){return e instanceof t.$&&(setTimeout(function(){"OPTION"===e.prop("tagName")?e.parent().val(e.val()).trigger("change"):e.click()},parseInt(i,10)||0),e)};t.getLanguage=function(){for(var t=window.dataLayer||[],e=0;e<t.length;e++)if(t[e].hasOwnProperty("language"))return t[e].language;return"fr"===(window.SCENE7&&window.SCENE7.LOCALE)&&"CA"===this.getShopCountry()?"fr":"en"},t.getShopCountry=function(){for(var t=window.dataLayer||[],e=0;e<t.length;e++)if(t[e].hasOwnProperty("country"))return t[e].country;var i=document.querySelector("#master-header .country-name")||document.createElement("span"),n=(i.textContent||i.innerText||"").trim().substring(0,2).toUpperCase();return"UK"===n?"GB":n},t.getProducts=function(){var t=this;return(this.areProductsLoaded?this.$("#product-detail, #modal.quickview-modal"):this.$("#product-detail .color-swatches-js label, #modal.quickview-modal .color-swatches-js label")).map(function(){var e=t.$(this);return{el:e,serial:t.getProductSerial({el:e})}})},t.getProduct=function(t,e){var i=this.products[t]||this.getProducts()[0];return e&&Object(e)===e&&this.$.extend(i,e),i.sizes=this.getSizes(i),i.props={thumb:this.getThumbnail(i),language:i.props&&i.props.language||this.getLanguage(i),shopCountry:i.props&&i.props.shopCountry||this.getShopCountry(i),productSerial:t=this.getProductSerial(i),manufacturedSizes:i.sizes.manufactured},this.products[t]=this.products[t]||{},this.$.extend(this.products[t],i)},t.getProductSerial=function(e){if(this.areProductsLoaded){var i=t.getFirstThumbnail(e),n=i.match(/\/([^\/_]+)_([^\/_]+)[^\/]+/);if(n)var r=n.slice(1).join("").replace(/\-C1/,"");else{var a=e.el.find("img");if(!(n=a.attr("id")))return;var r=n.replace("_hero","").replace("_","")}}else{var a=e.el.find("img"),n=a.attr("id");if(!n)return;var r=n.replace("_hero","").replace("_","")}return t.prefix+r},t.getFirstThumbnail=function(t){var e=t.el.find(".color-swatches-js label.clicked img").first();return e.attr("src")||e.attr("data-src")||""},t.getThumbnail=function(t){var e=t.el.find(".selected-view-js img.product-img-js").first();return e.attr("src")||e.attr("data-src")||""},t.getSizes=function(t,e){var i=this,n={dic:{},manufactured:{}},r=t.el.find(".attr-size:eq(0) label"),a=t.el.find(".attr-size:eq(1) label"),o=this.products.sizes[t.serial]||{isSizeInStock:new RegExp(".")};return n.are2D=Boolean(a.length),r.each(function(){var t=i.$(this),e=(t.text()||"").trim();if(!n.are2D&&void 0===n.dic[e]){(n.manufactured[e]=!t.hasClass("out-of-stock"))&&(n.dic[e]=t)}a.each(function(){var r=i.$(this),a=(r.text()||"").trim(),s=a&&e&&e+"/"+a;if(s&&void 0===n.dic[s]){(n.manufactured[s]=o.isSizeInStock.test(s))&&(n.dic[s]=i.$([t[0],r[0]]))}})}),"function"==typeof e&&this.getSizesData(t,n,e),n},t.getSizesData=function(t,e,i){var n=this;if(!e.are2D||n.products.sizes[t.productId])return t.props.manufacturedSizes=e.manufactured,void i(null,t);n.$.ajax({url:"/webapp/wcs/stores/servlet/VFAjaxProductAvailabilityView",data:{langId:this.$('meta[name="langId"]').attr("content")||"",storeId:this.$('meta[name="storeId"]').attr("content")||"",productId:t.el.find("section[data-product-id]").first().attr("data-product-id")}}).always(function(e){if(!e||!e.stock)return void i(new Error("empty response"),t);var r=t.el.find("[data-attribute-id]:eq(2)").data("attribute-id"),a={};n.$.each(e.attributes&&e.attributes[r],function(t,e){n.$.each(e,function(e,i){a[i]=t})});try{n.$.each(e.stock,function(t,i){if(i&&e&&e.partNumbers&&e.partNumbers[t]){var r=e.partNumbers[t].split(":"),o=/^NF/.test(r[0])?3:2,s="tnf-"+r.slice(0,o).join("").trim(),c=r.slice(o,o+2),u=n.products.sizes[s]||(n.products.sizes[s]={}),d=u.isSizeInStock?u.isSizeInStock.source+"|^":"^",l=a[t];u.isSizeInStock=new RegExp(d+(c[1]?c[0]+"\\/"+(l?l+"$":c[1].substring(0,1)):c[0]+"$"),"i")}}),i(null,n.getProduct(t.productSerial))}catch(t){i(t)}})},t.styles={el:"#fitanalytics__style--fixes",cache:{},write:function(e,i){if("string"==typeof e&&Object(i)===i){t.$(this.el).remove(),this.cache[e]=i;var n=function e(i){return t.$.map(i,function(t,i){return"string"==typeof t?i+":"+t+";":i+" {"+e(t)+"}"}).join("")}(this.cache);t.$(document.body).append('<style id="'+this.el.substring(1)+'">'+n+"</style>")}}},t.sizeChart={el:".find-size-btn-js.step-content-size-chart:not(.fitanalytics__button)",css:function(e){t.styles.write(this.el,e)}},t.sizeAdvisor={text:{de:["Finde deine Größe","Deine Größe ist"],en:["Find your size","Your size is"],es:["Encuentra tu talla","Tu talla es"],it:["Trova la tua taglia","La tua taglia è"],nl:["Vind uw maat","Jouw maat is"],pt:["Encontrar seu tamanho","Seu tamanho é"],fi:["Löydä oma kokosi","Sinun kokosi on"],fr:["Trouver ma taille","Votre taille est"],ru:["Найдите свой размер","Ваш размер"],se:["Hitta din storlek","Din storlek är"],tr:["Size uyan bendeni bulun","Sizin bedeniniz"]},getText:function(t){var e=t.recommendedSize,i=this.text[t.props.language]||["Find your size","Your size is"];return(t.sizes.manufactured[e]?[i[1],e]:[i[0]]).join(" ")},find:function(t){return t.el.find(".fitanalytics__button#"+t.serial)},getMarkup:function(e){var i=e.recommendedSize,n={cursor:"pointer",display:"inline-block","padding-top":"10px",width:"100%"};return t.isTouchDevice&&(n.display="block",n["text-align"]="center"),e.el.hasClass("quickview-modal")||(n["margin-bottom"]="15px"),t.$("<div></div>").attr({id:e.serial,class:"fitanalytics__button"}).css(n).append(t.$("<img>").attr({src:"//integrations.fitanalytics.com/shop/tnf/fit-finder-pdp.svg",class:"fitanalytics__button-img",onmouseenter:"this.style.opacity=0.7",onmouseleave:"this.style.opacity=1"}).css({height:"23px",display:"inline-block","line-height":"24px","margin-right":"7.5px","vertical-align":"top"})).append(t.$("<a></a>").attr({type:"button",class:"fitanalytics__button-text"}).css({color:e.sizes.manufactured[i]?"#e72b1e":"black",width:"auto",margin:"0",height:"auto",outline:"none",display:"inline-block","font-size":t.isTouchDevice?"16px":"18px","text-align":t.isTouchDevice?"center":"normal","line-height":"24px","vertical-align":"top"}).html(this.getText(e)))},onOpen:function(e,i){return function(){return t.getSizes(t.getProduct(e),function(e,n){t.error=e,i.reconfigure(n.props,function(){i.open(n.props)})}),!1}},render:function(t,e){var i=this.getMarkup(t).on("click",this.onOpen(t,e));if(t.el.find(".fitanalytics__button").remove(),t.el.find(".attr-size:eq(0)").append(i),t.el.hasClass("quickview-modal")){var n=i.find(".fitanalytics__button-text"),r=n.attr("style");n.prop("style",(r&&r+";"||"")+"float: initial !important; margin: 0;")}}},t.createWidget=function(){var i=this,n=new window.FitAnalyticsWidget({prefetch:!1,language:i.getLanguage(),shopCountry:i.getShopCountry(),cart:function(i,r){var a=n.options.recommend(i,r),o=a.sizes.dic[r];return o&&(o.each(function(i,n){e(t.$(n))}),e(a.el.find("#buttonAddToBag"),1e3)),a},close:function(t,e,i){return n.options.recommend(t,e,i)},recommend:function(t,e){i.isWaitingRecommendation=!1;var r=i.getProduct(t);return r.recommendedSize=r.sizes.manufactured[e]?e:null,i.sizeAdvisor.render(r,n),r},open:function(){Object.keys(i.products).forEach(function(t){var e=i.products[t];e&&(e.recommendedSize=null)})}});return n},t.onProductLoaded=function(t,e){var i=this;t.isSupported?this.isWaitingRecommendation||this.sizeAdvisor.find(t).length||(t.recommendedSize?this.sizeAdvisor.render(t,e):(this.isWaitingRecommendation=!0,this.getSizes(t,function(t,n){i.error=t,e.getRecommendation(n.props)}))):t.el.find(".fitanalytics__button").remove(),this.hideSizeChart&&this.sizeChart.css(t.isSupported?{display:"none"}:{})},t.timers.onPageChange=setInterval(function e(){var i=t;if(i.widget||(i.widget=i.createWidget()),i.$=i.widget&&i.widget.jquery,"function"==typeof i.$){var n=i.getProducts(),r=[];if(n.each(function(t,e){var n=e.serial;n&&!i.products[n]&&(i.products[n]=e,i.areProductsLoaded=!1,r.push(n))}),r.length){var a=function(t){i.$.each(t,function(t,e){var n=i.products[e&&e.garment&&e.garment.serial];n&&(n.isSupported=!0)}),i.areProductsLoaded=!0,e()};i.widget.requestProducts(r,a,a)}else i.areProductsLoaded&&n.each(function(t,e){var n=e.serial;if(i.products[n]){var r=i.getProduct(n,e);i.onProductLoaded(r,i.widget)}})}},500)},function(){var t=document.createElement("script");t.setAttribute("src","//widget.fitanalytics.com/widget.js"),t.setAttribute("type","text/javascript"),document.body.appendChild(t)}();