define(["jquery","domReady","wcs.product-form-util","pubsub"],function(f,c){var a=false,e=false,b="PDPSwatchesEvents",d=f("body.pdp-drawer, .quickview-box.pdp-drawer").length||false;var g=function(h){if(!(this instanceof g)){return new g(h)}this.productForm=f(h);this.productFormIndex=f(".product-form-js").index(this.productForm);return this};g.prototype={initPDPSwatchesEvents:function(){if(a){console.log("initializing PDP Swatches Events")}this.globalEvents();this.PDPSwatchesEvents();return this},globalEvents:function(){var h=this;f(document).on("QUICKSHOP_DISPLAY","REFRESH_PRODUCT_AVAILABILITY",function(i){if(e){console.log("QUICKSHOP_DISPLAY","REFRESH_PRODUCT_AVAILABILITY")}h.PDPSwatchesEvents()})},PDPSwatchesEvents:function(){if(a){console.log("PDPSwatchesEvents")}var h=this,i=this.touchType=window.navigator.pointerEnabled?"pointer":"ontouchstart" in window?"touch":"mouse";this.productForm.find("select").off("change");this.productForm.find("select").on("change",function(j){if(e){console.log("product form select change")}f.pubsub("publish","WCS.PRODUCTFORM.ATTRIBUTE.CHANGE");h.handleSelectAttributeChange(j);h.resetFormErrors()});this.productForm.find(".attr-box").not(".context-trigger-js").on({click:function(j){if(e){console.log("attr-box mouse click")}h.handleFormClick(j,h);if(a){console.log("publishing : WCS.PDPSWATCHES.PRODUCTFORM.EVENT.FORMCLICK")}f.pubsub("publish","WCS.PDPSWATCHES.PRODUCTFORM.EVENT.FORMCLICK",j)},mouseenter:function(j){if(i==="touch"){return false}if(e){console.log("attr-box mouseenter")}if(f("body.catalog.bundle").length>0){return}h.handlePDPSwatchesAttributeSelection(j,h);if(a){console.log("publishing : WCS.PRODUCTFORM.EVENT.ATTR.MOUSE.ENTER")}f.pubsub("publish","WCS.PRODUCTFORM.EVENT.ATTR.MOUSE.ENTER",j)},mouseleave:function(j){if(i==="touch"){return false}if(e){console.log("attr-box mouse leave")}if(f("body.catalog.bundle").length>0){return}h.handleFormMouseLeave(j);if(a){console.log("publishing : WCS.PRODUCTFORM.EVENT.ATTR.MOUSE.LEAVE")}f.pubsub("publish","WCS.PRODUCTFORM.EVENT.ATTR.MOUSE.LEAVE",j.target)}});if(d){f(".step-container.attr-size").on("click",".attr-box",function(j){h.handleFormClick(j,h)});f(".attr-color .attr-box").on("click",function(j){h.newColorWayProductEvent(j,h);f.pubsub("publish","product-form.attr.swatch.click",j)});this.productForm.find(".attr-box").not(".context-trigger-js").off("mouseenter mouseleave")}f(".shop-the-look .color-swatches-js .attr-box, .pdp-swatches .color-swatches-js .attr-box").off("click");f(".shop-the-look .color-swatches-js .attr-box, .pdp-swatches .color-swatches-js .attr-box").on("click",function(j){if(e){console.log("attr swatch click")}f.pubsub("publish","product-form.attr.swatch.click",j);f.pubsub("publish","WCS.PDPSWATCHES.PRODUCTFORM.EVENT.FORMCLICK");h.handlePDPSwatchClick(j,h)});this.pdpSwatchesWindowResizeEventToken=f.pubsub("subscribe","window.resize",function(){if(e){console.log("product form window resize")}h._handleWindowResize()});f(".pdp-swatches .product-details-js").on("click",h._handleProductDetailsJSClick);f(".age-verify-js").on("click",h._handleAgeVerification)},handleSelectAttributeChange:function(i){if(a){console.log("handleSelectAttributeChange")}var h=f(i.target).find(":selected").eq(0),p=h.attr("data-attribute-value")||h.parent().attr("data-attribute-value"),n,o,l,m,k,j,q;if(h.hasClass("attr-size-deselected-js")){f.productFormUtil.resetSizeOptions(h,this.productFormIndex)}if(!p){return false}n=h.parents(".selection-js");o=h.data("attribute-value")?h:h.parent();l=n.attr("data-attribute-id");m=o.attr("data-color-identifier")||o.attr("data-attribute-value");n.toggleClass("attribute-value-selected",true);if(e){console.log("publishing : WCS.PRODUCTFORM.ATTRIBUTE.CHANGE.COMPLETE")}f.pubsub("publish","WCS.PRODUCTFORM.ATTRIBUTE.CHANGE.COMPLETE",data={eventType:i.type,obj:h,attribute:l,attributeValue:m,formIndex:this.productFormIndex})},handleFormClick:function(l,j){if(a){console.log("handleFormClick")}var h=f(l.target).closest(".attr-box"),k=h.closest(".attr-container-js").find(".attr-box"),m=f(l.target),i=m.attr("data-product-id");k.removeClass("selected clicked");h.addClass("selected clicked");j.handlePDPSwatchesAttributeSelection(l,j)},handleFormMouseLeave:function(k){var j=f(k.target),l=null,h=j.parents(".selection-js"),i="";j=j.attr("data-role")?j.parent():j;l=j.siblings(".clicked");if(!j.hasClass("clicked")){l.addClass("selected");j.removeClass("selected");if(!l.length){j.parents(".selection-js").removeClass("attribute-value-selected");h.find(".attribute-label-value-js").html("")}else{i=l.attr("data-attribute-conversion-value");if(i){h.find(".attribute-label-value-js").html(i)}}}},_handleProductDetailsJSClick:function(h){var i=f(this);if(main.screen.size()==="small"){i.children(".inner-content").slideToggle("fast");i.find("h3").children("span").toggleClass("open")}},_handleAgeVerification:function(h){var i=f(h.target);if(i.attr("checked")){f(".age-verify .add-to-bag-js").removeClass("disabled")}else{f(".age-verify .add-to-bag-js").addClass("disabled")}},_handleWindowResize:function(){var h=f.productFormUtil.getScrollbarSize(),i=f(window).width()+h;if(f(".pdp-swatches").length&&(main.screen.size()!=="small")){f(".product-details-js .inner-content").css("display","block");f(".product-details-js h3 span").removeClass("open")}},handlePDPSwatchesAttributeSelection:function(i,r){if(a){console.log("handlePDPSwatchesAttributeSelection")}r=r||i.data.self;var h=f(i.target),o,q,m,n,l,k,s,j,p;r.resetFormErrors();if(h.data("attribute-value")||h.parent().data("attribute-value")){o=h.parents(".selection-js");q=h.data("attribute-value")?h:h.parent();l=q.attr("data-color-identifier");k=q.attr("data-sub-attribute-value");s=q.attr("data-attribute-long-value");j=q.attr("data-attribute-conversion-value");m=o.attr("data-attribute-id");n=l||q.attr("data-attribute-value");p=q.attr("data-attribute-stock");if(j){o.find(".attribute-label-value-js").html(j)}else{if((q.hasClass("clicked"))){if(s){o.find(".attribute-label-value-js").html(s);o.find(".attribute-label-separator-js").show()}else{o.find(".attribute-label-value-js").html(q.attr("data-attribute-value"));o.find(".attribute-label-separator-js").show()}if(l){o.find(".attr-selected-color-identifier").html(" ("+l+")")}if(k){o.find(".sub-attr-name").show();o.find(".sub-attr-selected").html(k)}else{o.find(".sub-attr-name").hide()}}}o.find(".step-content .selected").removeClass("selected");q.toggleClass("selected",true);if(q.prop("tagName")!=="OPTION"){o.find(".attr-container input:checked").prop("checked",false);o.find("#"+q.attr("for")).prop("checked",true)}o.toggleClass("attribute-value-selected",true);if(e){console.log("publishing : WCS.PRODUCTFORM.ATTRIBUTE.CHANGE.COMPLETE")}f.pubsub("publish","WCS.PRODUCTFORM.ATTRIBUTE.CHANGE.COMPLETE",data={eventType:i.type,obj:h,formIndex:this.productFormIndex,attribute:m,attributeValue:n,itemStockAttributeValue:p})}},resetFormErrors:function(){if(a){console.log("resetFormErrors")}f(".select-quantity-error-js",this.productForm).addClass("hide");f("#qty-step-container",this.productForm).removeClass("error")},handlePDPSwatchClick:function(j,i){if(a){console.log("handlePDPSwatchClick")}var h=f(j.target);h.closest("label").addClass("clicked").siblings().removeClass("clicked");i.handlePDPSwatchesAttributeSelection(j,i)},newColorWayProductEvent:function(j,i){var k=f(j.target),h=k.attr("data-product-id");f("input[name=catEntryId]").val(h);f.pubsub("publish","WCS.PRODUCTFORM.COLORWAY_PRODUCT.NEW",data={formIndex:i.productFormIndex,object:k})}};f.fn.PDPSwatchesEvents=function(){return this.each(function(){var h=f(this).data(b);if(!h){h=new g(this).initPDPSwatchesEvents();f(this).data(b,h)}})}});