if (self.CavalryLogger) { CavalryLogger.start_js(["XWGwj"]); }

__d("FunnelRegistry",[],(function a(b,c,d,e,f,g){f.exports={WWW_EXAMPLE_FUNNEL:true,MSITE_EXAMPLE_FUNNEL:true,WWW_FEED_SHARE_DIALOG_FUNNEL:true,MSITE_FEED_SHARE_DIALOG_FUNNEL:true,PLATFORM_SHARE_DIALOG_FUNNEL:true,WWW_RECRUITING_SEARCH_FUNNEL:true,WWW_CANVAS_EDITOR_FUNNEL:true,MSITE_COMMENT_TYPING_FUNNEL:true,MSITE_NOTE_READING_FUNNEL:true,WWW_CAMPFIRE_COMPOSER_UPSELL_FUNNEL:true,WWW_REACTIONS_LIKE_BUTTON_HOVER_FUNNEL:true,WWW_REACTIONS_NUX_FUNNEL:true,WWW_COMMENT_REACTIONS_NUX_FUNNEL:true,WWW_REACTIONS_BLINGBAR_NUX_FUNNEL:true,MSITE_INLINE_REPLY_COMPOSER_FUNNEL:true,WWW_LEAD_GEN_FORM_CREATION_FUNNEL:true,WWW_LEAD_GEN_DESKTOP_AD_UNIT_FUNNEL:true,WWW_LEAD_GEN_MSITE_AD_UNIT_FUNNEL:true,WWW_LINK_PICKER_DIALOG_FUNNEL:true,WWW_MEME_PICKER_DIALOG_FUNNEL:true,WWW_SNOWLIFT_ACTIONS_FUNNEL:true,WWW_CANVAS_AD_CREATION_FUNNEL:true,WWW_SEARCH_AWARENESS_LEARNING_NUX_FUNNEL:true,WWW_CONSTITUENT_TITLE_UPSELL_FUNNEL:true,WWW_PAGE_CREATION_FUNNEL:true,WWW_RECRUITING_PRODUCTS_FUNNEL:true,WWW_PMT_FUNNEL:true,WWW_VIDEOS_CASTING_FUNNEL:true,MSITE_PPD_FUNNEL:true,WWW_CMS_SEARCH_FUNNEL:true,SOCIAL_SEARCH_CONVERSION_WWW_FUNNEL:true,SOCIAL_SEARCH_DASHBOARD_WWW_FUNNEL:true,GAMES_QUICKSILVER_FUNNEL:true,SRT_USER_FLOW_FUNNEL:true,WWW_MEME_PIVOT_FUNNEL:true,WWW_NOTIFICATION_FUNNEL:true,MSITE_HASHTAG_PROMPT_FUNNEL:true,MSITE_FEED_ALBUM_CTA_FUNNEL:true,MTOUCH_COMMENT_STORIES_FUNNEL:true,WWW_MESSENGER_SHARE_TO_FB_FUNNEL:true,MISINFORMATION_RESHARE_ALERT_FUNNEL:true,FACECAST_BROADCASTER_FUNNEL:true,WWW_MISINFO_WARNING_FOOTER_FUNNEL:true,MTOUCH_MISINFO_WARNING_FOOTER_FUNNEL:true,COLLEGE_COMMUNITY_NUX_ONBOARDING_FUNNEL:true,WWW_MESSENGER_SEARCH_SESSION_FUNNEL:true,WWW_MESSENGER_CONTENT_SEARCH_FUNNEL:true,WWW_LIVE_PRODUCER_FUNNEL:true,WWW_AD_BREAKS_ONBOARDING_FUNNEL:true,WWW_LEAD_GEN_FORM_EDITOR_FUNNEL:true,WWW_AD_BREAK_HOME_ONBOARDING_FUNNEL:true,WWW_MESSENGER_GROUP_ESCALATION_FUNNEL:true,WEB_MESSENGER_RTC_FUNNEL:true,WEB_RTC_SCREEN_SHARING_FUNNEL:true,MTOUCH_NUX_PROFILE_PIC_FUNNEL:true,ADS_VIDEO_CAPTION_FUNNEL:true,WWW_BUSINESS_ALERT_FUNNEL:true,SOCIAL_VR_INTERACTIVE_THREE_SIXTY_FUNNEL:true,WWW_ALT_TEXT_COMPOSER_FUNNEL:true,WWW_DIVEBAR_RECENTS_FUNNEL:true,UNIDASH_EDIT_WIDGET_FUNNEL:true,WWW_ACCESSIBILITY_NOTIFICATIONS_JEWEL_TABBING_FUNNEL:true,MTOUCH_FEED_MISSED_STORIES_FUNNEL:true,WWW_STORYSET_FUNNEL:true,POLYGLOT_MAIN_FUNNEL:true,CREATIVE_STUDIO_CREATION_FUNNEL:true,CREATIVE_STUDIO_HUB_FUNNEL:true,CREATIVE_STUDIO_INVITE_JOIN_FUNNEL:true,FX_PLATFORM_INVITE_JOIN_FUNNEL:true,FX_PLATFORM_INVITE_SEND_FUNNEL:true,WWW_LIVE_VIEWER_TIPJAR_FUNNEL:true,WWW_FUNDRAISER_CREATION_FUNNEL:true,WWW_FUNDRAISER_EDIT_FUNNEL:true,WWW_FBL_FUNNEL:true,WWW_CLUE_FUNNEL:true,WWW_OFFERS_SIMPLE_COMPOSE_FUNNEL:true,WWW_OFFERS_SIMPLE_COMPOSE_POST_LIKE_FUNNEL:true,WWW_SEE_OFFERS_CTA_NUX_FUNNEL:true,WWW_CHEVRON_FUNNEL:true,MSITE_AD_BREAKS_ONBOARDING_FLOW_FUNNEL:true,CASUAL_GROUP_PICKER_FUNNEL:true,TOPICS_TO_FOLLOW_FUNNEL:true,WWW_SPATIAL_REACTION_PRODUCTION_FUNNEL:true,WWW_ADS_TARGETING_AUDIENCE_MANAGER_FUNNEL:true,WWW_NEWSFEED_TAILLOAD_FUNNEL:true,KEYFRAMES_FUNNEL:true,WWW_NOTIFS_UP_NEXT_FUNNEL:true,MSITE_PROFILE_PICTURE_EDIT_FUNNEL:true,WWW_PROFILE_INTRO_CARD_EDIT_MEDIA_FUNNEL:true,BUSINESS_PAYMENTS_MERCHANT_ONBOARDING_FUNNEL:true,CHANNEL_EDIT_FUNNEL:true,PAYOUT_ONBOARDING_FUNNEL:true,SERVICES_INSTANT_BOOKING_SETTINGS_FUNNEL:true,MATCHED_MARKET_LIFT_INTERNAL_FUNNEL:true,FB_NEO_ONBOARDING_FUNNEL:true,FB_NEO_FRIENDING_FUNNEL:true,SEARCH_FUNNEL:true}}),null);
__d("AjaxRequest",["ErrorUtils","Keys","PHPQuerySerializer","TimeSlice","URI","UserAgent_DEPRECATED","ZeroRewrites","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g){__p&&__p();function h(l,m,n){if(!(m instanceof c("URI")))m=new(c("URI"))(m);this.xhr=c("ZeroRewrites").getTransportBuilderForURI(m)();if(n&&l=="GET")m.setQueryData(n);else this._params=n;this.method=l;this.uri=m;this.xhr.open(l,m)}var i=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest();h.supportsCORS=function(){return i};h.ERROR="ar:error";h.TIMEOUT="ar:timeout";h.PROXY_ERROR="ar:proxy error";h.TRANSPORT_ERROR="ar:transport error";h.SERVER_ERROR="ar:http error";h.PARSE_ERROR="ar:parse error";h.SERVICE_UNAVAILABLE="ar:noservice";h._inflight=[];function j(){var l=h._inflight;h._inflight=[];l.forEach(function(m){m.abort()})}function k(l){l.onJSON=l.onError=l.onSuccess=null;clearTimeout(l._timer);if(l.xhr&&l.xhr.readyState<4){l.xhr.abort();l.xhr=null}h._inflight=h._inflight.filter(function(m){return m&&m!=l&&m.xhr&&m.xhr.readyState<4})}Object.assign(h.prototype,{timeout:6e4,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function l(m){if(this[m])this[m](this)},_parseStatus:function l(){__p&&__p();var m;try{this.status=this.xhr.status;m=this.xhr.statusText}catch(n){if(this.xhr.readyState>=4){this.errorType=h.TRANSPORT_ERROR;this.errorText=n.message}return}if(this.status===0&&!/^(file|ftp)/.test(this.uri))this.errorType=h.TRANSPORT_ERROR;else if(this.status>=100&&this.status<200)this.errorType=h.PROXY_ERROR;else if(this.status>=200&&this.status<300)return;else if(this.status>=300&&this.status<400)this.errorType=h.PROXY_ERROR;else if(this.status>=400&&this.status<500)this.errorType=h.SERVER_ERROR;else if(this.status===503)this.errorType=h.SERVICE_UNAVAILABLE;else if(this.status>500&&this.status<600)this.errorType=h.PROXY_ERROR;else if(this.status==1223)return;else if(this.status>=12001&&this.status<=12156)this.errorType=h.TRANSPORT_ERROR;else{m="unrecognized status code: "+this.status;this.errorType=h.ERROR}if(!this.errorText)this.errorText=m},_parseResponse:function l(){__p&&__p();var m,n=this.xhr.readyState;try{m=this.xhr.responseText||""}catch(o){if(n>=4){this.errorType=h.ERROR;this.errorText="responseText not available - "+o.message}return}while(this.xhr){var p=this._eol+1,q=this.streamMode?m.indexOf("\n",p):m.length;if(q<0&&n==4)q=m.length;if(q<=this._eol)break;var r=m;if(this.streamMode)r=m.substr(p,q-p).replace(/^\s*|\s*$/g,"");if(p===0&&this.prelude)if(this.prelude.test(r))r=r.replace(this.prelude,"");this._eol=q;if(r){try{this.json=JSON.parse(r)}catch(o){var s=/(<body[\S\s]+?<\/body>)/i.test(m)&&RegExp.$1,t={message:o.message,"char":p,excerpt:(p===0&&s||r).substr(512)};this.errorType=h.PARSE_ERROR;this.errorText="parse error - "+JSON.stringify(t);return}c("ErrorUtils").applyWithGuard(this._call,this,["onJSON"])}}},_onReadyState:function l(m,n){__p&&__p();var o=this.xhr&&this.xhr.readyState||0;if(this.status==null&&o>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(o==3&&this.streamMode||o==4)m.call(this);if(this.errorType||o==4){this._time=Date.now()-this._sentAt;n.call(this,this._call,!this.errorType?"onSuccess":"onError");k(this)}},send:function l(m){__p&&__p();var n=c("TimeSlice").getGuardedContinuation("AjaxRequest xhr.onreadystatechange",true),o=c("TimeSlice").guard(this._parseResponse.bind(this),"AjaxRequest xhr.parseResponse",{propagationType:c("TimeSlice").PropagationType.EXECUTION});this.xhr.onreadystatechange=this._onReadyState.bind(this,o,n);var p=this.timeout;if(p)this._timer=c("setTimeoutAcrossTransitions")(function(){this.errorType=h.TIMEOUT;this.errorText="timeout";this._time=Date.now()-this._sentAt;this._call("onError");k(this)}.bind(this),p);h._inflight.push(this);if(this.method=="POST")this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this._sentAt=Date.now();this.xhr.send(m?c("PHPQuerySerializer").serialize(m):"")},abort:function l(){k(this)},toString:function l(){var m="[AjaxRequest readyState="+this.xhr.readyState;if(this.errorType)m+=" errorType="+this.errorType+" ("+this.errorText+")";return m+"]"},toJSON:function l(){var m={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)m.uri=this.uri;for(var n in m)if(m[n]==null)delete m[n];return m}});if(window.addEventListener&&c("UserAgent_DEPRECATED").firefox())window.addEventListener("keydown",function(event){if(event.keyCode===c("Keys").ESC)event.prevent()},false);if(window.attachEvent)window.attachEvent("onunload",j);f.exports=h}),null);
__d("ChannelSubdomain",["Event","JSLogger","Run","LogHistory","setTimeoutAcrossTransitions","WebStorage"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("LogHistory").getInstance("channel"),i=c("JSLogger").create("channel"),j="channel_sub:",k=7,l=100*1e3,m=null,n;function o(){var q=c("WebStorage").getLocalStorage();if(n){clearTimeout(n);n=null}if(q&&m!=null)q.removeItem(j+m);m=null}function p(q,r,s){__p&&__p();var t,u=(q-1)*k;if(s){if(n)clearTimeout(n);m=n=null}if(r==null)r=Math.floor(Math.random()*u);if(m==null){var v,w,x,y,z,A,B;(function(){__p&&__p();var C=c("WebStorage").getLocalStorage();if(C){v=[];for(w=0;w<C.length;w++){x=C.key(w);if(x.indexOf(j)===0){y=parseInt(x.substr(j.length),10);v[y]=parseInt(C.getItem(x),10)}}z=Date.now()-l;for(w=0;w<u;w++){A=(w+r)%u;if(!v[A]||v[A]<z){m=A;break}}if(m!=null){B=function D(){try{C.setItem(j+m,Date.now())}catch(E){h.warn("subdomain set failed",E.message)}n=c("setTimeoutAcrossTransitions")(B,l/2)};B()}else{h.warn("no channel subdomain",v);i.error("subdomain_overflow")}if(typeof window.onpageshow!="undefined")c("Event").listen(window,"pagehide",o);else c("Run").onUnload(o)}else m=r})()}return m==null?null:m%k}f.exports={allocate:p,clear:o}}),null);
__d("ChatproxyClientErrorsTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(){this.clear()}h.prototype.log=function(){c("GeneratedLoggerUtils").log("logger:ChatproxyClientErrorsLoggerConfig",this.$ChatproxyClientErrorsTypedLogger1,c("Banzai").BASIC)};h.prototype.logVital=function(){c("GeneratedLoggerUtils").log("logger:ChatproxyClientErrorsLoggerConfig",this.$ChatproxyClientErrorsTypedLogger1,c("Banzai").VITAL)};h.prototype.clear=function(){this.$ChatproxyClientErrorsTypedLogger1={};return this};h.prototype.updateData=function(j){this.$ChatproxyClientErrorsTypedLogger1=babelHelpers["extends"]({},this.$ChatproxyClientErrorsTypedLogger1,j);return this};h.prototype.setErrorMessage=function(j){this.$ChatproxyClientErrorsTypedLogger1.error_message=j;return this};h.prototype.setErrorReason=function(j){this.$ChatproxyClientErrorsTypedLogger1.error_reason=j;return this};h.prototype.setStatusCode=function(j){this.$ChatproxyClientErrorsTypedLogger1.status_code=j;return this};h.prototype.setTopicPrefixes=function(j){this.$ChatproxyClientErrorsTypedLogger1.topic_prefixes=c("GeneratedLoggerUtils").serializeVector(j);return this};h.prototype.setURL=function(j){this.$ChatproxyClientErrorsTypedLogger1.url=j;return this};var i={error_message:true,error_reason:true,status_code:true,topic_prefixes:true,url:true};f.exports=h}),null);
__d("DocRPC",["ErrorUtils"],(function a(b,c,d,e,f,g){__p&&__p();var h={_apis:{},_dispatch:function i(j){__p&&__p();var k;try{j=JSON.parse(j)}catch(l){throw new Error('DocRPC unparsable dispatch: "'+j+'"')}if(Object.prototype.hasOwnProperty.call(h._apis,j.api)){var m=h._apis[j.api];if(m[j.method])k=c("ErrorUtils").applyWithGuard(m[j.method],m,j.args)}if(k===undefined)k=null;return JSON.stringify(k)},publish:function i(j,k){h._apis[k]=j},proxy:function i(j,k,l){__p&&__p();var i={};l.forEach(function(m){__p&&__p();i[m]=function(){__p&&__p();var n={api:k,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(j.closed)throw new Error("DocRPC window closed");o=j.DocRPC._dispatch(JSON.stringify(n))}catch(p){c("ErrorUtils").reportError(p);return}if(typeof o=="string")try{o=JSON.parse(o)}catch(p){throw new Error("DocRPC "+k+"."+m+' unparsable return: "'+o+'"')}return o}});return i}};f.exports=b.DocRPC=h}),null);
__d("ChannelTransport",["AjaxRequest","ChannelConstants","DocRPC","LogHistory","TimeSlice","URI","bind","setTimeoutAcrossTransitions","BanzaiODS","ChatproxyClientErrorsTypedLogger"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("LogHistory").getInstance("channel");function i(v){__p&&__p();var w=new(c("ChatproxyClientErrorsTypedLogger"))();w.setStatusCode(v.status);if(v.xhr!=null){var x=v.xhr.getResponseHeader("x-fb-chat-failure-reason");if(x)w.setErrorReason(x)}w.setErrorMessage(v.errorType);if(v.uri!==undefined)w.setURL(v.uri.getPath());w.log()}function j(){return(1048576*Math.random()|0).toString(36)}function k(v){return v!==null&&v!==undefined&&!isNaN(v)&&isFinite(v)&&0<=v&&v<=6}function l(v,w){var x="";if(k(v.subdomain))x=v.subdomain+"-";var y=v.host;y=y===null||y===undefined?"edge-chat":v.host;var z=new(c("URI"))(w).setDomain(x+y+"."+v.domain).setPort(v.port).setSecure(new(c("URI"))(window.location.href).isSecure());return z}function m(v){__p&&__p();var w={partition:v.partition,cb:j(),failure:v.pingFailuresOnSubdomain};if(v.sticky_token)w.sticky_token=v.sticky_token;if(v.sticky_pool)w.sticky_pool=v.sticky_pool;var x=l(v,"/p").setQueryData(w);h.log("start_p",{uri:x.toString()});var y=new(c("AjaxRequest"))("GET",x);if(c("AjaxRequest").supportsCORS())y.xhr.withCredentials=true;var z=function z(A){h.log("finish_p",{xhr:A.toJSON?A.toJSON():A,subdomain:v.subdomain,fullHost:v.fullHost})};y.onError=function(A){__p&&__p();c("BanzaiODS").bumpEntityKey("ChannelTransport","sendP.error");i(y);z(A);if(v.subdomain===null)return;if(k(v.subdomain)){v.pingFailuresOnSubdomain++;v.subdomain++;if(v.subdomain>6)v.subdomain=0}};y.timeout=v.P_TIMEOUT;y.onSuccess=function(A){c("BanzaiODS").bumpEntityKey("ChannelTransport","sendP.success");z(A)};y.send()}function n(v,w,x){__p&&__p();var y=new Image(),z=0,A=function A(D){y.abort();return D?w():x()};y.onload=c("TimeSlice").guard(function(){h.log("ping_ok",{duration:Date.now()-z});c("BanzaiODS").bumpEntityKey("ChannelTransport","sendPing.success");A(true)},"ChannelTransport image.onload");y.onerror=c("TimeSlice").guard(function(){m(v);c("BanzaiODS").bumpEntityKey("ChannelTransport","sendPing.error");i(y);A(false)},"ChannelTransport image.onerror");var B=c("setTimeoutAcrossTransitions")(y.onerror,1e4);y.abort=function(){if(B){clearTimeout(B);B=null}y.onload=y.onerror=null};var C={partition:v.partition,cb:j()};if(v.sticky_token)C.sticky_token=v.sticky_token;if(v.sticky_pool)C.sticky_pool=v.sticky_pool;if(v.lastRequestErrorReason){C.reason=v.lastRequestErrorReason;v.lastRequestErrorReason=null}if(v.uid&&v.viewerUid){C.uid=v.uid;C.viewer_uid=v.viewerUid}z=Date.now();y.src=l(v,"/ping").setQueryData(C);return y}function o(v,w){__p&&__p();var x={channel:v.user_channel,partition:v.partition,clientid:v.sessionID,cb:j(),cap:0,uid:v.uid,viewer_uid:v.viewerUid};if(v.sticky_token)x.sticky_token=v.sticky_token;if(v.sticky_pool)x.sticky_pool=v.sticky_pool;if(v.profile)x.profile=v.profile;if(v.capabilities)x.cap=v.capabilities;x.id=w;var y=l(v,"/add_bud").setQueryData(x),z=new(c("AjaxRequest"))("GET",y);if(c("AjaxRequest").supportsCORS())z.xhr.withCredentials=true;z.onError=function(A){c("BanzaiODS").bumpEntityKey("ChannelTransport","sendAdditionalBuddy.error");h.warn("add_buddy_error");i(z)};z.onSuccess=function(A){c("BanzaiODS").bumpEntityKey("ChannelTransport","sendAdditionalBuddy.success");h.log("add_buddy_ok")};z.timeout=v.P_TIMEOUT;z.send()}function p(v){__p&&__p();var w={channel:v.user_channel,partition:v.partition,clientid:v.sessionID,cb:j(),cap:0,uid:v.uid,viewer_uid:v.viewerUid};if(v.sticky_token)w.sticky_token=v.sticky_token;if(v.sticky_pool)w.sticky_pool=v.sticky_pool;if(v.is_offline||v.shouldSuppressPresence)w.state="offline";else w.state="active";if(w.state===v.lastPresenceState)return;v.lastPresenceState=w.state;if(v.profile)w.profile=v.profile;if(v.capabilities)w.cap=v.capabilities;var x=l(v,"/active_ping").setQueryData(w),y=new(c("AjaxRequest"))("GET",x);if(c("AjaxRequest").supportsCORS())y.xhr.withCredentials=true;y.onError=function(z){c("BanzaiODS").bumpEntityKey("ChannelTransport","sendActivePing.error");h.warn("active_ping_error");i(y)};y.onSuccess=function(z){c("BanzaiODS").bumpEntityKey("ChannelTransport","sendActivePing.success");h.log("active_ping_ok")};y.timeout=v.P_TIMEOUT;y.send()}function q(v,w,x,y){__p&&__p();var z=new Date(),A=-1;if(v.userActive>0){A=(z-v.userActive)/1e3|0;if(A<0)h.warn("idle_regression",{idleTime:A,now:z.getTime(),userActive:v.userActive})}var B={channel:v.user_channel,seq:v.seq,partition:v.partition,clientid:v.sessionID,cb:j(),idle:A,qp:"y",cap:0};if(v.state.aiq)B.aiq=v.state.aiq;if(v.ready)if(v.seqTurSentAt==-1||v.seqTurSentAt==v.seq){B.tur=v.timeUntilReady;B.qpmade=v.queueMade;v.seqTurSentAt=v.seq}B.pws=v.pws;if(v.sequenceId>0)B.isq=v.sequenceId;B.msgs_recv=v.estimatedReceived;if(v.uid&&v.viewerUid){B.uid=v.uid;B.viewer_uid=v.viewerUid}if(v.sticky_token)B.sticky_token=v.sticky_token;else{B.request_batch=1;if(v.msgr_region)B.msgr_region=v.msgr_region}if(v.sticky_pool)B.sticky_pool=v.sticky_pool;if("trace_id"in v)B.traceid=v.trace_id;if(v.is_offline||v.shouldSuppressPresence)B.state="offline";else if(v.userActive>0&&A<60)B.state="active";v.lastPresenceState=B.state;if(v.streamingCapable){B.mode="stream";B.format="json"}if(v.profile)B.profile=v.profile;if(v.capabilities)B.cap=v.capabilities;var C=l(v,"/pull").setQueryData(B),D="GET",E=new(c("AjaxRequest"))(D,C);if(c("AjaxRequest").supportsCORS())E.xhr.withCredentials=true;E.timeout=v.streamingCapable?v.STREAMING_TIMEOUT:v.LONGPOLL_TIMEOUT;E.onJSON=function(E){c("BanzaiODS").bumpEntityKey("ChannelTransport","sendPull.json");w(E)};E.onSuccess=function(F){c("BanzaiODS").bumpEntityKey("ChannelTransport","sendPull.success");x(F)};E.onError=function(){var F=this.status==12002&&this._time>=v.MIN_12002_TIMEOUT||this.status==504&&this._time>=v.MIN_504_TIMEOUT,G=F?x:y;if(F)c("BanzaiODS").bumpEntityKey("ChannelTransport","sendPull.success");else{c("BanzaiODS").bumpEntityKey("ChannelTransport","sendPull.error");i(E)}return G&&G.apply(this,arguments)};E.send();v.inStreaming=v.streamingCapable;return E}function r(v){this.manager=v;this.init&&this.init()}function s(v){r.apply(this,arguments)}Object.assign(s.prototype,{logName:"CORS",enterState:function v(w,x){__p&&__p();if(this._request){this._request.abort();this._request=null}if(w=="init")c("setTimeoutAcrossTransitions")(c("bind")(this.manager,"exitState",{status:c("ChannelConstants").OK,stateId:x.stateId}),0);if(!/pull|ping/.test(w))return;var y=this.manager;if(w=="ping")this._request=n(x,c("bind")(y,"exitState",{status:c("ChannelConstants").OK,stateId:x.stateId}),c("bind")(y,"exitState",{status:c("ChannelConstants").ERROR,stateId:x.stateId}));else if(w=="pull")this._request=q(x,c("bind")(y,"_processTransportData",x.stateId),c("bind")(y,"exitState",{status:c("ChannelConstants").OK,stateId:x.stateId}),c("bind")(y,"exitState",{status:c("ChannelConstants").ERROR,stateId:x.stateId}))}});function t(v){h.log("iframe_init_constructor");r.apply(this,arguments);this._iframe=document.createElement("iframe");this._iframe.style.display="none";document.body.appendChild(this._iframe);c("DocRPC").publish(this,"outerTransport")}Object.assign(t.prototype,{logName:"iframe",_initIframe:function v(w){__p&&__p();h.log("iframe_init_start");window.onchanneliframeready=function(){h.log("iframe_resources");return w.resources};window.onchanneliframeloaded=function(){h.log("iframe_loaded")};if(w){this._iframeURI=l(w,w.path);if(w.resources){var x=this._iframeURI.getDomain();w.resources=w.resources.map(function(z){var A=new(c("URI"))(z);if(A.getPath().startsWith("/intern/rsrc.php")&&A.getQueryData().origin!==undefined)return A.addQueryData("origin",x).toString();return z})}}else this._iframeURI="about:blank";this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);h.log("iframe_uri_set")}catch(y){h.error("iframe_uri_set_error",y);this.exitState({status:c("ChannelConstants").ERROR,stateId:w.stateId},y+"")}},enterState:function v(w,x){__p&&__p();if(w=="init")this._initIframe(x);else if(/idle|ping|pull/.test(w)){if(this._iframeProxy)this._iframeProxy.enterState.apply(this._iframeProxy,arguments);else if(w!="idle")this.exitState({status:c("ChannelConstants").ERROR,stateId:x.stateId},"iframe not yet loaded")}else if(w=="shutdown")this._initIframe()},_processTransportData:function v(){this.manager._processTransportData.apply(this.manager,arguments)},exitState:function v(w){if(this.manager.state=="init"&&w.status==c("ChannelConstants").OK)this._iframeProxy=c("DocRPC").proxy(this._iframe.contentWindow,"innerTransport",["enterState"],(this._iframeURI+"").replace(/iframe.*/,""));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments)}});function u(){this.init=this.init.bind(this);r.apply(this,arguments)}Object.assign(u.prototype,{logName:"iframe(inner)",init:function v(){c("DocRPC").publish(this,"innerTransport");try{var w=c("DocRPC").proxy(window.parent,"outerTransport",["_processTransportData","exitState"],top.DocRPC.origin);Object.assign(this,w);this.exitState({status:c("ChannelConstants").OK,stateId:1e6})}catch(x){h.error("iframe_inner_init_error",x)}},enterState:function v(w,x){if(this._request){this._request.abort();this._request=null}if(w=="ping")this._request=n(x,c("bind")(this,"exitState",{status:c("ChannelConstants").OK,stateId:x.stateId}),c("bind")(this,"exitState",{status:c("ChannelConstants").ERROR,stateId:x.stateId}));else if(w=="pull")this._request=q(x,c("bind")(this,"_processTransportData",x.stateId),c("bind")(this,"exitState",{status:c("ChannelConstants").OK,stateId:x.stateId}),c("bind")(this,"exitState",{status:c("ChannelConstants").ERROR,stateId:x.stateId}))}});f.exports={isSubdomain:k,getURI:l,Transport:r,CORSTransport:s,IframeTransport:t,IframeInnerTransport:u,sendActivePing:p,sendAdditionalBuddyRequest:o}}),null);
__d("MercuryLoggingHelper",[],(function a(b,c,d,e,f,g){__p&&__p();function h(j){return Array.from(j).slice(0,6).join("")}var i={obfuscateThread:function j(k){var l=babelHelpers["extends"]({},k);if(k&&k.snippet&&k.snippet.length>9)l.snippet=h(k.snippet)+"...";return l},obfuscateMessage:function j(k){var l=babelHelpers["extends"]({},k);if(k&&k.body&&k.body.length>9)l.body=h(k.body)+"...";return l}};f.exports=i}),null);
__d("ChannelTransportDataLogger",["Arbiter","JSLogger","MercuryLoggingHelper"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=[],i=10,j=function j(l){__p&&__p();return l.map(function(m){var n=m;if(m.message||m.delta&&m.delta.body){n=babelHelpers["extends"]({},m);if(m.message)n.message=c("MercuryLoggingHelper").obfuscateMessage(m.message);if(m.delta&&m.delta.body)n.delta=c("MercuryLoggingHelper").obfuscateMessage(m.delta)}return n})},k={log:function l(m){var n={t:m.t,seq:m.seq};if(m.ms)n.ms=j(m.ms);h.push(n);if(h.length>i)h.shift()}};c("Arbiter").subscribe(c("JSLogger").DUMP_EVENT,function(l,m){m.channelTransportLog=h});f.exports=k}),null);
__d("ChatProxyConnectionState",[],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(){this.auxiliaryIrisQueues={};this.aiq=null}h.prototype.subscribeIrisQueue=function(i,j){this.auxiliaryIrisQueues[i]=j;this.updateCaches()};h.prototype.unsubscribeIrisQueue=function(i){delete this.auxiliaryIrisQueues[i];this.updateCaches()};h.prototype.updateCaches=function(){var i=[];for(var j in this.auxiliaryIrisQueues)if(Object.prototype.hasOwnProperty.call(this.auxiliaryIrisQueues,j)){i.push(j);i.push(this.auxiliaryIrisQueues[j])}if(i.length===0)this.aiq=null;else this.aiq=i.join(",")};f.exports=h}),null);
__d("ChatReliabilityEvents",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({ERROR:"error",CHANNEL_DISCONNECT:"channel_disconnect",CHANNEL_CONNECT:"channel_connect",CHANNEL_INIT:"channel_init",CHANNEL_NOCONFIG:"channel_noconfig",CHANNEL_HISTORY_INVALID:"channel_history_invalid",CHANNEL_STALLED:"channel_stalled",MESSAGE_RECEIVED:"msg_received",MESSAGE_SEND_START:"msg_send_start",THREAD_INFO_ENDPOINT_FATAL:"thread_info_fatal",DFF_ENDPOINT_FATAL:"invalidate_global_state_fatal",DFF_DELTA_INIT:"dff_initiated_by_delta",DFF_HOLE_INIT:"dff_initiated_by_hole"})}),null);
__d("ChatReliabilityTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(){this.clear()}h.prototype.log=function(){c("GeneratedLoggerUtils").log("logger:ChatReliabilityLoggerConfig",this.$ChatReliabilityTypedLogger1,c("Banzai").BASIC)};h.prototype.logVital=function(){c("GeneratedLoggerUtils").log("logger:ChatReliabilityLoggerConfig",this.$ChatReliabilityTypedLogger1,c("Banzai").VITAL)};h.prototype.clear=function(){this.$ChatReliabilityTypedLogger1={};return this};h.prototype.updateData=function(j){this.$ChatReliabilityTypedLogger1=babelHelpers["extends"]({},this.$ChatReliabilityTypedLogger1,j);return this};h.prototype.setEvent=function(j){this.$ChatReliabilityTypedLogger1.event=j;return this};h.prototype.setEventData=function(j){this.$ChatReliabilityTypedLogger1.event_data=j;return this};var i={event:true,event_data:true};f.exports=h}),null);
__d("ChatReliabilityInstrumentation",["ChatReliabilityEvents","ChatReliabilityTypedLogger","gkx"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=function h(event,j){if(!c("gkx")("AT5ZjV8HMgIrvWAdtan2dRootzXgNDn_gwV31adDo4tXzlNarwl6mRO_oeBdt0f9htexVFvjQxI0k_n8DA4dQ67qv29jXbtX1X-VERmy6nzotA"))return;new(c("ChatReliabilityTypedLogger"))().setEvent(event).setEventData(j).log()},i={logERROR:function j(k){h(c("ChatReliabilityEvents").ERROR,k)},logCHANNEL_DISCONNECT:function j(k){h(c("ChatReliabilityEvents").CHANNEL_DISCONNECT,k)},logCHANNEL_CONNECT:function j(k){h(c("ChatReliabilityEvents").CHANNEL_CONNECT,k)},logCHANNEL_HISTORY_INVALID:function j(k){h(c("ChatReliabilityEvents").CHANNEL_HISTORY_INVALID,k)},logMESSAGE_RECEIVED:function j(k){h(c("ChatReliabilityEvents").MESSAGE_RECEIVED,k)},logMESSAGE_SEND_START:function j(k){h(c("ChatReliabilityEvents").MESSAGE_SEND_START,k)},logCHANNEL_STALLED:function j(k){h(c("ChatReliabilityEvents").CHANNEL_STALLED,k)},logCHANNEL_INIT:function j(k){h(c("ChatReliabilityEvents").CHANNEL_INIT,k)},logCHANNEL_NOCONFIG:function j(k){h(c("ChatReliabilityEvents").CHANNEL_NOCONFIG,k)},logDFF_DELTA_INIT:function j(k){h(c("ChatReliabilityEvents").DFF_DELTA_INIT,k)},logDFF_HOLE_INIT:function j(k){h(c("ChatReliabilityEvents").DFF_HOLE_INIT,k)}};f.exports=i}),null);
__d("PresenceUtil",["CurrentUser","randomInt"],(function a(b,c,d,e,f,g){var h=c("randomInt")(0,4294967295)+1;function i(){return h}function j(){return c("CurrentUser").isLoggedInNow()}f.exports={getSessionID:i,hasUserCookie:j}}),null);
__d("PresencePrivacy",["Arbiter","AsyncRequest","ChannelConstants","CurrentUser","PresencePrivacyInitialData","JSLogger","PresenceUtil"],(function a(b,c,d,e,f,g){__p&&__p();var h="/ajax/chat/privacy/settings.php",i="/ajax/chat/privacy/online_policy.php",j="/ajax/chat/privacy/visibility.php",k="friend_visibility",l="visibility",m="online_policy",n=babelHelpers["extends"]({},c("PresencePrivacyInitialData").privacyData),o=c("PresencePrivacyInitialData").visibility,p=babelHelpers["extends"]({},c("PresencePrivacyInitialData").privacyData),q=o,r=c("PresencePrivacyInitialData").onlinePolicy,s=r,t=[],u=false;function v(){return c("JSLogger").create("blackbird")}var w=Object.assign(new(c("Arbiter"))(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function x(J){__p&&__p();var K;for(K in J){var L=J[K];if(K==c("CurrentUser").getID()){v().error("set_viewer_visibility");throw new Error("Invalid to set current user's visibility")}switch(L){case w.WHITELISTED:case w.BLACKLISTED:case w.UNLISTED:break;default:v().error("set_invalid_friend_visibility",{id:K,value:L});throw new Error("Invalid state: "+L)}}for(K in J)n[K]=J[K];w.inform("privacy-changed")}function y(J,K){var L={};L[J]=K;x(L)}function z(J){switch(J){case w.ONLINE:case w.OFFLINE:break;default:v().error("set_invalid_visibility",{value:J});throw new Error("Invalid visibility: "+J)}o=J;w.inform("privacy-changed");w.inform("privacy-user-presence-changed")}function A(J){switch(J){case w.ONLINE_TO_WHITELIST:case w.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+J)}r=J;w.inform("privacy-user-presence-changed");w.inform("privacy-changed")}function B(J,K){u=true;J.send()}function C(J,K){t.push({request:J,data:K});if(!u){var L=t.shift();B(L.request,L.data)}}function D(J,K){__p&&__p();var L=J.type;if(L===k){w.inform("privacy-availability-changed");for(var M in J.settings)p[M]=J.settings[M]}else{if(L===l)q=J.visibility;else if(L===m)s=J.online_policy;w.inform("privacy-user-presence-response")}v().log("set_update_response",{data:J,response:K})}function E(J,K){if(o!==q)z(q);if(r!==s)A(s);Object.assign(n,p);w.inform("privacy-changed");t=[];v().log("set_error_response",{data:J,response:K})}function F(J){u=false;if(t.length>0){var K=t.shift();B(K.request,K.data)}}function G(J,K){if(c("PresenceUtil")!=null){var L=J.getData();L.window_id=c("PresenceUtil").getSessionID();J.setData(L)}J.setHandler(D.bind(this,K)).setErrorHandler(E.bind(this,K)).setTransportErrorHandler(E.bind(this,K)).setFinallyHandler(F.bind(this)).setAllowCrossPageTransition(true);return J}function H(J,K,L){return G(new(c("AsyncRequest"))(J).setData(K),L)}function I(J,K){__p&&__p();var L=K.obj;if(L.viewer_id!=c("CurrentUser").getID()){v().error("invalid_viewer_for_channel_message",{type:J,data:K});throw new Error("Viewer got from the channel is not the real viewer")}if(L.window_id===c("PresenceUtil").getSessionID())return;var M=L.data;if(L.event=="access_control_entry")M.target_ids.forEach(function(O){y(O,M.setting);p[O]=M.setting});else{if(L.event=="visibility_update"){var N=!!M.visibility?w.ONLINE:w.OFFLINE;z(N);q=N}else if(L.event=="online_policy_update"){A(M.online_policy);s=M.online_policy}w.inform("privacy-user-presence-response")}v().log("channel_message_received",{data:K.obj})}Object.assign(w,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function J(K,L,M){},setVisibility:function J(K){q=o;z(K);var L={visibility:K},M={type:l,visibility:K},N=H(j,L,M);C(N,M);v().log("set_visibility",{data:L});return K},getVisibility:function J(){return o},setOnlinePolicy:function J(K){s=r;A(K);var L={online_policy:K},M={type:m,online_policy:K},N=H(i,L,M);C(N,M);v().log("set_online_policy",{data:L});return K},getOnlinePolicy:function J(){return r},getFriendVisibility:function J(K){return n[K]||w.UNLISTED},isUserOffline:function J(){return this.getVisibility()===w.OFFLINE},allows:function J(K){if(this.isUserOffline())return false;return this.allowsIfViewerIsOnline(K)},allowsIfViewerIsOnline:function J(K){var L=this.getOnlinePolicy();return L===w.ONLINE_TO_WHITELIST?n[K]==w.WHITELISTED:n[K]!=w.BLACKLISTED},setFriendsVisibility:function J(K,L){__p&&__p();if(K.length>0){var M={};for(var N=0;N<K.length;N++){var O=K[N];p[O]=n[O];M[O]=L}x(M);var P=L;if(P==w.UNLISTED)P=p[K[0]];var Q={users:K,setting:L,setting_type:P},R={type:k,settings:M},S=H(h,Q,R);C(S,R);v().log("set_friend_visibility",{data:Q})}return L},setFriendVisibilityMap:function J(K,L){for(var M in K)p[M]=n[M];x(K);var N={type:k,settings:K};C(G(L,N),N);v().log("set_friend_visibility_from_map",{data:K})},allow:function J(K){__p&&__p();if(this.allows(K)){v().error("allow_already_allowed");throw new Error("allow() should only be called for users that are not already allowed")}if(this.getVisibility()===w.OFFLINE){v().error("allow_called_while_offline");throw new Error("allow() should only be called when the user is already online")}var L=this.getOnlinePolicy()===w.ONLINE_TO_WHITELIST?w.WHITELISTED:w.UNLISTED;return this.setFriendsVisibility([K],L)},disallow:function J(K){__p&&__p();if(!this.allows(K)){v().error("disallow_already_disallowed");throw new Error("disallow() should only be called for users that are not already disallowed")}if(this.getVisibility()===w.OFFLINE){v().error("disallow_called_while_offline");throw new Error("disallow() should only be called when the user is already online")}var L=this.getOnlinePolicy()===w.ONLINE_TO_BLACKLIST?w.BLACKLISTED:w.UNLISTED;return this.setFriendsVisibility([K],L)},getBlacklist:function J(){var K=[];for(var L in n)if(n[L]===w.BLACKLISTED)K.push(L);return K},getWhitelist:function J(){var K=[];for(var L in n)if(n[L]===w.WHITELISTED)K.push(L);return K},getMapForTest:function J(){return n},setMapForTest:function J(K){n=K}});w.inform("privacy-changed");w.inform("privacy-user-presence-changed",c("Arbiter").BEHAVIOR_STATE);v().log("initialized",{visibility:o,policy:r});c("Arbiter").subscribe(c("JSLogger").DUMP_EVENT,function(J,K){K.presence_privacy={initial:c("PresencePrivacyInitialData").privacyData,current:n}});c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("privacy_changed"),I.bind(this));c("Arbiter").subscribe(c("ChannelConstants").ON_CONFIG,function(J,K){var L=K.getConfig("visibility",null);if(L!==null&&typeof L!=="undefined"){var M=L?w.ONLINE:w.OFFLINE;z(M);v().log("config_visibility",{vis:M})}}.bind(this));f.exports=w}),null);
__d("ChatVisibility",["Arbiter","JSLogger","PresencePrivacy"],(function a(b,c,d,e,f,g){__p&&__p();var h={isOnline:function i(){return c("PresencePrivacy").getVisibility()===c("PresencePrivacy").ONLINE},hasBlackbirdEnabled:function i(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends()},isVisibleToMostFriends:function i(){return c("PresencePrivacy").getOnlinePolicy()===c("PresencePrivacy").ONLINE_TO_BLACKLIST&&c("PresencePrivacy").getBlacklist().length>0},isVisibleToSomeFriends:function i(){return c("PresencePrivacy").getOnlinePolicy()===c("PresencePrivacy").ONLINE_TO_WHITELIST&&c("PresencePrivacy").getWhitelist().length>0},goOnline:function i(j){if(c("PresencePrivacy").getVisibility()===c("PresencePrivacy").OFFLINE){c("JSLogger").create("blackbird").log("chat_go_online");c("PresencePrivacy").setVisibility(c("PresencePrivacy").ONLINE);c("Arbiter").inform("chat-visibility/go-online")}j&&j()},goOffline:function i(j){if(c("PresencePrivacy").getVisibility()===c("PresencePrivacy").ONLINE){c("JSLogger").create("blackbird").log("chat_go_offline");c("PresencePrivacy").setVisibility(c("PresencePrivacy").OFFLINE);c("Arbiter").inform("chat-visibility/go-offline")}j&&j()},toggleVisibility:function i(){if(h.isOnline())h.goOffline();else h.goOnline()}};f.exports=h}),null);
__d("FBAjaxRequest",["AjaxRequest","getAsyncParams"],(function a(b,c,d,e,f,g){__p&&__p();function h(i,j,k){__p&&__p();k=babelHelpers["extends"]({},c("getAsyncParams")(i),k);var l=new(c("AjaxRequest"))(i,j,k);l.streamMode=false;var m=l._call;l._call=function(n){if(n=="onJSON"&&this.json){if(this.json.error){this.errorType=c("AjaxRequest").SERVER_ERROR;this.errorText="AsyncResponse error: "+this.json.error}this.json=this.json.payload}m.apply(this,arguments)};l.ajaxReqSend=l.send;l.send=function(n){this.ajaxReqSend(babelHelpers["extends"]({},n,k))};return l}f.exports=h}),null);
__d("FBRTCSupport",["ChannelConstants","RTCConfig","UserAgent"],(function a(b,c,d,e,f,g){__p&&__p();var h={isSendWebrtcSupported:function i(){return!!c("RTCConfig").SendNewVCGK},isReceiveWebrtcSupported:function i(){return!!c("RTCConfig").ReceiveNewVCGK},isVideoCallBlockingSupported:function i(){return!!c("RTCConfig").VideoCallBlockingGK},isWebrtcSupported:function i(){return c("UserAgent").isBrowser("Chrome >= 28")||c("UserAgent").isBrowser("Firefox >= 25")||!!c("RTCConfig").RtcUseWebRTCForEdge&&c("UserAgent").isBrowser("Edge >= 15.15042")||c("UserAgent").isBrowser("Opera >= 20")},isGroupCallWebtrcSupported:function i(){return c("UserAgent").isBrowser("Chrome >= 28")||c("UserAgent").isBrowser("Opera >= 20")},isCollabSupported:function i(){return h.isWebrtcSupported()&&(!!c("RTCConfig").CollabWhitelistedBrowserGK||c("UserAgent").isBrowser("Chrome >= 48"))},isWirelessScreenSharingSupported:function i(){return!!c("RTCConfig").CollabWirelessScreenSharingGK&&c("UserAgent").isBrowser("Chrome >= 48")},isOSSupported:function i(){return!c("UserAgent").isPlatform("Android")&&!c("UserAgent").isPlatform("iOS")},isVideoFilterEffectSupported:function i(){return!!c("RTCConfig").RtcWwwVideoCallFiltersGK&&(c("UserAgent").isBrowser("Chrome >= 51")||c("UserAgent").isBrowser("Opera >= 36"))},getCapabilities:function i(){var j=0;if(this.isReceiveWebrtcSupported())j=c("ChannelConstants").CAPABILITY_VOIP_INTEROP;return j}};f.exports=h}),null);
__d("FantailLogger",["FantailConfig"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("FantailConfig").FantailLogQueue,i={debug:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).debug.apply(m,[l].concat(o))},info:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).info.apply(m,[l].concat(o))},warn:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).warn.apply(m,[l].concat(o))},error:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).error.apply(m,[l].concat(o))}};f.exports=i}),null);
__d("MovingStat",[],(function a(b,c,d,e,f,g){__p&&__p();function h(i){__p&&__p();i=i||6e4;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next}}this.add=function(o){__p&&__p();l+=o;m++;var p=new Date();if(p-j.t<1e3){j.v+=o;j.count++}else{j.next={t:p,v:o,count:1};j=j.next;n()}};this.tally=function(o){o=o||1e3;n();return{sum:l,count:m,timeAverage:l*o/i}}}f.exports=h}),null);
__d("Dcode",[],(function a(b,c,d,e,f,g){__p&&__p();var h,i={},j={_:"%",A:"%2",B:"000",C:"%7d",D:"%7b%22",E:"%2c%22",F:"%22%3a",G:"%2c%22ut%22%3a1",H:"%2c%22bls%22%3a",I:"%2c%22n%22%3a%22%",J:"%22%3a%7b%22i%22%3a0%7d",K:"%2c%22pt%22%3a0%2c%22vis%22%3a",L:"%2c%22ch%22%3a%7b%22h%22%3a%22",M:"%7b%22v%22%3a2%2c%22time%22%3a1",N:".channel%22%2c%22sub%22%3a%5b",O:"%2c%22sb%22%3a1%2c%22t%22%3a%5b",P:"%2c%22ud%22%3a100%2c%22lc%22%3a0",Q:"%5d%2c%22f%22%3anull%2c%22uct%22%3a",R:".channel%22%2c%22sub%22%3a%5b1%5d",S:"%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a",T:"%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a",U:"%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a",V:"%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a",W:"%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a",X:"%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1",Y:"%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a",Z:"%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a"};(function(){var l=[];for(var m in j){i[j[m]]=m;l.push(j[m])}l.reverse();h=new RegExp(l.join("|"),"g")})();var k={encode:function l(m){return encodeURIComponent(m).replace(/([_A-Z])|%../g,function(n,o){return o?"%"+o.charCodeAt(0).toString(16):n}).toLowerCase().replace(h,function(n){return i[n]})},decode:function l(m){return decodeURIComponent(m.replace(/[_A-Z]/g,function(n){return j[n]}))}};f.exports=k}),null);
__d("PresenceCookieManager",["Cookie","CurrentUser","Dcode","ErrorUtils","JSLogger","PresenceInitialData","PresenceUtil","WebStorage","WorkModeConfig"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("PresenceInitialData").cookieVersion,i="presence",j={},k=null,l=null,m=c("JSLogger").create("presence_cookie");function n(y){var z=c("Cookie").get(i)||"";if(z.length===0)return null;if(z[0]!==y)return null;return z.substring(1)}function o(y,z){c("Cookie").set(i,y+z)}function p(){if(!(c("PresenceInitialData").useWebStorage||false))return null;return c("WebStorage").getSessionStorage()}function q(){var y=p(),z=y!=null?y.getItem(i):null;if(z!=null)return z.substring(1);return null}function r(y){var z=p();if(z==null)return false;z.setItem(i,"E"+y);return true}function s(){var y=q();if(y!=null)return y;return n("E")}function t(y){var z=y.state;if(z==null)return"";var A=n("S")||"",B=c("WorkModeConfig").is_work_user?"w":"f",C=c("WorkModeConfig").is_work_user?z.t3w:z.t3,D=C!=null?C.length>0:false,E=A.indexOf(B)!==-1;if(E&&!D)A=A.replace(B,"");if(!E&&D)A+=B;return A}function u(y,z){var A=r(y);if(A)o("S",z);else{if(y.length>1024)m.warn("big_cookie",y.length);o("E",y)}}function v(){__p&&__p();try{var y=s();if(k!==y){k=y;l=null;if(y){y=c("Dcode").decode(y);l=JSON.parse(y)}}if(l){if(l.user&&l.user!==c("CurrentUser").getID())return null;if(l.v!==h)return null;return l}}catch(z){m.warn("getcookie_error",z)}return null}function w(){return parseInt(Date.now()/1e3,10)}var x={register:function y(z,A){j[z]=A},store:function y(){__p&&__p();var z=v();if(z&&z.v&&h<z.v){m.debug("stale_cookie",h);return}var A={v:h,time:w(),user:c("CurrentUser").getID()};for(var B in j)A[B]=c("ErrorUtils").applyWithGuard(j[B],j,[z&&z[B]],function(D){D.presence_subcookie=B});var C=c("Dcode").encode(JSON.stringify(A));if(c("PresenceUtil").hasUserCookie())u(C,t(A))},clear:function y(){c("Cookie").clear(i);var z=c("WebStorage").getSessionStorage();if(z!=null)z.removeItem(i)},getSubCookie:function y(z){var A=v();if(!A)return null;return A[z]}};f.exports=x}),null);
__d("FantaConst",[],(function a(b,c,d,e,f,g){"use strict";var h={DEFAULT_ALLOWED_RAISED_TABS:2,DEFAULT_MESSAGE_COUNT:10,cookieIDs:{PERSONAL_COOKIE_ID:"t3",PERSONAL_FOCUS_COOKIE_ID:"lm3",PERSONAL_TIME_COOKIE_ID:"utc3",WORK_COOKIE_ID:"t3w",WORK_FOCUS_COOKIE_ID:"lm3w",WORK_TIME_COOKIE_ID:"utc3w"},getCookieIDs:function i(){return[h.cookieIDs.PERSONAL_COOKIE_ID,h.cookieIDs.PERSONAL_FOCUS_COOKIE_ID,h.cookieIDs.PERSONAL_TIME_COOKIE_ID,h.cookieIDs.WORK_COOKIE_ID,h.cookieIDs.WORK_FOCUS_COOKIE_ID,h.cookieIDs.WORK_TIME_COOKIE_ID]}};f.exports=h}),null);
__d("PresenceState",["Arbiter","ErrorUtils","FantaConst","JSLogger","PresenceCookieManager","debounceAcrossTransitions","setIntervalAcrossTransitions","PresenceInitialData"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("PresenceInitialData").cookiePollInterval||2e3,i=c("PresenceInitialData").shouldSuppress||false,j=[],k=[],l=null,m=null,n=0,o=null,p=0,q=["sb2","tr","tw","at","wml"].concat(c("FantaConst").getCookieIDs()),r=c("JSLogger").create("presence_state");function s(){return c("PresenceCookieManager").getSubCookie("state")}function t(){n=Date.now();c("PresenceCookieManager").store();x(m)}var u=c("debounceAcrossTransitions")(t,0);function v(C){if(C==undefined||isNaN(C)||C==Number.POSITIVE_INFINITY||C==Number.NEGATIVE_INFINITY)C=0;return C}function w(C){__p&&__p();var D={};if(C){q.forEach(function(G){if(C&&C[G])D[G]=C[G]});if(n<C.ut)r.error("new_cookie",{cookie_time:C.ut,local_time:n})}D.ut=n;for(var E=0,F=j.length;E<F;E++)c("ErrorUtils").applyWithGuard(j[E],null,[D]);m=D;return m}function x(C){__p&&__p();p++;n=v(C&&C.ut);if(!l)l=c("setIntervalAcrossTransitions")(A,h);m=C;if(o===null)o=C;for(var D=0,E=k.length;D<E;D++)c("ErrorUtils").applyWithGuard(k[D],null,[C]);p--}function y(C){if(C&&C.ut)if(n<C.ut)return true;else if(C.ut<n)r.error("old_cookie",{cookie_time:C.ut,local_time:n});return false}function z(){var C=s();if(y(C))m=C;return m}function A(){var C=s();if(y(C))x(C)}c("PresenceCookieManager").register("state",w);c("Arbiter").subscribe(c("JSLogger").DUMP_EVENT,function(C,D){D.presence_state={initial:babelHelpers["extends"]({},o),state:babelHelpers["extends"]({},m),update_time:n,sync_paused:p,poll_time:h}});(function(){var C=z();if(C)x(C);else{r.debug("no_cookie_initial");x(w());return}})();var B={doSync:function C(D){if(p)return;if(D)t();else u()},registerStateStorer:function C(D){j.push(D)},registerStateLoader:function C(D){k.push(D)},get:function C(){return z()},getInitial:function C(){return o},shouldSuppress:function C(){return i},verifyNumber:v};f.exports=B}),null);
__d("RTISession",["invariant","URI","AjaxRequest","ErrorUtils","ChatproxyClientErrorsTypedLogger","BanzaiODS","Set"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();function i(j,k,l,m,n,o,p,q,r,s){__p&&__p();j||h(0);n||h(0);o||h(0);this.domain=j;this.topLevelDomain=k;this.port=l;this.edgePoolName=m;this.stickyToken=n;this.loggedInId=o;this.accountId=p;this.clientProfile=q||"desktop";this.clientId=r;this.capabilities=s}i.prototype.issueRequest=function(j,k,l,m,n){__p&&__p();j||h(0);k||h(0);m||h(0);var o=this.domain+"."+this.topLevelDomain,p=(1048576*Math.random()|0).toString(36),q={cb:p,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var r in q)!k[r]||h(0);Object.assign(q,k);var s=new(c("URI"))(j).setDomain(o).setPort(this.port).setSecure(new(c("URI"))(window.location.href).isSecure()).setQueryData(q),t=l?"POST":"GET",u=new(c("AjaxRequest"))(t,s);u.timeout=n?n*1e3:3e4;if(u.xhr)u.xhr.withCredentials=true;var v={};u.onSuccess=function(){c("BanzaiODS").bumpEntityKey("RTISession","request.success")};u.onJSON=function(){v.data=u.json;v.error=null;c("ErrorUtils").applyWithGuard(m,this,[v])}.bind(this);u.onError=function(){__p&&__p();var w=new(c("Set"))();if(l!==undefined&&l.subscriptions!==undefined)for(var x=0;x<l.subscriptions.length;x++){var y=l.subscriptions[x].topic.split("/");y.pop();w.add(y.join("/"))}v.data=null;v.error=u.errorType||"error";c("BanzaiODS").bumpEntityKey("RTISession","request.error");this.logRequestFailure(u,w);c("ErrorUtils").applyWithGuard(m,this,[v])}.bind(this);u.send(JSON.stringify(l))};i.prototype.logRequestFailure=function(j,k){__p&&__p();var l=new(c("ChatproxyClientErrorsTypedLogger"))();l.setStatusCode(j.status);if(j.xhr!=null){var m=j.xhr.getResponseHeader("x-fb-chat-failure-reason");if(m)l.setErrorReason(m)}l.setErrorMessage(j.errorType);l.setTopicPrefixes(k);l.setURL(j.uri.getPath());l.log()};f.exports=i}),null);
__d("ChannelManager",["errorCode","Promise","AjaxRequest","Arbiter","AsyncRequest","BanzaiODS","ChannelClientID","ChannelConstants","ChannelInitialData","ChannelSubdomain","ChannelTransport","ChannelTransportDataLogger","ChatVisibility","ChatReliabilityInstrumentation","DTSG","Env","FantailLogger","FBAjaxRequest","FBRTCSupport","ISB","JSLogger","LogHistory","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","Random","RTISession","SystemEvents","URI","UserActivity","ChatProxyConnectionState","emptyFunction","requestAnimationFrameAcrossTransitions","setIntervalAcrossTransitions","setTimeoutAcrossTransitions","clearTimeout"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j=c("JSLogger").create("channel"),k=c("LogHistory").getInstance("channel_manager"),l=null,m=c("emptyFunction"),n=new(c("Promise"))(function(z,A){m=z});function o(z){l=z}var p={idle:{ok:"init!"},init:{ok:"pull!",error:"reconnect",sys_online:"init",sys_timetravel:"init"},pull:{ok:"pull!",error:"ping",error_missing:"pull",error_msg_type:"pull",refresh_0:"reconnect",refresh_110:"reconnect",refresh_111:"reconnect",refresh_112:"pull",refresh_113:"pull",refresh_117:"reconnect"},ping:{ok:"pull!",error:"ping",error_stale:"reconnect!"},reconnect:{ok:"init!",error:"reconnect",sys_online:"reconnect",sys_timetravel:"reconnect"},shutdown:{},_all:{error_max:"shutdown!",error_shutdown:"shutdown!",sys_owner:"reconnect",sys_nonowner:"idle!",sys_online:"ping",sys_offline:"idle!",sys_timetravel:"ping"}},q={state:new(c("ChatProxyConnectionState"))(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:"",sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,pws:"fresh",estimatedReceived:0,sessionID:c("ChannelClientID").getID(),capabilities:c("FBRTCSupport").getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:c("PresenceState").shouldSuppress(),LONGPOLL_TIMEOUT:6e4,STREAMING_TIMEOUT:6e4,P_TIMEOUT:3e4,IFRAME_LOAD_TIMEOUT:3e4,MIN_RETRY_INTERVAL:5e3,MAX_RETRY_INTERVAL:32e4,MIN_12002_TIMEOUT:9e3,MIN_504_TIMEOUT:2e4,STALL_THRESHOLD:18e4,JUMPSTART_THRESHOLD:9e4,MIN_INIT_PROBE_DELAY:3e3,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12e3,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:1e4,PROBE_DELAY:6e4,PROBE_HEARTBEATS_INTERVAL_LOW:1e3,PROBE_HEARTBEATS_INTERVAL_HIGH:5e3,STREAMING_EXIT_STATE_ON_CONTINUE:false},r=1,s={},t=0;function u(){return c("AsyncRequest").lastSuccessTime?Math.round((Date.now()-c("AsyncRequest").lastSuccessTime)/1e3):-1}function v(){var z={};if(i.getConfig("host"))z[i.getConfig("user_channel")]=i.getConfig("seq",0);return z}function w(){__p&&__p();var z=Date.now(),A=Date.now(),B={total:0},C="idle",D=false;c("SystemEvents").subscribe([c("SystemEvents").USER,c("SystemEvents").ONLINE,c("SystemEvents").TIME_TRAVEL],function(G,H){__p&&__p();x(true);A=null;i.lastPullTime=Date.now();var I;switch(G){case c("SystemEvents").USER:I=c("SystemEvents").isPageOwner()?c("ChannelConstants").SYS_OWNER:c("ChannelConstants").SYS_NONOWNER;break;case c("SystemEvents").ONLINE:I=H?c("ChannelConstants").SYS_ONLINE:c("ChannelConstants").SYS_OFFLINE;break;case c("SystemEvents").TIME_TRAVEL:if(q.skipTimeTravel)return;if(0<H){c("FantailLogger").warn(c("ChannelConstants").FANTAIL_SERVICE,"skipping time travel failure. %s",H);return}I=c("ChannelConstants").SYS_TIMETRAVEL;break}i.exitState({status:I,stateId:r})});var E=function E(G,H){__p&&__p();var I=Date.now(),J=null;if(H){z=I;J=H.nextState||H.state}else J=C;c("SystemEvents").checkTimeTravel();if(A){var K=Math.round((I-A)/1e3);if(K>0){B[C]=(B[C]||0)+K;B.total+=K}}C=J;A=I;if(!G){B.lastSuccessTime=u();B.online=c("SystemEvents").isOnline();k.log("rollup",JSON.stringify(B))}};c("Arbiter").subscribe(c("ChannelConstants").ON_ENTER_STATE,E);c("setIntervalAcrossTransitions")(E,6e4);c("Arbiter").subscribe(c("JSLogger").DUMP_EVENT,function(G,H){H.channelRollup=B});var F=function F(){__p&&__p();if(i.isShutdown()||i.shouldIdle())return;c("SystemEvents").checkTimeTravel();var G=Date.now()-(i.lastPullTime||c("Env").start);if(!D&&G>q.STALL_THRESHOLD){var H=u();k.error("stall",JSON.stringify({lastSuccessTime:H,rollupState:C}));c("ChatReliabilityInstrumentation").logCHANNEL_STALLED(G.toString());D=true}var I=Date.now()-z;if(i.state=="pull"&&I>q.JUMPSTART_THRESHOLD){z=null;k.warn("jumpstart",JSON.stringify({state:i.state,dormant:I}));c("Arbiter").inform(c("ChannelConstants").JUMPSTART,I);i.enterState("init")}};c("setIntervalAcrossTransitions")(F,5e3)}function x(z){if(z){t=0;s={}}else t++}function y(z,A){var B=!c("AjaxRequest").supportsCORS(),C=c("ChannelTransport").isSubdomain(q.subdomain);if(!C||B)q.fullHost=q.host;else q.fullHost=q.subdomain+"-"+q.host;c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"received lb info: %s at seq: %s{%s} with ".concat("sticky: %s/%s, subdomain: %s, fullHost: %s, state: %s,").concat(" source: %s, args: %s"),q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool,q.subdomain,q.fullHost,i.state,z,A)}i={state:"idle",nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:o,backoff:false,sessionRegistered:false,init:function z(A,B){__p&&__p();c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"initializing sessionid:%s at iris-seq:%s",q.sessionID,q.sequenceId);this.init=c("emptyFunction");c("Arbiter").subscribe(c("ChannelConstants").GET_RTI_SESSION_REQUEST,function(event,G){this.informCurrentSession()}.bind(this));c("requestAnimationFrameAcrossTransitions")(function(){__p&&__p();c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"using session id: %s at seq: %s {%s} with sticky: %s/%s",q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool);c("UserActivity").subscribe(function(){var G=c("ChannelTransport").getURI(q,"/U");c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"user activity sessionid: %s at seq: %s/{%s} with sticky: %s/%s state: %s uri: %s",q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool,i.state,G);if(i.state=="pull"){q.userActive=Date.now();c("ChannelTransport").sendActivePing(q)}});c("Arbiter").subscribe(c("ChannelConstants").ENTITY_PRESENCE_ACTIVE_PING,function(G){var H=c("ChannelTransport").getURI(q,"/U");c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"entity presence activity sessionid: %s at seq: %s/{%s} with sticky: %s/%s state: %s uri: %s",q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool,i.state,H);if(i.state=="pull")q.userActive=Date.now()})});c("PresenceCookieManager").register("ch",v);var C=this.getConfig("max_conn",2);q.subdomain=c("ChannelSubdomain").allocate(C);if(!c("ChannelTransport").isSubdomain(q.subdomain)){c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"invalid subdomain from ChannelSubdomain: %s",q.subdomain);q.subdomain=null}this._transportRate=new(c("MovingStat"))(3e4);var D=c("AjaxRequest").supportsCORS()?"CORSTransport":"IframeTransport";c("BanzaiODS").bumpEntityKey("ChannelManager","transport_chosen."+D);this.transport=new(c("ChannelTransport")[D])(this);m(this.transport);if(A)this.enterState(A,B);c("requestAnimationFrameAcrossTransitions")(function(){c("Arbiter").subscribe(c("JSLogger").DUMP_EVENT,function(event,G){if(this._transportRate){G.transportRate=this._transportRate.tally();G.transportType=D;G.transportVersion=2}}.bind(this));w()}.bind(this));if(i.getConfig("fullHost")&&c("AjaxRequest").supportsCORS()){if(i.getConfig("tryStreaming")){var E=q.MIN_INIT_PROBE_DELAY+c("Random").random()*q.INIT_PROBE_DELAY_RANDOMIZE_RANGE;c("setTimeoutAcrossTransitions")(this._probeTest,E)}if(i.getConfig("trySSEStreaming")){var F=q.MIN_INIT_PROBE_DELAY+c("Random").random()*q.INIT_PROBE_DELAY_RANDOMIZE_RANGE;c("setTimeoutAcrossTransitions")(this._sseProbeTest,F)}}},configure:function z(){for(var A=arguments.length,B=Array(A),C=0;C<A;C++)B[C]=arguments[C];k.log("configure",JSON.stringify(B));B.forEach(function(D){return Object.assign(q,D)});y("reconnect",JSON.stringify(B));c("Arbiter").inform(c("ChannelConstants").ON_CONFIG,this)},getConfig:function z(A,B){return Object.prototype.hasOwnProperty.call(q,A)?q[A]:B},getCompleteConfig:function z(){return q},subscribeIrisQueue:function z(A,B){q.state.subscribeIrisQueue(A,B);this.exitState({status:c("ChannelConstants").OK,stateId:r})},unsubscribeIrisQueue:function z(A){q.state.unsubscribeIrisQueue(A)},informCurrentSession:function z(){var A=null;if(this.sessionRegistered&&q&&q.fullHost&&q.sticky_token&&q.uid)A=new(c("RTISession"))(q.fullHost,q.domain,q.port,q.sticky_pool,q.sticky_token,q.uid,q.viewerUid,q.profile,q.sessionID,q.capabilities);c("Arbiter").inform(c("ChannelConstants").RTI_SESSION,A)},isShutdown:function z(){return this.state=="shutdown"},shouldIdle:function z(){return!(c("SystemEvents").isPageOwner()&&c("SystemEvents").isOnline())},_sendIframeError:function z(A){var B=new(c("AsyncRequest"))().setURI("/ajax/presence/reconnect.php").setData({reason:A,fb_dtsg:c("DTSG").getToken()}).setOption("suppressErrorHandlerWarning",true).setOption("retries",1).setMethod("GET").setReadOnly(true).setAllowCrossPageTransition(true);B.specifiesWriteRequiredParams()&&B.send()},_getDelay:function z(){var A=Math.min(q.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,t-1)),q.MAX_RETRY_INTERVAL);if(this.proxyDown&&"proxy_down_delay_millis"in q)A=q.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(A*(1+Math.random()*.5))},resetDelay:function z(){x(true)},enterState:function z(){__p&&__p();if(this._inEnterState){k.warn("enterstate_recursion",JSON.stringify({state:this.state,args:arguments}));c("ChatReliabilityInstrumentation").logERROR("enterstate_recursion")}this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false}catch(A){this._inEnterState=false;throw A}},_enterState:function z(A){__p&&__p();var B=this.backoff?this._getDelay():0;this.backoff=false;if(this.isShutdown()){c("FantailLogger").warn(c("ChannelConstants").FANTAIL_SERVICE,"not executing state due to shutdown mode: %s",A);return}if(A!="idle!"&&this.shouldIdle()){c("FantailLogger").warn(c("ChannelConstants").FANTAIL_SERVICE,"forced idleness");return}r++;q.stateId=r;c("clearTimeout")(this._deferredTransition);this._deferredTransition=null;if(!this.transport){n.done(function(H){return H.enterState("idle")});c("ChatReliabilityInstrumentation").logERROR("called enterState "+A+" before transport init")}else this.transport.enterState("idle");this.state="idle";this.nextState=null;if(/!$/.test(A)){if(this._transportRate){var C=this._transportRate.tally().timeAverage,D=i.getConfig("MAX_CHANNEL_STATES_PER_SEC",1);if(C>=D){if(!this._throttled){this._throttled=true;k.warn("throttled","{}");c("Arbiter").inform(c("ChannelConstants").THROTTLED,C)}j.bump("throttle");B=1e3/D}}}else if(!/#$/.test(A))B=this._getDelay();A=A.replace(/\W*$/,"");if(!p[A]){c("FantailLogger").error(c("ChannelConstants").FANTAIL_SERVICE,"invalid state: %s",A);throw new Error("invalid state:"+A)}var E=Array.from(arguments),F;if(B<=0){F={state:A};if(this._transportRate)this._transportRate.add(1);this.state=A;var G=this["_enter_"+this.state];if(G){E.shift();G.apply(this,E)}if(/init|idle|pull|ping/.test(this.state)){if(q.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];q.is_offline=!c("ChatVisibility").isOnline();q.capabilities=c("FBRTCSupport").getCapabilities();c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"entering transport state: %s",this.state);if(!this.transport){n.done(function(H){return H.enterState(this.state,q)}.bind(this));c("ChatReliabilityInstrumentation").logERROR("called enterState "+A+" before transport init")}else this.transport.enterState(this.state,q);if(this.state=="ping"){F.url=c("ChannelTransport").getURI(q).toString();F.port=q.port||"undefined"}}}else{this.state="idle";this.nextState=A;F={state:this.state,delay:B,nextState:A};E[0]=A+"#";this._deferredTransition=c("setTimeoutAcrossTransitions")(function(){this._deferredTransition=null;this.enterState.apply(this,E)}.bind(this),B)}if(/pull/.test(A)){F.client_id=q.sessionID;F.streaming=q.inStreaming}c("Arbiter").inform(c("ChannelConstants").ON_ENTER_STATE,F)},exitState:function z(A,B){__p&&__p();var C=A.stateId,D=A.status;if(this.isShutdown()||C<r)return;var E=this.state,F=Array.from(arguments);F[0]=A.status;var G={state:E,status:D};if(/pull/.test(E)){G.client_id=q.sessionID;G.streaming=q.inStreaming}if(/ping/.test(E)&&D!=c("ChannelConstants").OK)G.url=c("ChannelTransport").getURI(q).toString();if(this.nextState)G.nextState=this.nextState;if(B&&B.errorType){q.lastRequestErrorReason=B.errorType;G.xhr=B.toJSON?B.toJSON():B;if(B.errorType==c("AjaxRequest").SERVICE_UNAVAILABLE){c("FantailLogger").error(c("ChannelConstants").FANTAIL_SERVICE,"got 5xx http status code, setting long delay");this.proxyDown=true}delete G.xhr.json}else if(D!=c("ChannelConstants").OK)q.lastRequestErrorReason=D;if(B&&B.json){if(B.json.t)G.t=B.json.t;if(B.json.reason)G.reason=B.json.reason;if(B.json.seq)G.seq=B.json.seq}c("Arbiter").inform(c("ChannelConstants").ON_EXIT_STATE,G);var H=this["_exit_"+E];if(H)D=H.apply(this,F)||D;if(D!=c("ChannelConstants").OK){x();s[E]=(s[E]||0)+1}var I=p[this.nextState||E][D]||p._all[D],J=I&&I.replace(/!*$/,"");if(!J){k.error("terminal_transition",JSON.stringify(G));this._shutdownHint=c("ChannelConstants").HINT_INVALID_STATE;I="shutdown!";c("FantailLogger").error(c("ChannelConstants").FANTAIL_SERVICE,"entering shutdown state")}this._lastState=E;this._lastStatus=D;this.enterState(I)},_processTransportData:function z(A,B){this._processTransportData0(A,B,B.json)},_processTransportData0:function z(A,B,C){__p&&__p();var D=C.t;if("s"in C){C.seq=C.s;delete C.s}if(C.u&&q.user&&C.u!=q.user){k.warn("misguided_msg",JSON.stringify({user:q.user,target:C.u}));this._reportProxyMisguidedMsg(C.u,q.user);return}c("ChannelTransportDataLogger").log(C);var E=q.seq;if("seq"in C){q.seq=C.seq;c("PresenceState").doSync()}switch(D){case"continue":if(q.inStreaming&&this.heartbeats.length<1){q.streamingCapable=false;k.log("switch_to_longpoll","{}");c("setTimeoutAcrossTransitions")(this._probeTest,q.PROBE_DELAY)}x(true);if(!q.inStreaming||q.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:c("ChannelConstants").OK,stateId:A});break;case"refresh":case"refreshDelay":c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"got refresh with reason: %s",C.reason);this.exitState({status:"refresh_"+(C.reason||0),stateId:A},B);break;case"backoff":c("FantailLogger").warn(c("ChannelConstants").FANTAIL_SERVICE,"server told client to back off");x();this.backoff=true;break;case"lb":var F=C.lb_info;if(F){q.sticky_token=F.sticky;if("pool"in F)q.sticky_pool=F.pool;if("sd"in F){var G=F.subdomain;if(c("ChannelTransport").isSubdomain(G))q.subdomain=F.subdomain}if("vip"in F)q.host=F.vip;y("chatproxy",JSON.stringify(C))}else k.error("missing_lb_info","{}");break;case"test_streaming":c("setTimeoutAcrossTransitions")(this._probeTest,500);break;case"fullReload":c("PresenceCookieManager").clear();k.log("full_reload","{}");this.sessionRegistered=true;this.informCurrentSession();c("Arbiter").inform(c("ChannelConstants").ON_INVALID_HISTORY);x(true);c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"full reload incurred");var H=c("ChannelConstants").OK;this.exitState({status:H,stateId:A},B);if("ms"in C)this._processMessages(C,E);break;case"msg":x(true);this._processMessages(C,E);break;case"heartbeat":if(q.inStreaming){var I=Date.now();if(this.heartbeats.length>0)var J=I-this.heartbeats[this.heartbeats.length-1];k.log("heartbeat_interval",JSON.stringify({client_id:q.sessionID,interval:J}));this.heartbeats.push(I)}break;case"batched":var K=C.batches,L;for(L=0;L<K.length;L++)this._processTransportData0(A,B,K[L]);break;default:c("FantailLogger").error(c("ChannelConstants").FANTAIL_SERVICE,"got an unknown protocol message: %s",D);k.error("unknown_msg_type",JSON.stringify({type:D}));break}},_processMessages:function z(A,B){__p&&__p();var C,D,E,F;if("tr"in A)q.trace_id=A.tr;D=A.ms;E=q.seq-D.length;for(C=0;C<D.length;C++,E++){q.estimatedReceived++;if(E>=B){F=D[C];if(F.type){var G=c("ChannelConstants").getArbiterType(F.type);if(F.type==="messaging"){var H={type:"messaging",event:F.event};if(F.message){H.inbox_unread=F.unread_counts&&F.unread_counts.inbox;H.tid=F.message.tid;H.mid=F.message.mid;c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"got message with id: %s",F.message.mid)}}else if(F.type==="skywalker")G=c("ChannelConstants").SKYWALKER;else if(F.type==="qprimer"){F.first=!q.ready;if(F.first){q.ready=true;q.timeUntilReady=Date.now()-q.created;q.queueMade=F.made}G=c("ChannelConstants").CHANNEL_ESTABLISHED}else if(F.type==="pws")q.pws=F.pws;else if(F.type==="delta")q.sequenceId=F.iseq;try{c("Arbiter").inform(G,{obj:F})}catch(I){c("BanzaiODS").bumpEntityKey("ChannelManager","processMessages.error."+F.type);c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"message threw exception: %s %s",I,F)}}}else k.warn("seq_regression",JSON.stringify({last_seq:B,messages:D.length,seq:E}))}},_enter_init:function z(){if(s.init>=i.getConfig("MAX_INIT_FAILS",2))return c("setTimeoutAcrossTransitions")(function(){return this.exitState({status:c("ChannelConstants").ERROR_MAX,stateId:r})}.bind(this),0);this._initTimer=c("setTimeoutAcrossTransitions")(function(){return this.exitState({status:c("ChannelConstants").ERROR,stateId:r},"timeout")}.bind(this),q.IFRAME_LOAD_TIMEOUT)},_enter_reconnect:function z(A){__p&&__p();k.warn("enter_reconnect",A);c("FantailLogger").info(c("ChannelConstants").FANTAIL_SERVICE,"entered reconnect with reason: %s",A);var B=r;if(!c("PresenceUtil").hasUserCookie()){c("FantailLogger").warn(c("ChannelConstants").FANTAIL_SERVICE,"user has no cookie???");k.warn("no_user_cookie","{}");c("setTimeoutAcrossTransitions")(function(){this._shutdownHint=c("ChannelConstants").HINT_AUTH;this.exitState({status:c("ChannelConstants").ERROR_SHUTDOWN,stateId:B})}.bind(this),0);return}var C={reason:A,fb_dtsg:c("DTSG").getToken()};if(c("ISB").token)C.fb_isb=c("ISB").token;if(l)l(C);var D=new(c("FBAjaxRequest"))("GET","/ajax/presence/reconnect.php",C);D.onSuccess=function(){i.configure(D.json);c("PresenceCookieManager").store();this.exitState({status:c("ChannelConstants").OK,stateId:B})}.bind(this);D.onError=function(){__p&&__p();var E=D.json&&D.json.error;c("FantailLogger").error(c("ChannelConstants").FANTAIL_SERVICE,"reconnect error: %s",D.errorType);if(D.errorType==c("AjaxRequest").TRANSPORT_ERROR||D.errorType==c("AjaxRequest").PROXY_ERROR||D.errorType==c("AjaxRequest").SERVICE_UNAVAILABLE)this._shutdownHint=c("ChannelConstants").HINT_CONN;if(E&&E==1356007)this._shutdownHint=c("ChannelConstants").HINT_MAINT;else if(E==1357001||E==1357004||E==1348009)this._shutdownHint=c("ChannelConstants").HINT_AUTH;else this._shutdownHint=null;this.exitState({status:this._shutdownHint?c("ChannelConstants").ERROR_SHUTDOWN:c("ChannelConstants").ERROR,stateId:B},D)}.bind(this);D.send()},_enter_shutdown:function z(){c("Arbiter").inform(c("ChannelConstants").ON_SHUTDOWN,{reason:this._shutdownHint});if("shutdown_recovery_interval_seconds"in q&&q.shutdown_recovery_interval_seconds>0){var A=q.shutdown_recovery_interval_seconds*1e3;c("setTimeoutAcrossTransitions")(function(){c("Arbiter").inform(c("ChannelConstants").ATTEMPT_RECONNECT);this._shutdownHint=null;this.state="reconnect!";this.enterState("reconnect!")}.bind(this),A)}},_exit_init:function z(A){if(this._initTimer)this._initTimer=c("clearTimeout")(this._initTimer);if(A==c("ChannelConstants").ERROR_MAX)this._sendIframeError(c("ChannelConstants").reason_IFrameLoadGiveUp)},_exit_pull:function z(A,B){var C=A==c("ChannelConstants").OK;if(C)this.lastPullTime=Date.now();else{var D="exit status: "+A;if(B&&B.errorType)D+=" ajax request error: "+B.errorType;c("FantailLogger").error(c("ChannelConstants").FANTAIL_SERVICE,"pull failed with status: %s",D)}},_exit_ping:function z(A){if(A==c("ChannelConstants").OK){var B=Date.now()-(this.lastPullTime||c("Env").start);if(B>q.STALL_THRESHOLD){c("FantailLogger").error(c("ChannelConstants").FANTAIL_SERVICE,"didnt complete a successful pull for too long");return c("ChannelConstants").ERROR_STALE}}else c("FantailLogger").error(c("ChannelConstants").FANTAIL_SERVICE,"ping failed with status: %s",A)},_reportProxyMisguidedMsg:function z(A,B){__p&&__p();c("FantailLogger").error(c("ChannelConstants").FANTAIL_SERVICE,"misguided message to %s meant for %s",B,A);var C=Date.now();if(C-this.lastReportOnMisguidedMsgTime<=q.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=C;var D={received_uid:A,expected_uid:B};if(q.sticky_token)D.sticky_token=q.sticky_token;var E=new(c("URI"))("/err_misguided_msg").setDomain(q.host+"."+q.domain).setPort(q.port).setSecure(new(c("URI"))(window.location.href).isSecure()).setQueryData(D),F=new(c("AjaxRequest"))("GET",E);if(c("AjaxRequest").supportsCORS())F.xhr.withCredentials=true;F.onSuccess=function(G){};F.onError=function(G){};F.onJSON=function(G,H){};F.send()},_probeTest:function z(){__p&&__p();q.streamingCapable=false;var A=[],B={mode:"stream",format:"json"};if(q.sticky_token)B.sticky_token=q.sticky_token;var C=new(c("URI"))("/probe").setDomain(q.fullHost+"."+q.domain).setPort(q.port).setSecure(new(c("URI"))(window.location.href).isSecure()).setQueryData(B);c("BanzaiODS").bumpEntityKey("ChannelManager","probe.attempt");var D=new(c("AjaxRequest"))("GET",C);D.onJSON=function(E,F){__p&&__p();if(E&&E.json&&E.json.t==="heartbeat"){A.push(Date.now());if(A.length>=2){var G=A[1]-A[0];if(G>=q.PROBE_HEARTBEATS_INTERVAL_LOW&&G<=q.PROBE_HEARTBEATS_INTERVAL_HIGH){q.streamingCapable=true;c("BanzaiODS").bumpEntityKey("ChannelManager","probe.switch_to_streaming");k.log("switch_to_streaming","{}")}else c("BanzaiODS").bumpEntityKey("ChannelManager","probe.failure.delayed")}}};D.onSuccess=function(E){if(A.length!=2){q.streamingCapable=false;c("BanzaiODS").bumpEntityKey("ChannelManager","probe.failure.data_loss");k.error("probe_error",JSON.stringify({error:"beats.length = "+A.length}))}c("BanzaiODS").bumpEntityKey("ChannelManager","probe.success");k.log("probe_success","{}")};D.onError=function(E){q.streamingCapable=false;c("BanzaiODS").bumpEntityKey("ChannelManager","probe.failure.error");k.error("probe_error",JSON.stringify(E))};D.send()},_sseProbeTest:function z(){__p&&__p();if(!window.EventSource){c("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.failure.no_event_source");k.log("sse_probe.failure.no_event_source","{}");return}var A=[],B={mode:"sse",format:"json"};if(q.sticky_token)B.sticky_token=q.sticky_token;var C=new(c("URI"))("/sse_probe").setDomain(q.fullHost+"."+q.domain).setPort(q.port).setSecure(new(c("URI"))(window.location.href).isSecure()).setQueryData(B);c("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.attempt");var D=new EventSource(C),E=c("setTimeoutAcrossTransitions")(function(){D.close();c("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.failure.timeout");k.log("sse_probe.failure.timeout","{}")},q.PROBE_HEARTBEATS_INTERVAL_HIGH*6);D.addEventListener("heartbeat",function(F){__p&&__p();A.push(Date.now());if(A.length>=2){var G=A[1]-A[0];if(G>=q.PROBE_HEARTBEATS_INTERVAL_LOW&&G<=q.PROBE_HEARTBEATS_INTERVAL_HIGH){c("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.success");k.log("sse_probe.success","{}")}else{c("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.failure.delayed");k.log("sse_probe.failure.delayed","{}")}c("clearTimeout")(E);D.close()}});D.onerror=function(F){c("BanzaiODS").bumpEntityKey("ChannelManager","sse_probe.failure.error");k.error("sse_probe.failure.error",JSON.stringify(F));c("clearTimeout")(E);D.close()}},startChannelManager:function z(){if(c("ChannelInitialData").channelConfig){i.configure(c("ChannelInitialData").channelConfig);if(/shutdown/.test(c("ChannelInitialData").state))i._shutdownHint=c("ChannelConstants")[c("ChannelInitialData").reason];i.init(c("ChannelInitialData").state,c("ChannelInitialData").reason);c("ChatReliabilityInstrumentation").logCHANNEL_INIT();this.startChannelManager=c("emptyFunction")}else c("ChatReliabilityInstrumentation").logCHANNEL_NOCONFIG()}};f.exports=i}),null);
__d("RTISubscriptionGate",["RTISubscriptionGateLoader"],(function a(b,c,d,e,f,g){var h=c("RTISubscriptionGateLoader").module;if(c("RTISubscriptionGateLoader").gkUseIcebreaker)h=new h(c("RTISubscriptionGateLoader").icebreakerWhitelist);f.exports=h}),null);
__d("UFIVideoPlayerRegistry",["EventEmitter","Map","Set","VideoPlayerReason","ViewportBounds","destroyOnUnload","getOrCreateDOMID"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=new(c("EventEmitter"))(),i=new(c("Map"))(),j=new(c("Map"))(),k=new(c("Map"))(),l=new(c("Map"))(),m=new(c("Set"))(),n=new(c("Map"))();c("destroyOnUnload")(function(){h.removeAllListeners();i.clear();j.clear();k.clear();l.clear();m.clear()});function o(s){var t=s,u=[];while(t){u.unshift(t);t=t.parentElement}return u}function p(s,t){__p&&__p();var u=o(s),v=null,w=null;t.forEach(function(x){var y=x[0],z=x[1],A=o(y);for(var B=0;B<u.length;++B)if(u[B]!==A[B]){if(w===null||B>w){w=B;v=z}break}});return v}function q(s,t){__p&&__p();var u=o(s),v=null,w=null;t.forEach(function(x){var y=x[0],z=x[1],A=o(y);for(var B=0;B<u.length;++B)if(u[B]!==A[B]){if(w===null||B>w){w=B;v=z}break}});return v}var r={registerVideoPlayerController:function s(t){__p&&__p();var u=t.getVideoID(),v=l.get(u);if(v)v.push(t);else{v=[t];l.set(u,v);k["delete"](u)}m.forEach(function(x){return x()});var w=i.get(u);if(!w)return;w.forEach(function(x){return this._associateUFIController(x,u)}.bind(this))},addOnRegisterListener:function s(t){m.add(t)},removeOnRegisterListener:function s(t){m["delete"](t)},getAvailableVideoPlayerController:function s(t){return j.get(t)},seekAvailableVideoPlayerController:function s(t,u){var v=r.getAvailableVideoPlayerController(t);if(!v)return;if(["ready","playing","paused","finished"].includes(v.getState())){v.pause(c("VideoPlayerReason").SEEK);v.seek(u);v.play(c("VideoPlayerReason").SEEK)}},scrollToAvailableVideo:function s(t){var u=r.getAvailableVideoPlayerController(t);if(!u)return;var v=c("ViewportBounds").getElementPosition(u.getRootNode());window.scroll(0,v.y)},setAvailableVideoPlayerControllerSphericalViewport:function s(t,u){var v=r.getAvailableVideoPlayerController(t);if(!v)return;v.emit("SphericalVideoViewportTagComment/click",u)},getAvailableVideoPlayerControllerForElement:function s(t,u){if(!t)return null;var v=k.get(u)||new(c("Map"))(),w=c("getOrCreateDOMID")(t),x=v.get(w)||this._findVideoPlayerControllerForElement(t,u);v.set(w,x);k.set(u,v);return x},getAvailableVideoPlayerControllerTimeForElement:function s(t,u){if(!t)return null;var v=r.getAvailableVideoPlayerControllerForElement(t,u);if(!v)return null;var w=v.getCurrentTimePosition();if(w>=0)return Math.floor(w);return null},getAvailableVideoPlayerControllerTime:function s(t){var u=r.getAvailableVideoPlayerController(t);if(!u)return null;var v=u.getCurrentTimePosition();if(v>=0)return Math.floor(v);return null},registerUFIController:function s(t,u,v){__p&&__p();var w=t.getInstanceID(),x=t.getFluentContentToken();if(!x)return;var y=i.get(x);if(y)y.push(t);else{y=[t];i.set(x,y)}h.addListener(w+"/register",u);h.addListener(w+"/unregister",v);this._associateUFIController(t,x)},getAvailableUFIController:function s(t){__p&&__p();var u=n.get(t);if(u)return u;var v=i.get(t.getVideoID());if(!v)return null;if(v.length===1)u=v[0];else u=q(t.getRootNode(),v.map(function(x){return[x.getRootNode(),x]}));if(u){var w=this._findVideoPlayerControllerForElement(u.getRootNode(),t.getVideoID());if(w!==t)return null;n.set(t,u)}return u},_findVideoPlayerControllerForElement:function s(t,u){var v=l.get(u);if(!v)return null;if(v.length===1)return v[0];return p(t,v.filter(function(w){return!w.isState("destroyed")}).map(function(w){return[w.getRootNode(),w]}))},_associateUFIController:function s(t,u){__p&&__p();var v=t.getInstanceID(),w=this._findVideoPlayerControllerForElement(t.getRootNode(),u);if(!w||w.isState("destroyed"))return;var x=j.get(v);if(x){if(!x.isState("destroyed")&&c("getOrCreateDOMID")(x.getRootNode())===c("getOrCreateDOMID")(w.getRootNode()))return;h.emit(v+"/unregister")}j.set(v,w);h.emit(v+"/register",w)}};f.exports=r}),null);
__d("BaseGraphQLSubscription",["Banzai","BanzaiLogger","ChannelClientID","CurrentLocale","CurrentUser","GraphQLSubscriptionsConfig","RTISubscriptionGate","URI"],(function a(b,c,d,e,f,g){__p&&__p();var h=1e4,i={subscribe:function j(k,l){var m=arguments.length<=2||arguments[2]===undefined?null:arguments[2],n=this._getQueryParameters(k),o=void 0;if(m===null)o={transformContext:JSON.stringify(this._getTransformContext(k,n))};else o={transformContext:JSON.stringify(this._getTransformContext(k,n)),policy:m};this._logEvent("client_subscribe",n);return c("RTISubscriptionGate").subscribe(this._getTopic(k),function(p){this._logEvent("receivepayload",n);l(JSON.parse(p.payload))}.bind(this),o,null,function(){this._logEvent("client_unsubscribe",n)}.bind(this))},subscribeWithIcebreaker_EXPERIMENTAL:function j(k,l,m){__p&&__p();var n=new(c("URI"))("https://streaming-graph.facebook.com/gqls_bore");n.setQueryData({access_token:m});var o=this._getTopic(k),p={topic:o,locale:c("CurrentLocale").get(),queryID:this._getQueryID(),serializedQueryParameters:JSON.stringify(this._getQueryParameters(k))};n.addQueryData(p);var q=new EventSource(n.toString(),{withCredentials:true});q.addEventListener("message",function(r){l(JSON.parse(JSON.parse(r.data).payload))},false);return{getContext:function r(){return p},unsubscribe:function r(){return q.close()}}},_getTransformContext:function j(k,l){var m=155160167952447;return{viewerID:this._getViewerID(k),appID:m,locale:c("CurrentLocale").get(),queryID:this._getQueryID(),serializedQueryParameters:JSON.stringify(l)}},_getViewerID:function j(k){return c("CurrentUser").getID()},_logEvent:function j(k,l){if(c("Banzai").isEnabled("gqls_web_logging")){var m=c("GraphQLSubscriptionsConfig").shouldAlwaysLog?1:h;if(Math.random()*m<1)c("BanzaiLogger").log("GraphQLSubscriptionsLoggerConfig",{clienttime:Date.now()/1e3,client_sample_weight:m,event:k,mechanism:"skywalker",query_id:parseInt(this._getQueryID(),10),query_params:l,session_id:c("ChannelClientID").getID(),subscription_call:this._getSubscriptionCallName()})}}};f.exports=i}),null);
__d("WebGraphQLSubscriptionHelper",[],(function a(b,c,d,e,f,g){"use strict";f.exports={getExports:function h(i){var j=i.docID,k=i.queryID;return{getDocID:function l(){return j},getLegacyQueryID:function l(){return k}}}}}),null);
__d("FeedbackAddStreamingReactionWebGraphQLSubscription",["WebGraphQLSubscriptionHelper"],(function a(b,c,d,e,f,g){"use strict";f.exports=c("WebGraphQLSubscriptionHelper").getExports({docID:"1568746946533577",queryID:"158119731410742"})}),null);
__d("uuid",[],(function a(b,c,d,e,f,g){function h(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var j=Math.random()*16|0,k=i=="x"?j:j&3|8;return k.toString(16)})}f.exports=h}),null);
__d("FeedbackAddStreamingReactionSubscription",["BaseGraphQLSubscription","FeedbackAddStreamingReactionWebGraphQLSubscription","uuid"],(function a(b,c,d,e,f,g){var h=babelHelpers["extends"]({},c("BaseGraphQLSubscription"),{_getTopic:function i(j){return"gqls/feedback_add_streaming_reaction_subscribe/feedback_id_"+j},_getQueryID:function i(){return c("FeedbackAddStreamingReactionWebGraphQLSubscription").getDocID()},_getQueryParameters:function i(j){return{input:JSON.stringify({client_subscription_id:c("uuid")(),feedback_id:j})}},_getSubscriptionCallName:function i(){return"feedback_add_streaming_reaction_subscribe"}});f.exports=h}),null);
__d("SpatialReactionConsumptionTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(){this.clear()}h.prototype.log=function(){c("GeneratedLoggerUtils").log("logger:SpatialReactionConsumptionLoggerConfig",this.$SpatialReactionConsumptionTypedLogger1,c("Banzai").BASIC)};h.prototype.logVital=function(){c("GeneratedLoggerUtils").log("logger:SpatialReactionConsumptionLoggerConfig",this.$SpatialReactionConsumptionTypedLogger1,c("Banzai").VITAL)};h.prototype.clear=function(){this.$SpatialReactionConsumptionTypedLogger1={};return this};h.prototype.updateData=function(j){this.$SpatialReactionConsumptionTypedLogger1=babelHelpers["extends"]({},this.$SpatialReactionConsumptionTypedLogger1,j);return this};h.prototype.setCenterPitch=function(j){this.$SpatialReactionConsumptionTypedLogger1.center_pitch=j;return this};h.prototype.setCenterYaw=function(j){this.$SpatialReactionConsumptionTypedLogger1.center_yaw=j;return this};h.prototype.setDisplayState=function(j){this.$SpatialReactionConsumptionTypedLogger1.display_state=j;return this};h.prototype.setEvent=function(j){this.$SpatialReactionConsumptionTypedLogger1.event=j;return this};h.prototype.setFriendCount=function(j){this.$SpatialReactionConsumptionTypedLogger1.friend_count=j;return this};h.prototype.setHasNonFriend=function(j){this.$SpatialReactionConsumptionTypedLogger1.has_non_friend=j;return this};h.prototype.setMoveTowardsHint=function(j){this.$SpatialReactionConsumptionTypedLogger1.move_towards_hint=j;return this};h.prototype.setPitch=function(j){this.$SpatialReactionConsumptionTypedLogger1.pitch=j;return this};h.prototype.setReactionKey=function(j){this.$SpatialReactionConsumptionTypedLogger1.reaction_key=j;return this};h.prototype.setVideoTimestamp=function(j){this.$SpatialReactionConsumptionTypedLogger1.video_timestamp=j;return this};h.prototype.setYaw=function(j){this.$SpatialReactionConsumptionTypedLogger1.yaw=j;return this};var i={center_pitch:true,center_yaw:true,display_state:true,event:true,friend_count:true,has_non_friend:true,move_towards_hint:true,pitch:true,reaction_key:true,video_timestamp:true,yaw:true};f.exports=h}),null);
__d("DOMClone",[],(function a(b,c,d,e,f,g){__p&&__p();var h={shallowClone:function j(k){return i(k,false)},deepClone:function j(k){return i(k,true)}};function i(j,k){var l=j.cloneNode(k);if(typeof l.__FB_TOKEN!=="undefined")delete l.__FB_TOKEN;if(typeof l.__FB_STORE!=="undefined")delete l.__FB_STORE;return l}f.exports=h}),null);
__d("VideoChannel",[],(function a(b,c,d,e,f,g){var h=null,i={get:function j(){return h},set:function j(k){h=k}};f.exports=i}),null);
__d("SpatialReactionExperimentsStore",["SphericalVideoComponentConstants","SphericalVideoComponentDispatcher","FluxMapStore","immutable","idx"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j,k;h=babelHelpers.inherits(l,c("immutable").Record({viewportLimiting:""}));i=h&&h.prototype;function l(){h.apply(this,arguments)}j=babelHelpers.inherits(m,c("FluxMapStore"));k=j&&j.prototype;m.prototype.getInitialState=function(){return c("immutable").Map({})};m.prototype.reduce=function(n,o){var p=o.id;switch(o.type){case c("SphericalVideoComponentConstants").ACTIONS.REGISTER_EXPERIMENT_CONFIG:var q=o.config;n=n.set(p,new l(babelHelpers["extends"]({},q)));break;default:break}return n};m.prototype.shouldDisableReactions=function(n){var o,p=this.getState().get(n);return((o=p)!=null?o.viewportLimiting:o)==="none"};m.prototype.shouldDisableInitialViewportReactions=function(n){var o,p=this.getState().get(n);return((o=p)!=null?o.viewportLimiting:o)==="no_initial_viewport"};m.prototype.shouldOnlyShowHints=function(n){var o,p=this.getState().get(n);return((o=p)!=null?o.viewportLimiting:o)==="hint_only"};function m(){j.apply(this,arguments)}f.exports=new m(c("SphericalVideoComponentDispatcher"))}),null);
__d("FunnelAction",[],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h="name",i="payload",j="relative_time",k="tag";function l(m,n,o,p){this.$FunnelAction1={};this.$FunnelAction1[h]=m;this.$FunnelAction1[j]=n;if(o!==undefined)this.$FunnelAction1[k]=o;if(p!==undefined)this.$FunnelAction1[i]=JSON.stringify(p)}l.prototype.getData=function(){return this.$FunnelAction1};f.exports=l}),null);
__d("Funnel",["invariant","BinarySearch","FunnelAction","FunnelRegistry","sprintf"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i="name",j="instance_id",k="start_time",l="tags",m="actions",n="sampling_rate",o="timeout_sec",p={EXPLICIT:"explicit",TIMEOUT:"timeout",SESSION_END:"session_end",RESTART:"restart",ACTIONS_FULL:"actions_full"},q={ACTION_END:"funnel_end",ACTION_WINDOW_BLUR:"window_blur",ACTION_WINDOW_FOCUS:"window_focus"},r=600;function s(t,u,v,w,x){__p&&__p();c("FunnelRegistry")[t]===true||h(0);this.$Funnel1=t;this.$Funnel2=u;this.$Funnel3=[];this.$Funnel4={};this.$Funnel5=v;this.$Funnel6=x;this.timeout_sec=r;this.shouldTrackFocus=false;this.$Funnel7=w;this.devModeLogger("Started funnel")}s.prototype.addTag=function(t){typeof t==="string"||h(0);this.$Funnel4[t]=true;this.devModeLogger("Added funnel tag %s",t);return this};s.prototype.appendAction=function(t,u,v){__p&&__p();var w=arguments.length<=3||arguments[3]===undefined?Date.now():arguments[3],x=new(c("FunnelAction"))(t,w-this.$Funnel6,u,v),y=c("BinarySearch").leastStrictUpperBound(function(z){return this.$Funnel3[z].getData()}.bind(this),x.getData(),0,this.$Funnel3.length,function(z,A){if(z.name==="funnel_end")return 1;if(A.name==="funnel_end")return-1;return z.relative_time-A.relative_time});this.$Funnel3.splice(y,0,x);if(u)this.devModeLogger("Appended action %s with tag %s",t,u);else this.devModeLogger("Appended action %s",t);this.$Funnel8=t;return this};s.prototype.appendActionIfNew=function(t,u,v){if(t!==this.$Funnel8)this.appendAction(t,u,v);return this};s.prototype.getLogData=function(){__p&&__p();var t={};t[i]=this.$Funnel1;if(this.$Funnel2!==undefined)t[j]=this.$Funnel2;else t[j]=Math.floor(Math.random()*65536);t[k]=this.$Funnel6;t[n]=this.$Funnel5;t[o]=this.timeout_sec;t[l]=[];for(var u in this.$Funnel4)if(this.$Funnel4[u]===true)t[l].push(u);if(this.$Funnel3.length>0){t[m]=[];for(var v=0;v<this.$Funnel3.length;v++)t[m].push(this.$Funnel3[v].getData())}return t};s.prototype.devModeLogger=function(){};s.prototype.getTags=function(){return this.$Funnel4};f.exports={Funnel:s,EndType:p,ActionType:q}}),null);
__d("FunnelLoggerSampler",["FunnelLoggerConfig"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(j){var k=i(j);if(k===0)return false;return Math.random()*k<1}function i(j){var k=c("FunnelLoggerConfig").freq[j];if(k===undefined)k=c("FunnelLoggerConfig").freq["default"];return k}f.exports={shouldLog:h,getSamplingRate:i}}),null);
__d("FunnelLogger",["invariant","Banzai","Funnel","FunnelLoggerSampler","FunnelRegistry","MarauderLogger"],(function a(aa,b,ba,ca,c,da,d){"use strict";__p&&__p();var e={},f=false,g=true;function h(U,V){D(U,V)}function i(U,V,W){D(U,W,V)}function j(U,V){var W=F(U,V);if(!G(W))return null;return e[W]}function k(U,V){}function l(U,V,W){if(W===undefined)H(U,undefined,V);else if(W)H(U,V,W)}function m(U,V){var W=F(U,V);if(G(W)){e[W].devModeLogger("Cancelled funnel");J(W);e[W]=undefined}}function n(U,V){E(U,V)}function o(U,V,W){E(U,W,V)}function p(U,V,W){if(W===undefined)K(U,undefined,String(V));else K(U,Number(V),W)}function q(U,V,W){if(W===undefined)L(U,undefined,Boolean(V));else L(U,Number(V),W)}function r(U,V,W){if(W===undefined)M(U,undefined,String(V),undefined);else M(U,Number(V),W,undefined)}function s(U,V,W){if(W===undefined)N(U,undefined,String(V),undefined);else N(U,Number(V),W,undefined)}function t(U,V,W,X){if(X===undefined)M(U,undefined,String(W),undefined,undefined,V);else M(U,Number(W),X,undefined,undefined,V)}function u(U,V,W,X){if(X===undefined)M(U,undefined,String(V),W);else M(U,Number(V),W,X)}function v(U,V,W,X,Y){if(Y===undefined)M(U,undefined,String(W),X,undefined,V);else M(U,Number(W),X,Y,undefined,V)}function w(U,V,W,X){if(X===undefined)N(U,undefined,String(V),W);else N(U,Number(V),W,X)}function x(U,V,W,X){if(X===undefined)M(U,undefined,String(V),undefined,W);else M(U,Number(V),String(W),undefined,X)}function y(U,V,W,X,Y){if(Y===undefined)M(U,undefined,String(W),undefined,X,V);else M(U,Number(W),String(X),undefined,Y,V)}function z(U,V,W,X){if(X===undefined)N(U,undefined,String(V),undefined,W);else N(U,Number(V),String(W),undefined,X)}function A(U,V,W,X,Y){if(Y===undefined)M(U,undefined,String(V),W,X);else M(U,Number(V),String(W),String(X),Y)}function B(U,V,W,X,Y,Z){if(Z===undefined)M(U,undefined,String(W),X,Y,V);else M(U,Number(W),String(X),String(Y),Z,V)}function C(U,V,W,X,Y){if(Y===undefined)N(U,undefined,String(V),W,X);else N(U,Number(V),String(W),String(X),Y)}function D(U,V,W){var X=F(U,V);T();O(X);if(b("FunnelLoggerSampler").shouldLog(U)){e[X]=new(b("Funnel").Funnel)(U,V,b("FunnelLoggerSampler").getSamplingRate(U),false,W!=null?W:Date.now());I(X)}}function E(U,V,W){var X=F(U,V);if(G(X)){e[X].appendAction(b("Funnel").ActionType.ACTION_END,b("Funnel").EndType.EXPLICIT,undefined,W);P(X)}}function F(U,V){b("FunnelRegistry")[U]===true||d(0);if(V===undefined||V===null)return U;else return U+V.toString()}function G(U){return e[U]!==undefined}function H(U,V,W){var X=F(U,V);if(G(X)){e[X].timeout_sec=W;e[X].devModeLogger("Timeout set to %s sec",W);I(X)}}function I(U){J(U);e[U].timeout_handle=setTimeout(function(){e[U].appendAction(b("Funnel").ActionType.ACTION_END,b("Funnel").EndType.TIMEOUT);P(U)},1e3*e[U].timeout_sec)}function J(U){if(e[U].timeout_handle)clearTimeout(e[U].timeout_handle)}function K(U,V,W){var X=F(U,V);if(G(X)){e[X].addTag(W);I(X)}}function L(U,V,W){var X=F(U,V);if(G(X)){e[X].shouldTrackFocus=W;e[X].devModeLogger("Focus tracking %s",W?"on":"off")}}function M(U,V,W,X,Y,Z){var $=F(U,V);if(G($)){e[$].appendAction(W,X,Y,Z);I($)}}function N(U,V,W,X,Y){var Z=F(U,V);if(G(Z))e[Z].appendActionIfNew(W,X,Y)}function O(U){if(G(U)){e[U].appendAction(b("Funnel").ActionType.ACTION_END,b("Funnel").EndType.RESTART);P(U)}}function P(U){if(G(U)){var V=e[U].getLogData();b("MarauderLogger").log("funnel_analytics",null,V);e[U].devModeLogger("Logged: %s",JSON.stringify(V));J(U);e[U]=undefined}}function Q(){for(var U in e)if(Object.prototype.hasOwnProperty.call(e,U)&&G(U)){e[U].appendAction(b("Funnel").ActionType.ACTION_END,b("Funnel").EndType.SESSION_END);P(U)}}function R(){if(g){g=false;for(var U in e)if(Object.prototype.hasOwnProperty.call(e,U)&&G(U)&&e[U].shouldTrackFocus){e[U].appendAction(b("Funnel").ActionType.ACTION_WINDOW_BLUR);J(U)}}}function S(){if(!g){g=true;for(var U in e)if(Object.prototype.hasOwnProperty.call(e,U)&&G(U)&&e[U].shouldTrackFocus){e[U].appendAction(b("Funnel").ActionType.ACTION_WINDOW_FOCUS);J(U)}}}function T(){if(!f){f=true;if(window.addEventListener){b("Banzai").subscribe(b("Banzai").SHUTDOWN,Q);window.addEventListener("blur",R);window.addEventListener("focus",S)}}}c.exports={startFunnel:h,startFunnelAtTime:i,startFunnel_DEV_MODE:k,setFunnelTimeout:l,setFunnelTrackFocus:q,addFunnelTag:p,appendAction:r,appendActionAtTime:t,appendActionIfNew:s,appendActionWithTag:u,appendActionAtTimeWithTag:v,appendActionWithTagIfNew:w,appendActionWithPayload:x,appendActionAtTimeWithPayload:y,appendActionWithPayloadIfNew:z,appendActionWithTagAndPayload:A,appendActionAtTimeWithTagAndPayload:B,appendActionWithTagAndPayloadIfNew:C,cancelFunnel:m,endFunnel:n,endFunnelAtTime:o,getFunnelInstance:j}}),null);
__d("SpatialReactionLoggingConstants",[],(function a(b,c,d,e,f,g){"use strict";var h={FUNNEL_ACTIONS:{CLICK_LIKE:"click_like",OPEN_REACTION_MENU:"open_reaction_menu",CLICK_REACTION:"click_reaction",CLOSE_REACTION_MENU:"close_reaction_menu",PICK_UP_REACTION:"pick_up_reaction",RELEASE_REACTION_ON_VIDEO:"relase_reactions_on_video",RELEASE_REACTION_SOMEWHERE_ELSE:"release_reaction_somewhere_else"},FUNNEL_NAME:"WWW_SPATIAL_REACTION_PRODUCTION_FUNNEL",PLAY_TAG:"video_is_playing",PAUSE_TAG:"video_is_paused",CONSUMPTION_DISPLAY_STATES:{DISPLAY:0,HINT:1,OUT_OF_VIEWPORT:2,DISABLED:3}};f.exports=h}),null);
__d("FeedbackReactionType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({NONE:0,LIKE:1,LOVE:2,WOW:3,HAHA:4,YAY:5,OUCH:6,SORRY:7,ANGER:8,JACKO:9,CONFUSED:10,DOROTHY:11,TOTO:12,SELFIE:13,FLAME:14,PLANE:15})}),null);
__d("SpatialReaction",["FeedbackReactionType","immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("immutable").Record({animationRandomSeed:0,isFriend:false,profilePictureURI:null,reactionType:c("FeedbackReactionType").LIKE,positionIndex:-1});h=babelHelpers.inherits(k,j);i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("CubicBezier",[],(function a(b,c,d,e,f,g){__p&&__p();var h=.005;function i(j,k){"use strict";this.cx=3*j[0];this.bx=3*(k[0]-j[0])-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*j[1];this.by=3*(k[1]-j[1])-this.cy;this.ay=1-this.cy-this.by}i.prototype.sampleCurveX=function(j){"use strict";return((this.ax*j+this.bx)*j+this.cx)*j};i.prototype.solve=function(j){"use strict";j=this.solveCurveX(j);return((this.ay*j+this.by)*j+this.cy)*j};i.prototype.solveCurveX=function(j){"use strict";__p&&__p();var k,l,m,n,o,p;for(o=j,l=0;l<8;l++){p=this.sampleCurveX(o)-j;if(Math.abs(p)<h)return o;k=(3*this.ax*o+2*this.bx)*o+this.cx;if(Math.abs(k)<1e-6)break;o-=p/k}m=0;n=1;o=j;if(o<m)return m;if(o>n)return n;while(m<n){p=this.sampleCurveX(o);if(Math.abs(p-j)<h)return o;if(j>p)m=o;else n=o;o=(n-m)/2+m}return o};f.exports=i}),null);
__d("SpatialReactionAnimationConfig",["CubicBezier"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=60,i=function i(o,p,q,r){return{solve:function s(t,u,v,w){var x=new(c("CubicBezier"))([o,p],[q,r]);return v*x.solve(t/w)+u}}},j={solve:function o(p,q,r,s){return p/s*r+q}},k=function k(o){return{solve:function p(q,r,s,t,u){if(q<u)return r;else return o.solve(q-u,r,s,t-u)}}},l=function l(o){return{solve:function p(q,r,s,t,u){if(q<t-u)return o.solve(q,r,s,t-u);else return r+s}}},m=function m(o){return{solve:function p(q,r,s,t,u,v){if(u+v>t)throw new Error("Delay exceeds total steps");if(q<u)return r;else if(q>=t-v)return r+s;else return o.solve(q-u,r,s,t-u-v)}}},n={CLICK:{NUM_POSITIONS:2,LEFT_RIGHT_MARGIN:{PERCENT:.1}},CURVES:{MOVE_TO_CENTER_SCALE:i(.25,0,.58,1.02),MOVE_TO_CENTER_PATH_X:i(.3,.3,.5,1),MOVE_TO_CENTER_PATH_Y:i(0,.75,.9,.8),LOOK_AT_CENTER_PATH_X:l(i(.2,.2,.3,1)),LOOK_AT_CENTER_PATH_Y:l(i(.2,.2,.6,1)),LOOK_AT_CENTER_SCALE_SELF:m(i(0,.7,.6,1)),LOOK_AT_CENTER_SCALE_NON_SELF:m(i(.9,0,.25,1)),LOOK_AT_CENTER_FACE_POSITION:j,LOOK_AT_CENTER_FACE_SCALE_X:j,FACE_FLIP:m(j),MOVE_BACK_TOWARD_CENTER_PATH_X:i(.4,0,0,.8),MOVE_BACK_TOWARD_CENTER_PATH_Y:i(.4,.6,0,1),MOVE_BACK_TOWARD_CENTER_SCALE:m(i(.9,0,.25,1)),MOVE_BACK_TOWARD_CENTER_FACE_SCALE_X:m(j)},DRAG:{THROTTLE_INTERVAL:{MS:200},THRESHOLD:{MS:200},FRICTION_COEFFICIENT:.15,ORIGINAL_SCALE_VALUE:"scale(0.8)",VELOCITY:{MAX:600},FACE:{OFFSET:{LOVE:{PX:15}},SCALE:{MIN:.85}}},DURATIONS:{SELF:{TOTAL:{SECONDS:2.15,FRAMES:2.15*h},MOVE_TO_CENTER:{SECONDS:.35,FRAMES:.35*h},LOOK_AT_CENTER:{SECONDS:.7,FRAMES:.7*h,MAX_RANDOM_DELAY_FRAMES:0*h,MIN_RANDOM_SCALE_DELAY_FRAMES:0*h,MAX_RANDOM_SCALE_DELAY_FRAMES:0*h},MOVE_BACK_TOWARD_CENTER:{SECONDS:1.1,FRAMES:1.1*h,MAX_RANDOM_SCALE_DELAY_FRAMES:.95*h},SCALE_DOWN:{SECONDS:.15,FRAMES:.15*h},SCALE_UP:{SECONDS:.15,FRAMES:.15*h},FACE_FLIP:{SECONDS:.15,FRAMES:.15*h},FACE_HANG:{SECONDS:.2,FRAMES:.2*h}},NON_SELF:{TOTAL:{SECONDS:2,FRAMES:2*h},MOVE_TO_CENTER:{SECONDS:0,FRAMES:0*h},LOOK_AT_CENTER:{SECONDS:1.5,FRAMES:1.5*h,MAX_RANDOM_DELAY_FRAMES:.8*h,MIN_RANDOM_SCALE_DELAY_FRAMES:.3*h,MAX_RANDOM_SCALE_DELAY_FRAMES:1.35*h},MOVE_BACK_TOWARD_CENTER:{SECONDS:.5,FRAMES:.5*h,MAX_RANDOM_SCALE_DELAY_FRAMES:.35*h},SCALE_DOWN:{SECONDS:.15,FRAMES:.15*h},SCALE_UP:{SECONDS:.15,FRAMES:.15*h},FACE_FLIP:{SECONDS:.15,FRAMES:.15*h},FACE_HANG:{SECONDS:.2,FRAMES:.2*h}}},SHADOW:{COLOR:"rgba(0, 0, 0, 0.4)",BLUR:70,OFFSET_X:6,OFFSET_Y:6},SIZES:{BASE:{PX:38},PROFILE:{PX:34},FACE:{PX:38}},OPACITY:{MAX:1,MIN:0},SCALES:{COIN_FLIP_MORPH_START:.7,MOVE_TO_CENTER:{MIN:.6,MAX:1},LOOK_AT_CENTER:{MIN:.6,MID:.8,MAX:1,SELF_MIN:0},LOOK_AT_CENTER_FACE_X:{MAX:1,MIN:.8},MOVE_BACK_TOWARD_CENTER:{MAX:1,MIN:0}},DISTANCES:{LOOK_AT_CENTER:{SELF:{X:{PX:125},Y:{PX:100}},NON_SELF:{X:{PX:185},Y:{PX:100}},RANDOM_OFFSET_X:{MIN:{PX:-10},MAX:{PX:40}}},MOVE_BACK_TOWARD_CENTER:{X:{PX:40},Y:{PX:30}},MAX_FACE_OFFSET:{PX:6},FACE_FLIP_OUT_OFFSET:{PX:30},MAX_PROFILE_PICTURE_OFFSET:{PX:38}}};f.exports=n}),null);
__d("SpatialReactionClusterBase",["immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("immutable").Record({animationDurationFrames:-1,animationPitch:null,animationProgressFrames:-1,animationYaw:null,anonymousReactions:c("immutable").Set(),friendReactions:c("immutable").Set(),isHint:false,isSelfReaction:false,originalPitch:0,originalYaw:0,timestamp:-1});h=babelHelpers.inherits(k,j);i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("SpatialReactionCluster",["SpatialReactionClusterBase"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i;h=babelHelpers.inherits(j,c("SpatialReactionClusterBase"));i=h&&h.prototype;j.prototype.hasStartedAnimating=function(){return this.animationProgressFrames>=0};j.prototype.startAnimation=function(k,l){var m=arguments.length<=2||arguments[2]===undefined?false:arguments[2];return this.set("animationProgressFrames",0).set("isHint",m).set("animationYaw",k).set("animationPitch",l)};j.prototype.stopAnimation=function(){return this.set("animationProgressFrames",-1).set("isHint",false)};j.prototype.tickAnimation=function(){var k=this.animationProgressFrames;return this.set("animationProgressFrames",k+1)};j.prototype.isAnimationFinished=function(){return this.animationProgressFrames>=this.animationDurationFrames};function j(){h.apply(this,arguments)}f.exports=j}),null);
__d("denormalizeYaw",[],(function a(b,c,d,e,f,g){function h(i){var j=arguments.length<=1||arguments[1]===undefined?false:arguments[1],k=j?Math.PI:180,l=k*2;return i<=0?i+l:i}f.exports=h}),null);
__d("SpatialReactionsUtils",["csx","invariant","Alea","SpatialReactionAnimationConfig","DOM","DOMClone","DOMQuery","immutable","Rect","SpatialReaction","Scroll","Style","Vector","SpatialReactionCluster","VideoChannel","denormalizeYaw","getElementPosition"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j={processServerReactionsPayloads:function k(l){__p&&__p();var m=c("immutable").Set();for(var n=l,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var q;if(o){if(p>=n.length)break;q=n[p++]}else{p=n.next();if(p.done)break;q=p.value}var r=q;m=m.add(j.createSpatialReactionClusterFromData(r))}return m},createSpatialReactionClusterFromData:function k(l){var m=l.yaw,n=l.pitch,o=l.timestamp;m=c("denormalizeYaw")(m);var p=0,q=c("SpatialReactionAnimationConfig").DURATIONS.NON_SELF.TOTAL.FRAMES,r=new(c("Alea"))(m+n+o+""),s=l.friend_reactions.reduce(function(u,v){return u.add(new(c("SpatialReaction"))({animationRandomSeed:r(),reactionType:v.reaction_type,profilePictureURI:v.profile_picture_uri,isFriend:true,positionIndex:p++}))},c("immutable").Set()),t=l.popular_reactions.reduce(function(u,v){return u.add(new(c("SpatialReaction"))({animationRandomSeed:r(),reactionType:v.reaction_type,positionIndex:p++}))},c("immutable").Set());return new(c("SpatialReactionCluster"))({animationDurationFrames:q,anonymousReactions:t,friendReactions:s,originalPitch:n,originalYaw:m,timestamp:o})},getFriendReaction:function k(l){var m=null,n=l.feedback_add_streaming_reaction_subscribe;if(n.reactor.is_viewer_friend)m={profilePictureURI:n.reactor.profile_picture.uri,reactionType:n.reaction_info.reaction_type,reactionRegionId:this._getMostRecentlyActiveRegionId(n.regional_spatial_reaction_counts)};return m},_getMostRecentlyActiveRegionId:function k(l){l.length>0||i(0);var m=l[0];return m.region_id},fetchNewLiveReactions:function k(l,m,n,o){__p&&__p();if(n.length===0)return null;var p=j.getMostActiveRegion(n,m);if(!p)return null;var q=0,r=c("immutable").Set(),s={},t=null,u=Math.ceil(l);if(o){s=j.getPitchAndYawFromRegionId(o.reactionRegionId);t=new(c("Alea"))(s.pitch+s.yaw+u);r=r.add(new(c("SpatialReaction"))({animationRandomSeed:t(),reactionType:o.reactionType,profilePictureURI:o.profilePictureURI,isFriend:true,positionIndex:q++}))}else s=j.getPitchAndYawFromRegionId(p.region_id);var v=c("SpatialReactionAnimationConfig").DURATIONS.NON_SELF.TOTAL.FRAMES,w=s,x=w.pitch,y=w.yaw;if(!t)t=new(c("Alea"))(y+x+u);if(p){var z=j.getAnonymousReactions(p,m,q,t);return c("immutable").Set().add(new(c("SpatialReactionCluster"))({animationDurationFrames:v,anonymousReactions:z,friendReactions:r,originalPitch:x,originalYaw:y,timestamp:u}))}return null},updateReactionRegionMap:function k(l,m){return l.reduce(function(n,o){var p=o.region_id,q=o.region_reaction_counts.reduce(function(r,s){return r.set(s.reaction_type,s.count)},c("immutable").Map());return n.set(p,q)},c("immutable").Map())},getAnonymousReactions:function k(l,m,n,o){__p&&__p();var p=m.get(l.region_id),q=l.region_reaction_counts,r=c("immutable").Set(),s=c("immutable").Map();if(p&&!p.isEmpty())for(var t=q,u=Array.isArray(t),v=0,t=u?t:t[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var w;if(u){if(v>=t.length)break;w=t[v++]}else{v=t.next();if(v.done)break;w=v.value}var x=w,y=p.get(x.reaction_type),z=x.count-y;if(z>0)s=s.set(x.reaction_type,z)}else s=q.reduce(function(C,x){if(x.count>0)return C.set(x.reaction_type,x.count);else return C},c("immutable").Map());var A=s.sort().toMap(),B=A.slice(0,q.length-n);r=B.reduce(function(C,D,E){return C.add(new(c("SpatialReaction"))({animationRandomSeed:o(),reactionType:E,positionIndex:n++}))},c("immutable").Set());return r},getPitchAndYawFromRegionId:function k(l){var m=10,n=l%(360/m),o=l-n,p=n*m;p-=180;p=p===0?p:c("denormalizeYaw")(p);var q=o/(360/m);q*=m;q-=90;p+=m/2;q+=m/2;return{yaw:p,pitch:q}},getMostActiveRegion:function k(l,m){__p&&__p();var n=null,o=0;for(var p=l,q=Array.isArray(p),r=0,p=q?p:p[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var s;if(q){if(r>=p.length)break;s=p[r++]}else{r=p.next();if(r.done)break;s=r.value}var t=s,u=t.region_id,v=0,w=t.region_reaction_counts,x=w.reduce(function(A,B){return A+B.count},0),y=m.get(u);if(y){var z=y.reduce(function(A,B){return A+B},0);v=x-z}else v=x;if(v>o){o=v;n=t}}return n},getChannelViewViewportRect:function k(){if(c("VideoChannel").get())return new(c("Rect"))(c("DOMQuery").find(c("VideoChannel").get().getDialogContent(),"._1kfk"));else throw new Error("Not currently in channel view")},isVectorWithinViewport:function k(l,m,n){return!(l.x>m||l.x<0||l.y>n||l.y<0)},getRootElement:function k(){return c("DOM").find(document.body,"._li")},getReactionCenterVector:function k(l){var m=c("SpatialReactionAnimationConfig").SIZES.BASE.PX/2,n=c("getElementPosition")(l);return new(c("Vector"))(n.x+m+c("Scroll").getLeft(document.body),n.y+m+c("Scroll").getTop(document.body),"document")},insertOnTop:function k(l,m){var n=arguments.length<=2||arguments[2]===undefined?0:arguments[2],o=j.getRootElement(),p=l.getBoundingClientRect(),q=c("Scroll").getTop(document.body),r=p.top-p.width+q,s=p.left;c("DOM").insertAfter(o,m);c("Style").set(m,"position","absolute");c("Style").set(m,"left",s+"px");c("Style").set(m,"top",r-n+"px");c("Style").set(m,"z-index","1000")},cloneNode:function k(l){return c("DOMClone").deepClone(l)},hashId:function k(l){var m=0;if(l.length===0)return m;for(var n=0;n<l.length;n++){var o=l.charCodeAt(n);m=(m<<5)-m+o;m&=m}return m}};f.exports=j}),null);
__d("SpatialReactionFunnelLoggingStore",["SphericalVideoComponentConstants","SpatialReactionLoggingConstants","SphericalVideoComponentDispatcher","FluxReduceStore","FunnelLogger","VideoPlayerControllerStore","curry","SpatialReactionsUtils"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("SphericalVideoComponentConstants").ACTIONS,k=c("SpatialReactionsUtils").hashId;h=babelHelpers.inherits(l,c("FluxReduceStore"));i=h&&h.prototype;l.prototype.getInitialState=function(){return{}};l.prototype.reduce=function(m,n){__p&&__p();var o=n.id,p=c("curry")(this.$SpatialReactionFunnelLoggingStore1,o);switch(n.type){case j.CLICK_LIKE_BUTTON:this.$SpatialReactionFunnelLoggingStore2(o);p(c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.CLICK_LIKE);this.$SpatialReactionFunnelLoggingStore3(o);break;case j.OPEN_REACTION_MENU:this.$SpatialReactionFunnelLoggingStore2(o);p(c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.OPEN_REACTION_MENU);break;case j.CLOSE_REACTION_MENU:p(c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.CLOSE_REACTION_MENU);this.$SpatialReactionFunnelLoggingStore3(o);break;case j.CLICK_REACTION:p(c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.CLICK_REACTION);this.$SpatialReactionFunnelLoggingStore3(o);break;case j.SET_MOUSE_DOWN:p(c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.PICK_UP_REACTION);break;case j.DROP_REACTION:if(n.recordMouseLocation){p(n.reactionOutsideViewport?c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.RELEASE_REACTION_SOMEWHERE_ELSE:c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.RELEASE_REACTION_ON_VIDEO);this.$SpatialReactionFunnelLoggingStore3(o)}break;default:break}return m};l.prototype.$SpatialReactionFunnelLoggingStore2=function(m){var n=k(m),o=c("VideoPlayerControllerStore").getIsPlaying(m),p=o?c("SpatialReactionLoggingConstants").PLAY_TAG:c("SpatialReactionLoggingConstants").PAUSE_TAG;c("FunnelLogger").startFunnel(c("SpatialReactionLoggingConstants").FUNNEL_NAME,n);c("FunnelLogger").addFunnelTag(c("SpatialReactionLoggingConstants").FUNNEL_NAME,n,p)};l.prototype.$SpatialReactionFunnelLoggingStore3=function(m){var n=k(m);c("FunnelLogger").endFunnel(c("SpatialReactionLoggingConstants").FUNNEL_NAME,n)};l.prototype.$SpatialReactionFunnelLoggingStore1=function(m,n){var o=k(m);c("FunnelLogger").appendAction(c("SpatialReactionLoggingConstants").FUNNEL_NAME,o,n)};function l(){h.apply(this,arguments)}f.exports=new l(c("SphericalVideoComponentDispatcher"))}),null);
__d("SpatialReactionConsumptionLoggingEvents",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({SPATIAL_REACTION_DISPLAY:"spatial_reaction_display"})}),null);
__d("SpatialReactionDisplayStates",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({DISPLAY:0,HINT:1,OUT_OF_VIEWPORT:2,DISABLED:3})}),null);
__d("SphericalProjectionUtils",["invariant","degToRad","gl-matrix","radToDeg"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("gl-matrix").vec3,j=c("gl-matrix").mat4,k=Math.acos,l=Math.sin,m=Math.cos,n=15,o=.2,p={convert3dTo2dNormalized:function q(r,s,t,u,v,w,x){__p&&__p();var y=c("degToRad")(r),z=c("degToRad")(s),A=c("degToRad")(t),B=c("degToRad")(u),C=c("degToRad")(v),D=j.create();j.perspective(D,C,w/x,.1,100);var E=j.create();j.rotateX(E,E,z);j.rotateY(E,E,y);j.invert(E,E);var F=j.create();j.rotateX(F,F,B);j.rotateY(F,F,A);j.multiply(F,F,E);j.multiply(F,D,F);var G=i.fromValues(0,0,-1);i.transformMat4(G,G,F);var H=.5+G[0]/2,I=.5+G[1]/2;return{x:H,y:I,isNegativeTwin:G[2]>1}},convert3dTo2dScaled:function q(r,s,t,u,v,w,x){var y=p.convert3dTo2dNormalized.apply(p,arguments),z=y.x,A=y.y,B=y.isNegativeTwin;return{x:z*w,y:A*x,isNegativeTwin:B}},convert3dTo2dScaledUnique:function q(r,s,t,u,v,w,x){var y=p.convert3dTo2dNormalized.apply(p,arguments),z=y.x,A=y.y,B=y.isNegativeTwin;if(B)z=A=-1;else{z*=w;A*=x}return{x:z,y:A}},convert3dTo2dOnScreen:function q(r,s,t,u,v,w,x){var y=p.convert3dTo2dScaled.apply(p,arguments),z=y.x,A=y.y,B=y.isNegativeTwin;if(B){z=-z;A=s>0?-x:x}z=Math.max(0,Math.min(w,z));A=Math.max(0,Math.min(x,A));return{x:z,y:A}},convert2dTo3dNormalized:function q(r,s,t,u,v,w,x){__p&&__p();r<=1&&r>=-1||h(0);s<=1&&s>=-1||h(0);var y=c("degToRad")(t),z=c("degToRad")(u),A=c("degToRad")(v),B=j.create();j.perspective(B,A,w/x,.1,100);var C=-r/B[0],D=-s/B[5],E=y,F=z,G=Math.atan(Math.tan(A/2)*B[5]/B[0]),H=E+(C<0?G:-G),I=F+(D>0?A/2:-A/2),J=void 0,K=void 0,L=void 0,M=void 0,N=void 0;M=N=J=0;while(J<n&&!(Math.abs(c("radToDeg")(H-E))<o&&Math.abs(c("radToDeg")(I-F))<o)){J++;K=(E+H)/2;L=(F+I)/2;var O=p._getRelativePositionWithoutProjection(y,z,K,L),P=O.x,Q=O.y;if((D-N)*(D-Q)<=0)I=L;else{F=L;N=Q}if((C-M)*(C-P)<=0)H=K;else{E=K;M=P}}var R=void 0,S=void 0;if(J<n){R=Math.ceil(c("radToDeg")(E));S=Math.ceil(c("radToDeg")(F))}else{R=t;S=u}return{yaw:R,pitch:S}},convert2dTo3dScaled:function q(r,s,t,u,v,w,x){var y=w/2,z=x/2;return p.convert2dTo3dNormalized((r-y)*(2/w),(s-z)*(2/x),t,u,v,w,x)},_getRelativePositionWithoutProjection:function q(r,s,t,u){var v=(s-u)/2,w=(s+u)/2,x=Math.cos((r-t)/2),y=Math.sin((r-t)/2),z=Math.cos(v)*x,A=Math.sin(v)*x,B=Math.cos(w)*y,C=Math.sin(w)*y,D=2*A*C+2*z*B,E=2*B*C-2*z*A,F=1-2*A*A-2*B*B;return{x:D/F,y:E/F}},distanceBetweenSphericalCoordinatesDeg:function q(r,s,t,u){return c("radToDeg")(p.distanceBetweenSphericalCoordinatesRad.apply(p,Array.from(arguments).map(c("degToRad"))))},distanceBetweenSphericalCoordinatesRad:function q(r,s,t,u){return k(l(s)*l(u)+m(s)*m(u)*m(r-t))}};f.exports=p}),null);
__d("SpatialReactionAnimationUtils",["Promise","SpatialReactionAnimationConfig","CSS","Style","Vector","FeedbackReactionType","SphericalProjectionUtils","SpatialReactionsUtils","getVendorPrefixedEventName","setInterval"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SpatialReactionAnimationConfig").CURVES,i=h.LOOK_AT_CENTER_FACE_POSITION,j=h.LOOK_AT_CENTER_FACE_SCALE_X,k=h.FACE_FLIP,l=h.MOVE_BACK_TOWARD_CENTER_FACE_SCALE_X,m=c("getVendorPrefixedEventName")("animationend"),n=c("getVendorPrefixedEventName")("transitionend"),o=10,p={canStartClusterAnimation:function q(r,s,t){__p&&__p();var u=s.friendReactions.union(s.anonymousReactions),v=function v(x,y){var z=y.profilePictureURI,A=y.reactionType;if(z){var B=t.hasFriendImage(z);x=x&&B}var C=t.hasReactionBaseImage(A)&&t.hasReactionFaceImage(A);x=x&&C;return x},w=u.reduce(v,true);return p.clusterIsWithinOneSecond(r,s.timestamp)&&!s.hasStartedAnimating()&&w},resetClusterAnimationIfNeeded:function q(r){return r.isAnimationFinished()?p.resetClusterAnimation(r):r},resetClusterAnimation:function q(r){var s=p.convertToNonSelfAnimation;return s(r.stopAnimation())},convertToNonSelfAnimation:function q(r){if(r.isSelfReaction){var s=c("SpatialReactionAnimationConfig").DURATIONS.NON_SELF.TOTAL.FRAMES;r=r.set("isSelfReaction",false);r=r.set("animationDurationFrames",s)}return r},getReactionBaseSize:function q(r){return Math.floor(c("SpatialReactionAnimationConfig").SIZES.BASE.PX*r)},getReactionRadius:function q(r){return Math.floor(c("SpatialReactionAnimationConfig").SIZES.BASE.PX/2*r)},getProfilePictureRadius:function q(r){return Math.floor(c("SpatialReactionAnimationConfig").SIZES.PROFILE.PX/2*r)},getReactionIndexOnLeft:function q(r){return r.positionIndex%2===0},getReactionFaceDimensions:function q(r,s,t){__p&&__p();var u=p.getDurationsForClusterType,v=p.getClusterIsLookingAtCenter,w=p.getLookAtCenterProgressFrames,x=p.getClusterIsMovingBackTowardCenter,y=p.getMoveBackTowardCenterProgressFrames,z=1,A=1,B=c("SpatialReactionAnimationConfig").SIZES.FACE.PX,C=c("SpatialReactionAnimationConfig").SCALES.LOOK_AT_CENTER_FACE_X.MIN,D=c("SpatialReactionAnimationConfig").SCALES.LOOK_AT_CENTER_FACE_X.MAX,E=u(r,c("SpatialReactionAnimationConfig")),F=E.LOOK_AT_CENTER.FRAMES;if(v(r)){var G=w(r);z=j.solve(G,D,-(D-C),F)}else if(x(r)){var H=E.MOVE_BACK_TOWARD_CENTER.FRAMES,I=E.SCALE_DOWN.FRAMES,J=y(r),K=c("SpatialReactionAnimationConfig").SCALES.MOVE_BACK_TOWARD_CENTER.MIN,L=c("SpatialReactionAnimationConfig").SCALES.LOOK_AT_CENTER_FACE_X.MAX,M=E.MOVE_BACK_TOWARD_CENTER.MAX_RANDOM_SCALE_DELAY_FRAMES,N=Math.floor(s.animationRandomSeed*M),O=H-N-I;z=l.solve(J,L,-(L-K),H,N,O)}return new(c("Vector"))(Math.floor(B*t*z),Math.floor(B*t*A))},clusterIsWithinOneSecond:function q(r,s){var t=s-.5,u=s+.5;return r>t&&r<u},getPercentageWithOffset:function q(r,s,t){return(s-r)/(t-r)},getPercentageWithMax:function q(r,s){return Math.min(r,s)/s},getDurationsForClusterType:function q(r,s){return r.isSelfReaction?s.DURATIONS.SELF:s.DURATIONS.NON_SELF},getMoveToCenterProgressFrames:function q(r){if(!r.isSelfReaction)throw new Error("Non self clusters do not move to center");else{var s=c("SpatialReactionAnimationConfig").DURATIONS,t=s.SELF.MOVE_TO_CENTER.FRAMES,u=r.animationProgressFrames;if(u<0||u>=t)throw new Error("Animation progress value not in move to center range: "+u);return u}},getLookAtCenterProgressFrames:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),u=t.LOOK_AT_CENTER.FRAMES,v=t.MOVE_TO_CENTER.FRAMES,w=s-v;if(w<0||w>=u)throw new Error("Animation progress value not in look at center range: "+w);return w},getMoveBackTowardCenterProgressFrames:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),u=t.MOVE_BACK_TOWARD_CENTER.FRAMES,v=t.MOVE_TO_CENTER.FRAMES+t.LOOK_AT_CENTER.FRAMES,w=s-v;if(w<0||w>=u)throw new Error("Animation progress value not in face flip range: "+w);return w},getClusterIsMovingToCenter:function q(r){var s=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),t=s.MOVE_TO_CENTER.FRAMES;return r.isSelfReaction&&r.hasStartedAnimating()&&r.animationProgressFrames<t},getClusterIsLookingAtCenter:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),u=t.MOVE_TO_CENTER.FRAMES,v=u+t.LOOK_AT_CENTER.FRAMES;return s>=u&&s<v},getClusterIsMovingBackTowardCenter:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),u=t.MOVE_TO_CENTER.FRAMES+t.LOOK_AT_CENTER.FRAMES,v=u+t.MOVE_BACK_TOWARD_CENTER.FRAMES;return s>=u&&s<v},getReactionFaceOffset:function q(r,s){var t=p.getClusterIsLookingAtCenter,u=p.getClusterIsMovingBackTowardCenter,v=p.getLookAtCenterProgressFrames,w=p.getReactionIndexOnLeft,x=w(s),y=0,z=c("SpatialReactionAnimationConfig").DISTANCES.MAX_FACE_OFFSET.PX*(x?1:-1);if(t(r)){var A=v(r),B=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),C=B.LOOK_AT_CENTER.FRAMES;return i.solve(A,y,z,C)}else if(u(r))return z;else return y},getReactionFaceFlipOutOffset:function q(r,s){var t=p.getClusterIsLookingAtCenter,u=p.getLookAtCenterProgressFrames,v=p.getReactionIndexOnLeft,w=p.getClusterIsMovingBackTowardCenter,x=v(s),y=0,z=c("SpatialReactionAnimationConfig").DISTANCES.FACE_FLIP_OUT_OFFSET.PX*(x?1:-1);if(t(r)){var A=u(r),B=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),C=B.LOOK_AT_CENTER.FRAMES,D=B.FACE_FLIP.FRAMES,E=B.FACE_HANG.FRAMES,F=C-D-E;return k.solve(A,y,z,C,F,E)}else if(w(r))return z;else return y},getReactionProfilePictureOffset:function q(r,s){var t=p.getLookAtCenterProgressFrames,u=p.getClusterIsLookingAtCenter,v=p.getClusterIsMovingBackTowardCenter,w=p.getReactionIndexOnLeft,x=w(s),y=0,z=c("SpatialReactionAnimationConfig").DISTANCES.MAX_PROFILE_PICTURE_OFFSET.PX*(x?1:-1);if(u(r)){var A=t(r),B=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),C=B.LOOK_AT_CENTER.FRAMES,D=B.FACE_FLIP.FRAMES,E=B.FACE_HANG.FRAMES,F=C-D-E;return k.solve(A,z,-(z-y),C,F,E)}else if(v(r))return y;else return z},addTransitionEndListener:function q(r,s){return new(c("Promise"))(function(t,u){r.addEventListener(n,function(v){if(v.propertyName===s)t()})})},addTransition:function q(r,s,t,u){var v=p.addTransitionEndListener(r,t);c("CSS").addClass(r,s);u();return v},addAnimationEndListener:function q(r,s){return new(c("Promise"))(function(t,u){r.addEventListener(m,function(v){if(v.animationName===s)t()})})},addTemporaryAnimation:function q(r,s,t){return new(c("Promise"))(function(u,v){p.addAnimationEndListener(r,t).then(function(){c("CSS").removeClass(r,s);u()}).done();c("CSS").addClass(r,s)})},moveElementToPosition:function q(r,s){c("Style").set(r,"left",s.x+"px");c("Style").set(r,"top",s.y+"px")},pollForAnimationProgress:function q(r){return new(c("Promise"))(function(s,t){var u=c("setInterval")(function(){if(r()){clearInterval(u);s()}},o)})},getReactionCenterOffset:function q(r){return new(c("Vector"))(r/2,r/2)},getReactionClickPositionRelativeToViewport:function q(r,s,t){__p&&__p();var u=c("SpatialReactionAnimationConfig").SIZES.BASE.PX,v=p.getReactionCenterOffset(u),w=6,x=0;switch(t){case c("FeedbackReactionType").LOVE:x=1;break;case c("FeedbackReactionType").HAHA:x=2;break;case c("FeedbackReactionType").WOW:x=3;break;case c("FeedbackReactionType").SORRY:x=4;break;case c("FeedbackReactionType").ANGER:x=5;break;default:break}var y=s-v.y,z=v.x+u*x+w*x;return new(c("Vector"))(Math.floor(z),Math.floor(y))},isPositionIndexOnLeftSide:function q(r){return r<Math.floor(c("SpatialReactionAnimationConfig").CLICK.NUM_POSITIONS/2)},clusterIsVisibleOnLeft:function q(r,s,t,u,v,w,x){return p.clusterIsVisibleInViewport(r,s-u,t,v,w,x)},clusterIsVisibleOnRight:function q(r,s,t,u,v,w,x){return p.clusterIsVisibleInViewport(r,s+u,t,v,w,x)},clusterIsVisibleInViewport:function q(r,s,t,u,v,w){var x=p.get2dDiscretePointFromCurrentView(r.originalYaw,r.originalPitch,s,t,u,v,w),y=x.x,z=x.y;return c("SpatialReactionsUtils").isVectorWithinViewport({x:y,y:z},v,w)},get2dDiscretePointFromCurrentView:function q(r,s,t,u,v,w,x){var y=c("SphericalProjectionUtils").convert3dTo2dScaledUnique(r,s,t,u,v,w,x),z=y.x,A=y.y;return{x:Math.floor(z),y:Math.floor(A)}}};f.exports=p}),null);
__d("SpatialReactionsImageCache",["Promise","DOM","FeedbackReactionType","immutable","SpatialReactionImagePaths"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=[c("SpatialReactionImagePaths").BASES.LIKE,c("SpatialReactionImagePaths").BASES.LOVE,c("SpatialReactionImagePaths").BASES.WOW,c("SpatialReactionImagePaths").BASES.HAHA,c("SpatialReactionImagePaths").BASES.SORRY,c("SpatialReactionImagePaths").BASES.ANGER,c("SpatialReactionImagePaths").FACES.LIKE,c("SpatialReactionImagePaths").FACES.LOVE,c("SpatialReactionImagePaths").FACES.WOW,c("SpatialReactionImagePaths").FACES.HAHA,c("SpatialReactionImagePaths").FACES.SORRY,c("SpatialReactionImagePaths").FACES.ANGER];function i(){this.$SpatialReactionsImageCache1=c("immutable").Map();this.$SpatialReactionsImageCache2=c("immutable").Map();this.$SpatialReactionsImageCache3=c("immutable").Map()}i.prototype.loadStaticImages=function(j){this.$SpatialReactionsImageCache4=j;var k=h.concat(j).map(this.$SpatialReactionsImageCache5);return new(c("Promise"))(function(l,m){c("Promise").all(k).then(function(n){var o=n[0],p=n[1],q=n[2],r=n[3],s=n[4],t=n[5],u=n[6],v=n[7],w=n[8],x=n[9],y=n[10],z=n[11],A=n[12];this.$SpatialReactionsImageCache1=this.$SpatialReactionsImageCache1.set(c("FeedbackReactionType").LIKE,o).set(c("FeedbackReactionType").LOVE,p).set(c("FeedbackReactionType").WOW,q).set(c("FeedbackReactionType").HAHA,r).set(c("FeedbackReactionType").SORRY,s).set(c("FeedbackReactionType").ANGER,t);this.$SpatialReactionsImageCache2=this.$SpatialReactionsImageCache1.set(c("FeedbackReactionType").LIKE,u).set(c("FeedbackReactionType").LOVE,v).set(c("FeedbackReactionType").WOW,w).set(c("FeedbackReactionType").HAHA,x).set(c("FeedbackReactionType").SORRY,y).set(c("FeedbackReactionType").ANGER,z);this.$SpatialReactionsImageCache3=this.$SpatialReactionsImageCache3.set(j,A);l()}.bind(this),m).done()}.bind(this))};i.prototype.getReactionBaseImage=function(j){return this.$SpatialReactionsImageCache1.get(j)};i.prototype.getReactionFaceImage=function(j){return this.$SpatialReactionsImageCache2.get(j)};i.prototype.hasReactionBaseImage=function(j){return this.$SpatialReactionsImageCache1.has(j)};i.prototype.hasReactionFaceImage=function(j){return this.$SpatialReactionsImageCache2.has(j)};i.prototype.putFriendImage=function(j){return this.$SpatialReactionsImageCache6(j)};i.prototype.getFriendImage=function(j){return this.$SpatialReactionsImageCache3.get(j)};i.prototype.hasFriendImage=function(j){return this.$SpatialReactionsImageCache3.has(j)};i.prototype.getOwnProfilePhotoURI=function(){return this.$SpatialReactionsImageCache4};i.prototype.$SpatialReactionsImageCache6=function(j){return new(c("Promise"))(function(k,l){if(this.hasFriendImage(j))k(null);else this.$SpatialReactionsImageCache5(j).then(function(m){this.$SpatialReactionsImageCache3=this.$SpatialReactionsImageCache3.set(j,m);k(null)}.bind(this)).done()}.bind(this))};i.prototype.$SpatialReactionsImageCache5=function(j){return new(c("Promise"))(function(k,l){var m=c("DOM").create("img");m.onload=function(){return k(m)};m.onerror=l;m.src=j})};f.exports=new i()}),null);
__d("range",[],(function a(b,c,d,e,f,g){function h(i,j,k){var l=k==null||k===0?i<j?1:-1:k,m=-1,n=Math.max(Math.ceil((j-i)/l),0),o=Array(n),p=i;while(n--){o[++m]=p;p+=l}return o}f.exports=h}),null);
__d("SpatialReactionsProductionStore",["SpatialReactionAnimationConfig","SphericalVideoComponentConstants","SphericalVideoComponentDispatcher","FluxReduceStore","SphericalViewportControlStore","immutable","Vector","UFIVideoPlayerRegistry","SpatialReactionsUtils","range"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j,k,l=c("SpatialReactionsUtils").isVectorWithinViewport,m=c("SpatialReactionAnimationConfig").CLICK.NUM_POSITIONS;h=babelHelpers.inherits(n,c("immutable").Record({shouldLeaveReactionMenuOpen:false,isMouseDown:false,isDragging:false,mousePositionRelativeToCanvas:null,nextClickReactionPositionIndex:0,originalDragPosition:null}));i=h&&h.prototype;function n(){h.apply(this,arguments)}j=babelHelpers.inherits(o,c("FluxReduceStore"));k=j&&j.prototype;o.prototype.getVideoPlayerController=function(p){var q=c("UFIVideoPlayerRegistry").getAvailableVideoPlayerController(p);if(!q)return null;return q};o.prototype.getInitialState=function(){return new n()};o.prototype.reduce=function(p,q){__p&&__p();switch(q.type){case c("SphericalVideoComponentConstants").ACTIONS.SET_SHOULD_LEAVE_REACTION_MENU_OPEN:p=p.set("shouldLeaveReactionMenuOpen",q.leaveOpen);break;case c("SphericalVideoComponentConstants").ACTIONS.SET_MOUSE_DOWN:p=this.$SpatialReactionsProductionStore1(p,q.reactionCenter);break;case c("SphericalVideoComponentConstants").ACTIONS.SET_MOUSE_UP:p=this.$SpatialReactionsProductionStore2(p,q.id,q.reactionCenter);break;case c("SphericalVideoComponentConstants").ACTIONS.SET_IS_DRAGGING:p=p.set("isDragging",q.isDragging);break;case c("SphericalVideoComponentConstants").ACTIONS.DROP_REACTION:p=p.set("mousePositionRelativeToCanvas",null);p=p.set("originalDragPosition",null);break;case c("SphericalVideoComponentConstants").ACTIONS.CLICK_REACTION:p=this.$SpatialReactionsProductionStore3(p);break;default:break}return p};o.prototype.shouldLeaveReactionMenuOpen=function(){return this.$SpatialReactionsProductionStore4(this.getState())};o.prototype.getIsMouseDown=function(){return this.$SpatialReactionsProductionStore5(this.getState())};o.prototype.getOriginalMousePosition=function(){var p=this.$SpatialReactionsProductionStore6(this.getState());if(!p)throw new Error("User is not dragging yet");return p};o.prototype.getReactionPositionVector=function(){return this.$SpatialReactionsProductionStore7(this.getState())};o.prototype.getIsReactionWithinViewport=function(p,q){return this.$SpatialReactionsProductionStore8.apply(this,[this.getState()].concat(Array.prototype.slice.call(arguments)))};o.prototype.getNextClickReactionPositionIndex=function(){return this.$SpatialReactionsProductionStore9(this.getState())};o.prototype.$SpatialReactionsProductionStore7=function(p){var q=p.mousePositionRelativeToCanvas;if(!q)throw new Error("User is not dragging yet");return q};o.prototype.$SpatialReactionsProductionStore8=function(p,q,r){var s=p.mousePositionRelativeToCanvas;if(!s)throw new Error("User is not dragging yet");return l(s,q,r)};o.prototype.$SpatialReactionsProductionStore4=function(p){return p.shouldLeaveReactionMenuOpen};o.prototype.$SpatialReactionsProductionStore5=function(p){return p.isMouseDown};o.prototype.$SpatialReactionsProductionStore6=function(p){return p.originalDragPosition};o.prototype.$SpatialReactionsProductionStore10=function(p,q){return q.sub(c("SphericalViewportControlStore").getViewportPositionVector(p))};o.prototype.$SpatialReactionsProductionStore9=function(p){return p.nextClickReactionPositionIndex};o.prototype.$SpatialReactionsProductionStore1=function(p,q){var r=new(c("Vector"))(c("SpatialReactionAnimationConfig").SIZES.BASE.PX/2,0),s=q.sub(r);p=p.set("originalDragPosition",s);p=p.set("isMouseDown",true);return p};o.prototype.$SpatialReactionsProductionStore2=function(p,q,r){p=p.set("isMouseDown",false);var s=this.$SpatialReactionsProductionStore10(q,r);p=p.set("mousePositionRelativeToCanvas",s);return p};o.prototype.$SpatialReactionsProductionStore3=function(p){var q=p.nextClickReactionPositionIndex,r=Math.floor(m/2),s=q<r,t=c("range")(0,m).filter(function(u){return s?!(u<r):u<r}).reduce(function(u,v,w,x){return u===null?x[Math.floor(Math.random()*x.length)]:u},null);return p.set("nextClickReactionPositionIndex",t)};function o(){j.apply(this,arguments)}f.exports=new o(c("SphericalVideoComponentDispatcher"))}),null);
__d("SpatialReactionsState",["immutable"],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c("immutable").Record({reactionClusters:c("immutable").Set()}));i=h&&h.prototype;function j(){"use strict";h.apply(this,arguments)}f.exports=j}),null);
__d("SpatialReactionsConsumptionStore",["invariant","SpatialReactionAnimationConfig","SpatialReactionAnimationUtils","SphericalVideoComponentConstants","SphericalVideoComponentDispatcher","FluxMapStore","SpatialReactionsImageCache","immutable","SpatialReaction","SpatialReactionCluster","SpatialReactionsState","SpatialReactionsProductionStore","VideoPlayerControllerStore","SpatialReactionExperimentsStore","SphericalViewportControlStore","curry","denormalizeYaw","degToRad","radToDeg","SphericalProjectionUtils"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SphericalProjectionUtils").distanceBetweenSphericalCoordinatesDeg,l=c("SpatialReactionAnimationConfig").DURATIONS.SELF.TOTAL.FRAMES,m=.7;i=babelHelpers.inherits(n,c("FluxMapStore"));j=i&&i.prototype;n.prototype.getInitialState=function(){return c("immutable").Map({})};n.prototype.reduce=function(o,p){__p&&__p();var q=p.id,r=c("curry")(o.set.bind(o),q);switch(p.type){case c("SphericalVideoComponentConstants").ACTIONS.REGISTER_NEW_REACTIONS_STATE:o=r(new(c("SpatialReactionsState"))());break;case c("SphericalVideoComponentConstants").ACTIONS.ADD_SPATIAL_REACTIONS:o=this.$SpatialReactionsConsumptionStore1(q,o,p.reactionClusters);break;case c("SphericalVideoComponentConstants").ACTIONS.DROP_REACTION:o=this.$SpatialReactionsConsumptionStore2(q,o,p.reactionType,p.reactionOutsideViewport,p.recordMouseLocation,p.viewportWidth,p.viewportHeight,p.viewportYaw,p.viewportPitch,p.viewportFieldOfView,p.recordReactionCallback);break;case c("SphericalVideoComponentConstants").ACTIONS.TICK_ANIMATION:o=this.$SpatialReactionsConsumptionStore3(q,o);o=this.$SpatialReactionsConsumptionStore4(q,o);break;case c("SphericalVideoComponentConstants").ACTIONS.START_ANIMATION_FOR_FRAME:o=this.$SpatialReactionsConsumptionStore5(q,o,p.timestamp,p.yaw,p.pitch,p.fieldOfView,p.viewportWidth,p.viewportHeight);break;case c("SphericalVideoComponentConstants").ACTIONS.SEEK_START:o=this.$SpatialReactionsConsumptionStore6(q,o);break;default:break}return o};n.prototype.getSpatialReactionsState=function(o){return this.$SpatialReactionsConsumptionStore7(o,this.getState())};n.prototype.$SpatialReactionsConsumptionStore7=function(o,p){return p.get(o)};n.prototype.$SpatialReactionsConsumptionStore8=function(o,p,q,r){var s=p.get(o).set(q,r);return p.set(o,s)};n.prototype.$SpatialReactionsConsumptionStore2=function(o,p,q,r,s,t,u,v,w,x,y){if(r||c("SpatialReactionExperimentsStore").shouldDisableReactions(o)){y();return p}y(Math.floor(v),Math.floor(w));return this.$SpatialReactionsConsumptionStore9(o,p,q,v,w,c("VideoPlayerControllerStore").getCurrentTime(o))};n.prototype.$SpatialReactionsConsumptionStore9=function(o,p,q,r,s,t){var u=c("SpatialReactionsImageCache").getOwnProfilePhotoURI();if(!u)return p;var v=p.get(o),w=new(c("SpatialReactionCluster"))({animationDurationFrames:l,animationProgressFrames:-1,friendReactions:c("immutable").Set.of(new(c("SpatialReaction"))({animationRandomSeed:Math.random(),isFriend:true,profilePictureURI:u,reactionType:q,positionIndex:c("SpatialReactionsProductionStore").getNextClickReactionPositionIndex()})),originalYaw:c("denormalizeYaw")(r),originalPitch:s,timestamp:t,isSelfReaction:true});p=p.set(o,v);return this.$SpatialReactionsConsumptionStore1(o,p,c("immutable").Set.of(w))};n.prototype.$SpatialReactionsConsumptionStore1=function(o,p,q){__p&&__p();var r=p.get(o),s=r,t=s.reactionClusters;q.forEach(function(u){var v=u.friendReactions;v.forEach(function(w){w.profilePictureURI||h(0);w.isFriend||h(0);c("SpatialReactionsImageCache").putFriendImage(w.profilePictureURI)})});t=t.union(q);r=r.set("reactionClusters",t);return p.set(o,r)};n.prototype.$SpatialReactionsConsumptionStore5=function(o,p,q,r,s,t,u,v){__p&&__p();var w=c("SpatialReactionAnimationUtils").canStartClusterAnimation,x=c("SpatialReactionAnimationUtils").clusterIsVisibleOnLeft,y=c("SpatialReactionAnimationUtils").clusterIsVisibleOnRight,z=c("SpatialReactionAnimationUtils").clusterIsVisibleInViewport,A=p.get(o),B=A.reactionClusters,C=c("SpatialReactionExperimentsStore").shouldDisableInitialViewportReactions(o),D=k(c("SphericalViewportControlStore").getInitialYaw(o),c("SphericalViewportControlStore").getInitialPitch(o),r,s),E=D<30,F=c("SpatialReactionExperimentsStore").shouldOnlyShowHints(o),G=B.count(function(K){return K.hasStartedAnimating()&&!K.isSelfReaction}),H=u/v,I=c("radToDeg")(2*Math.atan(Math.tan(c("degToRad")(t)/2)*H)),J=function J(K){__p&&__p();var L=K;if(w(q,K,c("SpatialReactionsImageCache")))if(K.isSelfReaction)L=K.startAnimation(r,s);else if(G<1)if(z(K,r,s,t,u,v)){if(!(F||C&&E))L=K.startAnimation(r,s)}else if(x(K,r,s,I,t,u,v)){var M=true;L=K.startAnimation(r-I*m,s,M)}else if(y(K,r,s,I,t,u,v)){var N=true;L=K.startAnimation(r+I*m,s,N)}return L};return this.$SpatialReactionsConsumptionStore10(o,p,J)};n.prototype.$SpatialReactionsConsumptionStore3=function(o,p){var q=function q(r){return r.hasStartedAnimating()?r.tickAnimation():r};return this.$SpatialReactionsConsumptionStore10(o,p,q)};n.prototype.$SpatialReactionsConsumptionStore4=function(o,p){var q=c("SpatialReactionAnimationUtils").resetClusterAnimationIfNeeded;p=this.$SpatialReactionsConsumptionStore10(o,p,q);return p};n.prototype.$SpatialReactionsConsumptionStore6=function(o,p){return this.$SpatialReactionsConsumptionStore10(o,p,c("SpatialReactionAnimationUtils").resetClusterAnimation)};n.prototype.$SpatialReactionsConsumptionStore10=function(o,p,q){var r=p.get(o),s=r,t=s.reactionClusters;t=t.map(q);r=r.set("reactionClusters",t);return p.set(o,r)};n.prototype.$SpatialReactionsConsumptionStore11=function(o,p,q){var r=p.get(o),s=r,t=s.reactionClusters;t=t.filter(q);r=r.set("reactionClusters",t);return p.set(o,r)};function n(){i.apply(this,arguments)}f.exports=new n(c("SphericalVideoComponentDispatcher"))}),null);
__d("SpatialReactionsConsumptionLoggingStore",["invariant","SphericalVideoComponentConstants","SphericalVideoComponentDispatcher","FluxMapStore","immutable","SpatialReactionsConsumptionStore","SphericalViewportControlStore","SpatialReactionConsumptionTypedLogger","SpatialReactionConsumptionLoggingEvents","SpatialReactionDisplayStates"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k,l,m=100,n=Math.floor;i=babelHelpers.inherits(o,c("immutable").Record({clusterPitch:null,clusterYaw:null,displayState:null,friendCount:0,hasNonFriend:false,isDisplayingCluster:false,moveTowardHint:false,reactionType:null,timestamp:null,viewportPitch:null,viewportYaw:null}));j=i&&i.prototype;function o(){i.apply(this,arguments)}k=babelHelpers.inherits(p,c("FluxMapStore"));l=k&&k.prototype;p.prototype.getInitialState=function(){return c("immutable").Map({})};p.prototype.reduce=function(q,r){var s=r.id;switch(r.type){case c("SphericalVideoComponentConstants").ACTIONS.REGISTER_NEW_REACTIONS_STATE:q=q.set(s,new o());break;case c("SphericalVideoComponentConstants").ACTIONS.TICK_ANIMATION:q=this.$SpatialReactionsConsumptionLoggingStore1(q,s);break;default:break}return q};p.prototype.$SpatialReactionsConsumptionLoggingStore1=function(q,r){__p&&__p();var s=this.$SpatialReactionsConsumptionLoggingStore2(r,q),t=s.isDisplayingCluster,u=c("SpatialReactionsConsumptionStore").getSpatialReactionsState(r);if(u){var v=u.get("reactionClusters"),w=v.filter(function(y){return!y.isSelfReaction&&y.hasStartedAnimating()}),x=w.size>0;if(x&&!t)q=this.$SpatialReactionsConsumptionLoggingStore3(r,q,v);else if(!x&&t){q=this.$SpatialReactionsConsumptionLoggingStore4(r,q);this.$SpatialReactionsConsumptionLoggingStore5(q.get(r));q=this.$SpatialReactionsConsumptionLoggingStore6(r,q)}}return q};p.prototype.$SpatialReactionsConsumptionLoggingStore3=function(q,r,s){__p&&__p();var t=s.filter(function(u){return!u.isSelfReaction&&u.hasStartedAnimating()});if(t.size===1){var u=t.first(),v=u.animationYaw,w=u.animationPitch,x=u.friendReactions,y=u.anonymousReactions,z=u.timestamp;v!==null&&w!==null||h(0);var A=c("SphericalViewportControlStore").getOrientation(q),B=this.$SpatialReactionsConsumptionLoggingStore2(q,r),C=x.union(y).countBy(function(G){return G.reactionType}).sortBy(function(G,H){return-G}).flip().first(),D=x.size,E=y.size>0,F=u.isHint?c("SpatialReactionDisplayStates").HINT:c("SpatialReactionDisplayStates").DISPLAY;B=B.set("isDisplayingCluster",true).set("clusterYaw",n(v)).set("clusterPitch",n(w)).set("timestamp",n(z)).set("reactionType",C).set("friendCount",D).set("hasNonFriend",E).set("viewportYaw",n(A.yaw)).set("viewportPitch",n(A.pitch)).set("displayState",F);r=r.set(q,B)}return r};p.prototype.$SpatialReactionsConsumptionLoggingStore4=function(q,r){var s=this.$SpatialReactionsConsumptionLoggingStore2(q,r);if(s.displayState===c("SpatialReactionDisplayStates").HINT){var t=c("SphericalViewportControlStore").getOrientation(q),u=s,v=u.viewportYaw,w=u.viewportPitch,x=u.clusterYaw,y=u.clusterPitch;v!==null&&w!==null&&x!==null&&y!==null||h(0);var z=this.$SpatialReactionsConsumptionLoggingStore7(v-x,w-y),A=this.$SpatialReactionsConsumptionLoggingStore7(t.yaw-x,t.pitch-y);s=s.set("moveTowardHint",z-A>m)}r=r.set(q,s);return r};p.prototype.$SpatialReactionsConsumptionLoggingStore7=function(q,r){return r*r+q*q};p.prototype.$SpatialReactionsConsumptionLoggingStore6=function(q,r){return r.set(q,new o())};p.prototype.$SpatialReactionsConsumptionLoggingStore5=function(q){var r=new(c("SpatialReactionConsumptionTypedLogger"))();r.setEvent(c("SpatialReactionConsumptionLoggingEvents").SPATIAL_REACTION_DISPLAY).setYaw(q.get("clusterYaw")).setPitch(q.get("clusterPitch")).setDisplayState(q.get("displayState")).setFriendCount(q.get("friendCount")).setHasNonFriend(q.get("hasNonFriend")).setMoveTowardsHint(q.get("moveTowardHint")).setReactionKey(q.get("reactionType")).setVideoTimestamp(q.get("timestamp")).setCenterYaw(q.get("viewportYaw")).setCenterPitch(q.get("viewportPitch"));r.log();r.clear()};p.prototype.$SpatialReactionsConsumptionLoggingStore2=function(q,r){return r.get(q)};p.prototype.finishTrackingCluster=function(q,r){return this.$SpatialReactionsConsumptionLoggingStore4(q,r)};function p(){k.apply(this,arguments)}f.exports=new p(c("SphericalVideoComponentDispatcher"))}),null);
__d("SphericalVideoComponent",["SphericalVideoComponentActions","SphericalVideoComponentDispatcher","VideoPlayerControllerStore","SphericalViewportControlStore","SpatialReactionsConsumptionStore","SpatialReactionsProductionStore","SpatialReactionFunnelLoggingStore","SpatialReactionsConsumptionLoggingStore","SpatialReactionExperimentsStore","abstractMethod"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();h.getStores=function(){return[c("VideoPlayerControllerStore"),c("SphericalViewportControlStore"),c("SpatialReactionsConsumptionStore"),c("SpatialReactionsProductionStore"),c("SpatialReactionFunnelLoggingStore"),c("SpatialReactionsConsumptionLoggingStore"),c("SpatialReactionExperimentsStore")]};h.prototype.getInitialState=function(i){return c("abstractMethod")("SphericalVideoComponent","getInitialState")};h.prototype.calculateState=function(i){return c("abstractMethod")("SphericalVideoComponent","calculateState")};function h(i){__p&&__p();this.onStoreChange=function(){var o=this.calculateState(this.state);this.onStateChange(this.state,o);this.state=o}.bind(this);c("SphericalVideoComponentDispatcher").explicitlyRegisterStores([c("SphericalViewportControlStore"),c("VideoPlayerControllerStore"),c("SpatialReactionsConsumptionStore"),c("SpatialReactionsProductionStore"),c("SpatialReactionFunnelLoggingStore"),c("SpatialReactionsConsumptionLoggingStore"),c("SpatialReactionExperimentsStore")]);this.id=i.getVideoPlayerID();c("SphericalVideoComponentActions").registerVideoPlayerController(i);this.state=this.getInitialState(this.id);for(var j=h.getStores(),k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(k){if(l>=j.length)break;m=j[l++]}else{l=j.next();if(l.done)break;m=l.value}var n=m;n.addListener(this.onStoreChange)}}h.prototype.onStateChange=function(i,j){return};f.exports=h}),null);
__d("SpatialReactionAnimationPositioner",["SpatialReactionAnimationConfig","Vector","SpatialReactionAnimationUtils","curry"],(function a(b,c,d,aa,e,ba){"use strict";__p&&__p();var f=c("SpatialReactionAnimationUtils").getClusterIsMovingToCenter,g=c("SpatialReactionAnimationUtils").getClusterIsLookingAtCenter,h=c("SpatialReactionAnimationUtils").getClusterIsMovingBackTowardCenter,i=c("SpatialReactionAnimationUtils").getMoveToCenterProgressFrames,j=c("SpatialReactionAnimationUtils").getLookAtCenterProgressFrames,k=c("SpatialReactionAnimationUtils").getMoveBackTowardCenterProgressFrames,l=c("SpatialReactionAnimationUtils").getReactionIndexOnLeft,m=c("SpatialReactionAnimationUtils").getReactionClickPositionRelativeToViewport,n=c("SpatialReactionAnimationConfig").CURVES,o=n.MOVE_TO_CENTER_PATH_X,p=n.MOVE_TO_CENTER_PATH_Y,q=n.LOOK_AT_CENTER_PATH_X,r=n.LOOK_AT_CENTER_PATH_Y,s=n.MOVE_BACK_TOWARD_CENTER_PATH_X,t=n.MOVE_BACK_TOWARD_CENTER_PATH_Y;u.prototype.setCluster=function(v){this.$SpatialReactionAnimationPositioner5=v;return this};u.prototype.setViewportWidth=function(v){this.$SpatialReactionAnimationPositioner1=v;return this};u.prototype.setViewportHeight=function(v){this.$SpatialReactionAnimationPositioner2=v;return this};u.prototype.setClusterCenterX=function(v){this.$SpatialReactionAnimationPositioner3=v;return this};u.prototype.setClusterCenterY=function(v){this.$SpatialReactionAnimationPositioner4=v;return this};u.prototype.getReactionPosition=function(v){return this.$SpatialReactionAnimationPositioner6(this.$SpatialReactionAnimationPositioner1,this.$SpatialReactionAnimationPositioner2,this.$SpatialReactionAnimationPositioner3,this.$SpatialReactionAnimationPositioner4,this.$SpatialReactionAnimationPositioner5,v)};u.prototype.$SpatialReactionAnimationPositioner6=function(v,w,x,y,z,A){var B=z.animationProgressFrames;if(!z.hasStartedAnimating())throw new Error("Reactions cluster with progress: "+B+"\n         has not started animating");return this.$SpatialReactionAnimationPositioner7.apply(this,arguments)};u.prototype.$SpatialReactionAnimationPositioner7=function(v,w,x,y,z,A){__p&&__p();var B=c("curry")(this.$SpatialReactionAnimationPositioner8,A),C=c("curry")(B,0),D=z.isSelfReaction,E=D?c("SpatialReactionAnimationConfig").DURATIONS.SELF:c("SpatialReactionAnimationConfig").DURATIONS.NON_SELF,F=D?c("SpatialReactionAnimationConfig").DISTANCES.LOOK_AT_CENTER.SELF:c("SpatialReactionAnimationConfig").DISTANCES.LOOK_AT_CENTER.NON_SELF,G=l(A),H=m(v,w,A.reactionType),I=H.x,J=H.y,K=F.X.PX;K*=G?-1:1;var L=c("SpatialReactionAnimationConfig").DISTANCES.LOOK_AT_CENTER.RANDOM_OFFSET_X.MAX.PX,M=c("SpatialReactionAnimationConfig").DISTANCES.LOOK_AT_CENTER.RANDOM_OFFSET_X.MIN.PX;K+=B(M,L);var N=this.$SpatialReactionAnimationPositioner9(F.Y.PX,A),O=x,P=y,Q=c("SpatialReactionAnimationConfig").DISTANCES.MOVE_BACK_TOWARD_CENTER.X.PX,R=c("SpatialReactionAnimationConfig").DISTANCES.MOVE_BACK_TOWARD_CENTER.Y.PX;Q*=G?1:-1;var S=void 0,T=void 0;if(f(z)){var U=E.MOVE_TO_CENTER.FRAMES,V=i(z);S=o.solve(V,I,O-I,U);T=p.solve(V,J,P-J,U)}else if(g(z)){var W=E.LOOK_AT_CENTER.FRAMES,X=E.LOOK_AT_CENTER.MAX_RANDOM_DELAY_FRAMES,Y=j(z);S=q.solve(Y,O,K,W,C(X));T=r.solve(Y,P,-N,W,C(X))}else if(h(z)){var Z=E.MOVE_BACK_TOWARD_CENTER.FRAMES,$=k(z);S=s.solve($,O+K,Q,Z);T=t.solve($,P-N,R,Z)}else throw new Error("Animation config is invalid");return new(c("Vector"))(Math.floor(S),Math.floor(T))};u.prototype.$SpatialReactionAnimationPositioner9=function(v,w){var x=w.positionIndex,y=v;if(x>1)y/=3;if(x>3)y*=-2;return y};u.prototype.$SpatialReactionAnimationPositioner8=function(v,w,x){var y=v.animationRandomSeed;return w+Math.floor(y*(x-w))};function u(){}e.exports=u}),null);
__d("SpatialReactionAnimationScaler",["SpatialReactionAnimationConfig","SpatialReactionAnimationUtils"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SpatialReactionAnimationUtils").getMoveToCenterProgressFrames,i=c("SpatialReactionAnimationUtils").getLookAtCenterProgressFrames,j=c("SpatialReactionAnimationUtils").getMoveBackTowardCenterProgressFrames,k=c("SpatialReactionAnimationUtils").getClusterIsMovingToCenter,l=c("SpatialReactionAnimationUtils").getClusterIsLookingAtCenter,m=c("SpatialReactionAnimationUtils").getClusterIsMovingBackTowardCenter,n=c("SpatialReactionAnimationUtils").getDurationsForClusterType,o=Math.floor,p=c("SpatialReactionAnimationConfig").CURVES,q=p.MOVE_TO_CENTER_SCALE,r=p.LOOK_AT_CENTER_SCALE_SELF,s=p.LOOK_AT_CENTER_SCALE_NON_SELF,t=p.MOVE_BACK_TOWARD_CENTER_SCALE;u.prototype.setCluster=function(v){this.$SpatialReactionAnimationScaler1=v};u.prototype.getReactionScale=function(v){__p&&__p();if(!this.$SpatialReactionAnimationScaler1.hasStartedAnimating())throw new Error("Reactions this._cluster with progress: "+this.$SpatialReactionAnimationScaler1.animationProgressFrames+"\n         has not started animating");var w=this.$SpatialReactionAnimationScaler1.isSelfReaction,x=n(this.$SpatialReactionAnimationScaler1,c("SpatialReactionAnimationConfig")),y=this.$SpatialReactionAnimationScaler2(v);if(k(this.$SpatialReactionAnimationScaler1)){var z=x.MOVE_TO_CENTER.FRAMES,A=h(this.$SpatialReactionAnimationScaler1),B=c("SpatialReactionAnimationConfig").SCALES.MOVE_TO_CENTER.MIN,C=c("SpatialReactionAnimationConfig").SCALES.MOVE_TO_CENTER.MAX;return q.solve(A,C,-(C-B),z)}else if(l(this.$SpatialReactionAnimationScaler1)){var D=x.LOOK_AT_CENTER.FRAMES,E=x.SCALE_DOWN.FRAMES,F=i(this.$SpatialReactionAnimationScaler1),G=w?r:s,H=w?c("SpatialReactionAnimationConfig").SCALES.LOOK_AT_CENTER.MIN:c("SpatialReactionAnimationConfig").SCALES.LOOK_AT_CENTER.SELF_MIN,I=x.LOOK_AT_CENTER.MAX_RANDOM_SCALE_DELAY_FRAMES,J=x.LOOK_AT_CENTER.MIN_RANDOM_SCALE_DELAY_FRAMES,K=o(J+v.animationRandomSeed*(I-J)),L=D-K-E;return G.solve(F,H,y-H,D,K,L)}else if(m(this.$SpatialReactionAnimationScaler1)){var M=x.MOVE_BACK_TOWARD_CENTER.FRAMES,N=x.SCALE_DOWN.FRAMES,O=j(this.$SpatialReactionAnimationScaler1),P=c("SpatialReactionAnimationConfig").SCALES.MOVE_BACK_TOWARD_CENTER.MIN,Q=x.MOVE_BACK_TOWARD_CENTER.MAX_RANDOM_SCALE_DELAY_FRAMES,R=o(v.animationRandomSeed*Q),S=M-R-N;return t.solve(O,y,-(y-P),M,R,S)}else throw new Error("Animation config is invalid")};u.prototype.$SpatialReactionAnimationScaler2=function(v){var w=v.positionIndex,x=c("SpatialReactionAnimationConfig").SCALES.LOOK_AT_CENTER;if(v.isFriend)return x.MAX;switch(w){case 0:case 5:return x.MAX;case 1:case 4:return x.MIN;default:return x.MID}};function u(){}f.exports=u}),null);
__d("SpatialReactionCanvasDrawingUtils",[],(function a(b,c,d,e,f,g){__p&&__p();var h=Math.floor,i={clearCanvas:function j(k,l,m){k.clearRect(0,0,l,m)},setShadowBlur:function j(k,l,m,n,o){k.save();k.shadowColor=l;k.shadowBlur=m;k.shadowOffsetX=n;k.shadowOffsetY=o},restoreShadowBlur:function j(k){k.restore()},drawCroppedCircularImage:function j(k,l,m,n,o){var p=2*o,q=m-o,r=n-o;k.save();i.drawCirclePath(k,h(m),h(n),h(o));k.clip();k.drawImage(l,h(q),h(r),h(p),h(p));k.restore()},clipCircle:function j(k,l,m,n){k.save();i.drawCirclePath(k,h(l),h(m),h(n));k.clip()},restoreClip:function j(k){k.restore()},drawSquareImage:function j(k,l,m,n,o){var p=o/2,q=m-p,r=n-p;k.drawImage(l,h(q),h(r),h(o),h(o))},drawScaledImage:function j(k,l,m,n,o,p){var q=o/2,r=p/2,s=m-q,t=n-r;k.drawImage(l,h(s),h(t),h(o),h(p))},drawCirclePath:function j(k,l,m,n){k.beginPath();k.arc(h(l),h(m),h(n),0,Math.PI*2);k.closePath()}};f.exports=i}),null);
__d("SpatialReactionAnimation",["invariant","SpatialReactionAnimationConfig","SpatialReactionAnimationUtils","SpatialReactionCanvasDrawingUtils","SpatialReactionAnimationPositioner","SpatialReactionAnimationScaler","clamp"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("SpatialReactionAnimationUtils").get2dDiscretePointFromCurrentView,j=Math.max(window.devicePixelRatio||1,1);function k(l){__p&&__p();this.$SpatialReactionAnimation3=false;this.$SpatialReactionAnimation16=function(n){if(n.hasStartedAnimating()){var o=n.animationYaw,p=n.animationPitch;o!==null&&p!==null||h(0);var q=i(o,p,this.$SpatialReactionAnimation6,this.$SpatialReactionAnimation7,this.$SpatialReactionAnimation8,this.$SpatialReactionAnimation4,this.$SpatialReactionAnimation5),r=c("SpatialReactionAnimationConfig").DISTANCES.LOOK_AT_CENTER.NON_SELF.X.PX,s=-r,t=this.$SpatialReactionAnimation4+r;this.$SpatialReactionAnimation17(n,c("clamp")(q.x,s,t),q.y)}}.bind(this);this.$SpatialReactionAnimation1=l;var m=this.$SpatialReactionAnimation1.getContext("2d");this.$SpatialReactionAnimation12=new(c("SpatialReactionAnimationPositioner"))();this.$SpatialReactionAnimation13=new(c("SpatialReactionAnimationScaler"))();if(m){this.$SpatialReactionAnimation2=m;this.$SpatialReactionAnimation14()}else this.$SpatialReactionAnimation3=true}k.prototype.constructedSuccessfully=function(){return!this.$SpatialReactionAnimation3};k.prototype.resizeCanvas=function(l,m){if(l<0||m<0)throw new Error("Canvas cannot be resized to values width: "+l+", height: "+m);this.$SpatialReactionAnimation1.width=l*j;this.$SpatialReactionAnimation1.height=m*j;this.$SpatialReactionAnimation2.scale(j,j)};k.prototype.clearAnimation=function(){this.$SpatialReactionAnimation15()};k.prototype.drawFrame=function(l,m,n,o,p,q,r,s,t){__p&&__p();if(m<=0||n<=0)return;if(s<=this.$SpatialReactionAnimation10)throw new Error("You are trying to draw two frames at once, or a frame in the past");this.$SpatialReactionAnimation11=l;this.$SpatialReactionAnimation4=m;this.$SpatialReactionAnimation5=n;this.$SpatialReactionAnimation6=o;this.$SpatialReactionAnimation7=p;this.$SpatialReactionAnimation8=q;this.$SpatialReactionAnimation9=r;this.$SpatialReactionAnimation10=s;this.$SpatialReactionAnimation15();t.reactionClusters.forEach(this.$SpatialReactionAnimation16)};k.prototype.$SpatialReactionAnimation17=function(l,m,n){this.$SpatialReactionAnimation12.setViewportWidth(this.$SpatialReactionAnimation4).setViewportHeight(this.$SpatialReactionAnimation5).setClusterCenterX(m).setClusterCenterY(n).setCluster(l);this.$SpatialReactionAnimation13.setCluster(l);var o=l.anonymousReactions,p=l.friendReactions,q=function(r){var s=this.$SpatialReactionAnimation12.getReactionPosition(r),t=s.x,u=s.y,v=this.$SpatialReactionAnimation13.getReactionScale(r);this.$SpatialReactionAnimation18(l,r,t,u,v)}.bind(this);if(l.isSelfReaction)q(p.first());else p.union(o).forEach(q)};k.prototype.$SpatialReactionAnimation18=function(l,m,n,o,p){c("SpatialReactionCanvasDrawingUtils").setShadowBlur(this.$SpatialReactionAnimation2,c("SpatialReactionAnimationConfig").SHADOW.COLOR,c("SpatialReactionAnimationConfig").SHADOW.BLUR,c("SpatialReactionAnimationConfig").SHADOW.OFFSET_X,c("SpatialReactionAnimationConfig").SHADOW.OFFSET_Y);this.$SpatialReactionAnimation19.apply(this,arguments);c("SpatialReactionCanvasDrawingUtils").restoreShadowBlur(this.$SpatialReactionAnimation2);this.$SpatialReactionAnimation20(n,o,c("SpatialReactionAnimationUtils").getReactionRadius(p));this.$SpatialReactionAnimation21.apply(this,arguments);this.$SpatialReactionAnimation22();this.$SpatialReactionAnimation20(n,o,c("SpatialReactionAnimationUtils").getProfilePictureRadius(p));this.$SpatialReactionAnimation23.apply(this,arguments);this.$SpatialReactionAnimation22()};k.prototype.$SpatialReactionAnimation23=function(l,m,n,o,p){var q=c("SpatialReactionAnimationUtils").getReactionBaseSize,r=c("SpatialReactionAnimationUtils").getReactionProfilePictureOffset,s=m.isFriend,t=m.profilePictureURI;if(s&&t){var u=this.$SpatialReactionAnimation11.getFriendImage(t),v=q(p),w=r(l,m);this.$SpatialReactionAnimation24(u,n-w,o,v)}};k.prototype.$SpatialReactionAnimation19=function(l,m,n,o,p){var q=m.reactionType,r=this.$SpatialReactionAnimation11.getReactionBaseImage(q),s=c("SpatialReactionAnimationUtils").getReactionBaseSize(p);this.$SpatialReactionAnimation24(r,n,o,s)};k.prototype.$SpatialReactionAnimation21=function(l,m,n,o,p){var q=m.reactionType,r=m.isFriend,s=m.profilePictureURI,t=this.$SpatialReactionAnimation11.getReactionFaceImage(q),u=c("SpatialReactionAnimationUtils").getReactionFaceDimensions(l,m,p),v=c("SpatialReactionAnimationUtils").getReactionFaceOffset(l,m);if(r&&s)v+=c("SpatialReactionAnimationUtils").getReactionFaceFlipOutOffset(l,m);this.$SpatialReactionAnimation25(t,n+v,o,u.x,u.y)};k.prototype.$SpatialReactionAnimation15=function(){c("SpatialReactionCanvasDrawingUtils").clearCanvas(this.$SpatialReactionAnimation2,this.$SpatialReactionAnimation4,this.$SpatialReactionAnimation5)};k.prototype.$SpatialReactionAnimation14=function(){this.$SpatialReactionAnimation2.mozImageSmoothingEnabled=false;this.$SpatialReactionAnimation2.imageSmoothingEnabled=false};k.prototype.$SpatialReactionAnimation24=function(l,m,n,o){c("SpatialReactionCanvasDrawingUtils").drawSquareImage.apply(c("SpatialReactionCanvasDrawingUtils"),[this.$SpatialReactionAnimation2].concat(Array.prototype.slice.call(arguments)))};k.prototype.$SpatialReactionAnimation25=function(l,m,n,o,p){c("SpatialReactionCanvasDrawingUtils").drawScaledImage.apply(c("SpatialReactionCanvasDrawingUtils"),[this.$SpatialReactionAnimation2].concat(Array.prototype.slice.call(arguments)))};k.prototype.$SpatialReactionAnimation20=function(l,m,n){c("SpatialReactionCanvasDrawingUtils").clipCircle(this.$SpatialReactionAnimation2,l,m,n)};k.prototype.$SpatialReactionAnimation22=function(){c("SpatialReactionCanvasDrawingUtils").restoreClip(this.$SpatialReactionAnimation2)};f.exports=k}),null);
__d("FenwickTree",["idx"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=function h(j){return j&-j};function i(j,k){var l;j=((l=k)!=null?l.length:l)||j;this.$FenwickTree1=new Array(j).fill(0);if(k)for(var m=0;m<j;++m)this.add(m,k[m])}i.prototype.add=function(j,k){for(;j<this.$FenwickTree1.length;j+=h(j+1))this.$FenwickTree1[j]+=k};i.prototype.get=function(j){return this.rangeSum(j,j+1)};i.prototype.set=function(j,k){var l=this.get(j);if(k!==l)this.add(j,k-l)};i.prototype.prefixSum=function(j){var k=0;for(;j>0;j-=h(j))k+=this.$FenwickTree1[j-1];return k};i.prototype.rangeSum=function(j,k){var l=0;for(;k>j;k-=h(k))l+=this.$FenwickTree1[k-1];for(;j>k;j-=h(j))l-=this.$FenwickTree1[j-1];return l};f.exports=i}),null);
__d("SpatialReactionRequestIntervalTracker",["FenwickTree"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=1;function i(j,k,l){this.$SpatialReactionRequestIntervalTracker2=k;this.$SpatialReactionRequestIntervalTracker3=l;var m=Math.ceil(Math.ceil(j)/h);this.$SpatialReactionRequestIntervalTracker1=new(c("FenwickTree"))(m)}i.prototype.recordInterval=function(j){var k=this.$SpatialReactionRequestIntervalTracker4(j),l=this.$SpatialReactionRequestIntervalTracker4(this.$SpatialReactionRequestIntervalTracker5(j));if(this.$SpatialReactionRequestIntervalTracker1)while(k<l)this.$SpatialReactionRequestIntervalTracker1.set(k++,1)};i.prototype.shouldFetchInterval=function(j){var k=this.$SpatialReactionRequestIntervalTracker4(j),l=this.$SpatialReactionRequestIntervalTracker4(this.$SpatialReactionRequestIntervalTracker5(j));if(this.$SpatialReactionRequestIntervalTracker1.get(k)<1)return true;return this.$SpatialReactionRequestIntervalTracker1.rangeSum(k,l)+(this.$SpatialReactionRequestIntervalTracker2-this.$SpatialReactionRequestIntervalTracker3)/h<=l-k};i.prototype.getIntervalSum=function(j){var k=this.$SpatialReactionRequestIntervalTracker4(j),l=this.$SpatialReactionRequestIntervalTracker4(this.$SpatialReactionRequestIntervalTracker5(j));return this.$SpatialReactionRequestIntervalTracker1.rangeSum(k,l)};i.prototype.$SpatialReactionRequestIntervalTracker4=function(j){return Math.floor(j/h)};i.prototype.$SpatialReactionRequestIntervalTracker5=function(j){return j+this.$SpatialReactionRequestIntervalTracker2};f.exports=i}),null);
__d("XVODStreamingReactionsAsyncController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videos/vodreactions/",{eft_id:{type:"String",required:true},start_time:{type:"Float",required:true},end_time:{type:"Float",required:true}})}),null);
__d("compose",[],(function a(b,c,d,e,f,g){function h(){for(var i=arguments.length,j=Array(i),k=0;k<i;k++)j[k]=arguments[k];if(j.length<2)throw new Error("Compose expects two or more functions as arguments.");var l=j.reverse(),m=l[0],n=l[1],o=l.slice(2),p=function q(){return n(m.apply(undefined,arguments))};return o.length===0?p:h.apply(undefined,[p].concat(o).reverse())}f.exports=h}),null);
__d("SpatialReactionsFetcherVOD",["Promise","AsyncRequest","SpatialReactionRequestIntervalTracker","XVODStreamingReactionsAsyncController","compose","SpatialReactionsUtils"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SpatialReactionsUtils").processServerReactionsPayloads,i=15,j=5;function k(l){this.$SpatialReactionsFetcherVOD4=l;this.$SpatialReactionsFetcherVOD1=null;this.$SpatialReactionsFetcherVOD2=null;this.$SpatialReactionsFetcherVOD3=-1}k.prototype.fetchNewReactionsIfNeeded=function(l){l=Math.floor(l);if(this.$SpatialReactionsFetcherVOD5(l))return this.$SpatialReactionsFetcherVOD6(l);else return new(c("Promise"))(function(m,n){return m(null)})};k.prototype.trackIntervals=function(l){this.$SpatialReactionsFetcherVOD2=new(c("SpatialReactionRequestIntervalTracker"))(l,i,j);if(this.$SpatialReactionsFetcherVOD3>0)this.$SpatialReactionsFetcherVOD7(this.$SpatialReactionsFetcherVOD3)};k.prototype.isTrackingIntervals=function(){return this.$SpatialReactionsFetcherVOD2!==null};k.prototype.$SpatialReactionsFetcherVOD6=function(l){return new(c("Promise"))(function(m,n){var o=c("compose")(m,this.$SpatialReactionsFetcherVOD8),p=function(){this.$SpatialReactionsFetcherVOD1=null}.bind(this),q=function(s){this.$SpatialReactionsFetcherVOD7(l);o(s)}.bind(this),r=this.$SpatialReactionsFetcherVOD9(l).setHandler(q).setFinallyHandler(p);this.$SpatialReactionsFetcherVOD1=r;r.send()}.bind(this))};k.prototype.$SpatialReactionsFetcherVOD9=function(l){var m=new(c("AsyncRequest"))(),n=c("XVODStreamingReactionsAsyncController").getURIBuilder().setString("eft_id",this.$SpatialReactionsFetcherVOD4).setFloat("start_time",l).setFloat("end_time",l+i).getURI();m.setURI(n);return m};k.prototype.$SpatialReactionsFetcherVOD8=function(l){var m=l.getPayload();if(m.reactionpayloads)return h(m.reactionpayloads);else return null};k.prototype.$SpatialReactionsFetcherVOD5=function(l){if(this.$SpatialReactionsFetcherVOD1!==null)return false;if(!this.$SpatialReactionsFetcherVOD2)return this.$SpatialReactionsFetcherVOD3<0;else return this.$SpatialReactionsFetcherVOD2.shouldFetchInterval(l)};k.prototype.$SpatialReactionsFetcherVOD7=function(l){this.$SpatialReactionsFetcherVOD3=l;if(this.$SpatialReactionsFetcherVOD2)this.$SpatialReactionsFetcherVOD2.recordInterval(l)};f.exports=k}),null);
__d("SpatialReactionsFetcherLive",["SphericalVideoComponentActions","ChannelManager","FeedbackAddStreamingReactionSubscription","immutable","SpatialReactionCluster","SpatialReactionsUtils"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j){__p&&__p();this.$SpatialReactionsFetcherLive7=function(k){var l=k.feedback_add_streaming_reaction_subscribe;this.$SpatialReactionsFetcherLive4=l.regional_spatial_reaction_counts;if(this.$SpatialReactionsFetcherLive5>-1)this.$SpatialReactionsFetcherLive8(c("SpatialReactionsUtils").getFriendReaction(k))}.bind(this);this.$SpatialReactionsFetcherLive1=i;this.$SpatialReactionsFetcherLive3=c("immutable").Map();this.$SpatialReactionsFetcherLive4=[];this.$SpatialReactionsFetcherLive5=-1;this.$SpatialReactionsFetcherLive6=j}h.prototype.subscribeToReactions=function(){this.$SpatialReactionsFetcherLive2=c("FeedbackAddStreamingReactionSubscription").subscribe(this.$SpatialReactionsFetcherLive1,this.$SpatialReactionsFetcherLive7)};h.prototype.unsubscribeToReactions=function(){this.$SpatialReactionsFetcherLive2&&this.$SpatialReactionsFetcherLive2.unsubscribe()};h.prototype.updateStateTime=function(i){this.$SpatialReactionsFetcherLive5=i};h.prototype.$SpatialReactionsFetcherLive8=function(i){var j=c("SpatialReactionsUtils").fetchNewLiveReactions(this.$SpatialReactionsFetcherLive5,this.$SpatialReactionsFetcherLive3,this.$SpatialReactionsFetcherLive4,i);this.$SpatialReactionsFetcherLive3=c("SpatialReactionsUtils").updateReactionRegionMap(this.$SpatialReactionsFetcherLive4,this.$SpatialReactionsFetcherLive3);if(j)c("SphericalVideoComponentActions").addSpatialReactionClusters(this.$SpatialReactionsFetcherLive6,j)};f.exports=h}),null);
__d("SphericalVideoSpatialReactionsContainer",["invariant","SphericalVideoComponentActions","SpatialReactionAnimation","SpatialReactionsConsumptionStore","SpatialReactionsFetcherVOD","SpatialReactionsFetcherLive","SpatialReactionsImageCache","SphericalVideoComponent","SphericalViewportControlStore","VideoPlayerControllerStore","SpatialReactionExperimentsStore","curry","requestAnimationFrame","cancelAnimationFrame"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j;i=babelHelpers.inherits(k,c("SphericalVideoComponent"));j=i&&i.prototype;function k(l,m,n,o,p,q,r){__p&&__p();j.constructor.call(this,m);this.$SphericalVideoSpatialReactionsContainer14=function(s,t){var u=this.state,v=u.viewportWidth,w=u.viewportHeight,x=u.viewportYaw,y=u.viewportPitch,z=u.viewportFieldOfView,A=u.spatialReactionsState,B=u.videoCurrentTime;if(this.state.videoIsPlaying)c("SphericalVideoComponentActions").startAnimationForFrame(s,B,x,y,z,v,w);A&&this.$SphericalVideoSpatialReactionsContainer1||h(0);this.$SphericalVideoSpatialReactionsContainer1.drawFrame(c("SpatialReactionsImageCache"),v,w,x,y,z,B,t,A);c("SphericalVideoComponentActions").tickAnimation(s);this.$SphericalVideoSpatialReactionsContainer6=c("requestAnimationFrame")(c("curry")(this.$SphericalVideoSpatialReactionsContainer14,s))}.bind(this);this.$SphericalVideoSpatialReactionsContainer4=l;this.$SphericalVideoSpatialReactionsContainer5=n;this.$SphericalVideoSpatialReactionsContainer7=o;this.$SphericalVideoSpatialReactionsContainer9=r;this.$SphericalVideoSpatialReactionsContainer8=q;c("SphericalVideoComponentActions").registerExperimentConfig(this.id,p);c("SphericalVideoComponentActions").registerNewSpatialReactionsState(this.id);c("SphericalVideoComponentActions").setInitialViewport(this.id,o.initialHeading,o.initialPitch)}k.prototype.getInitialState=function(l){var m=c("VideoPlayerControllerStore").getState().get("videoPlayerControllerStates").get(l),n=m.currentTime,o=m.durationSeconds,p=c("SphericalViewportControlStore").getState().get("sphericalViewportControlStates").get(l),q=p.yaw,r=p.pitch,s=p.fieldOfView,t=p.viewportWidth,u=p.viewportHeight,v=p.isInTahoe,w=p.isInChannelView,x=c("SpatialReactionsConsumptionStore").getSpatialReactionsState(l),y=c("SpatialReactionExperimentsStore").shouldDisableReactions(l);return{isInFeed:!v&&!w,spatialReactionsState:x,videoCurrentTime:n,videoDurationSeconds:o,videoIsPlaying:c("VideoPlayerControllerStore").getIsPlaying(l),videoIsPlayable:c("VideoPlayerControllerStore").getIsVideoPlayable(l),viewportFieldOfView:s,viewportHeight:u,viewportPitch:r,viewportWidth:t,viewportYaw:q,disableReactions:y}};k.prototype.calculateState=function(l){return this.getInitialState(this.id)};k.prototype.onStateChange=function(l,m){__p&&__p();var n=this.$SphericalVideoSpatialReactionsContainer1,o=m.viewportWidth,p=m.viewportHeight,q=m.videoCurrentTime,r=m.videoIsPlayable,s=m.videoDurationSeconds,t=m.spatialReactionsState,u=m.isInFeed,v=m.disableReactions;if(r&&!n&&u&&!v)this.$SphericalVideoSpatialReactionsContainer10();else if(!r&&n||!u&&n)this.$SphericalVideoSpatialReactionsContainer11();if(n&&t){if(s>0&&!this.$SphericalVideoSpatialReactionsContainer9&&this.$SphericalVideoSpatialReactionsContainer2&&!this.$SphericalVideoSpatialReactionsContainer2.isTrackingIntervals())this.$SphericalVideoSpatialReactionsContainer2.trackIntervals(s);if(this.$SphericalVideoSpatialReactionsContainer12(l,m))n.resizeCanvas(o,p);if(l.videoCurrentTime!==q)if(this.$SphericalVideoSpatialReactionsContainer9&&this.$SphericalVideoSpatialReactionsContainer3)this.$SphericalVideoSpatialReactionsContainer3.updateStateTime(q);else if(this.$SphericalVideoSpatialReactionsContainer2)this.$SphericalVideoSpatialReactionsContainer13(this.id,this.$SphericalVideoSpatialReactionsContainer2,q)}};k.prototype.$SphericalVideoSpatialReactionsContainer10=function(){__p&&__p();var l=new(c("SpatialReactionAnimation"))(this.$SphericalVideoSpatialReactionsContainer4);if(l.constructedSuccessfully()){this.$SphericalVideoSpatialReactionsContainer1=l;this.$SphericalVideoSpatialReactionsContainer1.resizeCanvas(this.state.viewportWidth,this.state.viewportHeight);if(this.$SphericalVideoSpatialReactionsContainer9){this.$SphericalVideoSpatialReactionsContainer3=new(c("SpatialReactionsFetcherLive"))(this.$SphericalVideoSpatialReactionsContainer8,this.id);this.$SphericalVideoSpatialReactionsContainer3.subscribeToReactions()}else{this.$SphericalVideoSpatialReactionsContainer2=new(c("SpatialReactionsFetcherVOD"))(c("VideoPlayerControllerStore").getVideoID(this.id));this.$SphericalVideoSpatialReactionsContainer13(this.id,this.$SphericalVideoSpatialReactionsContainer2,0)}c("SpatialReactionsImageCache").loadStaticImages(this.$SphericalVideoSpatialReactionsContainer5).then(function(){return this.$SphericalVideoSpatialReactionsContainer6=c("requestAnimationFrame")(c("curry")(this.$SphericalVideoSpatialReactionsContainer14,this.id))}.bind(this)).done()}};k.prototype.$SphericalVideoSpatialReactionsContainer11=function(){c("cancelAnimationFrame")(this.$SphericalVideoSpatialReactionsContainer6);if(this.$SphericalVideoSpatialReactionsContainer1){this.$SphericalVideoSpatialReactionsContainer1.clearAnimation();this.$SphericalVideoSpatialReactionsContainer1=null}if(this.$SphericalVideoSpatialReactionsContainer9&&this.$SphericalVideoSpatialReactionsContainer3)this.$SphericalVideoSpatialReactionsContainer3.unsubscribeToReactions()};k.prototype.$SphericalVideoSpatialReactionsContainer13=function(l,m,n){m.fetchNewReactionsIfNeeded(n).then(function(o){if(o)c("SphericalVideoComponentActions").addSpatialReactionClusters(l,o)}).done()};k.prototype.$SphericalVideoSpatialReactionsContainer12=function(l,m){return m.viewportWidth>0&&m.viewportHeight>0&&(l.viewportWidth!==m.viewportWidth||l.viewportHeight!==m.viewportHeight)};f.exports=k}),null);