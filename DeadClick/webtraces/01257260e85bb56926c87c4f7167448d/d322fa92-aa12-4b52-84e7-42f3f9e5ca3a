window.LimeSpot=window.LimeSpot===undefined?{}:LimeSpot;LimeSpot.GetUrlParam=function(n,t){return typeof t=="undefined"&&(t=location.search),(n=new RegExp("[?&]"+encodeURIComponent(n)+"=([^&]*)").exec(t))?decodeURIComponent(n[1]):void 0};LimeSpot.SyncContext=function(){parent.postMessage(JSON.stringify({Owner:"LimeSpot",Target:"*",Command:"SyncContext",Context:LimeSpot.Context}),"*")};window.addEventListener("message",function(n){var t,i;if(n!=null&&n!=undefined&&n.data!=null&&n.data!=undefined&&typeof n.data.indexOf=="function"&&!(n.data.indexOf("LimeSpot")<0)){if(t=JSON.parse(n.data),t.Target=="*"){switch(t.Command){case"SyncContext":LimeSpot.Context=t.Context}return}t.Target==LimeSpot.GetUrlParam("channelID")&&(i=n.origin,(i==null||i=="null")&&(i="*"),handleRequest(t.Method,t.Params,function(n){parent.postMessage(JSON.stringify({Owner:"LimeSpot",CallbackID:t.SuccessCallbackID,Target:t.Source,Result:n}),i)},function(n,r,u){var f=LimeSpot.ParseWebApiError(n,r,u);f!=null&&console.error("LimeSpot "+t.Method+": "+f);parent.postMessage(JSON.stringify({Owner:"LimeSpot",CallbackID:t.ErrorCallbackID,Target:t.Source,Result:{JqXHR:n,TextStatus:r,ErrorThrown:u}}),i)}))}},!1);window.LimeSpot=window.LimeSpot===undefined?{}:LimeSpot;LimeSpot.Channel||(LimeSpot.Channel=function(){},LimeSpot.SyncContext=function(n){var i,t;for(LimeSpot.TraceLog&&LimeSpot.TraceLog("LimeSpot.SyncContext("+n+");",LimeSpot.Context),i=document.querySelectorAll(typeof n=="undefined"?"iframe[data-owner='LimeSpot']":"#"+n),t=0;t<i.length;t++)i[t].contentWindow.postMessage(JSON.stringify({Owner:"LimeSpot",Target:"*",Command:"SyncContext",Context:LimeSpot.Context}),"*")},LimeSpot.Channel.Initialize=function(n,t,i,r){if(LimeSpot.TraceLog&&LimeSpot.TraceLog("Channel ["+n+"] initializing..."),t+=(t.indexOf("?")==-1?"?":"&")+"channelID="+n,document.querySelector("iframe[src='"+t+"']")){LimeSpot.TraceLog&&LimeSpot.TraceLog("Channel ["+n+"] already initialized.");i!=undefined&&i();return}typeof r=="undefined"?(r=document.createElement("iframe"),r.id=n,r.style.display="none",document.body.insertBefore(r,document.body.children[0])):(r.id==""||typeof r.id=="undefined")&&(r.id=n);r.addEventListener("load",function(t){if(LimeSpot.SyncContext(n),LimeSpot.TraceLog&&LimeSpot.TraceLog("Channel ["+n+"] initialized."),t.target.getAttribute("initialized")=="1"){i!=undefined&&i();return}t.target.setAttribute("initialized","1");i!=undefined&&i();return});r.setAttribute("src",t);r.setAttribute("data-owner","LimeSpot")},LimeSpot.Channel.Callbacks={},LimeSpot.Channel.Call=function(n,t,i,r,u){var o,f,e;if(n==undefined){console.error("Target channel unspecified.");return}if(o=document.getElementById(n),o==undefined){console.error("Channel not initialized.");return}f={Owner:"LimeSpot",Method:t,Params:i,Target:n,Source:"Storefront"};typeof r!="undefined"&&(f.SuccessCallbackID=Math.random().toString(36).substr(2,10),LimeSpot.Channel.Callbacks[f.SuccessCallbackID]=r);typeof u!="undefined"&&(f.ErrorCallbackID=Math.random().toString(36).substr(2,10),LimeSpot.Channel.Callbacks[f.ErrorCallbackID]=u);e=LimeSpot.ScriptHostUrl;(typeof e=="undefined"||e=="")&&(e="*");LimeSpot.TraceLog&&LimeSpot.TraceLog("Channel ["+n+"] calling.",f);o.contentWindow.postMessage(JSON.stringify(f),e)},window.addEventListener("message",function(n){if(n!=null&&n!=undefined&&n.data!=null&&n.data!=undefined&&typeof n.data.indexOf=="function"&&!(n.data.indexOf("LimeSpot")<0)){var t=JSON.parse(n.data);if(t.Target=="*"){switch(t.Command){case"SyncContext":LimeSpot.Context=t.Context;LimeSpot.SyncContext()}return}t.Target=="Storefront"&&LimeSpot.Channel.Callbacks[t.CallbackID]&&(LimeSpot.TraceLog&&LimeSpot.TraceLog("Channel callback ["+t.CallbackID+"].",t.Result),LimeSpot.Channel.Callbacks[t.CallbackID](t.Result),LimeSpot.Channel.Callbacks[t.CallbackID]=null)}},!1));