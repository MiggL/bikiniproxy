SwordCiboodle=this.SwordCiboodle||{};SwordCiboodle.CustomComponents=this.SwordCiboodle.CustomComponents||{};SwordCiboodle.CustomComponents.Autosuggest=function(a,c,b){this.data=c;this.context=b;this.containerID=a;this.fireSns=false;this.firstLoad=true;this.confirmBtnId=function(){var d=a.split("_")[0];return d+"_"+c.confirmButtonName}();this.container=$("#"+a);this.autosuggestInput=null;this.valueChangedEventPath="GT.Runtime.Events.ValueChanged";this.overrideContextFunctions();this.construct();this.setHintText(b.hintText)};SwordCiboodle.CustomComponents.Autosuggest.prototype=new GrahamTechnology.ui.CustomComponent();var proto=SwordCiboodle.CustomComponents.Autosuggest.prototype;SwordCiboodle.CustomComponents.Autosuggest.init=function(a,d,c){if(SwordCiboodle.CustomComponents.Autosuggest){var b=new SwordCiboodle.CustomComponents.Autosuggest(a,d,c);return b}return null};proto.construct=function(){this.autosuggestInput=this.createInput();this.refresh();this.container.append(this.autosuggestInput);this.autosuggestInput.autocomplete({delay:this.data.delay,minLength:this.data.minQueryLength});this.addEventHandlers()};proto.update=function(a){this.data=a;this.refresh()};proto.addEventHandlers=function(){var a=this;this.autosuggestInput.autocomplete({source:function(c,b){$.ajax({type:"get",url:a.data.serverURL,dataType:"jsonp",data:{q:c.term.toLowerCase()},success:function(e){var d=a.solrSuggestionConverter(e);b(d)}})},select:function(b,c){a.handleSelection(c);if(b.which===13){GrahamTechnology.util.tryConfirm(b,a.confirmBtnId)}}});this.autosuggestInput.keypress(function(b){if(b.which===13){a.handleEnterSelection();GrahamTechnology.util.tryConfirm(b,a.confirmBtnId)}});this.autosuggestInput.blur(function(){a.handleEnterSelection()})};proto.setComponentTabIndex=function(a){this.autosuggestInput.attr("tabindex",a++);return a};proto.setHintText=function(a){this.autosuggestInput.attr("title",a)};proto.isValidForRequest=function(){return $.trim(this.autosuggestInput.val()).length>0&&this.autosuggestInput.val()!=this.data.placeHolder};proto.refresh=function(){this.autosuggestInput.val(this.data.query);if(!("placeholder" in this.autosuggestInput[0])){if(this.autosuggestInput.val()==""){this.autosuggestInput.val(this.data.placeHolder)}}};proto.handleSelection=function(b){if(this.isValidForRequest()){var a=b.item;this.data.query=a.value;this.autosuggestInput.autocomplete("close");this.context.updated()}};proto.handleEnterSelection=function(){this.data.query=this.autosuggestInput.val();if(this.data.query==this.data.placeHolder&&!("placeholder" in this.autosuggestInput[0])){this.data.query=""}this.autosuggestInput.autocomplete("close");this.context.updated()};proto.solrSuggestionConverter=function(b){var a=[];for(var c=0;c<b.spellcheck.suggestions.length;c++){if(b.spellcheck.suggestions[c]==="collation"){c++;a.push(b.spellcheck.suggestions[c][1])}}return a};proto.createInput=function(){var c=this;var a=this.data.maxQueryLength;var b=$("<input class='GTTextField searchRounded searchShadow searchTextPosition' type='text' />");if(a){b.attr("maxLength",a)}if("placeholder" in b[0]){b.attr("placeholder",this.data.placeHolder)}else{b.focus(function(){if(b.val()==c.data.placeHolder){b.val("")}}).blur(function(){if(b.val()==""){b.val(c.data.placeHolder)}})}return b};proto.removeEventHandlers=function(){};proto.overrideContextFunctions=function(){var a=this;this.context.destroy=function(){a.destroy()}};proto.destroy=function(){this.autosuggestInput.autocomplete("destroy");this.removeEventHandlers();this.container=null};