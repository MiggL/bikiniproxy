define(["jquery","Mustache","wcs.context"],function(b,f,i){var g,d={},c;var h=function(j){g=j;if(g.response){return}b(".store-results-list").empty();d.formLocation=WCS_CONFIG.get("PDP::pdpInstoreAvailabilityMode");d.altColorsEnabled=WCS_CONFIG.get("PDP::pdpInstoreAltColorEnabled");d.mobileResultsCollapsed=WCS_CONFIG.get("PDP::pdpInstoreMobileResultsCollapsed");a()};function e(j){require(["wcs.find-in-store-alt-colors"],function(k){k.init(j)})}var a=(function(){var k={},m,l,n,j;k.render=function(){if(WCS_CONFIG.get("BOPIS::bopisEnabled")){templateName="text!../html/find-in-store/popupStoreDetailsTemplate_BOPIS.html"}else{templateName="text!../html/find-in-store/popupStoreDetailsTemplate.html"}require([templateName,"wcs.find-in-store-util"],function(p,o){m=f.render(p,g);b(".store-results-list").html(m);o.convertPhoneSpanToATag();k._setSelectedStore();k._showVisibleCount();if(WCS_CONFIG.get("BOPIS::bopisEnabled")||WCS_CONFIG.get("PDP::w2gifilterOOSStores")){k._showStoreCheckBox();k._showChooseStoreButton()}k._initMoreStores();k._attachHandlersToRenderedElements();if(d.altColorsEnabled){e(g)}})};k._initMoreStores=function(){var o=b(".store-results-list").find("section").length;if(o>4){b(".additional-stores-button-js").removeClass("hidden")}};k._setSelectedStore=function(){if(d.mobileResultsCollapsed&&main.screen.size()==="small"){return}b(".find-in-store-accordion").find(".store-result-js").first().addClass("opened")};k._attachHandlersToRenderedElements=function(){b(".accordion_js .store-title_js").on("click",k._sectionTitleClickHandler);b(".additional-stores-button-js").on("click",k._showAdditionalStores);b(".find-the-stock-js").on("click",k._showSection);b(".buttonchooseID").on("click",function(o){k._updateCookieValue.call(this);k._updateYourStoreText.call(this);o.stopPropagation()})};k._updateCookieValue=function(){var o=WCS_CONFIG.get("BOPIS::bopisFavStore")+i.getStoreId();i.setCookie(o,this.attributes[1].nodeValue);i.setCookie("STORE_ZIP_VALUE",this.attributes[2].nodeValue)};k._updateYourStoreText=function(){var p=b(this).attr("data-retail-store-number");var o=LANG_FIND_IN_STORE.RETAIL_STORE_INVENTORY_YOUR_STORE;b(".bopis-your-store").html("");b(".buttonchooseID").removeClass("hide");b("span[data-retail-store-number="+p+"]").html(o);b("label[data-retail-store-number="+p+"]").addClass("hide")};k._showSection=function(){var p=WCS_CONFIG.get("PDP::pdpInstoreFilterShowInstockOnly");var o=document.getElementsByClassName("store-result-js");if(b(this).is(":checked")){b(".store-result-js").each(function(s){var r=(b(this).data("availability-state"))?b(this).data("availability-state"):"OUT_OF_STOCK";var q=["OUT_OF_STOCK","OTHER_COLORS_AVAILABLE"].indexOf(r)!==-1||(p&&r==="IN_STOCK_IN_DC");if(q){b(this).addClass("hide")}else{b(this).removeClass("hide")}})}else{b(".store-result-js").removeClass("hide")}};k._showChooseStoreButton=function(){var r=document.getElementsByClassName("fav-store");var q=document.getElementsByClassName("store-result-js");var t=LANG_FIND_IN_STORE.RETAIL_STORE_INVENTORY_STORE_CHOOSE_BUTTON;var s=LANG_FIND_IN_STORE.RETAIL_STORE_INVENTORY_OUT_OF_STOCK;var o=LANG_FIND_IN_STORE.RETAIL_STORE_INVENTORY_YOUR_STORE;var p=b(".append-value-js");b(".buttonchooseID").each(function(u){if((q[u].innerText.indexOf(s)>=0)){b(this).addClass("out-of-stock")}else{if(p[u].innerText===o){b(this).addClass("hide")}}})};k._showStoreCheckBox=function(){b(".store-availability-filter").removeClass("hide");if(WCS_CONFIG.get("PDP::w2gifilterOOSStores")){b(".store-availability-filter, .bopis-filter").removeClass("hidden")}};k._sectionTitleClickHandler=function(p){var q=b(p.target),o=q.closest("section");if(!o.hasClass("opened")){o.addClass("opened")}else{o.removeClass("opened")}};k._showAdditionalStores=function(o){l=b(".store-result-js.initial");n=b(".store-result-js.hidden");if(b(".additional-stores-button-js").hasClass("show-more")){n.addClass("additional-visible").removeClass("hidden");b(".additional-stores-button-js").removeClass("show-more").addClass("show-less").html(LANG_FIND_IN_STORE.RETAIL_STORE_MORE_BUTTON_TEXT_EXPANDED+'<span class="icon"></span>');k._showVisibleCount()}else{if(b(".additional-stores-button-js").hasClass("show-less")){b(".additional-stores-button-js").removeClass("show-more").addClass("show-less").html(LANG_FIND_IN_STORE.RETAIL_STORE_MORE_BUTTON_TEXT_EXPANDED+'<span class="icon"></span>');b(".store-result-js.additional-visible").addClass("hidden").removeClass("opened");b(".additional-stores-button-js").removeClass("show-less").addClass("show-more").html(LANG_FIND_IN_STORE.RETAIL_STORE_MORE_BUTTON_TEXT_COLLAPSED+'<span class="icon"></span>');k._showVisibleCount()}}};k._showVisibleCount=function(){j=b(".store-result-js").not(".hidden").length;b(".num-visible-js").html(j)};return k.render}());return{renderData:h}});