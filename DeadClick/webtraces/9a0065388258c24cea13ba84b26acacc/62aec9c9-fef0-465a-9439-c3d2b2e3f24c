define(["jquery","domReady","pubsub"],function(c,b){var a=false;var d=function(f){if(!(this instanceof d)){return new d(f)}this.$contextContainer=c(f);var e=this.$contextContainer.find(".context-trigger-js.active-context-js").first();if(e){this._currentProductId=e.data("productId");this._currentPartNumber=e.data("partNumber")}if(this._currentProductId){this._manageTriggers();this._attachListeners()}return this};d.prototype={_manageTriggers:function(){if(a){console.log("_manageTriggers")}var e=this;this.$contextContainer.find(".context-trigger-js").each(function(){if(c(this).data("productId")!=e._currentProductId){c(this).removeClass("active-context-js")}else{if(!c(this).hasClass("active-context-js")){c(this).addClass("active-context-js")}}})},_attachListeners:function(){if(a){console.log("_attachListeners")}this.$contextContainer.on("click",{self:this},this._handleContextChange)},_handleContextChange:function(g,f){if(a){console.log("_handleContextChange")}f=f||g.data.self;if(!c(g.target).hasClass("context-trigger-js")){return}if(g.origCaller&&"click"!=g.origCaller){return}var e=c(g.target).data("productId");if(!e||(e==f._currentProductId)){return}f._currentProductId=e;f._currentPartNumber=c(g.target).data("partNumber");f._manageTriggers();f._toggleComponents();f._setProductIdData();f.$contextContainer.trigger("PRODUCT_CONTEXT_CHANGED");var i=c(".product-form-js").index(this.productForm);var h={productFormIndex:i};c.pubsub("publish","product-form.attr.context.changed",h)},_toggleComponents:function(){if(a){console.log("_toggleComponents")}var e=this;this.$contextContainer.find(".context-toggle-js").each(function(){if(c(this).is("h1")){return}if(c(this).data("productId")==e._currentProductId){c(this).removeClass("hide");c(this).find("input, select").prop("disabled",false);c(this).find(".color-swatches-js .selected").click()}else{if(!c(this).hasClass("hide")){c(this).addClass("hide");c(this).find("input, select").prop("disabled",true)}}})},_setProductIdData:function(){if(a){console.log("_setProductIdData")}c(this).data("productId",this._currentProductId);this.$contextContainer.find(".context-data-js").data("productId",this._currentProductId)}};b(function(){c(".product-context-js").each(function(){var e=c(this).data("productContext");if(!e){e=new d(c(this));c(this).data("productContext",e)}});c(document).on("QUICKSHOP_DISPLAY",function(){c(".product-context-js").each(function(){if(!c(this).data("productContext")){c(this).data("productContext",new d(c(this)))}})})})});