define(["jquery","pubsub","wcs.context"],function(e,d,a){var c="topbarSmallCart";var b=function(g,f){this.element=g;this.options=f;this.metadata=e(this.element).data("topbar-smallcart-options")};b.prototype={defaults:{quantitySelector:".cart-items-count",classHasProducts:"has-products"},init:function(){var f=this;f.config=e.extend({},f.defaults,f.options,f.metadata);f.findElements();f._build();f.events();return f.update()},_build:function(){var f=this},events:function(){var f=this;e.pubsub("subscribe","SHOPCART_UPDATED",function(g,h){f.update()})},update:function(){var f=this;return f.updateDisplay(f.getCount())},getCount:function(){var f=Number(a.getShoppingCart().quantity);return(isNaN(f))?0:f},updateDisplay:function(g){var f=this;f.$count.text(g);if(g>0){e(f.element).addClass(f.config.classHasProducts)}else{e(f.element).removeClass(f.config.classHasProducts)}return f},findElements:function(){var f=this;f.$element=e(f.element);f.$count=e(f.config.quantitySelector,f.$element)}};b.defaults=b.prototype.defaults;e.fn.topbarSmallCart=function(f){return this.each(function(){var g=e(this).data(c);if(!g){g=new b(this,f).init();e(this).data(c,g)}})}});