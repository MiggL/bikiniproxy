timely.require(["jquery_timely","ai1ec_config","domReady","libs/utils","libs/captcha","libs/select2_multiselect_helper","libs/collapse_helper","external_libs/Placeholders","external_libs/bootstrap/modal"],function(e,t,n,r,i,s){var o=e(".ai1ec-submit-ics-form"),u=e("#ai1ec-submit-ics-modal .ai1ec-loading"),a=function(){i.init_captcha(o),s.init(o)},f=function(){i.init_captcha(o)},l=function(n){n.preventDefault(),e(".ai1ec-alerts",o).html("");var s=e("#ai1ec_calendar_url",o).val(),a=e("#ai1ec_submitter_email",o).val(),f=i.check_field();if(""===s||""===a||!f){var l=t.mail_url_required;f||(l+=" "+t.captcha_required_phrase);var c=r.make_alert(l,"error",!0);e(".ai1ec-alerts",o).append(c)}else{if(!r.isUrl(s)){var c=r.make_alert(t.invalid_url_message,"error",!0);e(".ai1ec-alerts",o).append(c),e("#ai1ec_calendar_url",o).focus();return}if(!r.isValidEmail(a)){var c=r.make_alert(t.invalid_email_message,"error",!0);e(".ai1ec-alerts",o).append(c),e("#ai1ec_submitter_email",o).focus();return}var h=o.serialize();u.addClass("ai1ec-show"),e.ajax({data:h+"&action=ai1ec_add_ics_frontend",type:"POST",dataType:"json",url:t.ajax_url,success:function(t){u.removeClass("ai1ec-show"),i.reload(o);var n=t.success?"success":"error",s=r.make_alert(t.message,n,!0);e(".ai1ec-alerts",o).append(s),e(".ai1ec-nonce-fields",o).html(t.nonce),"success"===n&&(e("#ai1ec_calendar_url, #ai1ec_submitter_email",o).val(""),e("#ai1ec_categories",o).select2("val",""))}})}},c=function(){e("#ai1ec-info-pane").collapse("toggle")},h=function(){var t=e("#ai1ec-submit-ics-modal");t.appendTo("body"),t.modal({show:!1}).one("show.bs.modal",function(){a()}).on("show.bs.modal",function(){i.init_captcha(o)}).on("hide.bs.modal",function(){e(".ai1ec-modal-backdrop").remove(),i.destroy(this)}),t.on("show hidden",".ai1ec-collapse",function(e){e.stopPropagation()})},p=function(){e(document).on("submit",".ai1ec-submit-ics-form",l).on("hide.bs.collapse show.bs.collapse","#ai1ec-submission-pane",c).on("initialize_view.ai1ec",function(){e('[id="ai1ec-submit-ics-modal"]').not(":last").remove()})};n(function(){h(),a(),p()})}),timely.define("pages/submit_ics_modal",function(){});