timely.define("libs/timepicker_helper",["jquery_timely","external_libs/moment","external_libs/bootstrap_timepicker"],function(e,t,n){var r=function(){var n=e(this);if(typeof n.data("timepicker")=="undefined"){if(n.val()===""){var r=t().local(),i=n.data("showMeridian")?"hh:mm A":"HH:mm";n.val(r.format(i))}n.timepicker({showMeridian:n.data("showMeridian"),showInputs:!1,defaultTime:n.val()}).on("show.timepicker",function(){n.parents(".ai1ec-collapse").addClass("ai1ec-timepicker-visible")}).on("hide.timepicker",function(){n.parents(".ai1ec-collapse").removeClass("ai1ec-timepicker-visible")});var s=n.data("timepicker").$widget;s.addClass("timely")}},i=function(t){typeof t=="undefined"&&(t=e(document)),t.on("focus",".ai1ec-timepicker",r)};return{init:i}}),timely.require(["jquery_timely","scripts/add_new_event/event_location/gmaps_helper","libs/select2_multiselect_helper","libs/tags_select","libs/timepicker_helper","ai1ec_config","domReady","libs/utils","external_libs/moment","libs/captcha","external_libs/Placeholders","external_libs/bootstrap/collapse","external_libs/bootstrap/alert","external_libs/bootstrap_datepicker","external_libs/bootstrap_fileupload","external_libs/jquery.scrollTo","external_libs/bootstrap/modal"],function(e,t,n,r,i,s,o,u,a,f){var l,c,h,p,d=function(){p=e('[id="ai1ec-create-event-modal"]'),p.appendTo("body"),p.modal({show:!1}).one("show.bs.modal",function(){e(".ai1ec-ajax-placeholder",this).load(s.ajax_url+"?action=ai1ec_front_end_create_event_form",function(){e(".ai1ec-loading",p).removeClass("ai1ec-show"),l=e(".ai1ec-create-event-form"),c=l.parent(),h=c.siblings(".ai1ec-loading"),v(),T()})}).on("show.bs.modal",function(){typeof l!="undefined"&&f.reload(l)}).on("hidden.bs.modal",function(t){e(".ai1ec-modal-backdrop").remove(),f.destroy(l)}),p.on("show hidden",".ai1ec-collapse",function(e){e.stopPropagation()}),e(document).on("initialize_view.ai1ec",function(){e('[id="ai1ec-create-event-modal"]').not(":last").remove()})},v=function(){s.disable_autocompletion||timely.require(["libs/gmaps"],function(e){e(t.init_gmaps)}),e("#open_require_disclaimer").on("click",function(t){e("#require_disclaimer").is(":checked")&&(t.preventDefault(),t.stopImmediatePropagation(),e("#show_disclaimer").hasClass("ai1ec-in")?e("#show_disclaimer").collapse("hide"):e("#show_disclaimer").collapse("show"))}),e(".ai1ec-datepicker",l).datepicker({autoclose:!0,todayHighlight:!0}).each(function(){e(this).data("datepicker").picker.wrapAll('<div class="timely">')}),i.init(l),n.init(l),r.init(l),e("#ai1ec_timezone_name").select2(),f.init_captcha(l),e(".ai1ec-alert",l).alert(),window.setTimeout(function(){e(':input[type!="hidden"]:first',l).focus()},350)},m=function(){f.reload(l),e(".ai1ec-modal-body",l).scrollTo(".ai1ec-alert:first",1e3)},g=function(){this.checked?(e("#ai1ec-end-time-input-wrap",l).collapse("hide"),e("#ai1ec-has-end-time ~ .ai1ec-without-time",l).show(),e("#ai1ec-has-end-time ~ .ai1ec-with-time",l).hide()):(e("#ai1ec-end-time-input-wrap",l).collapse("show"),e("#ai1ec-has-end-time ~ .ai1ec-without-time",l).hide(),e("#ai1ec-has-end-time ~ .ai1ec-with-time",l).show()),w()},y=function(){var t=!0,n=e("#ai1ec-has-end-time",l).is(":checked"),r=e("#ai1ec-all-day",l).is(":checked"),i=e("#ai1ec-start-time-input",l).val(),o=e("#require_disclaimer"),a=e("#ai1ec-event-title, #ai1ec-start-date-input, .ai1ec-required",l);return a=a.add("[required=true]",l),n&&(a=a.add("#ai1ec-end-date-input",l)),e(".ai1ec-alert-danger",l).addClass("ai1ec-hide"),o.length>0&&!o.is(":checked")&&(t=!1,e(".ai1ec-required-disclaimer",l).removeClass("ai1ec-hide")),!r&&!i&&(a=a.add("#ai1ec-start-time-input",l)),!0===e("#ai1ec_submitter_organizer",l).is(":checked")&&(e("#ai1ec_submitter_email",l).val(e.trim(e("#ai1ec_contact_email",l).val())),e("#ai1ec_submitter_name",l).val(e.trim(e("#ai1ec_contact_name",l).val()))),a.each(function(){var n=e(this),r=n.val();if(""===r||n.attr("placeholder")===r)return t=!1,e(".ai1ec-missing-field",l).find("em").text(n.attr("placeholder")).end().removeClass("ai1ec-hide"),n.hasClass("ai1ec_submitter_fields")&&($checkbox=e("#ai1ec_submitter_organizer",l),!0===$checkbox.is(":checked")&&$checkbox.trigger("click")),n.focus(),!1}),t&&e("#ai1ec_contact_url, #ai1ec_ticket_url",l).each(function(){$url_field=e(this);var n=e.trim($url_field.val());if(""!==n){var r="ai1ec_ticket_url"===$url_field.attr("id");if(!1===u.isValidUrl(n,r))return t=!1,e(".ai1ec-submit-error",l).text(s.invalid_website_message).removeClass("ai1ec-hide"),$url_field.focus(),!1}}),t&&e("#ai1ec_contact_email, #ai1ec_submitter_email",l).each(function(){$email_field=e(this);var n=e.trim($email_field.val());if(""!==n&&!1===u.isValidEmail(n))return t=!1,e(".ai1ec-submit-error",l).text(s.invalid_email_message).removeClass("ai1ec-hide"),$email_field.focus(),!1}),t&&!f.check_field()&&(e(".ai1ec-missing-field",l).find("em").text(s.captcha_required).end().removeClass("ai1ec-hide"),t=!1),t},b=function(){var t=e("#ai1ec-start-date-input",l),n=e("#ai1ec-end-date-input",l),r=e("#ai1ec-start-time-input",l),i=e("#ai1ec-end-time-input",l),s=!e("#ai1ec-all-day",l)[0].checked,o=t.val(),u=r.val(),f=n.val(),c=i.val(),h="",p="",d,v,m,g=l.data("ai1ecStartTime"),y=l.data("ai1ecEndTime"),b=!1;typeof g=="undefined"&&(g=""),typeof y=="undefined"&&(y=""),d=t.data("dateFormat").toUpperCase(),r.data("showMeridian")?v="hh:mm A":v="HH:mm",m=d+" "+v,o!==""&&(s&&u!==""?h=a(o+" "+u,m):h=a(o,d),h=h.unix()),h===""||g!==""&&parseInt(g,10)===h?f!==""&&(s&&c!==""?p=a(f+" "+c,m):p=a(f,d),p=p.unix(),p<h&&(p=h,b=!0)):(g===""?g=h:g=parseInt(g,10),y===""?y=g:y=parseInt(y,10),p=h+y-g,b=!0);if(b){var w=a.unix(p);n.val(w.format(d)).datepicker("update").datepicker("setStartDate",o),s&&u!==""&&i.val(w.format(v))}l.data("ai1ecStartTime",h),l.data("ai1ecEndTime",p)},w=function(){var t=!e("#ai1ec-all-day",l)[0].checked,n=e("#ai1ec-has-end-time",l)[0].checked;e("#ai1ec-start-time-input",l).attr("disabled",!t),e("#ai1ec-end-date-input",l).attr("disabled",!n),e("#ai1ec-end-time-input",l).attr("disabled",!t||!n),b()},E=function(t,n){t.preventDefault();if(!y()&&!n){m();return}if(s.stripe_key&&!n){p.trigger("stripe-payment");return}var r=l.data("ai1ecStartTime"),i=l.data("ai1ecEndTime"),o=!e("#ai1ec-all-day",l)[0].checked&&e("#ai1ec-start-time-input",l).val()!=="",u=e("#ai1ec-has-end-time",l)[0].checked;o?u||(i=""):(u||(i=r),i=a.unix(i).add("d",1).unix(),u=!0),r=a(r*1e3).format("YYYY-MM-DD H:mm:ss"),i=a(i*1e3).format("YYYY-MM-DD H:mm:ss"),e("#ai1ec-start-time",l).val(r),e("#ai1ec-end-time",l).val(i),e("#ai1ec-all-day-event",l).val(o?"":"1"),e("#ai1ec-instant-event",l).val(u?"":"1"),!0===e("#ai1ec_submitter_organizer",l).is(":checked")?e("#ai1ec_submitter_as_organizer",l).val("1"):e("#ai1ec_submitter_as_organizer",l).val("0"),h.addClass("ai1ec-show");var f={url:l.attr("action"),type:"POST",data:new FormData(l.get(0)),processData:!1,contentType:!1};e.ajax(f).done(function(t,n,r){t.error?(e(".ai1ec-submit-error",l).text(t.message).removeClass("ai1ec-hide"),m()):c.html(t.html)}).fail(function(t,n,r){var i=s.frontend_ajax_error+r;e(".ai1ec-submit-error",l).text(i).removeClass("ai1ec-hide"),m()}).always(function(){h.removeClass("ai1ec-show")})},S=function(t){t.preventDefault(),h.addClass("ai1ec-show"),c.load(s.ajax_url+"?action=ai1ec_front_end_create_event_form",function(){l=e(".ai1ec-create-event-form",c),f.destroy(),v(),h.removeClass("ai1ec-show")})},x=function(t){var n=s.label_buy_tickets_url;this.checked&&(n=s.label_rsvp_url),e("#ai1ec_ticket_url",l).attr("placeholder",n)},T=function(){c.on("click","#ai1ec-all-day",g),c.on("change","#ai1ec_is_free",x),c.on("click","#ai1ec-has-end-time",w),c.on("changeDate",".ai1ec-datepicker",function(){b(),e("#ai1ec-all-day, #ai1ec-has-end-time",l).removeAttr("disabled")}),c.on("change",".ai1ec-timepicker",b),c.on("keyup","#ai1ec_address",function(){var t=e("#ai1ec-google-map",l);this.value===""?(t[0].checked&&t.click(),t.attr("disabled","disabled")):t.removeAttr("disabled")}),c.on("click eventpromote-submit",".ai1ec-submit",E),c.on("click",".ai1ec-post-another",S)};o(function(){d()});var N=function(){f.init_captcha(l)}}),timely.define("pages/front_end_create_event_form",function(){});