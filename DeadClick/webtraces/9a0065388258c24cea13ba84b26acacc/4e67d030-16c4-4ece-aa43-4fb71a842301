/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.event");if(!b.event.InputController2){b.event.InputController2=function c(x,t){this.fixEvent=function(B){if(!B){B=window.event}var A=null;if(B.target){A=(B.target.nodeType==3)?B.target.parentNode:B.target}else{A=B.srcElement}B.targetNode=A;if(window.MouseEvent&&B instanceof MouseEvent){B.pointerType="mouse";B.pointerId=0}else{if(window.TouchEvent&&B instanceof TouchEvent){B.pointerType="touch";B.pointerId=0}else{B.pointerType="";B.pointerId=0}}if(!B.touches){B.touches=[{pageX:B.pageX||B.clientX+(document&&document.scrollLeft||document.body&&document.body.scrollLeft||0)-(document&&document.clientLeft||document.body&&document.body.clientLeft||0),pageY:B.pageY||B.clientY+(document&&document.scrollTop||document.body&&document.body.scrollTop||0)-(document&&document.clientTop||document.body&&document.body.clientTop||0)}]}if(!B.preventDefault){B.preventDefault=function(){B.returnValue=false}}if(!B.stopPropagation){B.stopPropagation=function(){B.cancelBubble=true}}return B};var i=0;var z=64;var g=30;var p=50;var j=300;var o=0;var s=null;var f=0;var v;var u;var q=false;var w=false;var l=false;var n=false;var y=false;var m={};var e=null;var k=250;var d={};var r=false;this.params=t||{};this.singleTapCallback=this.params.singleTapCallback||null;this.doubleTapCallback=this.params.doubleTapCallback||null;this.swipeCallback=this.params.swipeCallback||null;this.startTouchCallback=this.params.startTouchCallback||null;this.dragCallback=this.params.dragCallback||null;this.endDragCallback=this.params.endDragCallback||null;this.pinchCallback=this.params.pinchCallback||null;this.endPinchCallback=this.params.endPinchCallback||null;this.endTouchCallback=this.params.endTouchCallback||null;this.elem=x||null;var h=this;this.touchStart=function(A){h.fixEvent(A);if((b.browser.name==="ie")&&(b.browser.version.major>=9)){h.stop(h.elem);A.preventDefault()}i=A.targetTouches?A.targetTouches.length:A.touches.length;h.start(h.elem);q=true;w=true;l=false;if(i==1){f=new Date().getTime();v=m.startX=m.curX=A.touches[0].pageX;u=m.startY=m.curY=A.touches[0].pageY;m.last=m.start=f;if(h.startTouchCallback){h.startTouchCallback(A,m.startX,m.startY)}}else{r=true;A.preventDefault();h.touchCancel(A);d.scale=null;d.X=null;d.Y=null;d.start=new Date().getTime();d.initialSize=Math.sqrt(Math.pow(A.touches[0].pageX-A.touches[1].pageX,2)+Math.pow(A.touches[0].pageY-A.touches[1].pageY,2))}};this.touchMove=function(D){if(!w){return}h.fixEvent(D);m.move=new Date().getTime();l=true;n=true;if(D.touches.length==1){m.curX=D.touches[0].pageX;m.curY=D.touches[0].pageY;if((h.dragCallback)&&m.last){var B=m.curX-v;var A=m.curY-u;if(B!=0||A!=0){h.dragCallback(D,m.curX,m.curY,B,A)}}v=D.touches[0].pageX;u=D.touches[0].pageY}else{if((D.touches.length>1)&&r){D.preventDefault();h.touchCancel(D);if((new Date().getTime()-d.start)<g){return false}d.X=(D.touches[0].pageX+D.touches[1].pageX)/2;d.Y=(D.touches[0].pageY+D.touches[1].pageY)/2;d.changeSize=Math.sqrt(Math.pow(D.touches[0].pageX-D.touches[1].pageX,2)+Math.pow(D.touches[0].pageY-D.touches[1].pageY,2));d.pinchScale=d.changeSize/d.initialSize;if(d.pinchScale>1){var E=Math.pow(2,(d.pinchScale-1)/2);d.pinchScale=1/E}else{var C=1/(d.pinchScale);d.pinchScale=Math.pow(2,(C-1)/2)}if((h.pinchCallback)&&(d.pinchScale!=1)){h.pinchCallback(D,d.X,d.Y,d.pinchScale)}d.initialSize=d.changeSize}}};this.touchEndCapture=function(E){if(l){h.fixEvent(E);m.end=new Date().getTime();n=false;if(i==1){if(h.endTouchCallback){h.endTouchCallback(E,m.curX,m.curY)}o=Math.round(Math.sqrt(Math.pow(m.curX-m.startX,2)+Math.pow(m.curY-m.startY,2)));if((o>=z)&&(m.curX!=0)&&(((m.end-m.start)>p)&&((m.end-m.start)<j))){E.preventDefault();var D=m.curX-m.startX;var C=m.curY-m.startY;if((Math.abs(D)>=z)&&(Math.abs(D)>Math.abs(C))){if(D<0){s="left"}else{s="right"}}else{if(Math.abs(C)>=z){if(C<0){s="down"}else{s="up"}}}if(h.swipeCallback){h.swipeCallback(s)}y=true;h.touchCancel(E)}else{if((o>0)&&(m.curX!=0)){y=false;if(h.endDragCallback){var B=m.curX-m.startX;var A=m.curY-m.startY;h.endDragCallback(E,m.curX,m.curY,B,A)}h.touchCancel(E)}}}else{h.touchCancel(E);if(h.endPinchCallback){h.endPinchCallback(E,d.X,d.Y,d.pinchScale)}}}w=false;r=false};this.touchEnddblclick=function(A){q=true;l=false;h.touchEnd(A)};this.touchEnd=function(D){if(!(q&&!l)){q=false;return}q=false;h.fixEvent(D);m.end=new Date().getTime();n=false;m.isDoubleTap=false;if(i==1){o=Math.round(Math.sqrt(Math.pow(m.curX-m.startX,2)+Math.pow(m.curY-m.startY,2)));if((o>=z)&&(m.curX!=0)&&(((m.end-m.start)>p)&&((m.end-m.start)<j))){}else{if((o>0)&&(m.curX!=0)){}else{y=false;var B=false;D.preventDefault();if(e){clearTimeout(e);e=null;if(h.doubleTapCallback){h.doubleTapCallback(D,m.curX,m.curY)}m={};B=true}else{if(("last" in m)&&(o<z)&&!n){B=true;var A={};for(var C in D){A[C]=D[C]}e=setTimeout(function(){if(h.singleTapCallback){h.singleTapCallback(A,m.curX,m.curY)}if(e){clearTimeout(e);e=null}m={}},k)}}if(!B){h.touchCancel(D)}}}}h.stop(h.elem)};this.touchCancel=function(A){q=false;if(e){clearTimeout(e)}e=null;i=0;o=0;s=null;m={};n=false};if(this.elem){this.attach(this.elem)}return this};b.event.InputController2.prototype.attach=function(d){this.elem=d;if(this.elem){b.Event.addDOMListener(this.elem,"touchstart",this.touchStart,false);b.Event.addDOMListener(this.elem,"mousedown",this.touchStart,false);b.Event.addDOMListener(this.elem,"dblclick",this.touchEnddblclick,false)}};b.event.InputController2.prototype.detach=function(d){this.elem=d;if(this.elem){b.Event.removeDOMListener(this.elem,"touchstart",this.touchStart,false);b.Event.removeDOMListener(this.elem,"mousedown",this.touchStart,false);b.Event.removeDOMListener(this.elem,"dblclick",this.touchEnddblclick,false)}this.singleTapCallback=null;this.doubleTapCallback=null;this.swipeCallback=null;this.startTouchCallback=null;this.dragCallback=null;this.endDragCallback=null;this.pinchCallback=null;this.endPinchCallback=null;this.endTouchCallback=null;this.elem=null};b.event.InputController2.prototype.start=function(d){this.elem=d;if(this.elem){var e=b.browser.name=="ie"?document:window;b.Event.addDOMListener(e,"touchmove",this.touchMove,false);b.Event.addDOMListener(e,"touchend",this.touchEndCapture,true);b.Event.addDOMListener(e,"touchend",this.touchEnd,false);b.Event.addDOMListener(e,"touchcancel",this.touchCancel,false);b.Event.addDOMListener(e,"mousemove",this.touchMove,false);b.Event.addDOMListener(e,"mouseup",this.touchEndCapture,true);b.Event.addDOMListener(e,"mouseup",this.touchEnd,false)}};b.event.InputController2.prototype.stop=function(d){this.elem=d;if(this.elem){var e=b.browser.name=="ie"?document:window;b.Event.removeDOMListener(e,"touchmove",this.touchMove,false);b.Event.removeDOMListener(e,"touchend",this.touchEndCapture,true);b.Event.removeDOMListener(e,"touchend",this.touchEnd,false);b.Event.removeDOMListener(e,"touchcancel",this.touchCancel,false);b.Event.removeDOMListener(e,"mousemove",this.touchMove,false);b.Event.removeDOMListener(e,"mouseup",this.touchEndCapture,true);b.Event.removeDOMListener(e,"mouseup",this.touchEnd,false)}}}if(!b.event.SwipeController){b.event.SwipeController=function a(d,f,g,e){this.inDrag=false;this.wid=f;this.hei=g;this.swipeEnable=e;this.absoluteX=0;this.absoluteY=0;this.maxStep=300;this.transitionTime=typeof(d)=="undefined"?5000:d*1000;this.transitionEasing=typeof(transitionEasing)=="undefined"?b.Enum.TRANSITION_EASING.AUTO:transitionEasing;this.shift=0;this.shiftTime=0;this.inTransition=false;this.leftEdge=false;this.rightEdge=false;this.diffRelX=0;return this};b.event.SwipeController.prototype.resize=function(d,e){this.wid=d;this.hei=e};b.event.SwipeController.prototype.processDrag=function(i,f,d){if(this.inTransition){return}this.inDrag=true;this.absoluteX+=f;this.absoluteY+=d;var g=this.absoluteX/this.wid;if(Math.abs(g)>1){g=g>0?1:-1;this.absoluteX=this.wid*g}var h=(this.leftEdge&&g>0)||(this.rightEdge&&g<0);this.diffRelX=h?0:g;this.onStep(this.diffRelX);if(this.diffRelX==0){this.absoluteX=0}if(h){return}};b.event.SwipeController.prototype.processEndDrag=function(j,h,f,g,d){if(!this.inDrag||this.inTransition){return}this.inDrag=false;var k=0.5;var i=this.diffRelX>0;this.reverse=Math.abs(this.diffRelX)<k;this.direction=(this.reverse?!i:i)?1:-1;this.shift=Math.abs(this.diffRelX);if(this.reverse){this.shift=1-this.shift}this.animationStartInt()};b.event.SwipeController.prototype.processSwipe=function(e){if(e=="right"||e=="left"){if(this.inTransition){return}this.inDrag=true;var d=(this.leftEdge&&this.diffRelX>=0)||(this.rightEdge&&this.diffRelX<=0);if(!d){this.direction=e=="right"?1:-1;this.shift=Math.abs(this.diffRelX);this.reverse=false;this.animationStartInt()}else{this.inDrag=false}}else{if(this.diffRelX!=0){this.processEndDrag()}}};b.event.SwipeController.prototype.setSwipeCapability=function(e,d){this.leftEdge=e;this.rightEdge=d};b.event.SwipeController.prototype.isAnimationInProgress=function(){return this.inTransition};b.event.SwipeController.prototype.animationStartInt=function(){var d=new Date();this.shiftTime=0;this.startTime=d.getTime();this.prevStep=0;if(!this.inTransition){this.timerAnimationStartInt=b.Util.timeout(b.event.SwipeController.transitionHandler,25,[this])}this.inTransition=true;this.onStart()};b.event.SwipeController.prototype.animate=function(d){if(this.inDrag&&this.swipeEnable){this.processSwipe(d)}else{this._animate(d=="left"?1:-1)}};b.event.SwipeController.prototype._animate=function(e){var d=new Date();this.shiftTime=0;this.startTime=d.getTime();this.prevStep=0;this.direction=e;this.shift=0;this.reverse=false;this.timer_animate=b.Util.timeout(b.event.SwipeController.transitionHandler,25,[this]);this.inTransition=true;this.onStart()};b.event.SwipeController.prototype.onEnterFrame=function(){if(!this.inTransition){return}var e=new Date();var f=e.getTime();var d=this.calcStep(f);if(this.shift!=0){while(d<this.shift){d=this.calcStep(f);this.shiftTime++;if(d==0){return true}if(d>=1){this.animationStop();return false}}this.shift=0}if(d==0){return true}if(d>=1){this.animationStop();return false}this.stepSize=d;this.onStep(this.direction*(this.reverse?this.stepSize-1:this.stepSize));return true};b.event.SwipeController.prototype.calcStep=function(e){var d=(this.transitionTime!=0)?(e+this.shiftTime-this.startTime)/this.transitionTime:1;if(d>this.prevStep+this.maxStep){d=this.prevStep+this.maxStep}this.prevStep=d;if(d==0){return d}if(d>=1){return d}if(this.transitionEasing==b.Enum.TRANSITION_EASING.AUTO){if(this.elasticZoom>0){if(this.transitionTime>=1500){d=(d*(d-2))*-1}else{if(this.transitionTime>1000){d=(d-=1)*d*d+1}else{if(this.transitionTime>500){d=((d-=1)*d*d*d-1)*-1}else{d=(d-=1)*d*d*d*d+1}}}}}else{if(this.transitionEasing==b.Enum.TRANSITION_EASING.QUADRATIC){d=(d*(d-2))*-1}else{if(this.transitionEasing==b.Enum.TRANSITION_EASING.CUBIC){d=(d-=1)*d*d+1}else{if(this.transitionEasing==b.Enum.TRANSITION_EASING.QUARTIC){d=((d-=1)*d*d*d-1)*-1}else{if(this.transitionEasing==b.Enum.TRANSITION_EASING.QUINTIC){d=(d-=1)*d*d*d*d+1}}}}}this.prevStep=d;return d};b.event.SwipeController.transitionHandler=function(d){var e=false;e=d.onEnterFrame();if(e){this.timerTransitionHandler=b.Util.timeout(b.event.SwipeController.transitionHandler,25,[d])}};b.event.SwipeController.prototype.animationStop=function(){this.inTransition=false;if(!this.reverse){this.onStop(this.direction)}else{this.onStep(0);this.onStop(0)}this.absoluteX=0;this.absoluteY=0;this.step=0;this.inDrag=false};b.event.SwipeController.prototype.dispose=function(){if(this.timerAnimationStartInt){clearTimeout(this.timerAnimationStartInt);this.timerAnimationStartInt=null}if(this.timer_animate){clearTimeout(this.timer_animate);this.timer_animate=null}if(this.timerTransitionHandler){clearTimeout(this.timerTransitionHandler);this.timerTransitionHandler=null}}}})(s7getCurrentNameSpace());