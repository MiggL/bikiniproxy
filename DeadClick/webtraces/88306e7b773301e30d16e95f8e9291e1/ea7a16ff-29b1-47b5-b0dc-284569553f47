window.DowJones = window.DowJones || {};window.DowJones.LivefyreAuth = {token: "",delegate: { login: function(cb) { cb(null, { livefyre: window.DowJones.LivefyreAuth.token }); }, viewProfile: function(u) { if(u.hasOwnProperty("profileUrl") && u.profileUrl !== null && u.profileUrl !== "") { window.open(u.profileUrl); } else { _Log("profile url is null or empty", u); } }, logout: function(cb) { cb(null); } }};window.DowJones.LivefyreCommentStream = function() {var _commentCount = 0,_status = { isInitialized: false, isReady: false },_checkStatusTimeout = null,_checkStatusTime = 15000,_lfLoadedCheckInterval = null,_checkLoadedCalled = null,_checksum = null,_$el = $("#article-comments"),_userAuthorId = "",_name = "",_config = { StreamOptions: MarketWatch.Livefyre.Config.StreamOptions || {}, LoadOptions: MarketWatch.Livefyre.Config.LoadOptions || {} };function _Log(message, data) {if (typeof console !== "undefined") {if (typeof data !== "undefined") {console.log(message, data);} else {console.log(message);}}}_Log("Loading Livefyre");function _CheckStatus(of) {_Log("CheckStatus of: " + of);if (!_status[of]) {_$el.prev(".livefyre-loading").remove();_events.Fail("initializing livefyre");}clearTimeout(_checkStatusTimeout);}var configErrors = "";if (!MarketWatch.Livefyre.Config.hasOwnProperty("LoginHandler")) {configErrors += "- LoginHandler\n";}if (!MarketWatch.Livefyre.Config.hasOwnProperty("FailHandler")) {configErrors += "- FailHandler\n";}if (!MarketWatch.Livefyre.Config.hasOwnProperty("MissingNameHandler")) {configErrors += "- MissingNameHandler\n";}if (!MarketWatch.Livefyre.Config.hasOwnProperty("SuspendedUserHandler")) {configErrors += "- SuspendedUserHandler\n";}if (!MarketWatch.Livefyre.Config.hasOwnProperty("FirstTimeCommenterHandler")) {configErrors += "- FirstTimeCommenterHandler\n";}if (!MarketWatch.Livefyre.Config.hasOwnProperty("ExpoPath")) {configErrors += "- ExpoPath\n";}if (configErrors.length > 0) {alert("The following properties/functions are missing from the MarketWatch.Livefyre.Config object:\n\n" + configErrors);return false;}var _events = {CommentCountUpdated: function(count) {_Log("CommentCountUpdated", count);_commentCount = count;try {MarketWatch.Livefyre.Config.CommentCountUpdatedHandler(count);} catch(ex) {_Log("CommentCountUpdatedHandler failed!", ex);}},CommentLiked: function(data) {_Log("CommentLiked", data);try {MarketWatch.Livefyre.Config.CommentLikedHandler(data);} catch(ex) {_Log("CommentLikedHandler failed!", ex);}},CommentShared: function(data) {if (data.sharedToTwitter || data.sharedToFacebook) {_Log("CommentShared", data);try {MarketWatch.Livefyre.Config.CommentSharedHandler(data);} catch(ex) {_Log("CommentSharedHandler failed!", ex);}}},CommentPosted: function(data) {_Log("CommentPosted", data);_events.CommentShared(data); try {MarketWatch.Livefyre.Config.CommentPostedHandler(data);} catch(ex) {_Log("CommentPostedHandler failed!", ex);}},Fail: function(message) {_Log(message + " failed.");try {MarketWatch.Livefyre.Config.FailHandler();} catch(ex) {_Log("FailHandler failed!", ex);}},OverlayHelper: {overlayElement: $("<div/>", { "class": "fyre-event-overlay", css: { opacity: 0.1 } }),event: null,timeout: null,overlays: -1,construct: function() {if(_events.OverlayHelper.timeout !== null) {clearTimeout(_events.OverlayHelper.timeout);}var commentFooters = _$el.find(".fyre-editor,footer.fyre-comment-footer");var overlays = _$el.find("div.fyre-event-overlay").length;if(_events.OverlayHelper.event !== null) {if(commentFooters.length > 0 && commentFooters.length !== overlays) {var t = (new Date()).getTime(); commentFooters.each(function() {var $this = $(this);if($this.find("div.fyre-event-overlay").length === 0) {$this.css("position", "relative");$("<div/>", { "class": "fyre-clear" }).appendTo($this);var $clone = _events.OverlayHelper.overlayElement.clone();$clone.css({ width: $this.outerWidth(), height: $this.outerHeight() }).bind("click", function(e) {e.preventDefault();Livefyre.auth.logout();_events.OverlayHelper.event();return false;}).appendTo($this);}});var te = (new Date()).getTime();_events.OverlayHelper.overlays = _$el.find("div.fyre-event-overlay").length;_Log("constructing " + _events.OverlayHelper.overlays + " event overlays took " + (te - t) + " milliseconds");}_events.OverlayHelper.timeout = setTimeout(_events.OverlayHelper.construct, 750);}},deconstruct: function() {_Log("Removing overlays");_$el.find(".fyre-event-overlay,.fyre-clear").remove();_events.OverlayHelper.event = null;if(_events.OverlayHelper.timeout !== null) {clearTimeout(_events.OverlayHelper.timeout);}}},Ready: function() {if(!_status.isReady) {_Log("Ready");clearTimeout(_checkStatusTimeout);if ($("link[href*=livefyre_main_mobile]").length > 0) {_$el.find("div.fyre").addClass("fyre-mobile");} Livefyre.auth.logout();if (_$el.css("visibility") == "hidden") {_$el.css("visibility", "visible");_$el.prev(".livefyre-loading").remove();}_events.OverlayHelper.timeout = setTimeout(_events.OverlayHelper.construct, 0);_status.isReady = true;try {MarketWatch.Livefyre.Config.ReadyHandler();} catch(ex) {_Log("ReadyHandler failed!", ex);}}},Initialize: function(app) {var timeTook = (new Date().getTime()) - _time;_Log("Loaded livefyre modules in " + timeTook + " milliseconds");_Log("Initializing/Setting events/Logging User in", app);clearTimeout(_checkStatusTimeout);_events.OverlayHelper.event = MarketWatch.Livefyre.Config.LoginHandler;app.on("initialRenderComplete", _events.Ready);app.on("commentCountUpdated", _events.CommentCountUpdated);app.on("commentShared", _events.CommentShared);app.on("commentPosted", _events.CommentPosted);app.on("commentLiked", _events.CommentLiked);if (MarketWatch.Livefyre.Config.hasOwnProperty("SkinCssUrl") && MarketWatch.Livefyre.Config.SkinCssUrl !== "") {$("head").append($("<link/>", { type: "text/css", rel: "stylesheet", href: MarketWatch.Livefyre.Config.SkinCssUrl }));}_status.isInitialized = true;window.DowJones.LivefyreCommentStream.AppInstance = app;_checksum = window.DowJones.LivefyreCommentStream.AppInstance.getOpts().checksum;_checkStatusTimeout = setTimeout(function() {_CheckStatus("isReady");}, _checkStatusTime);return false;}};var _CSSHelper = {id: "article-comments-css",addRules: function(cssRules) {if ($("#" + _CSSHelper.id).length === 0) {$("head").append($("<style/>", { type: "text/css", id: _CSSHelper.id }));}try {$("#" + _CSSHelper.id).html($("#" + _CSSHelper.id).html() + cssRules);} catch(ex) { var parts = cssRules.split(/\s*[{}]\s*/);for (var i = 0; i < parts.length; i += 2) {try {if (parts[i].indexOf(",") > -1) {var selectors = parts[i].split(",");for (var s = 0; s < selectors.length; s++) {document.getElementById(_CSSHelper.id).styleSheet.addRule(selectors[s], parts[i + 1]);}} else {document.getElementById(_CSSHelper.id).styleSheet.addRule(parts[i], parts[i + 1]);}} catch(ex) {}}}}};_CSSHelper.addRules(".fyre-clear{clear:both;}.fyre-event-overlay{position:absolute;top:0;left:0;right:0;bottom:0;z-index:100;}");_$el.css("visibility", "hidden").before($("<div />", { "class": "livefyre-loading" }));var _time = new Date().getTime();function _SetupStream() {_checkLoadedCalled++;if (Livefyre) {var timeTook = (new Date().getTime()) - _time;_Log("Livefyre.js loaded in " + timeTook + " milliseconds");_Log("Loading/Configuring Livefyre Comment Stream and Auth modules");_time = new Date().getTime();clearInterval(_lfLoadedCheckInterval);var lfStreamConfig = [{"collectionMeta":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0aXRsZSI6IlN0b2NrLW1hcmtldCBidWxscyBtYXkgZ2V0IHNjb3JjaGVkIGJ5ID9JY2FydXMgdHJhZGU_IGluIDIwMTcgLSBNYXJrZXRXYXRjaCIsInVybCI6Imh0dHBzOi8vd3d3Lm1hcmtldHdhdGNoLmNvbS9zdG9yeS9zdG9jay1tYXJrZXQtYnVsbHMtY291bGQtZ2V0LXNjb3JjaGVkLWJ5LWljYXJ1cy10cmFkZS1pbi0yMDE3LTIwMTctMDEtMDkiLCJ0YWdzIjoiYXJ0aWNsZSxUaGUgVGVsbCIsImNoZWNrc3VtIjoiek0xazdjd0VpbUFiYkI0U0NjUXhLZz09IiwiYXJ0aWNsZUlkIjoiNTUyNzlFRTYtRDY5NC0xMUU2LUIyRDEtNUJCMzdBRjhBQTQ4In0.SLpPiqibfHBCeASUtNLAxbBwlW-V50Edcc_O41Tu01w","siteId":"310248","articleId":"55279EE6-D694-11E6-B2D1-5BB37AF8AA48","checksum":"CCCD64EDCC048A601B6C1E1209C4312A","el":"article-comments"}];$.extend(lfStreamConfig[0], _config.StreamOptions);var lfLoadConfig = {"network":"marketwatch.fyre.co","attachmentDelegate":function(){return false;}};$.extend(lfLoadConfig, _config.LoadOptions);Livefyre.require(["fyre.conv#3","auth"], function(Conv, auth) { new Conv(lfLoadConfig, lfStreamConfig, _events.Initialize); auth.delegate(window.DowJones.LivefyreAuth.delegate); });_checkStatusTimeout = setTimeout(function() {_CheckStatus("isInitialized");}, _checkStatusTime);} else if (_checkLoadedCalled > 200) {clearInterval(_lfLoadedCheckInterval);_events.Fail("loading livefyre javascript");}}$.ajaxSetup({ cache: true });$.getScript("https://cdn.livefyre.com/Livefyre.js").done(function() { _lfLoadedCheckInterval = setInterval(_SetupStream, 50); }).fail(function() { _events.Fail("loading livefyre javascript"); });$.ajaxSetup({ cache: false });return {CSSHelper: _CSSHelper,Name: _name,UserAuthorId: _userAuthorId,$stream: _$el}}();