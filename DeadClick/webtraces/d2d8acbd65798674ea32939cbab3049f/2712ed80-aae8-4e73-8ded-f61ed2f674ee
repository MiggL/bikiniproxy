function MarkerManager(b,c){var a=this;a.map_=b;a.mapZoom_=b.getZoom();a.projectionHelper_=new ProjectionHelperOverlay(b);google.maps.event.addListener(a.projectionHelper_,"ready",function(){a.projection_=this.getProjection();a.initialize(b,c)})}MarkerManager.prototype.initialize=function(f,h){var d=this;h=h||{};d.tileSize_=MarkerManager.DEFAULT_TILE_SIZE_;var b=f.mapTypes;var a=1;for(var g in b){if(typeof f.mapTypes.get(g)==="object"&&typeof f.mapTypes.get(g).maxZoom==="number"){var c=f.mapTypes.get(g).maxZoom;if(c>a){a=c}}}d.maxZoom_=h.maxZoom||19;d.trackMarkers_=h.trackMarkers;d.show_=h.show||true;var e;if(typeof h.borderPadding==="number"){e=h.borderPadding}else{e=MarkerManager.DEFAULT_BORDER_PADDING_}d.swPadding_=new google.maps.Size(-e,e);d.nePadding_=new google.maps.Size(e,-e);d.borderPadding_=e;d.gridWidth_={};d.grid_={};d.grid_[d.maxZoom_]={};d.numMarkers_={};d.numMarkers_[d.maxZoom_]=0;google.maps.event.addListener(f,"dragend",function(){d.onMapMoveEnd_()});google.maps.event.addListener(f,"zoom_changed",function(){d.onMapMoveEnd_()});d.removeOverlay_=function(i){i.setMap(null);d.shownMarkers_--};d.addOverlay_=function(i){if(d.show_){i.setMap(d.map_);d.shownMarkers_++}};d.resetManager_();d.shownMarkers_=0;d.shownBounds_=d.getMapGridBounds_();google.maps.event.trigger(d,"loaded")};MarkerManager.DEFAULT_TILE_SIZE_=1024;MarkerManager.DEFAULT_BORDER_PADDING_=100;MarkerManager.MERCATOR_ZOOM_LEVEL_ZERO_RANGE=256;MarkerManager.prototype.resetManager_=function(){var a=MarkerManager.MERCATOR_ZOOM_LEVEL_ZERO_RANGE;for(var b=0;b<=this.maxZoom_;++b){this.grid_[b]={};this.numMarkers_[b]=0;this.gridWidth_[b]=Math.ceil(a/this.tileSize_);a<<=1}};MarkerManager.prototype.clearMarkers=function(){this.processAll_(this.shownBounds_,this.removeOverlay_);this.resetManager_()};MarkerManager.prototype.getTilePoint_=function(e,c,d){var b=this.projectionHelper_.LatLngToPixel(e,c);var a=new google.maps.Point(Math.floor((b.x+d.width)/this.tileSize_),Math.floor((b.y+d.height)/this.tileSize_));return a};MarkerManager.prototype.addMarkerBatch_=function(c,h,b){var f=this;var g=c.getPosition();c.MarkerManager_minZoom=h;if(this.trackMarkers_){google.maps.event.addListener(c,"changed",function(j,i,k){f.onMarkerMoved_(j,i,k)})}var d=this.getTilePoint_(g,b,new google.maps.Size(0,0,0,0));for(var e=b;e>=h;e--){var a=this.getGridCellCreate_(d.x,d.y,e);a.push(c);d.x=d.x>>1;d.y=d.y>>1}};MarkerManager.prototype.isGridPointVisible_=function(b){var d=this.shownBounds_.minY<=b.y&&b.y<=this.shownBounds_.maxY;var a=this.shownBounds_.minX;var c=a<=b.x&&b.x<=this.shownBounds_.maxX;if(!c&&a<0){var e=this.gridWidth_[this.shownBounds_.z];c=a+e<=b.x&&b.x<=e-1}return d&&c};MarkerManager.prototype.onMarkerMoved_=function(c,g,b){var f=this.maxZoom_;var h=false;var e=this.getTilePoint_(g,f,new google.maps.Size(0,0,0,0));var d=this.getTilePoint_(b,f,new google.maps.Size(0,0,0,0));while(f>=0&&(e.x!==d.x||e.y!==d.y)){var a=this.getGridCellNoCreate_(e.x,e.y,f);if(a){if(this.removeFromArray_(a,c)){this.getGridCellCreate_(d.x,d.y,f).push(c)}}if(f===this.mapZoom_){if(this.isGridPointVisible_(e)){if(!this.isGridPointVisible_(d)){this.removeOverlay_(c);h=true}}else{if(this.isGridPointVisible_(d)){this.addOverlay_(c);h=true}}}e.x=e.x>>1;e.y=e.y>>1;d.x=d.x>>1;d.y=d.y>>1;--f}if(h){this.notifyListeners_()}};MarkerManager.prototype.removeMarker=function(c){var e=this.maxZoom_;var f=false;var b=c.getPosition();var d=this.getTilePoint_(b,e,new google.maps.Size(0,0,0,0));while(e>=0){var a=this.getGridCellNoCreate_(d.x,d.y,e);if(a){this.removeFromArray_(a,c)}if(e===this.mapZoom_){if(this.isGridPointVisible_(d)){this.removeOverlay_(c);f=true}}d.x=d.x>>1;d.y=d.y>>1;--e}if(f){this.notifyListeners_()}this.numMarkers_[c.MarkerManager_minZoom]--};MarkerManager.prototype.addMarkers=function(d,e,c){var a=this.getOptMaxZoom_(c);for(var b=d.length-1;b>=0;b--){this.addMarkerBatch_(d[b],e,a)}this.numMarkers_[e]+=d.length};MarkerManager.prototype.getOptMaxZoom_=function(a){return a||this.maxZoom_};MarkerManager.prototype.getMarkerCount=function(b){var a=0;for(var c=0;c<=b;c++){a+=this.numMarkers_[c]}return a};MarkerManager.prototype.getMarker=function(f,c,e){var g=new google.maps.LatLng(f,c);var b=this.getTilePoint_(g,e,new google.maps.Size(0,0,0,0));var a=new google.maps.Marker({position:g});var h=this.getGridCellNoCreate_(b.x,b.y,e);if(h!==undefined){for(var d=0;d<h.length;d++){if(f===h[d].getLatLng().lat()&&c===h[d].getLatLng().lng()){a=h[d]}}}return a};MarkerManager.prototype.addMarker=function(b,e,d){var a=this.getOptMaxZoom_(d);this.addMarkerBatch_(b,e,a);var c=this.getTilePoint_(b.getPosition(),this.mapZoom_,new google.maps.Size(0,0,0,0));if(this.isGridPointVisible_(c)&&e<=this.shownBounds_.z&&this.shownBounds_.z<=a){this.addOverlay_(b);this.notifyListeners_()}this.numMarkers_[e]++};function GridBounds(a){this.minX=Math.min(a[0].x,a[1].x);this.maxX=Math.max(a[0].x,a[1].x);this.minY=Math.min(a[0].y,a[1].y);this.maxY=Math.max(a[0].y,a[1].y)}GridBounds.prototype.equals=function(a){if(this.maxX===a.maxX&&this.maxY===a.maxY&&this.minX===a.minX&&this.minY===a.minY){return true}else{return false}};GridBounds.prototype.containsPoint=function(a){var b=this;return(b.minX<=a.x&&b.maxX>=a.x&&b.minY<=a.y&&b.maxY>=a.y)};MarkerManager.prototype.getGridCellCreate_=function(a,f,e){var c=this.grid_[e];if(a<0){a+=this.gridWidth_[e]}var b=c[a];if(!b){b=c[a]=[];return(b[f]=[])}var d=b[f];if(!d){return(b[f]=[])}return d};MarkerManager.prototype.getGridCellNoCreate_=function(a,e,d){var c=this.grid_[d];if(a<0){a+=this.gridWidth_[d]}var b=c[a];return b?b[e]:undefined};MarkerManager.prototype.getGridBounds_=function(a,i,h,f){i=Math.min(i,this.maxZoom_);var b=a.getSouthWest();var e=a.getNorthEast();var g=this.getTilePoint_(b,i,h);var d=this.getTilePoint_(e,i,f);var j=this.gridWidth_[i];if(e.lng()<b.lng()||d.x<g.x){g.x-=j}if(d.x-g.x+1>=j){g.x=0;d.x=j-1}var c=new GridBounds([g,d]);c.z=i;return c};MarkerManager.prototype.getMapGridBounds_=function(){return this.getGridBounds_(this.map_.getBounds(),this.mapZoom_,this.swPadding_,this.nePadding_)};MarkerManager.prototype.onMapMoveEnd_=function(){this.objectSetTimeout_(this,this.updateMarkers_,0)};MarkerManager.prototype.objectSetTimeout_=function(b,c,a){return window.setTimeout(function(){c.call(b)},a)};MarkerManager.prototype.visible=function(){return this.show_?true:false};MarkerManager.prototype.isHidden=function(){return !this.show_};MarkerManager.prototype.show=function(){this.show_=true;this.refresh()};MarkerManager.prototype.hide=function(){this.show_=false;this.refresh()};MarkerManager.prototype.toggle=function(){this.show_=!this.show_;this.refresh()};MarkerManager.prototype.refresh=function(){if(this.shownMarkers_>0){this.processAll_(this.shownBounds_,this.removeOverlay_)}if(this.show_){this.processAll_(this.shownBounds_,this.addOverlay_)}this.notifyListeners_()};MarkerManager.prototype.updateMarkers_=function(){this.mapZoom_=this.map_.getZoom();var a=this.getMapGridBounds_();if(a.equals(this.shownBounds_)&&a.z===this.shownBounds_.z){return}if(a.z!==this.shownBounds_.z){this.processAll_(this.shownBounds_,this.removeOverlay_);if(this.show_){this.processAll_(a,this.addOverlay_)}}else{this.rectangleDiff_(this.shownBounds_,a,this.removeCellMarkers_);if(this.show_){this.rectangleDiff_(a,this.shownBounds_,this.addCellMarkers_)}}this.shownBounds_=a;this.notifyListeners_()};MarkerManager.prototype.notifyListeners_=function(){google.maps.event.trigger(this,"changed",this.shownBounds_,this.shownMarkers_)};MarkerManager.prototype.processAll_=function(b,d){for(var a=b.minX;a<=b.maxX;a++){for(var c=b.minY;c<=b.maxY;c++){this.processCellMarkers_(a,c,b.z,d)}}};MarkerManager.prototype.processCellMarkers_=function(b,f,d,e){var a=this.getGridCellNoCreate_(b,f,d);if(a){for(var c=a.length-1;c>=0;c--){e(a[c])}}};MarkerManager.prototype.removeCellMarkers_=function(a,c,b){this.processCellMarkers_(a,c,b,this.removeOverlay_)};MarkerManager.prototype.addCellMarkers_=function(a,c,b){this.processCellMarkers_(a,c,b,this.addOverlay_)};MarkerManager.prototype.rectangleDiff_=function(b,a,d){var c=this;c.rectangleDiffCoords_(b,a,function(e,f){d.apply(c,[e,f,b.z])})};MarkerManager.prototype.rectangleDiffCoords_=function(b,a,l){var f=b.minX;var m=b.minY;var h=b.maxX;var d=b.maxY;var e=a.minX;var k=a.minY;var g=a.maxX;var c=a.maxY;var j,i;for(j=f;j<=h;j++){for(i=m;i<=d&&i<k;i++){l(j,i)}for(i=Math.max(c+1,m);i<=d;i++){l(j,i)}}for(i=Math.max(m,k);i<=Math.min(d,c);i++){for(j=Math.min(h+1,e)-1;j>=f;j--){l(j,i)}for(j=Math.max(f,g+1);j<=h;j++){l(j,i)}}};MarkerManager.prototype.removeFromArray_=function(e,c,d){var a=0;for(var b=0;b<e.length;++b){if(e[b]===c||(d&&e[b]===c)){e.splice(b--,1);a++}}return a};function ProjectionHelperOverlay(c){this.setMap(c);var a=8;var b=1<<a;var d=7;this._map=c;this._zoom=-1;this._X0=this._Y0=this._X1=this._Y1=-1}ProjectionHelperOverlay.prototype=new google.maps.OverlayView();ProjectionHelperOverlay.prototype.LngToX_=function(a){return(1+a/180)};ProjectionHelperOverlay.prototype.LatToY_=function(b){var a=Math.sin(b*Math.PI/180);return(1-0.5/Math.PI*Math.log((1+a)/(1-a)))};ProjectionHelperOverlay.prototype.LatLngToPixel=function(e,b){var c=this._map;var d=this.getProjection().fromLatLngToDivPixel(e);var a={x:~~(0.5+this.LngToX_(e.lng())*(2<<(b+6))),y:~~(0.5+this.LatToY_(e.lat())*(2<<(b+6)))};return a};ProjectionHelperOverlay.prototype.draw=function(){if(!this.ready){this.ready=true;google.maps.event.trigger(this,"ready")}};var StyledIconTypes={};var StyledMarker,StyledIcon;(function(){var e="http://chart.apis.google.com/chart?chst=";var d=google.maps;var b=d.Point;var a=d.event;var c=d.MarkerImage;StyledMarker=function(f){var h=this;var g=h.styleIcon=f.styleIcon;h.bindTo("icon",g);h.bindTo("shadow",g);h.bindTo("shape",g);h.setOptions(f)};StyledMarker.prototype=new d.Marker();StyledIcon=function(f,n,l){var j;var o=this;var i="icon";var m="shadow";var p="shape";var g=[];function h(){var q=document.createElement("img");var k=document.createElement("img");a.addDomListenerOnce(k,"load",function(){var r=k.width,s=k.height;o.set(m,new c(f.getShadowURL(o),null,null,f.getShadowAnchor(o,r,s)));simage=null});a.addDomListenerOnce(q,"load",function(){var r=q.width,s=q.height;o.set(i,new c(f.getURL(o),null,null,f.getAnchor(o,r,s)));o.set(p,f.getShape(o,r,s));q=null});q.src=f.getURL(o);k.src=f.getShadowURL(o)}o.as_=function(k){g.push(k);for(j in n){k.set(j,n[j])}};if(f!==StyledIconTypes.CLASS){for(j in f.defaults){o.set(j,f.defaults[j])}o.setValues(n);o.set(i,f.getURL(o));o.set(m,f.getShadowURL(o));if(l){l.as_(o)}h();o.changed=function(q){if(q!==i&&q!==p&&q!==m){h()}}}else{o.setValues(n);o.changed=function(k){n[k]=o.get(k);for(j=0;j<g.length;j++){g[j].set(k,o.get(k))}};if(l){l.as_(o)}}};StyledIcon.prototype=new d.MVCObject();StyledIconTypes.CLASS={};StyledIconTypes.MARKER={defaults:{text:"",color:"00ff00",fore:"000000",starcolor:null},getURL:function(i){var g;var f=i.get("starcolor");var h=i.get("text");var k=i.get("color").replace(/#/,"");var j=i.get("fore").replace(/#/,"");if(f){g=e+"d_map_xpin_letter&chld=pin_star|"}else{g=e+"d_map_pin_letter&chld="}if(h){h=h.substr(0,2)}g+=h+"|";g+=k+"|";g+=j;if(f){g+="|"+f.replace(/#/,"")}return g},getShadowURL:function(f){if(f.get("starcolor")){return e+"d_map_xpin_shadow&chld=pin_star"}else{return e+"d_map_pin_shadow"}},getAnchor:function(h,g,f){return new b(g/2,f)},getShadowAnchor:function(h,g,f){return new b(g/4,f)},getShape:function(k,j,f){var g={};g.coord=[j/2,f,(7/16)*j,(5/8)*f,(5/16)*j,(7/16)*f,(7/32)*j,(5/16)*f,(5/16)*j,(1/8)*f,(1/2)*j,0,(11/16)*j,(1/8)*f,(25/32)*j,(5/16)*f,(11/16)*j,(7/16)*f,(9/16)*j,(5/8)*f];for(var h=0;h<g.coord.length;h++){g.coord[h]=Math.round(g.coord[h])}g.type="poly";return g}};StyledIconTypes.BUBBLE={defaults:{text:"",color:"00ff00",fore:"000000"},getURL:function(g){var f=e+"d_bubble_text_small&chld=bb|";f+=g.get("text")+"|";f+=g.get("color").replace(/#/,"")+"|";f+=g.get("fore").replace(/#/,"");return f},getShadowURL:function(f){return e+"d_bubble_text_small_shadow&chld=bb|"+f.get("text")},getAnchor:function(h,g,f){return new google.maps.Point(0,42)},getShadowAnchor:function(h,g,f){return new google.maps.Point(0,44)},getShape:function(i,h,f){var g={};g.coord=[0,44,13,26,13,6,17,1,h-4,1,h,6,h,21,h-4,26,21,26];g.type="poly";return g}}})();(function(a){a.fn.extend({autocomplete:function(b,c){var d=typeof b=="string";c=a.extend({},a.Autocompleter.defaults,{url:d?b:null,data:d?null:b,delay:d?a.Autocompleter.defaults.delay:10,max:c&&!c.scroll?10:150},c);c.highlight=c.highlight||function(e){return e};c.formatMatch=c.formatMatch||c.formatItem;return this.each(function(){new a.Autocompleter(this,c)})},result:function(b){return this.bind("result",b)},search:function(b){return this.trigger("search",[b])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(b){return this.trigger("setOptions",[b])},unautocomplete:function(){return this.trigger("unautocomplete")}});a.Autocompleter=function(m,g){var c={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var i=null;if(g.failure!=null&&typeof g.failure=="function"){i=g.failure}var b=a(m).attr("autocomplete","off").addClass(g.inputClass);var k;var r="";var n=a.Autocompleter.Cache(g);var e=0;var v;var y={mouseDownOnSelect:false};var s=a.Autocompleter.Select(g,m,d,y);var x;a.browser.opera&&a(m.form).bind("submit.autocomplete",function(){if(x){x=false;return false}});b.bind((a.browser.opera?"keypress":"keydown")+".autocomplete",function(z){e=1;v=z.keyCode;switch(z.keyCode){case c.UP:if(s.visible()){z.preventDefault();s.prev()}else{u(0,true)}break;case c.DOWN:if(s.visible()){z.preventDefault();s.next()}else{u(0,true)}break;case c.PAGEUP:if(s.visible()){z.preventDefault();s.pageUp()}else{u(0,true)}break;case c.PAGEDOWN:if(s.visible()){z.preventDefault();s.pageDown()}else{u(0,true)}break;case g.multiple&&a.trim(g.multipleSeparator)==","&&c.COMMA:case c.TAB:case c.RETURN:if(d()){z.preventDefault();x=true;return false}break;case c.ESC:s.hide();break;default:clearTimeout(k);k=setTimeout(u,g.delay);break}}).focus(function(){e++}).blur(function(){e=0;if(!y.mouseDownOnSelect){t()}}).click(function(){if(g.clickFire){if(!s.visible()){u(0,true)}}else{if(e++>1&&!s.visible()){u(0,true)}}}).bind("search",function(){var z=(arguments.length>1)?arguments[1]:null;function A(E,D){var B;if(D&&D.length){for(var C=0;C<D.length;C++){if(D[C].result.toLowerCase()==E.toLowerCase()){B=D[C];break}}}if(typeof z=="function"){z(B)}else{b.trigger("result",B&&[B.data,B.value])}}a.each(h(b.val()),function(B,C){f(C,A,A)})}).bind("flushCache",function(){n.flush()}).bind("setOptions",function(){a.extend(true,g,arguments[1]);if("data" in arguments[1]){n.populate()}}).bind("unautocomplete",function(){s.unbind();b.unbind();a(m.form).unbind(".autocomplete")});function d(){var C=s.selected();if(!C){return false}var z=C.result;r=z;if(g.multiple){var F=h(b.val());if(F.length>1){var B=g.multipleSeparator.length;var E=a(m).selection().start;var D,A=0;a.each(F,function(G,H){A+=H.length;if(E<=A){D=G;return false}A+=B});F[D]=z;z=F.join(g.multipleSeparator)}z+=g.multipleSeparator}b.val(z);w();b.trigger("result",[C.data,C.value]);return true}function u(B,A){if(v==c.DEL){s.hide();return}var z=b.val();if(!A&&z==r){return}r=z;z=j(z);if(z.length>=g.minChars){b.addClass(g.loadingClass);if(!g.matchCase){z=z.toLowerCase()}f(z,l,w)}else{o();s.hide()}}function h(z){if(!z){return[""]}if(!g.multiple){return[a.trim(z)]}return a.map(z.split(g.multipleSeparator),function(A){return a.trim(z).length?a.trim(A):null})}function j(z){if(!g.multiple){return z}var B=h(z);if(B.length==1){return B[0]}var A=a(m).selection().start;if(A==z.length){B=h(z)}else{B=h(z.replace(z.substring(A),""))}return B[B.length-1]}function q(z,A){if(g.autoFill&&(j(b.val()).toLowerCase()==z.toLowerCase())&&v!=c.BACKSPACE){b.val(b.val()+A.substring(j(r).length));a(m).selection(r.length,r.length+A.length)}}function t(){clearTimeout(k);k=setTimeout(w,200)}function w(){var z=s.visible();s.hide();clearTimeout(k);o();if(g.mustMatch){b.search(function(A){if(!A){if(g.multiple){var B=h(b.val()).slice(0,-1);b.val(B.join(g.multipleSeparator)+(B.length?g.multipleSeparator:""))}else{b.val("");b.trigger("result",null)}}})}}function l(A,z){if(z&&z.length&&e){o();s.display(z,A);q(A,z[0].value);s.show()}else{w()}}function f(A,C,z){if(!g.matchCase){A=A.toLowerCase()}var B=n.load(A);if(B&&B.length){C(A,B)}else{if((typeof g.url=="string")&&(g.url.length>0)){var D={timestamp:+new Date()};a.each(g.extraParams,function(E,F){D[E]=typeof F=="function"?F():F});a.ajax({mode:"abort",port:"autocomplete"+m.name,dataType:g.dataType,url:g.url,data:a.extend({q:j(A),limit:g.max},D),success:function(F){var E=g.parse&&g.parse(F)||p(F);n.add(A,E);C(A,E)}})}else{s.emptyList();if(i!=null){i()}else{z(A)}}}}function p(C){var z=[];var B=C.split("\n");for(var A=0;A<B.length;A++){var D=a.trim(B[A]);if(D){D=D.split("|");z[z.length]={data:D,value:D[0],result:g.formatResult&&g.formatResult(D,D[0])||D[0]}}}return z}function o(){b.removeClass(g.loadingClass)}};a.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:100,max:1000,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(b){return b[0]},formatMatch:null,autoFill:false,width:0,multiple:false,multipleSeparator:" ",inputFocus:true,clickFire:false,highlight:function(c,b){return c.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:true,scrollHeight:180,scrollJumpPosition:true};a.Autocompleter.Cache=function(c){var f={};var d=0;function h(l,k){if(!c.matchCase){l=l.toLowerCase()}var j=l.indexOf(k);if(c.matchContains=="word"){j=l.toLowerCase().search("\\b"+k.toLowerCase())}if(j==-1){return false}return j==0||c.matchContains}function g(j,i){if(d>c.cacheLength){b()}if(!f[j]){d++}f[j]=i}function e(){if(!c.data){return false}var k={},j=0;if(!c.url){c.cacheLength=1}k[""]=[];for(var m=0,l=c.data.length;m<l;m++){var p=c.data[m];p=(typeof p=="string")?[p]:p;var o=c.formatMatch(p,m+1,c.data.length);if(o===false){continue}var n=o.charAt(0).toLowerCase();if(!k[n]){k[n]=[]}var q={value:o,data:p,result:c.formatResult&&c.formatResult(p)||o};k[n].push(q);if(j++<c.max){k[""].push(q)}}a.each(k,function(r,s){c.cacheLength++;g(r,s)})}setTimeout(e,25);function b(){f={};d=0}return{flush:b,add:g,populate:e,load:function(n){if(!c.cacheLength||!d){return null}if(!c.url&&c.matchContains){var m=[];for(var j in f){if(j.length>0){var o=f[j];a.each(o,function(p,k){if(h(k.value,n)){m.push(k)}})}}return m}else{if(f[n]){return f[n]}else{if(c.matchSubset){for(var l=n.length-1;l>=c.minChars;l--){var o=f[n.substr(0,l)];if(o){var m=[];a.each(o,function(p,k){if(h(k.value,n)){m[m.length]=k}});return m}}}}}return null}}};a.Autocompleter.Select=function(e,j,l,p){var i={ACTIVE:"ac_over"};var k,f=-1,r,m="",s=true,c,o;function n(){if(!s){return}c=a("<div/>").hide().addClass(e.resultsClass).css("position","absolute").appendTo(document.body).hover(function(t){if(a(this).is(":visible")){j.focus()}p.mouseDownOnSelect=false});o=a("<ul/>").appendTo(c).mouseover(function(t){if(q(t).nodeName&&q(t).nodeName.toUpperCase()=="LI"){f=a("li",o).removeClass(i.ACTIVE).index(q(t));a(q(t)).addClass(i.ACTIVE)}}).click(function(t){a(q(t)).addClass(i.ACTIVE);l();if(e.inputFocus){j.focus()}return false}).mousedown(function(){p.mouseDownOnSelect=true}).mouseup(function(){p.mouseDownOnSelect=false});if(e.width>0){c.css("width",e.width)}s=false}function q(u){var t=u.target;while(t&&t.tagName!="LI"){t=t.parentNode}if(!t){return[]}return t}function h(t){k.slice(f,f+1).removeClass(i.ACTIVE);g(t);var v=k.slice(f,f+1).addClass(i.ACTIVE);if(e.scroll){var u=0;k.slice(0,f).each(function(){u+=this.offsetHeight});if((u+v[0].offsetHeight-o.scrollTop())>o[0].clientHeight){o.scrollTop(u+v[0].offsetHeight-o.innerHeight())}else{if(u<o.scrollTop()){o.scrollTop(u)}}}}function g(t){if(e.scrollJumpPosition||(!e.scrollJumpPosition&&!((t<0&&f==0)||(t>0&&f==k.size()-1)))){f+=t;if(f<0){f=k.size()-1}else{if(f>=k.size()){f=0}}}}function b(t){return e.max&&e.max<t?e.max:t}function d(){o.empty();var u=b(r.length);for(var v=0;v<u;v++){if(!r[v]){continue}var w=e.formatItem(r[v].data,v+1,u,r[v].value,m);if(w===false){continue}var t=a("<li/>").html(e.highlight(w,m)).addClass(v%2==0?"ac_even":"ac_odd").appendTo(o)[0];a.data(t,"ac_data",r[v])}k=o.find("li");if(e.selectFirst){k.slice(0,1).addClass(i.ACTIVE);f=0}if(a.fn.bgiframe){o.bgiframe()}}return{display:function(u,t){n();r=u;m=t;d()},next:function(){h(1)},prev:function(){h(-1)},pageUp:function(){if(f!=0&&f-8<0){h(-f)}else{h(-8)}},pageDown:function(){if(f!=k.size()-1&&f+8>k.size()){h(k.size()-1-f)}else{h(8)}},hide:function(){c&&c.hide();k&&k.removeClass(i.ACTIVE);f=-1},visible:function(){return c&&c.is(":visible")},current:function(){return this.visible()&&(k.filter("."+i.ACTIVE)[0]||e.selectFirst&&k[0])},show:function(){var v=a(j).offset();c.css({width:typeof e.width=="string"||e.width>0?e.width:a(j).width(),top:v.top+j.offsetHeight,left:v.left}).show();if(e.scroll){o.scrollTop(0);o.css({maxHeight:e.scrollHeight,overflow:"auto"});if(a.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var t=0;k.each(function(){t+=this.offsetHeight});var u=t>e.scrollHeight;o.css("height",u?e.scrollHeight:t);if(!u){k.width(o.width()-parseInt(k.css("padding-left"))-parseInt(k.css("padding-right")))}}}},selected:function(){var t=k&&k.filter("."+i.ACTIVE).removeClass(i.ACTIVE);return t&&t.length&&a.data(t[0],"ac_data")},emptyList:function(){o&&o.empty()},unbind:function(){c&&c.remove()}}};a.fn.selection=function(i,b){if(i!==undefined){return this.each(function(){if(this.createTextRange){var j=this.createTextRange();if(b===undefined||i==b){j.move("character",i);j.select()}else{j.collapse(true);j.moveStart("character",i);j.moveEnd("character",b);j.select()}}else{if(this.setSelectionRange){this.setSelectionRange(i,b)}else{if(this.selectionStart){this.selectionStart=i;this.selectionEnd=b}}}})}var g=this[0];if(g.createTextRange){var c=document.selection.createRange(),h=g.value,f="<->",d=c.text.length;c.text=f;var e=g.value.indexOf(f);g.value=h;this.selection(e,e+d);return{start:e,end:e+d}}else{if(g.selectionStart!==undefined){return{start:g.selectionStart,end:g.selectionEnd}}}}})(jQuery);jQuery.cookie=function(d,e,b){if(arguments.length>1&&String(e)!=="[object Object]"){b=jQuery.extend({},b);if(e===null||e===undefined){b.expires=-1}if(typeof b.expires==="number"){var g=b.expires,c=b.expires=new Date();c.setDate(c.getDate()+g)}e=String(e);return(document.cookie=[encodeURIComponent(d),"=",b.raw?e:encodeURIComponent(e),b.expires?"; expires="+b.expires.toUTCString():"",b.path?"; path="+b.path:"",b.domain?"; domain="+b.domain:"",b.secure?"; secure":""].join(""))}b=e||{};var a,f=b.raw?function(h){return h}:decodeURIComponent;return(a=new RegExp("(?:^|; )"+encodeURIComponent(d)+"=([^;]*)").exec(document.cookie))?f(a[1]):null};(function(a){a.fn.extend({elastic:function(){var b=["paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","lineHeight","fontFamily","width","fontWeight"];return this.each(function(){function m(e,d){curratedHeight=Math.floor(parseInt(e,10));h.height()!=curratedHeight&&h.css({height:curratedHeight+"px",overflow:d})}function j(){var e=h.val().replace(/&/g,"&amp;").replace(/ /g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />"),d=c.html().replace(/<br>/ig,"<br />");if(e+"&nbsp;"!=d){c.html(e+"&nbsp;");if(Math.abs(c.height()+g-h.height())>3){e=c.height()+g;if(e>=p){m(p,"auto")}else{e<=o?m(o,"hidden"):m(e,"hidden")}}}}if(this.type!="textarea"){return false}var h=a(this),c=a("<div />").css({position:"absolute",display:"none","word-wrap":"break-word"}),g=parseInt(h.css("line-height"),10)||parseInt(h.css("font-size"),"10"),o=parseInt(h.css("height"),10)||g*3,p=parseInt(h.css("max-height"),10)||Number.MAX_VALUE,n=0;if(p<0){p=Number.MAX_VALUE}c.appendTo(h.parent());for(n=b.length;n--;){c.css(b[n].toString(),h.css(b[n].toString()))}h.css({overflow:"hidden"});h.bind("keyup change cut paste",function(){j()});h.bind("blur",function(){if(c.height()<p){c.height()>o?h.height(c.height()):h.height(o)}});h.live("input paste",function(){setTimeout(j,250)});j()})}})})(jQuery);
/*!
 * jQuery Form Plugin
 * version: 2.43 (12-MAR-2010)
 * @requires jQuery v1.3.2 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function(b){b.fn.ajaxSubmit=function(s){if(!this.length){a("ajaxSubmit: skipping submit process - no element selected");return this}if(typeof s=="function"){s={success:s}}var e=b.trim(this.attr("action"));if(e){e=(e.match(/^([^#]+)/)||[])[1]}e=e||window.location.href||"";s=b.extend({url:e,type:this.attr("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},s||{});var u={};this.trigger("form-pre-serialize",[this,s,u]);if(u.veto){a("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(s.beforeSerialize&&s.beforeSerialize(this,s)===false){a("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var m=this.formToArray(s.semantic);if(s.data){s.extraData=s.data;for(var f in s.data){if(s.data[f] instanceof Array){for(var g in s.data[f]){m.push({name:f,value:s.data[f][g]})}}else{m.push({name:f,value:s.data[f]})}}}if(s.beforeSubmit&&s.beforeSubmit(m,this,s)===false){a("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[m,this,s,u]);if(u.veto){a("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var d=b.param(m);if(s.type.toUpperCase()=="GET"){s.url+=(s.url.indexOf("?")>=0?"&":"?")+d;s.data=null}else{s.data=d}var t=this,l=[];if(s.resetForm){l.push(function(){t.resetForm()})}if(s.clearForm){l.push(function(){t.clearForm()})}if(!s.dataType&&s.target){var p=s.success||function(){};l.push(function(k){var j=s.replaceTarget?"replaceWith":"html";b(s.target)[j](k).each(p,arguments)})}else{if(s.success){l.push(s.success)}}s.success=function(q,k,v){for(var n=0,j=l.length;n<j;n++){l[n].apply(s,[q,k,v||t,t])}};var c=b("input:file",this).fieldValue();var r=false;for(var i=0;i<c.length;i++){if(c[i]){r=true}}var h=false;if((c.length&&s.iframe!==false)||s.iframe||r||h){if(s.closeKeepAlive){b.get(s.closeKeepAlive,o)}else{o()}}else{b.ajax(s)}this.trigger("form-submit-notify",[this,s]);return this;function o(){var w=t[0];if(b(":input[name=submit]",w).length){alert('Error: Form elements must not be named "submit".');return}var q=b.extend({},b.ajaxSettings,s);var H=b.extend(true,{},b.extend(true,{},b.ajaxSettings),q);var v="jqFormIO"+(new Date().getTime());var D=b('<iframe id="'+v+'" name="'+v+'" src="'+q.iframeSrc+'" onload="(jQuery(this).data(\'form-plugin-onload\'))()" />');var F=D[0];D.css({position:"absolute",top:"-1000px",left:"-1000px"});var G={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1;D.attr("src",q.iframeSrc)}};var E=q.global;if(E&&!b.active++){b.event.trigger("ajaxStart")}if(E){b.event.trigger("ajaxSend",[G,q])}if(H.beforeSend&&H.beforeSend(G,H)===false){H.global&&b.active--;return}if(G.aborted){return}var k=false;var A=0;var j=w.clk;if(j){var y=j.name;if(y&&!j.disabled){q.extraData=q.extraData||{};q.extraData[y]=j.value;if(j.type=="image"){q.extraData[y+".x"]=w.clk_x;q.extraData[y+".y"]=w.clk_y}}}function x(){var K=t.attr("target"),I=t.attr("action");w.setAttribute("target",v);if(w.getAttribute("method")!="POST"){w.setAttribute("method","POST")}if(w.getAttribute("action")!=q.url){w.setAttribute("action",q.url)}if(!q.skipEncodingOverride){t.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"})}if(q.timeout){setTimeout(function(){A=true;B()},q.timeout)}var J=[];try{if(q.extraData){for(var L in q.extraData){J.push(b('<input type="hidden" name="'+L+'" value="'+q.extraData[L]+'" />').appendTo(w)[0])}}D.appendTo("body");D.data("form-plugin-onload",B);w.submit()}finally{w.setAttribute("action",I);K?w.setAttribute("target",K):t.removeAttr("target");b(J).remove()}}if(q.forceSync){x()}else{setTimeout(x,10)}var z=100;function B(){if(k){return}var I=true;try{if(A){throw"timeout"}var J,M;M=F.contentWindow?F.contentWindow.document:F.contentDocument?F.contentDocument:F.document;var N=q.dataType=="xml"||M.XMLDocument||b.isXMLDoc(M);a("isXml="+N);if(!N&&(M.body==null||M.body.innerHTML=="")){if(--z){a("requeing onLoad callback, DOM not available");setTimeout(B,250);return}a("Could not access iframe DOM after 100 tries.");return}a("response detected");k=true;G.responseText=M.body?M.body.innerHTML:null;G.responseXML=M.XMLDocument?M.XMLDocument:M;G.getResponseHeader=function(P){var O={"content-type":q.dataType};return O[P]};if(q.dataType=="json"||q.dataType=="script"){var n=M.getElementsByTagName("textarea")[0];if(n){G.responseText=n.value}else{var L=M.getElementsByTagName("pre")[0];if(L){G.responseText=L.innerHTML}}}else{if(q.dataType=="xml"&&!G.responseXML&&G.responseText!=null){G.responseXML=C(G.responseText)}}J=b.httpData(G,q.dataType)}catch(K){a("error caught:",K);I=false;G.error=K;b.handleError(q,G,"error",K)}if(I){q.success(J,"success");if(E){b.event.trigger("ajaxSuccess",[G,q])}}if(E){b.event.trigger("ajaxComplete",[G,q])}if(E&&!--b.active){b.event.trigger("ajaxStop")}if(q.complete){q.complete(G,I?"success":"error")}setTimeout(function(){D.removeData("form-plugin-onload");D.remove();G.responseXML=null},100)}function C(n,I){if(window.ActiveXObject){I=new ActiveXObject("Microsoft.XMLDOM");I.async="false";I.loadXML(n)}else{I=(new DOMParser()).parseFromString(n,"text/xml")}return(I&&I.documentElement&&I.documentElement.tagName!="parsererror")?I:null}}};b.fn.ajaxForm=function(c){return this.ajaxFormUnbind().bind("submit.form-plugin",function(d){d.preventDefault();b(this).ajaxSubmit(c)}).bind("click.form-plugin",function(i){var h=i.target;var f=b(h);if(!(f.is(":submit,input:image"))){var d=f.closest(":submit");if(d.length==0){return}h=d[0]}var g=this;g.clk=h;if(h.type=="image"){if(i.offsetX!=undefined){g.clk_x=i.offsetX;g.clk_y=i.offsetY}else{if(typeof b.fn.offset=="function"){var j=f.offset();g.clk_x=i.pageX-j.left;g.clk_y=i.pageY-j.top}else{g.clk_x=i.pageX-h.offsetLeft;g.clk_y=i.pageY-h.offsetTop}}}setTimeout(function(){g.clk=g.clk_x=g.clk_y=null},100)})};b.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};b.fn.formToArray=function(q){var p=[];if(this.length==0){return p}var d=this[0];var h=q?d.getElementsByTagName("*"):d.elements;if(!h){return p}for(var k=0,m=h.length;k<m;k++){var e=h[k];var f=e.name;if(!f){continue}if(q&&d.clk&&e.type=="image"){if(!e.disabled&&d.clk==e){p.push({name:f,value:b(e).val()});p.push({name:f+".x",value:d.clk_x},{name:f+".y",value:d.clk_y})}continue}var r=b.fieldValue(e,true);if(r&&r.constructor==Array){for(var g=0,c=r.length;g<c;g++){p.push({name:f,value:r[g]})}}else{if(r!==null&&typeof r!="undefined"){p.push({name:f,value:r})}}}if(!q&&d.clk){var l=b(d.clk),o=l[0],f=o.name;if(f&&!o.disabled&&o.type=="image"){p.push({name:f,value:l.val()});p.push({name:f+".x",value:d.clk_x},{name:f+".y",value:d.clk_y})}}return p};b.fn.formSerialize=function(c){return b.param(this.formToArray(c))};b.fn.fieldSerialize=function(d){var c=[];this.each(function(){var h=this.name;if(!h){return}var f=b.fieldValue(this,d);if(f&&f.constructor==Array){for(var g=0,e=f.length;g<e;g++){c.push({name:h,value:f[g]})}}else{if(f!==null&&typeof f!="undefined"){c.push({name:this.name,value:f})}}});return b.param(c)};b.fn.fieldValue=function(h){for(var g=[],e=0,c=this.length;e<c;e++){var f=this[e];var d=b.fieldValue(f,h);if(d===null||typeof d=="undefined"||(d.constructor==Array&&!d.length)){continue}d.constructor==Array?b.merge(g,d):g.push(d)}return g};b.fieldValue=function(c,j){var e=c.name,p=c.type,q=c.tagName.toLowerCase();if(typeof j=="undefined"){j=true}if(j&&(!e||c.disabled||p=="reset"||p=="button"||(p=="checkbox"||p=="radio")&&!c.checked||(p=="submit"||p=="image")&&c.form&&c.form.clk!=c||q=="select"&&c.selectedIndex==-1)){return null}if(q=="select"){var k=c.selectedIndex;if(k<0){return null}var m=[],d=c.options;var g=(p=="select-one");var l=(g?k+1:d.length);for(var f=(g?k:0);f<l;f++){var h=d[f];if(h.selected){var o=h.value;if(!o){o=(h.attributes&&h.attributes.value&&!(h.attributes.value.specified))?h.text:h.value}if(g){return o}m.push(o)}}return m}return c.value};b.fn.clearForm=function(){return this.each(function(){b("input,select,textarea",this).clearFields()})};b.fn.clearFields=b.fn.clearInputs=function(){return this.each(function(){var d=this.type,c=this.tagName.toLowerCase();if(d=="text"||d=="password"||c=="textarea"){this.value=""}else{if(d=="checkbox"||d=="radio"){this.checked=false}else{if(c=="select"){this.selectedIndex=-1}}}})};b.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset()}})};b.fn.enable=function(c){if(c==undefined){c=true}return this.each(function(){this.disabled=!c})};b.fn.selected=function(c){if(c==undefined){c=true}return this.each(function(){var d=this.type;if(d=="checkbox"||d=="radio"){this.checked=c}else{if(this.tagName.toLowerCase()=="option"){var e=b(this).parent("select");if(c&&e[0]&&e[0].type=="select-one"){e.find("option").selected(false)}this.selected=c}}})};function a(){if(b.fn.ajaxSubmit.debug){var c="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(c)}else{if(window.opera&&window.opera.postError){window.opera.postError(c)}}}}})(jQuery);(function(a){a.jMapping=function(v,e){var u,g,c,w,s,l,h,j,n;v=(typeof v=="string")?a(v).get(0):v;if(!(a(v).data("jMapping"))){u=a.extend(true,{},a.jMapping.defaults);a.extend(true,u,e);g={};n=[];var r=function(A){var z,y,x;z=[u.side_bar_selector,u.location_selector,u.info_window_selector].join(" ");a(z).hide();l=k();h=f(A);if(A){g={};n=[];s.clearMarkers();google.maps.event.trigger(w,"resize");w.fitBounds(h);if(u.force_zoom_level){w.setZoom(u.force_zoom_level)}}else{w=q();s=new MarkerManager(w)}l.each(function(){var B=b(this);if(!(u.link_selector===false)){t(this)}a(document).trigger("markerCreated.jMapping",[B])});if(A){m()}else{google.maps.event.addListener(s,"loaded",function(){m();if(u.default_zoom_level){w.setZoom(u.default_zoom_level)}})}if(!(u.link_selector===false)&&!A){i()}};var q=function(){var x={navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},mapTypeControl:true,mapTypeId:google.maps.MapTypeId.ROADMAP,minZoom:1,scrollwheel:false,zoom:9};if(u.map_config){w=new google.maps.Map(v,a.extend(x,u.map_config))}else{w=new google.maps.Map(v,x)}w.fitBounds(h);if(u.force_zoom_level){w.setZoom(u.force_zoom_level)}return w};var k=function(){return a(u.side_bar_selector+" "+u.location_selector)};var d=function(x){return l.map(function(){if(x){a(this).data("metadata",false)}return a(this).metadata(u.metadata_options)})};var f=function(C){var B=d(C),A,z;if(B.length){z=a.jMapping.makeGLatLng(B[0].point)}else{z=a.jMapping.makeGLatLng(u.default_point)}A=new google.maps.LatLngBounds(z,z);for(var y=1,x=B.length;y<x;y++){A.extend(a.jMapping.makeGLatLng(B[y].point))}return A};var t=function(z){var y=a(z),x=y.metadata(u.metadata_options),A=y.find(u.link_selector)};var p=function(x){if(u.category_icon_options){if(a.isFunction(u.category_icon_options)){return u.category_icon_options(x)}else{return u.category_icon_options[x]||u.category_icon_options["default"]}}else{return{}}};var b=function(C){var B=a(C),A,x,z,y,D;A=B.metadata(u.metadata_options);x=a.jMapping.makeGLatLng(A.point);if(u.category_icon_options){icon_options=p(A.category);if((typeof icon_options==="string")||(icon_options instanceof google.maps.MarkerImage)){z=new google.maps.Marker({icon:icon_options,position:x,map:w})}else{z=new StyledMarker({styleIcon:new StyledIcon(StyledIconTypes.MARKER,icon_options),position:x,map:w})}}else{z=new google.maps.Marker({position:x,map:w})}y=B.find(u.info_window_selector);if(y.length>0){D=new google.maps.InfoWindow({content:y.html(),maxWidth:u.info_window_max_width});n.push(D);google.maps.event.addListener(z,"click",function(){a.each(n,function(E,F){if(D!=F){F.close()}});D.open(w,z)})}g[parseInt(A.id,10)]=z;return z};var m=function(){if(u.always_show_markers===true){min_zoom=0}else{zoom_level=w.getZoom();min_zoom=(zoom_level<7)?0:(zoom_level-7)}s.addMarkers(o(),min_zoom);s.refresh();if(u.force_zoom_level){w.setZoom(u.force_zoom_level)}};var i=function(){var x=[u.side_bar_selector,u.location_selector,u.link_selector].join(" ");a(x).live("mouseover",function(z){var y=a(this).parent().parent().metadata().id;google.maps.event.trigger(g[y],"click")})};var o=function(){var x=[];a.each(g,function(y,z){x.push(z)});return x};if(a(document).trigger("beforeMapping.jMapping",[u])!=false){r();c=true}else{c=false}j={gmarkers:g,settings:u,mapped:c,map:w,markerManager:s,gmarkersArray:o,getBounds:f,getPlacesData:d,getPlaces:k,update:function(){if(a(document).trigger("beforeUpdate.jMapping",[this])!=false){r(true);this.map=w;this.gmarkers=g;this.markerManager=s;a(document).trigger("afterUpdate.jMapping",[this])}}};a(document).trigger("afterMapping.jMapping",[j]);return j}else{return a(v).data("jMapping")}};a.extend(a.jMapping,{defaults:{side_bar_selector:"#map-side-bar:first",location_selector:".map-location",link_selector:"a.map-link",info_window_selector:".info-box",info_window_max_width:425,default_point:{lat:0,lng:0},metadata_options:{type:"attr",name:"data-jmapping"}},makeGLatLng:function(b){return new google.maps.LatLng(b.lat,b.lng)}});a.fn.jMapping=function(b){if((b=="update")&&a(this[0]).data("jMapping")){a(this[0]).data("jMapping").update()}else{if(b=="update"){b={}}a(this[0]).data("jMapping",a.jMapping(this[0],b))}return this}})(jQuery);(function($){$.extend({metadata:{defaults:{type:"class",name:"metadata",cre:/({.*})/,single:"metadata"},setType:function(type,name){this.defaults.type=type;this.defaults.name=name},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);if(!settings.single.length){settings.single="metadata"}var data=$.data(elem,settings.single);if(data){return data}data="{}";var getData=function(data){if(typeof data!="string"){return data}if(data.indexOf("{")<0){data=eval("("+data+")")}};var getObject=function(data){if(typeof data!="string"){return data}data=eval("("+data+")");return data};if(settings.type=="html5"){var object={};$(elem.attributes).each(function(){var name=this.nodeName;if(name.match(/^data-/)){name=name.replace(/^data-/,"")}else{return true}object[name]=getObject(this.nodeValue)})}else{if(settings.type=="class"){var m=settings.cre.exec(elem.className);if(m){data=m[1]}}else{if(settings.type=="elem"){if(!elem.getElementsByTagName){return}var e=elem.getElementsByTagName(settings.name);if(e.length){data=$.trim(e[0].innerHTML)}}else{if(elem.getAttribute!=undefined){var attr=elem.getAttribute(settings.name);if(attr){data=attr}}}}object=getObject(data.indexOf("{")<0?"{"+data+"}":data)}$.data(elem,settings.single,object);return object}}});$.fn.metadata=function(opts){return $.metadata.get(this[0],opts)}})(jQuery);(function(l){l.fn.raty=function(f){options=l.extend({},l.fn.raty.defaults,f);if(this.length==0){o("Selector invalid or missing");return}else{if(this.length>1){return this.each(function(){l.fn.raty.apply(l(this),[f])})}}if(options.number>20){options.number=20}else{if(options.number<0){options.number=0}}if(options.path.substring(options.path.length-1,options.path.length)!="/"){options.path+="/"}$global=l(this);var h=this.attr("id"),g=0,a=options.starOn,e="";if(h==""){h="raty-"+$global.index();$global.attr("id",h)}if(!isNaN(options.start)&&options.start>0){g=(options.start>options.number)?options.number:options.start}for(var d=1;d<=options.number;d++){a=(g>=d)?options.starOn:options.starOff;e=(d<=options.hintList.length&&options.hintList[d-1]!==null)?options.hintList[d-1]:d;$global.append('<img id="'+h+"-"+d+'" src="'+options.path+a+'" alt="'+d+'" title="'+e+'" class="'+h+'"/>').append((d<options.number)?"&nbsp;":"")}l("<input/>",{id:h+"-score",type:"hidden",name:options.scoreName}).appendTo($global).val(g);if(options.showHalf){i($global,l("input#"+h+"-score").val(),options)}if(!options.readOnly){if(options.showCancel){var c=l("img."+h),u='<img src="'+options.path+options.cancelOff+'" alt="x" title="'+options.cancelHint+'" class="button-cancel"/>',t=options,b=$global;if(t.cancelPlace=="left"){$global.prepend(u+"&nbsp;")}else{$global.append("&nbsp;").append(u)}l("#"+h+" img.button-cancel").mouseenter(function(){l(this).attr("src",t.path+t.cancelOn);c.attr("src",t.path+t.starOff)}).mouseleave(function(){l(this).attr("src",t.path+t.cancelOff);c.mouseout()}).click(function(){l("input#"+h+"-score").val(0);if(t.onClick){t.onClick.apply(b,[0])}});$global.css("width",t.number*20+20)}else{$global.css("width",options.number*20)}$global.css("cursor","pointer");m($global,options)}else{$global.css("cursor","default");k($global,g,options)}return $global};l.fn.raty.defaults={cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",hintList:["bad","poor","regular","good","gorgeous"],noRatedMsg:"not rated yet",number:5,path:"img/",iconRange:[],readOnly:false,scoreName:"score",showCancel:false,showHalf:false,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",start:0,onClick:null};l.fn.raty.click=function(b,a){var c=n(b,a,"click");j(c,b,options);if(options.onClick){options.onClick.apply(c,[b])}else{o('You must add the "onClick: function(score) { }" option.')}return l.fn.raty};l.fn.raty.readOnly=function(c,a){var d=n(c,a,"readOnly"),b=d.children("img.button-cancel");if(b[0]){(c)?b.hide():b.show()}if(c){l("img."+d.attr("id")).unbind();d.css("cursor","default").unbind()}else{m(d,options);d.css("cursor","pointer")}return l.fn.raty};l.fn.raty.start=function(b,a){j(n(b,a,"start"),b,options);return l.fn.raty};function m(c,d){var a=c.attr("id"),b=l("input#"+a+"-score"),e=l("img."+a).length;l("#"+a).mouseleave(function(){j(c,b.val(),d)});l("img."+a).mouseenter(function(){p(a,this.alt,d)}).click(function(){b.val(this.alt);if(d.onClick){d.onClick.apply(c,[this.alt])}})}function n(b,a,e){var d=$global;if(a){if(a.indexOf(".")==0){var c;return l(a).each(function(){c="#"+l(this).attr("id");if(e=="start"){l.fn.raty.start(b,c)}else{if(e=="click"){l.fn.raty.click(b,c)}else{if(e=="readOnly"){l.fn.raty.readOnly(b,c)}}}})}d=l(a);if(!d.length){o('"'+a+'" is a invalid ID for the public funtion $.fn.raty.'+e+"().");return}}return d}function o(a){if(console&&console.log){console.log(a)}}function p(s,h,a){var g=l("img."+s).length,b=0,d=0,c,f;for(var e=1;e<=g;e++){c=l("img#"+s+"-"+e);if(e<=h){if(a.iconRange&&a.iconRange.length>b){f=a.iconRange[b][0];d=a.iconRange[b][1];if(e<=d){c.attr("src",a.path+f)}if(e==d){b++}}else{c.attr("src",a.path+a.starOn)}}else{c.attr("src",a.path+a.starOff)}}}function k(b,a,c){if(a!=0){a=parseInt(a);hint=(a>0&&c.number<=c.hintList.length&&c.hintList[a-1]!==null)?c.hintList[a-1]:a}else{hint=c.noRatedMsg}l("#"+b.attr("id")).attr("title",hint).children("img").attr("title",hint)}function j(c,b,d){var a=c.attr("id");if(b<0||isNaN(b)){b=0}else{if(b>d.number){b=d.number}}l("input#"+a+"-score").val(b);p(a,b,d);if(d.showHalf){i(c,b,d)}if(d.readOnly||c.css("cursor")=="default"){k(c,b,d)}}function i(c,a,d){var f=c.attr("id"),e=Math.ceil(a),b=(e-a).toFixed(1);if(b>=0.3&&b<=0.7){e=e-0.5;l("img#"+f+"-"+Math.ceil(e)).attr("src",d.path+d.starHalf)}else{if(b>=0.8){e--}else{l("img#"+f+"-"+e).attr("src",d.path+d.starOn)}}}})(jQuery);function placeholder_is_missing(){if("placeholder" in document.createElement("input")){return false}else{return true}}function get_last_value_for_day(a){var c=[30,29,28,27];var b=0;while(b<=3){last_value_for_day=$(a+" option:eq("+c[b]+")").val();if(last_value_for_day!=undefined){return last_value_for_day=parseInt(last_value_for_day);break}b++}}function preload_favorite_images(){var b=["/images/app/favorite.png","/images/app/unfavorite.png"];for(var c=0;c<b.length;c++){var a=new Image();a.src=b[c]}}function show_user_greeting_on_cached_pages(){if(window.location.pathname=="/"||window.location.pathname=="/theaters"||window.location.pathname=="/photos"){if($.cookie("user_handle")){text="";text=text+'<a href="/members/'+$.cookie("user_slug")+'">';text=text+'<img alt="profile image" height="24" src="'+$.cookie("user_avatar")+'" width="24" /></a> ';text=text+'<a href="/members/'+$.cookie("user_slug")+'">'+$.cookie("user_handle").replace("+"," ")+"</a> | ";text=text+'<a href="/logout">Logout</a>';$("#primary #links").html(text);if($.cookie("user_slug")=="patrick"||$.cookie("user_slug")=="rossmelnick"||$.cookie("user_slug")=="michaelzoldessy"||$.cookie("user_slug")=="kenroe"){$("nav ul").append('<li id="dashboard"><a href="/dashboard">Dashboard</a></li>')}}}}function show_city_matches_when_searching(){$("#search_bar #q").autocomplete("/theaters/regions.js",{delay:0,highlight:false});$("#homepage2 #search_box #q").autocomplete("/theaters/regions.js",{delay:0,highlight:false});$("#theaters_home #search_box #q").autocomplete("/theaters/regions.js",{delay:0,highlight:false});$("#theater_city_name").autocomplete("/theaters/cities.js",{delay:0,highlight:false})}function show_placeholder_text_on_old_browsers(a){if(placeholder_is_missing()){$(a).focus(function(){var b=$(this);if(b.val()==b.attr("placeholder")){b.val("");b.removeClass("placeholder")}}).blur(function(){var b=$(this);if(b.val()==""||b.val()==b.attr("placeholder")){b.addClass("placeholder");b.val(b.attr("placeholder"))}}).blur();$(a).parents("form").submit(function(){$(this).find(a).each(function(){var b=$(this);if(b.val()==b.attr("placeholder")){b.val("")}})})}}function show_rating_stars_for_reviews(){if($("#picture_rating").length){$("#picture_rating").raty({path:"/images/ratings",scoreName:"review[picture_rating]",start:$("#review_picture_rating").attr("value")});$("#sound_rating").raty({path:"/images/ratings",scoreName:"review[sound_rating]",start:$("#review_sound_rating").attr("value")});$("#food_rating").raty({path:"/images/ratings",scoreName:"review[food_rating]",start:$("#review_food_rating").attr("value")});$("#movies_rating").raty({path:"/images/ratings",scoreName:"review[movies_rating]",start:$("#review_movies_rating").attr("value")});$("#service_rating").raty({path:"/images/ratings",scoreName:"review[service_rating]",start:$("#review_service_rating").attr("value")})}}function show_upgrade_message_for_IE6(){if($(".ie6").length){$("body").load("/pages/ie6")}}function tweak_comment_links(){if($(".comment").length){$('.comment a[href^="http://"]').attr("target","_blank");$('.comment a[href^="http://"]').attr("rel","nofollow")}}function update_select_for_day(c,e,a){var d=$(a).val();last_value_for_day=get_last_value_for_day(a);selected_month=parseInt($(e).val());if($.inArray(selected_month,[4,6,9,11])!=-1){last_day_of_month=30}else{if(selected_month==2){if(new Date($(c).val(),1,29).getDate()==29){last_day_of_month=29}else{last_day_of_month=28}}else{last_day_of_month=31}}if(last_value_for_day>last_day_of_month){days_to_remove=last_value_for_day-last_day_of_month;var b=0;while(b<=days_to_remove){$(a+" option:eq("+(last_value_for_day-b)+")").remove();b++}}else{if(last_day_of_month>last_value_for_day){days_to_add=last_day_of_month-last_value_for_day;var b=1;while(b<=days_to_add){$(a).append("<option value='"+(last_value_for_day+b)+"'>"+(last_value_for_day+b)+"</option>");b++}}}last_value_for_day=get_last_value_for_day(a);if(d>last_value_for_day){$(a+" option:eq("+(last_value_for_day-1)+")").attr("selected","selected")}}$(document).ready(function(){$("textarea").elastic();preload_favorite_images();show_user_greeting_on_cached_pages();show_placeholder_text_on_old_browsers("#search_bar #q");show_upgrade_message_for_IE6();tweak_comment_links();show_city_matches_when_searching()});