define(["jquery","pubsub","foundation.abide","foundation.alerts","foundation.placeholder","shared.validatecheckboxes","datalayer.cms.signupform"],function(f,d,c,a,b,e){(function(k,i,g,l){var h="signupForm";var j=function(n,m){this.element=n;this.messageDisplay=k(this.element).find(".signup-message.hide");this.options=m;this.metadata=k(this.element).data("signupform-options")};j.prototype={defaults:{successMessage:"Thank you for signing up.",errorMessage:"There was a problem. Please try again later.",alreadySubscribedMessage:"Sorry, this address already exists."},init:function(){console.log("initilizing form for",k(this.element));this.config=k.extend({},this.defaults,this.options,this.metadata);this._build();var m=this;k(g).foundation("abide alerts");k(this.element).validateCheckboxes();k(m.element).submit(function(n){n.preventDefault()});k(m.element).on("valid",function(){k.ajax({url:k(this).attr("action"),type:k(this).attr("method"),data:k(this).serialize(),processData:true,cache:false,success:function(n){console.log("form response",n);if(n.errorMessage!==l){m.showResult(m.getErrorMessage(n),"alert");m.publishSignupResult(false)}else{m.showResult(m.config.successMessage,"success");m.publishSignupResult(true,n)}},error:function(n){console.log("form error",n);m.showResult(m.config.errorMessage,"alert");m.publishSignupResult(false)}})});return m},_build:function(){},getErrorMessage:function(n){var m=this;if(n.errorMessage==="UserAlreadySubscribed"){return m.config.alreadySubscribedMessage}else{return n.errorMessage}},showResult:function(n,o){console.log("form results",n);var m=this;k(m.messageDisplay).addClass("hide");k(m.messageDisplay).find(".alert-box").remove();k(m.messageDisplay).append("<div data-alert class='alert-box "+o+"'><span>"+n+"</span><a class='close'>&times;</a>");k(m.messageDisplay).removeClass("hide")},publishSignupResult:function(m,n){var o={result:m,response:n};k.pubsub("publish","vfdp.aem.footer.emailsignup",o)}};j.defaults=j.prototype.defaults;k.fn.signupForm=function(m){return this.each(function(){var n=k(this).data(h);if(!n){n=new j(this,m).init();k(this).data(h,n)}})}})(jQuery,window,document)});