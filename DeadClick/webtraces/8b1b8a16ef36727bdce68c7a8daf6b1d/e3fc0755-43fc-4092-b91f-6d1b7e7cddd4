GrahamTechnology.ui.TreeView=function(e,b,d,c,a){this.id=e;this.accessibilityOn=b;this.formId=d;this.wrapText=false;this.showRoot=true;this.cancelToggle=false;this.isHeavyLoad=a;this.nodesMap={};if(!GrahamTechnology.Base.isUndefinedOrNull(c)){this.wrapText=c}this.yuiTreeView=new YAHOO.widget.TreeView(e);this.styleSheet=new YAHOO.util.StyleSheet(e+"_style");YAHOO.widget.TreeView.FOCUS_CLASS_NAME="focusedNode";this.yuiTreeView.subscribe("expand",this.onExpand,this,true);this.yuiTreeView.subscribe("collapse",this.onCollapse,this,true);this.yuiTreeView.subscribe("labelClick",this.onlick,this,true);this.yuiTreeView.subscribe("enterKeyPressed",this.onEnterPressed,this,true);this.yuiTreeView.subscribe("expandComplete",this.onExpandComplete,this,true);this.yuiTreeView.subscribe("collapseComplete",this.onCollapseComplete,this,true);this.yuiTreeView.subscribe("clickEvent",this.onClickEvent,this,true);YAHOO.util.Event.on(this.yuiTreeView.getEl(),"keydown",this.onKeyDown,this,true);if(this.isHeavyLoad){this.registerOnVisibilityChange()}};GrahamTechnology.ui.TreeView.prototype.onKeyDown=function(a){if(a.keyCode==YAHOO.util.KeyListener.KEY.TAB){if(a.target.className.indexOf("ygtvlabel")!=-1||a.target.className.indexOf("ygtvspacer")!=-1){var b=GrahamTechnology.ui.Form.getRegisteredComponent(this.id);b.performFocus()}}};GrahamTechnology.ui.TreeView.prototype.collapseOnVisibilityChange=function(b,a){var d=a[0];var c=YAHOO.util.Dom.isAncestor(d,this.id);if(c){this.collapseUptoSecondLevel()}};GrahamTechnology.ui.TreeView.prototype.collapseUptoSecondLevel=function(){var b=this.yuiTreeView.getRoot();var f;if(b.hasChildren()){f=b.children}for(var d=0,a=f.length;d<a;d++){var e=f[d].children;for(var h=0,c=e.length;h<c;h++){var g=e[h];g.collapse()}}};GrahamTechnology.ui.TreeView.prototype.registerOnVisibilityChange=function(){GrahamTechnology.ui.Form.onVisibilityChange.subscribe(this.collapseOnVisibilityChange,this,true)};GrahamTechnology.ui.TreeView.prototype.onExpand=function(a){if(this.cancelToggle){this.cancelToggle=false;return false}logger.log(" Expanding node with ID["+a.data.id+"] on tree with id ["+this.id+"]","debug","GrahamTechnology.ui.Treeview.onExpand");this.postEvent(a.tree.id,GrahamTechnology.grasp.EvtType.TREE_EXPAND,a.data.id,"true",null)};GrahamTechnology.ui.TreeView.prototype.onExpandComplete=function(a){GrahamTechnology.ui.Form.fireComponentResize(this.formId,null,this.id)};GrahamTechnology.ui.TreeView.prototype.onCollapse=function(a){if(this.cancelToggle){this.cancelToggle=false;return false}logger.log(" Collapse node with ID["+a.data.id+"] on tree with id ["+this.id+"]","debug","GrahamTechnology.ui.Treeview.onCollapse");this.postEvent(a.tree.id,GrahamTechnology.grasp.EvtType.TREE_EXPAND,a.data.id,"false",null)};GrahamTechnology.ui.TreeView.prototype.onCollapseComplete=function(a){GrahamTechnology.ui.Form.fireComponentResize(this.formId,null,this.id)};GrahamTechnology.ui.TreeView.prototype.onlick=function(a){logger.log("Clicked node with ID["+a.data.id+"] on tree with id ["+this.id+"]","debug","GrahamTechnology.ui.Treeview.onClick");this.postEvent(this.id,16,a.data.id,this.formId)};GrahamTechnology.ui.TreeView.prototype.onEnterPressed=function(a){logger.log("Enter pressed on node with ID["+a.data.id+"] on tree with id ["+this.id+"]","debug","GrahamTechnology.ui.Treeview.onEnterPressed");this.postEvent(this.id,16,a.data.id,this.formId)};GrahamTechnology.ui.TreeView.prototype.onClickEvent=function(a){if(a.node.children.length>0){this.cancelToggle=true}};GrahamTechnology.ui.TreeView.prototype.postEvent=function(){if(!this.disablePosts){clientAPI.postRegisteredComponentEvent.apply(clientAPI,arguments)}};GrahamTechnology.ui.TreeView.prototype.getYUITreeView=function(){return this.yuiTreeView};GrahamTechnology.ui.TreeView.prototype.getStyle=function(a){var b;if(a){b=this.styleMap[a];if(!b){b=this.createStyle(a)}}return b};GrahamTechnology.ui.TreeView.prototype.createStyleYui=function(a){var b="gticon-"+this.id+"-"+this.styleNumber++;this.styleSheet.set("."+b,{display:"block",paddingLeft:"18px",background:"transparent url("+a+") 0 0px no-repeat"});this.styleMap[a]=b;return b};GrahamTechnology.ui.TreeView.prototype.createStyle=function(a){if(!GrahamTechnology.util.Browsers.isSafari()){return this.createStyleYui(a)}else{var c="gticon-"+this.id+"-"+this.styleNumber++;var b="display: block; padding-left: 18px; background: url("+a+") no-repeat scroll 0pt 0px transparent; ";var d=document.createElement("style");d.type="text/css";d.innerHTML="."+c+" { "+b+" }";document.getElementsByTagName("head")[0].appendChild(d);this.styleMap[a]=c;return c}};GrahamTechnology.ui.TreeView.prototype.buildChild=function(g,b,e,f,c){this.disablePosts=true;var d=null;if(!this.isLabelValid(e)){logger.log("Label was not specified for node ["+g+"]on tree with id ["+this.id+"]. Defaulting to [undefined]","error","GrahamTechnology.ui.Treeview.isLabelValid");e="[undefined]"}if(e==="Loading..."&&this.loadingText){e=this.loadingText}if(!this.wrapText){e=e.replaceAll(" ","&nbsp;")}var a={label:e,id:g};if(!this.accessibilityOn){d=new YAHOO.widget.TextNode(a,this.getParentNode(b),f);if(c){d.labelStyle+=" "+c}this.nodesMap[g]=d;d=null}else{a.html="<a  href='"+e+"' onclick='clientAPI.postRegisteredComponentEvent.apply(clientAPI,[\""+this.id+'",16,"'+g+'",'+this.formId+"]);GrahamTechnology.ui.cancelEvent(event);'>"+e+"</a>";d=new YAHOO.widget.HTMLNode(a,this.getParentNode(b),f);if(c){d.labelStyle=c}}this.disablePosts=false};GrahamTechnology.ui.TreeView.prototype.isLabelValid=function(a){return(a&&a!="")};GrahamTechnology.ui.TreeView.prototype.getParentNode=function(b){var a;if(b==-1){a=this.yuiTreeView.getRoot()}else{a=this.nodesMap[b];if(a===void 0||a===null){a=this.yuiTreeView.getNodeByProperty("id",b)}}return a};GrahamTechnology.ui.TreeView.prototype.destroy=function(){this.yuiTreeView.unsubscribe("expand",this.onExpand,this);this.yuiTreeView.unsubscribe("collapse",this.onCollapse,this);this.yuiTreeView.unsubscribe("labelClick",this.onlick,this);this.yuiTreeView.unsubscribe("enterKeyPressed",this.onEnterPressed,this);this.yuiTreeView.unsubscribe("expandComplete",this.onExpandComplete,this);this.yuiTreeView.unsubscribe("collapseComplete",this.onCollapseComplete,this);this.yuiTreeView.unsubscribe("clickEvent",this.onClickEvent,this);YAHOO.util.Event.removeListener(this.yuiTreeView.getEl(),"keydown",this.onKeyDown);GrahamTechnology.ui.Form.onVisibilityChange.unsubscribe(this.collapseOnVisibilityChange,this);this.yuiTreeView.destroy();this.yuiTreeView=null;this.nodesMap=null;if(this.stylesheet){var a=document.getElementById(this.styleSheet.node.id);if(a){a.parentNode.removeChild(a)}}this.styleSheet=null;this.styleMap=null};YAHOO.widget.Node.prototype.focus=function(){var e=false,b=this;var c=YAHOO.util.Dom,a=YAHOO.util.Event;if(this.tree.currentFocus){this.tree.currentFocus._removeFocus()}var d=function(f){if(f.parent){d(f.parent);f.parent.expand()}};d(this);c.getElementsBy(function(f){if(!GrahamTechnology.util.AJAXProperties.accessibilityOn){return/ygtv(([tl][pmn]h?)|(content))/.test(f.className)}else{return/ygtvcontent/.test(f.className)}},"td",b.getEl().firstChild,function(g){c.addClass(g,YAHOO.widget.TreeView.FOCUS_CLASS_NAME);if(!e){var f=g.getElementsByTagName("a");if(f.length){f=f[0];f.focus();b._focusedItem=f;a.on(f,"blur",function(){if(b.tree){b.tree.fireEvent("focusChanged",{oldNode:b.tree.currentFocus,newNode:null});b.tree.currentFocus=null}b._removeFocus()});e=true}}b._focusHighlightedItems.push(g)});if(e){this.tree.fireEvent("focusChanged",{oldNode:this.tree.currentFocus,newNode:this});this.tree.currentFocus=this}else{this.tree.fireEvent("focusChanged",{oldNode:b.tree.currentFocus,newNode:null});this.tree.currentFocus=null;this._removeFocus()}return e};YAHOO.widget.Node.prototype.getNodeHtml=function(){var b=[];var a=0;b[b.length]='<table id="ygtvtableel'+this.index+'"border="0" cellpadding="0" cellspacing="0" class="ygtvtable ygtvdepth'+this.depth;if(this.enableHighlight){b[b.length]=" ygtv-highlight"+this.highlightState}if(this.className){b[b.length]=" "+this.className}b[b.length]='"><tr class="ygtvrow">';for(a=0;a<this.depth;++a){b[b.length]='<td class="ygtvcell '+this.getDepthStyle(a)+'" ><div class="ygtvspacer"></div></td>'}if(this.hasIcon){b[b.length]='<td id="'+this.getToggleElId();b[b.length]='" class="ygtvcell ';b[b.length]=this.getStyle();b[b.length]='"><a href="#" class="ygtvspacer">&nbsp;'+((GrahamTechnology.util.AJAXProperties.accessibilityOn)?'<span style="height: 1px; width: 1px; position: absolute; overflow: hidden; top: -10px">'+(this.hasChildren()?((this.expanded)?"Expanded":"Collapsed"):"")+"</span>":"")+"</a></td>"}b[b.length]='<td id="'+this.contentElId;b[b.length]='" class="ygtvcell ';b[b.length]=this.contentStyle+' ygtvcontent" ';b[b.length]=(this.nowrap)?' nowrap="nowrap" ':"";b[b.length]=">";b[b.length]=this.getContentHtml();b[b.length]="</td></tr></table>";return b.join("")};YAHOO.widget.Node.prototype.updateIcon=function(){if(this.hasIcon){var a=this.getToggleEl();if(a){if(GrahamTechnology.util.AJAXProperties.accessibilityOn&&this.expanded){if(a.innerHTML){a.innerHTML=a.innerHTML.replace("Collapsed","Expanded")}}else{if(a.innerHTML){a.innerHTML=a.innerHTML.replace("Expanded","Collapsed")}}a.className=a.className.replace(/\bygtv(([tl][pmn]h?)|(loading))\b/gi,this.getStyle())}}};GrahamTechnology.ui.TreeNode=function(){};