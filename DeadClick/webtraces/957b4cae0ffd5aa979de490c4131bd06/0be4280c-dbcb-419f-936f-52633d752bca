function triggerProductChanged(nId){if(nId.indexOf("_")===0){nId=nId.substring(1,nId.length)}if(nsc("#prodcode").length>0&&nsc("#prodcode").val()!=nId){nsc("#prodcode").val(nId);setTimeout("updateProductSelection(),nsc.fn.nitrobox.close();",300)}else{if(nsc("#nitro_loading").css("display")=="block"){nsc("#nitro_loading").css("display","none")}}}function strInArray(strNeedle,aryHaystack){for(var i in aryHaystack)if(aryHaystack[i]==strNeedle)return i;return false}function sanitizeValue(value){if(typeof value=="string"&&value)return value.replace("&pound;","Â£");return value}var arySelected=[];function populateSelect(number,nCount,selectedValue,boolFirstTime){arySelected=[];for(var i=1;i<=nCount;i++){var iIndexOfUnderScore=String(selectedValue).indexOf("_");if(iIndexOfUnderScore<0){selectedValue="_"+selectedValue}arySelected[i]=arrMatrix[selectedValue]["componentdetail"+i]}for(var i=1;i<=nCount;i++){if(nsc("#seldim"+i).val()){arySelected[i]=arrMatrix[nsc("#seldim"+i).val()]["componentdetail"+i];if(i==2&&nCount==3){var selDimElt=document.getElementById("seldim"+(i-1));var sParentValue=selDimElt.options[selDimElt.selectedIndex].text;var aryChildren=[];for(var nId in arrMatrix)if(arrMatrix[nId]["componentdetail"+(i-1)]==sParentValue)aryChildren[aryChildren.length]=arrMatrix[nId]["componentdetail"+i];if(!strInArray(arySelected[i],aryChildren))arySelected[i]=aryChildren[0]}}}var aryDone=[];var aryIndex=[];var aryDone=[];var nProductId=0;for(var nDim=1;nDim<=nCount;nDim++){aryDone[nDim]=[];aryIndex[nDim]=0;nsc("#seldim"+nDim).empty()}for(var nId in arrMatrix){var bHasOption=true;for(var nDim=1;nDim<=nCount;nDim++){if(nDim>1){if(arrMatrix[nId]["componentdetail"+(nDim-1)]!=arySelected[nDim-1]){bHasOption=false;break}}if(bHasOption){if(!strInArray(arrMatrix[nId]["componentdetail"+nDim],aryDone[nDim])){var objCurSel=document.getElementById("seldim"+nDim);objCurSel.options[aryIndex[nDim]]=new Option(sanitizeValue(arrMatrix[nId]["componentdetail"+nDim]),nId);aryDone[nDim][aryIndex[nDim]]=arrMatrix[nId]["componentdetail"+nDim];if(arySelected[nDim]==arrMatrix[nId]["componentdetail"+nDim])objCurSel.selectedIndex=aryIndex[nDim];if(aryIndex[nDim]==0&&nDim==nCount)nProductId=nId;aryIndex[nDim]++}if(nDim==nCount){nTmp=1;while(nTmp<=nCount){if(arrMatrix[nId]["componentdetail"+nTmp]!=arySelected[nTmp])break;else if(nCount==nTmp)nProductId=nId;nTmp++}}}}}if(nProductId){triggerProductChanged(nProductId)}}function selectDimension(number,nCount,selectedValue,boolFirstTime){var nNewProductID=selectedValue;arySelected[number]=arrMatrix[selectedValue]["componentdetail"+number];for(var nProductID in arrMatrix){nDim=1;while(arrMatrix[nProductID]["componentdetail"+nDim]==arySelected[nDim]){if(nDim==nCount){nNewProductID=nProductID;break}nDim++}}populateImageSelect(number,nCount,nNewProductID,boolFirstTime);if(nsc(window).width()>800){if(typeof nsc.fn.jqzoom!=="undefined"){var jqZoomOptions={zoomWidth:350,zoomHeight:400,preloadImages:false,title:false};nsc("#productphoto").parents("a").eq(0).each(function(){nsc(this).addClass("popupBoxImages").jqzoom(jqZoomOptions)})}}}function getDimensionImage(nProductID,bSelected){var sImageName="";sImageName=arrMatrix[nProductID]["product_imageurl"].replace(/([^\/\/]*)$/,"thumb-"+"$1");return sImageName}function displayImage(){arrOptions["dimension"+nDim][sDimensionValue]=nProductID;var objAttribute=nsc('<img src="'+getDimensionImage(nProductID,nDim,bDimensionIsSelected,nCount)+'" onclick="selectDimension('+nDim+","+nCount+", "+nProductID+', false)" width="35" height="25"/>');objAttribute.attr({title:sDimensionValue,alt:sDimensionValue});if(bDimensionIsSelected){arySelected[nDim]=sDimensionValue;objTable.find("#selecteddimension-"+nDim).text(sDimensionValue);objAttribute.attr("class","selected")}objContent.append(objAttribute)}function populateImageSelect(number,nCount,selectedValue,boolFirstTime){if(nCount!=0&&selectedValue!=0){var iIndexOfUnderScore=String(selectedValue).indexOf("_");nsc("#matrixitemoptions").hide();nsc("#matrixselector").remove();if(iIndexOfUnderScore<0){selectedValue="_"+selectedValue}if(arySelected.length==0){for(var e=1;e<=nCount;e++){arySelected[e]=arrMatrix[selectedValue]["componentdetail"+e]}}var aryDone=new Array;var aryIndex=new Array;var aryDone=new Array;var nProductId=0;var arrOptions={};var objTable=nsc('<div id="matrixselector" />');if(nMatrixImage>nCount){nMatrixImage=nCount}for(var nDim=1;nDim<=nCount;nDim++){objTable.append('<div><div><span id="dimension-'+nDim+'"></span><span id="selecteddimension-'+nDim+'" /></div>');objTable.find("#dimension-"+nDim).html(nsc("#matrixtitle"+nDim).text());arrOptions["dimension"+nDim]={};var sDimensionName=nsc("#matrixtitle").text();var objRow=nsc("<div>").attr("class",sDimensionName);objRow.append("<div>");var objContent=objRow.find("div").eq(0);for(var nProductID in arrMatrix){var sDimensionValue=arrMatrix[nProductID]["componentdetail"+nDim];var bDimensionIsSelected=arrMatrix[selectedValue]["componentdetail"+nDim]==sDimensionValue;var sColor=arrMatrix[nProductID]["product_weblinxcustomtext3"];if(bDimensionIsSelected&&nProductID==selectedValue||!bDimensionIsSelected&&!arrOptions["dimension"+nDim][sDimensionValue]){if(nDim<nCount||nCount==1){arrOptions["dimension"+nDim][sDimensionValue]=nProductID;if(nDim==nMatrixImage){var objAttribute=nsc('<div class="matriximage"><img src="'+getDimensionImage(nProductID,bDimensionIsSelected)+'" onclick="selectDimension('+nDim+","+nCount+", '"+nProductID+'\', false);" width="35" height="25"/></div>')}else{var objAttribute=nsc('<a href="#" onclick="selectDimension('+nDim+","+nCount+", '"+nProductID+"', false);\" >"+sDimensionValue+"</a>")}objAttribute.attr({title:sDimensionValue,alt:sDimensionValue});if(bDimensionIsSelected){arySelected[nDim]=sDimensionValue;objTable.find("#selecteddimension-"+nDim).text(sDimensionValue);objAttribute.attr("class","selected")}objContent.append(objAttribute)}if(nDim==nCount&&nCount!=1&&(nDim==1||arrMatrix[selectedValue]["componentdetail1"]==arrMatrix[nProductID]["componentdetail1"])&&(nDim==2||arrMatrix[selectedValue]["componentdetail2"]==arrMatrix[nProductID]["componentdetail2"])){arrOptions["dimension"+nDim][sDimensionValue]=nProductID;if(nDim==nMatrixImage){var objAttribute=nsc('<div class="matriximage"><img src="'+getDimensionImage(nProductID,bDimensionIsSelected)+'" onclick="selectDimension('+nDim+","+nCount+", '"+nProductID+'\', false);" width="35" height="25"/></div>')}else{var objAttribute=nsc('<a href="#" onclick="selectDimension('+nDim+","+nCount+", '"+nProductID+"', false);\" >"+sDimensionValue+"</a>")}objAttribute.attr({title:sDimensionValue,alt:sDimensionValue});if(bDimensionIsSelected){arySelected[nDim]=sDimensionValue;objTable.find("#selecteddimension-"+nDim).text(sDimensionValue);objAttribute.attr("class","selected")}objContent.append(objAttribute)}}}objTable.append(objRow)}nsc("#matrixitemoptions").after(objTable);if(!boolFirstTime){triggerProductChanged(selectedValue)}}}function validateQty(errMessage,errOutofStock,errLowerQty,bAllowZero){bAllowZero=bAllowZero||false;if(bAllowZero){return true}var nQty=0;if(nsc("#quantity").val()!=null)nQty=parseInt(nsc("#quantity").val());var nFractionQty=0;if(nsc(document.forms.frmMain.quantity_fraction).length>0){nFractionQty=parseFloat(nsc(document.forms.frmMain.quantity_fraction).val());nQty=parseFloat(nQty);nQty=nQty+nFractionQty}if(errOutofStock==null||errOutofStock.length==0)errOutofStock="Sorry, this item is out of stock.";if(errLowerQty==null||errLowerQty.length==0)errLowerQty="Please enter a lower quantity. The current stock level is: %d.";if(nsc("#nitro_content #prodcode").length){var nStockQty=parseFloat(arrMatrix["_"+nsc("#nitro_content #prodcode").val()]["product_stock"],10)}else{var nStockQty=parseFloat(arrMatrix["_"+nsc("#prodcode").val()]["product_stock"],10)}if(nQty>0){if(bLimitInStockPurchases&&nQty>nStockQty){if(nStockQty<1)alert(errOutofStock);else alert(errLowerQty.replace("%d",nStockQty));if(nsc(document.forms.frmMain.quantity).length>0)document.forms.frmMain.quantity.focus();else if(nsc(document.forms.frmMain.quantity_fraction).length>0)document.forms.frmMain.quantity_fraction.focus();return false}else{return true}}else if(nQty==0){if(bLimitInStockPurchases&&nStockQty<1){alert(errOutofStock);return false}else{return true}}else{alert(errMessage);return false}}var matrixNumElements=0;var matrixProductId=0;var matrixDivReplacement="";var nImagePointer=1;function refreshItemData(nId,numberDimensions,divName,nImages){matrixNumElements=numberDimensions;matrixProductId=nId;matrixDivReplacement=divName;if(nsc(".page-product").length){URLparam="/store/store.asp?action=get_product_data&prodcode="+nId}else{URLparam="/store/store.asp?action=get_preview_data&prodcode="+nId}nsc.get(URLparam,function(sData,sStatus){if(sStatus=="success"){nsc(matrixDivReplacement).html(sData);if(nImages>0){populateImageSelect(1,matrixNumElements,matrixProductId,true)}else{populateSelect(1,matrixNumElements,matrixProductId,true)}var imagePath=arrMatrix["_"+nId]["product_imageurl"];var imagePathParts=imagePath.replace(/^\/|\/$/,"").split(/\/{1,2}/g).reverse();originalProductImage=imagePathParts[0];nsc(document).trigger("matrixupdated");if(typeof gapi!="undefined"){gapi.plusone.go()}}})}function tellAFriend(){nsc("#product_id").val(nsc("#prodcode").val());nsc("#frmTell").submit()}function getProductImageSource(sViewName,imagesrc){if(!imagesrc)imagesrc=originalProductImage;if(sViewName!="")imagesrc=escape(sViewName)+"-"+imagesrc;return sNSCImagePath+imagesrc}function changeProductPhotoView(profile,newimagesrc){if(newimagesrc){originalProductImage=newimagesrc}nsc("#productphoto").prop("src",getProductImageSource(profile));if(typeof nsc.fn.jqzoom!=="undefined"&&nsc(window).width()>800){var jqZoomOptions={zoomWidth:350,zoomHeight:400,preloadImages:false,title:false};nsc("a.popupBoxImages").prop("href",getProductImageSource("large"+profile)).unbind().jqzoom(jqZoomOptions);enablePopupBox()}else{nsc("a.popupBoxImages").prop("href",getProductImageSource("large"+profile))}for(var i=0,l=arrProductImages.length;i<l;++i)(function(index,elt,sProfile){var sCurrentImgAlt=elt.alt||"";var sCurrentProfile=sCurrentImgAlt.substr(0,sCurrentImgAlt.indexOf("-view")).replace("default","");if(sCurrentProfile==sProfile){nImagePointer=index+1}})(i,arrProductImages[i],profile)}function setReviewUseful(reviewId,useful,sThanksText){nsc.get("/store/store.asp?action=do&doaction=ratereview&productreview_id="+reviewId+"&useful="+useful,null);var reviewElem=nsc("#review-useful-"+reviewId);if(sThanksText)reviewElem.html("<p><em>"+sThanksText+"</em></p>");else reviewElem.html("<p><em>Thank you! Your feedback has been recorded.</em></p>")}function loginRedirect(){nsc("#login-redirect").submit()}function registerRedirect(){nsc("#register-redirect").submit()}function checkStoreSelectStore(){nsc.get("/store/store.asp?action=do&doaction=checkstockstorelist",function(sData,sStatus){if(sStatus=="success")nsc("#stockcheck").html(nsc.parseHTML(sData))})}function checkStoreStockByProductId(nStoreId,nProductId){nsc.get("/store/store.asp?action=do&doaction=checkstockatstore&store_id="+nStoreId+"&product_id="+nProductId,function(sData,sStatus){if(sStatus=="success")nsc("#stockcheckresult").html(sData)})}function goForward(){showDivs(nImagePointer+=1)}function goBack(){showDivs(nImagePointer-=1)}function showDivs(nCounter){if(nCounter>arrProductImages.length){nImagePointer=1}if(nCounter<1){nImagePointer=arrProductImages.length}var objCurrentImg=arrProductImages[nImagePointer-1];nsc("#modal-image .container-fluid img").prop("src",objCurrentImg.href);nsc("#modal-image .container-fluid img").prop("alt",objCurrentImg.alt);nsc("#modal-image .container-fluid figcaption").html(function(index,sCurrentHtml){return arrProductImages.length>1?objCurrentImg.name:objCurrentImg.name})}function enablePopupBox(){nsc("div.product-image a:first").off("click").on("click",function(evt){evt.preventDefault();var arrImgSet=arrProductImages;var s='<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>';s+='<figure><img class="img-responsive" src="'+arrImgSet[nImagePointer-1].href+'" alt="'+arrImgSet[nImagePointer-1].alt+'">';s+="<figcaption>"+arrImgSet[nImagePointer-1].name+"</figcaption></figure>";var sPrevClass="previous";var sNextClass="next";var sPaginationLink="";if(arrProductImages.length>1){sPaginationLink+='<ul class="pager">';sPaginationLink+='<li class="'+sPrevClass+'">';sPaginationLink+='<a id="prevImgLink" href="#" onclick="goBack();">&laquo; Prev</a>';sPaginationLink+="</li>";sPaginationLink+='<li class="'+sNextClass+'">';sPaginationLink+='<a id="nextImgLink" href="#" onclick="goForward();">Next &raquo;</a>';sPaginationLink+="</li>";sPaginationLink+="</ul>"}showModalWindow("modal-image","","",s+(sPrevClass.indexOf("disabled")!==-1&&sNextClass.indexOf("disabled")!==-1?"":sPaginationLink));nsc(document).one("hidden.bs.modal","#modal-image",function(evt){var sView=nsc(this).find(".container-fluid").find("img").prop("alt")||"default-view";sView=sView.substr(0,sView.indexOf("-view")).replace("default","");if(sView){changeProductPhotoView(sView)}else{changeProductPhotoView("",originalProductImage)}nsc(this).find(".container-fluid").html("")})})}function addBackInStockNotification(nProductId){arrParams={action:"do",doaction:"backinstocknotification",customer_email:nsc("#customer_email").val(),customer_fullname:nsc("#customer_fullname").val(),product_id:nProductId};nsc.post("/store/store.asp",arrParams,function(sHTML){var arrResult=nsc.parseJSON(sHTML);if(arrResult["result"]==0)nsc("#backinstockemail").focus();else hideModalWindow();nsc.noticeAdd({text:arrResult["message"],stay:false,type:arrResult["result"]==0?"error":"success",href:"/store/go/basket/"})})}function displayBackInStockNotificationModal(nProductId){nsc.get("/store/store.asp?action=do&doaction=getbackinstockmodal&product_id="+nProductId,"",function(sHTML){var arrData=nsc.parseJSON(sHTML);showModalWindow("modal-backinstock","",arrData["header"],arrData["body"]);nsc("#customer_fullname").focus()});return false}function displayBackInStockNotificationForm(nProductId,sTitle,sText,sName,sEmail,sConfirmBtn,sCancelBtn){populateBackInStockCustomerDetails();var sBackInStockContentHeader=sTitle;var sBackInStockContent='<div class="col-sm-12" id="backinstock">'+'<div class="col-sm-11">'+sText+"</div>"+'<form class="form-horizontal" onsubmit="return false";>'+'<div class="form-group">'+'  <label for="customer_fullname" class="col-sm-2 col-sm-offset-1 control-label">'+sName+"</label>"+'  <div class="col-sm-6">'+'    <input type="text" class="form-control" id="customer_fullname" name="customer_fullname">'+"  </div>"+"</div>"+'<div class="form-group">'+'  <label for="customer_email" class="col-sm-2 col-sm-offset-1 control-label">'+sEmail+"</label>"+'  <div class="col-sm-6">'+'    <input type="email" class="form-control" id="customer_email" name="customer_email">'+"  </div>"+"</div>"+'<div class="form-group">'+'  <div class="col-sm-12">'+'    <input type="button" name="CONFIRM" value="'+sConfirmBtn+'" onClick="addBackInStockNotification('+nProductId+')" class="btn btn-primary">'+'    <input type="button" name="CANCEL" value="'+sCancelBtn+'" onClick="hideModalWindow()"; class="btn btn-primary">'+"  </div>"+"</div>"+"</form>"+"</div>";showModalWindow("modal-backinstock","",sBackInStockContentHeader,sBackInStockContent);nsc("#customer_fullname").focus();return false}function populateBackInStockCustomerDetails(){nsc.get("/store/store.asp?action=do&doaction=getcustomerdetails","",function(sHTML){var arrResult=nsc.parseJSON(sHTML);if(arrResult["result"]==1){nsc("#customer_email").val(arrResult["customer_email"]);nsc("#customer_fullname").val(arrResult["customer_fullname"])}})}function loadJQZoom(){if(nsc(window).width()>800){if(typeof nsc.fn.jqzoom!=="undefined"){var jqZoomOptions={zoomWidth:350,zoomHeight:400,preloadImages:false,title:false};nsc("#productphoto").parents("a").eq(0).each(function(){nsc(this).addClass("popupBoxImages").unbind().jqzoom(jqZoomOptions)})}}enablePopupBox()}function switchToReviewsTab(){if(location.hash.substr(1)=="reviews"){$(document).ready(function(){$("#rev").click()})}}nsc(document).ready(function(){enablePopupBox();if(typeof nsc.fn.jqzoom!="undefined"){loadJQZoom()}enablePopupBox();if(typeof gapi!="undefined"){gapi.plusone.go()}});