define(["jquery","wcs.topbar-bg","pubsub"],function(c,b,a){(function(h,g,d,i){var f="topbarAccordion";var e=function(k,j){this.element=k;this.options=j;this.defaults={$featuredItemsLists:h(".featured-items-list",k)}};e.prototype={defaults:{},init:function(){var j=this;j.config=h.extend({},j.defaults,j.options,j.metadata);j.build();j.events();j.drawMenu();return j},build:function(){var j=this;j.buildShopAllLinks();j.moveFeaturedLinks()},buildShopAllLinks:function(){var k=this,j="";j+=".topnav-main-item.has-dropdown-js";j+=",.topnav-main-item .sub-category.has-dropdown:not(:has(>ul>li>.all))";j+=",.topnav-main-item-stacked-subsection-item:not(:has(>ul>li>.all))";j+=",.topnav-main-item-list-item";j+=",.topnav-main-item-minilist-item";h(j,h(k.element)).each(function(){var m=h(this).find("a").eq(0),l=m.attr("href"),n=m.text();h(this).find("ul").eq(0).prepend('<li class="shop-all-link shop-all-link-js hide-for-medium-up"><a href="'+l+'">Shop all '+n+"</a></li>")})},moveFeaturedLinks:function(){var j=this,l=j.config.$featuredItemsLists,k="append";if(l.length>0){if(main.screen.size()!=="small"){k="prepend"}l.each(function(m,n){h(n).parent()[k](n)})}},events:function(){var j=this;h(".toggle-topbar-js").on("click",function(k){k.preventDefault();return false});h(".toggle-topbar-js").click(function(){h(".top-bar-acord-js").toggleClass("expanded");if(main.screen.size()==="small"){if(h(".top-bar-acord-js").hasClass("expanded")){setTimeout(function(){j.showNavPanel()},250)}else{setTimeout(function(){j.hideNavPanel()},250)}}});h(d).on("click",".top-bar-acord-js .has-dropdown-js > a",function(k){if(main.screen.size()==="small"){k.preventDefault();if(h(this).hasClass("expanded")){h(this).removeClass("expanded");h(this).parent().find(".expanded").removeClass("expanded");h(this).blur()}else{h(this).addClass("expanded");h(this).parent().find("ul").eq(0).addClass("expanded");if(h(this).parent().find("ul").eq(0).hasClass("thumbnails")){h(this).parent().find("ul").eq(0).find("ul").addClass("expanded")}}}});h.pubsub("subscribe","window.resize.breakpoint",function(k,l){if(l.now!=="small"){j.hideNavPanel()}j.drawMenu(l.now)})},showNavPanel:function(){var j=this;h("body").on("click.topbarAccordion.dismiss",function(k){if(h(k.target).closest(h(j.element)).length===0){k.preventDefault();j.hideNavPanel()}});b.show()},hideNavPanel:function(){var j=this;h("body").off("click.topbarAccordion.dismiss");if(h(".top-bar-acord-js").hasClass("expanded")){h(".top-bar-acord-js").toggleClass("expanded")}b.hide()},drawMenu:function(k){var j=this;k=k||main.screen.size();h(".expanded",h(j.element)).removeClass("expanded");if(k==="small"){j.drawSmallMenu()}else{j.drawLargeMenu()}j.moveFeaturedLinks()},drawSmallMenu:function(){h(".dropdown").find("ul").addClass("dropdown").parent().addClass("has-dropdown-js");h(".top-bar-acord-js").find(".topnav-main-item.has-dropdown").each(function(){h(this).find(".dropdown").css({width:"100%"})})},drawLargeMenu:function(){var j=this,k=h(".top-bar-acord-js .lower").find("> .has-dropdown-js:not(.gnav-more)");k.each(function(){j.toggleDropdownClass(h(this));j.setDesktopMenuWidth(h(this))})},toggleDropdownClass:function(k){var j;if(WCS_CONFIG.get("topnav::navHeaderIncludeDropdownsInMore")===true){j=".dropdown:not(.mini-list)"}else{j=".dropdown"}k.children(j).find(".has-dropdown-js").addClass("mega").end().find(".has-dropdown-js").removeClass("has-dropdown-js").end().find(".dropdown").removeClass("dropdown")},setDesktopMenuWidth:function(k){var l,j=parseInt(k.find("> .dropdown").css("max-width"));l=Math.min(j,g.innerWidth);k.find("> .dropdown").css({width:l+"px"})},};e.defaults=e.prototype.defaults;h.fn.topbarAccordion=function(j){return this.each(function(){var k=h(this).data(f);if(!k){k=new e(this,j).init();h(this).data(f,k)}})}})(jQuery,window,document)});