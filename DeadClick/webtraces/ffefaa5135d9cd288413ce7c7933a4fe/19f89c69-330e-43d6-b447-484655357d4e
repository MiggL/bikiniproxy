define(["jquery","pubsub","state-manager","wcs.context","wcs.product-availability","wcs.alert","wcs.find-in-store-model","wcs.product-price","wcs.product-form-util","promise!wcs.zmetrics","datalayer.wcs.product-form","jquery.tooltipster","coremetrics.wcs.product-form"],function(g,j,p,q,o,i,d){var m=false,h=false;var e,a=WCS_CONFIG.get("PDP::authOnlineDealerEnabled")&&g(".quickview-box-js").length===0,f=WCS_CONFIG.get("PDP::notifyMeEnabled")&&g(".quickview-box-js").length===0,b=WCS_CONFIG.get("PDP::pdpSizeSelectorBoxDisplayEnabled"),l=g("body.pdp-drawer, .quickview-box.pdp-drawer").length||false,n=(l&&b)||false,k=WCS_CONFIG.get("PDP::pdpShowStockAvailabilityDisclaimerEnabled");var c=function(){if(!(this instanceof c)){return new c()}return this};c.prototype={initProductFormCore:function(){console.log("Initializing Product Form");this.setInitialState();this.findElements();this.cacheSelectors();this.unbindSharedProductFormEvents();this.initSharedProductFormEvents();this.initChildren();if(!this.isOneSizeProduct&&!this.isPreselectedProduct){this.disableFindInStoreAndAddToWishlist()}return this},setInitialState:function(){if(m){console.log("setInitialState")}this.stateManager=this.stateManager||new p();this.stateManager.setProperty({productFormIndex:this.productFormIndex=g(".product-form-js").index(this.productForm)});this.state=this.stateManager.getState();if(m){window.productFormState=[];window.productFormState[this.productFormIndex]=this.state}return this},selectAttributes:function(){if(this.isColorWayBundle){return this.productForm.find(".selection-js[data-attribute-id]")}return this.productForm.find(".selection-js[data-attribute-id]:visible")},findElements:function(){if(m){console.log("findElements")}this.templateType=WCS_CONFIG.get("PDP::pdpTemplateType");this.isPDPSwatches=this.templateType==="swatches";this.isColorWayBundle=this.templateType==="basic";this.isDrawer=this.templateType==="drawer";this.productAvailJSON=null;this.$attributes=this.selectAttributes();this.$attrValueMap=null;this.categoryId=q.getCategoryId();this.storeId=q.getStoreId();this.langId=q.getLangId();this.productId=this.productForm.find("input[name=catEntryId]").val();this.productAvailability=null;this.onlineDealer=null;this.catEntryId=null;this.catalogId=q.getCatalogId();this.availabilityUrl=q.getURLWithContextRoot("VFAjaxProductAvailabilityView");this.onlineDealerURL=null;this.firstLoad=null;this.quantity=null;this.tooltipsterObj=null;this.btnOutOfStockText=null;this.isOneSizeProduct=g(".attr-size .attr-box-js").length===1;this.isPreselectedProduct=false;this.onlineDealersPlugin=this.productForm.find(".online-dealer-js").data("OnlineDealers")||{};this.hasAgeVerification=g(".age-verify-js").length>0;if(this.productForm.hasClass("first-load-js")){this.firstLoad=true;this.productForm.removeClass("first-load-js")}else{this.firstLoad=false}this.productForm.removeClass("context-changed-js");if(this.productForm.data("avail-url")){this.availabilityUrl=q.getURLWithContextRoot(this.productForm.data("avail-url"))}this.isShopTheLook=g("body.catalog.bundle").length>0;this.quantity=this.productForm.find(".quantity");this.$quantityBox=this.productForm.find(".quantity-js")},cacheSelectors:function(){this.addToCartButton=this.productForm.find(".add-to-bag-js");this.addToCartText=this.addToCartButton.text();this.addToWishlistButton=this.productForm.find(".add-to-wishlist-js");this.updateItemButton=this.productForm.find(".shopcart-update-js");this.nonBuyableIndicator=this.productForm.find(".pdp-nonbuyable-js");this.outOfStockIndicator=this.productForm.find(".pdp-outofstock-js");this.outOfStockMessageContainer=this.productForm.find(".out-of-stock-js");this.availableNotifcationSection=this.productForm.find(".available-notification-section-js");this.formSellingSection=this.productForm.find(".selling-form-section-js")},initChildren:function(){if(m){console.log("initChildren")}var r=this;this.initProductAvailability().done(function(s){if(s){if(m){console.log("calling handleAvailabilityResponse, data : ",s)}r.handleAvailabilityResponse(s)}})},unbindSharedProductFormEvents:function(){if(m){console.log("unbindSharedProductFormEvents")}this.$quantityBox.off("keyup");g.pubsub("unsubscribe",this.newColorWayProductEvent);g.pubsub("unsubscribe",this.productFormMouseLeaveEvent);g.pubsub("unsubscribe",this.productFormAttributeChangeCompleteEvent);g.pubsub("unsubscribe",this.productAvailabilityAllSetEvent)},initSharedProductFormEvents:function(){if(m){console.log("initSharedProductFormEvents")}var r=this;g(document).on("closed","#modal, .quickview-modal","[data-reveal]",function(s){r.unbindSharedProductFormEvents()});if(this.firstLoad){this.addToWishlistButton.on("click",function(s){if(h){console.log("add to wishlist click")}r.addToWishList(s);r.addToWishListMessaging(s)})}this.productForm.find(".find-store-js").on("click",function(){if(h){console.log("find store click")}r.checkAllAttributeSelection()});this.$quantityBox.on("keyup",this.handleQuantityTextFieldInputChange);this.newColorWayProductEvent=g.pubsub("subscribe","WCS.PRODUCTFORM.COLORWAY_PRODUCT.NEW",function(t,s){if(h){console.log("capture :","WCS.PRODUCTFORM.COLORWAY_PRODUCT.NEW")}if(s.formIndex===r.productFormIndex){r.initProductFormCore()}});this.productFormMouseLeaveEvent=g.pubsub("subscribe","WCS.PRODUCTFORM.EVENT.ATTR.MOUSE.LEAVE",function(){if(h){console.log("capture :","WCS.PRODUCTFORM.EVENT.ATTR.MOUSE.LEAVE")}r.initProductAvailability()});this.productFormResolveQuantityEvent=g.pubsub("subscribe","WCS.PRODUCTFORM.RESOLVEQUANTITY",function(t,s){if(s===r.productFormIndex){if(h){console.log("capture :","WCS.PRODUCTFORM.RESOLVEQUANTITY")}r.resolveQuantity()}});this.productFormAttributeChangeCompleteEvent=g.pubsub("subscribe","WCS.PRODUCTFORM.ATTRIBUTE.CHANGE.COMPLETE",function(t,s){if(s.formIndex===r.productFormIndex){if(h){console.log("capture :","WCS.PRODUCTFORM.ATTRIBUTE.CHANGE.COMPLETE")}r.handleAttributeChangeComplete(s)}});this.productAvailabilityAllSetEvent=g.pubsub("subscribe","WCS.PRODUCT_AVAILABILITY.ALL_AVAILABLE_SET",function(t,s){if(s===r.productFormIndex){if(h){console.log("capture :","WCS.PRODUCT_AVAILABILITY.ALL_AVAILABLE_SET")}r.handleProductAvailabilityAllSet()}})},handleQuantityTextFieldInputChange:function(s){var r=/^[1-9][0-9]*$/,u=this.value,t=g(this).parent().find(".invalid-quantity-error-js");if(!r.test(u)){this.value="";t.removeClass("hide")}else{t.addClass("hide")}},initAttributeValues:function(){if(m){console.log("initAttributeValues")}var r=this;this.$attributes.each(function(){var s=g(this);s.find("[data-attribute-value]").each(function(){r.productAvailability.addAttributeValue(g.productFormUtil.attributeName(s),g.productFormUtil.attributeValue(g(this)))})})},initPreselectedValues:function(){if(m){console.log("initPreselectedValues")}var r=this;this.$attributes.each(function(){var s=g(this);r.productAvailability.select(g.productFormUtil.attributeName(s),g.productFormUtil.attributeValue(s.find(".selected")));if(g.productFormUtil.attributeValue(s.find(".selected"))){s.addClass("attribute-value-selected");r.isPreselectedProduct=true}else{r.isPreselectedProduct=false}});this.stateManager.setProperty({isPreselectedProduct:this.isPreselectedProduct});g.pubsub("publish","WCS.PRODUCTFORM.PRESELECTED_VALUES.INIT",r.isPreselectedProduct)},handleAttrFirstLoad:function(){if(m){console.log("handleAttrFirstLoad")}if(this.firstLoad){this.setupAttrValueMap();if(!g(".quickview-box-js")){g(".pdp-swatches .attr-color .selected").addClass("clicked");g(".pdp-swatches .attr-size .selected").addClass("clicked")}}},initProductAvailability:function(){if(m){console.log("initProductAvailability")}this.productAvailability=new o(this.productFormIndex);var s=this,r=g.Deferred();this.initAttributeValues();this.handleAttrFirstLoad();this.initPreselectedValues();this.productAvailability.onChange(this,this.handleAvailabilityChange);if(this.isColorWayBundle||this.isDrawer||this.isShopTheLook||n){this.productAvailJSON=null}if(n){this.productId=g("input[name=catEntryId]").val()}if(!this.productAvailJSON){g.ajax({url:this.availabilityUrl,data:{storeId:this.storeId,langId:this.langId,productId:this.productId},context:this,async:false}).always(function(t){r.resolve(t)})}else{this.handleAvailabilityResponse(this.productAvailJSON)}return r.promise()},setBuyableFlag:function(r){if(m){console.log("setBuyableFlag")}if(r.buyable=="false"){this.hideFormSectionsForNotBuyable();return false}this.nonBuyableIndicator.addClass("hide");return true},hideFormSectionsForNotBuyable:function(){if(m){console.log("hideFormSectionsForNotBuyable")}this.formSellingSection.each(function(){g(this).addClass("hide")});this.outOfStockIndicator.addClass("hide");this.nonBuyableIndicator.removeClass("hide")},handleInventoryData:function(r){if(m){console.log("handleInventoryData")}this.outOfStockMessageContainer.hide();if(!this.hasInventory(r)){this.handleOutOfStockInventoryDataReturn(r.availabilityDate,r.formattedAvailMonth)}else{this.handleInStockInventoryDataReturn()}},hasInventory:function(s){if(m){console.log("hasInventory")}var r;if(!s.stock){return false}r=Object.keys(s.stock).some(function(t){if(s.stock[t]>0){return true}});return r},handleInStockInventoryDataReturn:function(){if(m){console.log("handleInStockInventoryDataReturn")}this.availableNotifcationSection.addClass("hide");this.outOfStockIndicator.addClass("hide");this.formSellingSection.each(function(){g(this).removeClass("hide")})},handleOutOfStockInventoryDataReturn:function(r,s){if(m){console.log("handleOutOfStockInventoryDataReturn")}var t=g.trim(r),v=t!==""?new Date(t):null,u=new Date();if(WCS_CONFIG.get("PDP::hideAddToCartAllItemsOutOfStock")){this.hideSellingFormSections()}if(v!==null&&v>u){g("#product-availability-date",this.productForm).text(g.trim(s));this.availableNotifcationSection.removeClass("hide");this.outOfStockIndicator.addClass("hide");return}else{if(WCS_CONFIG.get("PDP::hideAddToCartAllItemsOutOfStock")){this.outOfStockIndicator.removeClass("hide")}this.availableNotifcationSection.addClass("hide")}},hideSellingFormSections:function(){if(m){console.log("hideSellingFormSections")}this.formSellingSection.each(function(){if(!g(this).hasClass("disable-inventory-hide-js")){g(this).addClass("hide")}})},handleAvailabilityResponse:function(t){if(m){console.log("handleAvailabilityResponse")}var r=this,s=this.setBuyableFlag(t);if(!s){return}this.productAvailJSON=t;if(this.firstLoad!==true&&!this.productForm.hasClass("context-changed-js")){if(m){console.log("calling rebuildSizeOptions")}this.rebuildSizeOptions(t);this.productForm.addClass("context-changed-js")}if(this.firstLoad===true&&g(".stock-availability-disclaimer").length>0){this.rebuildSizeOptions(t)}if(t.availablePromotions&&(this.isDrawer||this.isColorWayBundle)){this.setPromotionContainerHTML(t.availablePromotions)}if("true"===t.productNotifyMeWhenAvailable){productNMWA=true}else{productNMWA=false}g.productFormUtil.updateBadgeHTML(t.productBadgeHTML);this.handleInventoryData(t);d.setProductAvailabilityJSON(t);if(!t.stock){this.productAvailability.update();this.resolveItemAndResetButtons();return}this.parseAvailabilityDataReturn(t);this.initPreselectedValues();if(t.productPartNumber){this.productForm.data("product-part-number",t.productPartNumber)}},rebuildSizeOptions:function(w){if(m){console.log(" +++++++++++ rebuildSizeOptions +++++++++++, data : ",w)}var s=this,u,t,r,v;r=g(".attr-input-js option, .attr-size .attr-box",this.productForm);this.$parentSection=r.parents(".step-container.selection-js");this.$visibleParentSections=this.$parentSection.filter(":visible");this.$parentSection=this.$visibleParentSections.length>0?this.$visibleParentSections:this.$parentSection;v=this.$parentSection.attr("data-attribute-id");u=w.attributes[v];stock=w.stock;if(s.isPDPSwatches&&!g(".context-trigger-js").length){s.parseSizeOptionsForPDPSwatches(u,stock)}else{s.parseSizeOptionsForNonPDPSwatches(u,stock)}g(".step-container.selection-js").removeClass("attribute-value-selected");this.setupAttrValueMap()},parseSizeOptionsForPDPSwatches:function(t,u){if(m){console.log("parseSizeOptionsForPDPSwatches, sizes, stock : ",t,u)}var r=this,s=g(".attr-size .selected",this.productForm).attr("data-attribute-value");g(".attr-size .attr-box, .attr-size .attr-box-js",this.productForm).remove();t.map(function(x,v){var A=r.isOneSizeProduct?"checkbox":"radio",w=g('<input id="size-bnt-'+v+'" class="hidden-field attr-box-js" type="radio" name="attrValue-2" />'),z=g('<label for="size-bnt-'+v+'" />');if(n){w=g('<input id="size-bnt-'+v+'" class="needsclick product-content-form-size-btn hidden-field attr-box-js" type="'+A+'" name="attrValue-2" />')}w.val(x.display);z.attr("data-attribute-value",x.display);if(x.display===s){z.attr("class","attr-box selected product-content-form-size-btn-label");if(r.isOneSizeProduct){z.attr("class","attr-box selected product-content-form-size-btn-label large")}if(n){z.addClass("clicked")}r.$parentSection.addClass("attribute-value-selected")}else{z.attr("class","attr-box");if(n){z.addClass("product-content-form-size-btn-label")}}if(n&&k){var y=x.catentryId[0],B=u[y];z.attr("data-attribute-stock",B)}z.text(x.display);g(".attr-size .attr-container",r.productForm).append(w).append(z);if(r.isOneSizeProduct&&n){z.click()}})},parseSizeOptionsForNonPDPSwatches:function(s,t){if(m){console.log("parseSizeOptionsForNonPDPSwatches, sizes, stock",s,t)}var r=this;g("select[id$=attr-size] > option:gt(0)",this.productForm).remove();s.map(function(v,u){var x=g("<option />");x.val(v.display);x.attr("data-attribute-value",v.display);x.text(v.display);if(g(".stock-availability-disclaimer").length>0){g(".stock-availability-disclaimer").children().hide();var w=v.catentryId[0],y=t[w];x.attr("data-attribute-stock",y)}g(".attr-input-js",r.productForm).append(x)});g.pubsub("publish","WCS.PRODUCT_FORM.SIZES.PARSE_COMPLETE",s)},parseAvailabilityDataReturn:function(w){if(m){console.log("parseAvailabilityDataReturn ------")}var s=this,u,v,r,t;Object.keys(w.stock).map(function(y,x){s.productAvailability.addAvailableItem(y,w.stock[y])});Object.keys(w.attributes).map(function(y,x){w.attributes[y].map(function(A,z){A.catentryId.map(function(C,B){s.productAvailability.addItemAttributeValue(C,y,A.display)})})});Object.keys(w.partNumbers).map(function(y,x){s.productAvailability.addItemPartNumber(y,w.partNumbers[y])});this.productAvailability.update();this.resolveItemAndResetButtons()},setPromotionContainerHTML:function(s){if(m){console.log("setPromotionContainerHTML")}var r=this;g(".pdp-drawer .discount-container-js").each(function(){g(this).html(s)});g.pubsub("publish","WCS.PRODUCT_FORM.PROMO.RENDER.COMPLETE")},setupAttrValueMap:function(){if(m){console.log("setupAttrValueMap")}var r=this;r.$attrValueMap={};r.$attributes.each(function(){var s=g(this);r.$attrValueMap[g.productFormUtil.attributeName(s)]={};s.find("[data-attribute-value]").each(function(){var t=g(this);r.$attrValueMap[g.productFormUtil.attributeName(s)][g.productFormUtil.attributeValue(t)]=t;if(t.siblings().hasClass("large")){t.addClass("large")}})})},handleAttributeChangeComplete:function(t){if(m){console.log("handleAttributeChangeComplete")}var u,s;this.productAvailability.select(t.attribute,t.attributeValue);this.productAvailability.update();this.resolveItemAndResetButtons(t.eventType);if(this.isPDPSwatches&&this.isShopTheLook){this.checkForOutOfStockSizes()}if(a&&this.productAvailJSON.buyable!=="false"){u=g(".attr-color .selected",this.productForm).attr("data-attribute-value");s=g(".attr-size .selected",this.productForm).attr("data-attribute-value");this.onlineDealersPlugin.getProductColorCode(this.productAvailJSON,u,s)}if(g("#uclw").length){this.selectChangeComplete=true}if(g(".stock-availability-disclaimer").length>0){var r=t.itemStockAttributeValue||g(".attr-size .selected").attr("data-attribute-stock")||0;this.handleStockAvailabilityMsg(r)}},handleStockAvailabilityMsg:function(t){var v=parseInt(t)||0,u=g(".stock-availability-disclaimer"),s=parseInt(u.find(".few-left").attr("data-quantity-amount"))||10,r=parseInt(u.find(".low-stock").attr("data-quantity-amount"))||20;u.children().hide();switch(true){case (v===1):u.find(".last-available").show();break;case (v>1&&v<=s):u.find(".few-left").show();break;case (v>s&&v<=r):u.find(".low-stock").show();break}},resolveItemAndResetButtons:function(t){if(m){console.log("resolveItemAndResetButtons")}var s=this,u=this.$attributes.not(".attribute-value-selected").filter(":visible").length===0,r=this.productAvailability.resolveItem();if(this.isPDPSwatches){this.enableAddToCartButton();this.cleanAddToCartButtonForPDPSwatches()}if(u&&r){if(m){console.log("all selected and itemToBeAssignedAsCatEntryId")}this.catEntryId=r;g.pubsub("publish","WCS.PRODUCTFORM.CURRENT_SELECTION.ALL_SELECTED.EXIST");this.resolveButtonsForAllAttributesSelected()}else{if(u&&!r){if(m){console.log("areAllAttributesSelected and no itemToBeAssignedAsCatEntryId")}g.pubsub("publish","WCS.PRODUCTFORM.CURRENT_SELECTION.ALL_SELECTED.NOT_EXIST");this.handleSelectionNotExist()}else{if(m){console.log("not all selected")}g.pubsub("publish","WCS.PRODUCTFORM.CURRENT_SELECTION.NOT_ALL_SELECTED");this.resolveButtonsForNotAllAttributesSelected()}}this.setAndResolveMaxQuantity();this.productForm.find(".notify-me-response-js").removeClass("message").html("");if(t==="click"||t==="change"){this.stateManager.setProperty({areAllAttributesSelected:u}).setProperty({selections:this.productAvailability.selections}).setProperty({selectionExists:r!=null}).setProperty({catEntryId:r!=null?r:null}).setProperty({selectionHasInventory:this.productAvailability.checkInventory(r)>0}).setProperty({partNumber:this.productAvailability.getPartNumber(r)});g.pubsub("publish","WCS.PRODUCTFORM.SELECTION.UPDATED",this.state)}},resolveButtonsForAllAttributesSelected:function(){if(m){console.log("resolveButtonsForAllAttributesSelected")}var r=this.productAvailability.checkInventory(this.catEntryId)>0;this.setFindInStoreURL();this.updateCatEntryIdDataAttributesAndHiddenFields();if(this.hasAgeVerification){this.updateAgeVerification()}if(a){e=this.onlineDealersPlugin.getOnlineDealers(this.catEntryId)}if(r){g.pubsub("publish","WCS.PRODUCTFORM.CURRENT_SELECTION.HAS_INVENTORY",this.productFormIndex)}else{g.pubsub("publish","WCS.PRODUCTFORM.CURRENT_SELECTION.NOT_HAS_INVENTORY",this.catEntryId);this.resolveSelectionForNotHasInventory()}this.addToWishlistButton.removeClass("disabled");g.pubsub("publish","vfdp.wcs.product_form.add_to_wishlist_message",{formAction:"reset"})},updateCatEntryIdDataAttributesAndHiddenFields:function(){if(m){console.log("updateCatEntryIdDataAttributesAndHiddenFields")}g(".find-store-container-js .find-retail-store-catentryid-js").val(this.catEntryId);this.productForm.data("child-catentry-id",this.catEntryId);this.productForm.data("child-part-number",this.productAvailability.getPartNumber(this.catEntryId))},disableFormErrorMessage:function(){if(m){console.log("disableFormErrorMessage")}g(".select-size-error-js",this.productForm).addClass("hide");g(".size-step-container",this.productForm).removeClass("error")},resolveSelectionForNoInventoryOnPDPSwatchesQuickView:function(r){if(m){console.log("resolveSelectionForNoInventoryOnPDPSwatchesQuickView")}var s="";s=this.addToCartButton.attr("data-qv-out-of-stock");this.addToCartButton.text(s).addClass("disabled");this.updateItemButton.addClass("disabled");this.addToWishlistButton.removeClass("disabled")},resolveSelectionForNotHasInventory:function(){if(m){console.log("resolveSelectionForNotHasInventory")}var t=this.productForm.closest(".quickview-box-js"),u,r,s;if(t.length&&this.isPDPSwatches){this.resolveSelectionForNoInventoryOnPDPSwatchesQuickView(t);return}this.updateAddToCartOutOfStockText();if(this.btnOutOfStockText){this.addToCartButton.text(this.btnOutOfStockText).addClass("btn-out-of-stock");this.updateNotifyMeAvailabilityDate();this.updateAddToCartButtonClassesForOutOfStock()}else{this.updatePDPDrawerAddToCartButtonForOutOfStock()}},updateAddToCartOutOfStockText:function(){if(m){console.log("updateAddToCartOutOfStockText")}if(g("#quickview-box").length&&!this.isDrawer){this.btnOutOfStockText=LANG_MSG.OUT_OF_STOCK}if(a&&e.length>0){this.btnOutOfStockText=this.addToCartButton.attr("data-bfd-text")}else{if(f&&(productNMWA===true)){this.updateAddToCartOutOfStockTextForNotifyMeWhenAvailableEnabled()}else{this.btnOutOfStockText=LANG_MSG.OUT_OF_STOCK}}},updateAddToCartOutOfStockTextForNotifyMeWhenAvailableEnabled:function(){if(m){console.log("updateAddToCartOutOfStockTextForNotifyMeWhenAvailableEnabled")}if(this.addToCartButton.attr("data-notify-me-text")!==undefined){this.btnOutOfStockText=this.addToCartButton.attr("data-notify-me-text")}else{this.btnOutOfStockText=this.addToCartButton.attr("data-out-of-stock-text")}g(".notify-me-catentryid-js",".pdp-swatches-notify-me-form-js").val(this.catEntryId)},updatePDPDrawerAddToCartButtonForOutOfStock:function(){if(m){console.log("updatePDPDrawerAddToCartButtonForOutOfStock")}this.addToCartButton.hide().addClass("disabled");this.productForm.find(".find-brand-store-js").show();this.productForm.find(".notify-me-button-container-js").removeClass("hidden");this.productForm.find(".customize-button-js").hide();this.productForm.find(".qty-step-js").addClass("hide");this.outOfStockMessageContainer.css("display","inline-block")},updateAddToCartButtonClassesForOutOfStock:function(){if(m){console.log("updateAddToCartButtonClassesForOutOfStock")}if(a&&e.length>0){this.addToCartButton.addClass("bfd-active");this.addToCartButton.removeClass("disabled")}else{if(f&&(productNMWA===true)){this.addToCartButton.addClass("notify-me-active");this.addToCartButton.removeClass("disabled")}else{this.updateItemButton.addClass("disabled");this.addToCartButton.addClass("disabled")}}},updateNotifyMeAvailabilityDate:function(){if(m){console.log("updateNotifyMeAvailabilityDate")}var t=this.addToCartButton.attr("data-pdp-available-txt"),s=this.addToCartButton.attr("data-out-of-stock-text"),r=this.addToCartButton.attr("data-product-availability-date");if(this.btnOutOfStockText!==s){return}if(!r){this.productForm.find(".availability-information").hide()}else{this.productForm.find(".available").text(t);this.productForm.find(".availability-date").text(r);this.productForm.find(".availability-information").show()}},resolveButtonsForNotAllAttributesSelected:function(){if(m){console.log("resolveButtonsForNotAllAttributesSelected")}if(this.isColorWayBundle){this.enableAddToCartButton();return}this.disableFindInStoreAndAddToWishlist();this.hideAddToCartButtonForAllItemsOutOfStock();this.disableAddToCartButtonForNotAllSelected();if(this.isDrawer){this.updatePDPDrawerLayoutForNotAllSelected()}},updatePDPDrawerLayoutForNotAllSelected:function(){if(m){console.log("updatePDPDrawerLayoutForNotAllSelected")}this.productForm.find(".notify-me-button-container-js").addClass("hidden");this.productForm.find(".customize-button-js").show();this.productForm.find(".find-brand-store-js").hide()},hideAddToCartButtonForAllItemsOutOfStock:function(){if(m){console.log("hideAddToCartButtonForAllItemsOutOfStock")}if(WCS_CONFIG.get("PDP::hideAddToCartAllItemsOutOfStock")&&this.productAvailJSON&&!this.hasInventory(this.productAvailJSON)){this.addToCartButton.hide();this.outOfStockMessageContainer.css("display","inline-block")}else{this.addToCartButton.show()}},disableAddToCartButtonForNotAllSelected:function(){if(m){console.log("++++++++++++++++ disableAddToCartButtonForNotAllSelected +++++++++++++++")}if(!this.addToCartButton.hasClass("disabled")&&!this.isPDPSwatches&&!this.isDrawer){this.addToCartButton.addClass("disabled")}if(!this.addToCartButton.hasClass("disabled")&&this.isPDPSwatches){this.addToCartButton.removeClass("bfd-active").removeClass("notify-me-active").text(this.addToCartButton.attr("data-add-to-cart-text"));this.productForm.find(".availability-information").hide()}this.updateItemButton.addClass("disabled")},handleSelectionNotExist:function(){if(m){console.log("++++++++++++++ handleSelectionNotExist +++++++++++++++")}this.disableAddToCartButtonAndSetTextToOutOfStock();if(this.$attributes.length>0){this.disableFindInStoreAndAddToWishlist()}else{this.catEntryId=this.productId}},disableFindInStoreAndAddToWishlist:function(){if(m){console.log("disableFindInStoreAndAddToWishlist")}this.productForm.find(".find-store-js").addClass("disabled");this.addToWishlistButton.addClass("disabled")},enableAddToCartButton:function(){if(m){console.log("----------------- enableAddToCartButton ------------------")}var r=this;g(".attr-size").each(function(s,t){if(!g(this).hasClass("attribute-value-selected")){r.addToCartButton.removeClass("disabled");r.addToCartButton.text(r.addToCartButton.attr("data-add-to-cart-text"))}});if(this.isColorWayBundle){this.addToCartButton.removeClass("disabled")}},cleanAddToCartButtonForPDPSwatches:function(){if(m){console.log("cleanAddToCartButtonForPDPSwatches")}this.addToCartButton.removeClass("notify-me-active");this.addToCartButton.removeClass("bfd-active")},updateAgeVerification:function(){if(m){console.log("updateAgeVerification")}if(g(".age-verify-js").attr("checked")){g(".age-verify .add-to-bag-js").removeClass("disabled")}else{g(".age-verify .add-to-bag-js").addClass("disabled")}},disableAddToCartButtonAndSetTextToOutOfStock:function(){if(m){console.log("disableAddToCartButtonAndSetTextToOutOfStock")}var r=LANG_MSG.OUT_OF_STOCK;this.addToCartButton.text(r);this.addToCartButton.addClass("disabled btn-out-of-stock");this.updateItemButton.addClass("disabled")},setAndResolveMaxQuantity:function(){if(m){console.log("setAndResolveMaxQuantity")}var r=this.productForm.find(".quantity-js").attr("data-max-qty");this.resolveQuantity(this.catEntryId,r)},setFindInStoreURL:function(){if(m){console.log("setFindInStoreURL")}var r="ProductDisplay?catalogId="+q.getCatalogId()+"&storeId="+q.getStoreId()+"&productId="+this.catEntryId+"&langId="+q.getLangId()+"&errorViewName=ProductDisplayErrorView&urlLangId="+q.getLangId()+"#action=findInStore";g(".find-store-url-js").attr("href",r);this.productForm.find(".find-store-js").removeClass("disabled")},handleAvailabilityChange:function(u,w,v){if(m){console.log("handleAvailabilityChange")}var s=this,r,t;r=this.$attrValueMap[u];if(!r){return}t=r[w];if(!t){return}if(v){t.removeClass("out-of-stock hide")}else{this.disableAttribute(t)}},disableAttribute:function(r){if(m){console.log("================ disableAttribute ===================")}if((WCS_CONFIG.get("PDP::pdpShowOutOfStockSizesWhenNotifyMeNotPresent")&&productNMWA===false)||WCS_CONFIG.get("PDP::pdpShowOutOfStockEnabled")||productNMWA===true){r.addClass("out-of-stock");if(WCS_CONFIG.get("PDP::pdpShowOutOfStockEnabled")){r.prop("disabled",true)}}else{if(m){console.log(" ************************* removing out of stock items on page load **************************")}r.remove()}if(!this.isPDPSwatches||this.isShopTheLook){this.addOutOfStockMessageToSelectDropDowns()}},addOutOfStockMessageToSelectDropDowns:function(){if(m){console.log("addOutOfStockMessageToSelectDropDowns")}if((typeof outOfStock!="undefined"&&productNMWA)||WCS_CONFIG.PDP.pdpShowOOSInSizeDropDown){g("#attr-size > option").each(function(){g("#attr-size option[value='"+this.value+"']").text(this.value)});g("#attr-size option[class*=out-of-stock]").append(" "+outOfStock)}else{if(!productNMWA&&!WCS_CONFIG.get("PDP::pdpShowOutOfStockEnabled")){g("#attr-size option[class*=out-of-stock]").addClass("hide")}}},checkForOutOfStockSizes:function(){if(m){console.log("checkForOutOfStockSizes")}var s=this.productForm.find("#attr-size > option:selected").hasClass("out-of-stock"),t=this.productForm.find("#attr-size > option").length-1,r=this.productForm.find("#attr-size > option.out-of-stock").length;if(t===r||s){this.disableAddToCartButtonAndSetTextToOutOfStock()}else{this.enableAddToCartButtonForInStockSelection()}},handleProductAvailabilityAllSet:function(){if(m){console.log("handleProductAvailabilityAllSet")}this.productForm.find(".product-content-form-size-step-attr-size").removeClass("disabled").prop("disabled",false);this.productForm.find(".inventory-loading-message-js").addClass("hidden")},checkAllAttributeSelection:function(){if(m){console.log("checkAllAttributeSelection")}var r=this,s=r.$attributes.not(".attribute-value-selected").filter(":visible");if(s.length){if(this.isPDPSwatches){r.handlePDPSwatchesUnselecteds(s)}if(g("#attr-size",this.productForm).length>0){g(".select-size-error-js",this.productForm).removeClass("hide");g(".size-step-container",this.productForm).addClass("error")}}else{g(".select-size-error-js",this.productForm).addClass("hide");g(".size-step-container",this.productForm).removeClass("error")}g.productFormUtil.showHideQuantityErrorMessage(this.productForm);return !Boolean(s.length)},handlePDPSwatchesUnselecteds:function(s){if(m){console.log("handlePDPSwatchesUnselecteds")}var r=this;if(g(".selection-js.tooltip-js").length>0){g("html, body").animate({scrollTop:s.first().offset().top-s.first().outerHeight()},700);s.each(function(t){r.initUnselectedToolTips(this,t)}).tooltipster("show",function(){s.one("mouseout click hover mouseover",function(t){g(this).closest(".tooltip-js").tooltipster("hide")});s.find(".attr-box").one("click",function(t){g(this).closest(".tooltip-js").tooltipster("disable")});g(document).one("close.fndtn.reveal","[data-reveal]",function(){if(s.data("tooltipster-ns")){s.tooltipster("disable")}})})}return false},isValidForm:function(){if(m){console.log("isValidForm")}if(!this.checkAllAttributeSelection()){return false}if(!g.productFormUtil.isValidQuantity(this.productForm)){this.handleProductFormInvalidQuantity();return false}return true},handleProductFormInvalidQuantity:function(){if(m){console.log("handleProductFormInvalidQuantity")}this.productForm.find(".quantity .invalid-quantity-error-js",this.productForm).removeClass("hide")},submitForm:function(r,s,t){if(m){console.log("submitForm")}i.showLoadingNotification("p");g.ajax({type:"POST",url:s,data:r,dataType:"json"}).always(function(){i.hideLoadingNotification()}).done(t)},initUnselectedToolTips:function(v,u){if(m){console.log("initUnselectedToolTips, element, index : ",v,u)}var s=g(v),t=s.attr("title"),w,r=u===0?"top-left":"bottom-left",x=s.offset().top-s.find(".attr-container-js").offset().top;if(!t){return}if(s.data("tooltipster-ns")){s.tooltipster("destroy")}if(t.indexOf("icon-error")>=0){w=t}else{w='<span class="icon-error"></span><span class="error-message">'+t+"</span>"}s.tooltipster({contentAsHTML:true,content:w,animation:"fade",position:r,trigger:"custom",interactive:false,theme:"tooltipster-pdp-swatch",offsetY:x})},resolveQuantity:function(s,r){if(this.isPDPSwatches&&!this.isShopTheLook){this._resolvePDPSwatchesQuantity()}else{this.resolveItem=s;this.maxQuantity=r||5;this._resolveQuantitySelect()}},_resolvePDPSwatchesQuantity:function(){if(m){console.log(" ------------- _resolvePDPSwatchesQuantity ------------- ")}var r=this;if(r.$quantityBox.attr("data-default-qty")!==""){r.$quantityBox.find("option").each(function(){if(g(this).val()==r.$quantityBox.attr("data-default-qty")){g(this).prop("selected","selected");g(this).trigger("updateSkin")}});r.$quantityBox.attr("data-default-qty","")}},_resolveQuantitySelect:function(){if(m){console.log(" ------------- _resolveQuantitySelect ------------- ")}var r=WCS_CONFIG.get("checkout::checkoutShopcartSaveForLaterEnabled"),t=(r&&this.productForm.find("input[name=sflItemId]").length!==0),w,u,s,v;w=this.$quantityBox.find("option").length-1;w=w-this.$quantityBox.find('option[value="0"]').length;s=this.productAvailability.checkInventory(this.resolveItem);u=(t)?this.maxQuantity:s;v=(u===0)?0:Math.abs(w-u);this.$quantityBox.removeClass("disabled");if(this.resolveItem===undefined){this.$quantityBox.find("option:gt(0)").remove()}else{if(v&&v!=w||u>w){this.$quantityBox.find("option:gt(0)").remove();this.$quantityBox.append(g.productFormUtil.generateQuantityOptions(u,this.maxQuantity))}else{if(u<1){this.$quantityBox.find("option:gt(0)").remove();this.$quantityBox.addClass("disabled");this.$quantityBox.append(g.productFormUtil.generateQuantityOptions(u,this.maxQuantity))}}}if(this.$quantityBox.data("ui-listener")){this.$quantityBox.next(".ui-select").trigger(this.$quantityBox.data("ui-listener"))}}};return c});