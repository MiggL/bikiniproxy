define(["jquery","wcs.topbar-bg","shared.main.screen","shared.main.resize"],function(b,a){(function(g,f,c,h){var d="topbarSearch";var e=function(j,i){this.element=j;this.options=i;this.metadata=g(this.element).data("search-options")};e.prototype={defaults:{panelSizes:["small","medium"],screenSize:{previous:"small"}},init:function(){var i=this;this.config=g.extend({},this.defaults,this.options,this.metadata);this._build();this.events();return i},_build:function(){var i=this;i.switchResponsiveDisplay()},events:function(){var i=this;g("form.search-form-js").on("submit",function(j){i.sanitizeSearchField()});g(".title-area .toggle-topbar-js").on("click",function(){i.hideSearchPanel()});i.initSmallNavSearchButton();i.initResponsiveButtons();g(f).resize(function(){i.switchResponsiveDisplay();if(main.screen.size()!=="small"){i.hideSearchPanel()}})},showSearchPanel:function(){var i=this;if(main.screen.size()==="small"){g("body").on("click.topBarSearch.dismiss",function(j){if(g(j.target).closest(g(i.element)).length===0){j.preventDefault();i.hideSearchPanel()}});setTimeout(function(){a.show()},250)}g(i.element).removeClass("hide");if(g(i.element).is(":visible")&&g(".search-input-js",g(i.element)).is(":visible")&&g(".search-button-container",g(i.element)).is(":visible")){g("input#search",i.element).focus()}g(".title-area .search-topbar-js").addClass("active")},hideSearchPanel:function(){var i=this;g("body").off("click.topBarSearch.dismiss");g(i.element).addClass("hide");if(main.screen.size()==="small"){a.hide()}g(".title-area .search-topbar-js").removeClass("active")},toggleSearchPanel:function(){var i=this;if(g(i.element).hasClass("hide")){i.showSearchPanel()}else{i.hideSearchPanel()}},initSmallNavSearchButton:function(){var i=this;g(".title-area .search-topbar-js").on("click",function(j){j.stopPropagation();if(g(".top-bar-acord.expanded, .top-bar.expanded").length>0){g(".title-area .toggle-topbar-js").trigger("click")}i.toggleSearchPanel()})},initResponsiveButtons:function(){var i=this;g("a.search-button",g(i.element).parent()).on("click",function(j){j.preventDefault();if(!(g(i.element).is(":visible"))){i.showSearchPanel()}else{if(g(".search-input-js",g(i.element)).is(":visible")&&!(g(".search-button-container",g(i.element)).is(":visible"))){i.searchButtonSubmit(g(this))}else{i.hideSearchPanel()}}})},switchResponsiveDisplay:function(){var i=this;i.config.screenSize.current=main.screen.size();if(i.config.screenSize.previous===i.config.screenSize.current){return}else{if(i.config.panelSizes.indexOf(i.config.screenSize.current)>=0){i.hideSearchPanel()}else{i.showSearchPanel()}i.config.screenSize.previous=main.screen.size()}},sanitizeSearchField:function(){var j=this,i=g("#search",g(j.element)),l=i.data("filter-chars"),k=new RegExp(l,"gi");if(l){i.val(i.val().replace(k,""))}},searchButtonSubmit:function(k){var j=k,i=j.parent().parent("form").get(0);if(!i.checkValidity()){g(i).find(":submit").click();return false}i.submit()},};e.defaults=e.prototype.defaults;g.fn.topbarSearch=function(i){return this.each(function(){var j=g(this).data(d);if(!j){j=new e(this,i).init();g(this).data(d,j)}})}})(jQuery,window,document)});