define(["jquery","videojs-plugin-youtube","wcs.product-views-util","wcs.utils","pubsub","videojs"],function(d,c,b,i,g,e){var f="pdpVideoPlayer",h=false;var a=function(k,j){this.$element=d(k);this.options=j;this.options.techOrder=[];this.options.techOrder[0]=this.options.host==="youtube"?"youtube":"html5";this.videoOptions=null;this.player=null;this.$videoContainer=null;this.carouselThumbLocation=this.options.carouselThumbLocation;this.$wcsPDPVideoElement=null;this.$pdpVideoThumb='<figure class="product-video-thumb product-video-thumb-js attr-box"></figure>';this.s7ViewerType=WCS_CONFIG.scene7.scene7PDPViewer;this.$s7ViewerElement=this.s7ViewerType==="VFDPS7Viewer"?d(".vfdp-s7-viewer"):d(".s7Zoom-js");this.mobileVideoTrigger="button";this.mobileVideoButtonIconClassName=this.options.host==="youtube"?"icon-youtube":"icon-arrow-right-indicator";this.$s7View=d("#s7Zoom_zoomView").find("canvas");this.isPaginationVisible=d(".owl-pagination").is(":visible")};a.prototype={defaults:{lazyLoad:false,bigPlayButton:true},init:function(){var j=this;if(typeof wcsPDPVideoConfig!=="undefined"){console.log("Initializing WCS Product Video");j.defaults.videojscss=wcsPDPVideoConfig.videojscss}else{console.warn("YouTube video JSON not present, aborting");return}j.config=d.extend({},j.defaults,j.options,j.videoOptions);j._build();j._pubsubEventSubsriptions();j._domEventBindings();return j},_build:function(){if(h){console.log("_build")}this._buildControls();this._buildVideoContainerElement();this._buildVideoElement();if(!d("#video-js-css-import").length){this._getVideoJSStyles()}else{d.pubsub("publish","VIDEOJS_CSS_ADDED_TO_DOM");this._initializeYoutubeVideoOnContainer()}},_buildControls:function(){if(h){console.log("_buildControls")}if(this.s7ViewerType!=="VFDPS7Viewer"){this._setCarouselThumbLocation()}this._addVideoButtonToDom()},_buildVideoContainerElement:function(){if(h){console.log("_buildVideoContainerElement")}this.$element.prepend('<div id="'+this.config.host+'-product-video" class="pdp-video-container pdp-video-container-js youtube-video-container hide"></div>');this.options.videoId=this.$element.find(".pdp-video-container").attr("id")+"-container";this.$element.find(".pdp-video-container").addClass(this.options.videoId);this.$videoContainer=this.$element.find(".pdp-video-container")},_domEventBindings:function(){if(h){console.log("_domEventBindings")}var j=this;d(window).on("resize",function(){j._handleWindowResize()});d(document).on("click",".product-video-thumb-js",function(k){j._handleVideoThumbClick(k)});d(document).on("click",".product-video-button-js",function(k){j._handleMobileVideoButtonClick()})},_pubsubEventSubsriptions:function(){if(h){console.log("_pubsubEventSubsriptions")}var j=this;j.altViewProductVideoInitToken=d.pubsub("subscribe","ALT_VIEW_PRODUCT_VIDEO_INITIALIZED",function(){if(j.s7ViewerType!=="VFDPS7Viewer"){j._addVideoThumbToDesktopCarousel()}});j.altViewVideoThumbnailAddedToken=d.pubsub("subscribe","ALT_VIEW_VIDEO_THUMB_ADDED_TO_OWL_DESKTOP_CAROUSEL",function(){j._clonePosterImageAndAddToCarouselThumb();j._prepareVideoThumb()});j.owlCarouselReadyToken=d.pubsub("subscribe","OWL_CAROUSEL_READY",function(){j._handleAltViewImageSetChange();j._pausePlayerOnOwlCarouselReady()});j.altViewCarouselClickedToken=d.pubsub("subscribe","ALT_VIEW_CAROUSEL_ITEM_CLICKED",function(){j._handleCarouselItemClick();j._pauseVideoPlayer();j._hideVideoContainer();j._toggleVisibility(j.$s7ViewerElement,show=true)});j.altViewCarouselVideoThumbnailClickedToken=d.pubsub("subscribe","ALT_VIEW_CAROUSEL_VIDEO_ITEM_CLICKED",function(){j._startVideoPlayer()});j.attributeSwatchClickToken=d.pubsub("subscribe","product-form.attr.swatch.click",function(l,k){j._hideVideoContainer();j._toggleVisibility(j.$s7ViewerElement,show=true);j._pauseVideoPlayer();j._handleMobileVideoButtonClick(visible="hideVideoPlayer")})},_setCarouselThumbLocation:function(){if(h){console.log("_setCarouselThumbLocation")}var j=this;if(j.carouselThumbLocation==="start"){j.carouselThumbLocation=0}else{if(j.carouselThumbLocation==="end"){j.carouselThumbLocation=-1}}},_buildVideoElement:function(){if(h){console.log("_buildVideoElement")}var j=this,k;if(!j.isPaginationVisible&&j.config.host==="youtube"){k='<video id="'+j.options.videoId+'" class="flex-video vjs-big-play-centered video-js" controls ></video>'}else{if(j.isPaginationVisible&&j.config.host==="youtube"){k='<video id="'+j.options.videoId+'" class="flex-video vjs-big-play-centered video-js" ></video>'}else{if(j.config.host==="scene7"){k='<video id="'+j.options.videoId+'" class="flex-video vjs-big-play-centered video-js" controls ></video>'}}}j.$videoContainer.append(k)},_setVideoElementDimensions:function(){if(h){console.log("_setVideoElementDimensions")}var n=this.$element.height(),m=this.$element.width(),l=main.screen.size()!=="small"?true:false,k=main.screen.size()==="small"?true:false,j=main.screen.size()==="medium"?true:false;if(d(".quickview-box-js").length&&d(".hero-container-js").length){n=d(".hero-container-js").height()}if(k){n=n-10}if(this.options.host==="youtube"){d(".pdp-video-container-js").css({width:m,height:n});d(".video-js").css({width:m,height:m*0.56})}else{d(".pdp-video-container-js, .video-js").each(function(){d(this).css({width:m,height:n})})}},_setVideoElementDimensionsForDeprecatedViewer:function(){if(h){console.log("_setVideoElementDimensionsForDeprecatedViewer")}var m=this,p=d("#s7Zoom").height(),o=d("#s7Zoom").width(),k=main.screen.size()==="small"?true:false,j=main.screen.size()==="medium"?true:false,n=main.screen.size()!=="small"?true:false,l=m.s7ViewerType==="FlyoutViewer";if(l&&k){p=(d(".product-img-js").height())-(d(".owl-controls").height())}if(l&&j&&n){p=d(".owl-wrapper-outer").height()}if(!l&&k){p=p-d("#owl-mobile-carousel").height()}if(d(".quickview-box-js").length){p=d(".hero-container-js").height()}if(m.config.host==="youtube"){d(".pdp-video-container-js").css({width:o,height:p});d(".video-js").css({width:o,height:o*0.56})}else{d(".pdp-video-container-js, .video-js").each(function(){d(this).css({width:o,height:p})})}},_getVideoJSStyles:function(){if(h){console.log("_getVideoJSStyles")}var j=this,k=j.config.videojscss;d.ajax({url:k,dataType:"text",type:"GET"}).done(function(l){d("head").append('<style type="text/css" id="video-js-css-import"></style>');d("#video-js-css-import").append(l);d.pubsub("publish","VIDEOJS_CSS_ADDED_TO_DOM");j._initializeYoutubeVideoOnContainer()}).fail(function(){console.warn("No video CSS, aborting.");j.destroy()})},_initializeYoutubeVideoOnContainer:function(){if(h){console.log("_initializeYoutubeVideoOnContainer")}var j=this;try{j.player=e(j.options.videoId,j.config,function(){d.pubsub("publish","ALT_VIEW_PRODUCT_VIDEO_INITIALIZED")})}catch(k){console.warn("VideoJS Error, Aborting");j.destroy()}},_startVideoPlayer:function(){if(h){console.log("_startVideoPlayer")}var j=this;if(main.screen.size()!=="small"){j.player.play()}},_pauseVideoPlayer:function(){if(h){console.log("_pauseVideoPlayer")}var j=this;if(j.player.paused()){return}j.player.pause()},_pausePlayerOnOwlCarouselReady:function(){if(h){console.log("_pausePlayerOnOwlCarouselReady")}var j=this;if(main.screen.size()!=="small"){j.player.pause()}},_clonePosterImageAndAddToCarouselThumb:function(){if(h){console.log("_clonePosterImageAndAddToCarouselThumb")}var j=this;if(j.config.host==="youtube"){d(".vjs-poster").clone().appendTo(".product-video-thumb-js").addClass("product-video-thumb-img").append('<span class="icon-youtube"></span>');d(".product-video-thumb-js").find(".vjs-poster.vjs-hidden.product-video-thumb-img").remove()}else{if(j.config.host==="scene7"){d(".product-video-thumb-js").append('<div class="product-video-thumb-img" style="background-image:url('+j.config.poster+')"><span class="icon-arrow-right-indicator"></span></div>')}}},_addVideoThumbToDesktopCarousel:function(){if(h){console.log("_addVideoThumbToDesktopCarousel")}var j=this;if(j.isPaginationVisible){return}d("#owl-desktop-carousel").data("owlCarousel").addItem(j.$pdpVideoThumb,j.carouselThumbLocation);d.pubsub("publish","ALT_VIEW_VIDEO_THUMB_ADDED_TO_OWL_DESKTOP_CAROUSEL");d.pubsub("publish","ALT_VIEW_CAROUSEL_UPDATED")},_addVideoButtonToDom:function(){if(h){console.log("_addVideoButtonToDom")}var j=this;if(d(".product-video-button-js").length!==0){return}d(".product-img-js").append('<span class="product-video-button-js product-video-button '+j.mobileVideoButtonIconClassName+'"></span>');d.pubsub("publish","ALT_VIEW_VIDEO_THUMB_ADDED_TO_OWL_MOBILE_CAROUSEL");d.pubsub("publish","ALT_VIEW_CAROUSEL_UPDATED")},_handleMobileVideoButtonClick:function(k){if(h){console.log("_handleMobileVideoButtonClick")}var j=this.$videoContainer.hasClass("hide");if(k==="hideVideoPlayer"||!j){this._pauseVideoPlayer();this._hideVideoContainer();this._toggleVisibility(this.$s7ViewerElement,show=true);this._toggleMobileIconClass(icon="play")}else{this._showVideoContainer();this._toggleMobileIconClass(icon="close");this._startVideoPlayer()}},_toggleMobileIconClass:function(k){if(h){console.log("_toggleMobileIconClass")}var j=this;if(k==="play"){d(".product-video-button-js").removeClass("icon-close").addClass(j.mobileVideoButtonIconClassName)}else{d(".product-video-button-js").removeClass(j.mobileVideoButtonIconClassName).addClass("icon-close")}},_prepareVideoThumb:function(){if(h){console.log("_prepareVideoThumb")}var j=this;if(main.screen.size()==="small"){return}d(".product-video-thumb-js").removeClass("selected").parent(".owl-item").addClass("product-video-thumb-container-js").next(".owl-item").find("figure").addClass("selected");if(d(".owl-item .selected").length===1){d(".product-video-thumb-js").next(".owl-item").find("figure").addClass("selected")}},_handleVideoThumbClick:function(m){if(h){console.log("_handleVideoThumbClick")}var k=this,j=d(m.target),l=j.closest(".owl-wrapper").find(".selected");l.removeClass("selected");j.closest(".owl-wrapper").find(".product-video-thumb-js").addClass("selected");k._showVideoContainer();d.pubsub("publish","ALT_VIEW_CAROUSEL_VIDEO_ITEM_CLICKED")},_handleCarouselItemClick:function(){if(h){console.log("_handleCarouselItemClick")}var j=this;if(main.screen.size()==="small"){return}j._hideVideoContainer()},_handleAltViewImageSetChange:function(){if(h){console.log("_handleAltViewImageSetChange")}var j=this;if(main.screen.size()==="small"){j._hideVideoContainer()}d.pubsub("publish","ALT_VIEW_CAROUSEL_ITEM_CLICKED");d.pubsub("publish","ALT_VIEW_PRODUCT_VIDEO_INITIALIZED")},_handleWindowResize:function(){if(h){console.log("_handleWindowResize")}var j=this;i.waitForFinalEvent(function(){if(j.s7ViewerType!=="VFDPS7Viewer"){j._setVideoElementDimensionsForDeprecatedViewer()}else{j._setVideoElementDimensions()}},500,"container resizing")},_showVideoContainer:function(){if(h){console.log("_showVideoContainer")}var j=this;if(j.s7ViewerType!=="VFDPS7Viewer"){j._setVideoElementDimensionsForDeprecatedViewer()}else{j._setVideoElementDimensions()}j._toggleHideClass(j.$s7View,show=false);j._toggleHideClass(j.$videoContainer,show=true);j._toggleVisibility(d(".hero-container-js"),show=false);j._toggleVisibility(this.$s7ViewerElement,show=false);j._toggleVisibility(d(".product-view-control-js"),show=false)},_hideVideoContainer:function(){if(h){console.log("_hideVideoContainer")}var j=this;j._toggleHideClass(j.$videoContainer,show=false);j._toggleHideClass(j.$s7View,show=true);j._toggleVisibility(d(".hero-container-js"),show=true);j._toggleVisibility(d(".product-view-control-js"),show=true);if(j.s7ViewerType==="FlyoutViewer"){j._toggleVisibility(this.$s7ViewerElement,show=true)}},_toggleVisibility:function(k,j){if(h){console.log("_toggleVisibility")}if(j===true){k.css("visibility","visible")}else{if(j===false){k.css("visibility","hidden")}}},_toggleHideClass:function(k,j){if(h){console.log("_toggleHideClass")}if(k.hasClass("hide")&&j===true){k.removeClass("hide")}else{if(!k.hasClass("hide")&&j===false){k.addClass("hide")}}},destroy:function(){if(h){console.log("destroy")}var j=this;if(j.player!==null){j.player.dispose()}d(".product-video-thumb-container-js").remove();d(document).off("click",".product-video-thumb-js");d(document).off("click",".product-video-button-js");d.pubsub("unsubscribe",j.altViewProductVideoInitToken);d.pubsub("unsubscribe",j.altViewVideoThumbnailAddedToken);d.pubsub("unsubscribe",j.owlCarouselReadyToken);d.pubsub("unsubscribe",j.altViewCarouselClickedToken);d.pubsub("unsubscribe",j.altViewCarouselVideoThumbnailClickedToken);d.pubsub("unsubscribe",j.attributeSwatchClickToken);this.$videoContainer.remove();d("#wcsPDPVideoJson").remove();window.wcsPDPVideoConfig=undefined;this.$element.removeData(f)}};a.defaults=a.prototype.defaults;d.fn.pdpVideoPlayer=function(j){return this.each(function(){var k=d(this).data(f);if(!k){k=new a(this,j).init();d(this).data(f,k)}})}});