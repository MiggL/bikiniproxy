var ____objsSeen={};GrahamTechnology.ui.CustomComponent=function(a){GrahamTechnology.ui.AbstractComponent.call(this,a);gtResize.addComponentResize(a,false);this.hasBoundData=false;this.hasCustomComponentProperties=false;this.setProperties=function(c){var b;for(b in c){this[b]=c[b]}this.hasBoundData=!(GrahamTechnology.Base.isUndefinedOrNull(this.value));if(this.hasBoundData){this.value=this.reconstruct(this.value)}this.hasCustomComponentProperties=!(GrahamTechnology.Base.isUndefinedOrNull(this.customComponentProperties));if(this.hasCustomComponentProperties){this.customComponentProperties=this.reconstruct(this.customComponentProperties)}if(!this.visible){this.hide()}this.invokeThirdPartyCode()}};GrahamTechnology.ui.CustomComponent.prototype=new GrahamTechnology.ui.AbstractComponent();GrahamTechnology.ui.CustomComponent.prototype.reconstruct=function(a){return GrahamTechnology.ui.CustomComponent.json_reconstruct(a,{})};GrahamTechnology.ui.CustomComponent.prototype.invokeThirdPartyCode=function(){if(!GrahamTechnology.Base.isUndefinedOrNull(this.initFunction)){this.log("Evaluating init function["+this.initFunction+"] on third party reference","info","CustomComponent.invokeThirdPartyCode");if(!(this.hasBoundData)){this.log("Evaluating init function with no bound data","info")}var timeTaken=new GrahamTechnology.util.Timer();this.thirdPartyRef=eval(this.initFunction+'("'+this.id+'", this.value, this)');if(GrahamTechnology.Base.isUndefinedOrNull(this.thirdPartyRef)){this.log("Init function did not return a reference to Custom component Wrapper","error","CustomComponent.invokeThirdPartyCode")}else{this.log("Init Function ["+this.initFunction+"]evaluated. time took:"+timeTaken.end()+"msec","info","CustomComponent.invokeThirdPartyCode")}}else{this.log("Null/undefined init function","error","CustomComponent.invokeThirdPartyCode")}};GrahamTechnology.ui.CustomComponent.prototype.updated=function(){clientAPI.postEvent(this.id,GrahamTechnology.grasp.EvtType.EVENT_VALUE_CHANGED)};GrahamTechnology.ui.CustomComponent.prototype.newObject=function(a){return this.initialiseObject({},a)};GrahamTechnology.ui.CustomComponent.prototype.newArray=function(a){return this.initialiseObject([],a)};GrahamTechnology.ui.CustomComponent.prototype.postEvent=function(b){var a=this.getJsonSerialized(b);if(!GrahamTechnology.Base.isUndefinedOrNull(a)){a=encodeURIComponent(a)}clientAPI.postEvent(this.id,GrahamTechnology.grasp.EvtType.CUSTOM,{param1:a})};GrahamTechnology.ui.CustomComponent.prototype.initialiseObject=function(a,b){a.____oid=-1;a.____type=b;return a};GrahamTechnology.ui.CustomComponent.prototype.getJsonSerializedValue=function(){if(this.hasBoundData){return this.getJsonSerialized(this.value)}else{return null}};GrahamTechnology.ui.CustomComponent.prototype.getJsonSerialized=function(b){____objsSeen={};this.value._toJSON=this.___toJSON;var a=this.convertToJSON(b);this.log(a,"info","CustomComponent.getJsonSerialized");return a};GrahamTechnology.ui.CustomComponent.prototype.___toJSON=function(){var b;if(GrahamTechnology.Base.isUndefinedOrNull(this.____oid)){return this}if(!GrahamTechnology.Base.isUndefinedOrNull(____objsSeen[this.____oid])){return{____oref:this.____oid}}____objsSeen[this.____oid]=true;var a=this;if(Object.prototype.toString.apply(this)==="[object Array]"){a=GrahamTechnology.ui.CustomComponent.wrapArray(this)}for(b in a){if(!GrahamTechnology.Base.isUndefinedOrNull(a[b])){if(!GrahamTechnology.Base.isUndefinedOrNull(a[b].____oid)){a[b]._toJSON=this._toJSON}else{if(typeof(a[b])==="object"&&typeof(a[b].getTime)==="function"){a[b]=GrahamTechnology.ui.CustomComponent.wrapDate(a[b])}}}}return a};GrahamTechnology.ui.CustomComponent.wrapDate=function(a){var b={};b.____type="Date";b.value=a.getTime();return b};GrahamTechnology.ui.CustomComponent.wrapArray=function(c){var b={};var a;b.____listValues=[];for(a in c){if(typeof(c[a])!=="function"){if(a!=+a){b[a]=c[a]}else{if(!GrahamTechnology.Base.isUndefinedOrNull(c[a].____oid)){c[a]._toJSON=c._toJSON}b.____listValues[a]=c[a]}}}return b};GrahamTechnology.ui.CustomComponent.prototype.updateCustomComponent=function(b){var a=b.value;if(!this.hasBoundData){this.log("Will not update custom component as there is no bound data","info","CustomComponent.updateCustomComponent")}else{this.value=JSON.parse(a);this.value=this.reconstruct(this.value);if(!GrahamTechnology.Base.isUndefinedOrNull(this.thirdPartyRef.update)){this.log("Updating with value ["+this.value+"]","info","CustomComponent.updateCustomComponent");var c=new GrahamTechnology.util.Timer();this.thirdPartyRef.update(this.value);this.log("Updated. Time took:["+c.end()+"msec]","info","CustomComponent.updateCustomComponent")}else{this.log("Null/undefined update function","error","CustomComponent.updateCustomComponent")}}};GrahamTechnology.ui.CustomComponent.prototype.callMethod=function(transportable){var parameterList=[];var methodName=transportable.methodName;var parameters=transportable.parameters_Transportables;var i;for(i=0;i<parameters.length;i++){var parameter=parameters[i].parameter;var parameterData=JSON.parse(parameter);var objectMap={};parameterData=GrahamTechnology.ui.CustomComponent.json_reconstruct(parameterData,objectMap);parameterList[parameterList.length]=parameterData}try{var timer=new GrahamTechnology.util.Timer();if(GrahamTechnology.Base.isUndefinedOrNull(this.thirdPartyRef[methodName])){if(this.isSetterMethod(methodName)){var propertyName=methodName.substring(3,methodName.length);propertyName=propertyName.charAt(0).toLowerCase()+propertyName.slice(1);this.thirdPartyRef[propertyName]=parameterList[0]}else{this.log("Could not find method '"+methodName+"'","error","CustomComponent.callMethod")}}else{if(!GrahamTechnology.Base.isUndefinedOrNull(this.thirdPartyRef[methodName].apply)){this.thirdPartyRef[methodName].apply(this.thirdPartyRef,parameterList)}else{var evalMethod="this.thirdPartyRef."+methodName;var sep="(";for(i=0;i<parameterList.length;i++){evalMethod+=sep+"parameterList["+i+"]";sep=","}eval(evalMethod+")")}}this.log("Method '"+methodName+"' executed in "+timer.end()+" msec.","info","CustomComponent.callMethod")}catch(e){this.log(e,"error","CustomComponent.callMethod")}};GrahamTechnology.ui.CustomComponent.prototype.isSetterMethod=function(a){var b=a.substring(0,3);if(b==="set"){return true}return false};GrahamTechnology.ui.CustomComponent.prototype.getName=function(){return"CustomComponent ["+this.id+"]"};GrahamTechnology.ui.CustomComponent.prototype.log=function(){var a=0;arguments[a]=this.getName()+": "+arguments[a];logger.log.apply(logger,arguments)};GrahamTechnology.ui.CustomComponent.json_reconstruct=function(d,a){if(!GrahamTechnology.Base.isUndefinedOrNull(d.____listValues)){var c=d;d=d.____listValues;delete c.____listValues;GrahamTechnology.ui.CustomComponent.copyObjectProperties(d,c)}a[d.____oid]=d;var f;for(f in d){if(f!=="____oid"&&f!=="____type"){if(!GrahamTechnology.Base.isUndefinedOrNull(d[f])){if(!GrahamTechnology.Base.isUndefinedOrNull(d[f].____type)&&d[f].____type==="Date"){var b=new Date(d[f].value);d[f]=b}if(!GrahamTechnology.Base.isUndefinedOrNull(d[f].____oref)){var e=d[f].____oref;d[f]=a[e]}else{if(!GrahamTechnology.Base.isUndefinedOrNull(d[f].____oid)){d[f]=GrahamTechnology.ui.CustomComponent.json_reconstruct(d[f],a)}}}}}return d};GrahamTechnology.ui.CustomComponent.copyObjectProperties=function(b,e){if(b===null||b===undefined){b={}}var c;for(c=1;c<arguments.length;c++){var d=arguments[c];if(typeof(d)!=="undefined"&&d!==null){var a;for(a in d){b[a]=d[a]}}}return b};GrahamTechnology.ui.CustomComponent.prototype.setCustomComponentTabIndex=function(a){if(!GrahamTechnology.Base.isUndefinedOrNull(this.thirdPartyRef.setComponentTabIndex)){return this.thirdPartyRef.setComponentTabIndex(a)}this.setTabIndex(a);return a++};GrahamTechnology.ui.CustomComponent.prototype.setHintText=function(a){if(!GrahamTechnology.Base.isUndefinedOrNull(this.thirdPartyRef.setHintText)){this.thirdPartyRef.setHintText(a)}};GrahamTechnology.ui.CustomComponent._replace_char=function(a){if(!this._replace_characters[a]){this._replace_characters[a]="\\u"+("0000"+(+(a.charCodeAt(0))).toString(16)).slice(-4)}return this._replace_characters[a]};GrahamTechnology.ui.CustomComponent._string=function(b){var a=this;return'"'+b.replace(this._replace_regex,function(c){return a._replace_char(c)})+'"'};GrahamTechnology.ui.CustomComponent._replace_regex=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;GrahamTechnology.ui.CustomComponent._replace_characters={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};GrahamTechnology.ui.CustomComponent.prototype.convertToJSON=function(h){if(h===null||h===undefined){return"null"}if(Object.prototype.toString.apply(h)==="[object Function]"){return null}var b=typeof(h);switch(b){case"string":return GrahamTechnology.ui.CustomComponent._string(h);case"number":return isFinite(h)?String(h):"null";case"boolean":return String(h);default:var c;if(Object.prototype.toString.apply(h._toJSON)==="[object Function]"){c=h._toJSON();if(h!==c){return GrahamTechnology.ui.CustomComponent.prototype.convertToJSON(c)}}if(Object.prototype.toString.apply(h.json)==="[object Function]"){c=h.json();if(h!==c){return GrahamTechnology.ui.CustomComponent.prototype.convertToJSON(c)}}var f=[];var g="";var a;if(Object.prototype.toString.apply(h)==="[object Array]"){for(a=0;a<h.length;a++){g=GrahamTechnology.ui.CustomComponent.prototype.convertToJSON(h[a]);if(typeof(g)==="string"){f.push(g)}}return"["+f.join(", ")+"]"}f=[];var e;for(e in h){var d;if(typeof(e)==="number"&&isFinite(e)){d='"'+e+'"'}else{if(typeof(e)==="string"){d=GrahamTechnology.ui.CustomComponent.prototype.convertToJSON(e)}else{continue}}g=GrahamTechnology.ui.CustomComponent.prototype.convertToJSON(h[e]);if(typeof(g)==="string"){f.push(d+":"+g)}}return"{"+f.join(", ")+"}"}};GrahamTechnology.ui.CustomComponent.prototype.getCustomComponentProperties=function(){return this.customComponentProperties};