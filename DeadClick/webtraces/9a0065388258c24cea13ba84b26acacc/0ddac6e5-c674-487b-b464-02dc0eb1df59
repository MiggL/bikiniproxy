define(["jquery","handlebars-core","pubsub","shared.main.screen","shared.main.resize"],function(e,c){var d="StickyAddToCart",a=window.DEBUG||false;var b=function(g,f){this.element=g;this.options=f||{};this.metadata=e(this.element).data("sticky-options");this.data={};this.defaults={template:"../html/add-to-cart/sticky-add-to-cart.hbs",showFor:["small"],location:{above:"top",inview:"hide",below:"hide"},buttonText:e(this.element).data("sticky-text")};this.config=e.extend(true,{},this.defaults,this.options,this.metadata);return this};b.prototype={init:function(){var f=this;if(a){console.log("$.fn.StickyAddToCart init")}this.loadAndCompileTemplate().done(function(){f.bindEventHandlers();f.updateAll()});return this},updateSelectedColorSwatch:function(){if(a){console.log("$.fn.StickyAddToCart updateSelectedColorSwatch")}var f=e(".color-swatches-js .selected img");this.data.img={src:f.attr("src"),alt:f.attr("alt")}},updateProductName:function(){if(a){console.log("$.fn.StickyAddToCart updateProductName")}this.data.name=e("h1.product-info-js").text()},updateProductColor:function(){if(a){console.log("$.fn.StickyAddToCart updateProductColor")}this.data.color=e(".color-swatches-js .selected").data("attribute-value")},updateProductSize:function(){if(a){console.log("$.fn.StickyAddToCart updateProductSize")}var g=e(".attr-size h2").text()?e(".attr-size h2").text()+": ":"";var f=e("#attr-size option:selected:not(.attr-size-deselected-js)").val()||e(".attr-size label.selected").text();this.data.size=f?g+f:f},updateProductPrice:function(){if(a){console.log("$.fn.StickyAddToCart updateProductPrice")}this.data.price=e(".product-content-info-price").html()},render:function(f){if(a){console.log("$.fn.StickyAddToCart render")}f=f||this.data;if(this.container){this.container.remove()}this.container=e(this.compiledTemplate(f)).appendTo("body");this.updateView()},updateView:function(g){g=g||main.screen.size();if(a){console.log("$.fn.StickyAddToCart updateView")}if(e(this.element).hasClass("disabled")||e(this.element).prop("disabled")){this.container.addClass("hide");return}var f=this,k=e(window).scrollTop(),h=e(this.element).offset().top,j=e(window).height(),i=k>h?"above":(k<h-j?"below":"inview");if(this.config.showFor.indexOf(g)>-1){this.container.removeClass(function(){return Object.keys(f.config.location).reduce(function(l,m){return l+=" "+f.config.location[m]},"hide")}).addClass(this.config.location[i])}else{this.container.addClass("hide")}},updateButtonText:function(f){this.data.buttonText=f||this.config.buttonText},updateAll:function(){if(a){console.log("$.fn.StickyAddToCart updateAll")}this.updateSelectedColorSwatch();this.updateProductName();this.updateProductColor();this.updateProductSize();this.updateProductPrice();this.updateButtonText();this.render()},bindEventHandlers:function(){if(a){console.log("$.fn.StickyAddToCart bindEventHandlers")}var f=this;e.pubsub("subscribe","product-form.attr.swatch.click",function(h,g){f.updateAll()});e.pubsub("subscribe","WCS.PRODUCTFORM.ATTRIBUTE.CHANGE.COMPLETE",function(h,g){f.updateAll()});e.pubsub("subscribe","product.price.updated",function(h,g){f.updateAll()});e(document).on("click","#sticky-add-to-cart-button",function(g){g.preventDefault();e(f.element).trigger("click")});e.pubsub("subscribe","window.resize.breakpoint",function(h,g){f.updateView(g.now)});e(window).on("scroll",function(){f.updateView()})}};b.prototype=e.extend({},c,b.prototype);e.fn.StickyAddToCart=function(g){if(a){console.log("$.fn.StickyAddToCart",g)}var f=arguments;return this.each(function(){var h=e(this).data(d);if(!h){h=new b(this,g).init();e(this).data(d,h)}if(typeof g==="string"&&h.hasOwnProperty(g)&&typeof h[g]==="function"){h[g].apply(h,Array.prototype.slice.call(f,1))}})}});