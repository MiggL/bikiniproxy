!function(a,b){function c(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}var d="selectbox",e=!1,f=!0;a.extend(c.prototype,{_isOpenSelectbox:function(a){if(!a)return e;var b=this._getInst(a);return b.isOpen},_isDisabledSelectbox:function(a){if(!a)return e;var b=this._getInst(a);return b.isDisabled},_attachSelectbox:function(b,c){function g(){var b,c,d=this.attr("id").split("_")[1];for(b in n._state)b!==d&&n._state.hasOwnProperty(b)&&(c=a("select[sb='"+b+"']")[0],c&&n._closeSelectbox(c))}function h(){var c=arguments[1]&&arguments[1].sub?!0:!1,d=arguments[1]&&arguments[1].disabled?!0:!1;arguments[0].each(function(e){var g,h=a(this),i=a("<li>");h.is(":selected")&&(j.text(h.text()),p=f),e===r-1&&i.addClass("last"),h.is(":disabled")||d?(g=a("<span>",{text:h.text()}).addClass(o.settings.classDisabled),c&&g.addClass(o.settings.classSub),g.appendTo(i)):(g=a("<a>",{href:"#"+h.val(),rel:h.val()}).text(h.text()).bind("click.sb",function(c){c&&c.preventDefault&&c.preventDefault();{var d=k,e=a(this);d.attr("id").split("_")[1]}n._changeSelectbox(b,e.attr("rel"),e.text()),n._closeSelectbox(b)}).bind("mouseover.sb",function(){var b=a(this);b.parent().siblings().find("a").removeClass(o.settings.classFocus),b.addClass(o.settings.classFocus)}).bind("mouseout.sb",function(){a(this).removeClass(o.settings.classFocus)}),c&&g.addClass(o.settings.classSub),h.is(":selected")&&g.addClass(o.settings.classFocus),g.appendTo(i)),i.appendTo(l)})}if(this._getInst(b))return e;var i,j,k,l,m=a(b),n=this,o=n._newInst(m),p=e,q=(m.find("optgroup"),m.find("option")),r=q.length;m.attr("sb",o.uid),a.extend(o.settings,n._defaults,c),n._state[o.uid]=e,m.hide(),i=a("<div>",{id:"sbHolder_"+o.uid,targetId:b.id,"class":o.settings.classHolder,tabindex:m.attr("tabindex")}),j=a("<a>",{id:"sbSelector_"+o.uid,href:"#",targetId:b.id,"class":o.settings.classSelector,click:function(c){c.preventDefault(),g.apply(a(this),[]);var d=a(this).attr("id").split("_")[1];n._state[d]?n._closeSelectbox(b):n._openSelectbox(b)}}),k=a("<a>",{id:"sbToggle_"+o.uid,href:"#",targetId:b.id,"class":o.settings.classToggle,click:function(c){c.preventDefault(),g.apply(a(this),[]);var d=a(this).attr("id").split("_")[1];n._state[d]?n._closeSelectbox(b):n._openSelectbox(b)}}),k.appendTo(i),l=a("<ul>",{id:"sbOptions_"+o.uid,targetId:b.id,"class":o.settings.classOptions,css:{display:"none"}}),m.children().each(function(){var b,c=a(this),d={};c.is("option")?h(c):c.is("optgroup")&&(b=a("<li>"),a("<span>",{text:c.attr("label")}).addClass(o.settings.classGroup).appendTo(b),b.appendTo(l),c.is(":disabled")&&(d.disabled=!0),d.sub=!0,h(c.find("option"),d))}),p||j.text(q.first().text()),a.data(b,d,o),i.data("uid",o.uid).bind("keydown.sb",function(b){var c=function(a){return t[a]||a};String.prototype.toLowerI=function(){return this.toLowerCase().replace(s,c)};var e=b.charCode?b.charCode:b.keyCode?b.keyCode:0,f=a(this),g=f.data("uid"),h=f.siblings("select[sb='"+g+"']").data(d),i=f.siblings(["select[sb='",g,"']"].join("")).get(0),j=f.find("ul").find("a."+h.settings.classFocus),k=a("#sbSelector_"+g).text().toLowerI(),l=String.fromCharCode(b.keyCode).toLowerI(),m=f.find("li a"),o=-1,p=!1,q=!1,r=!1,s=/[���������������������������������������]/g,t={"�":"a","�":"o","�":"u","�":"A","�":"O","�":"U","�":"a","�":"a","�":"a","�":"e","�":"e","�":"e","�":"u","�":"u","�":"u","�":"o","�":"o","�":"o","�":"A","�":"A","�":"A","�":"E","�":"E","�":"E","�":"U","�":"U","�":"U","�":"O","�":"O","�":"O","�":"s","�":"a","�":"A","�":"o","�":"O","�":"c","�":"C","�":"n","�":"N"};k.substring(0,1)==l&&(q=!0),a("a",f).removeClass(h.settings.classFocus);for(var u=0;u<m.length;u++){var v=a(m[u]).text().toLowerI();if(v.substring(0,1)==l){if(!q){a(m[u]).addClass(h.settings.classFocus).focus(),a("#sbSelector_"+g).text(v),a(m[u]).trigger("click.sb");break}if(-1==o&&(o=u),r){a(m[u]).addClass(h.settings.classFocus).focus(),a("#sbSelector_"+g).text(v),a(m[u]).trigger("click.sb"),p=!0;break}v==k&&(r=!0),j.length>0&&n._changeSelectbox(i,j.attr("rel"),j.text())}}switch(e){case 37:case 38:if(j.length>0){var w;a("a",f).removeClass(h.settings.classFocus),w=j.parent().prevAll("li:has(a)").eq(0).find("a"),w.length>0&&(w.addClass(h.settings.classFocus).focus(),a("#sbSelector_"+g).text(w.text()),w.click("click.sb"),n._changeSelectbox(i,w.attr("rel"),w.text()))}break;case 39:case 40:var w;a("a",f).removeClass(h.settings.classFocus),w=j.length>0?j.parent().nextAll("li:has(a)").eq(0).find("a"):f.find("ul").find("a").eq(0),w.length>0&&(w.addClass(h.settings.classFocus).focus(),a("#sbSelector_"+g).text(w.text()),w.click("click.sb"),n._changeSelectbox(i,w.attr("rel"),w.text()));break;case 13:j.length>0&&n._changeSelectbox(i,j.attr("rel"),j.text()),n._closeSelectbox(i);break;case 9:if(i){var h=n._getInst(i);h&&(j.length>0&&n._changeSelectbox(i,j.attr("rel"),j.text()),n._closeSelectbox(i))}var u=parseInt(f.attr("tabindex"),10);b.shiftKey?u--:u++,a("*[tabindex='"+u+"']").focus();break;case 27:n._closeSelectbox(i)}return b.stopPropagation(),!1}).delegate("a","mouseover",function(){a(this).addClass(o.settings.classFocus)}).delegate("a","mouseout",function(){a(this).removeClass(o.settings.classFocus)}),j.appendTo(i),l.appendTo(i),i.insertBefore(m),a("html").live("mousedown",function(b){b.stopPropagation(),a("select").selectbox("close")}),a([".",o.settings.classHolder,", .",o.settings.classSelector].join("")).mousedown(function(a){a.stopPropagation()})},_detachSelectbox:function(b){var c=this._getInst(b);return c?(a("#sbHolder_"+c.uid).remove(),a.data(b,d,null),void a(b).show()):e},_changeSelectbox:function(b,c,d){var e,g=this._getInst(b);g&&(e=this._get(g,"onChange"),a("#sbSelector_"+g.uid).text(d)),c=c.replace(/\'/g,"\\'"),a(b).find("option[value='"+c+"']").attr("selected",f),g&&e?e.apply(g.input?g.input[0]:null,[c,g]):g&&g.input&&g.input.trigger("change")},_enableSelectbox:function(b){var c=this._getInst(b);return c&&c.isDisabled?(a("#sbHolder_"+c.uid).removeClass(c.settings.classHolderDisabled),c.isDisabled=e,void a.data(b,d,c)):e},_disableSelectbox:function(b){var c=this._getInst(b);return!c||c.isDisabled?e:(a("#sbHolder_"+c.uid).addClass(c.settings.classHolderDisabled),c.isDisabled=f,void a.data(b,d,c))},_optionSelectbox:function(b,c,f){var g=this._getInst(b);return g?(g[c]=f,void a.data(b,d,g)):e},_openSelectbox:function(b){var c=this._getInst(b);if(c&&!c.isOpen&&!c.isDisabled){var e=a("#sbOptions_"+c.uid),g=parseInt(a(window).height(),10),h=a("#sbHolder_"+c.uid).offset(),i=a(window).scrollTop(),j=e.prev().height(),k=g-(h.top-i)-j/2,l=this._get(c,"onOpen"),m=k-j>300?300:k-j;e.css({top:j+"px",maxHeight:m+"px"}),"fade"===c.settings.effect?e.fadeIn(c.settings.speed):e.slideDown(c.settings.speed),a("#sbToggle_"+c.uid).addClass(c.settings.classToggleOpen),this._state[c.uid]=f,c.isOpen=f,l&&l.apply(c.input?c.input[0]:null,[c]),a.data(b,d,c)}},_closeSelectbox:function(b){var c=this._getInst(b);if(c&&c.isOpen){var f=this._get(c,"onClose");"fade"===c.settings.effect?a("#sbOptions_"+c.uid).fadeOut(c.settings.speed):a("#sbOptions_"+c.uid).slideUp(c.settings.speed),a("#sbToggle_"+c.uid).removeClass(c.settings.classToggleOpen),this._state[c.uid]=e,c.isOpen=e,f&&f.apply(c.input?c.input[0]:null,[c]),a.data(b,d,c)}},_newInst:function(a){var b=a[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:b,input:a,uid:Math.floor(99999999*Math.random()),isOpen:e,isDisabled:e,settings:{}}},_getInst:function(b){try{return a.data(b,d)}catch(c){throw"Missing instance data for this selectbox"}},_get:function(a,c){return a.settings[c]!==b?a.settings[c]:this._defaults[c]}}),a.fn.selectbox=function(b){var c=Array.prototype.slice.call(arguments,1);return"string"==typeof b&&"isDisabled"==b?a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this[0]].concat(c)):"option"==b&&2==arguments.length&&"string"==typeof arguments[1]?a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this[0]].concat(c)):this.each(function(){"string"==typeof b?a.selectbox["_"+b+"Selectbox"].apply(a.selectbox,[this].concat(c)):a.selectbox._attachSelectbox(this,b)})},a.selectbox=new c,a.selectbox.version="0.2"}(jQuery);