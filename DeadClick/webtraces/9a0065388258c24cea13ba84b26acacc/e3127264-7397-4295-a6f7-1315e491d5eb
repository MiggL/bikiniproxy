define(["jquery","wcs.context","wcs.alert","wcs.form-validate","pubsub"],function(e,a,f){var b=false,c="NotifyMe";var d=function(h,g){if(!(this instanceof d)){return new d(h,g)}this.$productFormContainer=e(h);this.$notifyMeSubmitButton=e(".pdp-swatches .notify-me-submit-btn-js, .pdp-swatches-notify-me-form .notify-update-btn");this.$notifyMeCancelButton=e(".pdp-swatches .notify-cancel-btn");this.$productForm=this.$productFormContainer.find(".product-form-js");this.$notifyContainer=this.$productFormContainer.find(".notify-me-container-js");this.$notifyMeBtn=this.$productFormContainer.find(".add-to-bag-js");this.$productActionSection=this.$productFormContainer.find(".selling-form-section-js");this.$productPrimaryActions=this.$productActionSection.find(".product-actions-primary");this.$deliveryInfoContainer=e(".delivery-information");this.initialWindowWidth=e(window).width()};d.prototype={defaults:{},init:function(){console.log("Initializing WCS Notify Me When Available");var g=this;g._events();return g},_events:function(){var g=this;g.$notifyMeSubmitButton.on("click",function(h){g._handleNotifyMeSubmit(h)});g.$notifyMeCancelButton.on("click",function(h){g._closeProductActionSection(h);g.containerAutoResize(h)});e.pubsub("subscribe","window.resize",function(i,h){g._adjustPosition(h)});e.pubsub("subscribe","WCS.PRODUCTFORM.EVENT.NOTIFYME.ACTIVE",function(){g.containerAutoResize()});e.pubsub("subscribe","WCS.PDPSWATCHES.PRODUCTFORM.EVENT.FORMCLICK",function(){if(b){console.log("capture : ","WCS.PDPSWATCHES.PRODUCTFORM.EVENT.FORMCLICK")}g._handleNotifyMeContainerSection()});e.pubsub("subscribe","WCS.PRODUCTFORM.CURRENT_SELECTION.ALL_SELECTED.EXIST",function(){if(b){console.log("capture : ","WCS.PRODUCTFORM.CURRENT_SELECTION.ALL_SELECTED.EXIST")}g._updateNotifyMeAttributesText()});e.pubsub("subscribe","WCS.PRODUCTFORM.ATTRIBUTE.CHANGE",function(){e(".notify-me-container-js").removeClass("expanded")});e.pubsub("subscribe","WCS.PRODUCTFORM.CURRENT_SELECTION.NOT_HAS_INVENTORY",function(i,h){if(b){console.log("capture : ","WCS.PRODUCTFORM.CURRENT_SELECTION.NOT_HAS_INVENTORY")}g._updateNotifyMeURL(h)})},containerAutoResize:function(j){if(b){console.log("containerAutoResize")}var i=this,g=(i.$notifyMeBtn.hasClass("notify-me-active")&&!i.$notifyMeBtn.hasClass("disabled")),k=(i.$notifyContainer.hasClass("expanded")&&i.$notifyContainer.is(":visible")),h=i._getSelectedAttributes();if(!g){return}if(!k){i._expandNotifyContainer(h)}else{i._closeNotifyContainer()}},_closeProductActionSection:function(){if(b){console.log("_closeProductActionSection")}var g=this;g.$productActionSection.find(".online-dealer-js").removeClass("expanded")},_adjustPosition:function(){if(b){console.log("_adjustPosition")}var h=this,g=(h.$notifyMeBtn.hasClass("notify-me-active")&&!h.$notifyMeBtn.hasClass("disabled")),j=h.$notifyContainer.hasClass("expanded"),i=j?h.$notifyContainer.outerHeight():0;if(!g){return}},_updateNotifyMeAttributesText:function(){if(b){console.log("_updateNotifyMeAttributesText")}var g="";if(e(".attr-size .selected").length>0){g+=e(".attr-size .selected").attr("data-attribute-value")}if(e(".attr-size2 .selected").length>0){g+=" "+e(".attr-size2 .selected").attr("data-attribute-value")}if(g!==""){e(".pdp-swatches .notify-me-desc .prod-size-js").text(g)}},_updateNotifyMeURL:function(g){if(b){console.log("_updateNotifyMeURL, catEntryId :",g)}var h="";if(typeof e(".notify-me-js",this.$productForm).attr("href")!="undefined"){h=e(".notify-me-js",this.$productForm).attr("href").replace(/catentryId=\d*/,"catentryId="+g);e(".notify-me-js",this.$productForm).attr("href",h)}},_getSelectedAttributes:function(){if(b){console.log("_getSelectedAttributes")}var h=this,j=h.$productForm.find(".step-container").not(".hide"),g=[],i={};j.each(function(m){var k=e(this),l=k.find(".product-content-form-step-label").text();var n=k.find(".attribute-label-value-js").text()===""?k.find("select").not(".quantity-js").val():k.find(".attribute-label-value-js").text();if(n!==null&&n!==""&&n!==undefined&&n!=="0"){i[l]=n}});return i},_convertSelectedAttToString:function(j){if(b){console.log("_expandNotifyContainer")}var g=this,i="",k=0,h;for(h in j){k=k+1;i+=h+" "+j[h];if(k!=Object.keys(j).length){i+=", "}}return i},_expandNotifyContainer:function(h){if(b){console.log("_expandNotifyContainer")}var g=this;selectedvaluesStr=g._convertSelectedAttToString(h);g.$notifyContainer.addClass("expanded");g.$notifyContainer.find(".prod-color-js").text(selectedvaluesStr);g._adjustPosition();e("html, body").animate({scrollTop:g.$notifyContainer.offset().top},500)},_closeNotifyContainer:function(){if(b){console.log("_closeNotifyContainer")}var g=this;g.$notifyContainer.removeClass("expanded");g._adjustPosition();g.$notifyContainer.find("form.pdp-swatches-notify-me-form-js")[0].reset();if(g.$notifyContainer.find(".notify-me-success-js").html().length>0){g.$notifyContainer.find(".notify-me-success-js").html("")}g.$notifyContainer.find(".notify-me-email-js").removeClass("valid");if(g.$notifyContainer.find(".notify-me-email-js").hasClass("error")){g.$notifyContainer.find(".notify-me-email-js").removeClass("error");g.$notifyContainer.find(".pdp-swatches-notify-me-form-js span").hide()}},_handleNotifyMeSubmit:function(){if(b){console.log("_handleNotifyMeSubmit")}var i=this,h=e(".pdp-swatches-notify-me-form-js"),g={},j=a.getURLWithContextRoot(h.attr("data-url"));if(h.valid()){g.catentryId=e(".pdp-swatches-notify-me-form-js").find(".notify-me-catentryid-js").val();g.shopperEmail=e(".pdp-swatches-notify-me-form-js").find(".notify-me-email-js").val();e.ajax({type:"POST",url:j,data:g,dataType:"json"}).always(function(){f.hideLoadingNotification()}).done(function(k){i._handleDataReturn(k)})}},_handleDataReturn:function(i){if(b){console.log("_handleDataReturn")}var h=this,g=e(".pdp-swatches-notify-me-form-js");if(i.message){g.find(".notify-me-success-js").html(i.message);window.setTimeout(function(){e(".notify-me-container").removeClass("expanded");h._adjustPosition()},5000)}else{e(".notify-me-response-js").removeClass("success").addClass("message error").html(LANG_MSG.GENERIC_ERROR_MESSAGE);h._adjustPosition()}},_handleNotifyMeContainerSection:function(){if(b){console.log("_handleNotifyMeContainerSection")}if(e(".notify-me-container-js").hasClass("expanded")){this.containerAutoResize();e(".notify-me-container-js").removeClass("expanded")}}};d.defaults=d.prototype.defaults;e.fn.NotifyMe=function(g){return this.each(function(){var h=e(this).data(c);if(!h){h=new d(this,g).init();e(this).data(c,h)}})}});