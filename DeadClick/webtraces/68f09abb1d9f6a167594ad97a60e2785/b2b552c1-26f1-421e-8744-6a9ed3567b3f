
'use strict';var containers=['dd-buy-the-outfit','dd-ymal','dd-recently-viewed'];var recommendationsUrl='https://mintvelvet-recommendations.dragondrop.run';var currency=$.cookie('currency_iso')||'GBP';function ProductJson(image,name,link,price,isFullPrice){this.image=image;this.name=name;this.link=link;this.price=price;this.isFullPrice=isFullPrice;}
function getPrice($product){if(!$product||$product.length===0||$('[itemprop="price"]',$product).length===0){console.error('DD RP: error getting price from product',$product);return null;}
var $price=$('[itemprop="price"]',$product);if($('[itemprop="highPrice"]',$price).length>0){var now=$('[itemprop="lowPrice"]',$price).text();var was=$('[itemprop="highPrice"]',$price).text();var original=$('[itemprop="originalPrice"]',$price).text();}else{var now=$price.text();}
if(now.length===0){console.error('DD RP: error getting price from [itemprop="price"]',$price);return null;}
var price={now:now,was:was,original:original};return price;}
function convertProductToJson(product){var $product=$(product);var $anchor=$product.children('a');var $image=$anchor.children('img');var image=$image.attr('src').replace('.jpg','_2.jpg');var name=$image.attr('alt');var link=$anchor.attr('href');var price=getPrice($product);if(price){var isFullPrice=!(price.was&&price.was.length>0);}
if(!link||!image||!name||!price){console.error('DD RP: something went wrong getting recently viewed products',{link:link,image:image,name:name,price:price});return null;}
image=image.replace(/[0-9]+px/,'360px');return new ProductJson(image,name,link,price,isFullPrice);}
function handleResponse(containerId,response){var id=response.id||response.name.replace(/\s/g,'_');new Row(containerId,response.name,id,response.products);}
function Product(productJson){this.image=productJson.image;this.name=productJson.name;this.link=productJson.link;this.price=productJson.price;this.isFullPrice=productJson.isFullPrice;}
Product.prototype.render=function(){return'<li>'+'<a href="'+this.link+'">'+'<img src="'+this.image+'" alt="'+this.name+'">'+'</a>'+'<div class="info">'+'<a class="title" href="'+this.link+'">'+this.name+'</a>'+this.renderPrice();'</div>'+'</li>';};Product.prototype.renderPrice=function(){var price;if(this.isFullPrice){price='\n\t\t\t<span class="dd-price">\n\t\t\t\t<span itemprop="price">'+this.price.now+'</span>\n\t\t\t</span>';}else{price='\n\t\t\t<span class="dd-price">\n\t\t\t\t<span itemprop="lowPrice" class="now">'+this.price.now+'</span>\n\t\t\t\t<br />\n\t\t';if(this.price.was){price+='<span class="was" itemprop="highPrice">'+this.price.was+'</span>';}
if(this.price.original){price+='<span class="was original" itemprop="originalPrice">'+this.price.original+'</span>';}
price+='</span>';}
return price;};function encodeId(id){return id.split('_').map(function(word){return word[0];}).join('').toLowerCase();}
function addTracking(relationshipId,link){console.log('addTracking',relationshipId,link);var type=relationshipId.toLowerCase().indexOf('outfit')>-1?'o':'y';return link+'?dd_rec='+retailerId+'|'+type+'|'+encodeId(relationshipId);}
function Row(containerId,title,relationshipId,productsJson){if(productsJson.length>0){var $container=$('#'+containerId);var html='<h2>'+title+'</h2><ul>';productsJson.forEach(function(productJson){productJson.link=addTracking(relationshipId,productJson.link);html+=new Product(productJson).render();});html+='</ul>';$container.append(html);}}
var $additional=$('.product_additional');$('.nav, .tab-content',$additional).hide();$additional.append(containers.map(function(container){return'<div class="dd-related-products" id="'+container+'"></div>';}).join(''));var retailerId=$('[data-unique-product-key]').attr('data-unique-product-key');$.get(recommendationsUrl+'/outfit?retailerId='+retailerId+'&currency='+currency,function(response){handleResponse('dd-buy-the-outfit',response);});$.get(recommendationsUrl+'/autoymal?retailerId='+retailerId+'&currency='+currency,function(response){handleResponse('dd-ymal',response);});var rvCounter=0;var rvJson=[];var $rvContainer=$('#recently_viewed');function checkRvProducts(){if($('li',$rvContainer).length===0){if(rvCounter++<10){window.setTimeout(checkRvProducts,1000);}}else{$('li',$rvContainer).each(function(i,product){var json=convertProductToJson(product);if(json&&i<4){rvJson.push(json);}});new Row('dd-recently-viewed','Recently viewed','RECENTLY_VIEWED',rvJson);}}
window.setTimeout(checkRvProducts,1000);$('head').append('\n\t\t\t\t\t\t<style>\n\t\t\t\t\t\t\t\t.dd-related-products h2 {\n\t\t\t\t\t\t\t\t\tcolor: #333;\n\t\t\t\t\t\t\t\t\tfont-family: Lato, "GillSans Light", arial, sans-serif;\n\t\t\t\t\t\t\t\t\tfont-size: 16px;\n\t\t\t\t\t\t\t\t\ttext-transform: uppercase;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t.dd-related-products li {\n\t\t\t\t\t\t\t\t\tdisplay: inline-block;\n\n\t\t\t\t\t\t\t\t\twidth: 50%;\n\t\t\t\t\t\t\t\t\tpadding-left: 10px;\n\t\t\t\t\t\t\t\t\tpadding-right: 10px;\n\t\t\t\t\t\t\t\t\tmargin-bottom: 20px;\n\n\t\t\t\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\t\t\t\tvertical-align: top;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t.dd-related-products .title {\n\t\t\t\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\t\t\t\tmin-height: 38px;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t.dd-related-products img {\n\t\t\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t.dd-related-products [itemprop="price"],\n\t\t\t\t\t\t\t\t.dd-related-products [itemprop="lowPrice"]\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t.dd-related-products .dd-price,\n\t\t\t\t\t\t\t\t.dd-related-products .now\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t.dd-related-products [itemprop="originalPrice"] {\n\t\t\t\t\t\t\t\t\tmargin-left: 10px;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t@media (min-width: 640px) {\n\t\t\t\t\t\t\t\t\t.dd-related-products li {\n\t\t\t\t\t\t\t\t\t\twidth: 25%;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t/* Add \'was\' to ymal and buy the outfit was and original prices\n\t\t\t\t\t\t\t\t * We get this automatically in recently viewed */\n\t\t\t\t\t\t\t\t#dd-ymal .was:before, \n\t\t\t\t\t\t\t\t#dd-buy-the-outfit .was:before {\n\t\t\t\t\t\t\t\t\tcontent: "was "\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</style>\n\t\t\t\t');
//# sourceMappingURL=alternative-products-v1.1.2.min.js.map
