!function(){"use strict";var t=function(t){var i=this;i.timeStamp=0,i.timerId=null,i.minInterval=t};t.prototype={exec:function(t){var i=this,e=+new Date,s=e-i.timeStamp;clearTimeout(i.timerId),s>=i.minInterval?(i.timeStamp=e,t()):i.timerId=setTimeout(function(){i.exec(t)},i.minInterval-s)}};var i=function(t,i,e){this.uid=t,this.iframe=i,this.child=e,this.viewable=!1};i.prototype={init:function(){this.iframe.setAttribute("allowfullscreen",!0),this.iframe.setAttribute("webkitallowfullscreen",!0),this.iframe.setAttribute("mozallowfullscreen",!0),this.iframe.addEventListener("load",this,!1),this.child.postMessage({type:"apv-buster-ready",uid:this.uid},"*"),this.checkVisibility()},checkVisibility:function(){if(!/interactive|complete|ready/.test(document.readyState))return void setTimeout(function(t){t.checkVisibility()},100,this);var t=this.isVisible(this.iframe,.5);this.viewable!==t&&(this.child.postMessage({uid:this.uid,type:"apv-buster-visible",value:t},"*"),this.viewable=t)},isVisible:function(t,i){if("none"==t.style.display||"hidden"==t.style.visibility||"collapse"==t.style.visibility)return!1;var e=document.getElementsByTagName("HTML")[0],s=e.style.getPropertyValue("zoom"),n=1;s&&(/^[\d\.]+%$/.test(s)?n=parseFloat(s.replace("%",""))/100:/^[\d\.]+$/.test(s)&&(n=parseFloat(s)));var a=window.pageXOffset,r=window.pageYOffset,o=window.innerHeight,l=window.innerWidth,h=t.offsetHeight*n,c=t.offsetWidth*n,d=h*i,f=c*i,u=0,v=0,p=t;do if(u+=p.offsetTop||0,v+=p.offsetLeft||0,p=p.offsetParent){var m=p.style;if("0px"==m.width||"0px"==m.height||"none"==m.display||"hidden"==m.visibility)return!1}while(p);return u*=n,v*=n,v>=a&&u>=r&&a+l>=c+v&&r+o>=h+u?!0:(a>=v&&v+c-f>a||v>=a&&a+l>=v+f)&&(r>=u&&u+h-d>r||u>=r&&r+o>=u+d)?!0:!1},resize:function(t,i){this.iframe.style.width=t+"px",this.iframe.style.height=i+"px"},handleEvent:function(t){switch(t.type){case"load":this.checkVisibility()}}};var e=function(){this.busters={}};e.prototype={init:function(){window.addEventListener("message",this,!1),window.addEventListener("scroll",this,!1),window.addEventListener("load",this,!1)},checkVisibility:function(){for(var t in this.busters)this.busters[t].checkVisibility()},onLoad:function(){this.checkVisibility()},onScroll:function(){this.checkVisibility()},handleMessage:function(t){if(t.data&&t.data.type){var e=t.data.uid,s=t.source.window;switch(t.data.type){case"apv-buster-init":if(this.busters[e])return;for(var n=s;;){var a=n.parent;if(a==s.top)break;n=a}for(var r=n.top.document.getElementsByTagName("iframe"),o=0;o<r.length;o++)if(r[o].contentWindow===n){var l=new i(e,r[o],s);l.init(),this.busters[e]=l}break;case"apv-resize":var l=this.busters[e];l&&l.resize(t.data.width,t.data.height)}}},handleEvent:function(i){switch(i.type){case"message":this.handleMessage(i);break;case"scroll":var e=this;e.throttle||(e.throttle=new t(100)),e.throttle.exec(function(){e.onScroll()});break;case"load":this.onLoad()}}},(new e).init()}();