gloader.load(["glow", "1", "glow.dom", "glow.widgets.Sortable", "glow.widgets.Carousel"],{
		async: false,
		onload: function(glow) {
	 	
	 //glow.dom.get("div.toHide").hide();

	 if(getCookie('boxes')!=""){
		//recupero il cookie con l'ordine dei box
		myCol1=getCookie('boxes').split('-')[0].split(',');
		myCol2=getCookie('boxes').split('-')[1].split(',');
		myCol3=getCookie('boxes').split('-')[2].split(',');
		// se sono in explorer correggo l'ordine dei box di ogni colonna invertendolo!
		if (navigator.userAgent.indexOf('MSIE') !=-1){
			 myCol1 = myCol1.reverse();
			 myCol2 = myCol2.reverse();
			 myCol3 = myCol3.reverse();
		}
		//elimino il box vuoto/segnaposto 
		myCol1.splice(myCol1.indexOf(""), 1);
		myCol2.splice(myCol2.indexOf(""), 1);
		myCol3.splice(myCol3.indexOf(""), 1);
	 }
	
	
    var iData, sData;

    for (iData = 0; iData < myCol1.length; iData++) {
		sData = glow.dom.get("div#"+myCol1[iData]).html();
		
		if(myCol1[iData] == "bozx4") {
			
			glow.dom.create("<div id=\""+myCol1[iData]+"\" class=\"widget\"><h2><span>Seguici su</span></h2><div class=\"content\"><script src=\"http://static.ak.connect.facebook.com/connect.php/it_IT\" type=\"text/javascript\"></script><script type=\"text/javascript\">FB.init(\"1eb427c640443dc88a324b83245b2ed4\");</script><script type=\"text/javascript\" src=\"https://ssl.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php\"></script><fb:fan profile_id=\"165304869291\" stream=\"1\" connections=\"0\" logobar=\"0\" width=\"307\" height=\"384\"></fb:fan></div></div>").appendTo('.col1');
			
		}
		else glow.dom.create("<div id=\""+myCol1[iData]+"\" class=\"widget\">"+sData+"</div>").appendTo('.col1');
    }
	for (iData = 0; iData < myCol2.length; iData++) {
		sData = glow.dom.get("div#"+myCol2[iData]).html();
		
		if(myCol2[iData] == "bzox4") {
			
			
		glow.dom.create("<div id=\""+myCol2[iData]+"\" class=\"widget\"><h2><span>Seguici su</span></h2><div class=\"content\"><script src=\"http://static.ak.connect.facebook.com/connect.php/it_IT\" type=\"text/javascript\"></script><script type=\"text/javascript\">FB.init(\"1eb427c640443dc88a324b83245b2ed4\");</script><script type=\"text/javascript\" src=\"https://ssl.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php\"></script><fb:fan profile_id=\"165304869291\" stream=\"1\" connections=\"0\" logobar=\"0\" width=\"307\" height=\"384\"></fb:fan></div></div>").appendTo('.col2');
			
		}
		else glow.dom.create("<div id=\""+myCol2[iData]+"\" class=\"widget\">"+sData+"</div>").appendTo('.col2');
    }
	for (iData = 0; iData < myCol3.length; iData++) {
		sData = glow.dom.get("div#"+myCol3[iData]).html();

		if(myCol3[iData] == "bozx4") {
			
		glow.dom.create("<div id=\""+myCol3[iData]+"\" class=\"widget\"><h2><span>Seguici su</span></h2><div class=\"content\"><script type=\"text/javascript\" src=\"http://static.ak.connect.facebook.com/connect.php/it_IT\"></script><script type=\"text/javascript\">FB.init(\"1eb427c640443dc88a324b83245b2ed4\");</script><fb:fan profile_id=\"165304869291\" stream=\"1\" connections=\"0\" logobar=\"0\" width=\"300\"></fb:fan></div></div>").appendTo('.col3');
			
		}
		else glow.dom.create("<div id=\""+myCol3[iData]+"\" class=\"widget\">"+sData+"</div>").appendTo('.col3');
		
    }

	glow.dom.get("div.toHide").destroy();
	glow.dom.get("#content").css("display", "block");
	glow.dom.get("#loaderJava").css("display", "none");
	


   var mySortable = new glow.widgets.Sortable('#cols-example .col1, #cols-example .col2, #cols-example .col3',{							   
		draggableOptions:{
        	handle : 'h2',
			cursor : 'move'
        },
		onSort : savewidgets
	});

   
   $('#galleryMuseo').before('<div id="nav1" class="nav">').cycle({
		fx:     'fade',
		timeout: 0,
		pager:  '#nav1',
		speed:   300, 
		timeout: 3000
	});
   
	$('#galleryMust').before('<div id="nav2" class="nav">').cycle({
		fx:     'fade',
		timeout: 0,
		pager:  '#nav2',
		speed:   300,
		timeout: 3000
	});
	
	$('#galleryToti').before('<div id="nav3" class="nav">').cycle({
		fx:     'fade',
		timeout: 0,
		pager:  '#nav3',
		speed:   300,
		timeout: 3000
	});
	
	
	$('#galleryAlimentazione').before('<div id="nav4" class="nav">').cycle({
		fx:     'fade',
		timeout: 0,
		pager:  '#nav4',
		speed:   300,
		timeout: 3000
	});
	
	$('#galleryLeonardo').before('<div id="nav5" class="nav">').cycle({
		fx:     'fade',
		timeout: 0,
		pager:  '#nav5',
		speed:   300,
		timeout: 3000
	});
	
	$('#galleryWalls').before('<div id="nav6" class="nav">').cycle({
		fx:     'fade',
		timeout: 0,
		pager:  '#nav6',
		speed:   300,
		timeout: 3000
	});
	
		$('#galleryMustLocation').before('<div id="nav7" class="nav">').cycle({
		fx:     'fade',
		timeout: 0,
		pager:  '#nav7',
		speed:   300,
		timeout: 3000
	});
				
	$("#accordion").accordion({active: 7, autoHeight: false, icons: { 'header': '/imgs/spindown-closed.gif', 'headerSelected': '/imgs/spindown-open.gif' }});
   
   		/*DIV FADE*/
	var numDivFade = $('div#news > *').length; //numero di DIV da far scorrere
	var m = 0; 
	
	/* Attivo i pulsanti della prima news */
	$('div#forwardNews'+m+'').bind('click', rotateButton);
	$('div#backwardNews'+m+'').bind('click', unrotateButton);
	var changing = 0;
	var tempFade;
	function rotate(){
	
		/* Disattivo i pulsanti della news che sta scomparendo */
		$('div#forwardNews'+m+'').unbind('click', rotateButton); 
		$('div#backwardNews'+m+'').unbind('click', unrotateButton);
		changing=1;
		$('div#news'+m+'').fadeOut(500, function(){ //fadeOut DIV in primo piano
			if (++m >= numDivFade) m=0; //incremento il contatore
			$('div#news'+m+'').fadeIn(500); //fadeIn DIV successivo
			
			/* Attivo i pulsanti della news che sta apparendo */
			$('div#forwardNews'+m+'').bind('click', rotateButton);
			$('div#backwardNews'+m+'').bind('click', unrotateButton);
			changing = 0;
		});
	}
	function rotateButton(){
		/* Ricarico la pausa "Out" */
		var src = $('div#pauseNews'+m+' img').attr("src").replace("Over", "");
		$('div#pauseNews'+m+' img').attr("src", src); 
		
		/* Disattivo i pulsanti della news che sta scomparendo */
		$('div#forwardNews'+m+'').unbind('click', rotateButton);
		$('div#backwardNews'+m+'').unbind('click', unrotateButton);
		changing=1;
		$('div#news'+m+'').fadeOut(500, function(){ //fadeOut DIV in primo piano
			if (++m >= numDivFade) m=0; //incremento il contatore
			$('div#news'+m+'').fadeIn(500); //fadeIn DIV successivo
			
			/* carico la pausa "over" della nuova news perchè presumo che l'utente sia ancora MouseOver
			var src = $('div#pauseNews'+m+' img').attr("src").match(/[^\.]+/)+"Over.gif";
			$('div#pauseNews'+m+' img').attr("src", src); */
			/* Attivo i pulsanti della news che sta apparendo */
			$('div#forwardNews'+m+'').bind('click', rotateButton);
			$('div#backwardNews'+m+'').bind('click', unrotateButton);
			changing = 0;
		});
	}
	function unrotateButton(){
		/* Ricarico la pausa "Out" */
		var src = $('div#pauseNews'+m+' img').attr("src").replace("Over", "");
		$('div#pauseNews'+m+' img').attr("src", src); 
		
		/* Disattivo i pulsanti della news che sta scomparendo */
		$('div#forwardNews'+m+'').unbind('click', rotateButton);
		$('div#backwardNews'+m+'').unbind('click', unrotateButton);
		changing=1;
		$('div#news'+m+'').fadeOut(500, function(){ //fadeOut DIV in primo piano
			if (--m < 0) m=numDivFade-1; //incremento il contatore
			$('div#news'+m+'').fadeIn(500); //fadeIn DIV successivo
			
			/* carico la pausa "over" della nuova news perchè presumo che l'utente sia ancora MouseOver
			var src = $('div#pauseNews'+m+' img').attr("src").match(/[^\.]+/)+"Over.gif";
			$('div#pauseNews'+m+' img').attr("src", src); */
			
			/* Attivo i pulsanti della news che sta apparendo */
			$('div#forwardNews'+m+'').bind('click', rotateButton);
			$('div#backwardNews'+m+'').bind('click', unrotateButton);
			changing = 0;
		});
	}
	function mouseenterFunc(){
		$('div#diverror').append("<span>++++++Enter <br/></span>");
		clearInterval(id_timer); //stoppo l'interval
		if(!changing) {
			var src = $('div#pauseNews'+m+' img').attr("src").match(/[^\.]+/)+"Over.gif";
			$('div#pauseNews'+m+' img').attr("src", src); 
		}
		else { // se il DIV è in fadeOut
			tempFade=m+1;
			var src = $('div#pauseNews'+tempFade+' img').attr("src").match(/[^\.]+/)+"Over.gif";
			$('div#pauseNews'+tempFade+' img').attr("src", src); 
		}
	}
	function mouseleaveFunc(){
		$('div#diverror').append("<span>----Leave <br/></span>");
		clearInterval(id_timer); //stoppo l'interval
		id_timer = setInterval(rotate,6000); // risetto l'interval
		if(!changing) {
			var src = $('div#pauseNews'+m+' img').attr("src").replace("Over", "");
			$('div#pauseNews'+m+' img').attr("src", src); 
		}
		else { // se il DIV è in fadeOut 
			
		}
	}
	if(numDivFade > 1) {
		id_timer = setInterval(rotate,6000); //setto l'interval per far ruotare i DIV
		$('div#news').bind('mouseenter',mouseenterFunc);
		$('div#news').bind('mouseleave',mouseleaveFunc);
	}
	
	
	
	$('#menu2liv li.tendina').hover(  
     function(){  
       $(this).children('ul:first:hidden').css({visibility: "visible",display:'block'});  
     },  
     function(){  
       $(this).children('ul:first:visible').css({visibility: "hidden",display:'none'});  
     })

	/*DIV containerMultiCarouselO*/
  	var numDivSlideM = $('div#containerMultiCarousel > *').length; //numero di DIV da far scorrere

    //var s = Math.floor(Math.random() * numDivSlideM)
	var p = 0;
	var r = 1;
	$('div#itemMultiCarousel'+p+'').css("left", 250 );
	$('div#itemMultiCarousel'+r+'').css("left", 375 );
	if (numDivSlideM <= 2){
		$('div#clickMultiCarouselL').css("background-image", "url(/imgs/frecce/multiLeftOff.gif)");
		$('div#clickMultiCarouselR').css("background-image", "url(/imgs/frecce/multiRightOff.gif)");
	}
	else{
		function move1R(){
			$('div#clickMultiCarouselR').unbind('click',move1R); //rimuovi il listener sul click per evitare errori con click ravvicinati
			$('div#itemMultiCarousel'+p+'').animate( { "left": 125 }, 500);//faccio uscire sulla sinistra il DIV in primo piano
			$('div#itemMultiCarousel'+r+'').animate( { "left": 250 }, 500);
			p=r;
			r+=1;
			if (r>=numDivSlideM) r=0; //incremento il contatore
			$('div#itemMultiCarousel'+r+'').css("left", 500 ); //posiziono a destra il div successivo
			$('div#itemMultiCarousel'+r+'').animate( { "left": 375 }, 500 , function(){ //faccio entrare il DIV successivo
				$('div#clickMultiCarouselR').bind('click',move1R); //riattivo il listener sul click 
			})
		}
		function move1L(){
			$('div#clickMultiCarouselL').unbind('click',move1L); //rimuovi il listener sul click per evitare errori con click ravvicinati
			$('div#itemMultiCarousel'+p+'').animate( { "left": 375 }, 500);//faccio uscire sulla sinistra il DIV in primo piano
			$('div#itemMultiCarousel'+r+'').animate( { "left": 500 }, 500);
			r=p;
			p-=1;
			if (p<0) p=numDivSlideM-1; //incremento il contatore
			$('div#itemMultiCarousel'+p+'').css("left", 125 ); //posiziono a destra il div successivo
			$('div#itemMultiCarousel'+p+'').animate( { "left": 250 }, 500 , function(){ //faccio entrare il DIV successivo
				$('div#clickMultiCarouselL').bind('click',move1L); //riattivo il listener sul click 
			})
		
		}
	
		$('div#clickMultiCarouselL').css("cursor", "pointer");
		$('div#clickMultiCarouselL').bind('click',move1L);// attivo il listener sul click
		$('div#clickMultiCarouselR').css("cursor", "pointer");
		$('div#clickMultiCarouselR').bind('click',move1R);// attivo il listener sul click
	}
	
	
	
	
	
	
	
   
}});


if(!Array.indexOf){
   Array.prototype.indexOf = function(obj){
      for(var i=0; i<this.length; i++){
         if(this[i]===obj){
            return i;
         }
      }
      return -1;
   }
}


//saves/updates the widget information that is our page layout 
function savewidgets () {
    var order1col = [];
	var order2col = [];
	var order3col = [];
	$('#cols-example .col1 > *').sort().each(function () {
		order1col.push(this.id);
	});
	$('#cols-example .col2 > *').sort().each(function () {
		order2col.push(this.id);
	});
	$('#cols-example .col3 > *').sort().each(function () {
		order3col.push(this.id);
	});
	setCookie('boxes', order1col.join(',')+'-'+order2col.join(',')+'-'+order3col.join(','), 365);
}

function getCookie(c_name){
	if (document.cookie.length>0){
	  c_start=document.cookie.indexOf(c_name + "=");
	  if (c_start!=-1){
		c_start=c_start + c_name.length+1;
		c_end=document.cookie.indexOf(";",c_start);
		if (c_end==-1) c_end=document.cookie.length;
		return unescape(document.cookie.substring(c_start,c_end));
		}
	  }
	return "";
}

function setCookie(c_name,value,expiredays){
	var exdate=new Date();
	exdate.setDate(exdate.getDate()+expiredays);
	document.cookie=c_name+ "=" +escape(value)+
	((expiredays==null) ? "" : ";expires="+exdate.toGMTString());
}
