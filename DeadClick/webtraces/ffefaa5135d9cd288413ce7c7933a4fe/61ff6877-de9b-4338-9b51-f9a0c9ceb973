define(["jquery","pubsub","promise!wcs.zmetrics"],function(b,a){if(WCS_CONFIG.get("ANALYTICS::cmEnabled")){b.pubsub("subscribe","vfdp.wcs.product_form.add_to_cart_succeeded",function(m,u){try{var l=b(".product-form-js").eq(u.productFormIndex);var q="";var r="0.00";var i="";var c;var o=l.data("AddToCartForm").productId;var n=l.data("AddToCartForm").catEntryId;var h=l.data("AddToCartForm").productAvailability.getPartNumber(n);var d=l.data("bundle-part-number");var t=l.data("seo-category");var f=l.closest(".quickview-box-js").length===0?false:true;var j=(f?b(".product-listing-js").data("category-identifier"):"");var p=l.data("master-category-identifier");var e=l.data("breadcrumb");if(l.parents(".bundle-product-info-js").length>0){q=l.parents(".bundle-product-info-js").find(".product-info-js").text();r=l.find(".product-price-amount-js").data("amount")}else{q=b("#product-info .product-info-js").text();if(b("#product-info .product-price-amount-js").length>0){c=b("#product-info .product-price-amount-js")}else{if(b("#product-form .product-price-amount-js").length>0){c=b("#product-form .product-price-amount-js")}}if(c){r=c.data("amount")}}if(l.find(".attr-color-js").length>0){var s=l.find(".attr-color-js .attr-primary-name-js .attr-primary-name-label").clone();s.find(".step-number").remove();i+=(s.text()+": "+l.find(".attr-color-js .attr-primary-name-js .attribute-label-value-js").text()).replace(/\t|\n|\r/g,"")}l.find(".step-container.attribute-value-selected:not(.attr-color)").each(function(){var v=b(this).find(".attr-primary-name-js").clone();v.find(".step-number").remove();name=v.text().replace(/\t|\n|\r/g,"");value=b(this).find(".attr-input-js[name='attrValue']").val();i+=(i.length>0?" / ":"")+name+": "+value});i=i.replace(/[ ]+/g," ");var k={currency:b("meta[property='og:price:currency']").attr("content"),productName:q,productId:l.find('input[name="productCode"]').val(),unitPrice:r,definingAttributes:b.trim(i),quantity:l.find(".quantity-js").val(),categoryId:j?j:"",masterCategoryId:p?p:"",childPartNumber:h?h:"",parentProductId:o?o:"",childProductId:n?n:"",bundlePartNumber:d?d:"",seoCategory:t?t:"",isQuickView:f,isSearch:(f&&j==="search"),productOrigination:e};zm.trackAddedItem(k);if(WCS_CONFIG.get("global::bloomReachEnabled")&&typeof BrTrk!=="undefined"){BrTrk.getTracker().logEvent("cart","click-add",{prod_id:l.find('input[name="productCode"]').val(),sku:(h?h:"")})}}catch(g){console.error("Failed push to coremetrics",g)}})}});