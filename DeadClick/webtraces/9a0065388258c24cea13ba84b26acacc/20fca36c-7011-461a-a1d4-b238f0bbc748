define(["jquery","pubsub"],function(e,d){e.pubsub("subscribe","vfdp.wcs.product_form.add_to_cart_clicked",function(){try{var g=e(".product-form-js"),i=g.closest(".quickview-box-js").length===0?false:true,f="fullpdp";if(i===true){f="quickview"}window.dataLayer.push({event:"addToCartClick",clickSource:f})}catch(h){console.error("Failed push to dataLayer",h)}});e.pubsub("subscribe","vfdp.wcs.product_form.add_to_cart_succeeded",function(g,h){var i=a(h);var f=b();c(i,f,"addToCart")});e.pubsub("subscribe","vfdp.wcs.product_form.add_to_wishlist_succeeded",function(g,h){var i=a(h);var f=b();c(i,f,"addToWishlist")});e.pubsub("subscribe","vfdp.wcs.product_form.add_to_favorites_succeeded",function(g,h){var i=a(h);var f=b();c(i,f,"addToFavorites")});e.pubsub("subscribe","vfdp.wcs.product_form_cart.add_to_wishlist_succeeded",function(g,h){var f=b();if(WCS_CONFIG.get("global::favoritesEnabled")===true){c(h,f,"addToFavorites")}else{c(h,f,"addToWishlist")}});e.pubsub("subscribe","product-form.attr.context.changed",function(g,h){var i=a(h);var f=b();c(i,f,"productDetailViewUpdated")});function c(k,g,j){var h={event:j,ecommerce:{currencyCode:g.currencyCode?g.currencyCode:null,currencySymbol:g.currencySymbol?g.currencySymbol:null}};var f={products:[{name:k.productName,id:k.productId,bundleID:k.bundleId?k.bundleId:null,productID:k.productId?k.productId:null,itemID:k.itemId?k.itemId:null,vn:k.itemId?k.itemId:null,price:parseFloat(k.unitPrice),brand:"",category:k.categoryId?k.categoryId:"Misc",variant:e.trim(k.definingAttributes)?e.trim(k.definingAttributes):"",quantity:k.quantity?k.quantity:1}]};if(j==="addToCart"){h.ecommerce.add=f;h.atcProduct=k.atcProduct}else{if(j==="productDetailViewUpdated"){h.ecommerce.detail=f}else{h.ecommerce[j]=f}}try{window.dataLayer.push(h)}catch(i){console.error("Failed push to dataLayer",i)}}function a(A){var s=e(".product-form-js").eq(A.productFormIndex),l=e("meta[property='og:price:currency']").attr("content"),q=s.data("product-part-number"),w="",y="0.00",o="",g,u=s.find("input[name=catEntryId]").val(),t=s.data("child-catentry-id"),n=s.data("child-part-number"),i=s.data("bundle-part-number").toString(),z=s.data("seo-category"),k=s.closest(".quickview-box-js").length===0?false:true,j=s.data("breadcrumb"),p=(k?e(".product-listing-js").data("category-identifier"):""),v=s.data("master-category-identifier"),r=s.find(".quantity-js").val(),h={sku:q,name:w,category:v?v:"Misc",price:parseFloat(y),vn:n?n:"",parentId:u?u:"",childId:t?t:"",bundlePartNumber:i?i:"",productOrigination:j?j:"search",seoCategory:z?z:""};var f=s.parents(".bundle-product-info-js");if(f.length>0){w=f.find(".product-info-js").data("catentry-name-dl");y=f.find(".product-price-amount-js").text().match(/[0-9]+(.[0-9]+)*/g);y=(y===null||y.length<1)?0:parseFloat(y[0])}else{w=e("#product-info .product-info-js:not(.hide)").data("catentry-name-dl");if(e("#product-info .product-price-amount-js").length>0){g=e("#product-info .product-price-amount-js")}else{if(e("#product-form .product-price-amount-js").length>0){g=e("#product-form .product-price-amount-js")}}if(g){y=g.data("amount")}}if(s.find(".attr-color-js").length>0){var x=s.find(".attr-color-js:not(.hide) .attr-primary-name-js .attr-primary-name-label").clone();x.find(".step-number").remove();o+=(x.text()+": "+s.find(".attr-color-js:not(.hide) .attr-primary-name-js .attribute-label-value-js").text()).replace(/\t|\n|\r/g,"")}s.find(".step-container.attribute-value-selected:not(.attr-color)").each(function(){var B=e(this).find(".attr-primary-name-js").clone();B.find(".step-number").remove();name=B.text().replace(/\t|\n|\r/g,"");value=e(this).find(".attr-input-js[name='attrValue']").val();o+=(o.length>0?" / ":"")+name;if(value){o+=": "+value}});o=o.replace(/[:]+/g,":");h.price=parseFloat(y);h.name=w;var m={productName:w,productId:q,bundleId:i,itemId:n,unitPrice:y,categoryId:v,definingAttributes:o,quantity:r,atcProduct:h};return m}function b(){var f;var h;var k;if(window.dataLayer){for(var j in window.dataLayer){k=window.dataLayer[j];f=k.currency;h=k.currencySymbol;if(h){h=h.replace(/&amp;/g,"&");h=e("<textarea/>").html(h).text();window.dataLayer[j].currencySymbol=h;break}}}var g={currencySymbol:h,currencyCode:f};return g}});