{"sessionId":"f778fb532d8a4e7b89e98066f211e5b3","offers":[{"html":"<script>\n// this function makes a request to Target carrying all the above data with it. You will receive a response if you have correctly configured the activity. It's wrapped in an if statement so that it only runs on hotel pages.\nif (dataLayer.pageType === \"hotelRenderer\") {\n// the variables woudl be represented by Data Elements if this was coming from DTM.\n  var categoryMeta = tmgAds.page.zone;\nvar categoryId = categoryMeta.replace(/\\./g, ',');\nvar thumbnailURL = document.querySelector('meta[property=\"og:image\"]').getAttribute('content');\nvar name = document.querySelector('meta[property=\"og:title\"]').getAttribute('content');\nvar message = document.querySelector('.p_hub__section_1 .product-card__overview p').textContent;\nvar price = document.querySelector('div.travel-price.travel-price--price-focus.travel-price--book-now > span.travel-price__wrap > span.travel-price__price').textContent\nvar externalURL = document.querySelector('section > div > aside > div > div > div > div.travel-cta.travel-cta--book-now > a').getAttribute('href');\nvar provider = document.querySelector('div.product-book-now__container > div.product-book-now__provider > div.travel-provider > div.travel-provider__name').textContent;\nvar rating = document.querySelector('section > div > article > div > div > div.product-card__approved > div.product-card__rating > span.product-card__rating__rate').textContent;\n\n    adobe.target.getOffer({\n        \"mbox\": \"recommendations-mbox\",\n        \"params\": {\n            \"entity.id\": dataLayer.flakeId,\n            \"entity.categoryId\": categoryId,\n            \"entity.thumbnailURL\": thumbnailURL,\n            \"entity.name\": name,\n            \"entity.pageURL\": document.location.pathname,\n            \"entity.message\": message,\n            \"entity.value\": price,\n            \"entity.externalURL\": externalURL,\n            \"entity.provider\": provider,\n            \"entity.rating\": rating\n        },\n        \"success\": function(offers) {\n            adobe.target.applyOffer({\n                \"mbox\": \"recommendations-mbox\",\n                \"offer\": offers\n            });\n        },\n        \"error\": function(status, error) {}\n    });\n}\nelse if (dataLayer.pageType === \"destinationRenderer\") {\n    var categoryMeta = tmgAds.page.zone;\nvar categoryId = categoryMeta.replace(/\\./g, ',');\n  adobe.target.getOffer({\n    \"mbox\": \"recommendations-mbox\",\n    \"params\": {\n      \"entity.categoryId\": categoryId\n    },\n    \"success\": function(offers) {\n            adobe.target.applyOffer({\n                \"mbox\": \"recommendations-mbox\",\n                \"offer\": offers\n            });\n        },\n        \"error\": function(status, error) {}\n  });\n}\n  </script>"},{"html":"<style>\n.articleRenderer2 {\n    position: relative;\n}\n#articleOverlay {\n    background-color: rgba(255, 255, 255, 0.8);\n    bottom: 0;\n    left: 0;\n    position: absolute;\n    right: 0;\n    top: 0;\n    z-index: 100;\n}\n.articleOverlay-article {\n    background-color: #fcfaf7;\n    border-top: 3px solid #008385;\n    color: #333333;\n    left: 50%;\n    padding: 15px 20px;\n    position: fixed;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    width: 90%;\n}\n@media only screen and (min-width: 600px) {\n    .articleOverlay-article {\n        width: 555px;\n    }\n}\n.articleOverlay-article h1 {\n    border-bottom: 1px solid #e4e4e4;\n    color: #008385;\n    font-size: 2.3rem;\n    line-height: 3.2rem;\n    margin-bottom: 0;\n    margin-top: 0;\n    padding-bottom: 14px;\n}\n.articleOverlay-article h2 {\n    font-family: \"Austin News Deck Medium\", Georgia, Times, serif;\n    font-size: 2rem;\n    line-height: 2.4rem;\n    margin-bottom: 0;\n    margin-top: 8px;\n}\n.articleOverlay-article span {\n    text-decoration: underline;\n}\n.articleOverlay-article ul {\n    font-family: \"Austin News Deck Medium\", Georgia, Times, serif;\n    font-size: 1.7rem;\n    line-height: 2.4rem;\n    list-style-type: none;\n    margin: 12px 0 0;\n    padding: 0;\n}\n.articleOverlay-article li {\n    padding-left: 14px;\n    position: relative;\n}\n.articleOverlay-article li::before {\n    background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii05OTY3LjIwNyAtNTIyOS4yMDcgMS40MTQgMS40MTQiPjxyZWN0IGlkPSJyZWN0YW5nbGUtNzMiIGZpbGw9InRlYWwiIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC05OTY2LjUgLTUyMjkuMjA3KSByb3RhdGUoNDUpIi8+PC9zdmc+');\n    content: '';\n    display: inline-block;\n    height: 8px;\n    left: 0;\n    position: absolute;\n    top: 8px;\n    width: 8px;\n}\n.articleOverlay-buttons {\n    margin-top: 20px;\n}\n.articleOverlay-buttons a {\n    border: 1px solid #008385;\n    color: #03908b;\n    display: block;\n    font-family: \"Telesans Text Regular\", serif;\n    font-size: 1.6rem;\n    padding-bottom: 12px;\n    padding-top: 12px;\n    text-align: center;\n}\n.articleOverlay-buttons a:hover {\n    background-color: rgba(3, 144, 139, 0.1);\n}\n.articleOverlay-buttons .articleOverlay-register {\n    background-color: #03908b;\n    color: #ffffff;\n    margin-bottom: 8px;\n}\n.articleOverlay-buttons .articleOverlay-register:hover {\n    background-color: #007d78;\n}\n@media only screen and (min-width: 480px) {\n    .articleOverlay-buttons {\n        display: flex;\n        flex-wrap: wrap;\n        justify-content: space-between;\n    }\n    .articleOverlay-buttons a {\n        display: inline-block;\n        flex-basis: 48.5%;\n    }\n    .articleOverlay-buttons .articleOverlay-register {\n        margin-bottom: 0;\n    }\n}\n.articleOverlay-bar {\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: space-between;\n    margin-top: 20px;\n}\n.articleOverlay-close {\n    background: none;\n    border: 0;\n    color: #03908b;\n    font-family: \"Telesans Text Regular\", serif;\n    font-size: 1.6rem;\n}\n</style>\n<script>\n(function ( window, document ) {\n\n\tvar config = {\n\t\ttriggerCount: 2,\n\t\tarticle: '.articleRenderer2',\n\t\tarticleRegister: '.articleOverlay-register',\n\t\tarticleLogin: '.articleOverlay-login',\n\t\tarticleClose: '.articleOverlay-close'\n\t};\n\n\tvar articleOverlay = function() {\n\t\tthis.init();\n\t};\n\n\tarticleOverlay.prototype.init = function() {\n\t\tvar isLoggedIn = this.isLoggedIn();\n\n\t\tif ( !isLoggedIn ) {\n\n\t\t\t// If local and session storage match - same visit\n\t\t\t// Check if First Session storage missing so must be repeat visit\n\t\t\tif ( localStorage.getItem( 'articleSession' ) && !sessionStorage.getItem( 'articleSession' ) ) {\n\n\t\t\t\t// Now we know it's the second session, we need the triggerCount article\n\t\t\t\tvar articleCount = this.articleCount();\n\t\t\t\tif ( articleCount >= config.triggerCount - 1 ) {\n\t\t\t\t\tthis.showModal();\n\t\t\t\t\tlocalStorage.removeItem( 'articleVisits' );\n\t\t\t\t\tsessionStorage.setItem( 'articleSession', true );\n\t\t\t\t} else {\n\t\t\t\t\t// Let's update the localStorage count\n\t\t\t\t\tthis.articleCount( true );\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tlocalStorage.setItem( 'articleSession', true );\n\t\t\t\tsessionStorage.setItem( 'articleSession', true );\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\t// Check user status (logged in)\n\tarticleOverlay.prototype.isLoggedIn = function() {\n\t\treturn Cookies.get( 'tmg_session' );\n\t};\n\n\t// Add article count in local storage\n\tarticleOverlay.prototype.articleCount = function( increase ) {\n\t\tvar articleVisits = parseInt( localStorage.getItem( 'articleVisits' ) ),\n\t\t\tnumberViews = articleVisits ? articleVisits : 0;\n\t\tif ( increase ) {\n\t\t\tvar newCount = numberViews + 1;\n\t\t\treturn localStorage.setItem( 'articleVisits', newCount );\n\t\t} else {\n\t\t\treturn numberViews;\n\t\t}\n\t};\n\n\tarticleOverlay.prototype.tracking = function() {\n\n\t\tvar _this = this;\n\n\t\t// On Register - fire tracking event\n\t\tdocument.querySelector( config.articleRegister ).addEventListener( 'click', function( e ){\n\t\t\te.preventDefault();\n\t\t\tadobe.target.trackEvent({ 'mbox': 'articleClickRegister' });\n\t\t\tsetTimeout(function () { window.location.href = e.target.href; }, 200);\n\t\t});\n\n\t\t// On Log in - fire tracking event\n\t\tdocument.querySelector( config.articleLogin ).addEventListener( 'click', function( e ){\n\t\t\te.preventDefault();\n\t\t\tadobe.target.trackEvent({ 'mbox': 'articleClickLogin' });\n\t\t\tsetTimeout(function () { window.location.href = e.target.href; }, 200);\n\t\t});\n\n\t\tdocument.querySelector( config.articleClose ).addEventListener( 'click', function( e ){\n\t\t\te.preventDefault();\n\t\t\tadobe.target.trackEvent({ 'mbox': 'articleClickClose' });\n\t\t\t_this.closeModal();\n\t\t});\n\n\t};\n\n\t// Build the markup for the modal to add to DOM\n\tarticleOverlay.prototype.showModal = function() {\n\n\t\tvar article = document.querySelector( config.article ),\n\t\t\toverlay = document.createElement( 'div' ),\n\t\t\tmodal = document.createElement( 'article' ),\n\t\t\tcustomerURL = 'https://secure.telegraph.co.uk/secure/';\n\n\t\t// Overlay config\n\t\toverlay.id = 'articleOverlay';\n\n\t\t// Inner config\n\t\tmodal.setAttribute( 'class', 'articleOverlay-article');\n\t\tmodal.innerHTML = \t'<h1>Register now to get more from The Telegraph</h1>' +\n\t\t\t'<h2>It\\'s easy and free to create an account. Then you can:</h2>' +\n\t\t\t'<ul>' +\n\t\t\t'<li>Sign up to our expert newsletters</li>' +\n\t\t\t'<li>Join the debate by posting article comments</li>' +\n\t\t\t'<li>Access a Premium article, free, every week</li>' +\n\t\t\t'</ul>' +\n\t\t\t'<div class=\"articleOverlay-buttons\">' +\n\t\t\t'<a href=\"'+customerURL+'registration?icid=engagement_softreg_generic_generic_overlay&redirectTo='+document.location.href+'\" class=\"articleOverlay-register\">Register</a>' +\n\t\t\t'<a href=\"'+customerURL+'login?icid=engagement_softreg_generic_generic_overlay&redirectTo='+document.location.href+'\" class=\"articleOverlay-login\">Log in</a>' +\n\t\t\t'</div>' +\n\t\t\t'<div class=\"articleOverlay-bar\">' +\n\t\t\t'<img class=\"articleOverlay-logo\" width=\"143\" height=\"24\" alt=\"The Telegraph\" src=\"/content/dam/best/telegraph_OUTLINE-small.png\" />' +\n\t\t\t'<button class=\"articleOverlay-close\">Close</button>' +\n\t\t\t'</div>';\n\n\t\t// Add overlay to the DOM\n\t\toverlay.appendChild( modal );\n\t\tarticle.appendChild( overlay );\n\n\t\t// Tracking event for users who view the modal\n\t\tadobe.target.trackEvent({ 'mbox': 'articleModalvisible' });\n\n\t\t// Track click events\n\t\tthis.tracking();\n\n\t};\n\n\tarticleOverlay.prototype.closeModal = function() {\n\t\tdocument.getElementById( 'articleOverlay' ).outerHTML= '';\n\t};\n\n\tif ( document.readyState !== 'loading' ) {\n\t\tnew articleOverlay();\n\t} else {\n\t\tdocument.addEventListener( 'DOMContentLoaded', function() {\n\t\t\tnew articleOverlay();\n\t\t});\n\t}\n\n})( window, document );\n</script>"}]}