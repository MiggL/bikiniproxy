GrahamTechnology.ui.FormHolder=function(a){GrahamTechnology.ui.AbstractComponent.call(this,a);this.initialiseComponent=function(){this.registerDisplayMessageHandlerForForm(this.InnerFormID,this.getInnerFormElementId(this.InnerFormID))};this.buildChildComponentsList=function(g,h,e,f){var j=GrahamTechnology.grasp.ComponentType;f[f.length]=g;var c;for(var b in h){c=h[b];if(c&&c.FormID==g){e[e.length]=c;if(c.ComponentType==j.FormHolder){if(c.InnerFormID!=-1){c.buildChildComponentsList(c.InnerFormID,h,e,f)}if(!GrahamTechnology.Base.isUndefinedOrNull(c.innerFormIDs)){for(var d in c.innerFormIDs){if(d!=c.InnerFormID&&d!=-1){c.buildChildComponentsList(parseInt(d,10),h,e,f)}}}}else{if(c.ComponentType==j.TabbedFormHolder||c.ComponentType==j.AccordionFormHolder){for(var d=0;d<c.formIDs.length;d++){c.buildChildComponentsList(c.formIDs[d],h,e,f)}}}}}};this.destroy=function(){GrahamTechnology.ui.FormHolder.prototype.destroy.call(this)};this.unregisterActiveComponents=function(e){logger.log("Unregistering components from form holder "+this.id,"info","FormHolder.unregisterActiveComponents");var c=GrahamTechnology.ui.Form.getForm(this.TopLevelFormID);var k=new Array();var g=new Array();this.buildChildComponentsList(e,c.components,k,g);for(var f=0;f<k.length;f++){GrahamTechnology.ui.Form.unregister(this.TopLevelFormID,k[f].id)}logger.log("Unregistering panes from form holder "+this.id,"info","FormHolder.unregisterActiveComponents");var h=GrahamTechnology.ui.Form.allPanes;for(var l=0;l<g.length;l++){var e=g[l];var j=GrahamTechnology.ui.Form.getPanesForFormID(e);for(var b=0;b<j.length;b++){var d=j[b];d.destroy();delete h[d.paneID]}this.unregisterDisplayMessageHandlerForForm(e)}};this.runForm=function(e,b){var d=YAHOO.util.Dom.get("innerForm"+this.PreviousInnerFormID);if(!GrahamTechnology.Base.isUndefinedOrNull(d)){d.style.display="none";GrahamTechnology.ui.Form.disableAllAccessKeysForForm(this.PreviousInnerFormID)}var c=YAHOO.util.Dom.get("innerForm"+this.InnerFormID);if(!GrahamTechnology.Base.isUndefinedOrNull(c)){c.style.display="block";GrahamTechnology.ui.Form.visibleFormIDs=null;if(GrahamTechnology.ui.Form.isVisibleFormID(e)){GrahamTechnology.ui.Form.enableAllAccessKeysForForm(this.InnerFormID)}}};this.popdownForm=function(d){if(!GrahamTechnology.Base.isUndefinedOrNull(this.innerFormIDs)){delete this.innerFormIDs[d+""]}this.clearInnerForm(d);var c=this.getFormHolderElement(d);if(c){var b=c.parentNode.id;if(b!=this.id){var e=GrahamTechnology.ui.Form.getRegisteredComponent(b);if(e){if(!GrahamTechnology.Base.isUndefinedOrNull(e.innerFormIDs)){delete e.innerFormIDs[d+""]}e.InnerFormID=-1}}GrahamTechnology.DOM.Element.remove(c)}};this.clearInnerForm=function(b){this.unregisterActiveComponents(b);this.removeUnregisteredRogueComponents()};this.registerDisplayMessageHandlerForForm=function(d,b){if(d!=null&&d!=undefined&&d!=-1){var c=GrahamTechnology.ui.DisplayMessage.Handler.Form.createHandler(d,b);GrahamTechnology.ui.DisplayMessage.registerHandler(this.getDisplayMessageFormHandlerId(d),c)}};this.unregisterDisplayMessageHandlerForForm=function(b){GrahamTechnology.ui.DisplayMessage.unregisterHandler(this.getDisplayMessageFormHandlerId(b))};this.getDisplayMessageFormHandlerId=function(b){return GrahamTechnology.ui.DisplayMessage.getFormHandlerId(b)};this.registerActiveComponents=function(){var b=this.getInnerFormElementId(this.InnerFormID);var c=YAHOO.util.Dom.get(b);if(!GrahamTechnology.Base.isUndefinedOrNull(c)){this.executeScriptElements(c)}this.registerDisplayMessageHandlerForForm(this.InnerFormID,b)};this.getInnerFormElementId=function(b){return"innerForm"+b};this.executeScriptElements=function(d){var b=YAHOO.util.Dom.getElementsBy(new Function("return true;"),"script",d);logger.log("Registering new components for form holder "+this.id,"info","FormHolder.registerActiveComponents");for(var c in b){jQuery.globalEval(b[c].text)}};this.getFormHead=function(b){return b.formHead_Transportables[0]};this.removeUnregisteredRogueComponents=function(){if(GrahamTechnology.ui.Form.allRogueComponents!=null){for(var b=0;b<GrahamTechnology.ui.Form.allRogueComponents.length;b++){if(!GrahamTechnology.Base.isUndefinedOrNull(GrahamTechnology.ui.Form.allRogueComponents[b])){if(GrahamTechnology.Base.isUndefinedOrNull(GrahamTechnology.ui.Form.Form[this.TopLevelFormID].components[GrahamTechnology.ui.Form.allRogueComponents[b].id])){GrahamTechnology.ui.Form.allRogueComponents.splice(b,1);b--}}}}};this.replaceContents=function(d,g,b){var h=this.getFormHolderElement();this.popdownForm(this.InnerFormID);if(GrahamTechnology.Base.isUndefinedOrNull(this.innerFormIDs)){this.innerFormIDs={}}this.innerFormIDs[this.PreviousInnerFormID+""]=true;this.innerFormIDs[this.InnerFormID+""]=true;var f=YAHOO.util.Dom.get("innerForm"+this.PreviousInnerFormID);var i;if(GrahamTechnology.util.AJAXProperties.removeFormHolderInlineStyle){i=GrahamTechnology.DOM.createElement("div",{id:"innerForm"+this.InnerFormID,"class":"SnSResizeHiding formHolderContents",style:{display:"block"}})}else{i=GrahamTechnology.DOM.createElement("div",{id:"innerForm"+this.InnerFormID,"class":"SnSResizeHiding formHolderContents",style:{display:"block",width:"100%",height:"100%"}})}if(f){f.style.display="none";GrahamTechnology.ui.Form.disableAllAccessKeysForForm(this.PreviousInnerFormID)}var e=this.getFormHead(b);var c=null;if(e!=null){h.style.backgroundColor=e.background;c=e.bgImage}if(!GrahamTechnology.Base.isUndefinedOrNull(c)&&c!=""){h.style.backgroundImage="url("+GrahamTechnology.util.constructFullResourceURL(GrahamTechnology.util.ResourceURIBuilder.buildURI(c))+")"}else{h.style.backgroundImage=""}GrahamTechnology.DOM.appendChildElements(h,i);i.innerHTML=d;h.scrollTop=0;this.registerActiveComponents();this.updateInnerLayout();if((YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<7)&&!GrahamTechnology.Base.isUndefinedOrNull(GrahamTechnology.ui.Form.coverAllGlass)){GrahamTechnology.ui.Form.hideAllRogueComponents()}this.handleEvent("load",{previousElement:f,newElement:i});GrahamTechnology.ui.delayedFocusAction="";if(GrahamTechnology.ui.FormParagraph){GrahamTechnology.ui.FormParagraph.initialiseParagraphs()}GrahamTechnology.ui.Form.enableAllAccessKeysForForm(this.InnerFormID)};this.handleEvent=function(d,h){var e=GrahamTechnology.action.componentIsActive(GrahamTechnology.ui.resize.finishedIncrementalLoading(),"snsresize",this,this.handleEvent,[d,h]);if(!e){return}var c=h.previousElement;var i=h.newElement;var g=this.getFormHolderElement();GrahamTechnology.ui.SnSResize(g.parentNode);if(!GrahamTechnology.Base.isUndefinedOrNull(i)){YAHOO.util.Dom.removeClass(i,"SnSResizeHiding");if(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<8){i.style.visibility="visible"}}GrahamTechnology.ui.Form.fireComponentResize(this.FormID,this.ObjectID,this.id);if(!GrahamTechnology.Base.isUndefinedOrNull(GrahamTechnology.ui.delayedFocusAction)&&GrahamTechnology.ui.delayedFocusAction!=""){var b=GrahamTechnology.ui.Form.getAllInnerFormIDs(this.InnerFormID);var f=GrahamTechnology.ui.delayedFocusAction.formID;if(containsElement(b,f)){GrahamTechnology.ui.delayedFocusAction.performFocusAction();GrahamTechnology.ui.delayedFocusAction=null}}};this.updateInnerForm=function(b){var d=this.getFormHolderElement();if(d!=null){try{d.innerHTML=b}catch(c){logger.log("Exception while replacing contents - refreshing page "+c.name+" : "+c.message,"error","FormHolder.updateInnerForm");GrahamTechnology.action.Refresh=true}}};this.getFormHolderElement=function(b){if(GrahamTechnology.Base.isUndefinedOrNull(b)){return this.element()}return YAHOO.util.Dom.get("innerForm"+b)};this.contains=function(){return true};this.getInnerFormID=function(){return this.InnerFormID};this.enable=function(){this.enabled=true;(this.element()).disabled=false;this.enableDisable(true);this.removeGlass()};this.disable=function(){this.enabled=false;(this.element()).disabled=true;this.enableDisable(false);this.addGlass()};this.addGlass=function(){var b=this.element();if(b&&GrahamTechnology.Base.isUndefinedOrNull(YAHOO.util.Dom.get(this.glassID))){var c=GrahamTechnology.DOM.createElement("div",{id:this.glassID,"class":"GTInvisibleGlass",style:{position:"absolute",height:"auto",left:0,bottom:0,top:0,width:"100%",zIndex:7000}});GrahamTechnology.DOM.appendChildElements(b,c)}};this.updateGlass=function(){};this.enableDisable=function(e){var d=GrahamTechnology.ui.Form.getRegisteredFormComponentsForForm(this.getInnerFormID());for(var b=0;b<d.length;b++){var c=GrahamTechnology.ui.Form.getRegisteredComponent(d[b].id);if(!GrahamTechnology.Base.isUndefinedOrNull(c)){if(e){c.enable()}else{c.disable()}}}};this.updateInnerLayout=function(){var h=GrahamTechnology.ui.Form.getRootPane(this.InnerFormID);if(!GrahamTechnology.Base.isUndefinedOrNull(h)){var c,d;if(GrahamTechnology.util.RenderingEngines.isAppleWebKit()){c=this.element();d=c.style.overflow;c.style.overflow="hidden"}var f=this.width();if(!isNaN(h.width)&&!isNaN(f)){var e=h.width-f;h.reduceWidth(e,0)}var b=this.height();if(!isNaN(h.height)&&!isNaN(b)){var g=h.height-b;h.reduceHeight(g,0)}if(GrahamTechnology.util.RenderingEngines.isAppleWebKit()){c.style.overflow=d}}this.updateGlass()};this.performFocus=function(){var h=GrahamTechnology.ui.Form.getRegisteredFormSortedComponentsForForm(this.InnerFormID,this.TopLevelFormID);for(var g in h){var b=h[g];var d=GrahamTechnology.ui.Form.getRegisteredComponent(b);if(GrahamTechnology.util.isComponentFocusable(d)){var c=parseInt(d.ComponentType,10);if(c==GrahamTechnology.grasp.ComponentType.FormParagraph&&!d.isTabbableFP()){continue}if(c==GrahamTechnology.grasp.ComponentType.WebLink&&!d.isTabbableWL()){continue}try{d.performFocus()}catch(f){logger.log("The component ["+d.id+"] cannot be given focus (possibly hidden or disabled)","error","GrahamTechnology.ui.FormHolder.performFocus")}return}}};this.changeTabBGColor=function(d,c){if(this.InnerFormID==d){var b=this.getFormHolderElement();b.style.background=c}};this.changeTabImage=function(){};this.changeTabEnableState=function(){};this.changeNaturalSizeTabWidth=function(){};this.changeTabTitle=function(){};this.changeTabTitleClass=function(){}};GrahamTechnology.ui.FormHolder.prototype=new GrahamTechnology.ui.AbstractComponent;