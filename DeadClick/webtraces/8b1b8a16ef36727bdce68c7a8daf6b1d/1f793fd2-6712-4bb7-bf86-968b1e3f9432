GrahamTechnology.ui.Tree=function(a){GrahamTechnology.ui.AbstractComponent.call(this,a);this.componentID=a;this.showImage=true;this.imageMap=new Object();this.Glass={};this.selectedNodes=new Array();this.actualTabIndex=-1;this.drawn=false;this.getExpandedNodes=function(){var b=this.treeView.getYUITreeView().getNodesByProperty("expanded",true);if(!b){b=[]}return b};this.getExpandedNodesString=function(){var b=this.getExpandedNodes();var e=[""];var d="";for(var c=0;c<b.length;c++){e[e.length]=d;e[e.length]=""+b[c].data.id;d="-"}return e.join()};this.createEventData=function(b,c,d){switch(c){case (GrahamTechnology.grasp.EvtType.TREE_SELECT):return this.createSelectEvent(b,c);case (GrahamTechnology.grasp.EvtType.TREE_EXPAND):return this.createExpandEvent(b,c,d);default:logger.log("Unknown event type received for tree component - "+c,"info","Tree.createEventData");return GrahamTechnology.util.TransportableSkeleton.getEmptyTransportableSkeleton()}};this.createSelectEvent=function(b,d){var c="";if(this.treeView!=null){c=this.getExpandedNodesString();if(c==""){c="0"}}var e=this.createEventTemplate(b,d);e.param1=true;e.param2=c;return e};this.createExpandEvent=function(b,c,e){var d=this.createEventTemplate(b,c);d.param1=e;d.param2="";return d};this.createEventTemplate=function(b,c){var d=GrahamTechnology.util.TransportableSkeleton.getEmptyTransportableSkeleton();d.eventType=c;d.formID=this.FormID;d.objectID=this.ObjectID;d.subObjectID=parseInt(b,10);return d};this.removeAll=function(){if(this.treeView!=null){this.treeView.disablePosts=true;var b=this.treeView.getYUITreeView().getRoot();var d=b.children[0];var c;while(!GrahamTechnology.Base.isUndefinedOrNull(d)){c=d.nextSibling;this.treeView.getYUITreeView().removeNode(d,false);d=c}this.treeView.disablePosts=false}};this.removeChildren=function(b,c){while(b.children.length){this.removeChildNode(b.children[0],c)}b.childrenRendered=false;b.dynamicLoadComplete=false;b.updateIcon()};this.removeChildNode=function(b,c){this.removeChildren(b,c);this.treeView.getYUITreeView().popNode(b)};this.redraw=function(){if(this.treeView!=null){logger.log("Redraw Tree & Update TabOrder");this.treeView.getYUITreeView().render();if(!this.enabled){this.addGlass()}for(var b=0;b<this.selectedNodes.length;b++){var c=this.getNodeByID(this.selectedNodes[b]);this.expandSelectedNode(c)}GrahamTechnology.ui.Form.updateTabOrderForTree(this,this.actualTabIndex)}};this.addImagePath=function(d,b,c){this.imageMap[d]=[b,c]};this.getImagePathForID=function(c){var b=this.imageMap[c];if(GrahamTechnology.Base.isUndefinedOrNull(b)){return""}if(GrahamTechnology.Base.isUndefinedOrNull(b[0])||b[0]=="null"){return null}return GrahamTechnology.util.constructFullImageURL(b[0])};this.getImageWidthForID=function(c){var b=this.imageMap[c];if(GrahamTechnology.Base.isUndefinedOrNull(b)){return 0}return b[1]};this.expandNode=function(c){this.treeView.disablePosts=true;var b=this.getNodeByID(c);if(b!=null){b.expand()}this.treeView.disablePosts=false};this.collapseNode=function(c){this.treeView.disablePosts=true;var b=this.getNodeByID(c);if(b!=null){b.collapse()}this.treeView.disablePosts=false};this.selectAllNodes=function(e){var d=this.treeView.getYUITreeView()._nodes;var b=new Array();for(var c in d){b.push(d[c].data.id)}this.selectNodes(b)};this.selectNodes=function(d){this.treeView.disablePosts=true;for(var b=0;b<d.length;b++){var c=this.getNodeByID(d[b]);this.selectedNodes.push(d[b]);this.expandSelectedNode(c)}this.treeView.disablePosts=false};this.expandSelectedNode=function(d){if(!GrahamTechnology.Base.isUndefinedOrNull(d)){var b=d.parent;while(b!=null&&!b.expanded){b.expand();b=b.parent}if(!GrahamTechnology.util.AJAXProperties.accessibilityOn){var c=d.getLabelEl();if(c){GrahamTechnology.DOM.Element.addClass(d.getContentEl(),"selectedNode");GrahamTechnology.DOM.Element.addClass(c,"selectedNode")}}}};this.deselectAllNodes=function(b){this.deselectNodes(this.selectedNodes.slice());this.selectedNodes=new Array()};this.deselectNodes=function(b){for(var d in b){var f=this.getNodeByID(b[d]);if(f){var e=f.getContentEl();if(e){GrahamTechnology.DOM.Element.removeClass(e,"selectedNode");if(!GrahamTechnology.util.AJAXProperties.accessibilityOn){GrahamTechnology.DOM.Element.removeClass(f.getLabelEl(),"selectedNode")}}}for(var c=0;c<this.selectedNodes.length;c++){if(this.selectedNodes[c]==b[d]){this.selectedNodes.splice(c,1);break}}}};this.getNodeByID=function(c){var b=null;if(this.treeView!=null){b=this.treeView.getYUITreeView().getNodeByProperty("id",c)}return b};this.getRootNode=function(){if(this.treeView!=null){return this.treeView.getYUITreeView().getRoot()}return null};this.disable=function(){this.enabled=false;this.addGlass();GrahamTechnology.ui.Form.updateTabOrderForTree(this,-1)};this.enable=function(){this.enabled=true;this.removeGlass();GrahamTechnology.ui.Form.updateTabOrderForTree(this,this.actualTabIndex)};this.setBackgroundColour=function(f){var d=this.element();if(d){d.style.backgroundColor=f;var c=d.getElementsByTagName("TABLE");for(var b=0;b<c.length;b++){var g=c[b];var e=g.getElementsByTagName("span")[0];if(!GrahamTechnology.DOM.Element.hasClass(e,"selectedNode")){e.style.backgroundColor=f}}}};this.setForegroundColour=function(f){var d=this.element();if(d){d.style.color=f;var c=d.getElementsByTagName("table");for(var b=0;b<c.length;b++){var g=c[b];var e=g.getElementsByTagName("span")[0];if(!GrahamTechnology.DOM.Element.hasClass(e,"selectedNode")){e.style.color=f}}}};this.setHintText=function(c){var b=this.element();if(b){b.title=c}};this.performFocus=function(){try{this.focusableElement.focus()}catch(b){logger.log("Perform focus to tree with id ["+this.id+"] failed","debug","GrahamTechnology.ui.Tree.performFocus")}};this.addNode=function(g,i,f,d,h){if(d!=-1&&this.showImage){var b=this.getImagePathForID(d);var c=this.getImageWidthForID(d);var e=this.treeView.getStyle(b);this.treeView.buildChild(g,i,f,h,e)}else{this.treeView.buildChild(g,i,f,h)}};this.destroy=function(){this.treeView.destroy();this.treeView=null;GrahamTechnology.ui.Tree.prototype.destroy.call(this)};this.replaceNodesWithLinks=function(){var c=YAHOO.util.Dom.getElementsBy(this.hasHref,"a",this.id);for(var b=0;b<c.length;b++){c[b].removeAttribute("href")}};this.hasHref=function(c){var d=false;if(c.href){var e=c.href+"";var b=e.substring(e.length-1);if(b=="#"){d=true}}return d}};GrahamTechnology.ui.Tree.prototype=new GrahamTechnology.ui.AbstractComponent;