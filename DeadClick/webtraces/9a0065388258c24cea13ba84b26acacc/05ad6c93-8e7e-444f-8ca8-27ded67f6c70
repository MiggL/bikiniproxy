define(["jquery","modernizr","pubsub",],function(c){if(!Modernizr.history){return}var b=function(h,e,i,d,g){var f=new RegExp("([?&#])"+e+"=.*?(&|#|$)","i"),k="",j="";if(h.match(f)){return h.replace(f,"$1"+e+"="+i+"$2")}if(d){if(g){j=h.indexOf("#")!==-1?"&":"#"}else{j=h.indexOf("?")!==-1?"&":"?";if(h.indexOf("#")!==-1){k=h.replace(/.*#/,"#");h=h.replace(/#.*/,"")}}return h+j+e+"="+i}return h};var a=function(){var e=c(".active-context-js"),j=c('.context-toggle-js:not(.hide) .color-swatches-js .attr-box.selected [data-role="swatch"]'),d=e.data("product-url"),g=j.data("product-url"),i=j.data("variation-id"),f=d||g,h;if(f.indexOf("?")>=0){h=f+window.location.hash}else{h=f+window.location.search+window.location.hash}return b(h,"variationId",i)};c.pubsub("subscribe","product-form.attr.swatch.click",function(e,d){history.replaceState(null,null,a())});c.pubsub("subscribe","product-form.attr.context.changed",function(e,d){history.replaceState(null,null,a())})});