
(function(d, w) {
  if (!d.createElement) { return false; }
  var partnerInfo = {};
  var loadPartnerTag = function() {
    var self = {};
    self.tagsZone = {"accueil":[{"nom":"JsWebProduction","object":"script","attr":{"type":"text\/javascript","src":"http:\/\/vu.adschoom.com\/trafic\/retar.php?type=HOME&boutique=capitainefracassefr","async":"async","defer":"defer"}},{"nom":"Time2perf","object":"script","attr":{"type":"text\/javascript","text":"(function(){var b=window!=window.top?document.referrer:document.location.href,c=window!=window.top?document.location.href:\"\",a=document.createElement(\"script\");a.type=\"text\/javascript\";a.charset=\"UTF-8\";a.src=\"\/\/time.time2perf.com\/boot\/request\/?pid=55617&action=Index&topfr=\"+b+\"&topfr2=\"+c;document.getElementsByTagName(\"head\")[0].appendChild(a)})();"}}],"produit":[{"nom":"JsWebProduction","object":"script","attr":{"type":"text\/javascript","src":"http:\/\/vu.adschoom.com\/trafic\/retar.php?type=PRODUIT&boutique=capitainefracassefr&produit_id={IDPRODUIT}","async":"async","defer":"defer"}},{"nom":"Time2perf","object":"script","attr":{"type":"text\/javascript","text":"(function(){var b=window!=window.top?document.referrer:document.location.href,c=window!=window.top?document.location.href:\"\",a=document.createElement(\"script\");a.type=\"text\/javascript\";a.charset=\"UTF-8\";a.src=\"\/\/time.time2perf.com\/boot\/request\/?pid=55617&action=Product&productId={IDPRODUIT}&topfr=\"+b+\"&topfr2=\"+c;document.getElementsByTagName(\"head\")[0].appendChild(a)})();"}}],"categorie":[{"nom":"JsWebProduction","object":"script","attr":{"type":"text\/javascript","src":"http:\/\/vu.adschoom.com\/trafic\/retar.php?type=CATEGORIE&boutique=capitainefracassefr&categorie_id={IDCATEGORIE}","async":"async","defer":"defer"}},{"nom":"Time2perf","object":"script","attr":{"type":"text\/javascript","text":"(function(){var b=window!=window.top?document.referrer:document.location.href,c=window!=window.top?document.location.href:\"\",a=document.createElement(\"script\");a.type=\"text\/javascript\";a.charset=\"UTF-8\";a.src=\"\/\/time.time2perf.com\/boot\/request\/?pid=55617&action=Category&categoryId={IDCATEGORIE}&topfr=\"+b+\"&topfr2=\"+c;document.getElementsByTagName(\"head\")[0].appendChild(a)})();"}}],"panier":[{"nom":"JsWebProduction","object":"script","attr":{"type":"text\/javascript","src":"http:\/\/vu.adschoom.com\/trafic\/retar.php?type=PANIER&boutique=capitainefracassefr&transaction_amount={MONTANT}&data={LISTEIDS}","async":"async","defer":"defer"}},{"nom":"Time2perf","object":"script","attr":{"type":"text\/javascript","text":"(function(){var d=window!=window.top?document.referrer:document.location.href,e=window!=window.top?document.location.href:\"\",c=\"EUR\",a=\"\";if(\"undefined\"!=typeof window.ptag_params)for(window.ptag_params.hasOwnProperty(\"currency\")&&\"\"!=window.ptag_params.currency&&(c=window.ptag_params.currency),i=0;i<window.ptag_params.products.length;++i)a+=window.ptag_params.products[i].id+\":\"+window.ptag_params.products[i].price+\":\"+window.ptag_params.products[i].quantity+\";\";else{var b=[\"{LISTEIDS}\"];for(i=0;i<b.length;++i)a+=b[i]+\":0:0;\"}\"\"!=a&&(a=a.substr(0,a.length-1));b=document.createElement(\"script\");b.type=\"text\/javascript\";b.charset=\"UTF-8\";b.src=\"\/\/time.time2perf.com\/boot\/request\/?pid=55617&action=Basket&amount={MONTANT}&products=\"+a+\"&currency=\"+c+\"&topfr=\"+d+\"&topfr2=\"+e;document.getElementsByTagName(\"head\")[0].appendChild(b)})();"}}],"fincommande":[{"nom":"JsWebProduction","object":"script","attr":{"type":"text\/javascript","src":"http:\/\/vu.adschoom.com\/trafic\/retar.php?type=TRANSACTION&boutique=capitainefracassefr&transaction_id={IDTRANSACTION}&transaction_amount={MONTANT}&valid=1&data={LISTEIDS}","async":"async","defer":"defer"}},{"nom":"Time2perf","object":"script","attr":{"type":"text\/javascript","text":"(function(){var d=window!=window.top?document.referrer:document.location.href,e=window!=window.top?document.location.href:\"\",c=\"EUR\",a=\"\";if(\"undefined\"!=typeof window.ptag_params)for(window.ptag_params.hasOwnProperty(\"currency\")&&\"\"!=window.ptag_params.currency&&(c=window.ptag_params.currency),i=0;i<window.ptag_params.products.length;++i)a+=window.ptag_params.products[i].id+\":\"+window.ptag_params.products[i].price+\":\"+window.ptag_params.products[i].quantity+\";\";else{var b=[\"{LISTEIDS}\"];for(i=0;i<b.length;++i)a+=b[i]+\":0:0;\"}\"\"!=a&&(a=a.substr(0,a.length-1));b=document.createElement(\"script\");b.type=\"text\/javascript\";b.charset=\"UTF-8\";b.src=\"\/\/time.time2perf.com\/boot\/request\/?pid=55617&ref={IDTRANSACTION}&amount={MONTANT}&products=\"+a+\"&currency=\"+c+\"&action=Transaction&topfr=\"+d+\"&topfr2=\"+e;document.getElementsByTagName(\"head\")[0].appendChild(b)})();"}}],"lead_inscription":[{"nom":"JsWebProduction","object":"script","attr":{"type":"text\/javascript","src":"http:\/\/vu.adschoom.com\/trafic\/retar_lead.php?type=INSCRIPTION&boutique=capitainefracassefr","async":"async","defer":"defer"}}],"lead_confirmation":[{"nom":"JsWebProduction","object":"script","attr":{"type":"text\/javascript","src":"http:\/\/vu.adschoom.com\/trafic\/retar_lead.php?type=CONFIRMATION&boutique=capitainefracassefr&data={ID_LEAD}","async":"async","defer":"defer"}}]};
    if (typeof netaffWanTtWcCdth55617 == 'undefined') {
      netaffWanTtWcCdth55617 = new Object();
      var netaffTabPattern = checkParams(NetaffParseParam(partnerInfo.str_js));
      NetaffCD(netaffTabPattern);
      var zone = eval('self.tagsZone.'+netaffTabPattern['ZONE']);
      if(typeof(zone) == 'object') {
        for(var i_cpt_tag = 0; i_cpt_tag < zone.length; ++i_cpt_tag) {
          if(typeof zone[i_cpt_tag] != 'undefined'){
            if(zone[i_cpt_tag].object == 'script' || zone[i_cpt_tag].object == 'img' || zone[i_cpt_tag].object == 'iframe'){
              partnerInfo.divConteneur.innerHTML += "\n\n<!-- Tag "+zone[i_cpt_tag].nom+" -->\n";
              var tag = d.createElement(zone[i_cpt_tag].object);
              var tab_attr = zone[i_cpt_tag].attr;
              var script_src = false;
              for (var type_attr in tab_attr) {
                if (tab_attr.hasOwnProperty(type_attr)){
                  var code = tab_attr[type_attr];
                  if(type_attr == 'src' || type_attr == 'text'){
                    if(type_attr == 'src'){ script_src = true; }
                    if(d.location.protocol == 'https:'){ code = code.replace(new RegExp('(^http://)|(("|\')http://)', 'g'), '$3https://'); }
                    var nomFonctionFiltre = null;
                    var nom_fct_filtre = NetaffRemplaceChar('filtre_'+zone[i_cpt_tag].nom.toLowerCase()+'_'+netaffTabPattern['ZONE'], '-', '_');
                    if(eval('typeof '+nom_fct_filtre+' == "function"')){ nomFonctionFiltre = nom_fct_filtre; }
                    code = NetaffPattern(code, netaffTabPattern, nomFonctionFiltre);
                  }
                  eval('tag.'+type_attr+'=code')
                }
              }
              if(zone[i_cpt_tag].object == 'script' && script_src){ d.getElementsByTagName('head')[0].appendChild(tag); }
              else if(zone[i_cpt_tag].nom.toLowerCase() != "criteo_onetag" || (zone[i_cpt_tag].nom.toLowerCase() == "criteo_onetag" && typeof w.ptag_params != 'undefined')){ partnerInfo.divConteneur.appendChild(tag); }
              tag = tab_attr = type_attr = code = null;
            }
          }
        }
        netaffTabPattern = null;
      }
      zone = null;
    }
  };

  partnerInfo.divConteneur = creerDivPartnerTag();

  if (typeof w.ptag_params != 'undefined' && w.ptag_params.hasOwnProperty('requiresDOM') && w.ptag_params.requiresDOM === false) { loadPartnerTag(); }
  else if (w.addEventListener) {
    w.addEventListener('load', loadPartnerTag, false);
    var timeoutID = window.setTimeout(function(){Timer();},1000);
  }
  else if (w.attachEvent) {
    w.attachEvent('onload', loadPartnerTag );
    var timeoutID = window.setTimeout(function(){Timer();},1000);
  }

  var listeClicTime = [];
  if (listeClicTime.length > 0) {
    poseClicTime(listeClicTime);
  }
  function poseClicTime(listeClicTime) {
    var tagClicTime = d.createElement('script');
    for(var i in listeClicTime) {
      tagClicTime.innerHTML += listeClicTime[i];
    }
    partnerInfo.divConteneur.appendChild(tagClicTime);
  }
  function creerDivPartnerTag() {
    var self = {};
    self.tabUrl = ["img.metaffiliation.com/u/21/p55617.js","img.netaffiliation.com/u/21/p55617.js"];
    partnerInfo.str_js = null;
    var allScripts = d.getElementsByTagName('script');
    for (var i = 0; i < self.tabUrl.length; i++) {
      if (partnerInfo.str_js != null){break;}
      for (var i_cpt_allscr = 0 ; i_cpt_allscr < allScripts.length ; i_cpt_allscr++) {
        var currentScript = allScripts.item(i_cpt_allscr);
        if(!currentScript.src){continue; }
        var reg_src_js = new RegExp(self.tabUrl[i],'g');
        if (reg_src_js.test(currentScript.src)) {
          var index = currentScript.src.indexOf('?',7);
          if (index == -1){ partnerInfo.str_js = ''; break; }
          partnerInfo.str_js = currentScript.src.substring(index+1);
        }
        if (partnerInfo.str_js != null){ break; }
      }
      var divConteneur = d.createElement('div');
      divConteneur.id = 'Netaff-'+NetaffAleat(15);
      divConteneur.style.display = 'none';
      var currentScriptParent = currentScript.parentNode;
      currentScriptParent.appendChild(divConteneur);
    }
    return divConteneur;
  }
  function Timer() {
    if(document.readyState == 'complete' && typeof netaffWanTtWcCdth55617 !== 'object'){ loadPartnerTag(); }
    else if(typeof netaffWanTtWcCdth55617 === 'object'){ window.clearTimeout(timeoutID); }
    else{ timeoutID = window.setTimeout(function(){Timer();},1000); }
  }
  function callBackProgramme() {

  }
  function checkParams(params_url){
    var netaffTabParams = new Array();
    netaffTabParams['IDPROGNETAFF'] = '55617';
    var varFr = ['idproduit','idcategorie','idtransaction','accueil','produit','categorie','panier','fincommande'];
    var varEn = ['productid','categoryid','transactionid','homepage','product','listing','basket','transaction'];
    callBackProgramme();
    var boucle = [params_url, w.ptag_params];
    for (var index = 0; index < boucle.length; ++index) {
      for (var nom_param in boucle[index]) {
        var keyPattern = nom_param.toUpperCase();
        for(var i = 0; i < varEn.length; i++) {
          if(varEn[i] == nom_param.toLowerCase()){ keyPattern = varFr[i].toUpperCase(); }
        }
        netaffTabParams[keyPattern] = boucle[index][nom_param];
      }
    }
    for(var i = 0; i < varEn.length; i++) {
      if(varEn[i] == netaffTabParams['ZONE']){ netaffTabParams['ZONE'] = varFr[i]; }
    }
    // On rempli le tableau
    switch(netaffTabParams['ZONE']) {
      case "panier":
      case "fincommande":
        if(typeof netaffTabParams['PRODUCTS'] == 'object'){
          var montantTot = 0;
          for (var ind = 0; ind < netaffTabParams['PRODUCTS'].length; ++ind) {
            netaffTabParams['LISTEIDS'] = (netaffTabParams['LISTEIDS'] ? netaffTabParams['LISTEIDS']+',' : '')+netaffTabParams['PRODUCTS'][ind]['id'];
            netaffTabParams['LISTEQTY'] = (netaffTabParams['LISTEQTY'] ? netaffTabParams['LISTEQTY']+',' : '')+netaffTabParams['PRODUCTS'][ind]['quantity'];
            montantTot = montantTot+parseFloat(parseFloat(netaffTabParams['PRODUCTS'][ind]['price'])*parseInt(netaffTabParams['PRODUCTS'][ind]['quantity']));
          }
          netaffTabParams['MONTANT'] = montantTot;
        }
      break;
      case "categorie":
        if(typeof netaffTabParams['PRODUCTS'] == 'object'){
          for (var ind = 0; ind < netaffTabParams['PRODUCTS'].length; ++ind) {
            netaffTabParams['LISTEIDS'] = (netaffTabParams['LISTEIDS'] ? netaffTabParams['LISTEIDS']+',' : '')+netaffTabParams['PRODUCTS'][ind];
          }
        }
      break;
    }
    if(netaffTabParams['LISTEIDS']){ netaffTabParams['LISTEIDS'] = NetaffRemplaceChar(netaffTabParams['LISTEIDS'],'%2C',','); }
    if(netaffTabParams['LISTEQTY']){ netaffTabParams['LISTEQTY'] = NetaffRemplaceChar(netaffTabParams['LISTEQTY'],'%2C',','); }
    return netaffTabParams;
  }
  function NetaffParseParam(url) {
    var result = new Array();
    if(url == null || url == ''){ return result; }
    var params = url.split('&');
    for(var i_cpt_parse = 0; i_cpt_parse < params.length; ++i_cpt_parse) {
      var t = params[i_cpt_parse].split('=');
      if(t[1] == 'generique'){ t[1] = 'accueil'; }
      if(t[0].substring(0, 4) == 'amp;'){ t[0] = t[0].substring(4, t[0].length); }
      result[t[0]] = t[1];
    }
    return result;
  }
  function NetaffPattern(str, netaffTabPatternARemplacer, nomFonction) {
    netaffTabPatternARemplacer['cachebuster'] = NetaffAleat(15);
    for (var pattern in netaffTabPatternARemplacer) {
      var valuePat = netaffTabPatternARemplacer[pattern];
      if(nomFonction != null){ eval('valuePat = '+nomFonction+'(valuePat, pattern)'); }
      var reg_pattern = new RegExp('{'+pattern+'}', 'g');
      str = str.replace(reg_pattern, valuePat);
    }
    return str;
  }
  function NetaffAleat(length) {
    var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');
    if (!length) { length = Math.floor(Math.random() * chars.length);  }
    var str = '';
    for (var i_cpt_aleat = 0; i_cpt_aleat < length; i_cpt_aleat++) {
      str += chars[Math.floor(Math.random() * chars.length)];
    }
    return str;
  }
  function NetaffRemplaceChar(chaine, caractere_in, caractere_out) {
    var strrc = '';
    var tabrc = chaine.split(caractere_in);
    for (var irc=0; irc<tabrc.length; irc++){
      if(tabrc[irc] != ''){
        (strrc != '') ? strrc = strrc+caractere_out+tabrc[irc] : strrc = tabrc[irc];
      }
    }
    tabrc = irc = null;
    return strrc;
  }
  function NetaffCD(netaffTabPattern) {
    if(netaffTabPattern.hasOwnProperty('M_MD5') && netaffTabPattern['M_MD5'] != ''){
      url_cd = '//action.metaffiliation.com/aff.php?maff=S4D9411010';
      var imgCD = document.createElement('img');
      imgCD.setAttribute('src', url_cd+'&r='+new Date().getTime()+'&altid='+netaffTabPattern['M_MD5']);
      imgCD.setAttribute('width', '0');
      imgCD.setAttribute('height', '0');
      imgCD.setAttribute('id', "kwankoCD");
      partnerInfo.divConteneur.appendChild(imgCD);
    }
  }
  function filtre_jswebproduction_panier(value, namePat){
  if(namePat != 'LISTEIDS'){ return value; }
  return NetaffRemplaceChar(value, ',', ';');
}

function filtre_jswebproduction_fincommande(value, namePat){
  return filtre_jswebproduction_panier(value, namePat);
}
})(document, window);