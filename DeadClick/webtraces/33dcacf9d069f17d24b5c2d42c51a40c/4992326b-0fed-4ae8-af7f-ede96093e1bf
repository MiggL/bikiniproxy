"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e,t){var a=function C(e,a,n){var s={};return e.facets&&e.facets.forEach(function(e){var a;switch(e.type){case"VALUE":e.values.forEach(function(e){e.selected&&(a=e.value)});break;case"USER_RANGE":var n=e.values[0];if(t.log("Range Facet: ",e,n),n&&(n.selectedMin||n.selectedMax)){var o=n.selectedMin?n.selectedMin:n.min,i=n.selectedMax?n.selectedMax:n.max;a=o+"-"+i}break;case"GROUP":t.log("Group Facet: ",e),_.extend(s,C(e));break;default:t.log("warn","Facet getSelections not implemented",e.type,e)}void 0!==a&&(s[e.id]=a)}),a&&null!==n.geoRadius&&(s.geoZip=n.geoZip,s.geoRadius=n.geoRadius),t.log("SELECTIONS:",s),s},n=function(e,a,n,s){var o=[{name:e.allLabel,value:"",selected:!1}].concat(e.values.map(function(e){return{name:e.label,value:e.value,selected:e.selected,count:e.count}})),i=function(t){a.updateFacet(e.id,t.target.value)},r=[e.id],l=t.client.isMobile?"btn-block":"btn-default";return s&&r.push("ddc-selectpicker"),t.client.isDesktop&&r.push("form-control"),React.createElement(f,{key:e.id,className:r.join(" "),options:o,viewPrefs:n,onChange:i,dataStyle:l})},s=function(e,a){var n=c(e.id)?t.i18n.getLabel("SPAN_PER_MO"):"",s=e.values[0];return React.createElement(g,{key:e.id,name:e.id,min:s.min,max:s.max,val:"|min-"+e.id+"|-|max-"+e.id+"|",currentMin:s.selectedMin,currentMax:s.selectedMax,suffix:n,onChange:a})},o=function(e,t,a,n){return React.createElement(u,{key:e.id,mutator:t,name:e.id,buttonText:e.label,viewPrefs:a,facet:e,totalCount:n})},i=function(e,a,n){var s=e.values.map(function(e){return{label:e.label,value:e.value,checked:e.selected===!0,disabled:0==e.count}}),o=e.values.filter(function(e){return e.selected===!0}),i={classes:"h1 ddc-sub-heading",label:t.i18n.getLabel(n.widgetSubHeading),icon:n.widgetSubHeadingIcon,tagName:"h3"};return e.allLabel&&s.push({label:e.allLabel,value:"",checked:0==o.length}),React.createElement(d,{key:e.id,name:e.id,items:s,onChange:a,pillHeading:i,dataPlacement:"top"})},r=function(e,a,i,r,l,c){return"VALUE"==e.type?n(e,a,r,l):"GROUP"==e.type?o(e,a,r,c):"USER_RANGE"==e.type?s(e,i):void t.log("warn","Unknown facet type: ",e.type)},l=function(e){return t.format.currency(e,0)},c=function(e){return"paymentLoan"==e||"paymentLease"==e},u=function(n){function s(e){_classCallCheck(this,s);var t=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));return t.state={uiSelectedFacetId:null},t}return _inherits(s,n),_createClass(s,[{key:"componentDidMount",value:function(){var t=this;e(this.refs.bootstrapSelect).on("keydown",function(e){e.stopPropagation()}),e(this.refs.menu).on("click",function(e){e.stopPropagation()}),e(ReactDOM.findDOMNode(this.refs.resetButton)).on("click",function(){e(ReactDOM.findDOMNode(t.refs.toggleButton)).dropdown("toggle")}),e(this.refs.bootstrapSelect).on("shown.bs.dropdown",function(){t.state.deferredUiSelectedFacetId&&t.setState({deferredUiSelectedFacetId:null,uiSelectedFacetId:t.state.deferredUiSelectedFacetId})})}},{key:"render",value:function(){var e=this,n=["btn-group","ddc-bootstrap-select"],s=t.client.isDesktop?"form-control":"select-wrap",o=t.client.isMobile?"btn-block":"btn-default",i=this.props.facet.facets,u=function(e){return i.filter(function(t){return e==t.id})[0]},p=function(e){var t=0;return e.forEach(function(e){t+=e.count}),t},h=function(e){return"VALUE"==e.type?0==p(e.values):"USER_RANGE"==e.type?0==p(e.values[0].values):(t.log("Unkown facet type in isFacetDisabled:",e.type),!0)},f=function(){var t=Object.keys(a(e.props.facet));return t.length>0?t[0]:null},g=f(),v=function(){if(g)return g;if(e.state.uiSelectedFacetId&&!h(u(e.state.uiSelectedFacetId)))return e.state.uiSelectedFacetId;var t=i.filter(function(e){return!h(e)});return t.length>0?t[0].id:null}(),b=function(){var e={};return i.forEach(function(t){e[t.id]=null}),e},y=function(t,a){var n=b();n[t]=a,e.props.mutator.updateFacets(n)},R=i.map(function(t){var a=function(e,a){y(t.id,e+"-"+a)};return React.createElement("div",{key:t.id,className:v!==t.id?"hide":""},r(t,e.props.mutator,a,e.props.viewPrefs,!1,e.props.totalCount))}),C=i.map(function(e){return{label:e.label,value:e.id,checked:e.id===v,disabled:h(e)}}),_=function(t){e.setState({uiSelectedFacetId:t});var a=b();delete a[t],e.props.mutator.updateFacets(a)},E=function(e){var a=e.values[0],n=l(void 0!==a.selectedMin?a.selectedMin:a.min),s=l(void 0!==a.selectedMax?a.selectedMax:a.max),o=c(e.id)?React.createElement("span",{className:"payment-suffix"},t.i18n.getLabel("PER_MO")):void 0;return React.createElement("span",null,e.label,": ",n,o," - ",s,o)},k=function(e){var t=e.values.filter(function(e){return e.selected});return t.length>0?e.label+": "+t[0].label:e.allLabel},w=function(){if(g){var a=u(g),n="";if(!a)return"";"VALUE"==a.type?n=k(a):"USER_RANGE"==a.type?n=E(a):t.log("Unkown facet type in getButtonText:",a.type);var s="true"===e.props.viewPrefs.showCountOnSubmitButton||0===e.props.totalCount?void 0:React.createElement("small",{className:"text-muted"},t.format.number(e.props.totalCount));return React.createElement("span",{className:"filter-option pull-left"},n," ",s," Â ")}return e.props.buttonText},D=function(){e.setState({uiSelectedFacetId:null}),e.props.mutator.updateFacets(b())},S={text:t.i18n.getLabel(this.props.viewPrefs.buttonTextReset),style:this.props.viewPrefs.buttonStyleReset,size:this.props.viewPrefs.buttonSizeReset,layout:this.props.viewPrefs.buttonLayoutReset},N={classes:"pull-left ddc-pill-heading",label:t.i18n.getLabel("SEARCH_BY_COLON"),tagName:"p"},O=["group","form-group"];return n.push(s),g&&O.push("selected"),React.createElement("div",{className:O.join(" ")},React.createElement("div",{className:n.join(" "),ref:"bootstrapSelect"},React.createElement(m,{className:"dropdown-toggle "+o,dataToggle:"dropdown",caret:"true",ref:"toggleButton"},w()),React.createElement("div",{className:"menu dropdown-menu",ref:"menu"},React.createElement(d,{name:this.props.name,items:C,onChange:_,pillHeading:N,dataPlacement:"bottom"}),R,React.createElement("div",{className:"form-group"},React.createElement(m,{style:S.style,layout:S.layout,size:S.size,text:S.text,onClick:D,ref:"resetButton"})))))}}]),s}(React.Component),p=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("i",{className:"ddc-icon ddc-icon-"+this.props.className})}}]),t}(React.Component),d=function(a){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,a),_createClass(n,[{key:"attachEvents",value:function(){var t=this;e(this.refs.wrapper).find(".pill-label").on("click",function(){e(this).hasClass("disabled")||e(this).hasClass("checked")||t.props.onChange(e(this).data("value"))})}},{key:"removeEvents",value:function(){e(this.refs.wrapper).find(".pill-label").off("click")}},{key:"componentDidMount",value:function(){this.attachEvents()}},{key:"componentDidUpdate",value:function(){this.attachEvents()}},{key:"componentWillUnmount",value:function(){this.removeEvents()}},{key:"componentWillUpdate",value:function(){this.removeEvents()}},{key:"render",value:function(){var e=this,a=this.props.pillHeading,n=this.props.items.map(function(a){var n,s=["pill-label"];return a.disabled&&(s.push("disabled"),n=t.i18n.getLabel("ITEM_IS_NOT_AVAILABLE_FOR_YOUR_CURRENT_SELECTION").replace("{template.item}",a.label)),a.checked&&!a.disabled&&s.push("checked"),React.createElement("a",{key:a.value,className:s.join(" "),"data-value":a.value,"data-original-title":n,"data-toggle":a.disabled?"tooltip":null,"data-placement":e.props.dataPlacement},a.label)}),s=function(){if(void 0!==a.label){var e=a.icon?React.createElement(p,{className:a.icon}):null;return React.createElement(a.tagName,{className:a.classes},e,a.label)}};return React.createElement("div",{ref:"wrapper",className:"form-group ddc-pill-group"},s(),n)}}]),n}(React.Component),h=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={validPostal:!0},t}return _inherits(a,e),_createClass(a,[{key:"componentDidMount",value:function(){this.props.geoData.geoInputEl=this.input}},{key:"validataPostal",value:function(e){var t=/(^\d{5}(-\d{4})?$)|(^[ABCEGHJKLMNPRSTVXYabceghjklmnprstvxy]{1}\d{1}[A-Za-z]{1} *\d{1}[A-Za-z]{1}\d{1}$)/g,a=new RegExp(t),n=a.test(e);return this.setState({validPostal:n}),n}},{key:"render",value:function(){var e=this,a=this.props.viewPrefs.searchFormRanges.split(","),n=t.client.isMobile?"btn-block":"btn-default",s=this.props.geoData.geoZip,o=this.props.geoData.geoRadius,i=this.props.geoData.uom,r="ddc-selectpicker",l=function(t){e.props.geoData.setGeoValue("geoRadius",t.target.value),e.props.mutator.updateFacet("geoRadius",t.target.value)},c=[{name:t.i18n.getLabel("SELECT_RANGE"),value:"",selected:!1}].concat(a.map(function(e){return{name:e+" "+i,value:e,selected:null!==o?e===o:!1}}));return t.client.isDesktop&&(r+=" form-control"),React.createElement("div",{className:"form-group range range-group"},React.createElement("div",{className:""},React.createElement("h3",{className:"h1 ddc-sub-heading"},t.i18n.getLabel("FIND_VEHICLES_FOR")),React.createElement("div",{className:"form-group"},React.createElement("div",{className:"btn dropdown-toggle non-dropdown "+(this.state.validPostal?"":"invalid")},React.createElement("input",{type:"text",name:"geoZip",className:"text geoZip",placeholder:s,onBlur:function(t){var a=t.target.value;""!==a&&null!==a&&void 0!==a&&e.validataPostal(a)&&e.props.geoData.setGeoValue("geoZip",a)},ref:function(t){return e.input=t}}))),React.createElement("h3",{className:"ddc-sub-heading "+(t.client.isDesktop?"h1":"h3")},t.i18n.getLabel("WITHIN")),React.createElement(f,{key:"geoRadius",className:"geoRadius "+r,options:c,viewPrefs:this.props.viewPrefs,onChange:l,dataStyle:n,isDisabled:!this.state.validPostal})))}}]),a}(React.Component),f=function(a){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,a),_createClass(n,[{key:"componentDidMount",value:function(){var t,a=e(this.refs.wrapper);a.find(".ddc-selectpicker").ddcselectpicker("refresh"),t=a.find(".dropdown-toggle")[0].getBoundingClientRect().width,a.find(".dropdown-toggle").css("minWidth",t)}},{key:"componentDidUpdate",value:function(){var t=e(this.refs.wrapper);t.find(".ddc-selectpicker").ddcselectpicker("refresh")}},{key:"render",value:function(){var e="",a=this.props.options.map(function(t){return e=t.selected?t.value:e,React.createElement("option",{key:t.value+"-"+t.count,value:t.value,"data-subtext":t.count},t.name)}),n="true"!==this.props.viewPrefs.showCountOnSubmitButton,s=t.client.isMobile?"select-wrap":"",o=void 0!==this.props.isDisabled?this.props.isDisabled:!1;return React.createElement("div",{ref:"wrapper",className:"form-group"+(""!=e?" selected":"")},React.createElement("div",{className:s},React.createElement("select",{value:e,className:this.props.className,onChange:this.props.onChange,"data-show-subtext":n,"data-dropup-auto":"false","data-style":this.props.dataStyle,disabled:o},a)))}}]),n}(React.Component),m=function(t){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,t),_createClass(a,[{key:"componentDidMount",value:function(){var t=this;e(this.refs.button).on("click",function(e){t.props.onClick&&t.props.onClick(e)})}},{key:"render",value:function(){var e=this.props.caret?React.createElement("span",{className:"bs-caret"},React.createElement("span",{className:"caret"})):void 0;return React.createElement("button",{className:this.getClassname(),type:this.props.type,"data-toggle":this.props.dataToggle,ref:"button"},this.props.text,this.props.children,e)}},{key:"getClassname",value:function(){var e=this.props.className?this.props.className.split(" ").filter(function(e){return!!e}):[];if(e.push("btn"),e.push("btn-"+(null!=this.props.style?this.props.style:"default")),this.props.size&&"default"!=this.props.size){var t;switch(this.props.size){case"xlarge":t="btn-xl";break;case"large":t="btn-lg";break;case"small":t="btn-sm";break;case"xsmall":t="btn-xs";break;default:t="btn-"+this.props.size}e.push(t)}return this.props.layout&&("pull-left"==this.props.layout||"pull-right"==this.props.layout?e.push(this.props.layout):"block"==this.props.layout&&e.push("btn-"+this.props.layout)),e.join(" ")}}]),a}(React.Component),g=function(a){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,a),_createClass(n,[{key:"componentDidMount",value:function(){e(document).trigger("modulesRefresh",{modules:{ui:t.modules.ui}});var a=this.props.name,n=this.props.onChange;e(this.refs.wrapper).on("slidestop",function(){var t=e(this).find(".ui-slider-min-value.min-"+a).attr("data-value"),s=e(this).find(".ui-slider-max-value.max-"+a).attr("data-value");n(t,s)})}},{key:"getCurrentValues",value:function(){return{min:this.props.currentMin?this.props.currentMin:this.props.min,max:this.props.currentMax?this.props.currentMax:this.props.max}}},{key:"componentDidUpdate",value:function(){var t=this.getCurrentValues();e(this.refs.wrapper).find(".ui-slider.ui-widget").slider("values",[t.min,t.max])}},{key:"render",value:function(){var e=this.getCurrentValues();return React.createElement("div",{ref:"wrapper",className:"form-group"},React.createElement("p",{className:"ui-slider-value"}),React.createElement("input",{type:"text",name:this.props.name,className:"text range-slider hide ui-slider ddc-dynamic-field form-control",pattern:"(^$)|(^.*(\\S+).*$)","data-min":this.props.min,"data-max":this.props.max,"data-prefix":"$","data-suffix":this.props.suffix,"data-values":e.min+","+e.max,"data-format-money":"true",ref:"input"}))}}]),n}(React.Component),v=function(a){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,a),_createClass(n,[{key:"componentDidMount",value:function(){var t,a=e(ReactDOM.findDOMNode(this.refs.submitButton));a.hasClass("show-count")&&(t=a[0].getBoundingClientRect().width,a.css("minWidth",t)),e(this.refs.dataLoadingUI).on("click",function(e){e.stopPropagation()})}},{key:"shouldComponentUpdate",value:function(e){return!e.dataLoading}},{key:"setZipCode",value:function(){this.setState({score:this.state.score+1})}},{key:"render",value:function(){var e=this;console.log("facets",this.props.model.facets);var a=this.props.model,n=a.viewPrefs,s="true"===a.viewPrefs.showRadius,o=a.facets.map(function(t){var s=function(a,n){e.props.mutator.updateFacet(t.id,a+"-"+n)};if("compositeType"===t.id){var o=function(a){e.props.mutator.updateFacet(t.id,a)};return i(t,o,n,a.defaultActiveFacet)}return r(t,e.props.mutator,s,n,!0,a.totalCount)}),l=t.i18n.getLabel("VIEW_X_VEHICLES").replace("{0}",a.totalCount),c={text:"true"===n.showCountOnSubmitButton?l:t.i18n.getLabel(n.buttonTextSubmit),style:n.buttonStyleSubmit,size:n.buttonSizeSubmit,layout:n.buttonLayoutSubmit,classes:"submit-search ui-button-submit",onClick:function(){t.redirect(a.submitUrl+a.queryString)}},u={text:t.i18n.getLabel(n.buttonTextSearchReset),style:n.buttonStyleSearchReset,size:n.buttonSizeSearchReset,layout:n.buttonLayoutSearchReset,classes:"reset-search ui-button-reset",onClick:function(){t.redirect(a.submitUrl+a.queryString)}},p=["facet-browse-form","form-"+n.formLayout];return"true"===n.showCountOnSubmitButton&&(c.classes+=" show-count"),React.createElement("div",{className:"root"},React.createElement("div",{ref:"dataLoadingUI",className:"data-loading-ui"}),React.createElement("div",{className:p.join(" ")},s?React.createElement(h,{mutator:this.props.mutator,viewPrefs:n,widgetId:this.props.widgetId,geoData:this.props.geoData}):"",o,React.createElement("div",{className:"ddc-submit form-group"},React.createElement(m,{ref:"submitButton",type:"submit",style:c.style,layout:c.layout,size:c.size,className:c.classes,text:c.text,onClick:c.onClick}),"true"===n.showSearchReset?React.createElement(m,{ref:"resetButton",type:"reset",style:u.style,layout:u.layout,size:u.size,className:u.classes,text:u.text,onClick:function(){e.props.mutator.resetFacet({})}}):"")))}}]),n}(React.Component),b=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:this.props.dataLoading?"data-loading":""},React.createElement(v,{model:this.props.model,mutator:this.props.mutator,widgetId:this.props.widgetId,geoData:this.props.geoData,dataLoading:this.props.dataLoading}))}}]),t}(React.Component),y=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:this.props.stateClasses},React.createElement(p,{className:this.props.iconClasses}),this.props.message)}}]),t}(React.Component),R=function(){function n(e){_classCallCheck(this,n),this.model=null,this.widgetId=e,this.geoRadius=null,this.widgetDOMId="facet-browse-"+e,this.mutator={updateFacet:function(e,t){var n=a(this.model,this.hasGeo,this.geoData);this.applySelection(n,e,t),this.refresh(n)},updateFacets:function(e){var t=this,n=a(this.model,this.hasGeo,this.geoData);Object.keys(e).forEach(function(a){t.applySelection(n,a,e[a])}),this.refresh(n)},resetFacet:function(){this.hasGeo&&this.geoData.resetGeoData(),this.refresh({})}},this.mutator.updateFacet=this.mutator.updateFacet.bind(this),this.mutator.updateFacets=this.mutator.updateFacets.bind(this),this.mutator.resetFacet=this.mutator.resetFacet.bind(this),this.geoData={geoZip:t.WidgetData[this.widgetId].geoData.postalCode,geoRadius:null,uom:t.WidgetData[this.widgetId].geoData.uom,geoInputEl:null,setGeoValue:function(e,t){this.geoData[e]=t,"geoZip"===e&&(this.geoData.geoRadius=null)},resetGeoData:function(){this.geoData.geoZip=t.WidgetData[this.widgetId].geoData.postalCode,this.geoData.geoInputEl.value="",this.geoData.geoRadius=null}},this.geoData.setGeoValue=this.geoData.setGeoValue.bind(this),this.geoData.resetGeoData=this.geoData.resetGeoData.bind(this),this.hasGeo=null!==this.geoData.geoZip&&"true"===t.WidgetData[this.widgetId].prefs.showRadius}return _createClass(n,[{key:"callService",value:function(a){var n=t.WidgetData[this.widgetId].props.apiURL+a;return t.log("====================\n CALLING SERVICE WITH:",a),e.ajax({url:n,dataType:"json",cache:!1})}},{key:"applySelection",value:function(e,t,a){t&&(e[t]=a)}},{key:"renderModel",value:function(e){ReactDOM.render(React.createElement(b,{model:this.model,mutator:this.mutator,widgetId:this.widgetId,geoData:this.geoData,dataLoading:e}),document.getElementById(this.widgetDOMId))}},{key:"refresh",value:function(n){var s,o=this,i=!this.model,r=window.DDC.getSiteProperty("Tier2Region");i||this.renderModel(!0),r&&(n.Tier2Region=r),s=t.urlize(n,!0,!0),this.callService(s).done(function(n){var s=e("#facet-browse-"+o.widgetId+"-loader"),r=e("#facet-browse-"+o.widgetId),l=function(){n.queryString=t.urlize(a(n,o.hasGeo,o.geoData),!0,!0),n.viewPrefs=t.WidgetData[o.widgetId].prefs,n.props=t.WidgetData[o.widgetId].props,o.model=n,o.renderModel(!1),e("[data-toggle='tooltip']").tooltip()};i?s.fadeOut("fast",function(){r.fadeOut(0).removeClass("hide"),l(),r.fadeIn("fast")}):l()}).fail(function(){ReactDOM.render(React.createElement(y,{stateClasses:"alert alert-info",iconClasses:"ddc-icon ddc-icon-alert align-left",message:t.i18n.getMessage("SORRY_NO_ITEMS_MATCHING_YOUR_REQUEST_WERE_FOUND")}),document.getElementById(o.widgetDOMId))})}}]),n}();e(document).ready(function(){e(".inventory-search-facet-browse").each(function(a,n){var s=e(n).attr("data-widget-id"),o=new R(s),i="none"!=t.WidgetData[s].prefs.defaultActiveTypeConstraint?{compositeType:t.WidgetData[s].prefs.defaultActiveTypeConstraint}:{};o.refresh(i)})})}(jQuery,window.DDC);