define(["wcs.find-in-store-model","pubsub"],function(b){var c,d;var a=false;var e=function(f){if(a){console.log("ProductAvailability Constructor")}if(!(this instanceof e)){return new e()}this.attributes={};this.availableItems={};this.selections={};this.subscribers=[];this.partNumbers={};this.parentProductFormIndex=f;return this};c=function(g,f){this.parent=g;this.name=f;this.values={}};c.prototype={name:null,values:{},onChange:function(f,g){this.parent.fireChange(this.name,f,g)}};d=function(f,g){this.parent=f;this.value=g;this.items={}};d.prototype={available:null,setAvailable:function(f){var g=this.available!==f;this.available=f;if(g){this.parent.onChange(this.value,f)}}};e.prototype={addAvailableItem:function(f,g){this.availableItems[f]=g},addAttributeValue:function(f,g){this.addItemAttributeValue(null,f,g)},addItemAttributeValue:function(i,h,j){var g,f;g=this.attributes[h];if(!g){g=new c(this,h);this.attributes[h]=g}f=g.values[j];if(!f){f=new d(g,j);g.values[j]=f}if(i){f.items[i]=i}},addItemPartNumber:function(g,f){this.partNumbers[g]=f},onChange:function(f,g){if(typeof f==="function"){g=f;f=this}this.subscribers.push({context:f,fn:g})},fireChange:function(j,l,k){var f=this,g,h;Object.keys(f.subscribers).map(function(m,i){h=f.subscribers[i];h.fn.apply(h.context,[j,l,k])})},isAvailable:function(h,i){var g,f;g=this.attributes[h];if(!g){return false}f=g.values[i];if(!f){return false}return f.available===true},select:function(f,g){if(typeof g==="undefined"){return}this.selections[f]=g},resolveItems:function(h,f){var m=this,j,g,i,n,k,l;if(!h){h=this.selections}j=this.availableItems;b.setProductSelection(h);Object.keys(h).map(function(o){if(!(o in m.attributes)){return false}i=m.attributes[o];n=i.values[h[o]];if(!n){return false}k={};Object.keys(n.items).map(function(p){if(j.hasOwnProperty(p)){if(!f||j[p]>0){k[p]=j[p]}}});j=k});return j},resolveItem:function(i){var g,j,h,f=0;if(!i){i=this.selections}for(h in i){++f}if(f>0){g=this.resolveItems(i,false);for(j in g){if(g.hasOwnProperty(j)){return j}}}return null},checkInventory:function(f){if(!f){return 0}return this.availableItems[f]},getPartNumber:function(f){if(!f){return null}return this.partNumbers[f]},update:function(){if(a){console.log("ProductAvailability Update")}var o=this,i=false,j,l,f,g,k,m,p,n,h;Object.keys(o.attributes).map(function(q){g={};Object.keys(o.attributes).map(function(r){if(q!==r){if(o.selections[r]){g[r]=o.selections[r]}}});l=o.resolveItems(g,true);k=o.attributes[q];Object.keys(k.values).map(function(r){p=k.values[r];h=false;h=Object.keys(p.items).some(function(s){return l[s]});p.setAvailable(h)});$.pubsub("publish","WCS.PRODUCT_AVAILABILITY.ALL_AVAILABLE_SET",o.parentProductFormIndex);i=true})}};return e});