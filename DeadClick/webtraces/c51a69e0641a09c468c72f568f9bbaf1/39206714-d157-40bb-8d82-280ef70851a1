jQuery.fn.extend({new_root_comment:function(){new_comment_html='<form class="form -narrow">';new_comment_html+='<div class="form--field">';new_comment_html+='<div class="form--field-container">';new_comment_html+='<div class="form--textfield-container">';new_comment_html+='<input type="text" class="form--textfield questions--question-body">';new_comment_html+="</div>";new_comment_html+="</div>";new_comment_html+="</div>";new_comment_html+="</form>";return new_comment_html},show_root_comment:function(obj,selected_photo_path){question_html="<ul>";$.each(obj.comments,function(key,comments){question_html+='<li class="array--item"><a href="'+selected_photo_path+'" class="array--item-link">'+comments.body+"</a></li>"});question_html+="</ul>";return question_html},toggle_button:function(text,photo,additionalClass){$button=$('<button class="form--submit questions--another-question-button another-question--button '+additionalClass+'" data-photo="'+photo+'" type="button">'+text+"</button>");$(".another-question").html($button);return $button},close_fancy:function(){closeAllLightboxes();$(".questions--items-root ul").remove()}});var scope;$(document.body).on("click",".ask-a-question--button",function(){scope=$(this);photo_id=scope.data("photo");photo_name=scope.data("photo-name");photos_name=scope.data("photos-name");photo_params=scope.data("photo-params");another_question=scope.data("another-question");save=scope.data("save");selected_photo_path="/"+photo_name+"/"+photo_params;$(".questions--items").show();$(".questions--ask-question-form").attr("style","display: none !important");$(".questions--notify").hide();$(".questions--title-success").hide();$(".questions--title").show();$.ajax({url:"/comments/load_root_comments",type:"GET",dataType:"json",data:{photo:photo_id},success:function(obj){if(obj.comments.length===0){$(".questions--items").hide();$(".questions--ask-question-form").attr("style","display: block !important");$(".questions--ask-questions-form-field-container").html($(this).new_root_comment());$(this).toggle_button(save,photo_id,"question-button")}else{$(".questions--items-root").html($(this).show_root_comment(obj,selected_photo_path));$(this).toggle_button(another_question,photo_id,"")}}})});$(function(){$(".another-question").click(function(e){save=scope.data("save");scope=$(this);if(scope.children("button").hasClass("question-button")){comment=$(".questions--question-body").val();url_path="/"+photos_name+"/"+photo_id+"/comments";if(comment){$.ajax({url:url_path,method:"POST",data:{comment:{body:comment}},success:function(){scope.close_fancy()}})}}else{$(".questions--items").hide();$(".questions--ask-question-form").attr("style","display: block !important");$(".questions--notify").hide();$(".questions--ask-questions-form-field-container").html(scope.new_root_comment());scope.toggle_button(save,photo_id,"question-button")}})});