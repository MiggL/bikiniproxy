/*! permutive-javascript-sdk v2.0.6 (web) (built 2018-02-07 13:51:26 UTC) */
!function(){function lzWorkerFunction(){var e=this;e.compress=function(e){if(null==e)return"";var t,n,i,r={},o={},s="",a="",u="",c=2,l=3,d=2,f=[],p=0,m=0,h=String.fromCharCode,g=function(e){return h(e+32)};for(i=0;i<e.length;i+=1)if(s=e.charAt(i),Object.prototype.hasOwnProperty.call(r,s)||(r[s]=l++,o[s]=!0),a=u+s,Object.prototype.hasOwnProperty.call(r,a))u=a;else{if(Object.prototype.hasOwnProperty.call(o,u)){if(u.charCodeAt(0)<256){for(t=0;t<d;t++)p<<=1,14==m?(m=0,f.push(g(p)),p=0):m++;for(n=u.charCodeAt(0),t=0;t<8;t++)p=p<<1|1&n,14==m?(m=0,f.push(g(p)),p=0):m++,n>>=1}else{for(n=1,t=0;t<d;t++)p=p<<1|n,14==m?(m=0,f.push(g(p)),p=0):m++,n=0;for(n=u.charCodeAt(0),t=0;t<16;t++)p=p<<1|1&n,14==m?(m=0,f.push(g(p)),p=0):m++,n>>=1}0==--c&&(c=Math.pow(2,d),d++),delete o[u]}else for(n=r[u],t=0;t<d;t++)p=p<<1|1&n,14==m?(m=0,f.push(g(p)),p=0):m++,n>>=1;0==--c&&(c=Math.pow(2,d),d++),r[a]=l++,u=String(s)}if(""!==u){if(Object.prototype.hasOwnProperty.call(o,u)){if(u.charCodeAt(0)<256){for(t=0;t<d;t++)p<<=1,14==m?(m=0,f.push(g(p)),p=0):m++;for(n=u.charCodeAt(0),t=0;t<8;t++)p=p<<1|1&n,14==m?(m=0,f.push(g(p)),p=0):m++,n>>=1}else{for(n=1,t=0;t<d;t++)p=p<<1|n,14==m?(m=0,f.push(g(p)),p=0):m++,n=0;for(n=u.charCodeAt(0),t=0;t<16;t++)p=p<<1|1&n,14==m?(m=0,f.push(g(p)),p=0):m++,n>>=1}0==--c&&(c=Math.pow(2,d),d++),delete o[u]}else for(n=r[u],t=0;t<d;t++)p=p<<1|1&n,14==m?(m=0,f.push(g(p)),p=0):m++,n>>=1;0==--c&&(c=Math.pow(2,d),d++)}for(n=2,t=0;t<d;t++)p=p<<1|1&n,14==m?(m=0,f.push(g(p)),p=0):m++,n>>=1;for(;;){if(p<<=1,14==m){f.push(g(p));break}m++}return f.join("")+" "},e.decompress=function(e){if(null==e)return"";if(""==e)return null;var t,n,i,r,o,s,a,u=e.length,c=function(t){return e.charCodeAt(t)-32},l=[],d=4,f=4,p=3,m="",h=[],g={val:c(0),position:16384,index:1},v=String.fromCharCode;for(t=0;t<3;t+=1)l[t]=t;for(i=0,o=Math.pow(2,2),s=1;s!=o;)r=g.val&g.position,g.position>>=1,0==g.position&&(g.position=16384,g.val=c(g.index++)),i|=(r>0?1:0)*s,s<<=1;switch(i){case 0:for(i=0,o=Math.pow(2,8),s=1;s!=o;)r=g.val&g.position,g.position>>=1,0==g.position&&(g.position=16384,g.val=c(g.index++)),i|=(r>0?1:0)*s,s<<=1;a=v(i);break;case 1:for(i=0,o=Math.pow(2,16),s=1;s!=o;)r=g.val&g.position,g.position>>=1,0==g.position&&(g.position=16384,g.val=c(g.index++)),i|=(r>0?1:0)*s,s<<=1;a=v(i);break;case 2:return""}for(l[3]=a,n=a,h.push(a);;){if(g.index>u)return"";for(i=0,o=Math.pow(2,p),s=1;s!=o;)r=g.val&g.position,g.position>>=1,0==g.position&&(g.position=16384,g.val=c(g.index++)),i|=(r>0?1:0)*s,s<<=1;switch(a=i){case 0:for(i=0,o=Math.pow(2,8),s=1;s!=o;)r=g.val&g.position,g.position>>=1,0==g.position&&(g.position=16384,g.val=c(g.index++)),i|=(r>0?1:0)*s,s<<=1;l[f++]=v(i),a=f-1,d--;break;case 1:for(i=0,o=Math.pow(2,16),s=1;s!=o;)r=g.val&g.position,g.position>>=1,0==g.position&&(g.position=16384,g.val=c(g.index++)),i|=(r>0?1:0)*s,s<<=1;l[f++]=v(i),a=f-1,d--;break;case 2:return h.join("")}if(0==d&&(d=Math.pow(2,p),p++),l[a])m=l[a];else{if(a!==f)return null;m=n+n.charAt(0)}h.push(m),l[f++]=n+m.charAt(0),n=m,0==--d&&(d=Math.pow(2,p),p++)}},e.onmessage=function(t){"compress"===t.data.type?e.postMessage({type:"compressed",result:e.compress(t.data.value)}):"decompress"===t.data.type&&e.postMessage({type:"decompressed",result:e.decompress(t.data.value)})}}function extractDomain(e){var t=e.match(/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/),n=e.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,24}$/i),i=e.match(/localhost/);if(n&&n.length>0){var r=e.split(".").reverse();return r.length>=3&&r[1].match(/^(com|edu|gov|net|mil|org|nom|co|name|info|biz)$/i)?r[2]+"."+r[1]+"."+r[0]:r[1]+"."+r[0]}if(t&&t.length>0)return t[0];if(i&&i.length>0)return"localhost";throw"No domain can be found for cookies"}function hasWebWorkerSupport(){var e=!!window.Worker&&!!window.Blob;try{new Worker(URL.createObjectURL(new Blob(["1"],{type:"application/javascript"})))}catch(t){e=!1}return e}function queryWorkerFunction(){var e=this,t=function(){return function(e,t,n,i){void 0===i&&(i={}),this.id=e,this.hasChanged=t,this.result=n,this.activations=i}}(),n=function(){function e(e,t,n,i){var r=this;this.id=e,this.query=t;var o=function(){return new Date},s=function(){return n};this.effects={getCurrentTime:o,getCurrentSession:s,getThirdPartySegments:function(){return{}},setThirdPartyActivation:function(e,t){}},this.effectsWithTpd={getCurrentTime:o,getCurrentSession:s,getThirdPartySegments:function(){return i},setThirdPartyActivation:function(e,t){e in r.thirdPartyActivations?-1!==r.thirdPartyActivations[e].indexOf(t)||r.thirdPartyActivations[e].push(t):r.thirdPartyActivations[e]=[t]}},this.reset()}return e.prototype.reset=function(e,t){this.thirdPartyActivations={},this.state=this.query.initial(this.effects),this.hasRunCache=!1},e.prototype.update=function(e,n){if(n=n||{},n.fromCache=n.fromCache||!1,n.initEvent=n.initEvent||!1,!(this.hasRunCache||n.fromCache||n.initEvent))throw new Error("Update called prematurely before query initialised");var i=this.result(this.hasRunCache);try{this.state=this.query.update(this.effects,this.state,e);var r=this.result(this.hasRunCache||n.initEvent),o=!this.areResultsEqual(i,r);return new t(this.id,o,r,this.thirdPartyActivations)}catch(e){throw e.message="Skipping event causing runtime error: "+e.message,e}},e.prototype.setReady=function(){this.hasRunCache=!0},e.prototype.initialResult=function(){return this.query.result(this.effects,this.query.initial(this.effects))},e.prototype.result=function(e){return this.query.result(e?this.effectsWithTpd:this.effects,this.state)},e.prototype.areResultsEqual=function(e,t){var n=!0;for(var i in e)if(!(n=n&&e[i]===t[i]))break;return n},e}();this.rawQueries=function(){var e=function(e,t,n){return{initial:function(t){var n={};for(var i in e)n[i]=e[i].initial(t);return n},update:function(n,i,r){if(!t(r))return i;var o={};for(var s in e)o[s]=i[s],o[s]=e[s].update(n,o[s],r);return o},result:function(t,i){var r={};for(var o in e)r[o]=e[o].result(t,i[o]);return n(t,r)}}},t=function(e){var t=Object.prototype.toString.call(e);return"[object Array]"===t?"array":"[object Object]"===t?"object":"[object String]"===t?"string":"[object Number]"===t?"number":"[object Boolean]"===t?"boolean":"[object Null]"===t?"null":"[object Date]"===t?"date":"undefined"},n=function(e,t){return"string"==typeof e&&null!=e&&"string"==typeof t&&null!=t&&t.toLowerCase().indexOf(e.toLowerCase())>-1},i=function(e,t,n){var i=e.getCurrentTime();return null===t||null===i?null:i.getTime()-t.getTime()<=n},r=function(e){return e.getCurrentSession()},o={number:{add:function(e,t){return e+t},sub:function(e,t){return e-t},mul:function(e,t){return e*t},div:function(e,t){return e/t},lt:function(e,t){return e<t},gt:function(e,t){return e>t},lte:function(e,t){return e<=t},gte:function(e,t){return e>=t}},util:{nullSafe:function(e,t,n){return null===t||null===n?null:e(t,n)}}},s={"05163b1d-03de-4f93-b61d-e1f650cf944d":e({result:e({0:{initial:function(e){return 0},update:function(e,i,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.session_id)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&"string"===t(s.session_id)&&t(s.session_id)===t(s.session_id)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===s.name&&s.session_id===r(e)&&n("utm_medium=social",s.properties.client.url)?1:0):i},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)})},function(e){return!0},function(e,t){return t}),"10271e10-a4fe-46a3-8892-e9a68ee91966":e({result:e({0:{initial:function(e){return 0},update:function(e,r,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.time)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&t(s.time)===t(s.time)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)?o.util.nullSafe(o.number.add,r,"Pageview"===s.name&&i(e,s.time,6048e5)&&n("business",s.properties.client.url)?1:0):r},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],3)})},function(e){return!0},function(e,t){return t}),"1b88b39b-4be7-4d2e-8f44-3f4f62423db9":e({result:e({0:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.url)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.url)&&t(r.properties.client.url)===t(r.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===r.name&&n("hotels-resorts-spas",r.properties.client.url)?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"object"===t(i.properties)&&"undefined"!==t(i.properties.segment_name)&&"string"===t(i.name)&&t(i.name)===t(i.name)&&"string"===t(i.properties.segment_name)&&t(i.properties.segment_name)===t(i.properties.segment_name)?o.util.nullSafe(o.number.add,n,"SegmentEntry"===i.name&&"EliteTraveler"===i.properties.segment_name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)&&o.util.nullSafe(o.number.gte,t[1],1)})},function(e){return!0},function(e,t){return t}),"25d061af-a299-4395-91d1-52a2a8aa109f":e({result:e({0:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"string"===t(i.name)&&t(i.name)===t(i.name)?o.util.nullSafe(o.number.add,n,"Pageview"===i.name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)})},function(e){return!0},function(e,t){return t}),"4e445742-b2c3-43cf-831e-6efdfc0b6c3f":e({result:e({0:{initial:function(e){return 0},update:function(e,i,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.session_id)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&"string"===t(s.session_id)&&t(s.session_id)===t(s.session_id)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===s.name&&s.session_id===r(e)&&n("utm_medium=email",s.properties.client.url)?1:0):i},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)})},function(e){return!0},function(e,t){return t}),"5a7235d9-5a9e-4fff-a5db-aec0863e4597":e({result:e({0:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.referrer)&&"undefined"!==t(r.properties.client.url)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.referrer)&&t(r.properties.client.referrer)===t(r.properties.client.referrer)&&"string"===t(r.properties.client.url)&&t(r.properties.client.url)===t(r.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===r.name&&(n("newstatesman.com/long-reads",r.properties.client.referrer)||n("newstatesman.com/long-reads",r.properties.client.url))?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.referrer)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.referrer)&&t(r.properties.client.referrer)===t(r.properties.client.referrer)?o.util.nullSafe(o.number.add,i,"LinkClick"===r.name&&n("newstatesman.com/long-reads",r.properties.client.referrer)?1:0):i},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)||o.util.nullSafe(o.number.gte,t[1],1)})},function(e){return!0},function(e,t){return t}),"61543bc3-8d72-43e6-8688-63a1fbc2b4b3":e({result:e({0:{initial:function(e){return 0},update:function(e,n,r){return"undefined"!==t(r.name)&&"undefined"!==t(r.time)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&t(r.time)===t(r.time)?o.util.nullSafe(o.number.add,n,"PageviewEngagement"===r.name&&i(e,r.time,2592e6)?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],12)})},function(e){return!0},function(e,t){return t}),"68ff61ca-2244-4866-8a18-dd3e00494b6e":e({result:e({0:{initial:function(e){return 0},update:function(e,r,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.time)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"undefined"!==t(s.properties.client.domain)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&t(s.time)===t(s.time)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)&&"string"===t(s.properties.client.domain)&&t(s.properties.client.domain)===t(s.properties.client.domain)?o.util.nullSafe(o.number.add,r,"Pageview"===s.name&&i(e,s.time,24192e5)&&n("politic",s.properties.client.url)&&n("newstatesman",s.properties.client.domain)?1:0):r},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],3)})},function(e){return!0},function(e,t){return t}),"6dba9647-a73f-4651-8e60-a38bb2de3b42":e({result:e({0:{initial:function(e){return 0},update:function(e,i,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.session_id)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&"string"===t(s.session_id)&&t(s.session_id)===t(s.session_id)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===s.name&&s.session_id===r(e)&&n("utm_source=twitter.com",s.properties.client.url)?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"object"===t(i.properties)&&"undefined"!==t(i.properties.segment_name)&&"string"===t(i.name)&&t(i.name)===t(i.name)&&"string"===t(i.properties.segment_name)&&t(i.properties.segment_name)===t(i.properties.segment_name)?o.util.nullSafe(o.number.add,n,"SegmentEntry"===i.name&&"Social Traffic"===i.properties.segment_name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)&&o.util.nullSafe(o.number.gte,t[1],1)})},function(e){return!0},function(e,t){return t}),"6de40117-6867-4dd2-b66a-0761b9c34dc1":e({result:e({0:{initial:function(e){return 0},update:function(e,n,r){return"undefined"!==t(r.name)&&"undefined"!==t(r.time)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&t(r.time)===t(r.time)?o.util.nullSafe(o.number.add,n,"Pageview"===r.name&&i(e,r.time,2592e6)?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],3)})},function(e){return!0},function(e,t){return t}),"8ff37adc-bfe3-45bf-bb84-a397f505e8b8":e({result:e({0:{initial:function(e){return 0},update:function(e,n,r){return"undefined"!==t(r.name)&&"undefined"!==t(r.time)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&t(r.time)===t(r.time)?o.util.nullSafe(o.number.add,n,"PageviewEngagement"===r.name&&i(e,r.time,2592e6)?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],6)})},function(e){return!0},function(e,t){return t}),"a1ce530d-c6f0-4f3b-a4d0-35f7f07c3614":e({result:e({0:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.url)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.url)&&t(r.properties.client.url)===t(r.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===r.name&&n("luxury-transport",r.properties.client.url)?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"object"===t(i.properties)&&"undefined"!==t(i.properties.segment_name)&&"string"===t(i.name)&&t(i.name)===t(i.name)&&"string"===t(i.properties.segment_name)&&t(i.properties.segment_name)===t(i.properties.segment_name)?o.util.nullSafe(o.number.add,n,"SegmentEntry"===i.name&&"EliteTraveler"===i.properties.segment_name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)&&o.util.nullSafe(o.number.gte,t[1],1)})},function(e){return!0},function(e,t){return t}),"a5eb161c-950c-4a34-8818-b76e9d9efb9f":e({result:e({0:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.title)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.title)&&t(r.properties.client.title)===t(r.properties.client.title)?o.util.nullSafe(o.number.add,i,"Pageview"===r.name&&n("security",r.properties.client.title)?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"string"===t(i.name)&&t(i.name)===t(i.name)?o.util.nullSafe(o.number.add,n,"PageviewEngagement"===i.name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)&&o.util.nullSafe(o.number.gte,t[1],12)})},function(e){return!0},function(e,t){return t}),"a6d84eea-8e80-4479-82e8-abf79fc02281":e({result:e({0:{initial:function(e){return 0},update:function(e,i,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.session_id)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&"string"===t(s.session_id)&&t(s.session_id)===t(s.session_id)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===s.name&&s.session_id===r(e)&&n("utm_source=facebook.com",s.properties.client.url)?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"object"===t(i.properties)&&"undefined"!==t(i.properties.segment_name)&&"string"===t(i.name)&&t(i.name)===t(i.name)&&"string"===t(i.properties.segment_name)&&t(i.properties.segment_name)===t(i.properties.segment_name)?o.util.nullSafe(o.number.add,n,"SegmentEntry"===i.name&&"Social Traffic"===i.properties.segment_name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)&&o.util.nullSafe(o.number.gte,t[1],1)})},function(e){return!0},function(e,t){return t}),"d09aff6a-78a9-4c4b-a403-d2b56a43c02f":e({result:e({0:{initial:function(e){return 0},update:function(e,n,r){return"undefined"!==t(r.name)&&"undefined"!==t(r.time)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&t(r.time)===t(r.time)?o.util.nullSafe(o.number.add,n,"Pageview"===r.name&&i(e,r.time,2592e6)?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],5)})},function(e){return!0},function(e,t){return t}),"e433e384-842e-4272-88dc-867eb6a7b1e3":e({result:e({0:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.domain)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.domain)&&t(r.properties.client.domain)===t(r.properties.client.domain)?o.util.nullSafe(o.number.add,i,"Pageview"===r.name&&n("elitetraveler",r.properties.client.domain)?1:0):i},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)})},function(e){return!0},function(e,t){return t})};return void 0!==s?s:{}}(),this.configuration={"5a7235d9-5a9e-4fff-a5db-aec0863e4597":{code:2637,name:"NewStatesman_long-read-enthusiasts",is_segment:!0},"25d061af-a299-4395-91d1-52a2a8aa109f":{code:2491,name:"Everyone",is_segment:!0},"61543bc3-8d72-43e6-8688-63a1fbc2b4b3":{code:2495,name:"Engaged_Time_60s+_30Days",is_segment:!0},"e433e384-842e-4272-88dc-867eb6a7b1e3":{code:2646,name:"EliteTraveler",is_segment:!0},"d09aff6a-78a9-4c4b-a403-d2b56a43c02f":{code:2493,name:"Engaged_Pageviews_5+_30Days",is_segment:!0},"05163b1d-03de-4f93-b61d-e1f650cf944d":{code:2650,name:"Social Traffic",is_segment:!0},"4e445742-b2c3-43cf-831e-6efdfc0b6c3f":{code:2655,name:"Email Traffic",is_segment:!0},"10271e10-a4fe-46a3-8892-e9a68ee91966":{code:2631,name:"High Engaged Business Interest",is_segment:!0},"a5eb161c-950c-4a34-8818-b76e9d9efb9f":{code:2482,name:"Interests: Security",is_segment:!0},"a6d84eea-8e80-4479-82e8-abf79fc02281":{code:2651,name:"Social Traffic_Facebook",is_segment:!0},"6dba9647-a73f-4651-8e60-a38bb2de3b42":{code:2652,name:"Social Traffic_Twitter",is_segment:!0},"68ff61ca-2244-4866-8a18-dd3e00494b6e":{code:2584,name:"Interest_Politics_NewStatesman",is_segment:!0},"1b88b39b-4be7-4d2e-8f44-3f4f62423db9":{code:2648,name:"EliteTraveler_Hotels Resorts & Spas",is_segment:!0},"a1ce530d-c6f0-4f3b-a4d0-35f7f07c3614":{code:2647,name:"EliteTraveler_Luxury Transport",is_segment:!0},"8ff37adc-bfe3-45bf-bb84-a397f505e8b8":{code:2494,name:"Engaged_Time_30s+_30Days",is_segment:!0},"6de40117-6867-4dd2-b66a-0761b9c34dc1":{code:2492,name:"Engaged_Pageviews_3+_30Days",is_segment:!0}},this.queries={},this.descriptors={},this.thirdPartySegments={},this.buildQueryDescriptors=function(t,i){for(var r in e.rawQueries)if(e.rawQueries.hasOwnProperty(r)){var o=e.configuration[r],s=new n(o.code,e.rawQueries[r],i,e.thirdPartySegments);e.queries[o.code]=s;var a=!(o.code in t);e.descriptors[o.code]={id:r,code:o.code,name:o.name,isSegment:o.is_segment,isNew:a,hasRunCache:!1,initialResult:s.initialResult()}}return e.descriptors},e.updateQueries=function(t,n){var i={},r=[],o=function(t,n,o){var s=void 0;try{s=t.update(n,o)}catch(e){r.push(e.toString())}if(void 0!==s&&void 0!==s.result&&s.hasChanged){var a=JSON.parse(JSON.stringify(e.descriptors[s.id]));i[t.id]={descriptor:a,result:s.result,activations:s.activations}}};for(var s in t)for(var a in e.queries)e.queries.hasOwnProperty(a)&&o(u=e.queries[a],t[s],n);if(!0===n.fromCache)for(var a in e.queries)if(e.queries.hasOwnProperty(a)){var u=e.queries[a];o(u,{},{initEvent:!0}),u.setReady(),e.descriptors[u.id].hasRunCache=!0}var c=[];for(var l in i)i.hasOwnProperty(l)&&c.push(i[l]);return[c,r,n]},e.resetQueries=function(){for(var t in e.queries)e.queries.hasOwnProperty(t)&&e.queries[t].reset()},e.onmessage=function(t){if("buildQueryDescriptors"===t.data.type)e.postMessage({type:"setQueryDescriptors",value:e.buildQueryDescriptors.apply(e,t.data.arguments)});else if("updateQueries"===t.data.type){var n=e.updateQueries.apply(e,t.data.arguments);e.postMessage({type:"queryResultChanges",value:{changes:n[0],options:t.data.arguments[1]}}),n[1].length>0&&e.postMessage({type:"logErrors",value:n[1]})}else"resetQueries"===t.data.type?e.resetQueries():"thirdPartySegments"===t.data.type&&(e.thirdPartySegments=t.data.arguments[0])}}var Zepto=function(){function e(e){return null==e?String(e):H[J.call(e)]||"object"}function t(t){return"function"==e(t)}function n(e){return null!=e&&e==e.window}function i(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function r(t){return"object"==e(t)}function o(e){return r(e)&&!n(e)&&Object.getPrototypeOf(e)==Object.prototype}function s(e){var t=!!e&&"length"in e&&e.length,i=k.type(e);return"function"!=i&&!n(e)&&("array"==i||0===t||"number"==typeof t&&t>0&&t-1 in e)}function a(e){return I.call(e,function(e){return null!=e})}function u(e){return e.length>0?k.fn.concat.apply([],e):e}function c(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function l(e){return e in A?A[e]:A[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function d(e,t){return"number"!=typeof t||R[c(e)]?t:t+"px"}function f(e){var t,n;return N[e]||(t=D.createElement(e),D.body.appendChild(t),n=Zepto.getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==n&&(n="block"),N[e]=n),N[e]}function p(e){return"children"in e?O.call(e.children):k.map(e.childNodes,function(e){if(1==e.nodeType)return e})}function m(e,t){var n,i=e?e.length:0;for(n=0;n<i;n++)this[n]=e[n];this.length=i,this.selector=t||""}function h(e,t,n){for(C in t)n&&(o(t[C])||Y(t[C]))?(o(t[C])&&!o(e[C])&&(e[C]={}),Y(t[C])&&!Y(e[C])&&(e[C]=[]),h(e[C],t[C],n)):t[C]!==S&&(e[C]=t[C])}function g(e,t){return null==t?k(e):k(e).filter(t)}function v(e,n,i,r){return t(n)?n.call(e,i,r):n}function y(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function b(e,t){var n=e.className||"",i=n&&n.baseVal!==S;if(t===S)return i?n.baseVal:n;i?n.baseVal=t:e.className=t}function _(e){try{return e?"true"==e||"false"!=e&&("null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?k.parseJSON(e):e):e}catch(t){return e}}function w(e,t){t(e);for(var n=0,i=e.childNodes.length;n<i;n++)w(e.childNodes[n],t)}var S,C,k,E,T,x,P=[],j=P.concat,I=P.filter,O=P.slice,D=window.document,N={},A={},R={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},M=/^\s*<(\w+|!)[^>]*>/,$=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,q=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,B=/^(?:body|html)$/i,L=/([A-Z])/g,U=["val","css","html","text","data","width","height","offset"],F=["after","prepend","before","append"],Z=D.createElement("table"),Q=D.createElement("tr"),W={tr:D.createElement("tbody"),tbody:Z,thead:Z,tfoot:Z,td:Q,th:Q,"*":D.createElement("div")},z=/complete|loaded|interactive/,K=/^[\w-]*$/,H={},J=H.toString,V={},G=D.createElement("div"),X={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},Y=Array.isArray||function(e){return e instanceof Array};return V.matches=function(e,t){if(!t||!e||1!==e.nodeType)return!1;var n=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var i,r=e.parentNode,o=!r;return o&&(r=G).appendChild(e),i=~V.qsa(r,t).indexOf(e),o&&G.removeChild(e),i},T=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},x=function(e){return I.call(e,function(t,n){return e.indexOf(t)==n})},V.fragment=function(e,t,n){var i,r,s;return $.test(e)&&(i=k(D.createElement(RegExp.$1))),i||(e.replace&&(e=e.replace(q,"<$1></$2>")),t===S&&(t=M.test(e)&&RegExp.$1),t in W||(t="*"),(s=W[t]).innerHTML=""+e,i=k.each(O.call(s.childNodes),function(){s.removeChild(this)})),o(n)&&(r=k(i),k.each(n,function(e,t){U.indexOf(e)>-1?r[e](t):r.attr(e,t)})),i},V.Z=function(e,t){return new m(e,t)},V.isZ=function(e){return e instanceof V.Z},V.init=function(e,n){var i;if(!e)return V.Z();if("string"==typeof e)if("<"==(e=e.trim())[0]&&M.test(e))i=V.fragment(e,RegExp.$1,n),e=null;else{if(n!==S)return k(n).find(e);i=V.qsa(D,e)}else{if(t(e))return k(D).ready(e);if(V.isZ(e))return e;if(Y(e))i=a(e);else if(r(e))i=[e],e=null;else if(M.test(e))i=V.fragment(e.trim(),RegExp.$1,n),e=null;else{if(n!==S)return k(n).find(e);i=V.qsa(D,e)}}return V.Z(i,e)},k=function(e,t){return V.init(e,t)},k.extend=function(e){var t,n=O.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),n.forEach(function(n){h(e,n,t)}),e},V.qsa=function(e,t){var n,i="#"==t[0],r=!i&&"."==t[0],o=i||r?t.slice(1):t,s=K.test(o);return e.getElementById&&s&&i?(n=e.getElementById(o))?[n]:[]:1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType?[]:O.call(s&&!i&&e.getElementsByClassName?r?e.getElementsByClassName(o):e.getElementsByTagName(t):e.querySelectorAll(t))},k.contains=D.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t&&(t=t.parentNode);)if(t===e)return!0;return!1},k.type=e,k.isFunction=t,k.isWindow=n,k.isArray=Y,k.isPlainObject=o,k.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},k.isNumeric=function(e){var t=Number(e),n=typeof e;return null!=e&&"boolean"!=n&&("string"!=n||e.length)&&!isNaN(t)&&isFinite(t)||!1},k.inArray=function(e,t,n){return P.indexOf.call(t,e,n)},k.camelCase=T,k.trim=function(e){return null==e?"":String.prototype.trim.call(e)},k.uuid=0,k.support={},k.expr={},k.noop=function(){},k.map=function(e,t){var n,i,r,o=[];if(s(e))for(i=0;i<e.length;i++)null!=(n=t(e[i],i))&&o.push(n);else for(r in e)null!=(n=t(e[r],r))&&o.push(n);return u(o)},k.each=function(e,t){var n,i;if(s(e)){for(n=0;n<e.length;n++)if(!1===t.call(e[n],n,e[n]))return e}else for(i in e)if(!1===t.call(e[i],i,e[i]))return e;return e},k.grep=function(e,t){return I.call(e,t)},window.JSON&&(k.parseJSON=JSON.parse),k.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){H["[object "+t+"]"]=t.toLowerCase()}),k.fn={constructor:V.Z,length:0,forEach:P.forEach,reduce:P.reduce,push:P.push,sort:P.sort,splice:P.splice,indexOf:P.indexOf,concat:function(){var e,t,n=[];for(e=0;e<arguments.length;e++)t=arguments[e],n[e]=V.isZ(t)?t.toArray():t;return j.apply(V.isZ(this)?this.toArray():this,n)},map:function(e){return k(k.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return k(O.apply(this,arguments))},ready:function(e){return z.test(D.readyState)&&D.body?e(k):D.addEventListener("DOMContentLoaded",function(){e(k)},!1),this},get:function(e){return e===S?O.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){return P.every.call(this,function(t,n){return!1!==e.call(t,n,t)}),this},filter:function(e){return t(e)?this.not(this.not(e)):k(I.call(this,function(t){return V.matches(t,e)}))},add:function(e,t){return k(x(this.concat(k(e,t))))},is:function(e){return this.length>0&&V.matches(this[0],e)},not:function(e){var n=[];if(t(e)&&e.call!==S)this.each(function(t){e.call(this,t)||n.push(this)});else{var i="string"==typeof e?this.filter(e):s(e)&&t(e.item)?O.call(e):k(e);this.forEach(function(e){i.indexOf(e)<0&&n.push(e)})}return k(n)},has:function(e){return this.filter(function(){return r(e)?k.contains(this,e):k(this).find(e).size()})},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!r(e)?e:k(e)},last:function(){var e=this[this.length-1];return e&&!r(e)?e:k(e)},find:function(e){var t=this;return e?"object"==typeof e?k(e).filter(function(){var e=this;return P.some.call(t,function(t){return k.contains(t,e)})}):1==this.length?k(V.qsa(this[0],e)):this.map(function(){return V.qsa(this,e)}):k()},closest:function(e,t){var n=[],r="object"==typeof e&&k(e);return this.each(function(o,s){for(;s&&!(r?r.indexOf(s)>=0:V.matches(s,e));)s=s!==t&&!i(s)&&s.parentNode;s&&n.indexOf(s)<0&&n.push(s)}),k(n)},parents:function(e){for(var t=[],n=this;n.length>0;)n=k.map(n,function(e){if((e=e.parentNode)&&!i(e)&&t.indexOf(e)<0)return t.push(e),e});return g(t,e)},parent:function(e){return g(x(this.pluck("parentNode")),e)},children:function(e){return g(this.map(function(){return p(this)}),e)},contents:function(){return this.map(function(){return this.contentDocument||O.call(this.childNodes)})},siblings:function(e){return g(this.map(function(e,t){return I.call(p(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return k.map(this,function(t){return t[e]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==Zepto.getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=f(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var n=t(e);if(this[0]&&!n)var i=k(e).get(0),r=i.parentNode||this.length>1;return this.each(function(t){k(this).wrapAll(n?e.call(this,t):r?i.cloneNode(!0):i)})},wrapAll:function(e){if(this[0]){k(this[0]).before(e=k(e));for(var t;(t=e.children()).length;)e=t.first();k(e).append(this)}return this},wrapInner:function(e){var n=t(e);return this.each(function(t){var i=k(this),r=i.contents(),o=n?e.call(this,t):e;r.length?r.wrapAll(o):i.append(o)})},unwrap:function(){return this.parent().each(function(){k(this).replaceWith(k(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var t=k(this);(e===S?"none"==t.css("display"):e)?t.show():t.hide()})},prev:function(e){return k(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return k(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return 0 in arguments?this.each(function(t){var n=this.innerHTML;k(this).empty().append(v(this,e,t,n))}):0 in this?this[0].innerHTML:null},text:function(e){return 0 in arguments?this.each(function(t){var n=v(this,e,t,this.textContent);this.textContent=null==n?"":""+n}):0 in this?this.pluck("textContent").join(""):null},attr:function(e,t){var n;return"string"!=typeof e||1 in arguments?this.each(function(n){if(1===this.nodeType)if(r(e))for(C in e)y(this,C,e[C]);else y(this,e,v(this,t,n,this.getAttribute(e)))}):0 in this&&1==this[0].nodeType&&null!=(n=this[0].getAttribute(e))?n:S},removeAttr:function(e){return this.each(function(){1===this.nodeType&&e.split(" ").forEach(function(e){y(this,e)},this)})},prop:function(e,t){return e=X[e]||e,1 in arguments?this.each(function(n){this[e]=v(this,t,n,this[e])}):this[0]&&this[0][e]},removeProp:function(e){return e=X[e]||e,this.each(function(){delete this[e]})},data:function(e,t){var n="data-"+e.replace(L,"-$1").toLowerCase(),i=1 in arguments?this.attr(n,t):this.attr(n);return null!==i?_(i):S},val:function(e){return 0 in arguments?(null==e&&(e=""),this.each(function(t){this.value=v(this,e,t,this.value)})):this[0]&&(this[0].multiple?k(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(e){if(e)return this.each(function(t){var n=k(this),i=v(this,e,t,n.offset()),r=n.offsetParent().offset(),o={top:i.top-r.top,left:i.left-r.left};"static"==n.css("position")&&(o.position="relative"),n.css(o)});if(!this.length)return null;if(D.documentElement!==this[0]&&!k.contains(D.documentElement,this[0]))return{top:0,left:0};var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(t,n){if(arguments.length<2){var i=this[0];if("string"==typeof t){if(!i)return;return i.style[T(t)]||Zepto.getComputedStyle(i,"").getPropertyValue(t)}if(Y(t)){if(!i)return;var r={},o=Zepto.getComputedStyle(i,"");return k.each(t,function(e,t){r[t]=i.style[T(t)]||o.getPropertyValue(t)}),r}}var s="";if("string"==e(t))n||0===n?s=c(t)+":"+d(t,n):this.each(function(){this.style.removeProperty(c(t))});else for(C in t)t[C]||0===t[C]?s+=c(C)+":"+d(C,t[C])+";":this.each(function(){this.style.removeProperty(c(C))});return this.each(function(){this.style.cssText+=";"+s})},index:function(e){return e?this.indexOf(k(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return!!e&&P.some.call(this,function(e){return this.test(b(e))},l(e))},addClass:function(e){return e?this.each(function(t){if("className"in this){E=[];var n=b(this);v(this,e,t,n).split(/\s+/g).forEach(function(e){k(this).hasClass(e)||E.push(e)},this),E.length&&b(this,n+(n?" ":"")+E.join(" "))}}):this},removeClass:function(e){return this.each(function(t){if("className"in this){if(e===S)return b(this,"");E=b(this),v(this,e,t,E).split(/\s+/g).forEach(function(e){E=E.replace(l(e)," ")}),b(this,E.trim())}})},toggleClass:function(e,t){return e?this.each(function(n){var i=k(this);v(this,e,n,b(this)).split(/\s+/g).forEach(function(e){(t===S?!i.hasClass(e):t)?i.addClass(e):i.removeClass(e)})}):this},scrollTop:function(e){if(this.length){var t="scrollTop"in this[0];return e===S?t?this[0].scrollTop:this[0].pageYOffset:this.each(t?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})}},scrollLeft:function(e){if(this.length){var t="scrollLeft"in this[0];return e===S?t?this[0].scrollLeft:this[0].pageXOffset:this.each(t?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})}},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),n=this.offset(),i=B.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(k(e).css("margin-top"))||0,n.left-=parseFloat(k(e).css("margin-left"))||0,i.top+=parseFloat(k(t[0]).css("border-top-width"))||0,i.left+=parseFloat(k(t[0]).css("border-left-width"))||0,{top:n.top-i.top,left:n.left-i.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||D.body;e&&!B.test(e.nodeName)&&"static"==k(e).css("position");)e=e.offsetParent;return e})}},k.fn.detach=k.fn.remove,["width","height"].forEach(function(e){var t=e.replace(/./,function(e){return e[0].toUpperCase()});k.fn[e]=function(r){var o,s=this[0];return r===S?n(s)?s["inner"+t]:i(s)?s.documentElement["scroll"+t]:(o=this.offset())&&o[e]:this.each(function(t){(s=k(this)).css(e,v(this,r,t,s[e]()))})}}),F.forEach(function(t,n){var i=n%2;k.fn[t]=function(){var t,r,o=k.map(arguments,function(n){var i=[];return"array"==(t=e(n))?(n.forEach(function(e){return e.nodeType!==S?i.push(e):k.zepto.isZ(e)?i=i.concat(e.get()):void(i=i.concat(V.fragment(e)))}),i):"object"==t||null==n?n:V.fragment(n)}),s=this.length>1;return o.length<1?this:this.each(function(e,t){r=i?t:t.parentNode,t=0==n?t.nextSibling:1==n?t.firstChild:2==n?t:null;var a=k.contains(D.documentElement,r);o.forEach(function(e){if(s)e=e.cloneNode(!0);else if(!r)return k(e).remove();r.insertBefore(e,t),a&&w(e,function(e){if(!(null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src)){var t=e.ownerDocument?e.ownerDocument.defaultView:window;t.eval.call(t,e.innerHTML)}})})})},k.fn[i?t+"To":"insert"+(n?"Before":"After")]=function(e){return k(e)[t](this),this}}),V.Z.prototype=m.prototype=k.fn,V.uniq=x,V.deserializeValue=_,k.zepto=V,k}();window.Zepto=Zepto,function(e){function t(e){return e._zid||(e._zid=f++)}function n(e,n,o,s){if((n=i(n)).ns)var a=r(n.ns);return(g[t(e)]||[]).filter(function(e){return e&&(!n.e||e.e==n.e)&&(!n.ns||a.test(e.ns))&&(!o||t(e.fn)===t(o))&&(!s||e.sel==s)})}function i(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function r(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function o(e,t){return e.del&&!y&&e.e in b||!!t}function s(e){return _[e]||y&&b[e]||e}function a(n,r,a,u,l,f,p){var m=t(n),h=g[m]||(g[m]=[]);r.split(/\s/).forEach(function(t){if("ready"==t)return e(document).ready(a);var r=i(t);r.fn=a,r.sel=l,r.e in _&&(a=function(t){var n=t.relatedTarget;if(!n||n!==this&&!e.contains(this,n))return r.fn.apply(this,arguments)}),r.del=f;var m=f||a;r.proxy=function(e){if(!(e=c(e)).isImmediatePropagationStopped()){e.data=u;var t=m.apply(n,e._args==d?[e]:[e].concat(e._args));return!1===t&&(e.preventDefault(),e.stopPropagation()),t}},r.i=h.length,h.push(r),"addEventListener"in n&&n.addEventListener(s(r.e),r.proxy,o(r,p))})}function u(e,i,r,a,u){var c=t(e);(i||"").split(/\s/).forEach(function(t){n(e,t,r,a).forEach(function(t){delete g[c][t.i],"removeEventListener"in e&&e.removeEventListener(s(t.e),t.proxy,o(t,u))})})}function c(t,n){return!n&&t.isDefaultPrevented||(n||(n=t),e.each(k,function(e,i){var r=n[e];t[e]=function(){return this[i]=w,r&&r.apply(n,arguments)},t[i]=S}),t.timeStamp||(t.timeStamp=Date.now()),(n.defaultPrevented!==d?n.defaultPrevented:"returnValue"in n?!1===n.returnValue:n.getPreventDefault&&n.getPreventDefault())&&(t.isDefaultPrevented=w)),t}function l(e){var t,n={originalEvent:e};for(t in e)C.test(t)||e[t]===d||(n[t]=e[t]);return c(n,e)}var d,f=1,p=Array.prototype.slice,m=e.isFunction,h=function(e){return"string"==typeof e},g={},v={},y="onfocusin"in window,b={focus:"focusin",blur:"focusout"},_={mouseenter:"mouseover",mouseleave:"mouseout"};v.click=v.mousedown=v.mouseup=v.mousemove="MouseEvents",e.event={add:a,remove:u},e.proxy=function(n,i){var r=2 in arguments&&p.call(arguments,2);if(m(n)){var o=function(){return n.apply(i,r?r.concat(p.call(arguments)):arguments)};return o._zid=t(n),o}if(h(i))return r?(r.unshift(n[i],n),e.proxy.apply(null,r)):e.proxy(n[i],n);throw new TypeError("expected function")},e.fn.bind=function(e,t,n){return this.on(e,t,n)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,n,i){return this.on(e,t,n,i,1)};var w=function(){return!0},S=function(){return!1},C=/^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,k={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(e,t,n){return this.on(t,e,n)},e.fn.undelegate=function(e,t,n){return this.off(t,e,n)},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,i,r,o){var s,c,f=this;return t&&!h(t)?(e.each(t,function(e,t){f.on(e,n,i,t,o)}),f):(h(n)||m(r)||!1===r||(r=i,i=n,n=d),r!==d&&!1!==i||(r=i,i=d),!1===r&&(r=S),f.each(function(d,f){o&&(s=function(e){return u(f,e.type,r),r.apply(this,arguments)}),n&&(c=function(t){var i,o=e(t.target).closest(n,f).get(0);if(o&&o!==f)return i=e.extend(l(t),{currentTarget:o,liveFired:f}),(s||r).apply(o,[i].concat(p.call(arguments,1)))}),a(f,t,r,i,n,c||s)}))},e.fn.off=function(t,n,i){var r=this;return t&&!h(t)?(e.each(t,function(e,t){r.off(e,n,t)}),r):(h(n)||m(i)||!1===i||(i=n,n=d),!1===i&&(i=S),r.each(function(){u(this,t,i,n)}))},e.fn.trigger=function(t,n){return t=h(t)||e.isPlainObject(t)?e.Event(t):c(t),t._args=n,this.each(function(){t.type in b&&"function"==typeof this[t.type]?this[t.type]():"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)})},e.fn.triggerHandler=function(t,i){var r,o;return this.each(function(s,a){(r=l(h(t)?e.Event(t):t))._args=i,r.target=a,e.each(n(a,t.type||t),function(e,t){if(o=t.proxy(r),r.isImmediatePropagationStopped())return!1})}),o},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return 0 in arguments?this.bind(t,e):this.trigger(t)}}),e.Event=function(e,t){h(e)||(t=e,e=t.type);var n=document.createEvent(v[e]||"Events"),i=!0;if(t)for(var r in t)"bubbles"==r?i=!!t[r]:n[r]=t[r];return n.initEvent(e,i,!0),c(n)}}(Zepto),function(e){function t(t,n,i){var r=e.Event(n);return e(t).trigger(r,i),!r.isDefaultPrevented()}function n(e,n,i,r){if(e.global)return t(n||b,i,r)}function i(t){t.global&&0==e.active++&&n(t,null,"ajaxStart")}function r(t){t.global&&!--e.active&&n(t,null,"ajaxStop")}function o(e,t){var i=t.context;if(!1===t.beforeSend.call(i,e,t)||!1===n(t,i,"ajaxBeforeSend",[e,t]))return!1;n(t,i,"ajaxSend",[e,t])}function s(e,t,i,r){var o=i.context;i.success.call(o,e,"success",t),r&&r.resolveWith(o,[e,"success",t]),n(i,o,"ajaxSuccess",[t,i,e]),u("success",t,i)}function a(e,t,i,r,o){var s=r.context;r.error.call(s,i,t,e),o&&o.rejectWith(s,[i,t,e]),n(r,s,"ajaxError",[i,r,e||t]),u(t,i,r)}function u(e,t,i){var o=i.context;i.complete.call(o,t,e),n(i,o,"ajaxComplete",[t,i]),r(i)}function c(e,t,n){if(n.dataFilter==l)return e;var i=n.context;return n.dataFilter.call(i,e,t)}function l(){}function d(e){return e&&(e=e.split(";",2)[0]),e&&(e==k?"html":e==C?"json":w.test(e)?"script":S.test(e)&&"xml")||"text"}function f(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function p(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()&&"jsonp"!=t.dataType||(t.url=f(t.url,t.data),t.data=void 0)}function m(t,n,i,r){return e.isFunction(n)&&(r=i,i=n,n=void 0),e.isFunction(i)||(r=i,i=void 0),{url:t,data:n,success:i,dataType:r}}function h(t,n,i,r){var o,s=e.isArray(n),a=e.isPlainObject(n);e.each(n,function(n,u){o=e.type(u),r&&(n=i?r:r+"["+(a||"object"==o||"array"==o?n:"")+"]"),!r&&s?t.add(u.name,u.value):"array"==o||!i&&"object"==o?h(t,u,i,n):t.add(n,u)})}var g,v,y=+new Date,b=window.document,_=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,w=/^(?:text|application)\/javascript/i,S=/^(?:text|application)\/xml/i,C="application/json",k="text/html",E=/^\s*$/,T=b.createElement("a");T.href=window.location.href,e.active=0,e.ajaxJSONP=function(t,n){if(!("type"in t))return e.ajax(t);var i,r,u=t.jsonpCallback,c=(e.isFunction(u)?u():u)||"Zepto"+y++,l=b.createElement("script"),d=window[c],f=function(t){e(l).triggerHandler("error",t||"abort")},p={abort:f};return n&&n.promise(p),e(l).on("load error",function(o,u){clearTimeout(r),e(l).off().remove(),"error"!=o.type&&i?s(i[0],p,t,n):a(null,u||"error",p,t,n),window[c]=d,i&&e.isFunction(d)&&d(i[0]),d=i=void 0}),!1===o(p,t)?(f("abort"),p):(window[c]=function(){i=arguments},l.src=t.url.replace(/\?(.+)=\?/,"?$1="+c),b.head.appendChild(l),t.timeout>0&&(r=setTimeout(function(){f("timeout")},t.timeout)),p)},e.ajaxSettings={type:"GET",beforeSend:l,success:l,error:l,complete:l,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:C,xml:"application/xml, text/xml",html:k,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,dataFilter:l},e.ajax=function(t){var n,r,u=e.extend({},t||{}),m=e.Deferred&&e.Deferred();for(g in e.ajaxSettings)void 0===u[g]&&(u[g]=e.ajaxSettings[g]);i(u),u.crossDomain||((n=b.createElement("a")).href=u.url,n.href=n.href,u.crossDomain=T.protocol+"//"+T.host!=n.protocol+"//"+n.host),u.url||(u.url=window.location.toString()),(r=u.url.indexOf("#"))>-1&&(u.url=u.url.slice(0,r)),p(u);var h=u.dataType,y=/\?.+=\?/.test(u.url);if(y&&(h="jsonp"),!1!==u.cache&&(t&&!0===t.cache||"script"!=h&&"jsonp"!=h)||(u.url=f(u.url,"_="+Date.now())),"jsonp"==h)return y||(u.url=f(u.url,u.jsonp?u.jsonp+"=?":!1===u.jsonp?"":"callback=?")),e.ajaxJSONP(u,m);var _,w=u.accepts[h],S={},C=function(e,t){S[e.toLowerCase()]=[e,t]},k=/^([\w-]+:)\/\//.test(u.url)?RegExp.$1:window.location.protocol,x=u.xhr(),P=x.setRequestHeader;if(m&&m.promise(x),u.crossDomain||C("X-Requested-With","XMLHttpRequest"),C("Accept",w||"*/*"),(w=u.mimeType||w)&&(w.indexOf(",")>-1&&(w=w.split(",",2)[0]),x.overrideMimeType&&x.overrideMimeType(w)),(u.contentType||!1!==u.contentType&&u.data&&"GET"!=u.type.toUpperCase())&&C("Content-Type",u.contentType||"application/x-www-form-urlencoded"),u.headers)for(v in u.headers)C(v,u.headers[v]);if(x.setRequestHeader=C,x.onreadystatechange=function(){if(4==x.readyState){x.onreadystatechange=l,clearTimeout(_);var t,n=!1;if(x.status>=200&&x.status<300||304==x.status||0==x.status&&"file:"==k){if(h=h||d(u.mimeType||x.getResponseHeader("content-type")),"arraybuffer"==x.responseType||"blob"==x.responseType)t=x.response;else{t=x.responseText;try{t=c(t,h,u),"script"==h?(0,eval)(t):"xml"==h?t=x.responseXML:"json"==h&&(t=E.test(t)?null:e.parseJSON(t))}catch(e){n=e}if(n)return a(n,"parsererror",x,u,m)}s(t,x,u,m)}else a(x.statusText||null,x.status?"error":"abort",x,u,m)}},!1===o(x,u))return x.abort(),a(null,"abort",x,u,m),x;var j=!("async"in u)||u.async;if(x.open(u.type,u.url,j,u.username,u.password),u.xhrFields)for(v in u.xhrFields)x[v]=u.xhrFields[v];for(v in S)P.apply(x,S[v]);return u.timeout>0&&(_=setTimeout(function(){x.onreadystatechange=l,x.abort(),a(null,"timeout",x,u,m)},u.timeout)),x.send(u.data?u.data:null),x},e.get=function(){return e.ajax(m.apply(null,arguments))},e.post=function(){var t=m.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=m.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,n,i){if(!this.length)return this;var r,o=this,s=t.split(/\s/),a=m(t,n,i),u=a.success;return s.length>1&&(a.url=s[0],r=s[1]),a.success=function(t){o.html(r?e("<div>").html(t.replace(_,"")).find(r):t),u&&u.apply(o,arguments)},e.ajax(a),this};var x=encodeURIComponent;e.param=function(t,n){var i=[];return i.add=function(t,n){e.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(x(t)+"="+x(n))},h(i,t,n),i.join("&").replace(/%20/g,"+")}}(Zepto),function(e){e.fn.serializeArray=function(){var t,n,i=[],r=function(e){if(e.forEach)return e.forEach(r);i.push({name:t,value:e})};return this[0]&&e.each(this[0].elements,function(i,o){n=o.type,(t=o.name)&&"fieldset"!=o.nodeName.toLowerCase()&&!o.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&"file"!=n&&("radio"!=n&&"checkbox"!=n||o.checked)&&r(e(o).val())}),i},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(0 in arguments)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),function(){try{getComputedStyle(void 0),Zepto.getComputedStyle=getComputedStyle}catch(t){var e=getComputedStyle;Zepto.getComputedStyle=function(t,n){try{return e(t,n)}catch(e){return null}}}}(),function(e){e.Callbacks=function(t){var n,i,r,o,s,a,u=[],c=!(t=e.extend({},t)).once&&[],l=function(e){for(n=t.memory&&e,i=!0,a=o||0,o=0,s=u.length,r=!0;u&&a<s;++a)if(!1===u[a].apply(e[0],e[1])&&t.stopOnFalse){n=!1;break}r=!1,u&&(c?c.length&&l(c.shift()):n?u.length=0:d.disable())},d={add:function(){if(u){var i=u.length,a=function(n){e.each(n,function(e,n){"function"==typeof n?t.unique&&d.has(n)||u.push(n):n&&n.length&&"string"!=typeof n&&a(n)})};a(arguments),r?s=u.length:n&&(o=i,l(n))}return this},remove:function(){return u&&e.each(arguments,function(t,n){for(var i;(i=e.inArray(n,u,i))>-1;)u.splice(i,1),r&&(i<=s&&--s,i<=a&&--a)}),this},has:function(t){return!(!u||!(t?e.inArray(t,u)>-1:u.length))},empty:function(){return s=u.length=0,this},disable:function(){return u=c=n=void 0,this},disabled:function(){return!u},lock:function(){return c=void 0,n||d.disable(),this},locked:function(){return!c},fireWith:function(e,t){return!u||i&&!c||(t=[e,(t=t||[]).slice?t.slice():t],r?c.push(t):l(t)),this},fire:function(){return d.fireWith(this,arguments)},fired:function(){return!!i}};return d}}(Zepto),function(e){function t(n){var i=[["resolve","done",e.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",e.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",e.Callbacks({memory:1})]],r="pending",o={state:function(){return r},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var n=arguments;return t(function(t){e.each(i,function(i,r){var a=e.isFunction(n[i])&&n[i];s[r[1]](function(){var n=a&&a.apply(this,arguments);if(n&&e.isFunction(n.promise))n.promise().done(t.resolve).fail(t.reject).progress(t.notify);else{var i=this===o?t.promise():this,s=a?[n]:arguments;t[r[0]+"With"](i,s)}})}),n=null}).promise()},promise:function(t){return null!=t?e.extend(t,o):o}},s={};return e.each(i,function(e,t){var n=t[2],a=t[3];o[t[1]]=n.add,a&&n.add(function(){r=a},i[1^e][2].disable,i[2][2].lock),s[t[0]]=function(){return s[t[0]+"With"](this===s?o:this,arguments),this},s[t[0]+"With"]=n.fireWith}),o.promise(s),n&&n.call(s,s),s}var n=Array.prototype.slice;e.when=function(i){var r,o,s,a=n.call(arguments),u=a.length,c=0,l=1!==u||i&&e.isFunction(i.promise)?u:0,d=1===l?i:t(),f=function(e,t,i){return function(o){t[e]=this,i[e]=arguments.length>1?n.call(arguments):o,i===r?d.notifyWith(t,i):--l||d.resolveWith(t,i)}};if(u>1)for(r=new Array(u),o=new Array(u),s=new Array(u);c<u;++c)a[c]&&e.isFunction(a[c].promise)?a[c].promise().done(f(c,s,a)).fail(d.reject).progress(f(c,o,r)):--l;return l||d.resolveWith(s,a),d.promise()},e.Deferred=t}(Zepto),function(e){function t(e,t,n,i){return Math.abs(e-t)>=Math.abs(n-i)?e-t>0?"Left":"Right":n-i>0?"Up":"Down"}function n(){f=null,y.last&&(y.el.trigger("longTap"),y={})}function i(){f&&clearTimeout(f),f=null}function r(){c&&clearTimeout(c),l&&clearTimeout(l),d&&clearTimeout(d),f&&clearTimeout(f),c=l=d=f=null,y={}}function o(e){return("touch"==e.pointerType||e.pointerType==e.MSPOINTER_TYPE_TOUCH)&&e.isPrimary}function s(e,t){return e.type=="pointer"+t||e.type.toLowerCase()=="mspointer"+t}function a(){_&&(e(document).off(v.down,m).off(v.up,h).off(v.move,g).off(v.cancel,r),e(window).off("scroll",r),r(),_=!1)}function u(u){var w,S,C,k,E=0,T=0;a(),(v=u&&"down"in u?u:"ontouchstart"in document?{down:"touchstart",up:"touchend",move:"touchmove",cancel:"touchcancel"}:"onpointerdown"in document?{down:"pointerdown",up:"pointerup",move:"pointermove",cancel:"pointercancel"}:"onmspointerdown"in document&&{down:"MSPointerDown",up:"MSPointerUp",move:"MSPointerMove",cancel:"MSPointerCancel"})&&("MSGesture"in window&&((p=new MSGesture).target=document.body,e(document).bind("MSGestureEnd",function(e){var t=e.velocityX>1?"Right":e.velocityX<-1?"Left":e.velocityY>1?"Down":e.velocityY<-1?"Up":null;t&&(y.el.trigger("swipe"),y.el.trigger("swipe"+t))})),m=function(t){(k=s(t,"down"))&&!o(t)||(C=k?t:t.touches[0],t.touches&&1===t.touches.length&&y.x2&&(y.x2=void 0,y.y2=void 0),w=Date.now(),S=w-(y.last||w),y.el=e("tagName"in C.target?C.target:C.target.parentNode),c&&clearTimeout(c),y.x1=C.pageX,y.y1=C.pageY,S>0&&S<=250&&(y.isDoubleTap=!0),y.last=w,f=setTimeout(n,b),p&&k&&p.addPointer(t.pointerId))},g=function(e){(k=s(e,"move"))&&!o(e)||(C=k?e:e.touches[0],i(),y.x2=C.pageX,y.y2=C.pageY,E+=Math.abs(y.x1-y.x2),T+=Math.abs(y.y1-y.y2))},h=function(n){(k=s(n,"up"))&&!o(n)||(i(),y.x2&&Math.abs(y.x1-y.x2)>30||y.y2&&Math.abs(y.y1-y.y2)>30?d=setTimeout(function(){y.el&&(y.el.trigger("swipe"),y.el.trigger("swipe"+t(y.x1,y.x2,y.y1,y.y2))),y={}},0):"last"in y&&(E<30&&T<30?l=setTimeout(function(){var t=e.Event("tap");t.cancelTouch=r,y.el&&y.el.trigger(t),y.isDoubleTap?(y.el&&y.el.trigger("doubleTap"),y={}):c=setTimeout(function(){c=null,y.el&&y.el.trigger("singleTap"),y={}},250)},0):y={}),E=T=0)},e(document).on(v.up,h).on(v.down,m).on(v.move,g),e(document).on(v.cancel,r),e(window).on("scroll",r),_=!0)}var c,l,d,f,p,m,h,g,v,y={},b=750,_=!1;["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){e.fn[t]=function(e){return this.on(t,e)}}),e.touch={setup:u},e(document).ready(u)}(Zepto);var LZWorkerBlobURL=null,LZBlob=null,LZWorker={compress:function(e,t){if(!LZWorkerBlobURL){try{window.URL=window.URL||window.webkitURL,LZBlob=new Blob([("("+lzWorkerFunction+")();").replace('"use strict";',"")],{type:"application/javascript"})}catch(e){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(LZBlob=new BlobBuilder).append(response),LZBlob=LZBlob.getBlob()}LZWorkerBlobURL=URL.createObjectURL(LZBlob)}var n=new Worker(LZWorkerBlobURL);n.onmessage=function(e){t(e.data)},n.postMessage({type:"compress",value:e})},decompress:function(e,t){if(!LZWorkerBlobURL){try{window.URL=window.URL||window.webkitURL,LZBlob=new Blob([("("+lzWorkerFunction+")();").replace('"use strict";',"")],{type:"application/javascript"})}catch(e){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(LZBlob=new BlobBuilder).append(response),LZBlob=LZBlob.getBlob()}LZWorkerBlobURL=URL.createObjectURL(LZBlob)}var n=new Worker(LZWorkerBlobURL);n.onmessage=function(e){t(e.data)},n.postMessage({type:"decompress",value:e})}},$=Zepto,permutive=window.permutive,PERMUTIVE_CONFIG={default:{apiHost:"api.permutive.com",apiVersion:"v2.0",apiProtocol:"",loggingEnabled:!1,useLocalStorage:!0,requestTimeout:5e3,cookieName:"permutive-id",cookieExpiry:"10 Jan 2020 23:59:59 GMT",permutiveDataKey:"permutive-data",eventsCacheKey:"permutive-events-lz",eventsCacheNoLzKey:"permutive-events-cache",useCompression:!0,runQueriesInBackground:!0,sendClientErrors:!0,storeIP:!0,exposeInternals:!1},production:{},development:{loggingEnabled:!0,sendClientErrors:!1,exposeInternals:!0}};permutive.config.cookieDomain="."+extractDomain(window.location.hostname);var wwSupport=!1;(wwSupport=hasWebWorkerSupport())||(permutive.config.useCompression=!1,permutive.config.runQueriesInBackground=!1),Object.keys(PERMUTIVE_CONFIG.default).forEach(function(e){void 0!==permutive.config[e]||(void 0!==PERMUTIVE_CONFIG[permutive.config.environment][e]?permutive.config[e]=PERMUTIVE_CONFIG[permutive.config.environment][e]:permutive.config[e]=PERMUTIVE_CONFIG.default[e])});var PermutiveCore=function(){function e(e){this.listenForBlockers=!0,this.clientErrorsSent=0,this.isReady=!1,this.isIdentityReady=!1,this.config=e}return e.prototype.getEndpointUrl=function(e){return this.config.apiProtocol+"//"+this.config.apiHost+"/"+this.config.apiVersion+e},e.prototype.utcNow=function(){var e=new Date;return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())},e.prototype.ajax=function(e){var t=this,n=e.url,i=e.method||"GET",r="";e.data&&e.jsonInParams?r={data:encodeURIComponent(JSON.stringify(e.data))}:e.data&&(r=JSON.stringify(e.data));var o=e.success,s=e.error,a=e.complete,u=e.contentType||e.jsonInParams?"application/x-www-form-urlencoded":"application/json",c=function(e){e.setRequestHeader("X-API-Key",t.config.apiKey)};return e.apiKeyInParams&&("GET"===i?(c=function(){},n+="&api_key="+this.config.apiKey):"POST"===i&&"object"==typeof r&&(c=function(){},r.api_key=this.config.apiKey)),$.ajax({type:i,url:n,contentType:u,data:r,timeout:this.config.timeout,crossDomain:!0,beforeSend:c,success:function(e){o&&o(e)},error:function(e,t,n){s&&s(t,n)},complete:function(e,t){a&&a(t)}})},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.config.loggingEnabled&&window.console&&window.console.log&&(e.splice(0,0,"[Permutive]"),console.log.apply(console,e))},e.prototype.error=function(e){if(this.config.sendClientErrors){if(this.clientErrorsSent>3)return;this.clientErrorsSent+=1;var t={user_id:void 0!==_internals.state?_internals.state.userId:"",domain:window.location.hostname?window.location.hostname:"",url:window.location.href?window.location.href:"",referrer:document.referrer?document.referrer:"",user_agent:navigator.userAgent?navigator.userAgent:"",error_message:"",stack_trace:"",additional_details:""};e instanceof Error?(void 0!==e.message&&(t.error_message=e.message.toString()),void 0!==e.stack&&(t.stack_trace=e.stack.toString())):t.additional_details=e.toString(),this.ajax({url:this.getEndpointUrl("/internal/errors"),method:"POST",data:t,apiKeyInParams:!0,jsonInParams:!0})}else window.console&&(window.console.error?window.console.error("[Permutive]",e):window.console.log&&window.console.log("[Permutive]",e))},e.prototype.metrics=function(e,t){void 0===t&&(t=1),this.ajax({url:this.getEndpointUrl("/internal/metrics"),method:"POST",data:{name:e,value:t},apiKeyInParams:!0,jsonInParams:!0})},e.prototype.createUser=function(e){e({id:_internals.randomUuid()})},e.prototype.applyQueue=function(){for(var e=[],t=[],n=[],i=[],r=[],o=0;o<permutive.q.length;o++)"identify"===(a=permutive.q[o]).functionName?e.push(a):"trigger"===a.functionName?t.push(a):"addon"===a.functionName?n.push(a):"track"===a.functionName?i.push(a):r.push(a);for(var s=e.concat(t).concat(n).concat(i).concat(r),o=0;o<s.length;o++){var a=s[o];a.functionName in permutive?permutive[a.functionName].apply(permutive,a.arguments):this.error('Function "permutive.'+a.functionName+'" does not exist.')}},e.prototype.defineEntities=function(){},e.prototype.setAsReady=function(){this.isReady=!0,$(window).trigger("permutive:ready")},e.prototype.setIdentityReady=function(){this.isIdentityReady=!0,$(window).trigger("permutive:identity:ready")},e.prototype.addBlocker=function(e){var t=this;_internals.blockers.push(e),this.log("<blockers> added blocker "+e),$(window).on(e,function(){if(t.listenForBlockers){var n=_internals.blockers.indexOf(e);n>=0&&(_internals.blockers.splice(n,1),t.log("<blockers> removed blocker "+e)),0===_internals.blockers.length&&(t.listenForBlockers=!1,$(window).trigger("permutive:blockers:empty"),t.log("<blockers> complete"))}})},e.prototype.setCookie=function(e,t){return!!(t&&e&&this.config.cookieExpiry&&this.config.cookieDomain)&&(document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+"; expires="+this.config.cookieExpiry+"; domain="+this.config.cookieDomain+"; path=/",!0)},e.prototype.getCookie=function(e){var t=new RegExp(encodeURIComponent(e)+"=([^;]+)").exec(document.cookie);return null!==t?decodeURIComponent(t[1]):null},e.prototype.deleteCookie=function(e){return!(!e||!this.config.cookieDomain)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain="+this.config.cookieDomain+"; path=/",!0)},e.prototype.randomUuid=function(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})},e.prototype.arraysEqual=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0},e}(),_internals=new PermutiveCore(permutive.config);_internals.$=$,_internals.addons={};var PermutiveEvent=function(){function e(e){this.id=e}return e.prototype.setName=function(e){this.name=e},e.prototype.setTime=function(e){this.time=e},e.prototype.setSessionId=function(e){this.session_id=e},e.prototype.setProperties=function(e){this.properties=e},e}(),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),PermutiveCache=function(){function e(e){}return e.prototype.parseProperties=function(e){var t={};return $.each(e,function(e,n){var i=n;"string"==typeof n&&n.match(ISO8601_REGEX)&&(i=new Date(n)),t[e]=i}),t},e}(),PermutiveEventsCache=function(e){function t(){var t=e.call(this,null)||this;return t.initialised=!1,t.lastRefreshed=null,t.localStorageAtCapacity=!1,t.cache=[],t.limit=2500,t}return __extends(t,e),t.prototype.all=function(){for(var e=[],t=0;t<this.cache.length;t++)e.push(this.cache[t].event);return e},t.prototype.add=function(e,t){for(var n=this.createEvent(e),i=(t=t||{shouldCache:!1}).shouldCache||!1,r=!1,o=0;o<this.cache.length;o++)if(this.cache[o].event.id===n.id){r=!0;break}if(r)_internals.log("The event already exists!"),n=void 0;else{for(;-1!==this.limit&&this.cache.length>=this.limit;)this.cache.shift();this.cache.push({event:n,eventJson:e,shouldCache:i})}return n},t.prototype.createEvent=function(e){var t=new PermutiveEvent(e.id);return t.setName(e.name),t.setTime(new Date(e.time)),e.session_id&&t.setSessionId(e.session_id),t.setProperties(this.parseProperties(e.properties||{})),t},t.prototype.write=function(e){if(permutive.config.useLocalStorage){for(var t=[],n=0;n<this.cache.length;n++)this.cache[n].shouldCache&&t.push(this.cache[n].eventJson);try{permutive.config.useCompression?LZWorker.compress(JSON.stringify(t),function(t){localStorage.setItem(permutive.config.eventsCacheKey,t.result),"function"==typeof e&&e()}):(localStorage.setItem(permutive.config.eventsCacheNoLzKey,JSON.stringify(t)),"function"==typeof e&&e())}catch(e){e.message="Unable to write events to local storage: "+e.message,_internals.error(e)}}},t.prototype.load=function(){var e=this,t=function(t){for(var n=0;n<t.length;n++){var i=t[n];e.add(i,{shouldCache:!0})}var r=function(){e.initialised=!0,$(window).trigger("permutive:events:cache:loaded")};if(e.localStorageAtCapacity){_internals.log("reducing cache size by 10%, due to local storage limit reached");for(var o=e.cache.length;e.cache.length>.9*o;)e.cache.shift();e.write(r)}else r()};if(permutive.config.useLocalStorage){var n=[];if(permutive.config.useCompression){var i=permutive.config.eventsCacheNoLzKey;if(null!==localStorage.getItem(i)){var r=localStorage.getItem(i);LZWorker.compress(r,function(e){localStorage.setItem(permutive.config.eventsCacheKey,e.result),localStorage.removeItem(i),n=r?JSON.parse(r):[],t(n)})}else(s=localStorage.getItem(permutive.config.eventsCacheKey))?LZWorker.decompress(s,function(e){n=e.result?JSON.parse(e.result):[],t(n)}):t([])}else{var o=permutive.config.eventsCacheKey;if(null!==localStorage.getItem(o)){var s=localStorage.getItem(o);LZWorker.decompress(s,function(e){localStorage.setItem(permutive.config.eventsCacheNoLzKey,e.result),localStorage.removeItem(o),n=e.result?JSON.parse(e.result):[],t(n)})}else{var a=localStorage.getItem(permutive.config.eventsCacheNoLzKey);n=a?JSON.parse(a):[],t(n)}}}else t([])},t.prototype.refresh=function(e){var t=this;(e=e||{}).from=e.from||this.lastRefreshed,e.from||(e.from=this.getRefreshFromTime(),_internals.log("refreshing from: ",e.from)),this.lastRefreshed=e.from||_internals.utcNow(),e.write=void 0===e.write||e.write;_internals.api.events(_internals.state.userId,{success:function(n){for(var i=[],r=n||[],o=0;o<r.length;o++){var s=r[o],a=t.add(s,{shouldCache:!0});a&&i.push(a)}_internals.log("events from api: ",r),_internals.log("events cache: ",_internals.state.eventsCache.cache),e.write&&t.write(),e.success&&e.success(i)},error:e.error,complete:e.complete,from:e.from})},t.prototype.reset=function(){permutive.config.useLocalStorage&&localStorage.removeItem(permutive.config.eventsCacheKey),this.cache=[],this.initialised=!0,this.lastRefreshed=null},t.prototype.getRefreshFromTime=function(){for(var e=null,t=this.cache.length-1;t>=0;t--){var n=this.cache[t];if(n.shouldCache){e=n.event.time;break}}return e&&e.setMilliseconds(e.getMilliseconds()+1),e},t}(PermutiveCache),CACHED_SEGMENTS_COOKIE_NAME="_psegs",PermutiveQueryDescriptor=function(){return function(e,t,n,i,r,o,s){this.id=e,this.code=t,this.name=n,this.isSegment=i,this.isNew=r,this.hasRunCache=o,this.initialResult=s}}(),PermutiveQuery=function(){function e(e,t,n){var i=this;this.id=e,this.query=t,this.isNew=n;var r=function(){return new Date},o=function(){return _internals.sessionManager.getSessionId()};this.effects={getCurrentTime:r,getCurrentSession:o,getThirdPartySegments:function(){return{}},setThirdPartyActivation:function(e,t){}},this.effectsWithTpd={getCurrentTime:r,getCurrentSession:o,getThirdPartySegments:function(){return _internals.thirdParty.getSegments()},setThirdPartyActivation:function(e,t){e in i.thirdPartyActivations?-1!==i.thirdPartyActivations[e].indexOf(t)||i.thirdPartyActivations[e].push(t):i.thirdPartyActivations[e]=[t]}},this.reset()}return e.prototype.reset=function(){this.thirdPartyActivations={},this.state=this.query.initial(this.effects),this.history=[],this.queue=[],this.hasRunCache=!1},e.prototype.update=function(e,t){if(t=t||{},t.fromCache=t.fromCache||!1,this.hasRunCache||t.fromCache){var n=this.result(this.hasRunCache);try{this.state=this.query.update(this.effects,this.state,e);var i=this.result(this.hasRunCache);(this.hasRunCache||!_internals.state.isFirstVisitOnDevice&&this.isNew)&&!t.forceSkipNotify&&(this.areResultsEqual(n,i)||$(window).trigger("permutive:internal:query:changed",[this,i]))}catch(e){e.message="Skipping event causing runtime error: "+e.message,_internals.error(e)}this.history.push(e.id)}else this.queue.push(e)},e.prototype.setReady=function(){var e=this;this.hasRunCache=!0;var t=this.queue;this.queue=[],t.forEach(function(t){return e.update(t)})},e.prototype.initialResult=function(){return this.query.result(this.effects,this.query.initial(this.effects))},e.prototype.result=function(e){return this.query.result(e?this.effectsWithTpd:this.effects,this.state)},e.prototype.areResultsEqual=function(e,t){var n=!0;for(var i in e)if(!(n=n&&e[i]===t[i]))break;return n},e}(),PermutiveQueryManager=function(){function e(e){var t=this;this.state=e,this.rawQueries=function(){var e=function(e,t,n){return{initial:function(t){var n={};for(var i in e)n[i]=e[i].initial(t);return n},update:function(n,i,r){if(!t(r))return i;var o={};for(var s in e)o[s]=i[s],o[s]=e[s].update(n,o[s],r);return o},result:function(t,i){var r={};for(var o in e)r[o]=e[o].result(t,i[o]);return n(t,r)}}},t=function(e){var t=Object.prototype.toString.call(e);return"[object Array]"===t?"array":"[object Object]"===t?"object":"[object String]"===t?"string":"[object Number]"===t?"number":"[object Boolean]"===t?"boolean":"[object Null]"===t?"null":"[object Date]"===t?"date":"undefined"},n=function(e,t){return"string"==typeof e&&null!=e&&"string"==typeof t&&null!=t&&t.toLowerCase().indexOf(e.toLowerCase())>-1},i=function(e,t,n){var i=e.getCurrentTime();return null===t||null===i?null:i.getTime()-t.getTime()<=n},r=function(e){return e.getCurrentSession()},o={number:{add:function(e,t){return e+t},sub:function(e,t){return e-t},mul:function(e,t){return e*t},div:function(e,t){return e/t},lt:function(e,t){return e<t},gt:function(e,t){return e>t},lte:function(e,t){return e<=t},gte:function(e,t){return e>=t}},util:{nullSafe:function(e,t,n){return null===t||null===n?null:e(t,n)}}},s={"05163b1d-03de-4f93-b61d-e1f650cf944d":e({result:e({0:{initial:function(e){return 0},update:function(e,i,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.session_id)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&"string"===t(s.session_id)&&t(s.session_id)===t(s.session_id)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===s.name&&s.session_id===r(e)&&n("utm_medium=social",s.properties.client.url)?1:0):i},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)})},function(e){return!0},function(e,t){return t}),"10271e10-a4fe-46a3-8892-e9a68ee91966":e({result:e({0:{initial:function(e){return 0},update:function(e,r,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.time)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&t(s.time)===t(s.time)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)?o.util.nullSafe(o.number.add,r,"Pageview"===s.name&&i(e,s.time,6048e5)&&n("business",s.properties.client.url)?1:0):r},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],3)})},function(e){return!0},function(e,t){return t}),"1b88b39b-4be7-4d2e-8f44-3f4f62423db9":e({result:e({0:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.url)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.url)&&t(r.properties.client.url)===t(r.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===r.name&&n("hotels-resorts-spas",r.properties.client.url)?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"object"===t(i.properties)&&"undefined"!==t(i.properties.segment_name)&&"string"===t(i.name)&&t(i.name)===t(i.name)&&"string"===t(i.properties.segment_name)&&t(i.properties.segment_name)===t(i.properties.segment_name)?o.util.nullSafe(o.number.add,n,"SegmentEntry"===i.name&&"EliteTraveler"===i.properties.segment_name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)&&o.util.nullSafe(o.number.gte,t[1],1)})},function(e){return!0},function(e,t){return t}),"25d061af-a299-4395-91d1-52a2a8aa109f":e({result:e({0:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"string"===t(i.name)&&t(i.name)===t(i.name)?o.util.nullSafe(o.number.add,n,"Pageview"===i.name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)})},function(e){return!0},function(e,t){return t}),"4e445742-b2c3-43cf-831e-6efdfc0b6c3f":e({result:e({0:{initial:function(e){return 0},update:function(e,i,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.session_id)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&"string"===t(s.session_id)&&t(s.session_id)===t(s.session_id)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===s.name&&s.session_id===r(e)&&n("utm_medium=email",s.properties.client.url)?1:0):i},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)})},function(e){return!0},function(e,t){return t}),"5a7235d9-5a9e-4fff-a5db-aec0863e4597":e({result:e({0:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.referrer)&&"undefined"!==t(r.properties.client.url)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.referrer)&&t(r.properties.client.referrer)===t(r.properties.client.referrer)&&"string"===t(r.properties.client.url)&&t(r.properties.client.url)===t(r.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===r.name&&(n("newstatesman.com/long-reads",r.properties.client.referrer)||n("newstatesman.com/long-reads",r.properties.client.url))?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.referrer)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.referrer)&&t(r.properties.client.referrer)===t(r.properties.client.referrer)?o.util.nullSafe(o.number.add,i,"LinkClick"===r.name&&n("newstatesman.com/long-reads",r.properties.client.referrer)?1:0):i},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)||o.util.nullSafe(o.number.gte,t[1],1)})},function(e){return!0},function(e,t){return t}),"61543bc3-8d72-43e6-8688-63a1fbc2b4b3":e({result:e({0:{initial:function(e){return 0},update:function(e,n,r){return"undefined"!==t(r.name)&&"undefined"!==t(r.time)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&t(r.time)===t(r.time)?o.util.nullSafe(o.number.add,n,"PageviewEngagement"===r.name&&i(e,r.time,2592e6)?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],12)})},function(e){return!0},function(e,t){return t}),"68ff61ca-2244-4866-8a18-dd3e00494b6e":e({result:e({0:{initial:function(e){return 0},update:function(e,r,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.time)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"undefined"!==t(s.properties.client.domain)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&t(s.time)===t(s.time)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)&&"string"===t(s.properties.client.domain)&&t(s.properties.client.domain)===t(s.properties.client.domain)?o.util.nullSafe(o.number.add,r,"Pageview"===s.name&&i(e,s.time,24192e5)&&n("politic",s.properties.client.url)&&n("newstatesman",s.properties.client.domain)?1:0):r},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],3)})},function(e){return!0},function(e,t){return t}),"6dba9647-a73f-4651-8e60-a38bb2de3b42":e({result:e({0:{initial:function(e){return 0},update:function(e,i,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.session_id)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&"string"===t(s.session_id)&&t(s.session_id)===t(s.session_id)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===s.name&&s.session_id===r(e)&&n("utm_source=twitter.com",s.properties.client.url)?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"object"===t(i.properties)&&"undefined"!==t(i.properties.segment_name)&&"string"===t(i.name)&&t(i.name)===t(i.name)&&"string"===t(i.properties.segment_name)&&t(i.properties.segment_name)===t(i.properties.segment_name)?o.util.nullSafe(o.number.add,n,"SegmentEntry"===i.name&&"Social Traffic"===i.properties.segment_name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)&&o.util.nullSafe(o.number.gte,t[1],1)})},function(e){return!0},function(e,t){return t}),"6de40117-6867-4dd2-b66a-0761b9c34dc1":e({result:e({0:{initial:function(e){return 0},update:function(e,n,r){return"undefined"!==t(r.name)&&"undefined"!==t(r.time)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&t(r.time)===t(r.time)?o.util.nullSafe(o.number.add,n,"Pageview"===r.name&&i(e,r.time,2592e6)?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],3)})},function(e){return!0},function(e,t){return t}),"8ff37adc-bfe3-45bf-bb84-a397f505e8b8":e({result:e({0:{initial:function(e){return 0},update:function(e,n,r){return"undefined"!==t(r.name)&&"undefined"!==t(r.time)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&t(r.time)===t(r.time)?o.util.nullSafe(o.number.add,n,"PageviewEngagement"===r.name&&i(e,r.time,2592e6)?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],6)})},function(e){return!0},function(e,t){return t}),"a1ce530d-c6f0-4f3b-a4d0-35f7f07c3614":e({result:e({0:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.url)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.url)&&t(r.properties.client.url)===t(r.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===r.name&&n("luxury-transport",r.properties.client.url)?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"object"===t(i.properties)&&"undefined"!==t(i.properties.segment_name)&&"string"===t(i.name)&&t(i.name)===t(i.name)&&"string"===t(i.properties.segment_name)&&t(i.properties.segment_name)===t(i.properties.segment_name)?o.util.nullSafe(o.number.add,n,"SegmentEntry"===i.name&&"EliteTraveler"===i.properties.segment_name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)&&o.util.nullSafe(o.number.gte,t[1],1)})},function(e){return!0},function(e,t){return t}),"a5eb161c-950c-4a34-8818-b76e9d9efb9f":e({result:e({0:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.title)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.title)&&t(r.properties.client.title)===t(r.properties.client.title)?o.util.nullSafe(o.number.add,i,"Pageview"===r.name&&n("security",r.properties.client.title)?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"string"===t(i.name)&&t(i.name)===t(i.name)?o.util.nullSafe(o.number.add,n,"PageviewEngagement"===i.name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)&&o.util.nullSafe(o.number.gte,t[1],12)})},function(e){return!0},function(e,t){return t}),"a6d84eea-8e80-4479-82e8-abf79fc02281":e({result:e({0:{initial:function(e){return 0},update:function(e,i,s){return"undefined"!==t(s.name)&&"undefined"!==t(s.session_id)&&"object"===t(s.properties)&&"object"===t(s.properties.client)&&"undefined"!==t(s.properties.client.url)&&"string"===t(s.name)&&t(s.name)===t(s.name)&&"string"===t(s.session_id)&&t(s.session_id)===t(s.session_id)&&"string"===t(s.properties.client.url)&&t(s.properties.client.url)===t(s.properties.client.url)?o.util.nullSafe(o.number.add,i,"Pageview"===s.name&&s.session_id===r(e)&&n("utm_source=facebook.com",s.properties.client.url)?1:0):i},result:function(e,t){return t}},1:{initial:function(e){return 0},update:function(e,n,i){return"undefined"!==t(i.name)&&"object"===t(i.properties)&&"undefined"!==t(i.properties.segment_name)&&"string"===t(i.name)&&t(i.name)===t(i.name)&&"string"===t(i.properties.segment_name)&&t(i.properties.segment_name)===t(i.properties.segment_name)?o.util.nullSafe(o.number.add,n,"SegmentEntry"===i.name&&"Social Traffic"===i.properties.segment_name?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)&&o.util.nullSafe(o.number.gte,t[1],1)})},function(e){return!0},function(e,t){return t}),"d09aff6a-78a9-4c4b-a403-d2b56a43c02f":e({result:e({0:{initial:function(e){return 0},update:function(e,n,r){return"undefined"!==t(r.name)&&"undefined"!==t(r.time)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&t(r.time)===t(r.time)?o.util.nullSafe(o.number.add,n,"Pageview"===r.name&&i(e,r.time,2592e6)?1:0):n},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],5)})},function(e){return!0},function(e,t){return t}),"e433e384-842e-4272-88dc-867eb6a7b1e3":e({result:e({0:{initial:function(e){return 0},update:function(e,i,r){return"undefined"!==t(r.name)&&"object"===t(r.properties)&&"object"===t(r.properties.client)&&"undefined"!==t(r.properties.client.domain)&&"string"===t(r.name)&&t(r.name)===t(r.name)&&"string"===t(r.properties.client.domain)&&t(r.properties.client.domain)===t(r.properties.client.domain)?o.util.nullSafe(o.number.add,i,"Pageview"===r.name&&n("elitetraveler",r.properties.client.domain)?1:0):i},result:function(e,t){return t}}},function(e){return!0},function(e,t){return o.util.nullSafe(o.number.gte,t[0],1)})},function(e){return!0},function(e,t){return t})};return void 0!==s?s:{}}(),this.queries={},this.descriptors={},this.userSegments=[],this.userSegmentsDict={},this.activations={},this.readSegmentsFromCookie(),$(window).on("permutive:internal:query:changed",function(e,n,i){var r=t.descriptors[n.id];$(window).trigger("permutive:query:changed",[r,i])}),$(window).on("permutive:queries:update",function(e,n,i){if($.each(n,function(e,n){$.each(t.queries,function(e,t){t.update(n,i)})}),!0===i.fromCache){var r=!1;$.each(t.queries,function(e,n){var o=n.result(!0),s=t.descriptors[n.id];for(var a in n.thirdPartyActivations)if(n.thirdPartyActivations.hasOwnProperty(a)&&void 0!==_internals.thirdParty.getSegments()[a])for(var u=n.thirdPartyActivations[a],c=0;c<u.length;c++)s.code in t.activations||(t.activations[s.code]=[]),t.activations[s.code].push({segment_id:s.code,data_provider_id:a,data_provider_segment_id:u[c]});if(s.isSegment){var l=!1;if(!_internals.state.isFirstVisitOnDevice&&s.isNew){var d=s.initialResult.result;o.result!==d&&(i.forceSkipNotify||(_internals.log("Firing segment transition event for new segment "+s.code+", as initial state "+d+" not equal to current state "+o.result),t.trackSegmentTransition(o,s)),l=!0)}else(o.result&&!(s.code in t.userSegmentsDict)||!o.result&&s.code in t.userSegmentsDict)&&(i.forceSkipNotify||(_internals.log("Firing segment transition event for "+s.code+", as current state "+o.result+" differs from cached state "+(s.code in t.userSegmentsDict)),t.trackSegmentTransition(o.result,s)),l=!0);l&&(o.result?t.addSegmentToCache(s.code):t.removeSegmentFromCache(s.code),r=!0)}n.setReady(),t.descriptors[n.id].hasRunCache=!0}),r&&(t.writeSegmentsToCookie(),$(window).trigger("permutive:segments:updated")),$(window).trigger("permutive:queries:initialised")}})}return e.prototype.reset=function(){$.each(this.queries,function(e,t){t.reset()}),$.each(this.queries,function(e,t){t.hasRunCache=!1}),_internals.deleteCookie(CACHED_SEGMENTS_COOKIE_NAME),this.userSegments=[],this.userSegmentsDict={}},e.prototype.update=function(e,t){(t=t||{}).forceSkipNotify=t.forceSkipNotify||!1,$(window).trigger("permutive:queries:update",[e,t])},e.prototype.load=function(){var e=this,t={"5a7235d9-5a9e-4fff-a5db-aec0863e4597":{code:2637,name:"NewStatesman_long-read-enthusiasts",is_segment:!0},"25d061af-a299-4395-91d1-52a2a8aa109f":{code:2491,name:"Everyone",is_segment:!0},"61543bc3-8d72-43e6-8688-63a1fbc2b4b3":{code:2495,name:"Engaged_Time_60s+_30Days",is_segment:!0},"e433e384-842e-4272-88dc-867eb6a7b1e3":{code:2646,name:"EliteTraveler",is_segment:!0},"d09aff6a-78a9-4c4b-a403-d2b56a43c02f":{code:2493,name:"Engaged_Pageviews_5+_30Days",is_segment:!0},"05163b1d-03de-4f93-b61d-e1f650cf944d":{code:2650,name:"Social Traffic",is_segment:!0},"4e445742-b2c3-43cf-831e-6efdfc0b6c3f":{code:2655,name:"Email Traffic",is_segment:!0},"10271e10-a4fe-46a3-8892-e9a68ee91966":{code:2631,name:"High Engaged Business Interest",is_segment:!0},"a5eb161c-950c-4a34-8818-b76e9d9efb9f":{code:2482,name:"Interests: Security",is_segment:!0},"a6d84eea-8e80-4479-82e8-abf79fc02281":{code:2651,name:"Social Traffic_Facebook",is_segment:!0},"6dba9647-a73f-4651-8e60-a38bb2de3b42":{code:2652,name:"Social Traffic_Twitter",is_segment:!0},"68ff61ca-2244-4866-8a18-dd3e00494b6e":{code:2584,name:"Interest_Politics_NewStatesman",is_segment:!0},"1b88b39b-4be7-4d2e-8f44-3f4f62423db9":{code:2648,name:"EliteTraveler_Hotels Resorts & Spas",is_segment:!0},"a1ce530d-c6f0-4f3b-a4d0-35f7f07c3614":{code:2647,name:"EliteTraveler_Luxury Transport",is_segment:!0},"8ff37adc-bfe3-45bf-bb84-a397f505e8b8":{code:2494,name:"Engaged_Time_30s+_30Days",is_segment:!0},"6de40117-6867-4dd2-b66a-0761b9c34dc1":{code:2492,name:"Engaged_Pageviews_3+_30Days",is_segment:!0}},n={},i=this.state.getPermutiveData("active_queries");void 0===i&&(i={}),$.each(this.rawQueries,function(r,o){var s=t[r],a=!(s.code in i),u=new PermutiveQuery(s.code,o,a),c=new PermutiveQueryDescriptor(r,s.code,s.name,s.is_segment,a,!1,u.initialResult());e.descriptors[s.code]=c,e.queries[s.code]=u,n[c.code]=1,c.isSegment&&function(t){permutive.trigger(t.name,"result",function(n){_internals.log("Firing segment transition event for "+t.code+", as result has changed to "+n.result),e.trackSegmentTransition(n.result,t),n.result?e.addSegmentToCache(t.code):e.removeSegmentFromCache(t.code),e.writeSegmentsToCookie(),$(window).trigger("permutive:segments:updated")})}(c)}),$.each(this.userSegments,function(t,i){i in n||e.removeSegmentFromCache(i)}),e.writeSegmentsToCookie(),e.state.setPermutiveData("active_queries",n)},e.prototype.handleResult=function(e,t){var n=this.queries[e];n&&t(n.result())},e.prototype.getQueryDescriptor=function(e){return this.descriptors[e]},e.prototype.getQueryDescriptorById=function(e){var t=void 0;return $.each(this.descriptors,function(n,i){if(i.id===e)return t=i,!1}),t},e.prototype.trackSegmentTransition=function(e,t){var n=e?"SegmentEntry":"SegmentExit",i={segment_id:t.id,segment_number:t.code,segment_name:t.name};permutive.track(n,i)},e.prototype.addSegmentToCache=function(e){this.userSegmentsDict[e]||(this.userSegments.push(e),this.userSegmentsDict[e]=1)},e.prototype.removeSegmentFromCache=function(e){if(e in this.userSegmentsDict){delete this.userSegmentsDict[e];var t=this.userSegments.indexOf(e);t>-1&&this.userSegments.splice(t,1)}},e.prototype.writeSegmentsToCookie=function(){var e=JSON.stringify(this.userSegments);_internals.setCookie(CACHED_SEGMENTS_COOKIE_NAME,e)},e.prototype.readSegmentsFromCookie=function(){var e=this,t=_internals.getCookie(CACHED_SEGMENTS_COOKIE_NAME);t&&(this.userSegments=JSON.parse(t),this.userSegments.forEach(function(t){e.userSegmentsDict[t]=1}))},e}(),AsyncPermutiveQueryManager=function(){function e(e){var t=this;this.state=e,this.descriptors={},this.results={},this.userSegments=[],this.userSegmentsDict={},this.activations={},this.readSegmentsFromCookie(),this.hasRunCache=!1,this.workerMessageHandlers={setQueryDescriptors:makeSafe(function(e){var n={};$.each(e,function(e,i){var r=new PermutiveQueryDescriptor(i.id,i.code,i.name,i.isSegment,i.isNew,i.hasRunCache,i.initialResult);n[r.code]=1,t.results[r.code]=r.initialResult,t.descriptors[r.code]=r,r.isSegment&&function(e){permutive.trigger(e.code,"result",function(n){_internals.log("Firing segment transition event for "+e.code+", as result has changed to "+n.result),t.trackSegmentTransition(n.result,e),n.result?t.addSegmentToCache(e.code):t.removeSegmentFromCache(e.code),t.writeSegmentsToCookie(),$(window).trigger("permutive:segments:updated")})}(r)}),t.userSegments.forEach(function(e){e in n||t.removeSegmentFromCache(e)}),t.writeSegmentsToCookie(),t.state.setPermutiveData("active_queries",n)}),queryResultChanges:makeSafe(function(e){var n=e.changes,i=e.options,r=!1,o={};$.each(n,function(e,n){var s=n.result,a=n.descriptor;o[a.code]=1;for(var u in n.activations)if(n.activations.hasOwnProperty(u)&&void 0!==_internals.thirdParty.getSegments()[u])for(var c=n.activations[u],l=0;l<c.length;l++)a.code in t.activations||(t.activations[a.code]=[]),t.activations[a.code].push({segment_id:a.code,data_provider_id:u,data_provider_segment_id:c[l]});if(t.results[a.code]=s,t.descriptors[a.code]=a,!t.hasRunCache&&a.isSegment){var d=!1;if(!_internals.state.isFirstVisitOnDevice&&a.isNew){var f=a.initialResult.result;s.result!==f&&(i.forceSkipNotify||(_internals.log("Firing segment transition event for new segment "+a.code+", as initial state "+f+" not equal to current state "+s.result),t.trackSegmentTransition(s.result,a)),d=!0)}else(s.result&&!(a.code in t.userSegmentsDict)||!s.result&&a.code in t.userSegmentsDict)&&(i.forceSkipNotify||(_internals.log("Firing segment transition event for "+a.code+", as current state "+s.result+" differs from cached state "+(a.code in t.userSegmentsDict)),t.trackSegmentTransition(s.result,a)),d=!0);d&&(s.result?t.addSegmentToCache(a.code):t.removeSegmentFromCache(a.code),r=!0)}(t.hasRunCache||!_internals.state.isFirstVisitOnDevice&&a.isNew)&&!i.forceSkipNotify&&$(window).trigger("permutive:query:changed",[a,s])}),t.hasRunCache||($.each(t.descriptors,function(e,n){!n.isSegment||e in o||(n.initialResult.result&&!(n.code in t.userSegmentsDict)||!n.initialResult.result&&n.code in t.userSegmentsDict)&&(i.forceSkipNotify||(_internals.log("Firing segment transition event for "+n.code+", as initial state "+n.initialResult.result+" differs from cached state "+(n.code in t.userSegmentsDict)),t.trackSegmentTransition(n.initialResult.result,n)),n.initialResult.result?t.addSegmentToCache(n.code):t.removeSegmentFromCache(n.code),t.writeSegmentsToCookie(),r=!0)}),t.hasRunCache=!0,r&&(t.writeSegmentsToCookie(),$(window).trigger("permutive:segments:updated")),$(window).trigger("permutive:queries:initialised"))}),logErrors:function(e){$.each(e,function(e,t){_internals.error(t)})}};var n=new Blob([("("+queryWorkerFunction+")();").replace('"use strict";',"")],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(n)),this.worker.onmessage=function(e){"thirdPartySegments"!==e.data.type&&t.workerMessageHandlers[e.data.type].apply(t,[e.data.value])},this.worker.postMessage({type:"thirdPartySegments",arguments:[_internals.thirdParty.getSegments()]})}return e.prototype.reset=function(){var e=this;this.worker.postMessage({type:"resetQueries"}),$.each(this.descriptors,function(t,n){n.hasRunCache=!1,e.results[n.code]=n.initialResult}),_internals.deleteCookie(CACHED_SEGMENTS_COOKIE_NAME),this.userSegments=[],this.userSegmentsDict={},this.hasRunCache=!1},e.prototype.update=function(e,t){var n=this;(t=t||{}).forceSkipNotify=t.forceSkipNotify||!1,n.worker.postMessage({type:"updateQueries",arguments:[e,t]})},e.prototype.load=function(){var e=this,t=this.state.getPermutiveData("active_queries");void 0===t&&(t={}),e.worker.postMessage({type:"buildQueryDescriptors",arguments:[t,_internals.sessionManager.getSessionId()]})},e.prototype.handleResult=function(e,t){var n=this.descriptors[e];n&&t(this.results[n.code])},e.prototype.getQueryDescriptor=function(e){return this.descriptors[e]},e.prototype.getQueryDescriptorById=function(e){var t=void 0;return $.each(this.descriptors,function(n,i){if(i.id===e)return t=i,!1}),t},e.prototype.trackSegmentTransition=function(e,t){var n=e?"SegmentEntry":"SegmentExit",i={segment_id:t.id,segment_number:t.code,segment_name:t.name};permutive.track(n,i)},e.prototype.addSegmentToCache=function(e){this.userSegmentsDict[e]||(this.userSegments.push(e),this.userSegmentsDict[e]=1)},e.prototype.removeSegmentFromCache=function(e){if(e in this.userSegmentsDict){delete this.userSegmentsDict[e];var t=this.userSegments.indexOf(e);t>-1&&this.userSegments.splice(t,1)}},e.prototype.writeSegmentsToCookie=function(){var e=JSON.stringify(this.userSegments);_internals.setCookie(CACHED_SEGMENTS_COOKIE_NAME,e)},e.prototype.readSegmentsFromCookie=function(){var e=this,t=_internals.getCookie(CACHED_SEGMENTS_COOKIE_NAME);t&&(this.userSegments=JSON.parse(t),this.userSegments.forEach(function(t){e.userSegmentsDict[t]=1}))},e}(),PermutiveReaction=function(){function e(e,t,n,i,r,o,s){this.id=e,this.segmentCode=t,this.segmentName=n,this.reactionType=i,this.triggerType=r,this.variantId=o,this.config=s}return e.prototype.reactEveryTime=function(){return"EveryTime"===this.triggerType},e.prototype.reactOnEntry=function(){return"OnEntry"===this.triggerType},e.prototype.reactOnExit=function(){return"OnExit"===this.triggerType},e.prototype.trackImpression=function(e){var t={reaction_id:this.id,variant_id:this.variantId,type:"impression"};permutive.track("Reaction",t,e),_internals.log("impression: ",t)},e.prototype.trackConversion=function(e){var t={reaction_id:this.id,variant_id:this.variantId,type:"conversion"};permutive.track("Reaction",t,e),_internals.log("conversion: ",t)},e}(),PermutiveReactionManager=function(){function e(e){this.reactionsConfig=[{id:"37aee398-718a-4804-83c9-a1fc29776cb6",reaction_type:"run_script",trigger_type:"EveryTime",variants:[{segment_id:"25d061af-a299-4395-91d1-52a2a8aa109f",config:{script:"window._pCbCallback = function(response) {\n\tif (response) {\n  \tpermutive.track(\"Clearbit\", response);\n\t}\n}\t\nvar cbs = document.createElement('script');\ncbs.setAttribute('src','https://reveal.clearbit.com/v1/companies/reveal?authorization=pk_201753247e822160eeb27b99aa5c608b&callback=_pCbCallback');\ndocument.body.appendChild(cbs);\t"},id:"be65ac83-fb3a-43bf-af80-81dd16a605ea",start_bucket:0,context_criteria:{criteria:[{key:"url",value:"globaldata.com",comparison:"CONTAINS"}],operator:"AND"}}]},{id:"d59f79c7-bb3b-4448-8a55-0b4e900bc655",reaction_type:"run_script",trigger_type:"EveryTime",variants:[{id:"f2f9b7a1-ddd9-4d26-b79c-749f8e7ccfc1",segment_id:"25d061af-a299-4395-91d1-52a2a8aa109f",start_bucket:0,config:{script:'var trackHighestBids = function() {\n  try {\n    if (pbjs) {\n      var allBids = pbjs.getBidResponses();\n      var winningBids = pbjs.getAllWinningBids();\n\n      var winningBidAdIds = {};\n      for (var i = 0; i < winningBids.length; i++) {\n        winningBidAdIds[winningBids[i].adId] = 1;\n      }\n\n      var bids = [];\n      for (slot in allBids) {\n        var sb = allBids[slot].bids;\n        var slotBids = sb.sort(function(a, b) {\n          return (b.cpm || 0) - (a.cpm || 0);\n        });\n        for (i = 0; i < slotBids.length && i < 5; i++) {\n          var bid = slotBids[i];\n          if (bid.cpm && bid.cpm > 0) {\n            var obj = {};\n            if (bid.adId) obj["ad_id"] = bid.adId;\n            if (bid.adUnitCode) obj["ad_unit_code"] = bid.adUnitCode;\n            if (bid.bidder) obj["bidder"] = bid.bidder;\n            if (bid.dealId) obj["deal_id"] = bid.dealId;\n            if (bid.cpm) obj["cpm"] = bid.cpm;\n            if (bid.adserverTargeting && bid.adserverTargeting.hb_pb) obj["hb_pb"] = bid.adserverTargeting.hb_pb;\n            if (bid.height) obj["height"] = parseInt(bid.height);\n            if (bid.width) obj["width"] = parseInt(bid.width);\n            if (bid.timeToRespond) obj["time_to_respond"] = bid.timeToRespond;\n            obj["bid_available"] = (bid.statusMessage && bid.statusMessage.indexOf("empty") < 0);\n            if (obj["bid_available"]) obj["winning_bid"] = (bid.adId && bid.adId in winningBidAdIds);\n            bids.push(obj);\n\n            if (obj["winning_bid"]) {\n\t\t\t\t\t\t\tvar objBid = {};\n\t            if (bid.adId) objBid["ad_id"] = bid.adId;\n\t            if (bid.adUnitCode) objBid["ad_unit_code"] = bid.adUnitCode;\n\t            if (bid.bidder) objBid["bidder"] = bid.bidder;\n\t            if (bid.dealId) objBid["deal_id"] = bid.dealId;\n\t            if (bid.cpm) objBid["cpm"] = bid.cpm;\n\t            if (bid.adserverTargeting && bid.adserverTargeting.hb_pb) objBid["hb_pb"] = bid.adserverTargeting.hb_pb;\n\t            if (bid.height) objBid["height"] = parseInt(bid.height);\n\t            if (bid.width) objBid["width"] = parseInt(bid.width);\n\t            if (bid.timeToRespond) objBid["time_to_respond"] = bid.timeToRespond;\n\t            objBid["bid_available"] = (bid.statusMessage && bid.statusMessage.indexOf("empty") < 0);\n\t            if (objBid["bid_available"]) objBid["winning_bid"] = (bid.adId && bid.adId in winningBidAdIds);\n\t\n              permutive.track("PrebidWinningBid", objBid)\n            }\n\n          }\n        }\n      }\n\n      permutive.track("PrebidBids", {bids: bids});\n    }\n  } catch (e) { /*ignore*/ }\n}\nsetTimeout(trackHighestBids, 5000);'}}]}],this.state=e,this.reactions={},this.hasher=function(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}}return e.prototype.load=function(){for(var e=0;e<this.reactionsConfig.length;e++){var t=this.reactionsConfig[e];this.reactions[t.reaction_type]?this.reactions[t.reaction_type].push(t):this.reactions[t.reaction_type]=[t]}},e.prototype.evaluateContextCriteria=function(e){for(var t=0;t<e.criteria.length;t++){var n=function(e){var t=permutive.context[e.key];return void 0!==t&&("EQUALS"===e.comparison?t===e.value:"NOT_EQUALS"===e.comparison?t!==e.value:"CONTAINS"===e.comparison?t.indexOf(e.value)>=0:"NOT_CONTAINS"===e.comparison&&t.indexOf(e.value)<0)}(e.criteria[t]);if("AND"===e.operator&&!n)return!1;if("OR"===e.operator&&n)return!0}return"AND"===e.operator},e.prototype.selectVariant=function(e,t){if(1==t.length)return t[0];var n=this.state.userId+e,i=Math.abs(this.hasher(n))%12e4;t.sort(function(e,t){return e.start_bucket-t.start_bucket});var r=t.findIndex(function(e){return i<e.start_bucket});return t[r>=0?r-1:t.length-1]},e.prototype.getReactions=function(e){var t=[];if(this.reactions[e])for(var n=0;n<this.reactions[e].length;n++){var i=this.reactions[e][n],r=this.selectVariant(i.id,i.variants);if(r){var o=this.state.queryManager.getQueryDescriptorById(r.segment_id);if(o){var s=r.context_criteria;s&&!this.evaluateContextCriteria(s)||t.push(new PermutiveReaction(i.id,o.code,o.name,i.reaction_type,i.trigger_type,r.id,r.config))}}}return t},e}(),PermutiveTaskQueue=function(){function e(){var e=this;this.queue=[],this.nextNotify=null,$(window).on("permutive:taskQueue:update",function(){e.execute()})}return e.prototype.test=function(){this.queue=[];var e=new Task(function(e){window.setTimeout(function(){console.log("a timeout"),e()},1e3)},{description:"a"}),t=new Task(function(e){window.setTimeout(function(){console.log("b timeout"),e()},1e3)},{wait_prev:!0,block_next:!0,description:"b"}),n=new Task(function(e){window.setTimeout(function(){console.log("c timeout"),e()},1e3)},{description:"c"}),i=new Task(function(e){window.setTimeout(function(){console.log("d timeout"),e()},1e3)},{description:"d"});this.add(e),this.add(t),this.add(n),this.add(i),this.execute()},e.prototype.test2=function(){var e=this;e.queue=[];var t=new Task(function(e){window.setTimeout(function(){console.log("a timeout"),e()},1e3)},{description:"a"});e.add(t),e.execute()},e.prototype.add=function(e){this.queue.push(e),this.notify()},e.prototype.notify=function(){var e=function(){$(window).trigger("permutive:taskQueue:update")},t=(new Date).getTime();null===this.nextNotify||this.nextNotify<t-50?(this.nextNotify=t,e()):this.nextNotify<=t&&(this.nextNotify=t+50,window.setTimeout(e,50))},e.prototype.execute=function(){var e=this;if(0!=this.queue.length){for(var t=!1,n=!1,i=0,r=0;r<this.queue.length;r++){var o=this.queue[r];if(o.complete)i+=1;else if(o.started)n=!0,t=t||o.blocks();else{if(o.waits()&&n)break;t||(n=!0,t=t||o.blocks(),o.execute(function(){e.notify()}))}}this.queue.splice(0,i)}},e.prototype.size=function(){return this.queue.length},e}(),Task=function(){function e(e,t){void 0===t&&(t={}),this.wait_prev=t.wait_prev||!1,this.block_next=t.block_next||!1,this.description=t.description||"",this.started=!1,this.complete=!1,this.task=e}return e.prototype.waits=function(){return this.wait_prev},e.prototype.blocks=function(){return this.block_next},e.prototype.execute=function(e){var t=this;this.started=!0,this.task(function(){t.complete=!0,e()})},e}(),SessionManager=function(){function e(e){(e=e||{}).timeout_seconds=e.timeout_seconds||1800,e.session_data_key=e.session_data_key||"permutive-session",this.options=e,this.session_id=null,this.initialize()}return e.prototype.getSessionId=function(){return this.session_id},e.prototype.newSession=function(e){return{session_id:_internals.randomUuid(),last_updated:e}},e.prototype.initialize=function(){var e=new Date,t=_internals.getCookie(this.options.session_data_key),n=this.decodeSessionData(t);if(null===n)n=this.newSession(e);else{var i=this.options.timeout_seconds;e>new Date(n.last_updated.getTime()+1e3*i)?n=this.newSession(e):n.last_updated=e}this.persistSessionData(n),this.session_id=n.session_id},e.prototype.decodeSessionData=function(e){var t=null;try{t=JSON.parse(e)}catch(e){return null}return null!==t&&"object"==typeof t&&t.hasOwnProperty("session_id")&&t.hasOwnProperty("last_updated")&&(t.last_updated=new Date(t.last_updated),!isNaN(t.last_updated.getTime()))?t:null},e.prototype.persistSessionData=function(e){e.last_updated=e.last_updated.toISOString(),_internals.setCookie(this.options.session_data_key,JSON.stringify(e))},e}(),ISO8601_REGEX=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,PERMUTIVE_DATA_COOKIE="_pdata",PermutiveState=function(){function e(){this.eventsCache=new PermutiveEventsCache,this.taskQueue=new PermutiveTaskQueue;var e="modernizr";try{localStorage.setItem(e,e),localStorage.removeItem(e)}catch(e){_internals.error(e),void 0!==e.message&&e.message.toString().toLowerCase().indexOf("quota")>-1?this.eventsCache.localStorageAtCapacity=!0:permutive.config.useLocalStorage=!1}if(permutive.config.useLocalStorage){t=localStorage.getItem(permutive.config.permutiveDataKey);this.permutiveData=null===t?{}:JSON.parse(t)}else{var t=_internals.getCookie(PERMUTIVE_DATA_COOKIE);this.permutiveData=null===t?{}:JSON.parse(t)}this.userId=this.getUserId(),this.isFirstVisitOnDevice=null===this.userId,this.pageviewId=_internals.randomUuid(),this.eventsCache.load(),this.reactionManager=new PermutiveReactionManager(this),this.reactionManager.load()}return e.prototype.initQueryManager=function(){permutive.config.runQueriesInBackground?this.queryManager=new AsyncPermutiveQueryManager(this):this.queryManager=new PermutiveQueryManager(this),this.queryManager.load()},e.prototype.reset=function(){this.queryManager.reset(),this.eventsCache.reset();var e=this.getPermutiveData("active_queries");this.permutiveData={},_internals.deleteCookie(permutive.config.cookieName),permutive.config.useLocalStorage?localStorage.removeItem(permutive.config.permutiveDataKey):_internals.deleteCookie(PERMUTIVE_DATA_COOKIE),this.setPermutiveData("active_queries",e)},e.prototype.getUserId=function(){var e=_internals.getCookie(permutive.config.cookieName);return e},e.prototype.setUserId=function(e){_internals.setCookie(permutive.config.cookieName,e),this.userId=e},e.prototype.getPermutiveData=function(e){return this.permutiveData[e]},e.prototype.setPermutiveData=function(e,t){this.permutiveData[e]=t,permutive.config.useLocalStorage?localStorage.setItem(permutive.config.permutiveDataKey,JSON.stringify(this.permutiveData)):_internals.setCookie(PERMUTIVE_DATA_COOKIE,JSON.stringify(this.permutiveData))},e.prototype.getPageviewId=function(){return this.pageviewId},e.prototype.getClient=function(){var e="";return e=document.title?document.title:"",{type:"web",user_agent:navigator.userAgent?navigator.userAgent:"",url:window.location.href?window.location.href:"",domain:window.location.hostname?window.location.hostname:"",title:e,referrer:document.referrer?document.referrer:""}},e}(),PermutiveApi=function(){function e(){}return e.prototype.identify=function(e,t,n){if(void 0===n&&(n={}),_internals.isIdentityReady){_internals.identities.addAlias(e,t);var i=_internals.identities.currentAliases;this.sendIdentify(_internals.state.userId,i,n).done(function(e){return _internals.identities.storeAliases(i)})}else _internals.identities.addAlias(e,t)},e.prototype.sendIdentify=function(e,t,n){void 0===n&&(n={});var i={default:0},r=function(e){return"default"===e?0:e in i?i[e]+1:1},o={user_id:e,aliases:function(e){return Object.keys(e).map(function(t){return{id:e[t],tag:t,priority:r(t)}})}(t)};return _internals.ajax({url:_internals.getEndpointUrl("/identify"),method:"POST",data:o,success:n.success,error:n.error,complete:n.complete})},e.prototype.setUserProperties=function(e,t){return void 0===t&&(t={}),_internals.ajax({url:_internals.getEndpointUrl("/users/"+_internals.state.userId+"/properties"),method:"POST",data:{properties:e},success:t.success,error:t.error,complete:t.complete})},e.prototype.track=function(e,t,n,i,r){void 0===r&&(r={});var o=n||{};r.includeClient=(r.includeClient,!0),r.includeClient&&(o.client=_internals.state.getClient());var s={user_id:e,name:t,segments:_internals.state.queryManager.userSegments,properties:o};return null!==i&&(s.session_id=i),_internals.ajax({url:_internals.getEndpointUrl("/events"),method:"POST",data:s,success:function(e){r.success&&r.success(e)},error:function(e,t){r.error&&r.error(t)},complete:r.complete,apiKeyInParams:!0,jsonInParams:!0})},e.prototype.events=function(e,t){void 0===t&&(t={});var n=_internals.getEndpointUrl("/events")+"?user_id="+e;return t.from&&(n+="&from="+t.from.toISOString()),_internals.ajax({url:n,method:"GET",success:function(e){t.success&&t.success(e)},error:function(e,n){t.error&&t.error(n)},complete:t.complete,apiKeyInParams:!0,contentType:"text/plain"})},e.prototype.tpd=function(e,t){void 0===t&&(t={});var n=_internals.getEndpointUrl("/tpd");return _internals.ajax({url:n,method:"POST",data:{user_id:e},success:function(e){t.success&&t.success(e)},error:function(e,n){t.error&&t.error(n)},complete:t.complete,apiKeyInParams:!0,jsonInParams:!0})},e}(),PermutiveMethods=function(){function e(){}return e.prototype.identify=function(e,t){if(void 0===t&&(t={}),_internals.log("<call> identify",e),"string"!=typeof e||null===e||""===e)throw new Error("Identify must be called with a non-empty string, value passed was '"+e+"'");if(_internals.api){_internals.state.taskQueue.add(new Task(function(n){_internals.log("<task> identify ",e),t=t||{};var i=_internals.state.userId,r={success:function(r){var o=r.user_id;if(o!==i){var s={error:function(){_internals.error("couldn't retrieve events for user "+o)},complete:function(){_internals.state.queryManager.update(_internals.state.eventsCache.all(),{fromCache:!0,forceSkipNotify:!0}),_internals.log("<done> identify",e),n()}};_internals.state.reset(),_internals.state.setUserId(o),_internals.state.eventsCache.refresh(s)}else _internals.log("<done> identify ",e),n();Object.keys(t).length>0&&_internals.api.setUserProperties(t,{success:function(e){_internals.log("Set user properties successfully",e)},error:function(e){_internals.error("Failed to set user properties with reason: "+e)}})},error:function(){_internals.error("Couldn't set identity for user "+i),n()}};_internals.api.identify(e,"default",r)},{wait_prev:!0,block_next:!0}))}else _internals.error("The API hasn't been loaded.")},e.prototype.track=function(e,t,n){if(void 0===n&&(n={}),_internals.log("<call> track",e),_internals.api){var i=n.success;_internals.state.taskQueue.add(new Task(function(r){_internals.log("<task> track",e),n.success=function(e){var t=_internals.state.eventsCache.add(e);_internals.state.queryManager.update([t]),i&&i(t)},n.complete=function(){_internals.log("<done> track",e),r()};var o=_internals.sessionManager.getSessionId();_internals.api.track(_internals.state.userId,e,t,o,n)}))}else _internals.error("The API hasn't been loaded.")},e.prototype.trigger=function(e,t,n){_internals.log("<call> trigger",e),_internals.triggerListeners=_internals.triggerListeners||[];_internals.state.taskQueue.add(new Task(function(t){_internals.log("<task> trigger",e);var i=$(window).on("permutive:query:changed",function(t,i,r){i.code===e&&n(r)});_internals.triggerListeners.push(i),_internals.log("<done> trigger",e),t()}))},e.prototype.query=function(e,t){_internals.log("<call> query",e);_internals.state.taskQueue.add(new Task(function(n){_internals.log("<task> query",e),_internals.state.queryManager.handleResult(e,t),_internals.log("<done> query",e),n()}))},e.prototype.segment=function(e,t){_internals.log("<call> segment",e);_internals.state.taskQueue.add(new Task(function(n){_internals.log("<task> segment",e),_internals.state.queryManager.handleResult(e,function(n){if("boolean"!=typeof n.result)throw new Error("Segment "+e+" is missing boolean result property");t(n.result)}),_internals.log("<done> segment",e),n()}))},e.prototype.segments=function(e,t){void 0===t&&(t="all"),_internals.log("<call> segments");_internals.state.taskQueue.add(new Task(function(n){_internals.log("<task> segments ("+t+")");var i=function(i){e(i),_internals.log("<done> segments ("+t+")"),n()};"dfp"===t?void 0!==_internals.addons.dfp&&_internals.addons.dfp.isReady?i(_internals.addons.dfp.liveSegments):$(window).one("permutive:dfp:ready",function(){i(_internals.addons.dfp.liveSegments)}):i(_internals.state.queryManager.userSegments)}))},e.prototype.reset=function(){_internals.createUser(function(e){_internals.state.reset(),_internals.state.setUserId(e.id);_internals.state.eventsCache.refresh({complete:function(){_internals.state.queryManager.update(_internals.state.eventsCache.all(),{fromCache:!0})}}),$(window).trigger("permutive:reset")})},e.prototype.addon=function(e,t){if(_internals.addons[e])"web"===e&&!0!==t.auto_init&&_internals.addons[e].reset(t);else switch(e){case"web":_internals.addons.web=new WebAddon(t);break;case"publishers":_internals.addons.publishers=new PublishersAddon(t);break;case"overlays":_internals.addons.overlays=new OverlaysAddon(t);break;case"scriptrunner":_internals.addons.scriptrunner=new ScriptRunnerAddon(t);break;case"dfp":_internals.addons.dfp=new DFPAddon(t);break;case"freewheel":_internals.addons.freewheel=new FreeWheelAddon(t);break;case"gigya":_internals.addons.gigya=new GigyaAddon(t);break;case"facebook_pixel":_internals.addons.facebook_pixel=new FacebookPixelAddon(t);break;case"eyeota_pixel":_internals.addons.eyeota_pixel=new EyeotaPixelAddon(t);break;case"pubmatic":_internals.addons.pubmatic=new PubMaticAddon(t);break;case"tradedesk":_internals.addons.tradedesk=new TradeDeskAddon(t);break;case"rubicon":_internals.addons.rubicon=new RubiconAddon(t);break;case"aol":_internals.addons.aol=new AOLAddon(t);break;case"lotame":_internals.addons.lotame=new LotameAddon(t)}},e.prototype.ready=function(e){_internals.isReady?e():$(window).on("permutive:ready",function(){e()})},e}(),__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s},PermutiveIdentities=function(){function e(){this.identities=_internals.state.getPermutiveData("identities")||{},this.previousAliases=_internals.state.getPermutiveData("aliases")||{},this.currentAliases=_internals.state.getPermutiveData("aliases")||{},this.providers={}}return e.prototype.setIdentity=function(e,t,n){void 0===n&&(n=86400),this.identities[e]={value:t,expiry:Date.now()+Math.floor(1e3*n)},_internals.state.setPermutiveData("identities",this.identities)},e.prototype.getIdentity=function(e){return e in this.identities?[!0,this.identities[e].value]:[!1,void 0]},e.prototype.getIdentities=function(e){var t=this;return void 0===e&&(e=!1),Object.keys(this.identities).reduce(function(n,i){var r=__read(t.getIdentity(i),2),o=(r[0],r[1]);return void 0!==o&&(e&&!t.getProvider(i).usedForThirdPartyData()||(n[i]=o)),n},{})},e.prototype.hasExpired=function(e){return!(e in this.identities)||Date.now()>=this.identities[e].expiry},e.prototype.registerProvider=function(e){this.providers[e.getTag()]=e},e.prototype.getProvider=function(e){return e in this.providers?this.providers[e]:(_internals.error("Identity provider "+e+" is not registered."),null)},e.prototype.retrieveIdentityIfNeeded=function(e){var t=this,n=$.Deferred(),i=this.getProvider(e);if(null===i)return n.resolve(void 0),n.promise();var r=__read(this.getIdentity(e),2),o=r[0],s=r[1],a=!o||this.hasExpired(e);return!o||a?i.getId().done(function(e){t.setIdentity(i.getTag(),e,i.getTtlInSeconds()),n.resolve(e)}):n.resolve(s),n.promise()},e.prototype.retrieveAllIdentities=function(){var e=this,t=Object.keys(this.providers).map(function(t){var n=$.Deferred(),i=__read(e.getIdentity(t),2),r=i[0],o=i[1];return r?n.resolve(o):e.retrieveIdentityIfNeeded(t).done(function(e){n.resolve(e)}),n.done(function(e){void 0!==e&&_internals.api.identify(e,t)}),n.promise()});return $.when.apply($,t)},e.prototype.addAlias=function(e,t){this.currentAliases[t]=e},e.prototype.storeAliases=function(e){_internals.state.setPermutiveData("aliases",e)},e.prototype.areAliasesEqual=function(e,t){var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(var r=0;r<n.length;r++){var o=n[r];if(!(o in t))return!1;if(t[o]!==e[o])return!1}return!0},e}(),PermutiveThirdParty=function(){function e(){this.userSegments=_internals.state.getPermutiveData("third-party-data")||{expiry_time:Date.now()-1,segments:{}},this.ttlInSeconds=86400}return e.prototype.fireThirdPartySegmentEvent=function(){var e=this,t=new Date(_internals.state.getPermutiveData("date_tpd_segment_event_sent")||null);(Date.now()-t.getTime())/864e5>=30&&(Object.keys(this.userSegments.segments).forEach(function(t){permutive.track("ThirdPartySegments",{data_provider:t,segments:Object.keys(e.userSegments.segments[t])})}),_internals.state.setPermutiveData("date_tpd_segment_event_sent",Date.now()))},e.prototype.segments=function(){var e=$.Deferred();if(Date.now()<this.userSegments.expiry_time)return e.resolve(this.userSegments.segments),e.promise();var t=this,n=_internals.identities.getIdentities(!0);return Object.keys(n).length>0?_internals.api.tpd(n,{success:function(n){var i=t.convertSegments(n),r=Date.now()+Math.floor(1e3*t.ttlInSeconds);t.userSegments.expiry_time=r,t.updateCache(i),e.resolve(i)},error:function(t){_internals.error("Third Party Data segments retrieval failed with reason: "+t),e.resolve({})}}):e.resolve({}),e.promise()},e.prototype.addSegments=function(e,t){var n={};n[e]=t;var i=this.convertSegments(n);this.updateCache(i)},e.prototype.getSegments=function(){return this.userSegments.segments},e.prototype.updateCache=function(e){this.userSegments.segments=this.merge(this.userSegments.segments,e),_internals.state.setPermutiveData("third-party-data",this.userSegments)},e.prototype.convertSegments=function(e){return Object.keys(e).reduce(function(t,n){var i=e[n];return t[n]=i.reduce(function(e,t){return e[t]=!0,e},{}),t},{})},e.prototype.merge=function(e,t){return[e,t].reduce(function(e,t){return Object.keys(t).forEach(function(n){e[n]=t[n]}),e},{})},e}();permutive.addons=_internals.addons;var makeSafe=function(e){return function(){try{return e.apply(this,arguments)}catch(e){_internals.error(e)}}};try{_internals.sessionManager=new SessionManager,_internals.state=new PermutiveState,_internals.api=new PermutiveApi,_internals.identities=new PermutiveIdentities,_internals.thirdParty=new PermutiveThirdParty,permutive.context=permutive.context||{},permutive.context.path=window.location.pathname,permutive.context.url=window.location.href,permutive.context.referrer=document.referrer,_internals.blockers=[],_internals.addBlocker("permutive:queries:initialised");var scripts=[];$.each(scripts,function(i,script){try{eval(script)}catch(e){e.message="Error running custom script ["+i+"]"+e.message,_internals.error(e)}}),permutive.q.push({functionName:"addon",arguments:["web",{auto_init:!0}]});var WebAddon=function(){function e(e){var t=this,e=e||{};this.eventInterval=e.eventInterval||5,this.addAlchemyTaxonomy={auto_init:!0}.add_alchemy_taxonomy,this.addAlchemyEntities={auto_init:!0}.add_alchemy_entities,this.page=e.page||null,this.sendPageviewEvent(),this.dirtyState=!1;var n=function(e){t.dirtyState=!0};(e.dirtyEvents||["mousemove","click","scroll"]).map(function(e){$(window).on(e,n)}),this.totalCompletion=0,this.timerHandle=setInterval(this.sendEngagementEvent(this.eventInterval,this.getCompletion),1e3*this.eventInterval),$("a").click(makeSafe(this.sendLinkClickEvent)),$("form").submit(makeSafe(this.sendFormSubmissionEvent))}return e.prototype.sendPageviewEvent=function(){var e={visit_id:_internals.state.getPageviewId(),isp_info:"$ip_isp_info",geo_info:"$ip_geo_info",alchemy:void 0};if(permutive.config.storeIP&&(e.ip_address="$ip_address"),!0===permutive.context.isArticle&&(this.addAlchemyTaxonomy||this.addAlchemyEntities)){var t={};this.addAlchemyTaxonomy&&(t.taxonomy_labels="$alchemy_taxonomy_labels"),this.addAlchemyEntities&&(t.entity_names="$alchemy_entity_names"),e.alchemy=t}null!==this.page&&$.extend(e,this.page),permutive.track("Pageview",e)},e.prototype.getCompletion=function(){var e=$(document).height(),t=$(window).scrollTop()+$(window).height();return t<=0?0:t>=e?1:t/e},e.prototype.sendEngagementEvent=function(e,t){var n=this;return makeSafe(function(){if(n.dirtyState){var i={visit_id:_internals.state.getPageviewId(),engaged_time:e},r=Math.max(n.totalCompletion,t());i.completion=r-n.totalCompletion,n.totalCompletion=r,n.dirtyState=!1,null!==n.page&&$.extend(i,n.page),permutive.track("PageviewEngagement",i)}})},e.prototype.reset=function(e){_internals.state.pageviewId=_internals.randomUuid(),this.page=e.page||null,this.totalCompletion=0,this.sendPageviewEvent(),clearInterval(this.timerHandle),this.timerHandle=setInterval(this.sendEngagementEvent(this.eventInterval,this.getCompletion),1e3*this.eventInterval)},e}();WebAddon.prototype.sendLinkClickEvent=function(){window.location.href&&this.href&&permutive.track("LinkClick",{dest_url:this.href})},WebAddon.prototype.sendFormSubmissionEvent=function(e){var t=function(e){var t,n,i={},r=function(e){if(e.forEach)return e.forEach(r);e&&e.length<=120&&(i[t]=e.toString())};return e[0]&&$.each($(e)[0].elements,function(e,i){n=i.type,(t=i.name||i.id)||"email"!=n||(t=n);var o=!1;t&&t.toLowerCase().indexOf("email"),!o&&t&&"fieldset"!=i.nodeName.toLowerCase()&&!i.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&"file"!=n&&"password"!=n&&("radio"!=n&&"checkbox"!=n||i.checked)&&r($(i).val())}),i}(e.currentTarget),n=[];for(var i in t)n.push({name:i,value:t[i]});var r={method:this.method||"GET",properties:n};this.id&&(r.id=this.id),this.name&&(r.name=this.name),this.action&&(r.action=this.action),permutive.track("FormSubmission",{form:r})},permutive.q.unshift({functionName:"addon",arguments:["overlays",{}]});var OverlaysAddon=function(){function e(e){var t=this;this.reactions=_internals.state.reactionManager.getReactions("show_overlay"),this.loadedImageCounts={};for(var n=this,i=0;i<this.reactions.length;i++)!function(e){var i=n.reactions[e],r=i.config;$(n.buildOverlayCss(r,e)).appendTo("head");var o=$(n.buildOverlayBody(r,e)).appendTo("body");!function(e){e.find(".close").first().click(function(){e.css({visibility:"hidden",opacity:0})})}(o),function(e,t){e.find("a").slice(1).on("click",function(e){var n=this.href;t.trackConversion({success:function(){window.location.href=n}}),e.preventDefault()}),e.find("form").one("submit",function(e){e.preventDefault(),function(e){t.trackConversion({success:function(){e.submit()}})}(e.currentTarget)})}(o,i);var s=function(e,n){t.showOverlay(e),n.trackImpression()};!function(e,t){t.reactEveryTime()?permutive.query(t.segmentCode,makeSafe(function(n){n.result?s(e,t):permutive.trigger(t.segmentCode,"result",function(n){n.result&&s(e,t)})})):t.reactOnEntry()?permutive.trigger(t.segmentCode,"result",makeSafe(function(n){n.result&&s(e,t)})):t.reactOnExit()&&permutive.trigger(t.segmentCode,"result",makeSafe(function(n){n.result||s(e,t)}))}("permutive-overlay-"+e,i)}(i)}return e.prototype.buildOverlayCss=function(e,t){return'<style type="text/css">.${overlay_class}{position:fixed;top:0;bottom:0;left:0;right:0;width:100%;height:100%;background:rgba(0,0,0,0.${opacity_percentage});transition:opacity ${opacity_transition_ms}ms;visibility:hidden;opacity:0;z-index:1000000;}.${modal_class}{position:fixed;padding:10px;background:#fff;border-radius:5px;z-index:1000001}.${modal_class} .content{overflow:auto;z-index:1000002;}.${modal_class} .close{position:absolute;top:20px;right:30px;transition:all 200ms;font-size:30px;font-weight:bold;text-decoration:none;color:#333;z-index:1000003}.${modal_class} .close:hover{color:orange;}</style>'.replace(/\${overlay_class}/g,"permutive-overlay-"+t).replace(/\${modal_class}/g,"permutive-modal-"+t).replace("${opacity_percentage}",e.opacity_percentage).replace("${opacity_transition_ms}",e.opacity_transition_ms)},e.prototype.buildOverlayBody=function(e,t){var n="";return e.html?n=e.html:e.image_url&&e.image_link&&(n='<a href="'+e.image_link+'"><img src="'+e.image_url+'"/></a>'),'<div id="${overlay_class}" class="${overlay_class}"><div id="${modal_class}" class="${modal_class}"><a class="close" href="javascript:;">&times;</a><div class="content">${content}</div></div></div>'.replace(/\${overlay_class}/g,"permutive-overlay-"+t).replace(/\${modal_class}/g,"permutive-modal-"+t).replace("${content}",n).replace(/<img /g,"<img onload='window.permutive.addons.overlays.loadedImage(\"permutive-overlay-"+t+"\")' ")},e.prototype.showOverlay=function(e){var t=this,n=$("#"+e),i=function(){var e=n.find("div").first();e.css({left:$(window).width()/2-e.width()/2+"px",top:$(window).height()/2-e.height()/2+"px"}),n.css({visibility:"visible",opacity:1})},r=n.find("img");if(r.length>0){var o=0,s=function(){o<10&&(!(e in t.loadedImageCounts)||t.loadedImageCounts[e]<r.length)?(o+=1,setTimeout(s,500)):i()};s()}else i()},e.prototype.loadedImage=function(e){e in this.loadedImageCounts?this.loadedImageCounts[e]=this.loadedImageCounts[e]+1:this.loadedImageCounts[e]=1},e}();permutive.q.unshift({functionName:"addon",arguments:["scriptrunner",{}]});var ScriptRunnerAddon=function(options){this.reactions=_internals.state.reactionManager.getReactions("run_script");for(var i=0;i<this.reactions.length;i++){var reaction=this.reactions[i],run=function(reaction){var script=reaction.config.script.replace(/impression\(\)/g,"reaction.trackImpression();").replace(/conversion\(\)/g,"reaction.trackConversion();");try{eval(script)}catch(e){e.message="Error running custom script: "+e.message,_internals.error(e)}};!function(e){e.reactEveryTime()?permutive.query(e.segmentCode,function(t){t.result?run(e):permutive.trigger(e.segmentCode,"result",function(t){t.result&&run(e)})}):e.reactOnEntry()?permutive.trigger(e.segmentCode,"result",function(t){t.result&&run(e)}):e.reactOnExit()&&permutive.trigger(e.segmentCode,"result",function(t){t.result||run(e)})}(reaction)}};$(window).one("permutive:blockers:empty",makeSafe(function(){var e=new PermutiveMethods;$.extend(permutive,e),permutive.config.exposeInternals&&$.extend(permutive,_internals),_internals.setAsReady(),_internals.applyQueue(),delete permutive.q,$(window).trigger("permutive:queue:executed")}));var initEventCache=makeSafe(function(){return $.Deferred(function(e){_internals.log("Initing event cache..."),_internals.state.eventsCache.initialised?(_internals.log("resolved already"),e.resolve()):$(window).one("permutive:events:cache:loaded",function(){_internals.log("resolved later..."),e.resolve()})}).promise()}),syncEventsAndStates=makeSafe(function(){return $.Deferred(function(e){_internals.log("Syncing events and states..."),_internals.state.eventsCache.refresh({complete:makeSafe(function(){_internals.state.queryManager.update(_internals.state.eventsCache.all(),{fromCache:!0}),e.resolve()})})}).promise()}),retrieveThirdPartyIdentities_1=function(){return _internals.identities.retrieveAllIdentities()},initThirdPartyData_1=function(){return _internals.thirdParty.segments()},initIdentity=function(){var e=$.Deferred();if(_internals.log("<call> init identity "),null===_internals.state.getUserId()){var t=_internals.randomUuid();_internals.log("Cookie user id is null, creating new id: "+t),_internals.state.setUserId(t)}permutive.q.filter(function(e){return"identify"===e.functionName}).forEach(function(e){var t=e.arguments[0];_internals.api.identify(t,"default")}),permutive.q=permutive.q.filter(function(e){return"identify"!==e.functionName});var n=_internals.identities.previousAliases,i=_internals.identities.currentAliases;if(_internals.identities.areAliasesEqual(n,i))_internals.log("Aliases are equal, skipping identifying...",n,i),e.resolve(_internals.state.userId);else{var r=_internals.state.userId,o={success:function(t){var n=t.user_id;n!==r&&(_internals.log("Got different user id from API: "+n),_internals.state.setUserId(n)),_internals.identities.storeAliases(i),e.resolve(n)},error:function(){_internals.error("Couldn't set identity for user "+r),e.resolve(r)}};_internals.api.sendIdentify(r,i,o)}return e.done(function(e){$(window).trigger("permutive:user:ready"),_internals.setIdentityReady(),_internals.log("<done> init identity ",e)}),e.promise()},initQueryManager=function(){return $.Deferred(function(e){_internals.state.initQueryManager(),e.resolve()}).promise()},initThirdPartyState=function(){return retrieveThirdPartyIdentities_1().then(initThirdPartyData_1).done(function(){return _internals.thirdParty.fireThirdPartySegmentEvent()})};$.when(initEventCache(),initThirdPartyState()).then(initIdentity).then(initQueryManager).then(syncEventsAndStates).done(function(){$(window).trigger("permutive:api:ready")}),$(window).trigger("permutive:library:loaded")}catch(e){_internals.error(e)}}();