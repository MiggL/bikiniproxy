{"sessionId":"125ed4abaa694c3b8d9022a09e2727ff","offers":[{"html":"<script>\n// this function makes a request to Target carrying all the above data with it. You will receive a response if you have correctly configured the activity. It's wrapped in an if statement so that it only runs on hotel pages.\nif (dataLayer.pageType === \"hotelRenderer\") {\n// the variables woudl be represented by Data Elements if this was coming from DTM.\n  var categoryMeta = tmgAds.page.zone;\nvar categoryId = categoryMeta.replace(/\\./g, ',');\nvar thumbnailURL = document.querySelector('meta[property=\"og:image\"]').getAttribute('content');\nvar name = document.querySelector('meta[property=\"og:title\"]').getAttribute('content');\nvar message = document.querySelector('.p_hub__section_1 .product-card__overview p').textContent;\nvar price = document.querySelector('div.travel-price.travel-price--price-focus.travel-price--book-now > span.travel-price__wrap > span.travel-price__price').textContent\nvar externalURL = document.querySelector('section > div > aside > div > div > div > div.travel-cta.travel-cta--book-now > a').getAttribute('href');\nvar provider = document.querySelector('div.product-book-now__container > div.product-book-now__provider > div.travel-provider > div.travel-provider__name').textContent;\nvar rating = document.querySelector('section > div > article > div > div > div.product-card__approved > div.product-card__rating > span.product-card__rating__rate').textContent;\n\n    adobe.target.getOffer({\n        \"mbox\": \"recommendations-mbox\",\n        \"params\": {\n            \"entity.id\": dataLayer.flakeId,\n            \"entity.categoryId\": categoryId,\n            \"entity.thumbnailURL\": thumbnailURL,\n            \"entity.name\": name,\n            \"entity.pageURL\": document.location.pathname,\n            \"entity.message\": message,\n            \"entity.value\": price,\n            \"entity.externalURL\": externalURL,\n            \"entity.provider\": provider,\n            \"entity.rating\": rating\n        },\n        \"success\": function(offers) {\n            adobe.target.applyOffer({\n                \"mbox\": \"recommendations-mbox\",\n                \"offer\": offers\n            });\n        },\n        \"error\": function(status, error) {}\n    });\n}\nelse if (dataLayer.pageType === \"destinationRenderer\") {\n    var categoryMeta = tmgAds.page.zone;\nvar categoryId = categoryMeta.replace(/\\./g, ',');\n  adobe.target.getOffer({\n    \"mbox\": \"recommendations-mbox\",\n    \"params\": {\n      \"entity.categoryId\": categoryId\n    },\n    \"success\": function(offers) {\n            adobe.target.applyOffer({\n                \"mbox\": \"recommendations-mbox\",\n                \"offer\": offers\n            });\n        },\n        \"error\": function(status, error) {}\n  });\n}\n  </script>"},{"html":"<style>\n  #moreAuthorNonOpinion {\n    font-size: 14px;\n    display: block;\n    font-family: \"Telesans Text Regular\", Arial, sans-serif;\n    text-transform: none;\n    padding-top: 4px;\n    padding-bottom: 3px;\n  }\n\n  #moreAuthorOpinion {\n    font-size: 15px;\n    display: block;\n    font-family: \"Telesans Text Regular\", Arial, sans-serif;\n    text-transform: none;\n    padding-top: 5px;\n    padding-bottom: 15px;\n  }\n\n\n  .moreAuthor::after {\n    content: \"î¨™\";\n    display: inline-block;\n    font-family: iconfont;\n    font-size: .67rem;\n    left: 3px;\n    position: relative;\n    top: -.8px;\n    -webkit-transform: rotate(270deg);\n    -moz-transform: rotate(270deg);\n    -ms-transform: rotate(270deg);\n    -o-transform: rotate(270deg);\n    transform: rotate(270deg);\n  }\n\n  .moreAuthor:hover {\n    filter: brightness(77%);\n  }\n</style>\n\n<script>\n  (function(window, document) {\n\n    console.log('author prominence experience 1');\n\n    var authorElement = function() {\n      var count = 0;\n      var _this = this;\n      var nTimer = setInterval(function() {\n        if (count <= 8) {\n          if (window.jQuery) {\n            clearInterval(nTimer);\n            _this.init();\n          } else {\n            count++;\n          }\n        } else {\n          clearInterval(nTimer);\n          _this.sendEvent('experience-not-seen')\n        }\n      }, 500);\n    }\n\n    authorElement.prototype.init = function() {\n\n      // if (this.oneAuthorExists()) {\n        var authorPageProperties = this.getAuthorProperties();\n        if (this.authorHasArticles(authorPageProperties)) {\n          this.authorTypeCall();\n        }\n      // }\n\n    }\n\n\n    // authorElement.prototype.oneAuthorExists = function() {\n    //\n    //   var authorNameNonOpinion = $('.footer-author li.byline__author a');\n    //   var authorNameOpinion = $('.headline li.byline__author a');\n    //\n    //   if (authorNameNonOpinion.length === 1 || authorNameOpinion.length === 1) {\n    //     return true;\n    //   } else {\n    //     console.log('more than 1 authors in article');\n    //     this.sendEvent('experience-not-seen');\n    //   }\n    //\n    // }\n\n\n    authorElement.prototype.authorHasArticles = function(authorPageProperties) {\n\n      var authorHasFourArticles = authorPageProperties.articles[2].title !== \"\";\n\n      if (authorHasFourArticles) {\n        return true;\n      } else {\n        console.log('less than 4 articles in author page');\n        this.sendEvent('experience-not-seen')\n      }\n\n    }\n\n    authorElement.prototype.getAuthorProperties = function() {\n      var currentArticleTitle = $('h1[itemprop=\"headline name\"]').text().trim().replace(/(<br>| |\\n|\\r)/g, ' ');\n      var authorPage = $('span.byline__author-name>a').attr('href');\n      var result = null;\n      $.ajax({\n        url: authorPage,\n        type: 'get',\n        dataType: 'html',\n        async: false,\n        success: function(response) {\n          var authorName = $(response).find('h1[itemprop=\"headline name\"]').text().trim().replace(/(<br>| |\\n|\\r)/g, ' ').split(' ')[0];\n          var biographyDescription = $(response).find('.author-biography__description').text();\n          var articles = [];\n          var articlesLength = $(response).find('.col_1 .list-of-entities__container li').length;\n          for (var i = 0; i < 4; i++) {\n            var article = $(response).find('.col_1 .list-of-entities__container li')[i];\n            if ($(article).find('.list-of-entities__item-body-headline a span')) {\n              $(article).find('.list-of-entities__item-body-headline a span').text(\"\");\n            }\n            var URLarticle = $(article).find('.list-of-entities__item-body-headline a').attr('href');\n            var titlearticle = $(article).find('.list-of-entities__item-body-headline a').text().trim().replace(/(<br>| |\\n|\\r)/g, ' ');\n            if (currentArticleTitle != titlearticle) {\n\n              var datearticle = $(article).find('.m_meta-property__date').text().trim().replace(/(<br>| |\\n|\\r)/g, ' ')\n              var typearticle = 'non-premium';\n              if ($(article).hasClass('premium')) {\n                typearticle = 'premium';\n              }\n              var authorArticle = {};\n              authorArticle['title'] = titlearticle;\n              authorArticle['URL'] = URLarticle;\n              authorArticle['date'] = datearticle;\n              authorArticle['type'] = typearticle;\n              articles.push(authorArticle);\n\n            }\n            if (articles.length === 3) break;\n          }\n          var authorProperties = {};\n          authorProperties['articles'] = articles;\n          authorProperties['name'] = authorName;\n          authorProperties['biography'] = biographyDescription;\n\n          result = authorProperties;\n        }\n      });\n      return result;\n    }\n\n\n    authorElement.prototype.authorTypeCall = function() {\n\n      var authorNameNonOpinion = $('.footer-author li.byline__author a');\n      var authorNameOpinion = $('.headline li.byline__author a');\n\n      if (authorNameNonOpinion.length) {\n        this.authorNonOpinion();\n      } else if (authorNameOpinion.length) {\n        this.authorOpinion();\n      }\n    }\n\n\n    authorElement.prototype.authorNonOpinion = function() {\n\n      var channelColor = $('.byline__author-name>a').css('color');\n      var authorLink = $('.byline__author-name a').attr('href');\n\n      $('li.byline__author').append('<span id=\"moreAuthorNonOpinion\" class=\"moreAuthor\"><a href=\"' + authorLink + '\">See more from this author</a></span>');\n\n      $('#moreAuthorNonOpinion').css({\n        'color': channelColor\n      });\n\n      $('.byline__author-name > a').css({\n        'color': '#333'\n      });\n\n      $('.byline__author-name > a').mouseenter(function() {\n        $(this).css({\n          'color': channelColor,\n        }).mouseleave(function() {\n          $(this).css('color', '#333');\n        });\n      });\n\n      this.trackingAnalytics();\n\n    }\n\n    authorElement.prototype.authorOpinion = function() {\n\n      var channelColor = $('.byline__author-name>a').css('color');\n      var authorLink = $('.byline__author-name>a').attr('href');\n      var authorHtml = '<span id=\"moreAuthorOpinion\" class=\"moreAuthor\"><a href=\"' + authorLink + '\">See more from this author</a></span>';\n\n      if ($('span[itemprop=\"jobTitle\"]').length) {\n        $(authorHtml).insertAfter('span[itemprop=\"jobTitle\"]');\n      } else if ($('span[itemprop=\"addressLocality\"]').length) {\n        $(authorHtml).insertAfter('span[itemprop=\"addressLocality\"]');\n      } else {\n        $(authorHtml).insertAfter('.byline__author-name');\n      }\n\n      $('#moreAuthorOpinion').css({\n        'color': channelColor\n      });\n\n      $('.byline__author-name > a').css({\n        'color': '#333'\n      });\n\n      $('.byline__author-name > a').mouseenter(function() {\n        $(this).css({\n          'color': channelColor,\n        }).mouseleave(function() {\n          $(this).css('color', '#333');\n        });\n      });\n\n      this.trackingAnalytics();\n\n    }\n\n    authorElement.prototype.sendEvent = function(eventName) {\n\n      var campaignId = \"127097\";\n      var campaignName = \"author-prominence-version2\";\n\n      if (typeof _satellite != 'undefined') {\n        s.eVar75 = campaignId + '_' + campaignName + '_' + eventName;\n        s.events = 'event52';\n        s.linkTrackEvents = 'event52';\n        s.linkTrackVars = 'events,eVar75' + _satellite.getVar('TMG linkTrackVars');\n        s.tl(true, 'o', 'Target Custom');\n      }\n\n    }\n\n\n    authorElement.prototype.trackingAnalytics = function() {\n\n      this.sendEvent('experience-seen');\n\n      var _this = this;\n\n      $('.byline__author-name a').mousedown(function() {\n        _this.sendEvent('authorName-clicked');\n        _this.sendEvent('authorPage-viewed');\n      });\n\n      $('.moreAuthor a').mousedown(function() {\n        _this.sendEvent('moreAuthor-opened');\n        _this.sendEvent('authorPage-viewed');\n      });\n\n\n      //// ONWARD JOURNEYS\n\n      // Spark Outbrain\n      $(document).ready(function() {\n\n        $('.OUTBRAIN .AR_34 a').mousedown(function() {\n          _this.sendEvent('outbrain-click');\n        });\n\n        $('div.plr-ads-inner').mousedown(function() {\n          _this.sendEvent('outbrainSponsored-click');\n        });\n\n        $('.OUTBRAIN .AR_35 a').mousedown(function() {\n          _this.sendEvent('outbrainSponsored-click');\n        });\n\n      });\n\n\n      // Polar Ad\n      var listener = addEventListener('blur', function() {\n        var elem = document.activeElement;\n        if (elem && elem.tagName == 'IFRAME' && elem.width == 0 && elem.height == 100) {\n          _this.sendEvent('polarAd-click');\n        }\n\n        removeEventListener('blur', listener);\n      });\n\n\n      // Righthand Rail\n      var outBrainTitle = $('.snippet-sidebar .component-heading, .snippet-sidebar .ob-widget-header').text().trim();\n      //Editor's choice  OR  Don't Miss\n      if (outBrainTitle === \"Editor's Choice\" | outBrainTitle === \"Don't Miss\") {\n        //console.log('Identified NOT OutBrain Recommender');\n        $('.snippet-sidebar .list-of-entities.version-13 a').mousedown(function(e) {\n          _this.sendEvent('articleOJ-sidebar-click');\n        });\n        //More stories\n      } else if (outBrainTitle === \"More Stories\") {\n        $('.snippet-sidebar .OUTBRAIN .ob-widget-items-container a').mousedown(function(e) {\n          _this.sendEvent('articleOJ-sidebar-click');\n        });\n      }\n\n\n      // Bottom articles\n      var theItem = $('.snippet-onward-journey a');\n      var $body = $('body');\n      $body.on('mousedown', theItem, function(e) {\n        var $target = $(e.target);\n\n        var entityClicked = $target.closest('.list-of-entities__item');\n\n        var sidebar = false;\n        if ($target.closest('.snippet-sidebar').length) {\n          sidebar = true;\n        }\n\n        if ($(entityClicked).hasClass('list-of-entities__item--gallery')) {\n          var indexOfClicked = $body.find('.snippet-onward-journey .list-of-entities .list-of-entities__item--gallery').index(entityClicked) + 1;\n\n          if (sidebar === false) {\n            if (indexOfClicked > 0 && indexOfClicked >= 4 || $('.version-5').length <= 2) {\n              _this.sendEvent('articleOJ-main-click');\n              _this.sendEvent('articleOJ-main-galleries-click');\n            } else {\n              _this.sendEvent('articleOJ-galleries-click');\n            }\n          }\n        } else {\n          var indexOfClicked = $body.find('.snippet-onward-journey .list-of-entities .list-of-entities__item').not('.list-of-entities__item--gallery').index(entityClicked) + 1;\n          //0 currenty occures when you click anywhere else on the page. Look into this.\n          if (indexOfClicked !== 0) {\n            _this.sendEvent('articleOJ-main-click');\n          }\n        }\n      });\n\n    }\n\n    if (document.readyState !== 'loading') {\n      new authorElement();\n    } else {\n      document.addEventListener('DOMContentLoaded', function() {\n        new authorElement();\n      });\n    }\n\n  })(window, document);\n</script>"}]}