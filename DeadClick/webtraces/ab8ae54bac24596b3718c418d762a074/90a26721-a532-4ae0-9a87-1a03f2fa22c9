// JavaScript Document
//HTML5 Ad Template JS from DoubleClick by Google

var container;
var content;
var bgExit;
var twoLines=false;
// Setup namespace for ad.
var creative = {};
var clipTween;
var brwsr;

function checkBrowser(){
  
    c=navigator.userAgent.search("Chrome");
    f=navigator.userAgent.search("Firefox");
    m8=navigator.userAgent.search("MSIE 8.0");
    m9=navigator.userAgent.search("MSIE 9.0");
    if (c>-1){
        brwsr = "Chrome";
    }
    else if(f>-1){
        brwsr = "Firefox";
    }else if (m9>-1){
        brwsr ="MSIE 9.0";
    }else if (m8>-1){
        brwsr ="MSIE 8.0";
    }
   
}
creative.init = function () {
  

  creative.setupDOMElements();
//  clipTween = TweenLite.to(creative.domElements._copyCTA, .4, {clip:"rect(0px 300px 300px 300px)", paused:true});

  // Check if Enabler is initialized.
  if (Enabler.isInitialized()) {
    // Check if ad is visible to user.
    if (Enabler.isVisible()) {
      creative.enablerInitHandler();
    } else {
      Enabler.addEventListener(studio.events.StudioEvent.VISIBLE,
        creative.enablerInitHandler);
    }
  } else {
    Enabler.addEventListener(studio.events.StudioEvent.INIT,
        creative.enablerInitHandler);
  }
};

creative.setupDOMElements = function () {
  creative.domElements = {};
 // creative.domElements._placePrice = document.getElementById('placePrice');
};

    
//Function confirm if the creative is visible 
enablerInitHandler = function(e) {
  creative.dynamicDataAvailable();

  /*creative.showAd();*/
  if(Enabler.isVisible()) {
  startAd();
  } else {
  Enabler.addEventListener(studio.events.StudioEvent.VISIBLE, adIsVisible);
  } 
};

adIsVisible=function(){

startAd();
};
// GEO 
creative.dynamicDataAvailable = function () {
  checkBrowser();
      Enabler.setProfileId(10009892);
    var devDynamicContent = {};

    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR= [{}];
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0]._id = 0;
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].ID = 1;
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Start_Date = {};
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Start_Date.RawValue = "";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Start_Date.UtcValue = 0;
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].End_date = {};
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].End_date.RawValue = "";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].End_date.UtcValue = 0;
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Reporting_Label = "WG-earlybooking2017-think-generic-default-300x600-A";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Version = "A";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Audience_ID = "";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Image_square = {};
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Image_square.Type = "file";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Image_square.Url = "https://s0.2mdn.net/ads/richmedia/studio/43523707/43523707_20170816053204048_Algemeen_IMU.png";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].image_vertical = {};
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].image_vertical.Type = "file";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].image_vertical.Url ="https://s0.2mdn.net/ads/richmedia/studio/43523707/43523707_20170829021707214_Algemeen_SKY.png";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].image_horizontal = {};
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].image_horizontal.Type = "file";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].image_horizontal.Url = "https://s0.2mdn.net/ads/richmedia/studio/43523707/43523707_20170816053239965_Algemeen_LB.png";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].textShadow = false;
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].extraLogo = "";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].copy1 = "Partez au ski avec Sunweb !";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].copy2 = "Location du mat\u00E9riel de ski offerte";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].copyExtra = " ";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].priceCheck = false;
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].price_pre = "";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].price = "â‚¬199";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].price_after = "";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].cta = "En savoir plus";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].isDefault = true;
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].isActive = true;
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Exit_URL1 = {};
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Exit_URL1.Url = "https://ski.sunweb.fr/avantages-premieres-minutes";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Exit_URL2 = {};
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Exit_URL2.Url = "";
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Exit_URL3 = {};
    devDynamicContent.Sunweb_DCS_2017_Wintersport_FR[0].Exit_URL3.Url = "";
    Enabler.setDevDynamicContent(devDynamicContent);

    creative.dynamicData = dynamicContent.Sunweb_DCS_2017_Wintersport_FR[0];
    creative.dynamicExitUrl = creative.dynamicData.Exit_URL1.Url;//.Url;*/

    tekst = creative.dynamicData.copy1;
    tekst2 = creative.dynamicData.copy2;
    
    dePrijs = creative.dynamicData.price;

    ctaTekstTemp = creative.dynamicData.cta;
    
    
  
    ctaTekst = ctaTekstTemp;
    if(ctaTekstTemp.length > 17){ 
    
        ctaTekst = ctaTekstTemp.slice(0,17);
    }
    document.getElementById('ctatxt').innerHTML = ctaTekst;

    imgNewPos = creative.dynamicData.changePosition;

    imgUrl = creative.dynamicData.image_vertical.Url;

    textShadow = creative.dynamicData.textShadow;
    priceCheck = creative.dynamicData.priceCheck; 
    extraLogo = creative.dynamicData.extraLogo;
};


//Start the creative
startAd = function() {
  //Assign All the elements to the element on the page
  container = document.getElementById('container_dc');
  content = document.getElementById('content_dc');  
  bgExit = document.getElementById('background_exit_dc');
  bgExit2 = document.getElementById('ctaDiv');

  //Add listeners
  addListeners();
  container.style.display = "block";
  initAnimate();

  imgUrl = creative.dynamicData.image_vertical.Url;
  imgXPos = creative.dynamicData.changePosition;

};
var canvas, stage, exportRoot;
function initAnimate() {
  canvas = document.getElementById("canvas");
  anim_container = document.getElementById("animation_container");
  dom_overlay_container = document.getElementById("dom_overlay_container");
  var comp=AdobeAn.getComposition("C04D494C333B480786B01E76BE451778");
  var lib=comp.getLibrary();
  var loader = new createjs.LoadQueue(false);
  loader.addEventListener("fileload", function(evt){handleFileLoad(evt,comp)});
  loader.addEventListener("complete", function(evt){handleComplete(evt,comp)});
  var lib=comp.getLibrary();
  loader.loadManifest(lib.properties.manifest);
}

function handleFileLoad(evt, comp) {
  var images=comp.getImages();  
  if (evt && (evt.item.type == "image")) { images[evt.item.id] = evt.result; }  
}
function handleComplete(evt,comp) {
  //This function is always called, irrespective of the content. You can use the variable "stage" after it is created in token create_stage.
  var lib=comp.getLibrary();
  var ss=comp.getSpriteSheet();
  var queue = evt.target;
  var ssMetadata = lib.ssMetadata;
  for(i=0; i<ssMetadata.length; i++) {
    ss[ssMetadata[i].name] = new createjs.SpriteSheet( {"images": [queue.getResult(ssMetadata[i].name)], "frames": ssMetadata[i].frames} )
  }
  exportRoot = new lib.Sunweb_WinterSport_THINK_DCS_160x600();
  stage = new lib.Stage(canvas);
  stage.addChild(exportRoot); 
  //Registers the "tick" event listener.
  fnStartAnimation = function() {
    createjs.Ticker.setFPS(lib.properties.fps);
    createjs.Ticker.addEventListener("tick", stage);
  }     
  //Code to support hidpi screens and responsive scaling.
  function makeResponsive(isResp, respDim, isScale, scaleType) {    
    var lastW, lastH, lastS=1;    
    window.addEventListener('resize', resizeCanvas);    
    resizeCanvas();   
    function resizeCanvas() {     
      var w = lib.properties.width, h = lib.properties.height;      
      var iw = window.innerWidth, ih=window.innerHeight;      
      var pRatio = window.devicePixelRatio || 1, xRatio=iw/w, yRatio=ih/h, sRatio=1;      
      if(isResp) {                
        if((respDim=='width'&&lastW==iw) || (respDim=='height'&&lastH==ih)) {                    
          sRatio = lastS;                
        }       
        else if(!isScale) {         
          if(iw<w || ih<h)            
            sRatio = Math.min(xRatio, yRatio);        
        }       
        else if(scaleType==1) {         
          sRatio = Math.min(xRatio, yRatio);        
        }       
        else if(scaleType==2) {         
          sRatio = Math.max(xRatio, yRatio);        
        }     
      }     
      canvas.width = w*pRatio*sRatio;     
      canvas.height = h*pRatio*sRatio;
      canvas.style.width = dom_overlay_container.style.width = anim_container.style.width =  w*sRatio+'px';       
      canvas.style.height = anim_container.style.height = dom_overlay_container.style.height = h*sRatio+'px';
      stage.scaleX = pRatio*sRatio;     
      stage.scaleY = pRatio*sRatio;     
      lastW = iw; lastH = ih; lastS = sRatio;   
    }
  }
  makeResponsive(false,'both',false,1); 
  AdobeAn.compositionLoaded(lib.properties.id);
  fnStartAnimation();
}
//Add Event Listeners
addListeners = function(e) {
  bgExit.addEventListener('touchEnd', bgExitHandler, false);
  bgExit.addEventListener('click', bgExitHandler, false);
  bgExit.addEventListener('mouseover', rolloverEvent, false);
  bgExit.addEventListener('mouseout', rolloutEvent, false);
  bgExit2.addEventListener('touchEnd', bgExitHandler, false);
  bgExit2.addEventListener('click', bgExitHandler, false);
  bgExit2.addEventListener('mouseover', rolloverEvent, false);
  bgExit2.addEventListener('mouseout', rolloutEvent, false);
};
var rolloverCheck;
var rolloutCheck;

rolloverEvent=function(e){
  
  if(rolloverCheck){
    exportRoot.gotoAndPlay("rollover"); 
    //$( "#ctaDiv" ).css("bottom", "8px");
   
  }
  //exportRoot.mc_cta.gotoAndPlay("rollovercta");
};

rolloutEvent=function(e){
  
  if(rolloutCheck){
    exportRoot.gotoAndPlay("rollout");
     //$( "#ctaDiv" ).css("bottom", "10px");

    //exportRoot.mc_cta.gotoAndPlay("rolloutcta");
  }
  
};

//Add exits
bgExitHandler = function(e) { 
  /*Enabler.exit('HTML5_Background_Clickthrough');*/
  /*Enabler.exit('Background Exit');*/
  Enabler.exitOverride('exit', creative.dynamicExitUrl);

};

//Wait for the content to load to call the start od the ad
window.onload = function(){
  if (Enabler.isInitialized()) {
    enablerInitHandler();
  } else {
    Enabler.addEventListener(studio.events.StudioEvent.INIT, enablerInitHandler);
  }
};  
